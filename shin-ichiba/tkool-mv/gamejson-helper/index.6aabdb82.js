async function e(e){return new Promise((t,n)=>{let a=URL.createObjectURL(e),i=document.createElement("img");i.src=a,i.onload=function(){URL.revokeObjectURL(a),t({width:i.width,height:i.height})},i.onerror=function(e){n(e)}})}async function t(e){return t([],"",e);async function t(e,n,a){if(!a)return e;if(a.isDirectory){let i=a.createReader();return new Promise((r,s)=>{!function o(){i.readEntries(async i=>{if(!i||0===i.length){r(e);return}for(let r of i)await t(e,`${n}/${a.name}`,r);o()},s)}()})}return a.isFile?new Promise((t,i)=>{a.file(i=>{e.push({file:i,path:`${n}/${a.name}`.normalize()}),t(e)},i)}):e}}async function n(n){let a=await t(n);!function(e){if(0===e.length)return;let t=e.filter(e=>/\/game.json$/.test(e.path));if(0===t.length)throw Error("Wrong input: No game.json found.");if(t.length>1)throw Error("Wrong input: Found multiple game.json.");let n=t[0].path.replace(/game.json$/,""),a=RegExp("^"+n);e.forEach(e=>{e.path=e.path.replace(a,"")})}(a);let i={};for(let{file:t,path:n}of a)if(!/\/\.gitkeep$/.test(n)){if(/^(image|assets)\//.test(n)&&("image/png"===t.type||"image/png"===t.type)){let a=await e(t),r={type:"image",path:n,width:a.width,height:a.height,hint:{untainted:!0}};i[r.path]=r}else if(/^(audio|assets)\/.*\.(?:ogg|aac|m4a|mp4)$/.test(n)){let e=/\/(?:se|me)\//.test(n),t={type:"audio",path:n.replace(/\.(ogg|aac|m4a|mp4)$/,""),duration:void 0,systemId:e?"sound":"music",global:!0};i[t.path]=t}else if(/^text\//.test(n)){let e={type:"text",path:n,global:!0},t=e.path.replace(/^.*\//,"").replace(/\.[^\.]+$/,"");i[t]=e}}let r=JSON.parse(await a.find(e=>"game.json"===e.path).file.text()),s=JSON.parse(await a.find(e=>"text/Plugins.json"===e.path)?.file.text()??"[]"),o=null,l=null;for(let e of s)if(e.status)switch(e.name){case"Community_Basic":o=e.parameters;break;case"AkashicRankingMode":l=e.parameters}return{...r,width:o?Number(o.screenWidth):r.width,height:o?Number(o.screenHeight):r.height,assets:{...r.assets,...i},environment:{...r.environment,nicolive:{...r.environment?.nicolive,preferredSessionParameters:{totalTimeLimit:l?Number(l.totalTimeLimit):75}},external:{send:"0"},"akashic-runtime":{version:"~3.7.1-0",flavor:"-canvas"}}}}window.addEventListener("load",()=>{let e=document.getElementById("drop_zone"),t=document.getElementById("result"),a=document.getElementById("download"),i=null;e.addEventListener("drop",async e=>{if(e.preventDefault(),!e.dataTransfer?.items?.length)return;let r=e.dataTransfer.items[0].webkitGetAsEntry();r&&(i=await n(r),t.innerHTML=JSON.stringify(i,null,2).replace(/\n/g,"<br>"),a.disabled=!1)}),e.addEventListener("dragover",e=>e.preventDefault()),a.addEventListener("click",()=>{let e=JSON.stringify(i,null,2),t=new Blob([e],{type:"text/plain"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.target="_blank",a.download="game.json",a.click(),URL.revokeObjectURL(n)})});