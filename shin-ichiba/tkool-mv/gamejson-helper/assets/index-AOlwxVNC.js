(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(e){if(e.ep)return;e.ep=!0;const t=n(e);fetch(e.href,t)}})();async function E(s){return new Promise((r,n)=>{const o=URL.createObjectURL(s),e=document.createElement("img");e.src=o,e.onload=function(){URL.revokeObjectURL(o),r({width:e.width,height:e.height})},e.onerror=function(t){n(t)}})}class w extends Error{}async function R(s){return r([],"",s);async function r(n,o,e){if(!e)return n;if(e.isDirectory){const t=e.createReader();return new Promise((i,a)=>{function l(){t.readEntries(async m=>{if(!m||m.length===0){i(n);return}for(const p of m)await r(n,`${o}/${e.name}`,p);l()},a)}l()})}else return e.isFile?new Promise((t,i)=>{e.file(a=>{n.push({file:a,path:`${o}/${e.name}`.normalize()}),t(n)},i)}):n}}function j(s){if(s.length===0)return;const r=s.filter(e=>/\/game.json$/.test(e.path));if(r.length===0)throw new w("ドラッグ＆ドロップされたフォルダに game.json が存在しません。");if(r.length>1)throw new w("ドラッグ＆ドロップされたフォルダに game.json が複数存在します。game.json は1ファイルのみ必要です。");const n=r[0].path.replace(/game.json$/,""),o=new RegExp("^"+n);s.forEach(e=>{e.path=e.path.replace(o,"")})}async function b(s){return new Promise((r,n)=>{const o=URL.createObjectURL(s),e=new Audio;e.src=o,e.load(),e.addEventListener("loadedmetadata",function(t){URL.revokeObjectURL(o),r(Math.ceil(e.duration*1e3))}),e.onerror=function(t){URL.revokeObjectURL(o),n(t)}})}async function O(s){var m,p;const r=await R(s);j(r);const n={},o={},e={};for(const{file:u,path:f}of r)if(!/\/\.gitkeep$/.test(f)){if(/^(image|assets)\//.test(f)&&(u.type==="image/png"||u.type==="image/png")){const d=await E(u),c={type:"image",path:f,width:d.width,height:d.height,hint:{untainted:!0}};n[c.path]=c}else if(/^(audio|assets)\/.*\.(?:ogg|aac|m4a|mp4)$/.test(f)){const d=f.split(".").pop(),c=f.replace(/\.(ogg|aac|m4a|mp4)$/,"");e[c]||(e[c]=new Set),e[c].add(`.${d}`);const y=Array.from(e[c]);let g;if(n[c]){const h=n[c];h.hint={extensions:y},o[c].ext!=="ogg"&&(g=await b(u),(d==="ogg"||h.duration<g)&&(h.duration=g,o[c]={ext:d,duration:g}));continue}g=await b(u);const v=/\/(?:se|me)\//.test(f),L={type:"audio",path:c,duration:g,systemId:v?"sound":"music",global:!0,hint:{extensions:y}};n[L.path]=L,o[c]={ext:d,duration:g}}else if(/^text\//.test(f)){const d={type:"text",path:f,global:!0},c=d.path.replace(/^.*\//,"").replace(/\.[^\.]+$/,"");n[c]=d}}const t=JSON.parse(await r.find(u=>u.path==="game.json").file.text()),i=JSON.parse(await((m=r.find(u=>u.path==="text/Plugins.json"))==null?void 0:m.file.text())??"[]");let a=null,l=null;for(let u of i)if(u.status)switch(u.name){case"Community_Basic":a=u.parameters;break;case"AkashicRankingMode":l=u.parameters;break}return{...t,width:a?Number(a.screenWidth):t.width,height:a?Number(a.screenHeight):t.height,assets:{...t.assets,...n},environment:{...t.environment,nicolive:{...(p=t.environment)==null?void 0:p.nicolive,preferredSessionParameters:{totalTimeLimit:l?Number(l.totalTimeLimit):75}},external:{send:"0"},"akashic-runtime":{version:"~3.7.17-0",flavor:"-canvas"}}}}window.addEventListener("load",()=>{const s=document.getElementById("drop_zone"),r=document.getElementById("result"),n=document.getElementById("download"),o=document.getElementById("message_area");let e=null;s.addEventListener("drop",async t=>{var a,l;if(t.preventDefault(),!((l=(a=t.dataTransfer)==null?void 0:a.items)!=null&&l.length))return;o.innerHTML="";const i=t.dataTransfer.items[0].webkitGetAsEntry();if(i){if(i.isFile){o.innerHTML="game.json を含むフォルダをドラッグ＆ドロップしてください。";return}try{e=await O(i),r.innerHTML=JSON.stringify(e,null,2).replace(/\n/g,"<br>"),n.disabled=!1}catch(m){m instanceof w&&(o.innerHTML=m.message)}}}),s.addEventListener("dragover",t=>t.preventDefault()),n.addEventListener("click",()=>{const t=JSON.stringify(e,null,2),i=new Blob([t],{type:"text/plain"}),a=URL.createObjectURL(i),l=document.createElement("a");l.href=a,l.target="_blank",l.download="game.json",l.click(),URL.revokeObjectURL(a)})});
