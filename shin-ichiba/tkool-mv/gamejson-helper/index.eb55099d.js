async function e(e){return new Promise((t,n)=>{let a=URL.createObjectURL(e),r=document.createElement("img");r.src=a,r.onload=function(){URL.revokeObjectURL(a),t({width:r.width,height:r.height})},r.onerror=function(e){n(e)}})}async function t(e){return t([],"",e);async function t(e,n,a){if(!a)return e;if(a.isDirectory){let r=a.createReader();return new Promise((i,o)=>{!function l(){r.readEntries(async r=>{if(!r||0===r.length){i(e);return}for(let i of r)await t(e,`${n}/${a.name}`,i);l()},o)}()})}return a.isFile?new Promise((t,r)=>{a.file(r=>{e.push({file:r,path:`${n}/${a.name}`.normalize()}),t(e)},r)}):e}}async function n(n){let a=await t(n);!function(e){if(0===e.length)return;let t=e.filter(e=>/\/game.json$/.test(e.path));if(0===t.length)throw Error("Wrong input: No game.json found.");if(t.length>1)throw Error("Wrong input: Found multiple game.json.");let n=t[0].path.replace(/game.json$/,""),a=RegExp("^"+n);e.forEach(e=>{e.path=e.path.replace(a,"")})}(a);let r={};for(let{file:t,path:n}of a)if(!/\/\.gitkeep$/.test(n)){if(/^(image|assets)\//.test(n)&&("image/png"===t.type||"image/png"===t.type)){let a=await e(t),i={type:"image",path:n,width:a.width,height:a.height,hint:{untainted:!0}};r[i.path]=i}else if(/^(audio|assets)\/.*\.(?:ogg|aac|m4a|mp4)$/.test(n)){let e=/\/(?:se|me)\//.test(n),t={type:"audio",path:n.replace(/\.(ogg|aac|m4a|mp4)$/,""),duration:void 0,systemId:e?"sound":"music",global:!0};r[t.path]=t}else if(/^text\//.test(n)){let e={type:"text",path:n,global:!0},t=e.path.replace(/^.*\//,"").replace(/\.[^\.]+$/,"");r[t]=e}}let i=JSON.parse(await a.find(e=>"game.json"===e.path).file.text());return{...i,assets:{...i.assets,...r},environment:{...i.environment,external:{send:"0"},"akashic-runtime":{version:"~3.7.1-0",flavor:"-canvas"}}}}window.addEventListener("load",()=>{let e=document.getElementById("drop_zone"),t=document.getElementById("result"),a=document.getElementById("download"),r=null;e.addEventListener("drop",async e=>{if(e.preventDefault(),!e.dataTransfer?.items?.length)return;let i=e.dataTransfer.items[0].webkitGetAsEntry();i&&(r=await n(i),t.innerHTML=JSON.stringify(r,null,2).replace(/\n/g,"<br>"),a.disabled=!1)}),e.addEventListener("dragover",e=>e.preventDefault()),a.addEventListener("click",()=>{let e=JSON.stringify(r,null,2),t=new Blob([e],{type:"text/plain"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.target="_blank",a.download="game.json",a.click(),URL.revokeObjectURL(n)})});