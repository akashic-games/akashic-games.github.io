<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="UTF-8">
<meta name="viewport"    content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
<meta name="description" content="Akashic EngineはJavaScriptで動作する、無償利用が可能なマルチプラットフォーム対応ゲーム開発エンジンです">
<meta name="theme-color" content="#0F1F26">
<title>ユーザ名を使う</title>
<link rel="icon"       href="/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="stylesheet" href="/css/common.css?0bf2ea8a">
<link rel="stylesheet" href="/css/header.css?0bf2ea8a">
<link rel="stylesheet" href="/css/footer.css?0bf2ea8a">


<link rel="stylesheet" href="/css/akashic-document.css?0bf2ea8a">

<link rel="stylesheet" href="/css/railscasts.css?0bf2ea8a">


<script src="/lib/jquery-3.2.1.min.js"></script>
<script src="/lib/common.js?0bf2ea8a"></script>



<script src="/lib/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>

<div class="head--spacer"></div>
<div class="SP--head--menu--show"></div>
<div class="SP--head--menu--hide"></div>

<div class="head--menu--outer">
	<ul class="head--menu">
		<li class="head--menu--item">
			<p class="head--menu--item--tab"></p>
			<ul class="head--menu--item--list">
				<li><a href="/tutorial/v3/">Akashic Engine入門</a></li>
				<li><a href="/reverse-reference/v3/">Akashic Engine逆引きリファレンス</a></li>
				<li><a href="/shin-ichiba/">ニコ生ゲームを作ろう</a></li>
				<li><a href="/recent-changes/">Akashic Engine 更新情報</a></li>
				<!--li><a href="/tutorial/akashic-info.html">Akashic Engine関連情報一覧</a></li-->
			</ul>
		</li>
		<li class="head--menu--item">
			<p class="head--menu--item--tab"></p>
			<ul class="head--menu--item--list">
				<li><a href="/guide/akashic-cli.html">akashic-cli利用ガイド</a></li>
				<li><a href="/guide/bmpfont-generator.html">bmpfont-generator の仕様</a></li>
				<li><a href="/guide/game-json.html">game.jsonの仕様</a></li>
				<li><a href="/guide/sandbox-config.html">sandbox.config.jsの仕様</a></li>
				<li><a href="/guide/akashic-lib.html">akashic-lib.jsonの仕様</a></li>
				<li><a href="/guide/atsumaru.html">ゲームアツマールで遊べるゲームの作成</a></li>
				<li><a href="/guide/shin-ichiba/index.html">ニコニコ生放送で遊べるゲームの作成</a></li>
				<li><a href="/guide/asset-load-error.html">アセットロードエラーについて</a></li>
				<li><a href="/guide/shader.html">シェーダの利用</a></li>
				<li><a href="/guide/asset-recommended-spec.html">素材の推奨仕様</a></li>
				<li><a href="/guide/template-guide.html">akashic initテンプレート利用ガイド</a></li>
				<li><a href="/guide/common-pitfalls.html">よくある落とし穴</a></li>
				<li><a href="/guide/acceleration-tips.html">高速化TIPS</a></li>
				<!--li><a href="/guide/storage.html">ストレージについて</a></li-->
			</ul>
		</li>
		<li class="head--menu--item"><a class="head--logo" href="/" title="ホーム"></a></li>
		<li class="head--menu--item">
			<p class="head--menu--item--tab"></p>
			<ul class="head--menu--item--list">
				<li><a href="https://akashic-games.github.io/akashic-engine/v3/">akashic-engine v3.x</a></li>
				<li><a href="https://akashic-games.github.io/akashic-timeline/api/">akashic-timeline</a></li>
				<li><a href="https://akashic-games.github.io/akashic-animation/api/">akashic-animation</a></li>
				<li><a href="https://akashic-games.github.io/akashic-label/api/">akashic-label</a></li>
				<li><a href="https://akashic-games.github.io/akashic-tile/api/">akashic-tile</a></li>
				<li><a href="https://akashic-games.github.io/akashic-box2d/api/">akashic-box2d</a></li>
				<li><a href="https://akashic-games.github.io/coe/api/">coe framework</a></li>
				<li><a href="/reference/raycaster-js/">raycaster-js</a></li>
				<li><a href="https://akashic-games.github.io/collision-js/api/">collision-js</a></li>
				<li><a href="/reference/aimgui/">AimGui</a></li>
				<li><a href="https://akashic-games.github.io/akashic-engine/v2/modules/_lib_main_d_.g.html">akashic-engine v2.x (旧版)</a></li>
				<li><a href="https://akashic-games.github.io/akashic-engine/v1/modules/_lib_main_d_.g.html">akashic-engine v1.x (旧版)</a></li>
			</ul>
		</li>
		<li class="head--menu--item" id="demo">
			<a  class="demo-link" href="/demo/?title=helloworld" >サンプルデモ</a>
			<!-- 以下 sp 用のメニュ -->
			<p class="head--menu--item--tab" id="demo"></p>
			<ul class="head--menu--item--list" id="demo">
				<li><a href="/demo/?title=helloworld">Hello World</a></li>
				<li><a href="/demo/?title=scale-rotate-opacity">拡縮・回転・透明度</a></li>
				<li><a href="/demo/?title=bitmap-font">ビットマップフォント</a></li>
				<li><a href="/demo/?title=framesprite">フレームアニメーション</a></li>
				<li><a href="/demo/?title=demo-touchevent">タッチイベント</a></li>
				<li><a href="/demo/?title=demo-tile">タイル</a></li>
				<li><a href="/demo/?title=svg-sample">SVGサンプル</a></li>
				<li><a href="/demo/?title=label-sample">ラベル</a></li>
				<li><a href="/demo/?title=box2d-sample">2D 物理演算</a></li>
				<li><a href="/demo/?title=animation-showcase">アニメーション制御</a></li>
				<li><a href="/demo/?title=timeline-sample">トゥイーン制御</a></li>
				<li><a href="/demo/?title=timeline-easing-sample">イージング一覧</a></li>
				<li><a href="/demo/?title=simpleShot">アブストラクトシューティング</a></li>
				<li><a href="/demo/?title=HoppingWitch">HOPPING WITCH</a></li>
				<li><a href="/demo/?title=GalaxyWars">GALAXY WARS</a></li>
				<li><a href="/demo/?title=cannontv">いくぜ！ 超会議</a></li>
				<li><a href="/demo/?title=collision-js">collision-js</a></li>
				<li><a href="/demo/?title=aimgui">AimGui</a></li>
				<li><a href="/demo/?title=tsurikkuma-style-game">つりっくま風ゲーム</a></li>
				<li><a href="/demo/?title=oekaki">おえかき</a></li>
				<li><a href="/demo/?title=software-keyboard-sample">ソフトウェアキーボード</a></li>
				<li><a href="/demo/?title=hello-box2d">箱を落とす</a></li>
				<li><a href="/demo/?title=drag-throw">ドラッグして飛ばす</a></li>
				<li><a href="/demo/?title=hit-break">ぶつかると散る</a></li>
				<li><a href="/demo/?title=spring">バネ</a></li>
				<li><a href="/demo/?title=hajiki">おはじき</a></li>
				<li><a href="/demo/?title=newtons-cradle">ニュートンのゆりかご</a></li>
				<li><a href="/demo/?title=draw-polygon">多角形を描く</a></li>
				<li><a href="/demo/?title=machine-gun">マシンガン</a></li>
				<li><a href="/asset/material.html">サンプルデモの素材</a></li>
			</ul>
		</li>
	</ul>
</div>

<header id="akashic-page-header">
	<div class="SP--head--logo--box"><a class="head--logo" href="/" title="ホーム"></a></div>
</header>

<div id="BodyInner">
	<section class="akashic--document safearea--LR twocol">
		<div class="twocol-side">
			<h3>
	<a href="./">ニコ生ゲームを作ろう</a>
</h3>


	
	
	<label class="accordion-label" for="accordion_state_0">ニコ生ゲームとは</label>
	<input type="checkbox" class="accordion-state" id="accordion_state_0" checked></input>
	<ul>
		
			<li>
				
					<a href="introduction.html">ニコ生ゲームとは</a>
				
			</li>
		
	</ul>

	
	
	<label class="accordion-label" for="accordion_state_1">改造編</label>
	<input type="checkbox" class="accordion-state" id="accordion_state_1" checked></input>
	<ul>
		
			<li>
				
					<a href="mod-game.html">ニコ生ゲームを作ろう・改造編</a>
				
			</li>
		
			<li>
				
					<a href="install.html">インストール</a>
				
			</li>
		
			<li>
				
					<a href="thiefBuster-mod.html">『泥棒バスター』を改造する</a>
				
			</li>
		
			<li>
				
					<a href="speed-jigsaw-mod.html">『スピードジグソー』を改造する</a>
				
			</li>
		
	</ul>

	
	
	<label class="accordion-label" for="accordion_state_2">ランキングゲーム編</label>
	<input type="checkbox" class="accordion-state" id="accordion_state_2" checked></input>
	<ul>
		
			<li>
				
					<a href="ranking-top.html">ニコ生ゲームを作ろう・ランキングゲーム編</a>
				
			</li>
		
			<li>
				
					<a href="ranking.html">ランキング対応ゲーム</a>
				
			</li>
		
			<li>
				
					<a href="ranking-by-template.html">テンプレートでわかるランキング対応ゲーム</a>
				
			</li>
		
			<li>
				
					<a href="ranking-sample.html">ランキング対応ゲームのサンプル</a>
				
			</li>
		
	</ul>

	
	
	<label class="accordion-label" for="accordion_state_3">マルチプレイゲーム編</label>
	<input type="checkbox" class="accordion-state" id="accordion_state_3" ></input>
	<ul>
		
			<li>
				
					<a href="multi-top.html">ニコ生ゲームを作ろう・マルチプレイゲーム編</a>
				
			</li>
		
			<li>
				
					<a href="multi-ready.html">マルチプレイ開発予備知識</a>
				
			</li>
		
			<li>
				
					<a href="column-about-multi.html">マルチプレイゲームを知ろう</a>
				
			</li>
		
			<li>
				
					<a href="column-local-process.html">簡単なゲームを作ってローカル処理に触れよう</a>
				
			</li>
		
			<li>
				
					<a href="column-join-leave.html">Join と Leave とニコ生の話</a>
				
			</li>
		
			<li>
				
					<a href="column-make-multi.html">実際にマルチプレイゲームを考えて作ろう</a>
				
			</li>
		
			<li>
				
					<b>ユーザ名を使う</b>
				
			</li>
		
	</ul>

	
	
	<label class="accordion-label" for="accordion_state_4">投稿しよう</label>
	<input type="checkbox" class="accordion-state" id="accordion_state_4" checked></input>
	<ul>
		
			<li>
				
					<a href="submit.html">ニコ生ゲームを投稿しよう</a>
				
			</li>
		
			<li>
				
					<a href="play.html">ニコ生ゲームで遊ぼう</a>
				
			</li>
		
	</ul>

	
	
	<label class="accordion-label" for="accordion_state_5">関連資料</label>
	<input type="checkbox" class="accordion-state" id="accordion_state_5" checked></input>
	<ul>
		
			<li>
				
					<a href="design-guidelines.html">デザインガイドライン</a>
				
			</li>
		
			<li>
				
					<a href="links.html">関連資料・困った時は</a>
				
			</li>
		
	</ul>


		</div>
		<div class="twocol-main">
			<div class="inner responsive--width--twocol">
				<h1>ユーザ名を使う</h1>
<p>マルチプレイゲームでは、ゲーム中にプレイヤーの名前を表示したいことがあります。
ニコ生ゲームでは、各プレイヤーの「ニコニコ生放送のユーザ名」を取得・利用することができます。</p>
<p>対応バージョンは Akashic Engine v3 以降です。</p>
<h2><a name="confirm"></a> ユーザ名の利用許諾</h2>
<p>ニコ生ゲームでのユーザ名取得は、技術的には「関数を一つ呼び出してその完了を待つ」だけで実現できます。</p>
<p>ただし自作ニコ生ゲームにおいては、ユーザの許可なくユーザ名を利用することはできません。
コンテンツからユーザ名を取得しようとすると、ゲーム画面に許諾を求めるダイアログが表示されます。(下図参照)</p>
<p><img src="/img/shin-ichiba/player-info-accept-dialog.png" alt="ユーザ名の利用許諾を求めるダイアログ"></p>
<p>ゲームからは、ここで「ユーザー名」ボタンを押したユーザの名前だけが取得できます。
許諾されなかった場合、ランダムに生成された名前 (e.g. <code>&quot;ゲスト383&quot;</code>) が通知されます。</p>
<blockquote>
<p>このような制約を設けるのは、ニコニコ生放送が歴史的に「名前を出さない」コミュニケーションを許容してきたという文化的背景があるためです (<a href="https://qa.nicovideo.jp/faq/show/936">184 コメント</a> など)。
公式ニコ生ゲームでは、何がしかゲームプレイに参加しなければ名前が出ることはないようになっているため、このような許諾画面を表示していません。</p>
</blockquote>
<h2><a name="library"></a> ライブラリの導入</h2>
<p>ユーザ名を取得するには、拡張ライブラリ <code>@akashic-extension/resolve-player-info</code> を導入して利用する必要があります。</p>
<p>game.json のあるディレクトリで、次を実行してください。</p>
<pre><code class="language-sh">akashic install @akashic-extension/resolve-player-info</code></pre>
<p>テキストエディタで game.json を開いて、次のような <code>environment.external.coeLimited</code> プロパティがなければ作成してください。値は <code>&quot;0&quot;</code> としてください。(v2.2.4 以降の <code>akashic-cli</code> では、 <code>akashic install</code> 時に自動的に作成されます。)</p>
<pre><code class="language-json">{
  ...,
  &quot;environment&quot;: {
    &quot;external&quot;: {
      &quot;coeLimited&quot;: &quot;0&quot;,
      &quot;atsumaru&quot;: &quot;0&quot;
    }
  }
}</code></pre>
<p>スクリプトアセット内で、 <code>require()</code> で関数 <code>resolvePlayerInfo()</code> を取得します。</p>
<pre><code class="language-javascript">const resolvePlayerInfo = require(&quot;@akashic-extension/resolve-player-info&quot;)
  .resolvePlayerInfo;</code></pre>
<p>TypeScript の場合は <code>import</code> を利用してください。</p>
<pre><code class="language-typescript">import { resolvePlayerInfo } from &quot;@akashic-extension/resolve-player-info&quot;;</code></pre>
<h2><a name="obtain-name"></a> 名前の取得</h2>
<p>得られた <code>resolvePlayerInfo()</code> のもっとも簡単な用法は、引数として <code>{ raises: true }</code> を与えて呼び出すことです。これにより名前利用の許諾ダイアログが表示され、ダイアログに応答したプレイヤーのユーザ名情報が <code>g.game.onPlayerInfo</code> で通知されます。</p>
<p>また以降そのプレイヤーが生成したイベント (画面押下の <code>g.PointDownEvent</code> など) には、 <code>player.name</code> プロパティにユーザ名が含まれるようになります。</p>
<pre><code class="language-javascript">const nameTable = {};
g.game.onPlayerInfo.add(ev =&gt; {
  // 各プレイヤーが名前利用許諾のダイアログに応答した時、通知されます。
  // ev.player.name にそのプレイヤーの名前が含まれます。
  // (ev.player.id には (最初から) プレイヤーIDが含まれています)
  nameTable[ev.player.id] = ev.player.name;
});

scene.onPointDownCapture.add(ev =&gt; {
  // onPlayerInfo での通知後、そのプレイヤーが生成したイベントには名前情報が与えられます。
  if (ev.player.name != null) {
    console.log(ev.player.name + &quot; さんが操作しました&quot;);
  }
});

// 以下で名前利用の許諾ダイアログを表示します。
// ただし、この関数はローカルイベント契機でのみ呼び出してください (後述) 。
resolvePlayerInfo({ raises: true });</code></pre>
<h2><a name="api"></a> API</h2>
<p><code>resolvePlayerInfo(opts, callback)</code> は、一つまたは二つの引数をとる関数です。</p>
<p>第一引数 <code>opts</code> は次のプロパティを持つオブジェクトです。</p>
<table>
<thead>
<tr>
<th align="center">プロパティ名</th>
<th align="center">型</th>
<th align="center">デフォルト値</th>
<th align="left">意味</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>raises</code></td>
<td align="center"><code>boolean</code></td>
<td align="center"><code>false</code></td>
<td align="left"><code>true</code> の場合、取得した名前情報で <code>g.PlayerInfoEvent</code> を生成して全体に通知する (<code>g.game.raiseEvent()</code> を呼び出す) 。</td>
</tr>
<tr>
<td align="center"><code>limitSeconds</code></td>
<td align="center"><code>number</code></td>
<td align="center"><code>15</code></td>
<td align="left">名前許諾ダイアログを自動的に閉じるまでの秒数。</td>
</tr>
</tbody></table>
<p>第二引数 <code>callback</code> は、名前取得が完了した時に呼び出されるコールバック関数です。
<strong>この値は <code>raises</code> オプションに <code>true</code> を与える場合には、省略できます</strong> 。
<code>raises</code> オプションの挙動をカスタマイズしたい場合に、 <code>raises</code> を <code>false</code> にして <code>callback</code> を渡してください。</p>
<p><code>callback</code> は、 <code>callback(err, playerInfo)</code> の形で、一つまたは二つの引数で呼び出されます。それぞれの引数は次の内容を持ちます。</p>
<table>
<thead>
<tr>
<th align="center">引数</th>
<th align="center">型</th>
<th align="left">内容</th>
</tr>
</thead>
<tbody><tr>
<td align="center">第一引数 (<code>err</code>)</td>
<td align="center"><code>Error</code> または <code>null</code></td>
<td align="left">名前取得に成功した場合、 <code>null</code> 。<br>失敗した場合、対応する <code>Error</code> 。</td>
</tr>
<tr>
<td align="center">第二引数 (<code>playerInfo</code>)</td>
<td align="center">オブジェクトまたは <code>null</code></td>
<td align="left">取得した名前情報。文字列の <code>name</code> プロパティと補足情報 <code>userData</code> (詳細後述) を持つ。<br><code>err</code> が <code>null</code> でない時、またその時のみ <code>null</code> 。</td>
</tr>
</tbody></table>
<p>プレイヤーの名前は、 <code>callback</code> の第二引数 (<code>playerInfo</code>) を使って、 <code>playerInfo.name</code> でアクセスすることができます。</p>
<p>また <code>playerInfo.userData.accepted</code> が <code>false</code> の場合、そのユーザは名前取得を拒否したユーザです。この時 <code>playerInfo.name</code> は自動生成の文字列または <code>null</code> です。</p>
<p><code>playerInfo.userData.unnamed</code> が <code>true</code> の場合、そのユーザは名前がない特殊なユーザです (サーバサイドで実行されている特殊なインスタンスなど)。通常、 <code>unnamed</code> のユーザが実際にゲームプレイを行うことはありません。特に用途がなければ、このプレイヤーは無視してください。 <code>raises</code> オプションを <code>true</code> にして自動的に名前情報を全体通知する場合にも、 <code>unnamed</code> のプレイヤーは無視されます。</p>
<h3><a name="raises"></a> raises オプションで通知される g.PlayerInfoEvent</h3>
<p><code>raises</code> に <code>true</code> を指定すると、取得した名前情報は自動的に <code>g.PlayerInfoEvent</code> として全プレイヤーに通知されます。このイベントは <code>g.game.onPlayerInfo</code> トリガーで通知されます。</p>
<p><code>onPlayerInfo</code> のハンドラに渡される引数 (<code>ev</code>) は <code>g.PlayerInfoEvent</code> で、これには次のプロパティが含まれます。</p>
<table>
<thead>
<tr>
<th align="center">プロパティ名</th>
<th align="center">型</th>
<th align="left">内容</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>player.id</code></td>
<td align="center"><code>string</code></td>
<td align="left">プレイヤー ID</td>
</tr>
<tr>
<td align="center"><code>player.name</code></td>
<td align="center"><code>string</code> または <code>null</code></td>
<td align="left">そのプレイヤーの名前</td>
</tr>
<tr>
<td align="center"><code>userData.accepted</code></td>
<td align="center"><code>boolean</code></td>
<td align="left">名前取得が許諾されたか。<br> <code>false</code> の場合、名前は自動生成されたものまたは <code>null</code> 。</td>
</tr>
</tbody></table>
<h2><a name="code-example"></a> コード例</h2>
<p>マルチプレイゲーム内で参加ボタンを表示し、押したプレイヤーに名前利用の許諾を求めるコードは、次のようなものになります。</p>
<pre><code class="language-javascript">const resolvePlayerInfo = require(&quot;@akashic-extension/resolve-player-info&quot;)
  .resolvePlayerInfo;

module.exports = () =&gt; {
  const scene = new g.Scene({ game: g.game });
  scene.onLoad.add(() =&gt; {
    const font = new g.DynamicFont({
      game: g.game,
      fontFamily: &quot;sans-serif&quot;,
      size: 15
    });

    // 「参加」ボタン (Label)
    const entryButton = new g.Label({
      scene: scene,
      x: 10,
      y: 10,
      font: font,
      text: &quot;参加&quot;,
      fontSize: 15,
      textColor: &quot;black&quot;,
      local: true, // ローカルエンティティにする
      touchable: true
    });
    entryButton.onPointUp.add(ev =&gt; {
      // 「参加」ボタンを押された時: 参加処理の代わりに名前取得の許諾を求める。
      // プレイヤーがダイアログに応じると、 raiseEvent() で名前情報が全体に通知されるので、
      // onPlayerInfo でそれを受信した時に参加者とする。
      resolvePlayerInfo({ raises: true });
    });
    scene.append(entryButton);

    // 参加者の情報を保持するテーブル
    const playersTable = {};
    g.game.onPlayerInfo.add(ev =&gt; {
      const player = ev.player;
      const anonymous = !ev.userData.accepted;
      playersTable[player.id] = {
        name: player.name, // 名前
        anonymous: anonymous, // 名前利用を拒否したか (自動生成の名前か)
        score: 0 // スコア (例。このコード例では使っていません)
      };
    });

    // 参加を「締め切る」ボタン (Label)
    const startButton = new g.Label({
      scene: scene,
      x: 10,
      y: 10,
      font: font,
      text: &quot;締め切る&quot;,
      fontSize: 15,
      textColor: &quot;black&quot;,
      local: true, // ローカルエンティティにする
      touchable: true
    });
    startButton.onPointUp.add(() =&gt; {
      // 参加が締め切られた。
      // この時点 playersTable に登録されているプレイヤーが「参加者」。
      // 名前が playersTable[(プレイヤーID)].name から参照できる。
      console.log(&quot;参加者情報&quot;, playersTable);

      // 参加者情報を受け取りゲーム部分のシーンを作成する関数 createGameScene()
      // (このコード例では定義していないので各ゲームで作成してください)
      const gameScene = createGameScene(playersTable);
      // それに replaceScene することでゲーム本編を開始する。
      g.game.replaceScene(gameScene);
    });

    g.game.onJoin.add(ev =&gt; {
      const broadcasterPlayerId = ev.player.id; // 放送者のプレイヤーID
      // 自分が放送者なら、「締め切る」ボタンを表示。
      if (g.game.selfId === broadcasterPlayerId) {
        scene.append(startButton);
      }
    });
  });
  g.game.pushScene(scene);
};</code></pre>
<p>なお「ローカルエンティティ」や <code>g.game.raiseEvent()</code> など、Akashic Engine のマルチプレイ関連の機能については、チュートリアルの <a href="https://akashic-games.github.io/tutorial/v3/multiplay/introduction.html">マルチプレイの基礎</a> や <a href="https://akashic-games.github.io/tutorial/v3/multiplay/each-player.html">プレイヤーごとに異なる描画を行う</a> を参照してください。</p>
<h2><a name="limitation"></a> 利用上の制限</h2>
<h3><a name="limitation-scene"></a> 呼び出し中にシーン遷移しない</h3>
<p><code>resolvePlayerInfo()</code> の呼び出し後、 <strong>コールバックが呼び出されるまでの間に、シーン遷移を行わないでください</strong> 。</p>
<p>これは実装に起因する制限です。
一部のタイムアウト判定に <code>scene.setTimeout()</code> が利用されている関係上、シーンを切り替えてしまうと正しく動作しなくなるケースがあります。</p>
<h3><a name="limitation-local"></a> ローカル処理でのみ使う</h3>
<p><code>resolvePlayerInfo()</code> は、 <strong>ローカルイベントの処理 (ローカル処理) 内でのみ利用してください</strong> 。</p>
<p>言い換えると、原則ローカルエンティティ (<code>local: true</code> をつけて生成したもの) の <code>onPointDown</code> や <code>onPointUp</code> のハンドラ内でのみ呼び出すようにしてください。
「ゲーム開始時に強制的に全員のプレイヤー名を取得する」といった使い方はできません。</p>
<p>これは、マルチプレイの参加者が「途中から」ゲーム画面を開く可能性があるためです (ニコ生ゲームの起動中に配信を見始めたなど)。
この時 Akashic Engine は最新フレームに追いつくためゲームを早送りで実行しますが、早送り中に名前取得ダイアログが表示されても操作はできません。
また早送り終了後に仮に名前取得が許諾されて <code>PlayerInfoEvent</code> が通知されても、ゲームは既に参加者募集中ではないなど、状態の混乱が考えられます。
さらに早送り中にシーン切り替えが発生すると、前述の「呼び出し中にシーン遷移しない」に反する可能性があります。</p>
<p>ゲーム開始時に参加者が確定しないゲーム (手番のプレイヤーを都度抽選するなど) の場合は、
「参加者が決まるたびに (名前利用を許諾していなければ) 許諾を促すボタンを表示する」など、「いつ見始めても参加できる」形を検討してください。</p>
<h2><a name="suppl"></a> 細かな補足</h2>
<h3><a name="conflicted-names"></a> 名前の重複</h3>
<p>名前利用を許諾しなかった場合に自動生成される名前 (<code>&quot;ゲスト123&quot;</code> など) は重複する可能性があることに気をつけてください。自動生成に限らず、ユーザ名は重複する可能性があります。</p>
<p>厳密に識別したい場合は、参加順で番号を振る、名前に色をつけて表示するなど、コンテンツ側での対応が必要です。</p>
<h3><a name="atsumaru"></a> ゲームアツマールでの動作</h3>
<p>このライブラリは <a href="https://game.nicovideo.jp/atsumaru/">ゲームアツマール</a> 環境 (アツマール) でも動作します。
ただし名前取得の許諾ダイアログは表示されず、自動的に許諾された扱いになります。
これはアツマールが名前を取得する API を最初から公開しているサービスであるためです。</p>
<h3><a name="old-app"></a> ニコ生アプリのバージョン</h3>
<p>iOS, Android の古いバージョンのニコ生アプリでは、この名前取得機能に対応していない場合があります。
その場合は、アプリの更新を促すダイアログが表示され、自動的に名前利用を許諾しなかった扱いになります (自動生成の名前が通知されます) 。</p>
<div class="navi-center">
<a href="./column-make-multi.html">前 (実際にマルチプレイゲームを考えて作ろう)</a>
 | <a href="./index.html">目次</a>
 | <a href="./submit.html">次 (ニコ生ゲームに投稿しよう)</a>
</div>


			</div>
		</div>
	</section>
	<footer class="safearea--LR">
	<div class="responsive--width">

		<ul class="foot--creativecommons">
			<li class="foot--creativecommons--ban"><a href="http://creativecommons.org/licenses/by/2.1/jp/" target="_blank"><img alt="クリエイティブ・コモンズ・ライセンス" src="https://i.creativecommons.org/l/by/2.1/jp/80x15.png"></a></li>
			<li class="foot--creativecommons--txt">このサイトの画像は、一部を除き <a rel="license" href="http://creativecommons.org/licenses/by/2.1/jp/" target="_blank">クリエイティブ・コモンズ 表示 2.1 日本 ライセンス</a><br>の下に提供されています: <a href="/image-license.html">詳細</a></li>
		</ul>

		<ul class="foot--license">
			<li class="foot--license--akashic"><a href="https://akashic-games.github.io"></a></li>
			<li class="foot--license--dwango"><a href="http://dwango.co.jp" target="_blank">&copy; dwango</a></li>
		</ul>

	</div>
</footer>

</div>
<div class="page--top"></div>
<div class="window--dark"></div>

<script>
	// リサイズ時にコンテンツのリサイズができない状態なので暫定対応でコンテンツをリロードしている
	// TODO: リサイズ時にコンテンツも追従する仕組みを作成する
	window.addEventListener('resize', function() {
		var iframes = document.getElementsByClassName('akashic-content');
		var contents = Array.prototype.slice.call(iframes);
		contents.forEach(function(content) {
			content.contentWindow.location.reload(true);
		});
	});
</script>
</body>
</html>
