(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.engineFilesV2_1_47 = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
module.exports = require('./lib/main.node');
},{"./lib/main.node":2}],2:[function(require,module,exports){
(function() {
"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var g;
(function (g) {
    /**
     * アセット読み込み失敗時のエラーの種別。
     *
     * この値はあくまでもエラーメッセージ出力のための補助情報であり、
     * 網羅性・厳密性を追求したものではないことに注意。
     */
    var AssetLoadErrorType;
    (function (AssetLoadErrorType) {
        /**
         * 明示されていない(以下のいずれかかもしれないし、そうでないかもしれない)。
         */
        AssetLoadErrorType[AssetLoadErrorType["Unspecified"] = 0] = "Unspecified";
        /**
         * エンジンの再試行回数上限設定値を超えた。
         */
        AssetLoadErrorType[AssetLoadErrorType["RetryLimitExceeded"] = 1] = "RetryLimitExceeded";
        /**
         * ネットワークエラー。タイムアウトなど。
         */
        AssetLoadErrorType[AssetLoadErrorType["NetworkError"] = 2] = "NetworkError";
        /**
         * リクエストに問題があるエラー。HTTP 4XX など。
         */
        AssetLoadErrorType[AssetLoadErrorType["ClientError"] = 3] = "ClientError";
        /**
         * サーバ側のエラー。HTTP 5XX など。
         */
        AssetLoadErrorType[AssetLoadErrorType["ServerError"] = 4] = "ServerError";
    })(AssetLoadErrorType = g.AssetLoadErrorType || (g.AssetLoadErrorType = {}));
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 例外生成ファクトリ。
     * エンジン内部での例外生成に利用するもので、ゲーム開発者は通常本モジュールを利用する必要はない。
     */
    var ExceptionFactory;
    (function (ExceptionFactory) {
        function createAssertionError(message, cause) {
            var e = new Error(message);
            e.name = "AssertionError";
            e.cause = cause;
            return e;
        }
        ExceptionFactory.createAssertionError = createAssertionError;
        function createTypeMismatchError(methodName, expected, actual, cause) {
            var message = "Type mismatch on " + methodName + ","
                + " expected type is " + expected;
            if (arguments.length > 2) { // actual 指定時
                try {
                    var actualString;
                    if (actual && actual.constructor && actual.constructor.name) {
                        actualString = actual.constructor.name;
                    }
                    else {
                        actualString = typeof actual;
                    }
                    message += ", actual type is "
                        + (actualString.length > 40 ? actualString.substr(0, 40) : actualString);
                }
                catch (ex) {
                    // メッセージ取得時に例外が発生したらactualの型情報出力はあきらめる
                }
            }
            message += ".";
            var e = new Error(message);
            e.name = "TypeMismatchError";
            e.cause = cause;
            e.expected = expected;
            e.actual = actual;
            return e;
        }
        ExceptionFactory.createTypeMismatchError = createTypeMismatchError;
        function createAssetLoadError(message, retriable, type, cause) {
            if (retriable === void 0) { retriable = true; }
            if (type === void 0) { type = g.AssetLoadErrorType.Unspecified; }
            var e = new Error(message);
            e.name = "AssetLoadError";
            e.cause = cause;
            e.retriable = retriable;
            e.type = type;
            return e;
        }
        ExceptionFactory.createAssetLoadError = createAssetLoadError;
    })(ExceptionFactory = g.ExceptionFactory || (g.ExceptionFactory = {}));
})(g || (g = {}));
var g;
(function (g) {
    /**
     * リソースの生成を行うクラス。
     *
     * このクラス (の実装クラス) のインスタンスはエンジンによって生成される。ゲーム開発者が生成する必要はない。
     * またこのクラスの各種アセット生成メソッドは、エンジンによって暗黙に呼び出されるものである。
     * 通常ゲーム開発者が呼び出す必要はない。
     */
    var ResourceFactory = /** @class */ (function () {
        function ResourceFactory() {
        }
        ResourceFactory.prototype.createSurfaceAtlas = function (width, height) {
            return new g.SurfaceAtlas(this.createSurface(width, height));
        };
        /**
         * 指定Surfaceから指定範囲を切り取ったSurfaceを返す。
         * 範囲を指定しない場合は、指定SurfaceをコピーしたSurfaceを返す。
         */
        ResourceFactory.prototype.createTrimmedSurface = function (targetSurface, targetArea) {
            var area = targetArea || { x: 0, y: 0, width: targetSurface.width, height: targetSurface.height };
            var surface = this.createSurface(area.width, area.height);
            var renderer = surface.renderer();
            renderer.begin();
            renderer.drawImage(targetSurface, area.x, area.y, area.width, area.height, 0, 0);
            renderer.end();
            return surface;
        };
        return ResourceFactory;
    }());
    g.ResourceFactory = ResourceFactory;
})(g || (g = {}));
var g;
(function (g) {
    var RequireCachedValue = /** @class */ (function () {
        function RequireCachedValue(value) {
            this._value = value;
        }
        /**
         * @private
         */
        RequireCachedValue.prototype._cachedValue = function () {
            return this._value;
        };
        return RequireCachedValue;
    }());
    g.RequireCachedValue = RequireCachedValue;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 乱数生成器。
     * `RandomGenerator#get()` によって、新しい乱数を生成することができる。
     */
    var RandomGenerator = /** @class */ (function () {
        function RandomGenerator(seed) {
            this.seed = seed;
            this[0] = this;
        }
        return RandomGenerator;
    }());
    g.RandomGenerator = RandomGenerator;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 各種リソースを表すクラス。
     * 本クラスのインスタンスをゲーム開発者が直接生成することはない。
     * game.jsonによって定義された内容をもとに暗黙的に生成されたインスタンスを、
     * Scene#assets、またはGame#assetsによって取得して利用する。
     */
    var Asset = /** @class */ (function () {
        function Asset(id, path) {
            this.id = id;
            this.originalPath = path;
            this.path = this._assetPathFilter(path);
            this.onDestroyed = new g.Trigger();
        }
        Asset.prototype.destroy = function () {
            this.onDestroyed.fire(this);
            this.id = undefined;
            this.originalPath = undefined;
            this.path = undefined;
            this.onDestroyed.destroy();
            this.onDestroyed = undefined;
        };
        Asset.prototype.destroyed = function () {
            return this.id === undefined;
        };
        /**
         * 現在利用中で解放出来ない `Asset` かどうかを返す。
         * 戻り値は、利用中である場合真、でなければ偽である。
         *
         * 本メソッドは通常 `false` が返るべきである。
         * 例えば `Sprite` の元画像として使われているケース等では、その `Sprite` によって `Asset` は `Surface` に変換されているべきで、
         * `Asset` が利用中で解放出来ない状態になっていない事を各プラットフォームで保障する必要がある。
         *
         * 唯一、例外的に本メソッドが `true` を返すことがあるのは音楽を表す `Asset` である。
         * BGM等はシーンをまたいで演奏することもありえる上、
         * 演奏中のリソースのコピーを常に各プラットフォームに強制するにはコストがかかりすぎるため、
         * 本メソッドは `true` を返し、適切なタイミングで `Asset` が解放されるよう制御する必要がある。
         */
        Asset.prototype.inUse = function () {
            return false;
        };
        /**
         * @private
         */
        Asset.prototype._assetPathFilter = function (path) {
            // 拡張子の補完・読み替えが必要なassetはこれをオーバーライドすればよい。(対応形式が限定されるaudioなどの場合)
            return path;
        };
        return Asset;
    }());
    g.Asset = Asset;
    /**
     * 画像リソースを表すクラス。
     * 本クラスのインスタンスをゲーム開発者が直接生成することはない。
     * game.jsonによって定義された内容をもとに暗黙的に生成されたインスタンスを、
     * Scene#assets、またはGame#assetsによって取得して利用する。
     *
     * width, heightでメタデータとして画像の大きさをとることは出来るが、
     * ゲーム開発者はそれ以外の情報を本クラスから直接は取得せず、Sprite等に本リソースを指定して利用する。
     */
    var ImageAsset = /** @class */ (function (_super) {
        __extends(ImageAsset, _super);
        function ImageAsset(id, assetPath, width, height) {
            var _this = _super.call(this, id, assetPath) || this;
            _this.width = width;
            _this.height = height;
            return _this;
        }
        ImageAsset.prototype.initialize = function (hint) {
            this.hint = hint;
        };
        return ImageAsset;
    }(Asset));
    g.ImageAsset = ImageAsset;
    /**
     * 動画リソースを表すクラス。
     * 本クラスのインスタンスをゲーム開発者が直接生成することはない。
     * game.jsonによって定義された内容をもとに暗黙的に生成されたインスタンスを、
     * Scene#assets、またはGame#assetsによって取得して利用する。
     */
    var VideoAsset = /** @class */ (function (_super) {
        __extends(VideoAsset, _super);
        function VideoAsset(id, assetPath, width, height, system, loop, useRealSize) {
            var _this = _super.call(this, id, assetPath, width, height) || this;
            _this.realWidth = 0;
            _this.realHeight = 0;
            _this._system = system;
            _this._loop = loop;
            _this._useRealSize = useRealSize;
            return _this;
        }
        VideoAsset.prototype.play = function (loop) {
            this.getPlayer().play(this);
            return this.getPlayer();
        };
        VideoAsset.prototype.stop = function () {
            this.getPlayer().stop();
        };
        VideoAsset.prototype.destroy = function () {
            this._system = undefined;
            _super.prototype.destroy.call(this);
        };
        return VideoAsset;
    }(ImageAsset));
    g.VideoAsset = VideoAsset;
    /**
     * 音リソースを表すクラス。
     * 本クラスのインスタンスをゲーム開発者が直接生成することはない。
     * game.jsonによって定義された内容をもとに暗黙的に生成されたインスタンスを、
     * Scene#assets、またはGame#assetsによって取得して利用する。
     *
     * AudioAsset#playを呼び出す事で、その音を再生することが出来る。
     */
    var AudioAsset = /** @class */ (function (_super) {
        __extends(AudioAsset, _super);
        function AudioAsset(id, assetPath, duration, system, loop, hint) {
            var _this = _super.call(this, id, assetPath) || this;
            _this.duration = duration;
            _this.loop = loop;
            _this.hint = hint;
            _this._system = system;
            _this.data = undefined;
            return _this;
        }
        AudioAsset.prototype.play = function () {
            var player = this._system.createPlayer();
            player.play(this);
            this._lastPlayedPlayer = player;
            return player;
        };
        AudioAsset.prototype.stop = function () {
            var players = this._system.findPlayers(this);
            for (var i = 0; i < players.length; ++i)
                players[i].stop();
        };
        AudioAsset.prototype.inUse = function () {
            return this._system.findPlayers(this).length > 0;
        };
        AudioAsset.prototype.destroy = function () {
            if (this._system)
                this.stop();
            this.data = undefined;
            this._system = undefined;
            this._lastPlayedPlayer = undefined;
            _super.prototype.destroy.call(this);
        };
        return AudioAsset;
    }(Asset));
    g.AudioAsset = AudioAsset;
    /**
     * 文字列リソースを表すクラス。
     * 本クラスのインスタンスをゲーム開発者が直接生成することはない。
     * game.jsonによって定義された内容をもとに暗黙的に生成されたインスタンスを、
     * Scene#assets、またはGame#assetsによって取得して利用する。
     *
     * TextAsset#dataによって、本リソースが保持する文字列を取得することが出来る。
     */
    var TextAsset = /** @class */ (function (_super) {
        __extends(TextAsset, _super);
        function TextAsset(id, assetPath) {
            var _this = _super.call(this, id, assetPath) || this;
            _this.data = undefined;
            return _this;
        }
        TextAsset.prototype.destroy = function () {
            this.data = undefined;
            _super.prototype.destroy.call(this);
        };
        return TextAsset;
    }(Asset));
    g.TextAsset = TextAsset;
    /**
     * スクリプトリソースを表すクラス。
     * 本クラスのインスタンスをゲーム開発者が直接生成することはない。
     * game.jsonによって定義された内容をもとに暗黙的に生成されたインスタンスを、
     * Scene#assets、またはGame#assetsによって取得して利用する。
     *
     * ScriptAsset#executeによって、本リソースが表すスクリプトを実行し、その結果を受け取る事が出来る。
     * requireによる参照とは異なり、executeはキャッシュされないため、何度でも呼び出し違う結果を受け取ることが出来る。
     */
    var ScriptAsset = /** @class */ (function (_super) {
        __extends(ScriptAsset, _super);
        function ScriptAsset() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        ScriptAsset.prototype.destroy = function () {
            this.script = undefined;
            _super.prototype.destroy.call(this);
        };
        return ScriptAsset;
    }(Asset));
    g.ScriptAsset = ScriptAsset;
})(g || (g = {}));
var g;
(function (g) {
    var AssetLoadingInfo = /** @class */ (function () {
        function AssetLoadingInfo(asset, handler) {
            this.asset = asset;
            this.handlers = [handler];
            this.errorCount = 0;
            this.loading = false;
        }
        return AssetLoadingInfo;
    }());
    function normalizeAudioSystemConfMap(confMap) {
        confMap = confMap || {};
        var systemDefaults = {
            music: {
                loop: true,
                hint: { streaming: true }
            },
            sound: {
                loop: false,
                hint: { streaming: false }
            }
        };
        for (var key in systemDefaults) {
            if (!(key in confMap)) {
                confMap[key] = systemDefaults[key];
            }
        }
        return confMap;
    }
    /**
     * `Asset` を管理するクラス。
     *
     * このクラスのインスタンスは `Game` に一つデフォルトで存在する(デフォルトアセットマネージャ)。
     * デフォルトアセットマネージャは、game.json に記述された通常のアセットを読み込むために利用される。
     *
     * ゲーム開発者は、game.json に記述のないリソースを取得するために、このクラスのインスタンスを独自に生成してよい。
     */
    var AssetManager = /** @class */ (function () {
        /**
         * `AssetManager` のインスタンスを生成する。
         *
         * @param game このインスタンスが属するゲーム
         * @param conf このアセットマネージャに与えるアセット定義。game.json の `"assets"` に相当。
         */
        function AssetManager(game, conf, audioSystemConfMap, moduleMainScripts) {
            this.game = game;
            this.configuration = this._normalize(conf || {}, normalizeAudioSystemConfMap(audioSystemConfMap));
            this._assets = {};
            this._liveAssetVirtualPathTable = {};
            this._liveAbsolutePathTable = {};
            this._moduleMainScripts = moduleMainScripts ? moduleMainScripts : {};
            this._refCounts = {};
            this._loadings = {};
        }
        /**
         * このインスタンスを破棄する。
         */
        AssetManager.prototype.destroy = function () {
            var assetIds = Object.keys(this._refCounts);
            for (var i = 0; i < assetIds.length; ++i) {
                this._releaseAsset(assetIds[i]);
            }
            this.game = undefined;
            this.configuration = undefined;
            this._assets = undefined;
            this._liveAssetVirtualPathTable = undefined;
            this._liveAbsolutePathTable = undefined;
            this._refCounts = undefined;
            this._loadings = undefined;
        };
        /**
         * このインスタンスが破棄済みであるかどうかを返す。
         */
        AssetManager.prototype.destroyed = function () {
            return this.game === undefined;
        };
        /**
         * `Asset` の読み込みを再試行する。
         *
         * 引数 `asset` は読み込みの失敗が (`Scene#assetLoadFail` で) 通知されたアセットでなければならない。
         * @param asset 読み込みを再試行するアセット
         */
        AssetManager.prototype.retryLoad = function (asset) {
            if (!this._loadings.hasOwnProperty(asset.id))
                throw g.ExceptionFactory.createAssertionError("AssetManager#retryLoad: invalid argument.");
            var loadingInfo = this._loadings[asset.id];
            if (loadingInfo.errorCount > AssetManager.MAX_ERROR_COUNT) {
                // DynamicAsset はエラーが規定回数超えた場合は例外にせず諦める。
                if (!this.configuration[asset.id])
                    return;
                throw g.ExceptionFactory.createAssertionError("AssetManager#retryLoad: too many retrying.");
            }
            if (!loadingInfo.loading) {
                loadingInfo.loading = true;
                asset._load(this);
            }
        };
        /**
         * このインスタンスに与えられた `AssetConfigurationMap` のうち、グローバルアセットのIDをすべて返す。
         */
        AssetManager.prototype.globalAssetIds = function () {
            var ret = [];
            var conf = this.configuration;
            for (var p in conf) {
                if (!conf.hasOwnProperty(p))
                    continue;
                if (conf[p].global)
                    ret.push(p);
            }
            return ret;
        };
        /**
         * アセットの取得を要求する。
         *
         * 要求したアセットが読み込み済みでない場合、読み込みが行われる。
         * 取得した結果は `handler` を通して通知される。
         * ゲーム開発者はこのメソッドを呼び出してアセットを取得した場合、
         * 同じアセットID(または取得したアセット)で `unrefAsset()` を呼び出さなければならない。
         *
         * @param assetIdOrConf 要求するアセットのIDまたは設定
         * @param handler 要求結果を受け取るハンドラ
         */
        AssetManager.prototype.requestAsset = function (assetIdOrConf, handler) {
            var assetId = (typeof assetIdOrConf === "string") ? assetIdOrConf : assetIdOrConf.id;
            var waiting = false;
            var loadingInfo;
            if (this._assets.hasOwnProperty(assetId)) {
                ++this._refCounts[assetId];
                handler._onAssetLoad(this._assets[assetId]);
            }
            else if (this._loadings.hasOwnProperty(assetId)) {
                loadingInfo = this._loadings[assetId];
                loadingInfo.handlers.push(handler);
                ++this._refCounts[assetId];
                waiting = true;
            }
            else {
                var a = this._createAssetFor(assetIdOrConf);
                loadingInfo = new AssetLoadingInfo(a, handler);
                this._loadings[assetId] = loadingInfo;
                this._refCounts[assetId] = 1;
                waiting = true;
                loadingInfo.loading = true;
                a._load(this);
            }
            return waiting;
        };
        /**
         * アセットの参照カウントを減らす。
         * 引数の各要素で `unrefAsset()` を呼び出す。
         *
         * @param assetOrId 参照カウントを減らすアセットまたはアセットID
         */
        AssetManager.prototype.unrefAsset = function (assetOrId) {
            var assetId = (typeof assetOrId === "string") ? assetOrId : assetOrId.id;
            if (--this._refCounts[assetId] > 0)
                return;
            this._releaseAsset(assetId);
        };
        /**
         * 複数のアセットの取得を要求する。
         * 引数の各要素で `requestAsset()` を呼び出す。
         *
         * @param assetIdOrConfs 取得するアセットのIDまたはアセット定義
         * @param handler 取得の結果を受け取るハンドラ
         */
        AssetManager.prototype.requestAssets = function (assetIdOrConfs, handler) {
            var waitingCount = 0;
            for (var i = 0, len = assetIdOrConfs.length; i < len; ++i) {
                if (this.requestAsset(assetIdOrConfs[i], handler)) {
                    ++waitingCount;
                }
            }
            return waitingCount;
        };
        /**
         * 複数のアセットを解放する。
         * 引数の各要素で `unrefAsset()` を呼び出す。
         *
         * @param assetOrIds 参照カウントを減らすアセットまたはアセットID
         * @private
         */
        AssetManager.prototype.unrefAssets = function (assetOrIds) {
            for (var i = 0, len = assetOrIds.length; i < len; ++i) {
                this.unrefAsset(assetOrIds[i]);
            }
        };
        AssetManager.prototype._normalize = function (configuration, audioSystemConfMap) {
            var ret = {};
            if (!(configuration instanceof Object))
                throw g.ExceptionFactory.createAssertionError("AssetManager#_normalize: invalid arguments.");
            for (var p in configuration) {
                if (!configuration.hasOwnProperty(p))
                    continue;
                var conf = Object.create(configuration[p]);
                if (!conf.path) {
                    throw g.ExceptionFactory.createAssertionError("AssetManager#_normalize: No path given for: " + p);
                }
                if (!conf.virtualPath) {
                    throw g.ExceptionFactory.createAssertionError("AssetManager#_normalize: No virtualPath given for: " + p);
                }
                if (!conf.type) {
                    throw g.ExceptionFactory.createAssertionError("AssetManager#_normalize: No type given for: " + p);
                }
                if (conf.type === "image") {
                    if (typeof conf.width !== "number")
                        throw g.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the image asset: " + p);
                    if (typeof conf.height !== "number")
                        throw g.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the image asset: " + p);
                }
                if (conf.type === "audio") {
                    // durationというメンバは後から追加したため、古いgame.jsonではundefinedになる場合がある
                    if (conf.duration === undefined)
                        conf.duration = 0;
                    var audioSystemConf = audioSystemConfMap[conf.systemId];
                    if (conf.loop === undefined) {
                        conf.loop = !!audioSystemConf && !!audioSystemConf.loop;
                    }
                    if (conf.hint === undefined) {
                        conf.hint = audioSystemConf ? audioSystemConf.hint : {};
                    }
                }
                if (conf.type === "video") {
                    if (!conf.useRealSize) {
                        if (typeof conf.width !== "number")
                            throw g.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the video asset: " + p);
                        if (typeof conf.height !== "number")
                            throw g.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the video asset: " + p);
                        conf.useRealSize = false;
                    }
                }
                if (!conf.global)
                    conf.global = false;
                ret[p] = conf;
            }
            return ret;
        };
        /**
         * @private
         */
        AssetManager.prototype._createAssetFor = function (idOrConf) {
            var id;
            var uri;
            var conf;
            if (typeof idOrConf === "string") {
                id = idOrConf;
                conf = this.configuration[id];
                uri = this.configuration[id].path;
            }
            else {
                var dynConf = idOrConf;
                id = dynConf.id;
                conf = dynConf;
                uri = dynConf.uri;
            }
            var resourceFactory = this.game.resourceFactory;
            if (!conf)
                throw g.ExceptionFactory.createAssertionError("AssetManager#_createAssetFor: unknown asset ID: " + id);
            switch (conf.type) {
                case "image":
                    var asset = resourceFactory.createImageAsset(id, uri, conf.width, conf.height);
                    asset.initialize(conf.hint);
                    return asset;
                case "audio":
                    var system = conf.systemId ? this.game.audio[conf.systemId] : this.game.audio[this.game.defaultAudioSystemId];
                    return resourceFactory.createAudioAsset(id, uri, conf.duration, system, conf.loop, conf.hint);
                case "text":
                    return resourceFactory.createTextAsset(id, uri);
                case "script":
                    return resourceFactory.createScriptAsset(id, uri);
                case "video":
                    // VideoSystemはまだ中身が定義されていなが、将来のためにVideoAssetにVideoSystemを渡すという体裁だけが整えられている。
                    // 以上を踏まえ、ここでは簡単のために都度新たなVideoSystemインスタンスを生成している。
                    return resourceFactory.createVideoAsset(id, uri, conf.width, conf.height, new g.VideoSystem(), conf.loop, conf.useRealSize);
                default:
                    throw g.ExceptionFactory.createAssertionError("AssertionError#_createAssetFor: unknown asset type " + conf.type + " for asset ID: " + id);
            }
        };
        AssetManager.prototype._releaseAsset = function (assetId) {
            var asset = this._assets[assetId] || (this._loadings[assetId] && this._loadings[assetId].asset);
            var path;
            if (asset) {
                path = asset.path;
                if (asset.inUse()) {
                    if (asset instanceof g.AudioAsset) {
                        asset._system.requestDestroy(asset);
                    }
                    else if (asset instanceof g.VideoAsset) {
                        // NOTE: 一旦再生完了を待たずに破棄することにする
                        // TODO: 再生中の動画を破棄するタイミングをどのように扱うか検討し実装
                        asset.destroy();
                    }
                    else {
                        throw g.ExceptionFactory.createAssertionError("AssetManager#unrefAssets: Unsupported in-use " + asset.id);
                    }
                }
                else {
                    asset.destroy();
                }
            }
            delete this._refCounts[assetId];
            delete this._loadings[assetId];
            delete this._assets[assetId];
            if (this.configuration[assetId]) {
                var virtualPath = this.configuration[assetId].virtualPath;
                if (virtualPath && this._liveAssetVirtualPathTable.hasOwnProperty(virtualPath))
                    delete this._liveAssetVirtualPathTable[virtualPath];
                if (path && this._liveAbsolutePathTable.hasOwnProperty(path))
                    delete this._liveAbsolutePathTable[path];
            }
        };
        /**
         * 現在ロード中のアセットの数。(デバッグ用; 直接の用途はない)
         * @private
         */
        AssetManager.prototype._countLoadingAsset = function () {
            return Object.keys(this._loadings).length;
        };
        /**
         * @private
         */
        AssetManager.prototype._onAssetError = function (asset, error) {
            // ロード中に Scene が破棄されていた場合などで、asset が破棄済みになることがある
            if (this.destroyed() || asset.destroyed())
                return;
            var loadingInfo = this._loadings[asset.id];
            var hs = loadingInfo.handlers;
            loadingInfo.loading = false;
            ++loadingInfo.errorCount;
            if (loadingInfo.errorCount > AssetManager.MAX_ERROR_COUNT && error.retriable) {
                error = g.ExceptionFactory.createAssetLoadError("Retry limit exceeded", false, g.AssetLoadErrorType.RetryLimitExceeded, error);
            }
            if (!error.retriable)
                delete this._loadings[asset.id];
            for (var i = 0; i < hs.length; ++i)
                hs[i]._onAssetError(asset, error, this);
        };
        /**
         * @private
         */
        AssetManager.prototype._onAssetLoad = function (asset) {
            // ロード中に Scene が破棄されていた場合などで、asset が破棄済みになることがある
            if (this.destroyed() || asset.destroyed())
                return;
            var loadingInfo = this._loadings[asset.id];
            loadingInfo.loading = false;
            delete this._loadings[asset.id];
            this._assets[asset.id] = asset;
            // DynamicAsset の場合は configuration に書かれていないので以下の判定が偽になる
            if (this.configuration[asset.id]) {
                var virtualPath = this.configuration[asset.id].virtualPath;
                if (!this._liveAssetVirtualPathTable.hasOwnProperty(virtualPath)) {
                    this._liveAssetVirtualPathTable[virtualPath] = asset;
                }
                else {
                    if (this._liveAssetVirtualPathTable[virtualPath].path !== asset.path)
                        throw g.ExceptionFactory.createAssertionError("AssetManager#_onAssetLoad(): duplicated asset path");
                }
                if (!this._liveAbsolutePathTable.hasOwnProperty(asset.path))
                    this._liveAbsolutePathTable[asset.path] = virtualPath;
            }
            var hs = loadingInfo.handlers;
            for (var i = 0; i < hs.length; ++i)
                hs[i]._onAssetLoad(asset);
        };
        AssetManager.MAX_ERROR_COUNT = 3;
        return AssetManager;
    }());
    g.AssetManager = AssetManager;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * node.js の require() ライクな読み込み処理を行い、その結果を返す。
     *
     * node.jsのrequireに限りなく近いモデルでrequireする。
     * ただしアセットIDで該当すればそちらを優先する。また node.js のコアモジュールには対応していない。
     * 通常、ゲーム開発者が利用するのは `Module#require()` であり、このメソッドはその内部実装を提供する。
     * @param game requireを実行するコンテキストを表すGameインスタンス
     * @param path requireのパス。相対パスと、Asset識別名を利用することが出来る。
     *              なお、./xxx.json のようにjsonを指定する場合、そのAssetはTextAssetである必要がある。
     *              その他の形式である場合、そのAssetはScriptAssetである必要がある。
     * @param currentModule このrequireを実行した Module
     * @returns {any} スクリプト実行結果。通常はScriptAsset#executeの結果。
     *                 例外的に、jsonであればTextAsset#dataをJSON.parseした結果が返る
     */
    function _require(game, path, currentModule) {
        // Node.js の require の挙動については http://nodejs.jp/nodejs.org_ja/api/modules.html も参照。
        var targetScriptAsset;
        var resolvedPath;
        var liveAssetVirtualPathTable = game._assetManager._liveAssetVirtualPathTable;
        var moduleMainScripts = game._assetManager._moduleMainScripts;
        // 0. アセットIDらしい場合はまず当該アセットを探す
        if (path.indexOf("/") === -1) {
            if (game._assetManager._assets.hasOwnProperty(path)) {
                targetScriptAsset = game._assetManager._assets[path];
                resolvedPath = game._assetManager._liveAbsolutePathTable[targetScriptAsset.path];
            }
        }
        // 1. If X is a core module,
        // (何もしない。コアモジュールには対応していない。ゲーム開発者は自分でコアモジュールへの依存を解決する必要がある)
        if (/^\.\/|^\.\.\/|^\//.test(path)) {
            // 2. If X begins with './' or '/' or '../'
            if (currentModule) {
                if (!currentModule._virtualDirname)
                    throw g.ExceptionFactory.createAssertionError("g._require: require from DynamicAsset is not supported");
                resolvedPath = g.PathUtil.resolvePath(currentModule._virtualDirname, path);
            }
            else {
                if (!(/^\.\//.test(path)))
                    throw g.ExceptionFactory.createAssertionError("g._require: entry point path must start with './'");
                resolvedPath = path.substring(2);
            }
            if (game._scriptCaches.hasOwnProperty(resolvedPath)) {
                return game._scriptCaches[resolvedPath]._cachedValue();
            }
            else if (game._scriptCaches.hasOwnProperty(resolvedPath + ".js")) {
                return game._scriptCaches[resolvedPath + ".js"]._cachedValue();
            }
            // 2.a. LOAD_AS_FILE(Y + X)
            if (!targetScriptAsset)
                targetScriptAsset = g.Util.findAssetByPathAsFile(resolvedPath, liveAssetVirtualPathTable);
            // 2.b. LOAD_AS_DIRECTORY(Y + X)
            if (!targetScriptAsset)
                targetScriptAsset = g.Util.findAssetByPathAsDirectory(resolvedPath, liveAssetVirtualPathTable);
        }
        else {
            // 3. LOAD_NODE_MODULES(X, dirname(Y))
            // `path` は node module の名前であると仮定して探す
            // akashic-engine独自仕様: 対象の `path` が `moduleMainScripts` に指定されていたらそちらを参照する
            if (moduleMainScripts[path]) {
                resolvedPath = moduleMainScripts[path];
                targetScriptAsset = game._assetManager._liveAssetVirtualPathTable[resolvedPath];
            }
            if (!targetScriptAsset) {
                var dirs = currentModule ? currentModule.paths : [];
                dirs.push("node_modules");
                for (var i = 0; i < dirs.length; ++i) {
                    var dir = dirs[i];
                    resolvedPath = g.PathUtil.resolvePath(dir, path);
                    targetScriptAsset = g.Util.findAssetByPathAsFile(resolvedPath, liveAssetVirtualPathTable);
                    if (targetScriptAsset)
                        break;
                    targetScriptAsset = g.Util.findAssetByPathAsDirectory(resolvedPath, liveAssetVirtualPathTable);
                    if (targetScriptAsset)
                        break;
                }
            }
        }
        if (targetScriptAsset) {
            if (game._scriptCaches.hasOwnProperty(resolvedPath))
                return game._scriptCaches[resolvedPath]._cachedValue();
            if (targetScriptAsset instanceof g.ScriptAsset) {
                var context = new g.ScriptAssetContext(game, targetScriptAsset);
                game._scriptCaches[resolvedPath] = context;
                return context._executeScript(currentModule);
            }
            else if (targetScriptAsset instanceof g.TextAsset) {
                // JSONの場合の特殊挙動をトレースするためのコード。node.jsの仕様に準ずる
                if (targetScriptAsset && g.PathUtil.resolveExtname(path) === ".json") {
                    // Note: node.jsではここでBOMの排除をしているが、いったんakashicでは排除しないで実装
                    var cache = game._scriptCaches[resolvedPath] = new g.RequireCachedValue(JSON.parse(targetScriptAsset.data));
                    return cache._cachedValue();
                }
            }
        }
        throw g.ExceptionFactory.createAssertionError("g._require: can not find module: " + path);
    }
    g._require = _require;
    /**
     * Node.js が提供する module の互換クラス。
     */
    var Module = /** @class */ (function () {
        function Module(game, id, path) {
            var _this = this;
            var dirname = g.PathUtil.resolveDirname(path);
            // `virtualPath` と `virtualDirname` は　`DynamicAsset` の場合は `undefined` になる。
            var virtualPath = game._assetManager._liveAbsolutePathTable[path];
            var virtualDirname = virtualPath ? g.PathUtil.resolveDirname(virtualPath) : undefined;
            var _g = Object.create(g, {
                game: {
                    value: game,
                    enumerable: true
                },
                filename: {
                    value: path,
                    enumerable: true
                },
                dirname: {
                    value: dirname,
                    enumerable: true
                },
                module: {
                    value: this,
                    writable: true,
                    enumerable: true,
                    configurable: true
                }
            });
            this.id = id;
            this.filename = path;
            this.exports = {};
            this.parent = null; // Node.js と互換
            this.loaded = false;
            this.children = [];
            this.paths = virtualDirname ? g.PathUtil.makeNodeModulePaths(virtualDirname) : [];
            this._dirname = dirname;
            this._virtualDirname = virtualDirname;
            this._g = _g;
            // メソッドとしてではなく単体で呼ばれるのでメソッドにせずここで実体を代入する
            this.require = function (path) {
                return (path === "g") ? _g : g._require(game, path, _this);
            };
        }
        return Module;
    }());
    g.Module = Module;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * `ScriptAsset` の実行コンテキスト。
     * 通常スクリプトアセットを実行するためにはこのクラスを経由する。
     *
     * ゲーム開発者がこのクラスを利用する必要はない。
     * スクリプトアセットを実行する場合は、暗黙にこのクラスを利用する `require()` を用いること。
     */
    var ScriptAssetContext = /** @class */ (function () {
        function ScriptAssetContext(game, asset) {
            this._game = game;
            this._asset = asset;
            this._module = new g.Module(game, asset.path, asset.path);
            this._g = this._module._g;
            this._started = false;
        }
        /**
         * @private
         */
        ScriptAssetContext.prototype._cachedValue = function () {
            if (!this._started)
                throw g.ExceptionFactory.createAssertionError("ScriptAssetContext#_cachedValue: not executed yet.");
            return this._module.exports;
        };
        /**
         * @private
         */
        ScriptAssetContext.prototype._executeScript = function (currentModule) {
            if (this._started)
                return this._module.exports;
            if (currentModule) {
                // Node.js 互換挙動: Module#parent は一番最初に require() した module になる
                this._module.parent = currentModule;
                // Node.js 互換挙動: 親 module の children には自身が実行中の段階で既に追加されている
                currentModule.children.push(this._module);
            }
            this._started = true;
            this._asset.execute(this._g);
            this._module.loaded = true;
            return this._module.exports;
        };
        return ScriptAssetContext;
    }());
    g.ScriptAssetContext = ScriptAssetContext;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 変換行列を一般的なJavaScriptのみで表したクラス。
     * 通常ゲーム開発者が本クラスを直接利用する事はない。
     * 各フィールド、メソッドの詳細は `Matrix` インターフェースの説明を参照。
     */
    var PlainMatrix = /** @class */ (function () {
        function PlainMatrix(widthOrSrc, height, scaleX, scaleY, angle, anchorX, anchorY) {
            // TODO: (GAMEDEV-845) Float32Arrayの方が速いらしいので、polyfillして使うかどうか検討
            if (widthOrSrc === undefined) {
                this._modified = false;
                this._matrix = [1, 0, 0, 1, 0, 0];
            }
            else if (typeof widthOrSrc === "number") {
                this._modified = false;
                this._matrix = new Array(6);
                if (anchorX != null && anchorY != null) {
                    this.updateWithAnchor(widthOrSrc, height, scaleX, scaleY, angle, 0, 0, anchorX, anchorY);
                }
                else {
                    this.update(widthOrSrc, height, scaleX, scaleY, angle, 0, 0);
                }
            }
            else {
                this._modified = widthOrSrc._modified;
                this._matrix = [
                    widthOrSrc._matrix[0],
                    widthOrSrc._matrix[1],
                    widthOrSrc._matrix[2],
                    widthOrSrc._matrix[3],
                    widthOrSrc._matrix[4],
                    widthOrSrc._matrix[5]
                ];
            }
        }
        PlainMatrix.prototype.update = function (width, height, scaleX, scaleY, angle, x, y) {
            // ここで求める変換行列Mは、引数で指定された変形を、拡大・回転・平行移動の順に適用するものである。
            // 変形の原点は引数で指定された矩形の中心、すなわち (width/2, height/2) の位置である。従って
            //    M = A^-1 T R S A
            // である。ただしここでA, S, R, Tは、それぞれ以下を表す変換行列である:
            //    A: 矩形の中心を原点に移す(平行移動する)変換
            //    S: X軸方向にscaleX倍、Y軸方向にscaleY倍する変換
            //    R: angle度だけ回転する変換
            //    T: x, yの値だけ平行移動する変換
            // それらは次のように表せる:
            //           1    0   -w           sx    0    0            c   -s    0            1    0    x
            //    A = [  0    1   -h]    S = [  0   sy    0]    R = [  s    c    0]    T = [  0    1    y]
            //           0    0    1            0    0    1            0    0    1            0    0    1
            // ここで sx, sy は scaleX, scaleY であり、c, s は cos(theta), sin(theta)
            // (ただし theta = angle * PI / 180)、w = (width / 2), h = (height / 2) である。
            // 以下の実装は、M の各要素をそれぞれ計算して直接求めている。
            var r = angle * Math.PI / 180;
            var _cos = Math.cos(r);
            var _sin = Math.sin(r);
            var a = _cos * scaleX;
            var b = _sin * scaleX;
            var c = _sin * scaleY;
            var d = _cos * scaleY;
            var w = width / 2;
            var h = height / 2;
            this._matrix[0] = a;
            this._matrix[1] = b;
            this._matrix[2] = -c;
            this._matrix[3] = d;
            this._matrix[4] = -a * w + c * h + w + x;
            this._matrix[5] = -b * w - d * h + h + y;
        };
        PlainMatrix.prototype.updateWithAnchor = function (width, height, scaleX, scaleY, angle, x, y, anchorX, anchorY) {
            // ここで求める変換行列Mは、引数で指定された変形を、拡大・回転・平行移動の順に適用するものである。
            // 変形の原点は引数で指定された位置の原寸大、すなわち (anchorX * width, anchorY * height) の位置である。従って
            //    M = A^-1 T R S A
            // である。ただしここでA, S, R, Tは、それぞれ以下を表す変換行列である:
            //    A: アンカーを原点に移す(平行移動する)変換
            //    S: X軸方向にscaleX倍、Y軸方向にscaleY倍する変換
            //    R: angle度だけ回転する変換
            //    T: x, yの値だけ平行移動する変換
            // それらは次のように表せる:
            //           1    0   -w           sx    0    0            c   -s    0            1    0    x-w
            //    A = [  0    1   -h]    S = [  0   sy    0]    R = [  s    c    0]    T = [  0    1    y-h]
            //           0    0    1            0    0    1            0    0    1            0    0    1
            // ここで sx, sy は scaleX, scaleY であり、c, s は cos(theta), sin(theta)
            // (ただし theta = angle * PI / 180)、w = anchorX * width, h = anchorY * height である。
            // 以下の実装は、M の各要素をそれぞれ計算して直接求めている。
            var r = angle * Math.PI / 180;
            var _cos = Math.cos(r);
            var _sin = Math.sin(r);
            var a = _cos * scaleX;
            var b = _sin * scaleX;
            var c = _sin * scaleY;
            var d = _cos * scaleY;
            var w = anchorX * width;
            var h = anchorY * height;
            this._matrix[0] = a;
            this._matrix[1] = b;
            this._matrix[2] = -c;
            this._matrix[3] = d;
            this._matrix[4] = -a * w + c * h + x;
            this._matrix[5] = -b * w - d * h + y;
        };
        PlainMatrix.prototype.updateByInverse = function (width, height, scaleX, scaleY, angle, x, y) {
            // ここで求める変換行列は、update() の求める行列Mの逆行列、M^-1である。update() のコメントに記述のとおり、
            //    M = A^-1 T R S A
            // であるから、
            //    M^-1 = A^-1 S^-1 R^-1 T^-1 A
            // それぞれは次のように表せる:
            //              1    0    w             1/sx     0    0               c    s    0               1    0   -x
            //    A^-1 = [  0    1    h]    S^-1 = [   0  1/sy    0]    R^-1 = [ -s    c    0]    T^-1 = [  0    1   -y]
            //              0    0    1                0     0    1               0    0    1               0    0    1
            // ここで各変数は update() のコメントのものと同様である。
            // 以下の実装は、M^-1 の各要素をそれぞれ計算して直接求めている。
            var r = angle * Math.PI / 180;
            var _cos = Math.cos(r);
            var _sin = Math.sin(r);
            var a = _cos / scaleX;
            var b = _sin / scaleY;
            var c = _sin / scaleX;
            var d = _cos / scaleY;
            var w = width / 2;
            var h = height / 2;
            this._matrix[0] = a;
            this._matrix[1] = -b;
            this._matrix[2] = c;
            this._matrix[3] = d;
            this._matrix[4] = -a * (w + x) - c * (h + y) + w;
            this._matrix[5] = b * (w + x) - d * (h + y) + h;
        };
        PlainMatrix.prototype.updateByInverseWithAnchor = function (width, height, scaleX, scaleY, angle, x, y, anchorX, anchorY) {
            // ここで求める変換行列は、updateWithAnchor() の求める行列Mの逆行列、M^-1である。updateWithAnchor() のコメントに記述のとおり、
            //    M = A^-1 T R S A
            // であるから、
            //    M^-1 = A^-1 S^-1 R^-1 T^-1 A
            // それぞれは次のように表せる:
            //              1    0    w             1/sx     0    0               c    s    0               1    0   -x+w
            //    A^-1 = [  0    1    h]    S^-1 = [   0  1/sy    0]    R^-1 = [ -s    c    0]    T^-1 = [  0    1   -y+h]
            //              0    0    1                0     0    1               0    0    1               0    0    1
            // ここで各変数は updateWithAnchor() のコメントのものと同様である。
            // 以下の実装は、M^-1 の各要素をそれぞれ計算して直接求めている。
            var r = angle * Math.PI / 180;
            var _cos = Math.cos(r);
            var _sin = Math.sin(r);
            var a = _cos / scaleX;
            var b = _sin / scaleY;
            var c = _sin / scaleX;
            var d = _cos / scaleY;
            var w = anchorX * width;
            var h = anchorY * height;
            this._matrix[0] = a;
            this._matrix[1] = -b;
            this._matrix[2] = c;
            this._matrix[3] = d;
            this._matrix[4] = -a * x - c * y + w;
            this._matrix[5] = b * x - d * y + h;
        };
        PlainMatrix.prototype.multiply = function (matrix) {
            var m1 = this._matrix;
            var m2 = matrix._matrix;
            var m10 = m1[0];
            var m11 = m1[1];
            var m12 = m1[2];
            var m13 = m1[3];
            m1[0] = m10 * m2[0] + m12 * m2[1];
            m1[1] = m11 * m2[0] + m13 * m2[1];
            m1[2] = m10 * m2[2] + m12 * m2[3];
            m1[3] = m11 * m2[2] + m13 * m2[3];
            m1[4] = m10 * m2[4] + m12 * m2[5] + m1[4];
            m1[5] = m11 * m2[4] + m13 * m2[5] + m1[5];
        };
        PlainMatrix.prototype.multiplyNew = function (matrix) {
            var ret = this.clone();
            ret.multiply(matrix);
            return ret;
        };
        PlainMatrix.prototype.reset = function (x, y) {
            this._matrix[0] = 1;
            this._matrix[1] = 0;
            this._matrix[2] = 0;
            this._matrix[3] = 1;
            this._matrix[4] = x || 0;
            this._matrix[5] = y || 0;
        };
        PlainMatrix.prototype.clone = function () {
            return new PlainMatrix(this);
        };
        PlainMatrix.prototype.multiplyInverseForPoint = function (point) {
            var m = this._matrix;
            // id = inverse of the determinant
            var _id = 1 / (m[0] * m[3] + m[2] * -m[1]);
            return {
                x: m[3] * _id * point.x + -m[2] * _id * point.y + (m[5] * m[2] - m[4] * m[3]) * _id,
                y: m[0] * _id * point.y + -m[1] * _id * point.x + (-m[5] * m[0] + m[4] * m[1]) * _id
            };
        };
        PlainMatrix.prototype.scale = function (x, y) {
            var m = this._matrix;
            m[0] *= x;
            m[1] *= y;
            m[2] *= x;
            m[3] *= y;
            m[4] *= x;
            m[5] *= y;
        };
        PlainMatrix.prototype.multiplyPoint = function (point) {
            var m = this._matrix;
            var x = m[0] * point.x + m[2] * point.y + m[4];
            var y = m[1] * point.x + m[3] * point.y + m[5];
            return { x: x, y: y };
        };
        return PlainMatrix;
    }());
    g.PlainMatrix = PlainMatrix;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * ユーティリティ。
     */
    var Util;
    (function (Util) {
        /**
         * 2点間(P1..P2)の距離(pixel)を返す。
         * @param {number} p1x P1-X
         * @param {number} p1y P1-Y
         * @param {number} p2x P2-X
         * @param {number} p2y P2-Y
         */
        function distance(p1x, p1y, p2x, p2y) {
            return Math.sqrt(Math.pow(p1x - p2x, 2) + Math.pow(p1y - p2y, 2));
        }
        Util.distance = distance;
        /**
         * 2点間(P1..P2)の距離(pixel)を返す。
         * @param {CommonOffset} p1 座標1
         * @param {CommonOffset} p2 座標2
         */
        function distanceBetweenOffsets(p1, p2) {
            return Util.distance(p1.x, p1.y, p2.x, p2.y);
        }
        Util.distanceBetweenOffsets = distanceBetweenOffsets;
        /**
         * 2つの矩形の中心座標(P1..P2)間の距離(pixel)を返す。
         * @param {CommonArea} p1 矩形1
         * @param {CommonArea} p2 矩形2
         */
        function distanceBetweenAreas(p1, p2) {
            return Util.distance(p1.x + p1.width / 2, p1.y + p1.height / 2, p2.x + p2.width / 2, p2.y + p2.height / 2);
        }
        Util.distanceBetweenAreas = distanceBetweenAreas;
        // Note: オーバーロードされているのでjsdoc省略
        function createMatrix(width, height, scaleX, scaleY, angle, anchorX, anchorY) {
            // Note: asm.js対応環境ではasm.js対応のMatrixを生成するなどしたいため、オーバーヘッドを許容する
            if (width === undefined)
                return new g.PlainMatrix();
            return new g.PlainMatrix(width, height, scaleX, scaleY, angle, anchorX, anchorY);
        }
        Util.createMatrix = createMatrix;
        /**
         * e の描画内容を持つ Sprite を生成する。
         * @param scene 作成したSpriteを登録するScene
         * @param e Sprite化したいE
         * @param camera 使用カメラ
         */
        function createSpriteFromE(scene, e, camera) {
            var oldX = e.x;
            var oldY = e.y;
            var x = 0;
            var y = 0;
            var width = e.width;
            var height = e.height;
            var boundingRect = e.calculateBoundingRect(camera);
            if (!boundingRect) {
                throw g.ExceptionFactory.createAssertionError("Util#createSpriteFromE: camera must look e");
            }
            width = boundingRect.right - boundingRect.left;
            height = boundingRect.bottom - boundingRect.top;
            if (boundingRect.left < e.x)
                x = e.x - boundingRect.left;
            if (boundingRect.top < e.y)
                y = e.y - boundingRect.top;
            e.moveTo(x, y);
            // 再描画フラグを立てたくないために e._matrix を直接触っている
            if (e._matrix)
                e._matrix._modified = true;
            var surface = scene.game.resourceFactory.createSurface(Math.ceil(width), Math.ceil(height));
            var renderer = surface.renderer();
            renderer.begin();
            e.render(renderer, camera);
            renderer.end();
            var s = new g.Sprite({
                scene: scene,
                src: surface,
                width: width,
                height: height
            });
            s.moveTo(boundingRect.left, boundingRect.top);
            e.moveTo(oldX, oldY);
            if (e._matrix)
                e._matrix._modified = true;
            return s;
        }
        Util.createSpriteFromE = createSpriteFromE;
        /**
         * scene の描画内容を持つ Sprite を生成する。
         * @param toScene 作ったSpriteを登録するScene
         * @param fromScene Sprite化したいScene
         * @param camera 使用カメラ
         */
        function createSpriteFromScene(toScene, fromScene, camera) {
            var surface = toScene.game.resourceFactory.createSurface(Math.ceil(fromScene.game.width), Math.ceil(fromScene.game.height));
            var renderer = surface.renderer();
            renderer.begin();
            var children = fromScene.children;
            for (var i = 0; i < children.length; ++i)
                children[i].render(renderer, camera);
            renderer.end();
            return new g.Sprite({
                scene: toScene,
                src: surface,
                width: fromScene.game.width,
                height: fromScene.game.height
            });
        }
        Util.createSpriteFromScene = createSpriteFromScene;
        /**
         * 引数 `src` が `undefined` または `Surface` でそのまま返す。
         * そうでなくかつ `ImageAsset` であれば `Surface` に変換して返す。
         *
         * @param src
         */
        function asSurface(src) {
            // Note: TypeScriptのtype guardを活用するため、あえて1つのifで1つの型しか判定していない
            if (!src)
                return src;
            if (src instanceof g.Surface)
                return src;
            if (src instanceof g.ImageAsset)
                return src.asSurface();
            throw g.ExceptionFactory.createTypeMismatchError("Util#asSurface", "ImageAsset|Surface", src);
        }
        Util.asSurface = asSurface;
        /**
         * 与えられたパス文字列がファイルパスであると仮定して、対応するアセットを探す。
         * 見つかった場合そのアセットを、そうでない場合 `undefined` を返す。
         * 通常、ゲーム開発者がファイルパスを扱うことはなく、このメソッドを呼び出す必要はない。
         *
         * @param resolvedPath パス文字列
         * @param liveAssetPathTable パス文字列のプロパティに対応するアセットを格納したオブジェクト
         */
        function findAssetByPathAsFile(resolvedPath, liveAssetPathTable) {
            if (liveAssetPathTable.hasOwnProperty(resolvedPath))
                return liveAssetPathTable[resolvedPath];
            if (liveAssetPathTable.hasOwnProperty(resolvedPath + ".js"))
                return liveAssetPathTable[resolvedPath + ".js"];
            return undefined;
        }
        Util.findAssetByPathAsFile = findAssetByPathAsFile;
        /**
         * 与えられたパス文字列がディレクトリパスであると仮定して、対応するアセットを探す。
         * 見つかった場合そのアセットを、そうでない場合 `undefined` を返す。
         * 通常、ゲーム開発者がファイルパスを扱うことはなく、このメソッドを呼び出す必要はない。
         * ディレクトリ内に package.json が存在する場合、package.json 自体もアセットとして
         * `liveAssetPathTable` から参照可能でなければならないことに注意。
         *
         * @param resolvedPath パス文字列
         * @param liveAssetPathTable パス文字列のプロパティに対応するアセットを格納したオブジェクト
         */
        function findAssetByPathAsDirectory(resolvedPath, liveAssetPathTable) {
            var path;
            path = resolvedPath + "/package.json";
            if (liveAssetPathTable.hasOwnProperty(path) && liveAssetPathTable[path] instanceof g.TextAsset) {
                var pkg = JSON.parse(liveAssetPathTable[path].data);
                if (pkg && typeof pkg.main === "string") {
                    var asset = Util.findAssetByPathAsFile(g.PathUtil.resolvePath(resolvedPath, pkg.main), liveAssetPathTable);
                    if (asset)
                        return asset;
                }
            }
            path = resolvedPath + "/index.js";
            if (liveAssetPathTable.hasOwnProperty(path))
                return liveAssetPathTable[path];
            return undefined;
        }
        Util.findAssetByPathAsDirectory = findAssetByPathAsDirectory;
        /**
         * idx文字目の文字のchar codeを返す。
         *
         * これはString#charCodeAt()と次の点で異なる。
         * - idx文字目が上位サロゲートの時これを16bit左シフトし、idx+1文字目の下位サロゲートと論理和をとった値を返す。
         * - idx文字目が下位サロゲートの時nullを返す。
         *
         * @param str 文字を取り出される文字列
         * @param idx 取り出される文字の位置
         */
        // highly based on https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/charCodeAt
        function charCodeAt(str, idx) {
            var code = str.charCodeAt(idx);
            if (0xD800 <= code && code <= 0xDBFF) {
                var hi = code;
                var low = str.charCodeAt(idx + 1);
                return (hi << 16) | low;
            }
            if (0xDC00 <= code && code <= 0xDFFF) { // Low surrogate
                return null;
            }
            return code;
        }
        Util.charCodeAt = charCodeAt;
        /**
         * サーフェスのアニメーティングイベントへのハンドラ登録。
         *
         * これはゲームエンジンが利用するものであり、ゲーム開発者が呼び出す必要はない。
         *
         * @param animatingHandler アニメーティングハンドラ
         * @param surface サーフェス
         */
        function setupAnimatingHandler(animatingHandler, surface) {
            if (surface.isDynamic) {
                surface.animatingStarted.add(animatingHandler._onAnimatingStarted, animatingHandler);
                surface.animatingStopped.add(animatingHandler._onAnimatingStopped, animatingHandler);
                if (surface.isPlaying()) {
                    animatingHandler._onAnimatingStarted();
                }
            }
        }
        Util.setupAnimatingHandler = setupAnimatingHandler;
        /**
         * アニメーティングハンドラを別のサーフェスへ移動する。
         *
         * これはゲームエンジンが利用するものであり、ゲーム開発者が呼び出す必要はない。
         *
         * @param animatingHandler アニメーティングハンドラ
         * @param beforeSurface ハンドラ登録を解除するサーフェス
         * @param afterSurface ハンドラを登録するサーフェス
         */
        function migrateAnimatingHandler(animatingHandler, beforeSurface, afterSurface) {
            animatingHandler._onAnimatingStopped();
            if (!beforeSurface.destroyed() && beforeSurface.isDynamic) {
                beforeSurface.animatingStarted.remove(animatingHandler._onAnimatingStarted, animatingHandler);
                beforeSurface.animatingStopped.remove(animatingHandler._onAnimatingStopped, animatingHandler);
            }
            if (afterSurface.isDynamic) {
                afterSurface.animatingStarted.add(animatingHandler._onAnimatingStarted, animatingHandler);
                afterSurface.animatingStopped.add(animatingHandler._onAnimatingStopped, animatingHandler);
                if (afterSurface.isPlaying()) {
                    animatingHandler._onAnimatingStarted();
                }
            }
        }
        Util.migrateAnimatingHandler = migrateAnimatingHandler;
    })(Util = g.Util || (g.Util = {}));
})(g || (g = {}));
var g;
(function (g) {
    /**
     * オブジェクトの衝突を表す。
     * - 矩形交差による衝突
     * - 2点間の距離による衝突
     */
    var Collision;
    (function (Collision) {
        /**
         * 矩形交差による衝突判定を行い、その結果を返す。
         * 戻り値は、矩形t1, t2が交差しているとき真、でなければ偽。
         * @param {number} x1 t1-X
         * @param {number} y1 t1-Y
         * @param {number} width1 t1幅
         * @param {number} height1 t1高さ
         * @param {number} x2 t2-X
         * @param {number} y2 t2-Y
         * @param {number} width2 t2幅
         * @param {number} height2 t2高さ
         */
        function intersect(x1, y1, width1, height1, x2, y2, width2, height2) {
            return (x1 <= x2 + width2) && (x2 <= x1 + width1)
                && (y1 <= y2 + height2) && (y2 <= y1 + height1);
        }
        Collision.intersect = intersect;
        /**
         * 矩形交差による衝突判定を行い、その結果を返す。
         * 戻り値は、矩形t1, t2が交差しているとき真、でなければ偽。
         * @param {CommonArea} t1 矩形1
         * @param {CommonArea} t2 矩形2
         */
        function intersectAreas(t1, t2) {
            return Collision.intersect(t1.x, t1.y, t1.width, t1.height, t2.x, t2.y, t2.width, t2.height);
        }
        Collision.intersectAreas = intersectAreas;
        /**
         * 2点間の距離による衝突判定を行い、その結果を返す。
         * 戻り値は、2点間の距離が閾値以内であるとき真、でなければ偽。
         * @param {number} t1x t1-X
         * @param {number} t1y t1-X
         * @param {number} t2x t1-X
         * @param {number} t2y t1-X
         * @param {number} [distance=1] 衝突判定閾値 [pixel]
         */
        function within(t1x, t1y, t2x, t2y, distance) {
            if (distance === void 0) { distance = 1; }
            return distance >= g.Util.distance(t1x, t1y, t2x, t2y);
        }
        Collision.within = within;
        /**
         * 2つの矩形の中心座標間距離による衝突判定を行い、その結果を返す。
         * 戻り値は、2点間の距離が閾値以内であるとき真、でなければ偽。
         * @param {CommonArea} t1 矩形1
         * @param {CommonArea} t2 矩形2
         * @param {number} [distance=1] 衝突判定閾値 [pixel]
         */
        function withinAreas(t1, t2, distance) {
            if (distance === void 0) { distance = 1; }
            return distance >= g.Util.distanceBetweenAreas(t1, t2);
        }
        Collision.withinAreas = withinAreas;
    })(Collision = g.Collision || (g.Collision = {}));
})(g || (g = {}));
var g;
(function (g) {
    /**
     * イベント通知機構クラス。
     */
    var Trigger = /** @class */ (function () {
        function Trigger() {
            this._handlers = [];
            this.length = 0;
        }
        Trigger.prototype.add = function (paramsOrFunc, owner) {
            if (typeof paramsOrFunc === "function") {
                this._handlers.push({
                    func: paramsOrFunc,
                    owner: owner,
                    once: false,
                    name: undefined
                });
            }
            else {
                var params = paramsOrFunc;
                if (typeof params.index === "number") {
                    this._handlers.splice(params.index, 0, {
                        func: params.func,
                        owner: params.owner,
                        once: false,
                        name: params.name
                    });
                }
                else {
                    this._handlers.push({
                        func: params.func,
                        owner: params.owner,
                        once: false,
                        name: params.name
                    });
                }
            }
            this.length = this._handlers.length;
        };
        Trigger.prototype.addOnce = function (paramsOrFunc, owner) {
            if (typeof paramsOrFunc === "function") {
                this._handlers.push({
                    func: paramsOrFunc,
                    owner: owner,
                    once: true,
                    name: undefined
                });
            }
            else {
                var params = paramsOrFunc;
                if (typeof params.index === "number") {
                    this._handlers.splice(params.index, 0, {
                        func: params.func,
                        owner: params.owner,
                        once: true,
                        name: params.name
                    });
                }
                else {
                    this._handlers.push({
                        func: params.func,
                        owner: params.owner,
                        once: true,
                        name: params.name
                    });
                }
            }
            this.length = this._handlers.length;
        };
        /**
         * このTriggerにハンドラを追加する。
         * @deprecated 互換性のために残されている。代わりに `add()` を利用すべきである。実装の変化のため、 `func` が `boolean` を返した時の動作はサポートされていない。
         */
        Trigger.prototype.handle = function (owner, func, name) {
            this.add(func ? { owner: owner, func: func, name: name } : { func: owner });
        };
        /**
         * このTriggerを発火する。
         *
         * 登録された全ハンドラの関数を、引数 `arg` を与えて呼び出す。
         * 呼び出し後、次のいずれかの条件を満たす全ハンドラの登録は解除される。
         * * ハンドラが `addOnce()` で登録されていた場合
         * * ハンドラが `add()` で登録される際に `once: true` オプションが与えられていた場合
         * * 関数がtruthyな値を返した場合
         *
         * @param arg ハンドラに与えられる引数
         */
        Trigger.prototype.fire = function (arg) {
            if (!this._handlers || !this._handlers.length)
                return;
            var handlers = this._handlers.concat();
            for (var i = 0; i < handlers.length; i++) {
                var handler = handlers[i];
                if (handler.func.call(handler.owner, arg) || handler.once) {
                    var index = this._handlers.indexOf(handler);
                    if (index !== -1)
                        this._handlers.splice(index, 1);
                }
            }
            if (this._handlers) // TODO 条件文は暫定対応
                this.length = this._handlers.length;
        };
        Trigger.prototype.contains = function (paramsOrFunc, owner) {
            var condition = typeof paramsOrFunc === "function" ? { func: paramsOrFunc, owner: owner } : paramsOrFunc;
            for (var i = 0; i < this._handlers.length; i++) {
                if (this._comparePartial(condition, this._handlers[i])) {
                    return true;
                }
            }
            return false;
        };
        Trigger.prototype.remove = function (paramsOrFunc, owner) {
            var condition = typeof paramsOrFunc === "function" ? { func: paramsOrFunc, owner: owner } : paramsOrFunc;
            for (var i = 0; i < this._handlers.length; i++) {
                var handler = this._handlers[i];
                if (condition.func === handler.func && condition.owner === handler.owner && condition.name === handler.name) {
                    this._handlers.splice(i, 1);
                    --this.length;
                    return;
                }
            }
        };
        /**
         * 指定した条件に部分一致するイベントハンドラを削除する。
         *
         * 本メソッドは引数に与えた条件に一致したイベントハンドラを全て削除する。
         * 引数の条件を一部省略した場合、その値の内容が登録時と異なっていても対象のイベントハンドラは削除される。
         * 引数に与えた条件と完全に一致したイベントハンドラのみを削除したい場合は `this.remove()` を用いる。
         * 引数を省略した場合は全てのイベントハンドラを削除する。
         *
         * @param params 削除するイベントハンドラの条件
         */
        Trigger.prototype.removeAll = function (params) {
            var handlers = [];
            if (params) {
                for (var i = 0; i < this._handlers.length; i++) {
                    var handler = this._handlers[i];
                    if (!this._comparePartial(params, handler)) {
                        handlers.push(handler);
                    }
                }
            }
            this._handlers = handlers;
            this.length = this._handlers.length;
        };
        /**
         * このTriggerを破棄する。
         */
        Trigger.prototype.destroy = function () {
            this._handlers = null;
            this.length = null;
        };
        /**
         * このTriggerが破棄されているかを返す。
         */
        Trigger.prototype.destroyed = function () {
            return this._handlers === null;
        };
        /**
         * @private
         */
        Trigger.prototype._comparePartial = function (target, compare) {
            if (target.func !== undefined && target.func !== compare.func)
                return false;
            if (target.owner !== undefined && target.owner !== compare.owner)
                return false;
            if (target.name !== undefined && target.name !== compare.name)
                return false;
            return true;
        };
        return Trigger;
    }());
    g.Trigger = Trigger;
    /**
     * 他のTriggerに反応して発火するイベント通知機構。
     */
    var ChainTrigger = /** @class */ (function (_super) {
        __extends(ChainTrigger, _super);
        /**
         * `ChainTrigger` のインスタンスを生成する。
         *
         * このインスタンスは、 `chain` がfireされたときに `filter` を実行し、真を返した場合に自身をfireする。
         * @param chain このインスタンスがfireするきっかけとなる Trigger
         * @param filter `chain` がfireされたときに実行される関数。省略された場合、または本関数の戻り値が真の場合、このインスタンスをfireする。
         * @param filterOwner `filter` 呼び出し時に使われる `this` の値。
         */
        function ChainTrigger(chain, filter, filterOwner) {
            var _this = _super.call(this) || this;
            _this.chain = chain;
            _this.filter = filter;
            _this.filterOwner = filterOwner;
            _this._isActivated = false;
            return _this;
        }
        ChainTrigger.prototype.add = function (paramsOrHandler, owner) {
            _super.prototype.add.call(this, paramsOrHandler, owner);
            if (!this._isActivated) {
                this.chain.add(this._onChainTriggerFired, this);
                this._isActivated = true;
            }
        };
        ChainTrigger.prototype.addOnce = function (paramsOrHandler, owner) {
            _super.prototype.addOnce.call(this, paramsOrHandler, owner);
            if (!this._isActivated) {
                this.chain.add(this._onChainTriggerFired, this);
                this._isActivated = true;
            }
        };
        ChainTrigger.prototype.remove = function (paramsOrFunc, owner) {
            _super.prototype.remove.call(this, paramsOrFunc, owner);
            if (this.length === 0 && this._isActivated) {
                this.chain.remove(this._onChainTriggerFired, this);
                this._isActivated = false;
            }
        };
        ChainTrigger.prototype.removeAll = function (params) {
            _super.prototype.removeAll.call(this, params);
            if (this.length === 0 && this._isActivated) {
                this.chain.remove(this._onChainTriggerFired, this);
                this._isActivated = false;
            }
        };
        ChainTrigger.prototype.destroy = function () {
            _super.prototype.destroy.call(this);
            this.chain.remove(this._onChainTriggerFired, this);
            this.filter = null;
            this.filterOwner = null;
            this._isActivated = false;
        };
        /**
         * @private
         */
        ChainTrigger.prototype._onChainTriggerFired = function (args) {
            if (!this.filter || this.filter.call(this.filterOwner, args)) {
                this.fire(args);
            }
        };
        return ChainTrigger;
    }(Trigger));
    g.ChainTrigger = ChainTrigger;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 一定時間で繰り返される処理を表すタイマー。
     *
     * ゲーム開発者が本クラスのインスタンスを直接生成することはなく、
     * 通常はScene#setTimeout、Scene#setIntervalによって間接的に利用する。
     */
    var Timer = /** @class */ (function () {
        function Timer(interval, fps) {
            this.interval = interval;
            // NOTE: intervalが浮動小数の場合があるため念のため四捨五入する
            this._scaledInterval = Math.round(interval * fps);
            this.elapsed = new g.Trigger();
            this._scaledElapsed = 0;
        }
        Timer.prototype.tick = function () {
            // NOTE: 1000 / fps * fps = 1000
            this._scaledElapsed += 1000;
            while (this._scaledElapsed >= this._scaledInterval) {
                // NOTE: this.elapsed.fire()内でdestroy()される可能性があるため、destroyed()を判定する
                if (!this.elapsed) {
                    break;
                }
                this.elapsed.fire();
                this._scaledElapsed -= this._scaledInterval;
            }
        };
        Timer.prototype.canDelete = function () {
            return !this.elapsed || this.elapsed.length === 0;
        };
        Timer.prototype.destroy = function () {
            this.interval = undefined;
            this.elapsed.destroy();
            this.elapsed = undefined;
            this._scaledInterval = 0;
            this._scaledElapsed = 0;
        };
        Timer.prototype.destroyed = function () {
            return this.elapsed === undefined;
        };
        return Timer;
    }());
    g.Timer = Timer;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * `Scene#setTimeout` や `Scene#setInterval` の実行単位を表す。
     * ゲーム開発者が本クラスのインスタンスを直接生成することはなく、
     * 本クラスの機能を直接利用することはない。
     */
    var TimerIdentifier = /** @class */ (function () {
        function TimerIdentifier(timer, handler, handlerOwner, fired, firedOwner) {
            this._timer = timer;
            this._handler = handler;
            this._handlerOwner = handlerOwner;
            this._fired = fired;
            this._firedOwner = firedOwner;
            this._timer.elapsed.add(this._fire, this);
        }
        TimerIdentifier.prototype.destroy = function () {
            this._timer.elapsed.remove(this._fire, this);
            this._timer = undefined;
            this._handler = undefined;
            this._handlerOwner = undefined;
            this._fired = undefined;
            this._firedOwner = undefined;
        };
        TimerIdentifier.prototype.destroyed = function () {
            return this._timer === undefined;
        };
        /**
         * @private
         */
        TimerIdentifier.prototype._fire = function () {
            this._handler.call(this._handlerOwner);
            if (this._fired) {
                this._fired.call(this._firedOwner, this);
            }
        };
        return TimerIdentifier;
    }());
    g.TimerIdentifier = TimerIdentifier;
    /**
     * Timerを管理する機構を提供する。
     * ゲーム開発者が本クラスを利用する事はない。
     */
    var TimerManager = /** @class */ (function () {
        function TimerManager(trigger, fps) {
            this._timers = [];
            this._trigger = trigger;
            this._identifiers = [];
            this._fps = fps;
            this._registered = false;
        }
        TimerManager.prototype.destroy = function () {
            for (var i = 0; i < this._identifiers.length; ++i) {
                this._identifiers[i].destroy();
            }
            for (var i = 0; i < this._timers.length; ++i) {
                this._timers[i].destroy();
            }
            this._timers = undefined;
            this._trigger = undefined;
            this._identifiers = undefined;
            this._fps = undefined;
        };
        TimerManager.prototype.destroyed = function () {
            return this._timers === undefined;
        };
        /**
         * 定期間隔で処理を実行するTimerを作成する。
         * 本Timerはフレーム経過によって動作する疑似タイマーであるため、実時間の影響は受けない
         * @param interval Timerの実行間隔（ミリ秒）
         * @returns 作成したTimer
         */
        TimerManager.prototype.createTimer = function (interval) {
            if (!this._registered) {
                this._trigger.add(this._tick, this);
                this._registered = true;
            }
            if (interval < 0)
                throw g.ExceptionFactory.createAssertionError("TimerManager#createTimer: invalid interval");
            // NODE: intervalが0の場合に、Timer#tick()で無限ループとなるためintervalの最小値を1とする。
            if (interval < 1)
                interval = 1;
            // NOTE: Timerの_scaledElapsedと比較するため、this.fps倍した値を用いる
            // Math.min(1000 / this._fps * this.fps, interval * this._fps);
            var acceptableMargin = Math.min(1000, interval * this._fps);
            for (var i = 0; i < this._timers.length; ++i) {
                if (this._timers[i].interval === interval) {
                    if (this._timers[i]._scaledElapsed < acceptableMargin) {
                        return this._timers[i];
                    }
                }
            }
            var timer = new g.Timer(interval, this._fps);
            this._timers.push(timer);
            return timer;
        };
        /**
         * Timerを削除する。
         * @param timer 削除するTimer
         */
        TimerManager.prototype.deleteTimer = function (timer) {
            if (!timer.canDelete())
                return;
            var index = this._timers.indexOf(timer);
            if (index < 0)
                throw g.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: can not find timer");
            this._timers.splice(index, 1);
            timer.destroy();
            if (!this._timers.length) {
                if (!this._registered)
                    throw g.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: handler is not handled");
                this._trigger.remove(this._tick, this);
                this._registered = false;
            }
        };
        TimerManager.prototype.setTimeout = function (handler, milliseconds, owner) {
            var timer = this.createTimer(milliseconds);
            var identifier = new TimerIdentifier(timer, handler, owner, this._onTimeoutFired, this);
            this._identifiers.push(identifier);
            return identifier;
        };
        TimerManager.prototype.clearTimeout = function (identifier) {
            this._clear(identifier);
        };
        TimerManager.prototype.setInterval = function (handler, interval, owner) {
            var timer = this.createTimer(interval);
            var identifier = new TimerIdentifier(timer, handler, owner);
            this._identifiers.push(identifier);
            return identifier;
        };
        TimerManager.prototype.clearInterval = function (identifier) {
            this._clear(identifier);
        };
        /**
         * すべてのTimerを時間経過させる。
         * @private
         */
        TimerManager.prototype._tick = function () {
            var timers = this._timers.concat();
            for (var i = 0; i < timers.length; ++i)
                timers[i].tick();
        };
        /**
         * @private
         */
        TimerManager.prototype._onTimeoutFired = function (identifier) {
            var index = this._identifiers.indexOf(identifier);
            if (index < 0)
                throw g.ExceptionFactory.createAssertionError("TimerManager#_onTimeoutFired: can not find identifier");
            this._identifiers.splice(index, 1);
            var timer = identifier._timer;
            identifier.destroy();
            this.deleteTimer(timer);
        };
        /**
         * @private
         */
        TimerManager.prototype._clear = function (identifier) {
            var index = this._identifiers.indexOf(identifier);
            if (index < 0)
                throw g.ExceptionFactory.createAssertionError("TimerManager#_clear: can not find identifier");
            if (identifier.destroyed())
                throw g.ExceptionFactory.createAssertionError("TimerManager#_clear: invalid identifier");
            this._identifiers.splice(index, 1);
            var timer = identifier._timer;
            identifier.destroy();
            this.deleteTimer(timer);
        };
        return TimerManager;
    }());
    g.TimerManager = TimerManager;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * サウンド再生を行うクラス。
     *
     * 本クラスのインスタンスは、 `AudioSystem#createPlayer()` によって明示的に、
     * または `AudioAsset#play()` によって暗黙的に生成される。
     * ゲーム開発者は本クラスのインスタンスを直接生成すべきではない。
     */
    var AudioPlayer = /** @class */ (function () {
        /**
         * `AudioPlayer` のインスタンスを生成する。
         */
        function AudioPlayer(system) {
            this.played = new g.Trigger();
            this.stopped = new g.Trigger();
            this.currentAudio = undefined;
            this.volume = system.volume;
            this._muted = system._muted;
            this._playbackRate = system._playbackRate;
            this._system = system;
        }
        /**
         * `AudioAsset` を再生する。
         *
         * 再生後、 `this.played` がfireされる。
         * @param audio 再生するオーディオアセット
         */
        AudioPlayer.prototype.play = function (audio) {
            this.currentAudio = audio;
            this.played.fire({
                player: this,
                audio: audio
            });
        };
        /**
         * 再生を停止する。
         *
         * 停止後、 `this.stopped` がfireされる。
         * 再生中でない場合、何もしない(`stopped` もfireされない)。
         */
        AudioPlayer.prototype.stop = function () {
            var audio = this.currentAudio;
            if (!audio)
                return;
            this.currentAudio = undefined;
            this.stopped.fire({
                player: this,
                audio: audio
            });
        };
        /**
         * 音声の終了を検知できるか否か。
         * 通常、ゲーム開発者がこのメソッドを利用する必要はない。
         */
        AudioPlayer.prototype.canHandleStopped = function () {
            return true;
        };
        /**
         * 音量を変更する。
         *
         * @param volume 音量。0以上1.0以下でなければならない
         */
        // エンジンユーザが `AudioPlayer` の派生クラスを実装する場合は、
        // `_changeMuted()` などと同様、このメソッドをオーバーライドして実際に音量を変更する処理を行うこと。
        // オーバーライド先のメソッドはこのメソッドを呼びださなければならない。
        AudioPlayer.prototype.changeVolume = function (volume) {
            this.volume = volume;
        };
        /**
         * ミュート状態を変更する。
         *
         * エンジンユーザが `AudioPlayer` の派生クラスを実装する場合は、
         * このメソッドをオーバーライドして実際にミュート状態を変更する処理を行うこと。
         * オーバーライド先のメソッドはこのメソッドを呼びださなければならない。
         *
         * @param muted ミュート状態にするか否か
         * @private
         */
        AudioPlayer.prototype._changeMuted = function (muted) {
            this._muted = muted;
        };
        /**
         * 再生速度を変更する。
         *
         * エンジンユーザが `AudioPlayer` の派生クラスを実装し、
         * かつ `this._supportsPlaybackRate()` をオーバライドして真を返すようにするならば、
         * このメソッドもオーバーライドして実際に再生速度を変更する処理を行うこと。
         * オーバーライド先のメソッドはこのメソッドを呼びださなければならない。
         *
         * @param rate 再生速度の倍率。0以上でなければならない。1.0で等倍である。
         * @private
         */
        AudioPlayer.prototype._changePlaybackRate = function (rate) {
            this._playbackRate = rate;
        };
        /**
         * 再生速度の変更に対応するか否か。
         *
         * エンジンユーザが `AudioPlayer` の派生クラスを実装し、
         * 再生速度の変更に対応する場合、このメソッドをオーバーライドして真を返さねばならない。
         * その場合 `_changePlaybackRate()` もオーバーライドし、実際の再生速度変更処理を実装しなければならない。
         *
         * なおここで「再生速度の変更に対応する」は、任意の速度で実際に再生できることを意味しない。
         * 実装は等倍速 (再生速度1.0) で実際に再生できなければならない。
         * しかしそれ以外の再生速度が指定された場合、実装はまるで音量がゼロであるかのように振舞ってもよい。
         *
         * このメソッドが偽を返す場合、エンジンは音声の非等倍速度再生に対するデフォルトの処理を実行する。
         * @private
         */
        AudioPlayer.prototype._supportsPlaybackRate = function () {
            return false;
        };
        /**
         * 音量の変更を通知する。
         * @deprecated このメソッドは実験的に導入されたが、利用されていない。将来的に削除される。
         */
        AudioPlayer.prototype._onVolumeChanged = function () {
            // nothing to do
        };
        return AudioPlayer;
    }());
    g.AudioPlayer = AudioPlayer;
})(g || (g = {}));
var g;
(function (g) {
    var AudioSystem = /** @class */ (function () {
        function AudioSystem(id, game) {
            var audioSystemManager = game._audioSystemManager;
            this.id = id;
            this.game = game;
            this._volume = 1;
            this._destroyRequestedAssets = {};
            this._muted = audioSystemManager._muted;
            this._playbackRate = audioSystemManager._playbackRate;
        }
        Object.defineProperty(AudioSystem.prototype, "volume", {
            // volumeの変更時には通知が必要なのでアクセサを使う。
            // 呼び出し頻度が少ないため許容。
            get: function () {
                return this._volume;
            },
            set: function (value) {
                if (value < 0 || value > 1 || isNaN(value) || typeof value !== "number")
                    throw g.ExceptionFactory.createAssertionError("AudioSystem#volume: expected: 0.0-1.0, actual: " + value);
                this._volume = value;
                this._onVolumeChanged();
            },
            enumerable: true,
            configurable: true
        });
        AudioSystem.prototype.requestDestroy = function (asset) {
            this._destroyRequestedAssets[asset.id] = asset;
        };
        /**
         * @private
         */
        AudioSystem.prototype._reset = function () {
            this.stopAll();
            this._volume = 1;
            this._destroyRequestedAssets = {};
            this._muted = this.game._audioSystemManager._muted;
            this._playbackRate = this.game._audioSystemManager._playbackRate;
        };
        /**
         * @private
         */
        AudioSystem.prototype._setMuted = function (value) {
            var before = this._muted;
            this._muted = !!value;
            if (this._muted !== before) {
                this._onMutedChanged();
            }
        };
        /**
         * @private
         */
        AudioSystem.prototype._setPlaybackRate = function (value) {
            if (value < 0 || isNaN(value) || typeof value !== "number")
                throw g.ExceptionFactory.createAssertionError("AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: " + value);
            var before = this._playbackRate;
            this._playbackRate = value;
            if (this._playbackRate !== before) {
                this._onPlaybackRateChanged();
            }
        };
        return AudioSystem;
    }());
    g.AudioSystem = AudioSystem;
    var MusicAudioSystem = /** @class */ (function (_super) {
        __extends(MusicAudioSystem, _super);
        function MusicAudioSystem(id, game) {
            var _this = _super.call(this, id, game) || this;
            _this._player = undefined;
            _this._suppressingAudio = undefined;
            return _this;
        }
        Object.defineProperty(MusicAudioSystem.prototype, "player", {
            // Note: 音楽のないゲームの場合に無駄なインスタンスを作るのを避けるため、アクセサを使う
            get: function () {
                if (!this._player) {
                    this._player = this.game.resourceFactory.createAudioPlayer(this);
                    this._player.played.handle(this, this._onPlayerPlayed);
                    this._player.stopped.handle(this, this._onPlayerStopped);
                }
                return this._player;
            },
            set: function (v) {
                this._player = v;
            },
            enumerable: true,
            configurable: true
        });
        MusicAudioSystem.prototype.findPlayers = function (asset) {
            if (this.player.currentAudio && this.player.currentAudio.id === asset.id)
                return [this.player];
            return [];
        };
        MusicAudioSystem.prototype.createPlayer = function () {
            return this.player;
        };
        MusicAudioSystem.prototype.stopAll = function () {
            if (!this._player)
                return;
            this._player.stop();
        };
        /**
         * @private
         */
        MusicAudioSystem.prototype._reset = function () {
            _super.prototype._reset.call(this);
            if (this._player) {
                this._player.played.remove({ owner: this, func: this._onPlayerPlayed });
                this._player.stopped.remove({ owner: this, func: this._onPlayerStopped });
            }
            this._player = undefined;
            this._suppressingAudio = undefined;
        };
        /**
         * @private
         */
        MusicAudioSystem.prototype._onVolumeChanged = function () {
            this.player.changeVolume(this._volume);
        };
        /**
         * @private
         */
        MusicAudioSystem.prototype._onMutedChanged = function () {
            this.player._changeMuted(this._muted);
        };
        /**
         * @private
         */
        MusicAudioSystem.prototype._onPlaybackRateChanged = function () {
            var player = this.player;
            player._changePlaybackRate(this._playbackRate);
            if (!player._supportsPlaybackRate()) {
                this._onUnsupportedPlaybackRateChanged();
            }
        };
        /**
         * @private
         */
        MusicAudioSystem.prototype._onUnsupportedPlaybackRateChanged = function () {
            // 再生速度非対応の場合のフォールバック: 鳴らそうとしてミュートしていた音があれば鳴らし直す
            if (this._playbackRate === 1.0) {
                if (this._suppressingAudio) {
                    var audio = this._suppressingAudio;
                    this._suppressingAudio = undefined;
                    if (!audio.destroyed()) {
                        this.player._changeMuted(false);
                    }
                }
            }
        };
        /**
         * @private
         */
        MusicAudioSystem.prototype._onPlayerPlayed = function (e) {
            if (e.player !== this._player)
                throw g.ExceptionFactory.createAssertionError("MusicAudioSystem#_onPlayerPlayed: unexpected audio player");
            if (e.player._supportsPlaybackRate())
                return;
            // 再生速度非対応の場合のフォールバック: 鳴らさず即ミュートにする
            if (this._playbackRate !== 1.0) {
                e.player._changeMuted(true);
                this._suppressingAudio = e.audio;
            }
        };
        /**
         * @private
         */
        MusicAudioSystem.prototype._onPlayerStopped = function (e) {
            if (this._suppressingAudio) {
                this._suppressingAudio = undefined;
                this.player._changeMuted(false);
            }
            if (this._destroyRequestedAssets[e.audio.id]) {
                delete this._destroyRequestedAssets[e.audio.id];
                e.audio.destroy();
            }
        };
        return MusicAudioSystem;
    }(AudioSystem));
    g.MusicAudioSystem = MusicAudioSystem;
    var SoundAudioSystem = /** @class */ (function (_super) {
        __extends(SoundAudioSystem, _super);
        function SoundAudioSystem(id, game) {
            var _this = _super.call(this, id, game) || this;
            _this.players = [];
            return _this;
        }
        SoundAudioSystem.prototype.createPlayer = function () {
            var player = this.game.resourceFactory.createAudioPlayer(this);
            if (player.canHandleStopped())
                this.players.push(player);
            player.played.handle(this, this._onPlayerPlayed);
            player.stopped.handle(this, this._onPlayerStopped);
            return player;
        };
        SoundAudioSystem.prototype.findPlayers = function (asset) {
            var ret = [];
            for (var i = 0; i < this.players.length; ++i) {
                if (this.players[i].currentAudio && this.players[i].currentAudio.id === asset.id)
                    ret.push(this.players[i]);
            }
            return ret;
        };
        SoundAudioSystem.prototype.stopAll = function () {
            var players = this.players.concat();
            for (var i = 0; i < players.length; ++i) {
                players[i].stop(); // auto remove
            }
        };
        /**
         * @private
         */
        SoundAudioSystem.prototype._reset = function () {
            _super.prototype._reset.call(this);
            for (var i = 0; i < this.players.length; ++i) {
                var player = this.players[i];
                player.played.remove({ owner: this, func: this._onPlayerPlayed });
                player.stopped.remove({ owner: this, func: this._onPlayerStopped });
            }
            this.players = [];
        };
        /**
         * @private
         */
        SoundAudioSystem.prototype._onMutedChanged = function () {
            var players = this.players;
            for (var i = 0; i < players.length; ++i) {
                players[i]._changeMuted(this._muted);
            }
        };
        /**
         * @private
         */
        SoundAudioSystem.prototype._onPlaybackRateChanged = function () {
            var players = this.players;
            for (var i = 0; i < players.length; ++i) {
                players[i]._changePlaybackRate(this._playbackRate);
                // 再生速度非対応の場合のフォールバック: 即止める
                if (!players[i]._supportsPlaybackRate() && this._playbackRate !== 1.0) {
                    players[i].stop();
                }
            }
        };
        /**
         * @private
         */
        SoundAudioSystem.prototype._onPlayerPlayed = function (e) {
            if (e.player._supportsPlaybackRate())
                return;
            // 再生速度非対応の場合のフォールバック: 鳴らさず即止める
            if (this._playbackRate !== 1.0) {
                e.player.stop();
            }
        };
        /**
         * @private
         */
        SoundAudioSystem.prototype._onPlayerStopped = function (e) {
            var index = this.players.indexOf(e.player);
            if (index < 0)
                return;
            e.player.stopped.remove({ owner: this, func: this._onPlayerStopped });
            this.players.splice(index, 1);
            if (this._destroyRequestedAssets[e.audio.id]) {
                delete this._destroyRequestedAssets[e.audio.id];
                e.audio.destroy();
            }
        };
        /**
         * @private
         */
        SoundAudioSystem.prototype._onVolumeChanged = function () {
            for (var i = 0; i < this.players.length; ++i) {
                this.players[i].changeVolume(this._volume);
            }
        };
        return SoundAudioSystem;
    }(AudioSystem));
    g.SoundAudioSystem = SoundAudioSystem;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * ビデオ再生を行うクラス。
     *
     * ゲーム開発者は本クラスのインスタンスを直接生成すべきではない。
     */
    var VideoPlayer = /** @class */ (function () {
        /**
         * `VideoPlayer` のインスタンスを生成する。
         */
        function VideoPlayer(loop) {
            this._loop = !!loop;
            this.played = new g.Trigger();
            this.stopped = new g.Trigger();
            this.currentVideo = undefined;
            this.volume = 1.0;
        }
        /**
         * `VideoAsset` を再生する。
         *
         * 再生後、 `this.played` がfireされる。
         * @param Video 再生するビデオアセット
         */
        VideoPlayer.prototype.play = function (videoAsset) {
            this.currentVideo = videoAsset;
            this.played.fire({
                player: this,
                video: videoAsset
            });
            videoAsset.asSurface().animatingStarted.fire();
        };
        /**
         * 再生を停止する。
         *
         * 再生中でない場合、何もしない。
         * 停止後、 `this.stopped` がfireされる。
         */
        VideoPlayer.prototype.stop = function () {
            var videoAsset = this.currentVideo;
            this.stopped.fire({
                player: this,
                video: videoAsset
            });
            videoAsset.asSurface().animatingStopped.fire();
        };
        /**
         * 音量を変更する。
         *
         * エンジンユーザが `VideoPlayer` の派生クラスを実装する場合は、
         *  このメソッドをオーバーライドして実際に音量を変更する処理を行うこと。
         *  オーバーライド先のメソッドはこのメソッドを呼びださなければならない。
         * @param volume 音量。0以上1.0以下でなければならない
         */
        VideoPlayer.prototype.changeVolume = function (volume) {
            this.volume = volume;
        };
        return VideoPlayer;
    }());
    g.VideoPlayer = VideoPlayer;
})(g || (g = {}));
var g;
(function (g) {
    // 将来 VideoPlayerインスタンスの一元管理（ボリューム設定などAudioSystemと似た役割）
    // を担うクラス。VideoAssetはVideoSystemを持つという体裁を整えるために(中身が空であるが)
    // 定義されている。
    // TODO: 実装
    var VideoSystem = /** @class */ (function () {
        function VideoSystem() {
        }
        return VideoSystem;
    }());
    g.VideoSystem = VideoSystem;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 二次元の幾何的オブジェクト。位置とサイズ (に加えて傾きや透明度も) を持つ。
     * ゲーム開発者は `E` を使えばよく、通常このクラスを意識する必要はない。
     */
    var Object2D = /** @class */ (function () {
        function Object2D(param) {
            if (!param) {
                this.x = 0;
                this.y = 0;
                this.width = 0;
                this.height = 0;
                this.opacity = 1;
                this.scaleX = 1;
                this.scaleY = 1;
                this.angle = 0;
                this.compositeOperation = undefined;
                this.anchorX = undefined;
                this.anchorY = undefined;
                this._matrix = undefined;
            }
            else {
                this.x = param.x || 0;
                this.y = param.y || 0;
                this.width = param.width || 0;
                this.height = param.height || 0;
                this.opacity = "opacity" in param ? param.opacity : 1;
                this.scaleX = "scaleX" in param ? param.scaleX : 1;
                this.scaleY = "scaleY" in param ? param.scaleY : 1;
                this.angle = param.angle || 0;
                this.compositeOperation = param.compositeOperation;
                this.anchorX = param.anchorX;
                this.anchorY = param.anchorY;
                this._matrix = undefined;
            }
        }
        Object2D.prototype.moveTo = function (posOrX, y) {
            if (typeof posOrX === "number" && typeof y !== "number") {
                throw g.ExceptionFactory.createAssertionError("Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number.");
            }
            if (typeof posOrX === "number") {
                this.x = posOrX;
                this.y = y;
            }
            else {
                this.x = posOrX.x;
                this.y = posOrX.y;
            }
        };
        /**
         * オブジェクトを相対的に移動する。
         * このメソッドは `x` と `y` を同時に加算するためのユーティリティメソッドである。
         * `E` や `Camera2D` においてこのメソッドを呼び出した場合、 `modified()` を呼び出す必要がある。
         * @param x X座標に加算する値
         * @param y Y座標に加算する値
         */
        Object2D.prototype.moveBy = function (x, y) {
            this.x += x;
            this.y += y;
        };
        Object2D.prototype.resizeTo = function (sizeOrWidth, height) {
            if (typeof sizeOrWidth === "number" && typeof height !== "number") {
                throw g.ExceptionFactory.createAssertionError("Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number.");
            }
            if (typeof sizeOrWidth === "number") {
                this.width = sizeOrWidth;
                this.height = height;
            }
            else {
                this.width = sizeOrWidth.width;
                this.height = sizeOrWidth.height;
            }
        };
        /**
         * オブジェクトのサイズを相対的に変更する。
         * このメソッドは `width` と `height` を同時に加算するためのユーティリティメソッドである。
         * `E` や `Camera2D` においてこのメソッドを呼び出した場合、 `modified()` を呼び出す必要がある。
         * @param width 加算する幅
         * @param height 加算する高さ
         */
        Object2D.prototype.resizeBy = function (width, height) {
            this.width += width;
            this.height += height;
        };
        /**
         * オブジェクトの拡大率を設定する。
         * このメソッドは `scaleX` と `scaleY` に同じ値を同時に設定するためのユーティリティメソッドである。
         * `E` や `Camera2D` においてこのメソッドを呼び出した場合、 `modified()` を呼び出す必要がある。
         * @param scale 拡大率
         */
        Object2D.prototype.scale = function (scale) {
            this.scaleX = scale;
            this.scaleY = scale;
        };
        /**
         * オブジェクトのアンカーの位置を設定する。
         * このメソッドは `anchorX` と `anchorY` を同時に設定するためのユーティリティメソッドである。
         * `E` や `Camera2D` においてこのメソッドを呼び出した場合、 `modified()` を呼び出す必要がある。
         */
        Object2D.prototype.anchor = function (x, y) {
            this.anchorX = x;
            this.anchorY = y;
        };
        /**
         * このオブジェクトの変換行列を得る。
         */
        Object2D.prototype.getMatrix = function () {
            if (!this._matrix) {
                this._matrix = g.Util.createMatrix();
            }
            else if (!this._matrix._modified) {
                return this._matrix;
            }
            this._updateMatrix();
            this._matrix._modified = false;
            return this._matrix;
        };
        /**
         * 公開のプロパティから内部の変換行列キャッシュを更新する。
         * @private
         */
        Object2D.prototype._updateMatrix = function () {
            if (this.anchorX != null && this.anchorY != null) {
                this._matrix.updateWithAnchor(this.width, this.height, this.scaleX, this.scaleY, this.angle, this.x, this.y, this.anchorX, this.anchorY);
            }
            else if (this.angle || this.scaleX !== 1 || this.scaleY !== 1) {
                this._matrix.update(this.width, this.height, this.scaleX, this.scaleY, this.angle, this.x, this.y);
            }
            else {
                this._matrix.reset(this.x, this.y);
            }
        };
        return Object2D;
    }());
    g.Object2D = Object2D;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * akashic-engineに描画される全てのエンティティを表す基底クラス。
     * 本クラス単体に描画処理にはなく、直接利用する場合はchildrenを利用したコンテナとして程度で利用される。
     */
    var E = /** @class */ (function (_super) {
        __extends(E, _super);
        /**
         * 各種パラメータを指定して `E` のインスタンスを生成する。
         * @param param 初期化に用いるパラメータのオブジェクト
         */
        function E(param) {
            var _this = _super.call(this, param) || this;
            _this.children = undefined;
            _this.parent = undefined;
            _this._touchable = false;
            _this.state = 0 /* None */;
            _this._hasTouchableChildren = false;
            _this._update = undefined;
            _this._message = undefined;
            _this._pointDown = undefined;
            _this._pointMove = undefined;
            _this._pointUp = undefined;
            _this._targetCameras = undefined;
            _this.tag = param.tag;
            _this.shaderProgram = param.shaderProgram;
            // local は Scene#register() や this.append() の呼び出しよりも先に立てなければならない
            // ローカルシーン・ローカルティック補間シーンのエンティティは強制的に local (ローカルティックが来て他プレイヤーとずれる可能性がある)
            _this.local = (param.scene.local !== g.LocalTickMode.NonLocal) || !!param.local;
            if (param.children) {
                for (var i = 0; i < param.children.length; ++i)
                    _this.append(param.children[i]);
            }
            if (param.parent) {
                param.parent.append(_this);
            }
            if (param.targetCameras)
                _this.targetCameras = param.targetCameras;
            if ("touchable" in param)
                _this.touchable = param.touchable;
            if (!!param.hidden)
                _this.hide();
            // set id, scene
            _this.id = param.id;
            param.scene.register(_this);
            return _this;
        }
        Object.defineProperty(E.prototype, "update", {
            /**
             * 時間経過イベント。本イベントの一度のfireにつき、常に1フレーム分の時間経過が起こる。
             */
            // Eの生成コスト低減を考慮し、参照された時のみ生成出来るようアクセサを使う
            get: function () {
                if (!this._update)
                    this._update = new g.ChainTrigger(this.scene.update);
                return this._update;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(E.prototype, "message", {
            // updateは代入する必要がないのでsetterを定義しない
            /**
             * このエンティティのmessageイベント。
             */
            // Eの生成コスト低減を考慮し、参照された時のみ生成出来るようアクセサを使う
            get: function () {
                if (!this._message)
                    this._message = new g.ChainTrigger(this.scene.message);
                return this._message;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(E.prototype, "pointDown", {
            // messageは代入する必要がないのでsetterを定義しない
            /**
             * このエンティティのpoint downイベント。
             */
            // Eの生成コスト低減を考慮し、参照された時のみ生成出来るようアクセサを使う
            get: function () {
                if (!this._pointDown)
                    this._pointDown = new g.ChainTrigger(this.scene.pointDownCapture, this._isTargetOperation, this);
                return this._pointDown;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(E.prototype, "pointUp", {
            // pointDownは代入する必要がないのでsetterを定義しない
            /**
             * このエンティティのpoint upイベント。
             */
            // Eの生成コスト低減を考慮し、参照された時のみ生成出来るようアクセサを使う
            get: function () {
                if (!this._pointUp)
                    this._pointUp = new g.ChainTrigger(this.scene.pointUpCapture, this._isTargetOperation, this);
                return this._pointUp;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(E.prototype, "pointMove", {
            // pointUpは代入する必要がないのでsetterを定義しない
            /**
             * このエンティティのpoint moveイベント。
             */
            // Eの生成コスト低減を考慮し、参照された時のみ生成出来るようアクセサを使う
            get: function () {
                if (!this._pointMove)
                    this._pointMove = new g.ChainTrigger(this.scene.pointMoveCapture, this._isTargetOperation, this);
                return this._pointMove;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(E.prototype, "targetCameras", {
            // pointMoveは代入する必要がないのでsetterを定義しない
            /**
             * このエンティティを表示できるカメラの配列。
             *
             * 初期値は空配列である。
             * この値が `undefined` または空配列である場合、このエンティティとその子孫はカメラによらず描画される。
             * 空でない配列である場合、このエンティティとその子孫は、配列内に含まれるカメラでの描画の際にのみ表示される。
             *
             * この値を変更した場合、 `this.modified()` を呼び出す必要がある。
             */
            // Eの生成コスト低減を考慮し、参照された時のみ生成出来るようアクセサを使う
            get: function () {
                return this._targetCameras || (this._targetCameras = []);
            },
            set: function (v) {
                this._targetCameras = v;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(E.prototype, "touchable", {
            /**
             * プレイヤーにとって触れられるオブジェクトであるかを表す。
             *
             * この値が偽である場合、ポインティングイベントの対象にならない。
             * 初期値は `false` である。
             *
             * `E` の他のプロパティと異なり、この値の変更後に `this.modified()` を呼び出す必要はない。
             */
            get: function () {
                return this._touchable;
            },
            set: function (v) {
                if (this._touchable === v)
                    return;
                this._touchable = v;
                if (v) {
                    this._enableTouchPropagation();
                }
                else {
                    this._disableTouchPropagation();
                }
            },
            enumerable: true,
            configurable: true
        });
        /**
         * 自分自身と子孫の内容を描画する。
         *
         * このメソッドは、 `Renderer#draw()` からエンティティのツリー構造をトラバースする過程で暗黙に呼び出される。
         * 通常、ゲーム開発者がこのメソッドを呼び出す必要はない。
         * @param renderer 描画先に対するRenderer
         * @param camera 対象のカメラ。省略された場合、undefined
         */
        E.prototype.render = function (renderer, camera) {
            this.state &= ~4 /* Modified */;
            if (this.state & 1 /* Hidden */)
                return;
            var cams = this._targetCameras;
            if (cams && cams.length > 0 && (!camera || cams.indexOf(camera) === -1))
                return;
            if (this.state & 8 /* ContextLess */) {
                renderer.translate(this.x, this.y);
                var goDown = this.renderSelf(renderer, camera);
                if (goDown && this.children) {
                    var children = this.children;
                    var len = children.length;
                    for (var i = 0; i < len; ++i)
                        children[i].render(renderer, camera);
                }
                renderer.translate(-this.x, -this.y);
                return;
            }
            renderer.save();
            if (this.angle || this.scaleX !== 1 || this.scaleY !== 1 || this.anchorX != null || this.anchorY != null) {
                // Note: this.scaleX/scaleYが0の場合描画した結果何も表示されない事になるが、特殊扱いはしない
                renderer.transform(this.getMatrix()._matrix);
            }
            else {
                // Note: 変形なしのオブジェクトはキャッシュもとらずtranslateのみで処理
                renderer.translate(this.x, this.y);
            }
            if (this.opacity !== 1)
                renderer.opacity(this.opacity);
            if (this.compositeOperation !== undefined)
                renderer.setCompositeOperation(this.compositeOperation);
            if (this.shaderProgram !== undefined && renderer.isSupportedShaderProgram())
                renderer.setShaderProgram(this.shaderProgram);
            var goDown = this.renderSelf(renderer, camera);
            if (goDown && this.children) {
                // Note: concatしていないのでunsafeだが、render中に配列の中身が変わる事はない前提とする
                var children = this.children;
                for (var i = 0; i < children.length; ++i)
                    children[i].render(renderer, camera);
            }
            renderer.restore();
        };
        /**
         * 自分自身の内容を描画する。
         *
         * このメソッドは、 `Renderer#draw()` からエンティティのツリー構造をトラバースする過程で暗黙に呼び出される。
         * 通常、ゲーム開発者がこのメソッドを呼び出す必要はない。
         *
         * 戻り値は、このエンティティの子孫の描画をスキップすべきであれば偽、でなければ真である。
         * (この値は、子孫の描画方法をカスタマイズする一部のサブクラスにおいて、通常の描画パスをスキップするために用いられる)
         *
         * @param renderer 描画先に対するRenderer
         * @param camera 対象のカメラ
         */
        E.prototype.renderSelf = function (renderer, camera) {
            // nothing to do
            return true;
        };
        /**
         * このエンティティが属する `Game` を返す。
         */
        E.prototype.game = function () {
            return this.scene.game;
        };
        /**
         * 子を追加する。
         *
         * @param e 子エンティティとして追加するエンティティ
         */
        E.prototype.append = function (e) {
            this.insertBefore(e, undefined);
        };
        /**
         * 子を挿入する。
         *
         * `target` が`this` の子でない場合、`append(e)` と同じ動作となる。
         *
         * @param e 子エンティティとして追加するエンティティ
         * @param target 挿入位置にある子エンティティ
         */
        E.prototype.insertBefore = function (e, target) {
            if (e.parent)
                e.remove();
            if (!this.children)
                this.children = [];
            e.parent = this;
            var index = -1;
            if (target !== undefined && (index = this.children.indexOf(target)) > -1) {
                this.children.splice(index, 0, e);
            }
            else {
                this.children.push(e);
            }
            if (e._touchable || e._hasTouchableChildren) {
                this._hasTouchableChildren = true;
                this._enableTouchPropagation();
            }
            this.modified(true);
        };
        /**
         * 子を削除する。
         *
         * `e` が `this` の子でない場合、 `AssertionError` がthrowされる。
         * `e === undefined` であり親がない場合、 `AssertionError` がthrowされる。
         *
         * @param e 削除する子エンティティ。省略された場合、自身を親から削除する
         */
        E.prototype.remove = function (e) {
            if (e === undefined) {
                this.parent.remove(this);
                return;
            }
            var index = this.children ? this.children.indexOf(e) : -1;
            if (index < 0)
                throw g.ExceptionFactory.createAssertionError("E#remove: invalid child");
            this.children[index].parent = undefined;
            this.children.splice(index, 1);
            if (e._touchable || e._hasTouchableChildren) {
                if (!this._findTouchableChildren(this)) {
                    this._hasTouchableChildren = false;
                    this._disableTouchPropagation();
                }
            }
            this.modified(true);
        };
        /**
         * このエンティティを破棄する。
         *
         * 親がある場合、親からは `remove()` される。
         * 子孫を持っている場合、子孫も破棄される。
         */
        E.prototype.destroy = function () {
            if (this.parent)
                this.remove();
            if (this.children) {
                for (var i = this.children.length - 1; i >= 0; --i) {
                    this.children[i].destroy();
                }
                if (this.children.length !== 0)
                    throw g.ExceptionFactory.createAssertionError("E#destroy: can not destroy all children, " + this.children.length);
                this.children = undefined;
            }
            // この解放はstringとforeachを使って書きたいが、minifyする時は.アクセスの方がいいのでやむを得ない
            if (this._update) {
                this._update.destroy();
                this._update = undefined;
            }
            if (this._message) {
                this._message.destroy();
                this._message = undefined;
            }
            if (this._pointDown) {
                this._pointDown.destroy();
                this._pointDown = undefined;
            }
            if (this._pointMove) {
                this._pointMove.destroy();
                this._pointMove = undefined;
            }
            if (this._pointUp) {
                this._pointUp.destroy();
                this._pointUp = undefined;
            }
            this.scene.unregister(this);
        };
        /**
         * このエンティティが破棄済みであるかを返す。
         */
        E.prototype.destroyed = function () {
            return this.scene === undefined;
        };
        /**
         * このエンティティに対する変更をエンジンに通知する。
         *
         * このメソッドの呼び出し後、 `this` に対する変更が各 `Renderer` の描画に反映される。
         * ただし逆は真ではない。すなわち、再描画は他の要因によって行われることもある。
         * ゲーム開発者は、このメソッドを呼び出していないことをもって再描画が行われていないことを仮定してはならない。
         *
         * 本メソッドは、このオブジェクトの `Object2D` 由来のプロパティ (`x`, `y`, `angle` など) を変更した場合にも呼びだす必要がある。
         * 本メソッドは、描画キャッシュの無効化処理を含まない。描画キャッシュを持つエンティティは、このメソッドとは別に `invalidate()` を提供している。
         * 描画キャッシュの無効化も必要な場合は、このメソッドではなくそちらを呼び出す必要がある。
         * @param isBubbling 通常ゲーム開発者が指定する必要はない。この変更通知が、(このエンティティ自身のみならず)子孫の変更の通知を含む場合、真を渡さなければならない。省略された場合、偽。
         */
        E.prototype.modified = function (isBubbling) {
            // _matrixの用途は描画に限らない(e.g. E#findPointSourceByPoint)ので、Modifiedフラグと無関係にクリアする必要がある
            if (this._matrix)
                this._matrix._modified = true;
            if (this.angle || this.scaleX !== 1 || this.scaleY !== 1 || this.anchorX != null || this.anchorY != null
                || this.opacity !== 1 || this.compositeOperation !== undefined || this.shaderProgram !== undefined) {
                this.state &= ~8 /* ContextLess */;
            }
            else {
                this.state |= 8 /* ContextLess */;
            }
            if (this.state & 4 /* Modified */)
                return;
            this.state |= 4 /* Modified */;
            if (this.parent)
                this.parent.modified(true);
        };
        /**
         * このメソッドは、 `E#findPointSourceByPoint()` 内で子孫の探索をスキップすべきか判断するために呼ばれる。
         * 通常、子孫の描画方法をカスタマイズする一部のサブクラスにおいて、与えられた座標に対する子孫の探索を制御する場合に利用する。
         * ゲーム開発者がこのメソッドを呼び出す必要はない。
         *
         * 戻り値は、子孫の探索をスキップすべきであれば偽、でなければ真である。
         *
         * @param point このエンティティ（`this`）の位置を基準とした相対座標
         */
        E.prototype.shouldFindChildrenByPoint = function (point) {
            // nothing to do
            return true;
        };
        /**
         * 自身と自身の子孫の中で、その座標に反応する `PointSource` を返す。
         *
         * 戻り値は、対象が見つかった場合、 `target` に見つかったエンティティを持つ `PointSource` である。
         * 対象が見つからなかった場合、 `undefined` である。戻り値が `undefined` でない場合、その `target` プロパティは次を満たす:
         * - このエンティティ(`this`) またはその子孫である
         * - `E#touchable` が真である
         * - カメラ `camera` から可視である中で最も手前にある
         *
         * @param point 対象の座標
         * @param m `this` に適用する変換行列。省略された場合、単位行列
         * @param force touchable指定を無視する場合真を指定する。省略された場合、偽
         * @param camera 対象のカメラ。指定されなかった場合undefined
         */
        E.prototype.findPointSourceByPoint = function (point, m, force, camera) {
            if (this.state & 1 /* Hidden */)
                return undefined;
            var cams = this._targetCameras;
            if (cams && cams.length > 0 && (!camera || cams.indexOf(camera) === -1))
                return undefined;
            m = m ? m.multiplyNew(this.getMatrix()) : this.getMatrix().clone();
            var p = m.multiplyInverseForPoint(point);
            if (this._hasTouchableChildren || (force && this.children && this.children.length)) {
                if (this.shouldFindChildrenByPoint(p)) {
                    for (var i = this.children.length - 1; i >= 0; --i) {
                        var child = this.children[i];
                        if (force || child._touchable || child._hasTouchableChildren) {
                            var target = child.findPointSourceByPoint(point, m, force, camera);
                            if (target)
                                return target;
                        }
                    }
                }
            }
            if (!(force || this._touchable))
                return undefined;
            // 逆行列をポイントにかけた結果がEにヒットしているかを計算
            if (0 <= p.x && this.width > p.x && 0 <= p.y && this.height > p.y) {
                return {
                    target: this,
                    point: p
                };
            }
            return undefined;
        };
        /**
         * このEが表示状態であるかどうかを返す。
         */
        E.prototype.visible = function () {
            return (this.state & 1 /* Hidden */) !== 1 /* Hidden */;
        };
        /**
         * このEを表示状態にする。
         *
         * `this.hide()` によって非表示状態にされたエンティティを表示状態に戻す。
         * 生成直後のエンティティは表示状態であり、 `hide()` を呼び出さない限りこのメソッドを呼び出す必要はない。
         */
        E.prototype.show = function () {
            if (!(this.state & 1 /* Hidden */))
                return;
            this.state &= ~1 /* Hidden */;
            if (this.parent) {
                this.parent.modified(true);
            }
        };
        /**
         * このEを非表示状態にする。
         *
         * `this.show()` が呼ばれるまでの間、このエンティティは各 `Renderer` によって描画されない。
         * また `Game#findPointSource()` で返されることもなくなる。
         * `this#pointDown`, `pointMove`, `pointUp` なども通常の方法ではfireされなくなる。
         */
        E.prototype.hide = function () {
            if (this.state & 1 /* Hidden */)
                return;
            this.state |= 1 /* Hidden */;
            if (this.parent) {
                this.parent.modified(true);
            }
        };
        /**
         * このEの包含矩形を計算する。
         *
         * @param c 使用カメラ。
         */
        E.prototype.calculateBoundingRect = function (c) {
            return this._calculateBoundingRect(undefined, c);
        };
        /**
         * @private
         */
        E.prototype._calculateBoundingRect = function (m, c) {
            var matrix = this.getMatrix();
            if (m) {
                matrix = m.multiplyNew(matrix);
            }
            if (!this.visible() || (c && (!this._targetCameras || this._targetCameras.indexOf(c) === -1))) {
                return undefined;
            }
            var thisBoundingRect = { left: 0, right: this.width, top: 0, bottom: this.height };
            var targetCoordinates = [
                { x: thisBoundingRect.left, y: thisBoundingRect.top },
                { x: thisBoundingRect.left, y: thisBoundingRect.bottom },
                { x: thisBoundingRect.right, y: thisBoundingRect.top },
                { x: thisBoundingRect.right, y: thisBoundingRect.bottom }
            ];
            var convertedPoint = matrix.multiplyPoint(targetCoordinates[0]);
            var result = { left: convertedPoint.x, right: convertedPoint.x, top: convertedPoint.y, bottom: convertedPoint.y };
            for (var i = 1; i < targetCoordinates.length; ++i) {
                convertedPoint = matrix.multiplyPoint(targetCoordinates[i]);
                if (result.left > convertedPoint.x)
                    result.left = convertedPoint.x;
                if (result.right < convertedPoint.x)
                    result.right = convertedPoint.x;
                if (result.top > convertedPoint.y)
                    result.top = convertedPoint.y;
                if (result.bottom < convertedPoint.y)
                    result.bottom = convertedPoint.y;
            }
            if (this.children !== undefined) {
                for (var i = 0; i < this.children.length; ++i) {
                    var nowResult = this.children[i]._calculateBoundingRect(matrix, c);
                    if (nowResult) {
                        if (result.left > nowResult.left)
                            result.left = nowResult.left;
                        if (result.right < nowResult.right)
                            result.right = nowResult.right;
                        if (result.top > nowResult.top)
                            result.top = nowResult.top;
                        if (result.bottom < nowResult.bottom)
                            result.bottom = nowResult.bottom;
                    }
                }
            }
            return result;
        };
        /**
         * @private
         */
        E.prototype._enableTouchPropagation = function () {
            var p = this.parent;
            while (p instanceof E && !p._hasTouchableChildren) {
                p._hasTouchableChildren = true;
                p = p.parent;
            }
        };
        /**
         * @private
         */
        E.prototype._disableTouchPropagation = function () {
            var p = this.parent;
            while (p instanceof E && p._hasTouchableChildren) {
                if (this._findTouchableChildren(p))
                    break;
                p._hasTouchableChildren = false;
                p = p.parent;
            }
        };
        /**
         * @private
         */
        E.prototype._isTargetOperation = function (e) {
            if (this.state & 1 /* Hidden */)
                return false;
            if (e instanceof g.PointEvent)
                return this._touchable && e.target === this;
            return false;
        };
        E.prototype._findTouchableChildren = function (e) {
            if (e.children) {
                for (var i = 0; i < e.children.length; ++i) {
                    if (e.children[i].touchable)
                        return e.children[i];
                    var tmp = this._findTouchableChildren(e.children[i]);
                    if (tmp)
                        return tmp;
                }
            }
            return undefined;
        };
        return E;
    }(g.Object2D));
    g.E = E;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 内部描画キャッシュを持つ `E` 。
     */
    var CacheableE = /** @class */ (function (_super) {
        __extends(CacheableE, _super);
        /**
         * 各種パラメータを指定して `CacheableE` のインスタンスを生成する。
         * @param param このエンティティに対するパラメータ
         */
        function CacheableE(param) {
            var _this = _super.call(this, param) || this;
            _this._shouldRenderChildren = true;
            _this._cache = undefined;
            _this._renderer = undefined;
            _this._renderedCamera = undefined;
            return _this;
        }
        /**
         * このエンティティの描画キャッシュ無効化をエンジンに通知する。
         * このメソッドを呼び出し後、描画キャッシュの再構築が行われ、各 `Renderer` に描画内容の変更が反映される。
         */
        CacheableE.prototype.invalidate = function () {
            this.state &= ~2 /* Cached */;
            this.modified();
        };
        /**
         * このエンティティ自身の描画を行う。
         * このメソッドはエンジンから暗黙に呼び出され、ゲーム開発者が呼び出す必要はない。
         */
        CacheableE.prototype.renderSelf = function (renderer, camera) {
            var padding = CacheableE.PADDING;
            if (this._renderedCamera !== camera) {
                this.state &= ~2 /* Cached */;
                this._renderedCamera = camera;
            }
            if (!(this.state & 2 /* Cached */)) {
                this._cacheSize = this.calculateCacheSize();
                var w = Math.ceil(this._cacheSize.width) + padding * 2;
                var h = Math.ceil(this._cacheSize.height) + padding * 2;
                var isNew = !this._cache || (this._cache.width < w) || (this._cache.height < h);
                if (isNew) {
                    if (this._cache && !this._cache.destroyed()) {
                        this._cache.destroy();
                    }
                    this._cache = this.scene.game.resourceFactory.createSurface(w, h);
                    this._renderer = this._cache.renderer();
                }
                var cacheRenderer = this._renderer;
                cacheRenderer.begin();
                if (!isNew) {
                    cacheRenderer.clear();
                }
                cacheRenderer.save();
                cacheRenderer.translate(padding, padding);
                this.renderCache(cacheRenderer, camera);
                cacheRenderer.restore();
                this.state |= 2 /* Cached */;
                cacheRenderer.end();
            }
            if (this._cache && this._cacheSize.width > 0 && this._cacheSize.height > 0) {
                renderer.translate(-padding, -padding);
                this.renderSelfFromCache(renderer);
                renderer.translate(padding, padding);
            }
            return this._shouldRenderChildren;
        };
        /**
         * 内部キャッシュから自身の描画を行う。
         * このメソッドはエンジンから暗黙に呼び出され、ゲーム開発者が呼び出す必要はない。
         */
        CacheableE.prototype.renderSelfFromCache = function (renderer) {
            renderer.drawImage(this._cache, 0, 0, this._cacheSize.width + CacheableE.PADDING, this._cacheSize.height + CacheableE.PADDING, 0, 0);
        };
        /**
         * 利用している `Surface` を破棄した上で、このエンティティを破棄する。
         */
        CacheableE.prototype.destroy = function () {
            if (this._cache && !this._cache.destroyed()) {
                this._cache.destroy();
            }
            this._cache = undefined;
            _super.prototype.destroy.call(this);
        };
        /**
         * キャッシュのサイズを取得する。
         * 本クラスを継承したクラスでエンティティのサイズと異なるサイズを利用する場合、このメソッドをオーバーライドする。
         * このメソッドはエンジンから暗黙に呼び出され、ゲーム開発者が呼び出す必要はない。
         * このメソッドから得られる値を変更した場合、 `this.invalidate()` を呼び出す必要がある。
         */
        CacheableE.prototype.calculateCacheSize = function () {
            return {
                width: this.width,
                height: this.height
            };
        };
        /**
         * _cache のパディングサイズ。
         *
         * @private
         */
        CacheableE.PADDING = 1;
        return CacheableE;
    }(g.E));
    g.CacheableE = CacheableE;
})(g || (g = {}));
var g;
(function (g) {
    // TODO: (GAMEDEV-1549) コメント整理
    /**
     * 操作対象とするストレージのリージョンを表す。
     */
    // サーバ仕様に則し、値を指定している。
    var StorageRegion;
    (function (StorageRegion) {
        /**
         * slotsを表す。
         */
        StorageRegion[StorageRegion["Slots"] = 1] = "Slots";
        /**
         * scoresを表す。
         */
        StorageRegion[StorageRegion["Scores"] = 2] = "Scores";
        /**
         * countsを表す。
         */
        StorageRegion[StorageRegion["Counts"] = 3] = "Counts";
        /**
         * valuesを表す。
         */
        StorageRegion[StorageRegion["Values"] = 4] = "Values";
    })(StorageRegion = g.StorageRegion || (g.StorageRegion = {}));
    /**
     * 一括取得を行う場合のソート順。
     */
    var StorageOrder;
    (function (StorageOrder) {
        /**
         * 昇順。
         */
        StorageOrder[StorageOrder["Asc"] = 0] = "Asc";
        /**
         * 降順。
         */
        StorageOrder[StorageOrder["Desc"] = 1] = "Desc";
    })(StorageOrder = g.StorageOrder || (g.StorageOrder = {}));
    /**
     * 条件を表す。
     */
    // サーバ仕様に則し、値を指定している。
    var StorageCondition;
    (function (StorageCondition) {
        /**
         * 等価を表す（==）。
         */
        StorageCondition[StorageCondition["Equal"] = 1] = "Equal";
        /**
         * 「より大きい」を表す（>）。
         */
        StorageCondition[StorageCondition["GreaterThan"] = 2] = "GreaterThan";
        /**
         * 「より小さい」を表す（<）。
         */
        StorageCondition[StorageCondition["LessThan"] = 3] = "LessThan";
    })(StorageCondition = g.StorageCondition || (g.StorageCondition = {}));
    /**
     * Countsリージョンへの書き込み操作種別を表す。
     */
    // サーバ仕様に則し、値を指定している。
    var StorageCountsOperation;
    (function (StorageCountsOperation) {
        /**
         * インクリメント操作を実行する。
         */
        StorageCountsOperation[StorageCountsOperation["Incr"] = 1] = "Incr";
        /**
         * デクリメント操作を実行する。
         */
        StorageCountsOperation[StorageCountsOperation["Decr"] = 2] = "Decr";
    })(StorageCountsOperation = g.StorageCountsOperation || (g.StorageCountsOperation = {}));
    /**
     * ストレージの値を保持するクラス。
     * ゲーム開発者がこのクラスのインスタンスを直接生成することはない。
     */
    var StorageValueStore = /** @class */ (function () {
        function StorageValueStore(keys, values) {
            this._keys = keys;
            this._values = values;
        }
        /**
         * 値の配列を `StorageKey` またはインデックスから取得する。
         * 通常、インデックスは `Scene` のコンストラクタに指定した `storageKeys` のインデックスに対応する。
         * @param keyOrIndex `StorageKey` 又はインデックス
         */
        StorageValueStore.prototype.get = function (keyOrIndex) {
            if (this._values === undefined) {
                return [];
            }
            if (typeof keyOrIndex === "number") {
                return this._values[keyOrIndex];
            }
            else {
                var index = this._keys.indexOf(keyOrIndex);
                if (index !== -1) {
                    return this._values[index];
                }
                for (var i = 0; i < this._keys.length; ++i) {
                    var target = this._keys[i];
                    if (target.region === keyOrIndex.region
                        && target.regionKey === keyOrIndex.regionKey
                        && target.userId === keyOrIndex.userId
                        && target.gameId === keyOrIndex.gameId) {
                        return this._values[i];
                    }
                }
            }
            return [];
        };
        /**
         * 値を `StorageKey` またはインデックスから取得する。
         * 対応する値が複数ある場合は、先頭の値を取得する。
         * 通常、インデックスは `Scene` のコンストラクタに指定した `storageKeys` のインデックスに対応する。
         * @param keyOrIndex `StorageKey` 又はインデックス
         */
        StorageValueStore.prototype.getOne = function (keyOrIndex) {
            var values = this.get(keyOrIndex);
            if (!values)
                return undefined;
            return values[0];
        };
        return StorageValueStore;
    }());
    g.StorageValueStore = StorageValueStore;
    /**
     * ストレージの値をロードするクラス。
     * ゲーム開発者がこのクラスのインスタンスを直接生成することはなく、
     * 本クラスの機能を利用することもない。
     */
    var StorageLoader = /** @class */ (function () {
        function StorageLoader(storage, keys, serialization) {
            this._loaded = false;
            this._storage = storage;
            this._valueStore = new StorageValueStore(keys);
            this._handler = undefined;
            this._valueStoreSerialization = serialization;
        }
        /**
         * @private
         */
        StorageLoader.prototype._load = function (handler) {
            this._handler = handler;
            if (this._storage._load) {
                this._storage._load.call(this._storage, this._valueStore._keys, this, this._valueStoreSerialization);
            }
        };
        /**
         * @private
         */
        // 値の取得が完了したタイミングで呼び出される。
        // `values` は `this._valueStore._keys` に対応する値を表す `StorageValue` の配列。
        // 順番は `this._valueStore._keys` と同じでなければならない。
        StorageLoader.prototype._onLoaded = function (values, serialization) {
            this._valueStore._values = values;
            this._loaded = true;
            if (serialization)
                this._valueStoreSerialization = serialization;
            if (this._handler)
                this._handler._onStorageLoaded();
        };
        /**
         * @private
         */
        StorageLoader.prototype._onError = function (error) {
            if (this._handler)
                this._handler._onStorageLoadError(error);
        };
        return StorageLoader;
    }());
    g.StorageLoader = StorageLoader;
    /**
     * ストレージ。
     * ゲーム開発者がこのクラスのインスタンスを直接生成することはない。
     */
    var Storage = /** @class */ (function () {
        function Storage(game) {
            this._game = game;
        }
        /**
         * ストレージに値を書き込む。
         * @param key ストレージキーを表す `StorageKey`
         * @param value 値を表す `StorageValue`
         * @param option 書き込みオプション
         */
        Storage.prototype.write = function (key, value, option) {
            if (this._write) {
                this._write(key, value, option);
            }
        };
        /**
         * 参加してくるプレイヤーの値をストレージから取得することを要求する。
         * 取得した値は `JoinEvent#storageValues` に格納される。
         * @param keys ストレージキーを表す `StorageReadKey` の配列。`StorageReadKey#userId` は無視される。
         */
        Storage.prototype.requestValuesForJoinPlayer = function (keys) {
            this._requestedKeysForJoinPlayer = keys;
        };
        /**
         * @private
         */
        Storage.prototype._createLoader = function (keys, serialization) {
            return new StorageLoader(this, keys, serialization);
        };
        /**
         * @private
         */
        // ストレージに値の書き込むを行う関数を登録する。
        // 登録した関数内の `this` は `Storage` を指す。
        Storage.prototype._registerWrite = function (write) {
            this._write = write;
        };
        /**
         * @private
         */
        // ストレージから値の読み込みを行う関数を登録する。
        // 登録した関数内の `this` は `Storage` を指す。
        // 読み込み完了した場合は、登録した関数内で `loader._onLoaded(values)` を呼ばなければならない。
        // エラーが発生した場合は、登録した関数内で `loader._onError(error)` を呼ばなければならない。
        Storage.prototype._registerLoad = function (load) {
            this._load = load;
        };
        return Storage;
    }());
    g.Storage = Storage;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * シーンのアセットの読み込みと破棄を管理するクラス。
     * 本クラスのインスタンスをゲーム開発者が直接生成することはなく、ゲーム開発者が利用する必要もない。
     */
    var SceneAssetHolder = /** @class */ (function () {
        function SceneAssetHolder(param) {
            this.waitingAssetsCount = param.assetIds.length;
            this._scene = param.scene;
            this._assetManager = param.assetManager;
            this._assetIds = param.assetIds;
            this._assets = [];
            this._handler = param.handler;
            this._handlerOwner = param.handlerOwner || null;
            this._direct = !!param.direct;
            this._requested = false;
        }
        SceneAssetHolder.prototype.request = function () {
            if (this.waitingAssetsCount === 0)
                return false;
            if (this._requested)
                return true;
            this._requested = true;
            this._assetManager.requestAssets(this._assetIds, this);
            return true;
        };
        SceneAssetHolder.prototype.destroy = function () {
            if (this._requested) {
                this._assetManager.unrefAssets(this._assets);
            }
            this.waitingAssetsCount = 0;
            this._scene = undefined;
            this._assetIds = undefined;
            this._handler = undefined;
            this._requested = false;
        };
        SceneAssetHolder.prototype.destroyed = function () {
            return !this._scene;
        };
        SceneAssetHolder.prototype.callHandler = function () {
            this._handler.call(this._handlerOwner);
        };
        /**
         * @private
         */
        SceneAssetHolder.prototype._onAssetError = function (asset, error, assetManager) {
            if (this.destroyed() || this._scene.destroyed())
                return;
            var failureInfo = {
                asset: asset,
                error: error,
                cancelRetry: false
            };
            this._scene.assetLoadFailed.fire(failureInfo);
            if (error.retriable && !failureInfo.cancelRetry) {
                this._assetManager.retryLoad(asset);
            }
            else {
                // game.json に定義されていればゲームを止める。それ以外 (DynamicAsset) では続行。
                if (this._assetManager.configuration[asset.id]) {
                    this._scene.game.terminateGame();
                    this._scene.game._abortGame();
                }
            }
            this._scene.assetLoadCompleted.fire(asset);
        };
        /**
         * @private
         */
        SceneAssetHolder.prototype._onAssetLoad = function (asset) {
            if (this.destroyed() || this._scene.destroyed())
                return;
            this._scene.assets[asset.id] = asset;
            this._scene.assetLoaded.fire(asset);
            this._scene.assetLoadCompleted.fire(asset);
            this._assets.push(asset);
            --this.waitingAssetsCount;
            if (this.waitingAssetsCount < 0)
                throw g.ExceptionFactory.createAssertionError("SceneAssetHolder#_onAssetLoad: broken waitingAssetsCount");
            if (this.waitingAssetsCount > 0)
                return;
            if (this._direct) {
                this.callHandler();
            }
            else {
                this._scene.game._callSceneAssetHolderHandler(this);
            }
        };
        return SceneAssetHolder;
    }());
    g.SceneAssetHolder = SceneAssetHolder;
    /**
     * そのSceneの状態を表す列挙子。
     *
     * - Destroyed: すでに破棄されているシーンで、再利用が不可能になっている状態を表す
     * - Standby: 初期化された状態のシーンで、シーンスタックへ追加されることを待っている状態を表す
     * - Active: シーンスタックの一番上にいるシーンで、ゲームのカレントシーンとして活性化されている状態を表す
     * - Deactive: シーンスタックにいるが一番上ではないシーンで、裏側で非活性状態になっていることを表す
     * - BeforeDestroyed: これから破棄されるシーンで、再利用が不可能になっている状態を表す
     */
    var SceneState;
    (function (SceneState) {
        SceneState[SceneState["Destroyed"] = 0] = "Destroyed";
        SceneState[SceneState["Standby"] = 1] = "Standby";
        SceneState[SceneState["Active"] = 2] = "Active";
        SceneState[SceneState["Deactive"] = 3] = "Deactive";
        SceneState[SceneState["BeforeDestroyed"] = 4] = "BeforeDestroyed";
    })(SceneState = g.SceneState || (g.SceneState = {}));
    var SceneLoadState;
    (function (SceneLoadState) {
        SceneLoadState[SceneLoadState["Initial"] = 0] = "Initial";
        SceneLoadState[SceneLoadState["Ready"] = 1] = "Ready";
        SceneLoadState[SceneLoadState["ReadyFired"] = 2] = "ReadyFired";
        SceneLoadState[SceneLoadState["LoadedFired"] = 3] = "LoadedFired";
    })(SceneLoadState = g.SceneLoadState || (g.SceneLoadState = {}));
    /**
     * シーンを表すクラス。
     */
    var Scene = /** @class */ (function () {
        /**
         * 各種パラメータを指定して `Scene` のインスタンスを生成する。
         * @param param 初期化に用いるパラメータのオブジェクト
         */
        function Scene(param) {
            var game;
            var local;
            var tickGenerationMode;
            var assetIds;
            game = param.game;
            assetIds = param.assetIds;
            if (!param.storageKeys) {
                this._storageLoader = undefined;
                this.storageValues = undefined;
            }
            else {
                this._storageLoader = game.storage._createLoader(param.storageKeys, param.storageValuesSerialization);
                this.storageValues = this._storageLoader._valueStore;
            }
            local = (param.local === undefined) ? g.LocalTickMode.NonLocal
                : (param.local === false) ? g.LocalTickMode.NonLocal
                    : (param.local === true) ? g.LocalTickMode.FullLocal
                        : param.local;
            tickGenerationMode = (param.tickGenerationMode !== undefined) ? param.tickGenerationMode : g.TickGenerationMode.ByClock;
            this.name = param.name;
            if (!assetIds)
                assetIds = [];
            this.game = game;
            this.local = local;
            this.tickGenerationMode = tickGenerationMode;
            this.loaded = new g.Trigger();
            this._ready = new g.Trigger();
            this.assets = {};
            this._loaded = false;
            this._prefetchRequested = false;
            this._loadingState = SceneLoadState.Initial;
            this.update = new g.Trigger();
            this._timer = new g.TimerManager(this.update, this.game.fps);
            this.assetLoaded = new g.Trigger();
            this.assetLoadFailed = new g.Trigger();
            this.assetLoadCompleted = new g.Trigger();
            this.message = new g.Trigger();
            this.pointDownCapture = new g.Trigger();
            this.pointMoveCapture = new g.Trigger();
            this.pointUpCapture = new g.Trigger();
            this.operation = new g.Trigger();
            this.children = [];
            this.state = SceneState.Standby;
            this.stateChanged = new g.Trigger();
            this._assetHolders = [];
            this._sceneAssetHolder = new SceneAssetHolder({
                scene: this,
                assetManager: this.game._assetManager,
                assetIds: assetIds,
                handler: this._onSceneAssetsLoad,
                handlerOwner: this,
                direct: true
            });
        }
        /**
         * このシーンが変更されたことをエンジンに通知する。
         *
         * このメソッドは、このシーンに紐づいている `E` の `modified()` を呼び出すことで暗黙に呼び出される。
         * 通常、ゲーム開発者がこのメソッドを呼び出す必要はない。
         * @param isBubbling この関数をこのシーンの子の `modified()` から呼び出す場合、真を渡さなくてはならない。省略された場合、偽。
         */
        Scene.prototype.modified = function (isBubbling) {
            this.game.modified = true;
        };
        /**
         * このシーンを破棄する。
         *
         * 破棄処理の開始時に、このシーンの `stateChanged` が引数 `BeforeDestroyed` でfireされる。
         * 破棄処理の終了時に、このシーンの `stateChanged` が引数 `Destroyed` でfireされる。
         * このシーンに紐づいている全ての `E` と全てのTimerは破棄される。
         * `Scene#setInterval()`, `Scene#setTimeout()` に渡された関数は呼び出されなくなる。
         *
         * このメソッドは `Scene#end` や `Game#popScene` などによって要求されたシーンの遷移時に暗黙に呼び出される。
         * 通常、ゲーム開発者がこのメソッドを呼び出す必要はない。
         */
        Scene.prototype.destroy = function () {
            this.state = SceneState.BeforeDestroyed;
            this.stateChanged.fire(this.state);
            // TODO: (GAMEDEV-483) Sceneスタックがそれなりの量になると重くなるのでScene#dbが必要かもしれない
            var gameDb = this.game.db;
            for (var p in gameDb) {
                if (gameDb.hasOwnProperty(p) && gameDb[p].scene === this)
                    gameDb[p].destroy();
            }
            var gameDb = this.game._localDb;
            for (var p in gameDb) {
                if (gameDb.hasOwnProperty(p) && gameDb[p].scene === this)
                    gameDb[p].destroy();
            }
            this._timer.destroy();
            this.update.destroy();
            this.message.destroy();
            this.pointDownCapture.destroy();
            this.pointMoveCapture.destroy();
            this.pointUpCapture.destroy();
            this.operation.destroy();
            this.loaded.destroy();
            this.assetLoaded.destroy();
            this.assetLoadFailed.destroy();
            this.assetLoadCompleted.destroy();
            this.assets = {};
            // アセットを参照しているEより先に解放しないよう最後に解放する
            for (var i = 0; i < this._assetHolders.length; ++i)
                this._assetHolders[i].destroy();
            this._sceneAssetHolder.destroy();
            this._storageLoader = undefined;
            this.game = undefined;
            this.state = SceneState.Destroyed;
            this.stateChanged.fire(this.state);
            this.stateChanged.destroy();
        };
        /**
         * 破棄済みであるかを返す。
         */
        Scene.prototype.destroyed = function () {
            return this.game === undefined;
        };
        /**
         * 一定間隔で定期的に処理を実行するTimerを作成して返す。
         *
         * 戻り値は作成されたTimerである。
         * 通常は `Scene#setInterval` を利用すればよく、ゲーム開発者がこのメソッドを呼び出す必要はない。
         * `Timer` はフレーム経過処理(`Scene#update`)で実現される疑似的なタイマーである。実時間の影響は受けない。
         * @param interval Timerの実行間隔（ミリ秒）
         */
        Scene.prototype.createTimer = function (interval) {
            return this._timer.createTimer(interval);
        };
        /**
         * Timerを削除する。
         * @param timer 削除するTimer
         */
        Scene.prototype.deleteTimer = function (timer) {
            this._timer.deleteTimer(timer);
        };
        Scene.prototype.setInterval = function (handler, interval, owner) {
            var t = this._timer;
            if (typeof handler === "number") {
                this.game.logger.warn("[deprecated] Scene#setInterval(): this arguments ordering is now deprecated. Specify the function first.");
                return (owner != null) ? t.setInterval(owner /* 2 */, handler /* 0 */, interval /* 1 */)
                    : t.setInterval(interval /* 1 */, handler /* 0 */, null);
            }
            return t.setInterval(handler, interval, owner);
        };
        /**
         * setIntervalで作成した定期処理を解除する。
         * @param identifier 解除対象
         */
        Scene.prototype.clearInterval = function (identifier) {
            this._timer.clearInterval(identifier);
        };
        Scene.prototype.setTimeout = function (handler, milliseconds, owner) {
            var t = this._timer;
            if (typeof handler === "number") {
                this.game.logger.warn("[deprecated] Scene#setTimeout(): this arguments ordering is now deprecated. Specify the function first.");
                return (owner != null) ? t.setTimeout(owner /* 2 */, handler /* 0 */, milliseconds /* 1 */)
                    : t.setTimeout(milliseconds /* 1 */, handler /* 0 */, null);
            }
            return t.setTimeout(handler, milliseconds, owner);
        };
        /**
         * setTimeoutで作成した処理を削除する。
         * @param identifier 解除対象
         */
        Scene.prototype.clearTimeout = function (identifier) {
            this._timer.clearTimeout(identifier);
        };
        /**
         * このシーンが現在のシーンであるかどうかを返す。
         */
        Scene.prototype.isCurrentScene = function () {
            return this.game.scene() === this;
        };
        /**
         * 次のシーンへの遷移を要求する。
         *
         * このメソッドは、 `toPush` が真ならば `Game#pushScene()` の、でなければ `Game#replaceScene` のエイリアスである。
         * このメソッドは要求を行うだけである。呼び出し直後にはシーン遷移は行われていないことに注意。
         * このシーンが現在のシーンでない場合、 `AssertionError` がthrowされる。
         * @param next 遷移後のシーン
         * @param toPush 現在のシーンを残したままにするなら真、削除して遷移するなら偽を指定する。省略された場合偽
         */
        Scene.prototype.gotoScene = function (next, toPush) {
            if (!this.isCurrentScene())
                throw g.ExceptionFactory.createAssertionError("Scene#gotoScene: this scene is not the current scene");
            if (toPush) {
                this.game.pushScene(next);
            }
            else {
                this.game.replaceScene(next);
            }
        };
        /**
         * このシーンの削除と、一つ前のシーンへの遷移を要求する。
         *
         * このメソッドは `Game#popScene()` のエイリアスである。
         * このメソッドは要求を行うだけである。呼び出し直後にはシーン遷移は行われていないことに注意。
         * このシーンが現在のシーンでない場合、 `AssertionError` がthrowされる。
         */
        Scene.prototype.end = function () {
            if (!this.isCurrentScene())
                throw g.ExceptionFactory.createAssertionError("Scene#end: this scene is not the current scene");
            this.game.popScene();
        };
        /**
         * このSceneにエンティティを登録する。
         *
         * このメソッドは各エンティティに対して暗黙に呼び出される。ゲーム開発者がこのメソッドを明示的に呼び出す必要はない。
         * @param e 登録するエンティティ
         */
        Scene.prototype.register = function (e) {
            this.game.register(e);
            e.scene = this;
        };
        /**
         * このSceneからエンティティの登録を削除する。
         *
         * このメソッドは各エンティティに対して暗黙に呼び出される。ゲーム開発者がこのメソッドを明示的に呼び出す必要はない。
         * @param e 登録を削除するエンティティ
         */
        Scene.prototype.unregister = function (e) {
            e.scene = undefined;
            this.game.unregister(e);
        };
        /**
         * 子エンティティを追加する。
         *
         * `this.children` の末尾に `e` を追加する(`e` はそれまでに追加されたすべての子エンティティより手前に表示される)。
         *
         * @param e 子エンティティとして追加するエンティティ
         */
        Scene.prototype.append = function (e) {
            this.insertBefore(e, undefined);
        };
        /**
         * 子エンティティを挿入する。
         *
         * `this.children` の`target`の位置に `e` を挿入する。
         * `target` が`this` の子でない場合、`append(e)`と同じ動作となる。
         *
         * @param e 子エンティティとして追加するエンティティ
         * @param target 挿入位置にある子エンティティ
         */
        Scene.prototype.insertBefore = function (e, target) {
            if (e.parent)
                e.remove();
            e.parent = this;
            var index = -1;
            if (target !== undefined && (index = this.children.indexOf(target)) > -1) {
                this.children.splice(index, 0, e);
            }
            else {
                this.children.push(e);
            }
            this.modified(true);
        };
        /**
         * 子エンティティを削除する。
         * `this` の子から `e` を削除する。 `e` が `this` の子でない場合、何もしない。
         * @param e 削除する子エンティティ
         */
        Scene.prototype.remove = function (e) {
            var index = this.children.indexOf(e);
            if (index === -1)
                return;
            this.children[index].parent = undefined;
            this.children.splice(index, 1);
            this.modified(true);
        };
        /**
         * シーン内でその座標に反応する `PointSource` を返す。
         * @param point 対象の座標
         * @param force touchable指定を無視する場合真を指定する。指定されなかった場合偽
         * @param camera 対象のカメラ。指定されなかった場合undefined
         */
        Scene.prototype.findPointSourceByPoint = function (point, force, camera) {
            var mayConsumeLocalTick = (this.local !== g.LocalTickMode.NonLocal);
            var children = this.children;
            var m = undefined;
            if (camera && camera instanceof g.Camera2D)
                m = camera.getMatrix();
            for (var i = children.length - 1; i >= 0; --i) {
                var ret = children[i].findPointSourceByPoint(point, m, force, camera);
                if (ret) {
                    ret.local = ret.target.local || mayConsumeLocalTick;
                    return ret;
                }
            }
            return { target: undefined, point: undefined, local: mayConsumeLocalTick };
        };
        /**
         * アセットの先読みを要求する。
         *
         * `Scene` に必要なアセットは、通常、`Game#pushScene()` などによるシーン遷移にともなって暗黙に読み込みが開始される。
         * ゲーム開発者はこのメソッドを呼び出すことで、シーン遷移前にアセット読み込みを開始する(先読みする)ことができる。
         * 先読み開始後、シーン遷移時までに読み込みが完了していない場合、通常の読み込み処理同様にローディングシーンが表示される。
         *
         * このメソッドは `StorageLoader` についての先読み処理を行わない点に注意。
         * ストレージの場合、書き込みが行われる可能性があるため、順序を無視して先読みすることはできない。
         */
        Scene.prototype.prefetch = function () {
            if (this._loaded) {
                // _load() 呼び出し後に prefetch() する意味はない(先読みではない)。
                return;
            }
            if (this._prefetchRequested)
                return;
            this._prefetchRequested = true;
            this._sceneAssetHolder.request();
        };
        /**
         * シーンが読み込んだストレージの値をシリアライズする。
         *
         * `Scene#storageValues` の内容をシリアライズする。
         */
        Scene.prototype.serializeStorageValues = function () {
            if (!this._storageLoader)
                return undefined;
            return this._storageLoader._valueStoreSerialization;
        };
        Scene.prototype.requestAssets = function (assetIds, handler) {
            if (this._loadingState < SceneLoadState.ReadyFired) {
                // このメソッドは読み込み完了前には呼び出せない。これは実装上の制限である。
                // やろうと思えば _load() で読み込む対象として加えることができる。が、その場合 `handler` を呼び出す方法が単純でないので対応を見送る。
                throw g.ExceptionFactory.createAssertionError("Scene#requestAsset(): can be called after loaded.");
            }
            var holder = new SceneAssetHolder({
                scene: this,
                assetManager: this.game._assetManager,
                assetIds: assetIds,
                handler: handler
            });
            this._assetHolders.push(holder);
            holder.request();
        };
        /**
         * @private
         */
        Scene.prototype._activate = function () {
            this.state = SceneState.Active;
            this.stateChanged.fire(this.state);
        };
        /**
         * @private
         */
        Scene.prototype._deactivate = function () {
            this.state = SceneState.Deactive;
            this.stateChanged.fire(this.state);
        };
        /**
         * @private
         */
        Scene.prototype._needsLoading = function () {
            return this._sceneAssetHolder.waitingAssetsCount > 0 || (this._storageLoader && !this._storageLoader._loaded);
        };
        /**
         * @private
         */
        Scene.prototype._load = function () {
            if (this._loaded)
                return;
            this._loaded = true;
            var needsWait = this._sceneAssetHolder.request();
            if (this._storageLoader) {
                this._storageLoader._load(this);
                needsWait = true;
            }
            if (!needsWait)
                this._notifySceneReady();
        };
        /**
         * @private
         */
        Scene.prototype._onSceneAssetsLoad = function () {
            if (!this._loaded) {
                // prefetch() で開始されたアセット読み込みを完了したが、_load() がまだ呼ばれていない。
                // _notifySceneReady() は _load() 呼び出し後まで遅延する。
                return;
            }
            if (this._storageLoader && !this._storageLoader._loaded) {
                // アセット読み込みを完了したが、ストレージの読み込みが終わっていない。
                // _notifySceneReady() は  _onStorageLoaded() 呼び出し後まで遅延する。
                return;
            }
            this._notifySceneReady();
        };
        /**
         * @private
         */
        Scene.prototype._onStorageLoadError = function (error) {
            this.game.terminateGame();
            this.game._abortGame();
        };
        /**
         * @private
         */
        Scene.prototype._onStorageLoaded = function () {
            if (this._sceneAssetHolder.waitingAssetsCount === 0)
                this._notifySceneReady();
        };
        /**
         * @private
         */
        Scene.prototype._notifySceneReady = function () {
            // 即座に `_ready` をfireすることはしない。tick()のタイミングで行うため、リクエストをgameに投げておく。
            this._loadingState = SceneLoadState.Ready;
            this.game._fireSceneReady(this);
        };
        /**
         * @private
         */
        Scene.prototype._fireReady = function () {
            this._ready.fire(this);
            this._loadingState = SceneLoadState.ReadyFired;
        };
        /**
         * @private
         */
        Scene.prototype._fireLoaded = function () {
            this.loaded.fire(this);
            this._loadingState = SceneLoadState.LoadedFired;
        };
        return Scene;
    }());
    g.Scene = Scene;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * Assetの読み込み中に表示されるシーン。
     *
     * 本シーンは通常のシーンと異なり、ゲーム内時間(`Game#age`)と独立に実行される。
     * アセットやストレージデータを読み込んでいる間、ゲーム内時間が進んでいない状態でも、
     * `LoadingScene` は画面に変化を与えることができる(`update` がfireされる)。
     *
     * ゲーム開発者は、ローディング中の演出を実装した独自の `LoadingScene` を
     * `Game#loadingScene` に代入することでエンジンに利用させることができる。
     *
     * ゲーム内時間と独立に処理される `LoadingScene` での処理には再現性がない(他プレイヤーと状態が共有されない)。
     * そのため `Game` に対して副作用のある操作を行ってはならない点に注意すること。
     */
    var LoadingScene = /** @class */ (function (_super) {
        __extends(LoadingScene, _super);
        /**
         * `LoadingScene` のインスタンスを生成する。
         * @param param 初期化に用いるパラメータのオブジェクト
         */
        function LoadingScene(param) {
            var _this = this;
            param.local = true; // LoadingScene は強制的にローカルにする
            _this = _super.call(this, param) || this;
            _this.targetReset = new g.Trigger();
            _this.targetReady = new g.Trigger();
            _this.targetAssetLoaded = new g.Trigger();
            _this._explicitEnd = !!param.explicitEnd;
            _this._targetScene = undefined;
            return _this;
        }
        LoadingScene.prototype.destroy = function () {
            this._clearTargetScene();
            _super.prototype.destroy.call(this);
        };
        /**
         * アセットロード待ち対象シーンを変更する。
         *
         * このメソッドは、新たにシーンのロード待ちが必要になった場合にエンジンによって呼び出される。
         * (派生クラスはこの処理をオーバーライドしてもよいが、その場合その中で
         * このメソッド自身 (`g.LoadingScene.prototype.reset`) を呼び出す (`call()` する) 必要がある。)
         *
         * @param targetScene アセットロード待ちが必要なシーン
         */
        LoadingScene.prototype.reset = function (targetScene) {
            this._clearTargetScene();
            this._targetScene = targetScene;
            if (this._loadingState < g.SceneLoadState.LoadedFired) {
                this.loaded.addOnce(this._doReset, this);
            }
            else {
                this._doReset();
            }
        };
        /**
         * アセットロード待ち対象シーンの残りのロード待ちアセット数を取得する。
         */
        LoadingScene.prototype.getTargetWaitingAssetsCount = function () {
            return this._targetScene ? this._targetScene._sceneAssetHolder.waitingAssetsCount : 0;
        };
        /**
         * ローディングシーンを終了する。
         *
         * `Scene#end()` と異なり、このメソッドの呼び出しはこのシーンを破棄しない。(ローディングシーンは再利用される。)
         * このメソッドが呼び出される時、 `targetReady` がfireされた後でなければならない。
         */
        LoadingScene.prototype.end = function () {
            if (!this._targetScene || this._targetScene._loadingState < g.SceneLoadState.Ready) {
                var state = this._targetScene ? g.SceneLoadState[this._targetScene._loadingState] : "(no scene)";
                var msg = "LoadingScene#end(): the target scene is in invalid state: " + state;
                throw g.ExceptionFactory.createAssertionError(msg);
            }
            this.game.popScene(true);
            this.game._fireSceneLoaded(this._targetScene);
            this._clearTargetScene();
        };
        /**
         * @private
         */
        LoadingScene.prototype._clearTargetScene = function () {
            if (!this._targetScene)
                return;
            this._targetScene._ready.removeAll({ owner: this });
            this._targetScene.assetLoaded.removeAll({ owner: this });
            this._targetScene = undefined;
        };
        /**
         * @private
         */
        LoadingScene.prototype._doReset = function () {
            this.targetReset.fire(this._targetScene);
            if (this._targetScene._loadingState < g.SceneLoadState.ReadyFired) {
                this._targetScene._ready.add(this._fireTriggerOnTargetReady, this);
                this._targetScene.assetLoaded.add(this._fireTriggerOnTargetAssetLoad, this);
                this._targetScene._load();
            }
            else {
                this._fireTriggerOnTargetReady(this._targetScene);
            }
        };
        /**
         * @private
         */
        LoadingScene.prototype._fireTriggerOnTargetAssetLoad = function (asset) {
            this.targetAssetLoaded.fire(asset);
        };
        /**
         * @private
         */
        LoadingScene.prototype._fireTriggerOnTargetReady = function (scene) {
            this.targetReady.fire(scene);
            if (!this._explicitEnd) {
                this.end();
            }
        };
        return LoadingScene;
    }(g.Scene));
    g.LoadingScene = LoadingScene;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * カメラのtransformを戻すエンティティ。
     * LoadingSceneのインジケータがカメラの影響を受けないようにするための内部エンティティ。
     */
    var CameraCancellingE = /** @class */ (function (_super) {
        __extends(CameraCancellingE, _super);
        function CameraCancellingE(param) {
            var _this = _super.call(this, param) || this;
            _this._canceller = new g.Object2D();
            return _this;
        }
        CameraCancellingE.prototype.renderSelf = function (renderer, camera) {
            if (!this.children)
                return false;
            if (camera) {
                var c = camera;
                var canceller = this._canceller;
                if (c.x !== canceller.x || c.y !== canceller.y || c.angle !== canceller.angle ||
                    c.scaleX !== canceller.scaleX || c.scaleY !== canceller.scaleY) {
                    canceller.x = c.x;
                    canceller.y = c.y;
                    canceller.angle = c.angle;
                    canceller.scaleX = c.scaleX;
                    canceller.scaleY = c.scaleY;
                    if (canceller._matrix) {
                        canceller._matrix._modified = true;
                    }
                }
                renderer.save();
                renderer.transform(canceller.getMatrix()._matrix);
            }
            // Note: concatしていないのでunsafeだが、render中に配列の中身が変わる事はない前提とする
            var children = this.children;
            for (var i = 0; i < children.length; ++i)
                children[i].render(renderer, camera);
            if (camera) {
                renderer.restore();
            }
            return false;
        };
        return CameraCancellingE;
    }(g.E));
    /**
     * デフォルトローディングシーン。
     *
     * `Game#_defaultLoadingScene` の初期値として利用される。
     * このシーンはいかなるアセットも用いてはならない。
     */
    var DefaultLoadingScene = /** @class */ (function (_super) {
        __extends(DefaultLoadingScene, _super);
        /**
         * `DeafultLoadingScene` のインスタンスを生成する。
         * @param param 初期化に用いるパラメータのオブジェクト
         */
        function DefaultLoadingScene(param) {
            var _this = _super.call(this, { game: param.game, name: "akashic:default-loading-scene" }) || this;
            _this._barWidth = Math.min(param.game.width, Math.max(100, param.game.width / 2));
            _this._barHeight = 5;
            _this._gauge = undefined;
            _this._gaugeUpdateCount = 0;
            _this._totalWaitingAssetCount = 0;
            _this.loaded.handle(_this, _this._onLoaded);
            _this.targetReset.handle(_this, _this._onTargetReset);
            _this.targetAssetLoaded.handle(_this, _this._onTargetAssetLoaded);
            return _this;
        }
        /**
         * @private
         */
        DefaultLoadingScene.prototype._onLoaded = function () {
            var gauge;
            this.append(new CameraCancellingE({
                scene: this,
                children: [
                    new g.FilledRect({
                        scene: this,
                        width: this.game.width,
                        height: this.game.height,
                        cssColor: "rgba(0, 0, 0, 0.8)",
                        children: [
                            new g.FilledRect({
                                scene: this,
                                x: (this.game.width - this._barWidth) / 2,
                                y: (this.game.height - this._barHeight) / 2,
                                width: this._barWidth,
                                height: this._barHeight,
                                cssColor: "gray",
                                children: [
                                    gauge = new g.FilledRect({
                                        scene: this,
                                        width: 0,
                                        height: this._barHeight,
                                        cssColor: "white"
                                    })
                                ]
                            })
                        ]
                    })
                ]
            }));
            gauge.update.handle(this, this._onUpdateGuage);
            this._gauge = gauge;
            return true; // Trigger 登録を解除する
        };
        /**
         * @private
         */
        DefaultLoadingScene.prototype._onUpdateGuage = function () {
            var BLINK_RANGE = 50;
            var BLINK_PER_SEC = 2 / 3;
            ++this._gaugeUpdateCount;
            // 白を上限に sin 波で明滅させる (updateしていることの確認)
            var c = Math.round((255 - BLINK_RANGE)
                + Math.sin((this._gaugeUpdateCount / this.game.fps * BLINK_PER_SEC) * (2 * Math.PI)) * BLINK_RANGE);
            this._gauge.cssColor = "rgb(" + c + "," + c + "," + c + ")";
            this._gauge.modified();
        };
        /**
         * @private
         */
        DefaultLoadingScene.prototype._onTargetReset = function (targetScene) {
            if (this._gauge) {
                this._gauge.width = 0;
                this._gauge.modified();
            }
            this._totalWaitingAssetCount = targetScene._sceneAssetHolder.waitingAssetsCount;
        };
        /**
         * @private
         */
        DefaultLoadingScene.prototype._onTargetAssetLoaded = function (asset) {
            var waitingAssetsCount = this._targetScene._sceneAssetHolder.waitingAssetsCount;
            this._gauge.width = Math.ceil((1 - waitingAssetsCount / this._totalWaitingAssetCount) * this._barWidth);
            this._gauge.modified();
        };
        return DefaultLoadingScene;
    }(g.LoadingScene));
    g.DefaultLoadingScene = DefaultLoadingScene;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 画像を描画するエンティティ。
     */
    var Sprite = /** @class */ (function (_super) {
        __extends(Sprite, _super);
        /**
         * 各種パラメータを指定して `Sprite` のインスタンスを生成する。
         * @param param `Sprite` に設定するパラメータ
         */
        function Sprite(param) {
            var _this = _super.call(this, param) || this;
            _this.surface = g.Util.asSurface(param.src);
            if (!("width" in param))
                _this.width = _this.surface.width;
            if (!("height" in param))
                _this.height = _this.surface.height;
            _this.srcWidth = "srcWidth" in param ? param.srcWidth : _this.width;
            _this.srcHeight = "srcHeight" in param ? param.srcHeight : _this.height;
            _this.srcX = param.srcX || 0;
            _this.srcY = param.srcY || 0;
            _this._stretchMatrix = undefined;
            _this._beforeSurface = _this.surface;
            g.Util.setupAnimatingHandler(_this, _this.surface);
            _this._invalidateSelf();
            return _this;
        }
        /**
         * @private
         */
        Sprite.prototype._onUpdate = function () {
            this.modified();
        };
        /**
         * @private
         */
        Sprite.prototype._onAnimatingStarted = function () {
            if (!this.update.contains(this._onUpdate, this)) {
                this.update.add(this._onUpdate, this);
            }
        };
        /**
         * @private
         */
        Sprite.prototype._onAnimatingStopped = function () {
            if (!this.destroyed()) {
                this.update.remove(this._onUpdate, this);
            }
        };
        /**
         * このエンティティ自身の描画を行う。
         * このメソッドはエンジンから暗黙に呼び出され、ゲーム開発者が呼び出す必要はない。
         */
        Sprite.prototype.renderSelf = function (renderer, camera) {
            if (this.srcWidth <= 0 || this.srcHeight <= 0) {
                return true;
            }
            if (this._stretchMatrix) {
                renderer.save();
                renderer.transform(this._stretchMatrix._matrix);
            }
            renderer.drawImage(this.surface, this.srcX, this.srcY, this.srcWidth, this.srcHeight, 0, 0);
            if (this._stretchMatrix)
                renderer.restore();
            return true;
        };
        /**
         * このエンティティの描画キャッシュ無効化をエンジンに通知する。
         * このメソッドを呼び出し後、描画キャッシュの再構築が行われ、各 `Renderer` に描画内容の変更が反映される。
         */
        Sprite.prototype.invalidate = function () {
            this._invalidateSelf();
            this.modified();
        };
        /**
         * このエンティティを破棄する。
         * デフォルトでは利用している `Surface` の破棄は行わない点に注意。
         * @param destroySurface trueを指定した場合、このエンティティが抱える `Surface` も合わせて破棄する
         */
        Sprite.prototype.destroy = function (destroySurface) {
            if (this.surface && !this.surface.destroyed()) {
                if (destroySurface) {
                    this.surface.destroy();
                }
                else if (this.surface.isDynamic) {
                    this.surface.animatingStarted.remove(this._onAnimatingStarted, this);
                    this.surface.animatingStopped.remove(this._onAnimatingStopped, this);
                }
            }
            this.surface = undefined;
            _super.prototype.destroy.call(this);
        };
        Sprite.prototype._invalidateSelf = function () {
            if (this.width === this.srcWidth && this.height === this.srcHeight) {
                this._stretchMatrix = undefined;
            }
            else {
                this._stretchMatrix = g.Util.createMatrix();
                this._stretchMatrix.scale(this.width / this.srcWidth, this.height / this.srcHeight);
            }
            if (this.surface !== this._beforeSurface) {
                g.Util.migrateAnimatingHandler(this, this._beforeSurface, this.surface);
                this._beforeSurface = this.surface;
            }
        };
        return Sprite;
    }(g.E));
    g.Sprite = Sprite;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * フレームとタイマーによるアニメーション機構を持つ `Sprite` 。
     *
     * このクラスは、コンストラクタで渡された画像を、
     * 幅 `srcWidth`, 高さ `srcHeight` 単位で区切られた小さな画像(以下、画像片)の集まりであると解釈する。
     * 各画像片は、左上から順に 0 から始まるインデックスで参照される。
     *
     * ゲーム開発者は、このインデックスからなる配列を `FrameSprite#frames` に設定する。
     * `FrameSprite` は、 `frames` に指定されたインデックス(が表す画像片)を順番に描画することでアニメーションを実現する。
     * アニメーションは `interval` ミリ秒ごとに進み、 `frames` の内容をループする。
     *
     * このクラスにおける `srcWidth`, `srcHeight` の扱いは、親クラスである `Sprite` とは異なっていることに注意。
     */
    var FrameSprite = /** @class */ (function (_super) {
        __extends(FrameSprite, _super);
        /**
         * 各種パラメータを指定して `FrameSprite` のインスタンスを生成する。
         * @param param `FrameSprite` に設定するパラメータ
         */
        function FrameSprite(param) {
            var _this = _super.call(this, param) || this;
            _this._lastUsedIndex = 0;
            _this.frameNumber = param.frameNumber || 0;
            _this.frames = "frames" in param ? param.frames : [0];
            _this.interval = param.interval;
            _this._timer = undefined;
            _this.loop = param.loop != null ? param.loop : true;
            _this.finished = new g.Trigger();
            _this._modifiedSelf();
            return _this;
        }
        /**
         * `Sprite` から `FrameSprite` を作成する。
         * @param sprite 画像として使う`Sprite`
         * @param width 作成されるエンティティの高さ。省略された場合、 `sprite.width`
         * @param hegith 作成されるエンティティの高さ。省略された場合、 `sprite.height`
         */
        FrameSprite.createBySprite = function (sprite, width, height) {
            var frameSprite = new FrameSprite({
                scene: sprite.scene,
                src: sprite.surface,
                width: width === undefined ? sprite.width : width,
                height: height === undefined ? sprite.height : height
            });
            frameSprite.srcHeight = height === undefined ? sprite.srcHeight : height;
            frameSprite.srcWidth = width === undefined ? sprite.srcWidth : width;
            return frameSprite;
        };
        /**
         * アニメーションを開始する。
         */
        FrameSprite.prototype.start = function () {
            if (this.interval === undefined)
                this.interval = 1000 / this.game().fps;
            if (this._timer)
                this._free();
            this._timer = this.scene.createTimer(this.interval);
            this._timer.elapsed.add(this._onElapsed, this);
        };
        /**
         * このエンティティを破棄する。
         * デフォルトでは利用している `Surface` の破棄は行わない点に注意。
         * @param destroySurface trueを指定した場合、このエンティティが抱える `Surface` も合わせて破棄する
         */
        FrameSprite.prototype.destroy = function (destroySurface) {
            this.stop();
            _super.prototype.destroy.call(this, destroySurface);
        };
        /**
         * アニメーションを停止する。
         */
        FrameSprite.prototype.stop = function () {
            if (this._timer)
                this._free();
        };
        /**
         * このエンティティに対する変更をエンジンに通知する。詳細は `E#modified()` のドキュメントを参照。
         */
        FrameSprite.prototype.modified = function (isBubbling) {
            this._modifiedSelf(isBubbling);
            _super.prototype.modified.call(this, isBubbling);
        };
        /**
         * @private
         */
        FrameSprite.prototype._onElapsed = function () {
            if (this.frameNumber === this.frames.length - 1) {
                if (this.loop) {
                    this.frameNumber = 0;
                }
                else {
                    this.stop();
                    this.finished.fire();
                }
            }
            else {
                this.frameNumber++;
            }
            this.modified();
        };
        /**
         * @private
         */
        FrameSprite.prototype._free = function () {
            if (!this._timer)
                return;
            this._timer.elapsed.remove(this._onElapsed, this);
            if (this._timer.canDelete())
                this.scene.deleteTimer(this._timer);
            this._timer = undefined;
        };
        /**
         * @private
         */
        FrameSprite.prototype._changeFrame = function () {
            var frame = this.frames[this.frameNumber];
            var sep = Math.floor(this.surface.width / this.srcWidth);
            this.srcX = (frame % sep) * this.srcWidth;
            this.srcY = Math.floor(frame / sep) * this.srcHeight;
            this._lastUsedIndex = frame;
        };
        FrameSprite.prototype._modifiedSelf = function (isBubbling) {
            if (this._lastUsedIndex !== this.frames[this.frameNumber])
                this._changeFrame();
        };
        return FrameSprite;
    }(g.Sprite));
    g.FrameSprite = FrameSprite;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * イベントの種別。
     */
    var EventType;
    (function (EventType) {
        /**
         * 不明なイベント。
         * ゲーム開発者はこの値を利用してはならない。
         */
        EventType[EventType["Unknown"] = 0] = "Unknown";
        /**
         * プレイヤーの参加を表すイベント。
         */
        EventType[EventType["Join"] = 1] = "Join";
        /**
         * プレイヤーの離脱を表すイベント。
         */
        EventType[EventType["Leave"] = 2] = "Leave";
        /**
         * タイムスタンプを表すイベント。
         */
        EventType[EventType["Timestamp"] = 3] = "Timestamp";
        /**
         * 乱数生成器の生成を表すイベント。
         * この値は利用されていない。
         */
        EventType[EventType["Seed"] = 4] = "Seed";
        /**
         * ポイントダウンイベント。
         */
        EventType[EventType["PointDown"] = 5] = "PointDown";
        /**
         * ポイントムーブイベント。
         */
        EventType[EventType["PointMove"] = 6] = "PointMove";
        /**
         * ポイントアップイベント。
         */
        EventType[EventType["PointUp"] = 7] = "PointUp";
        /**
         * 汎用的なメッセージを表すイベント。
         */
        EventType[EventType["Message"] = 8] = "Message";
        /**
         * 操作プラグインが通知する操作を表すイベント。
         */
        EventType[EventType["Operation"] = 9] = "Operation";
    })(EventType = g.EventType || (g.EventType = {}));
    /**
     * ポインティング操作を表すイベント。
     * PointEvent#targetでそのポインティング操作の対象となったエンティティが、
     * PointEvent#pointでそのエンティティから見ての相対座標が取得できる。
     *
     * 本イベントはマルチタッチに対応しており、PointEvent#pointerIdを参照することで識別することが出来る。
     *
     * abstract
     */
    var PointEvent = /** @class */ (function () {
        function PointEvent(pointerId, target, point, player, local, priority) {
            this.priority = priority;
            this.local = local;
            this.player = player;
            this.pointerId = pointerId;
            this.target = target;
            this.point = point;
        }
        return PointEvent;
    }());
    g.PointEvent = PointEvent;
    /**
     * ポインティング操作の開始を表すイベント。
     */
    var PointDownEvent = /** @class */ (function (_super) {
        __extends(PointDownEvent, _super);
        function PointDownEvent(pointerId, target, point, player, local, priority) {
            var _this = _super.call(this, pointerId, target, point, player, local, priority) || this;
            _this.type = EventType.PointDown;
            return _this;
        }
        return PointDownEvent;
    }(PointEvent));
    g.PointDownEvent = PointDownEvent;
    /**
     * ポインティング操作の終了を表すイベント。
     * PointDownEvent後にのみ発生する。
     *
     * PointUpEvent#startDeltaによってPointDownEvent時からの移動量が、
     * PointUpEvent#prevDeltaによって直近のPointMoveEventからの移動量が取得出来る。
     * PointUpEvent#pointにはPointDownEvent#pointと同じ値が格納される。
     */
    var PointUpEvent = /** @class */ (function (_super) {
        __extends(PointUpEvent, _super);
        function PointUpEvent(pointerId, target, point, prevDelta, startDelta, player, local, priority) {
            var _this = _super.call(this, pointerId, target, point, player, local, priority) || this;
            _this.type = EventType.PointUp;
            _this.prevDelta = prevDelta;
            _this.startDelta = startDelta;
            return _this;
        }
        return PointUpEvent;
    }(PointEvent));
    g.PointUpEvent = PointUpEvent;
    /**
     * ポインティング操作の移動を表すイベント。
     * PointDownEvent後にのみ発生するため、MouseMove相当のものが本イベントとして発生することはない。
     *
     * PointMoveEvent#startDeltaによってPointDownEvent時からの移動量が、
     * PointMoveEvent#prevDeltaによって直近のPointMoveEventからの移動量が取得出来る。
     * PointMoveEvent#pointにはPointMoveEvent#pointと同じ値が格納される。
     *
     * 本イベントは、プレイヤーがポインティングデバイスを移動していなくても、
     * カメラの移動等視覚的にポイントが変化している場合にも発生する。
     */
    var PointMoveEvent = /** @class */ (function (_super) {
        __extends(PointMoveEvent, _super);
        function PointMoveEvent(pointerId, target, point, prevDelta, startDelta, player, local, priority) {
            var _this = _super.call(this, pointerId, target, point, player, local, priority) || this;
            _this.type = EventType.PointMove;
            _this.prevDelta = prevDelta;
            _this.startDelta = startDelta;
            return _this;
        }
        return PointMoveEvent;
    }(PointEvent));
    g.PointMoveEvent = PointMoveEvent;
    /**
     * 汎用的なメッセージを表すイベント。
     * MessageEvent#dataによってメッセージ内容を取得出来る。
     */
    var MessageEvent = /** @class */ (function () {
        function MessageEvent(data, player, local, priority) {
            this.type = EventType.Message;
            this.priority = priority;
            this.local = local;
            this.player = player;
            this.data = data;
        }
        return MessageEvent;
    }());
    g.MessageEvent = MessageEvent;
    /**
     * 操作プラグインが通知する操作を表すイベント。
     * プラグインを識別する `OperationEvent#code` と、プラグインごとの内容 `OperationEvent#data` を持つ。
     */
    var OperationEvent = /** @class */ (function () {
        function OperationEvent(code, data, player, local, priority) {
            this.type = EventType.Operation;
            this.priority = priority;
            this.local = local;
            this.player = player;
            this.code = code;
            this.data = data;
        }
        return OperationEvent;
    }());
    g.OperationEvent = OperationEvent;
    /**
     * プレイヤーの参加を表すイベント。
     * JoinEvent#playerによって、参加したプレイヤーを取得出来る。
     */
    var JoinEvent = /** @class */ (function () {
        function JoinEvent(player, storageValues, priority) {
            this.type = EventType.Join;
            this.priority = priority;
            this.player = player;
            this.storageValues = storageValues;
        }
        return JoinEvent;
    }());
    g.JoinEvent = JoinEvent;
    /**
     * プレイヤーの離脱を表すイベント。
     * LeaveEvent#playerによって、離脱したプレイヤーを取得出来る。
     */
    var LeaveEvent = /** @class */ (function () {
        function LeaveEvent(player, priority) {
            this.type = EventType.Leave;
            this.priority = priority;
            this.player = player;
        }
        return LeaveEvent;
    }());
    g.LeaveEvent = LeaveEvent;
    /**
     * タイムスタンプを表すイベント。
     */
    var TimestampEvent = /** @class */ (function () {
        function TimestampEvent(timestamp, player, priority) {
            this.type = EventType.Timestamp;
            this.priority = priority;
            this.player = player;
            this.timestamp = timestamp;
        }
        return TimestampEvent;
    }());
    g.TimestampEvent = TimestampEvent;
    /**
     * 新しい乱数の発生を表すイベント。
     * SeedEvent#generatorによって、本イベントで発生したRandomGeneratorを取得出来る。
     */
    var SeedEvent = /** @class */ (function () {
        function SeedEvent(generator, priority) {
            this.type = EventType.Seed;
            this.priority = priority;
            this.generator = generator;
        }
        return SeedEvent;
    }());
    g.SeedEvent = SeedEvent;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * ログレベル。
     *
     * - Error: サーバ側でも収集される、ゲーム続行不可能なクリティカルなエラーログ
     * - Warn: サーバ側でも収集される、ゲーム続行可能だが危険な状態であることを示す警告ログ
     * - Info: クライアントでのみ収集される情報ログ
     * - Debug: サンドボックス環境でのみ収集される開発時限定のログ。リリース時には本処理をすべて消してリリースすることが望ましい
     */
    var LogLevel;
    (function (LogLevel) {
        LogLevel[LogLevel["Error"] = 0] = "Error";
        LogLevel[LogLevel["Warn"] = 1] = "Warn";
        LogLevel[LogLevel["Info"] = 2] = "Info";
        LogLevel[LogLevel["Debug"] = 3] = "Debug";
    })(LogLevel = g.LogLevel || (g.LogLevel = {}));
    /**
     * デバッグ/エラー用のログ出力機構。
     */
    var Logger = /** @class */ (function () {
        /**
         * `Logger` のインスタンスを生成する。
         * @param game この `Logger` に紐づく `Game` 。
         */
        function Logger(game) {
            this.game = game;
            this.logging = new g.Trigger();
        }
        Logger.prototype.destroy = function () {
            this.game = undefined;
            this.logging.destroy();
            this.logging = undefined;
        };
        Logger.prototype.destroyed = function () {
            return !this.game;
        };
        /**
         * `LogLevel.Error` のログを出力する。
         * @param message ログメッセージ
         * @param cause 追加の補助情報。省略された場合、 `undefined`
         * @deprecated このメソッドは非推奨である。ゲーム開発者はこのメソッドではなく単に `console.error()` や `console.log()` を利用すべきである。
         */
        Logger.prototype.error = function (message, cause) {
            this.logging.fire({
                game: this.game,
                level: LogLevel.Error,
                message: message,
                cause: cause
            });
        };
        /**
         * `LogLevel.Warn` のログを出力する。
         * @param message ログメッセージ
         * @param cause 追加の補助情報。省略された場合、 `undefined`
         * @deprecated このメソッドは非推奨である。ゲーム開発者はこのメソッドではなく単に `console.warn()` や `console.log()` を利用すべきである。
         */
        Logger.prototype.warn = function (message, cause) {
            this.logging.fire({
                game: this.game,
                level: LogLevel.Warn,
                message: message,
                cause: cause
            });
        };
        /**
         * `LogLevel.Info` のログを出力する。
         * @param message ログメッセージ
         * @param cause 追加の補助情報。省略された場合、 `undefined`
         * @deprecated このメソッドは非推奨である。ゲーム開発者はこのメソッドではなく単に `console.info()` や `console.log()` を利用すべきである。
         */
        Logger.prototype.info = function (message, cause) {
            this.logging.fire({
                game: this.game,
                level: LogLevel.Info,
                message: message,
                cause: cause
            });
        };
        /**
         * `LogLevel.Debug` のログを出力する。
         * @param message ログメッセージ
         * @param cause 追加の補助情報。省略された場合、 `undefined`
         * @deprecated このメソッドは非推奨である。ゲーム開発者はこのメソッドではなく単に `console.debug()` や `console.log()` を利用すべきである。
         */
        Logger.prototype.debug = function (message, cause) {
            this.logging.fire({
                game: this.game,
                level: LogLevel.Debug,
                message: message,
                cause: cause
            });
        };
        return Logger;
    }());
    g.Logger = Logger;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * コンテンツそのものを表すクラス。
     *
     * 本クラスのインスタンスは暗黙に生成され、ゲーム開発者が生成することはない。
     * ゲーム開発者はg.gameによって本クラスのインスタンスを参照できる。
     *
     * 多くの機能を持つが、本クラスをゲーム開発者が利用するのは以下のようなケースである。
     * 1. Sceneの生成時、コンストラクタに引数として渡す
     * 2. Sceneに紐付かないイベント Game#join, Game#leave, Game#seed を処理する
     * 3. 乱数を発生させるため、Game#randomにアクセスしRandomGeneratorを取得する
     * 4. ログを出力するため、Game#loggerでコンテンツに紐付くLoggerを取得する
     * 5. ゲームのメタ情報を確認するため、Game#width, Game#height, Game#fpsにアクセスする
     * 6. グローバルアセットを取得するため、Game#assetsにアクセスする
     * 7. LoadingSceneを変更するため、Game#loadingSceneにゲーム開発者の定義したLoadingSceneを指定する
     * 8. スナップショット機能を作るため、Game#snapshotRequestにアクセスする
     * 9. 現在フォーカスされているCamera情報を得るため、Game#focusingCameraにアクセスする
     * 10.AudioSystemを直接制御するため、Game#audioにアクセスする
     * 11.Sceneのスタック情報を調べるため、Game#scenesにアクセスする
     */
    var Game = /** @class */ (function () {
        /**
         * `Game` のインスタンスを生成する。
         * @param gameConfiguration この `Game` の設定。典型的には game.json の内容をパースしたものを期待する
         * @param resourceFactory この `Game` が用いる、リソースのファクトリ
         * @param assetBase アセットのパスの基準となるディレクトリ。省略された場合、空文字列
         * @param selfId このゲームを実行するユーザのID。省略された場合、`undefined`
         * @param operationPluginViewInfo このゲームの操作プラグインに与えるviewの情報
         */
        function Game(gameConfiguration, resourceFactory, assetBase, selfId, operationPluginViewInfo) {
            gameConfiguration = this._normalizeConfiguration(gameConfiguration);
            this.fps = gameConfiguration.fps;
            this.width = gameConfiguration.width;
            this.height = gameConfiguration.height;
            this.renderers = [];
            this.scenes = [];
            this.random = null;
            this.age = 0;
            this.assetBase = assetBase || "";
            this.resourceFactory = resourceFactory;
            this.selfId = selfId || undefined;
            this.playId = undefined;
            this.isSkipping = false;
            this.joinedPlayerIds = [];
            this._audioSystemManager = new g.AudioSystemManager(this);
            this.audio = {
                music: new g.MusicAudioSystem("music", this),
                sound: new g.SoundAudioSystem("sound", this)
            };
            this.defaultAudioSystemId = "sound";
            this.storage = new g.Storage(this);
            this.assets = {};
            this.surfaceAtlasSet = undefined;
            // TODO: (GAMEDEV-666) この三つのイベントはGame自身がデフォルトのイベントハンドラを持って処理する必要があるかも
            this.join = new g.Trigger();
            this.leave = new g.Trigger();
            this.seed = new g.Trigger();
            this._eventTriggerMap = {};
            this._eventTriggerMap[g.EventType.Join] = this.join;
            this._eventTriggerMap[g.EventType.Leave] = this.leave;
            this._eventTriggerMap[g.EventType.Seed] = this.seed;
            this._eventTriggerMap[g.EventType.Message] = undefined;
            this._eventTriggerMap[g.EventType.PointDown] = undefined;
            this._eventTriggerMap[g.EventType.PointMove] = undefined;
            this._eventTriggerMap[g.EventType.PointUp] = undefined;
            this._eventTriggerMap[g.EventType.Operation] = undefined;
            this.resized = new g.Trigger();
            this.skippingChanged = new g.Trigger();
            this.isLastTickLocal = true;
            this.lastOmittedLocalTickCount = 0;
            this._loaded = new g.Trigger();
            this._started = new g.Trigger();
            this.isLoaded = false;
            this.snapshotRequest = new g.Trigger();
            this.external = {};
            this.logger = new g.Logger(this);
            this._main = gameConfiguration.main;
            this._mainParameter = undefined;
            this._configuration = gameConfiguration;
            this._assetManager = new g.AssetManager(this, gameConfiguration.assets, gameConfiguration.audio, gameConfiguration.moduleMainScripts);
            var operationPluginsField = (gameConfiguration.operationPlugins || []);
            this._operationPluginManager = new g.OperationPluginManager(this, operationPluginViewInfo, operationPluginsField);
            this._operationPluginOperated = new g.Trigger();
            this._operationPluginManager.operated.add(this._operationPluginOperated.fire, this._operationPluginOperated);
            this._sceneChanged = new g.Trigger();
            this._sceneChanged.add(this._updateEventTriggers, this);
            this._initialScene = new g.Scene({
                game: this,
                assetIds: this._assetManager.globalAssetIds(),
                local: true,
                name: "akashic:initial-scene"
            });
            this._initialScene.loaded.add(this._onInitialSceneLoaded, this);
            this._reset({ age: 0 });
        }
        Object.defineProperty(Game.prototype, "focusingCamera", {
            /**
             * 使用中のカメラ。
             *
             * `Game#draw()`, `Game#findPointSource()` のデフォルト値として使用される。
             * この値を変更した場合、変更を描画に反映するためには `Game#modified` に真を代入しなければならない。
             * (ただしこの値が非 `undefined` の時、`Game#focusingCamera.modified()` を呼び出す場合は
             * `Game#modified` の操作は省略できる。)
             */
            // focusingCameraが変更されても古いカメラをtargetCamerasに持つエンティティのEntityStateFlags.Modifiedを取りこぼすことが無いように、変更時にはrenderを呼べるようアクセサを使う
            get: function () {
                return this._focusingCamera;
            },
            set: function (c) {
                if (c === this._focusingCamera)
                    return;
                if (this.modified)
                    this.render(this._focusingCamera);
                this._focusingCamera = c;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * シーンスタックへのシーンの追加と、そのシーンへの遷移を要求する。
         *
         * このメソッドは要求を行うだけである。呼び出し直後にはシーン遷移は行われていないことに注意。
         * 実際のシーン遷移は次のフレームまでに(次のupdateのfireまでに)行われる。
         * このメソッドの呼び出しにより、現在のシーンの `stateChanged` が引数 `SceneState.Deactive` でfireされる。
         * その後 `scene.stateChanged` が引数 `SceneState.Active` でfireされる。
         * @param scene 遷移後のシーン
         */
        Game.prototype.pushScene = function (scene) {
            this._sceneChangeRequests.push({ type: 0 /* Push */, scene: scene });
        };
        /**
         * 現在のシーンの置き換えを要求する。
         *
         * 現在のシーンをシーンスタックから取り除き、指定のシーンを追加することを要求する。
         * このメソッドは要求を行うだけである。呼び出し直後にはシーン遷移は行われていないことに注意。
         * 実際のシーン遷移は次のフレームまでに(次のupdateのfireまでに)行われる。
         * 引数 `preserveCurrent` が偽の場合、このメソッドの呼び出しにより現在のシーンは破棄される。
         * またその時 `stateChanged` が引数 `SceneState.Destroyed` でfireされる。
         * その後 `scene.stateChanged` が引数 `SceneState.Active` でfireされる。
         *
         * @param scene 遷移後のシーン
         * @param preserveCurrent 真の場合、現在のシーンを破棄しない(ゲーム開発者が明示的に破棄せねばならない)。省略された場合、偽
         */
        Game.prototype.replaceScene = function (scene, preserveCurrent) {
            this._sceneChangeRequests.push({ type: 1 /* Replace */, scene: scene, preserveCurrent: preserveCurrent });
        };
        /**
         * 一つ前のシーンに戻ることを要求する。
         *
         * このメソッドは要求を行うだけである。呼び出し直後にはシーン遷移は行われていないことに注意。
         * 実際のシーン遷移は次のフレームまでに(次のupdateのfireまでに)行われる。
         * 引数 `preserveCurrent` が偽の場合、このメソッドの呼び出しにより現在のシーンは破棄される。
         * またその時 `stateChanged` が引数 `SceneState.Destroyed` でfireされる。
         * その後一つ前のシーンの `stateChanged` が引数 `SceneState.Active` でfireされる。
         *
         * @param preserveCurrent 真の場合、現在のシーンを破棄しない(ゲーム開発者が明示的に破棄せねばならない)。省略された場合、偽
         */
        Game.prototype.popScene = function (preserveCurrent) {
            this._sceneChangeRequests.push({ type: 2 /* Pop */, preserveCurrent: preserveCurrent });
        };
        /**
         * 現在のシーンを返す。
         * ない場合、 `undefined` を返す。
         */
        Game.prototype.scene = function () {
            if (!this.scenes.length)
                return undefined;
            return this.scenes[this.scenes.length - 1];
        };
        /**
         * この `Game` の時間経過とそれに伴う処理を行う。
         *
         * 現在の `Scene` に対して `Scene#update` をfireし、 `this.events` に設定されたイベントを処理する。
         * このメソッドの呼び出し後、 `this.events.length` は0である。
         * このメソッドは暗黙に呼び出される。ゲーム開発者がこのメソッドを利用する必要はない。
         *
         * 戻り値は呼び出し前後でシーンが変わった(別のシーンに遷移した)場合、真。でなければ偽。
         * @param advanceAge 偽を与えた場合、`this.age` を進めない。
         * @param omittedTickCount タイムスタンプ待ちを省略する動作などにより、(前回の呼び出し以降に)省かれたローカルティックの数。省略された場合、 `0` 。
         */
        Game.prototype.tick = function (advanceAge, omittedTickCount) {
            var scene = undefined;
            if (this._isTerminated)
                return false;
            this.isLastTickLocal = !advanceAge;
            this.lastOmittedLocalTickCount = omittedTickCount || 0;
            if (this.scenes.length) {
                scene = this.scenes[this.scenes.length - 1];
                if (this.events.length) {
                    var events = this.events;
                    this.events = [];
                    for (var i = 0; i < events.length; ++i) {
                        var trigger = this._eventTriggerMap[events[i].type];
                        if (trigger)
                            trigger.fire(events[i]);
                    }
                }
                scene.update.fire();
                if (advanceAge)
                    ++this.age;
            }
            if (this._sceneChangeRequests.length) {
                this._flushSceneChangeRequests();
                return scene !== this.scenes[this.scenes.length - 1];
            }
            return false;
        };
        /**
         * このGameを描画する。
         *
         * このゲームに紐づけられた `Renderer` (`this.renderers` に含まれるすべての `Renderer` で、この `Game` の描画を行う。
         * このメソッドは暗黙に呼び出される。ゲーム開発者がこのメソッドを利用する必要はない。
         *
         * @param camera 対象のカメラ。省略された場合 `Game.focusingCamera`
         */
        Game.prototype.render = function (camera) {
            if (!camera)
                camera = this.focusingCamera;
            var renderers = this.renderers; // unsafe
            for (var i = 0; i < renderers.length; ++i)
                renderers[i].draw(this, camera);
            this.modified = false;
        };
        /**
         * その座標に反応する `PointSource` を返す。
         *
         * 戻り値は、対象が見つかった場合、 `target` に見つかった `E` を持つ `PointSource` である。
         * 対象が見つからなかった場合、 `undefined` である。
         *
         * 戻り値が `undefined` でない場合、その `target` プロパティは次を満たす:
         * - `E#touchable` が真である
         * - カメラ `camera` から可視である中で最も手前にある
         *
         * @param point 対象の座標
         * @param camera 対象のカメラ。指定しなければ `Game.focusingCamera` が使われる
         */
        Game.prototype.findPointSource = function (point, camera) {
            if (!camera)
                camera = this.focusingCamera;
            return this.scene().findPointSourceByPoint(point, false, camera);
        };
        /**
         * このGameにエンティティを登録する。
         *
         * このメソッドは各エンティティに対して暗黙に呼び出される。ゲーム開発者がこのメソッドを明示的に利用する必要はない。
         * `e.id` が `undefined` である場合、このメソッドの呼び出し後、 `e.id` には `this` に一意の値が設定される。
         * `e.local` が偽である場合、このメソッドの呼び出し後、 `this.db[e.id] === e` が成立する。
         * `e.local` が真である場合、 `e.id` の値は不定である。
         *
         * @param e 登録するエンティティ
         */
        Game.prototype.register = function (e) {
            if (e.local) {
                if (e.id === undefined) {
                    e.id = --this._localIdx;
                }
                else {
                    // register前にidがある: スナップショットからの復元用パス
                    // スナップショットはローカルエンティティを残さないはずだが、実装上はできるようにしておく。
                    if (e.id > 0)
                        throw g.ExceptionFactory.createAssertionError("Game#register: invalid local id: " + e.id);
                    if (this._localDb.hasOwnProperty(String(e.id)))
                        throw g.ExceptionFactory.createAssertionError("Game#register: conflicted id: " + e.id);
                    if (this._localIdx > e.id)
                        this._localIdx = e.id;
                }
                this._localDb[e.id] = e;
            }
            else {
                if (e.id === undefined) {
                    e.id = ++this._idx;
                }
                else {
                    // register前にidがある: スナップショットからの復元用パス
                    if (e.id < 0)
                        throw g.ExceptionFactory.createAssertionError("Game#register: invalid non-local id: " + e.id);
                    if (this.db.hasOwnProperty(String(e.id)))
                        throw g.ExceptionFactory.createAssertionError("Game#register: conflicted id: " + e.id);
                    // _idxがユニークな値を作れるよう更新しておく
                    if (this._idx < e.id)
                        this._idx = e.id;
                }
                this.db[e.id] = e;
            }
        };
        /**
         * このGameからエンティティの登録を削除する。
         *
         * このメソッドは各エンティティに対して暗黙に呼び出される。ゲーム開発者がこのメソッドを明示的に利用する必要はない。
         * このメソッドの呼び出し後、 `this.db[e.id]` は未定義である。
         * @param e 登録を削除するエンティティ
         */
        Game.prototype.unregister = function (e) {
            if (e.local) {
                delete this._localDb[e.id];
            }
            else {
                delete this.db[e.id];
            }
        };
        /**
         * @deprecated 現在このメソッドは呼び出しても何も行わない。
         *
         * このゲームを離脱する。
         *
         * 多人数プレイの場合、他のクライアントでは `Game#leave` イベントがfireされる。
         * このメソッドの呼び出し後、このクライアントの操作要求は送信されない。
         */
        Game.prototype.leaveGame = function () {
            this._leaveGame();
        };
        /**
         * このゲームを終了する。
         *
         * エンジンに対して続行の断念を通知する。
         * このメソッドの呼び出し後、このクライアントの操作要求は送信されない。
         * またこのクライアントのゲーム実行は行われない(updateを含むイベントのfireはおきない)。
         */
        Game.prototype.terminateGame = function () {
            this._leaveGame();
            this._isTerminated = true;
        };
        /**
         * @private
         */
        Game.prototype._fireSceneReady = function (scene) {
            this._sceneChangeRequests.push({ type: 3 /* FireReady */, scene: scene });
        };
        /**
         * @private
         */
        Game.prototype._fireSceneLoaded = function (scene) {
            if (scene._loadingState < g.SceneLoadState.LoadedFired) {
                this._sceneChangeRequests.push({ type: 4 /* FireLoaded */, scene: scene });
            }
        };
        /**
         * @private
         */
        Game.prototype._callSceneAssetHolderHandler = function (assetHolder) {
            this._sceneChangeRequests.push({ type: 5 /* CallAssetHolderHandler */, assetHolder: assetHolder });
        };
        /**
         * @private
         */
        Game.prototype._normalizeConfiguration = function (gameConfiguration) {
            if (!gameConfiguration)
                throw g.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: invalid arguments");
            if (!("assets" in gameConfiguration))
                gameConfiguration.assets = {};
            if (!("fps" in gameConfiguration))
                gameConfiguration.fps = 30;
            if (typeof gameConfiguration.fps !== "number")
                throw g.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be given as a number");
            if (!(0 <= gameConfiguration.fps && gameConfiguration.fps <= 60))
                throw g.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be a number in (0, 60].");
            if (typeof gameConfiguration.width !== "number")
                throw g.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: width must be given as a number");
            if (typeof gameConfiguration.height !== "number")
                throw g.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: height must be given as a number");
            return gameConfiguration;
        };
        /**
         * @private
         */
        Game.prototype._setAudioPlaybackRate = function (playbackRate) {
            this._audioSystemManager._setPlaybackRate(playbackRate);
        };
        /**
         * @private
         */
        Game.prototype._setMuted = function (muted) {
            this._audioSystemManager._setMuted(muted);
        };
        /**
         * g.OperationEventのデータをデコードする。
         * @private
         */
        Game.prototype._decodeOperationPluginOperation = function (code, op) {
            var plugins = this._operationPluginManager.plugins;
            if (!plugins[code] || !plugins[code].decode)
                return op;
            return plugins[code].decode(op);
        };
        /**
         * ゲーム状態のリセット。
         * @private
         */
        Game.prototype._reset = function (param) {
            this._operationPluginManager.stopAll();
            if (this.scene()) {
                while (this.scene() !== this._initialScene) {
                    this.popScene();
                    this._flushSceneChangeRequests();
                }
                if (!this.isLoaded) {
                    // _initialSceneの読み込みが終わっていない: _initialScene自体は使い回すので単にpopする。
                    this.scenes.pop();
                }
            }
            if (param) {
                if (param.age !== undefined)
                    this.age = param.age;
                if (param.randGen !== undefined)
                    this.random = param.randGen;
            }
            this._audioSystemManager._reset();
            this._loaded.removeAll({ func: this._start, owner: this });
            this.join.removeAll();
            this.leave.removeAll();
            this.seed.removeAll();
            this.resized.removeAll();
            this.skippingChanged.removeAll();
            this.isSkipping = false;
            this.skippingChanged.add(this._handleSkippingChanged, this);
            this.joinedPlayerIds = [];
            this.join.add(this._handleJoinEvent, this);
            this.leave.add(this._handleLeaveEvent, this);
            this._idx = 0;
            this._localIdx = 0;
            this._cameraIdx = 0;
            this.db = {};
            this._localDb = {};
            this.events = [];
            this.modified = true;
            this.loadingScene = undefined;
            this._focusingCamera = undefined;
            this._scriptCaches = {};
            this.snapshotRequest.removeAll();
            this._sceneChangeRequests = [];
            this._isTerminated = false;
            this.vars = {};
            if (this.surfaceAtlasSet)
                this.surfaceAtlasSet.destroy();
            this.surfaceAtlasSet = new g.SurfaceAtlasSet({ game: this });
            switch (this._configuration.defaultLoadingScene) {
                case "none":
                    // Note: 何も描画しない実装として利用している
                    this._defaultLoadingScene = new g.LoadingScene({ game: this });
                    break;
                default:
                    this._defaultLoadingScene = new g.DefaultLoadingScene({ game: this });
                    break;
            }
        };
        /**
         * ゲームを破棄する。
         * エンジンユーザとコンテンツに開放された一部プロパティ(external, vars)は維持する点に注意。
         * @private
         */
        Game.prototype._destroy = function () {
            // ユーザコードを扱う操作プラグインを真っ先に破棄
            this._operationPluginManager.destroy();
            // 到達できるシーンを全て破棄
            if (this.scene()) {
                while (this.scene() !== this._initialScene) {
                    this.popScene();
                    this._flushSceneChangeRequests();
                }
            }
            this._initialScene.destroy();
            if (this.loadingScene && !this.loadingScene.destroyed()) {
                this.loadingScene.destroy();
            }
            if (!this._defaultLoadingScene.destroyed()) {
                this._defaultLoadingScene.destroy();
            }
            // NOTE: fps, width, height, external, vars はそのまま保持しておく
            this.db = undefined;
            this.renderers = undefined;
            this.scenes = undefined;
            this.random = undefined;
            this.events = undefined;
            this.join.destroy();
            this.join = undefined;
            this.leave.destroy();
            this.leave = undefined;
            this.seed.destroy();
            this.seed = undefined;
            this.modified = false;
            this.age = 0;
            this.assets = undefined; // this._initialScene.assets のエイリアスなので、特に破棄処理はしない。
            this.isLoaded = false;
            this.loadingScene = undefined;
            this.assetBase = "";
            this.selfId = undefined;
            var audioSystemIds = Object.keys(this.audio);
            for (var i = 0; i < audioSystemIds.length; ++i)
                this.audio[audioSystemIds[i]].stopAll();
            this.audio = undefined;
            this.defaultAudioSystemId = undefined;
            this.logger.destroy();
            this.logger = undefined;
            this.snapshotRequest.destroy();
            this.snapshotRequest = undefined;
            // TODO より能動的にdestroy処理を入れるべきかもしれない
            this.resourceFactory = undefined;
            this.storage = undefined;
            this.playId = undefined;
            this.operationPlugins = undefined; // this._operationPluginManager.pluginsのエイリアスなので、特に破棄処理はしない。
            this.resized.destroy();
            this.resized = undefined;
            this.skippingChanged.destroy();
            this.skippingChanged = undefined;
            this._eventTriggerMap = undefined;
            this._initialScene = undefined;
            this._defaultLoadingScene = undefined;
            this._sceneChanged.destroy();
            this._sceneChanged = undefined;
            this._scriptCaches = undefined;
            this._loaded.destroy();
            this._loaded = undefined;
            this._started.destroy();
            this._started = undefined;
            this._main = undefined;
            this._mainParameter = undefined;
            this._assetManager.destroy();
            this._assetManager = undefined;
            this._audioSystemManager._game = undefined;
            this._audioSystemManager = undefined;
            this._operationPluginManager = undefined;
            this._operationPluginOperated.destroy();
            this._operationPluginOperated = undefined;
            this._idx = 0;
            this._localDb = {};
            this._localIdx = 0;
            this._cameraIdx = 0;
            this._isTerminated = true;
            this._focusingCamera = undefined;
            this._configuration = undefined;
            this._sceneChangeRequests = [];
            this.surfaceAtlasSet.destroy();
            this.surfaceAtlasSet = undefined;
        };
        /**
         * ゲームを開始する。
         *
         * 存在するシーンをすべて(_initialScene以外; あるなら)破棄し、グローバルアセットを読み込み、完了後ゲーム開発者の実装コードの実行を開始する。
         * このメソッドの二度目以降の呼び出しの前には、 `this._reset()` を呼び出す必要がある。
         * @param param ゲームのエントリポイントに渡す値
         * @private
         */
        Game.prototype._loadAndStart = function (param) {
            this._mainParameter = param || {};
            if (!this.isLoaded) {
                this._loaded.add(this._start, this);
                this.pushScene(this._initialScene);
                this._flushSceneChangeRequests();
            }
            else {
                this._start();
            }
        };
        /**
         * グローバルアセットの読み込みを開始する。
         * 単体テスト用 (mainSceneなど特定アセットの存在を前提にする_loadAndStart()はテストに使いにくい) なので、通常ゲーム開発者が利用することはない
         * @private
         */
        Game.prototype._startLoadingGlobalAssets = function () {
            if (this.isLoaded)
                throw g.ExceptionFactory.createAssertionError("Game#_startLoadingGlobalAssets: already loaded.");
            this.pushScene(this._initialScene);
            this._flushSceneChangeRequests();
        };
        /**
         * @private
         */
        Game.prototype._updateEventTriggers = function (scene) {
            this.modified = true;
            if (!scene) {
                this._eventTriggerMap[g.EventType.Message] = undefined;
                this._eventTriggerMap[g.EventType.PointDown] = undefined;
                this._eventTriggerMap[g.EventType.PointMove] = undefined;
                this._eventTriggerMap[g.EventType.PointUp] = undefined;
                this._eventTriggerMap[g.EventType.Operation] = undefined;
                return;
            }
            this._eventTriggerMap[g.EventType.Message] = scene.message;
            this._eventTriggerMap[g.EventType.PointDown] = scene.pointDownCapture;
            this._eventTriggerMap[g.EventType.PointMove] = scene.pointMoveCapture;
            this._eventTriggerMap[g.EventType.PointUp] = scene.pointUpCapture;
            this._eventTriggerMap[g.EventType.Operation] = scene.operation;
            scene._activate();
        };
        /**
         * @private
         */
        Game.prototype._onInitialSceneLoaded = function () {
            this._initialScene.loaded.remove(this._onInitialSceneLoaded, this);
            this.assets = this._initialScene.assets;
            this.isLoaded = true;
            this._loaded.fire();
        };
        /**
         * @private
         * エラーを出してゲームを途中終了させるメソッド。
         */
        Game.prototype._abortGame = function () {
            // do nothing.
        };
        /**
         * 要求されたシーン遷移を実行する。
         *
         * `pushScene()` 、 `replaceScene()` や `popScene()` によって要求されたシーン遷移を実行する。
         * 通常このメソッドは、毎フレーム一度、フレームの最後に呼び出されることを期待する (`Game#tick()` がこの呼び出しを行う)。
         * ただしゲーム開始時 (グローバルアセット読み込み・スナップショットローダ起動後またはmainScene実行開始時) に関しては、
         * シーン追加がゲーム開発者の記述によらない (`tick()` の外側である) ため、それぞれの箇所で明示的にこのメソッドを呼び出す。
         * @private
         */
        Game.prototype._flushSceneChangeRequests = function () {
            do {
                var reqs = this._sceneChangeRequests;
                this._sceneChangeRequests = [];
                for (var i = 0; i < reqs.length; ++i) {
                    var req = reqs[i];
                    switch (req.type) {
                        case 0 /* Push */:
                            var oldScene = this.scene();
                            if (oldScene) {
                                oldScene._deactivate();
                            }
                            this._doPushScene(req.scene);
                            break;
                        case 1 /* Replace */:
                            // Note: replaceSceneの場合、pop時点では_sceneChangedをfireしない。_doPushScene() で一度だけfireする。
                            this._doPopScene(req.preserveCurrent, false);
                            this._doPushScene(req.scene);
                            break;
                        case 2 /* Pop */:
                            this._doPopScene(req.preserveCurrent, true);
                            break;
                        case 3 /* FireReady */:
                            if (!req.scene.destroyed())
                                req.scene._fireReady();
                            break;
                        case 4 /* FireLoaded */:
                            if (!req.scene.destroyed())
                                req.scene._fireLoaded();
                            break;
                        case 5 /* CallAssetHolderHandler */:
                            if (!req.assetHolder.destroyed())
                                req.assetHolder.callHandler();
                            break;
                        default:
                            throw g.ExceptionFactory.createAssertionError("Game#_flushSceneChangeRequests: unknown scene change request.");
                    }
                }
            } while (this._sceneChangeRequests.length > 0); // flush中に追加される限りflushを続行する
        };
        Game.prototype._handleSkippingChanged = function (isSkipping) {
            this.isSkipping = isSkipping;
        };
        Game.prototype._handleJoinEvent = function (event) {
            if (this.joinedPlayerIds.indexOf(event.player.id) !== -1)
                return;
            this.joinedPlayerIds.push(event.player.id);
        };
        Game.prototype._handleLeaveEvent = function (event) {
            this.joinedPlayerIds = this.joinedPlayerIds.filter(function (id) { return id !== event.player.id; });
        };
        Game.prototype._doPopScene = function (preserveCurrent, fireSceneChanged) {
            var scene = this.scenes.pop();
            if (scene === this._initialScene)
                throw g.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; attempting to pop the initial scene");
            if (!preserveCurrent)
                scene.destroy();
            if (fireSceneChanged)
                this._sceneChanged.fire(this.scene());
        };
        Game.prototype._start = function () {
            this._operationPluginManager.initialize();
            this.operationPlugins = this._operationPluginManager.plugins;
            // deprecated の挙動: エントリポイントの指定がない場合
            if (!this._main) {
                if (!this._mainParameter.snapshot) {
                    if (!this.assets.mainScene)
                        throw g.ExceptionFactory.createAssertionError("Game#_start: global asset 'mainScene' not found.");
                    var mainScene = g._require(this, "mainScene")();
                    this.pushScene(mainScene);
                    this._flushSceneChangeRequests();
                }
                else {
                    if (!this.assets.snapshotLoader)
                        throw g.ExceptionFactory.createAssertionError("Game#_start: global asset 'snapshotLoader' not found.");
                    var loader = g._require(this, "snapshotLoader");
                    loader(this._mainParameter.snapshot);
                    this._flushSceneChangeRequests(); // スナップショットローダもシーン遷移を要求する可能性がある(というかまずする)
                }
                this._started.fire();
                return;
            }
            var mainFun = g._require(this, this._main);
            if (!mainFun || typeof mainFun !== "function")
                throw g.ExceptionFactory.createAssertionError("Game#_start: Entry point '" + this._main + "' not found.");
            mainFun(this._mainParameter);
            this._flushSceneChangeRequests(); // シーン遷移を要求する可能性がある(というかまずする)
            this._started.fire();
        };
        Game.prototype._doPushScene = function (scene, loadingScene) {
            if (!loadingScene)
                loadingScene = this.loadingScene || this._defaultLoadingScene;
            this.scenes.push(scene);
            if (scene._needsLoading() && scene._loadingState < g.SceneLoadState.LoadedFired) {
                if (this._defaultLoadingScene._needsLoading())
                    throw g.ExceptionFactory.createAssertionError("Game#_doPushScene: _defaultLoadingScene must not depend on any assets/storages.");
                this._doPushScene(loadingScene, this._defaultLoadingScene);
                loadingScene.reset(scene);
            }
            else {
                // 読み込み待ちのアセットがなければその場で(loadingSceneに任せず)ロード、SceneReadyを発生させてからLoadingSceneEndを起こす。
                this._sceneChanged.fire(scene);
                if (!scene._loaded) {
                    scene._load();
                    this._fireSceneLoaded(scene);
                }
            }
            this.modified = true;
        };
        return Game;
    }());
    g.Game = Game;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 2D世界におけるカメラ。
     */
    var Camera2D = /** @class */ (function (_super) {
        __extends(Camera2D, _super);
        /**
         * 指定されたパラメータで `Camera2D` のインスタンスを生成する。
         * @param param 初期化に用いるパラメータのオブジェクト
         */
        function Camera2D(param) {
            var _this = _super.call(this, param) || this;
            _this.game = param.game;
            _this.local = !!param.local;
            _this.name = param.name;
            _this._modifiedCount = 0;
            // param の width と height は無視する
            _this.width = param.game.width;
            _this.height = param.game.height;
            _this.id = _this.local ? undefined : _this.game._cameraIdx++;
            return _this;
        }
        /**
         * 与えられたシリアリゼーションでカメラを復元する。
         *
         * @param ser `Camera2D#serialize()` の戻り値
         * @param game 復元されたカメラの属する Game
         */
        Camera2D.deserialize = function (ser, game) {
            var s = ser;
            s.param.game = game;
            var ret = new Camera2D(s.param);
            ret.id = s.id;
            return ret;
        };
        /**
         * カメラ状態の変更をエンジンに通知する。
         *
         * このメソッドの呼び出し後、このカメラのプロパティに対する変更が各 `Renderer` の描画に反映される。
         * ただし逆は真ではない。すなわち、再描画は他の要因によって行われることもある。
         * ゲーム開発者は、このメソッドを呼び出していないことをもって再描画が行われていないことを仮定してはならない。
         *
         * 本メソッドは、このオブジェクトの `Object2D` 由来のプロパティ (`x`, `y`, `angle` など) を変更した場合にも呼びだす必要がある。
         */
        Camera2D.prototype.modified = function () {
            this._modifiedCount = (this._modifiedCount + 1) % 32768;
            if (this._matrix)
                this._matrix._modified = true;
            this.game.modified = true;
        };
        /**
         * このカメラをシリアライズする。
         *
         * このメソッドの戻り値を `Camera2D#deserialize()` に渡すことで同じ値を持つカメラを復元することができる。
         */
        Camera2D.prototype.serialize = function () {
            var ser = {
                id: this.id,
                param: {
                    game: undefined,
                    local: this.local,
                    name: this.name,
                    x: this.x,
                    y: this.y,
                    width: this.width,
                    height: this.height,
                    opacity: this.opacity,
                    scaleX: this.scaleX,
                    scaleY: this.scaleY,
                    angle: this.angle,
                    compositeOperation: this.compositeOperation
                }
            };
            return ser;
        };
        /**
         * @private
         */
        Camera2D.prototype._applyTransformToRenderer = function (renderer) {
            if (this.angle || this.scaleX !== 1 || this.scaleY !== 1 || this.anchorX != null || this.anchorY != null) {
                // Note: this.scaleX/scaleYが0の場合描画した結果何も表示されない事になるが、特殊扱いはしない
                renderer.transform(this.getMatrix()._matrix);
            }
            else {
                renderer.translate(-this.x, -this.y);
            }
            if (this.opacity !== 1)
                renderer.opacity(this.opacity);
        };
        /**
         * @private
         */
        Camera2D.prototype._updateMatrix = function () {
            // カメラの angle, x, y はエンティティと逆方向に作用することに注意。
            if (this.anchorX != null && this.anchorY != null) {
                this._matrix.updateByInverseWithAnchor(this.width, this.height, this.scaleX, this.scaleY, this.angle, this.x, this.y, this.anchorX, this.anchorY);
            }
            else if (this.angle || this.scaleX !== 1 || this.scaleY !== 1) {
                this._matrix.updateByInverse(this.width, this.height, this.scaleX, this.scaleY, this.angle, this.x, this.y);
            }
            else {
                this._matrix.reset(-this.x, -this.y);
            }
        };
        return Camera2D;
    }(g.Object2D));
    g.Camera2D = Camera2D;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * ゲームの描画を行うクラス。
     *
     * 描画は各エンティティによって行われる。通常、ゲーム開発者が本クラスを利用する必要はない。
     */
    var Renderer = /** @class */ (function () {
        function Renderer() {
        }
        Renderer.prototype.draw = function (game, camera) {
            var scene = game.scene();
            if (!scene)
                return;
            this.begin();
            this.save();
            this.clear();
            if (camera) {
                this.save();
                camera._applyTransformToRenderer(this);
            }
            var children = scene.children;
            for (var i = 0; i < children.length; ++i)
                children[i].render(this, camera);
            if (camera) {
                this.restore();
            }
            this.restore();
            this.end();
        };
        Renderer.prototype.begin = function () {
            // nothing to do
        };
        Renderer.prototype.end = function () {
            // nothing to do
        };
        return Renderer;
    }());
    g.Renderer = Renderer;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 描画領域を表すクラス。
     *
     * このクラスのインスタンスは、エンジンによって暗黙に生成される。
     * ゲーム開発者はこのクラスのインスタンスを明示的に生成する必要はなく、またできない。
     */
    var Surface = /** @class */ (function () {
        /**
         * `Surface` のインスタンスを生成する。
         * @param width 描画領域の幅（整数値でなければならない）
         * @param height 描画領域の高さ（整数値でなければならない）
         * @param drawable 描画可能な実体。省略された場合、 `undefined`
         * @param isDynamic drawableが動画であることを示す値。動画である時、真を渡さなくてはならない。省略された場合、偽。
         */
        function Surface(width, height, drawable, isDynamic) {
            if (isDynamic === void 0) { isDynamic = false; }
            if (width % 1 !== 0 || height % 1 !== 0) {
                throw g.ExceptionFactory.createAssertionError("Surface#constructor: width and height must be integers");
            }
            this.width = width;
            this.height = height;
            if (drawable)
                this._drawable = drawable;
            // this._destroyedは破棄時に一度だけ代入する特殊なフィールドなため、コンストラクタで初期値を代入しない
            this.isDynamic = isDynamic;
            if (this.isDynamic) {
                this.animatingStarted = new g.Trigger();
                this.animatingStopped = new g.Trigger();
            }
            else {
                this.animatingStarted = undefined;
                this.animatingStopped = undefined;
            }
        }
        /**
         * このSurfaceの破棄を行う。
         * 以後、このSurfaceを利用することは出来なくなる。
         */
        Surface.prototype.destroy = function () {
            if (this.animatingStarted) {
                this.animatingStarted.destroy();
            }
            if (this.animatingStopped) {
                this.animatingStopped.destroy();
            }
            this._destroyed = true;
        };
        /**
         * このSurfaceが破棄済であるかどうかを判定する。
         */
        Surface.prototype.destroyed = function () {
            // _destroyedはundefinedかtrueなため、常にbooleanが返すように!!演算子を用いる
            return !!this._destroyed;
        };
        return Surface;
    }());
    g.Surface = Surface;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 単一行のテキストを描画するエンティティ。
     * 本クラスの利用には `BitmapFont` または `DynamicFont` が必要となる。
     */
    var Label = /** @class */ (function (_super) {
        __extends(Label, _super);
        /**
         * 各種パラメータを指定して `Label` のインスタンスを生成する。
         * @param param このエンティティに指定するパラメータ
         */
        function Label(param) {
            var _this = _super.call(this, param) || this;
            _this.text = param.text;
            _this.font = param.font;
            _this.textAlign = ("textAlign" in param) ? param.textAlign : g.TextAlign.Left;
            _this.glyphs = new Array(param.text.length);
            _this.fontSize = param.fontSize;
            _this.maxWidth = param.maxWidth;
            _this.widthAutoAdjust = ("widthAutoAdjust" in param) ? param.widthAutoAdjust : true;
            _this.textColor = param.textColor;
            _this._textWidth = 0;
            _this._game = undefined;
            _this._overhangLeft = 0;
            _this._overhangRight = 0;
            _this._invalidateSelf();
            return _this;
        }
        /**
         * `width` と `textAlign` を設定し、 `widthAutoAdjust` を `false` に設定する。
         *
         * このメソッドは `this.textAlign` を設定するためのユーティリティである。
         * `textAlign` を `TextAlign.Left` 以外に設定する場合には、通常 `width` や `widthAutoAdjust` も設定する必要があるため、それらをまとめて行う。
         * このメソッドの呼び出し後、 `this.invalidate()` を呼び出す必要がある。
         * @param width 幅
         * @param textAlign テキストの描画位置
         */
        Label.prototype.aligning = function (width, textAlign) {
            this.width = width;
            this.widthAutoAdjust = false;
            this.textAlign = textAlign;
        };
        /**
         * このエンティティの描画キャッシュ無効化をエンジンに通知する。
         * このメソッドを呼び出し後、描画キャッシュの再構築が行われ、各 `Renderer` に描画内容の変更が反映される。
         */
        Label.prototype.invalidate = function () {
            this._invalidateSelf();
            _super.prototype.invalidate.call(this);
        };
        /**
         * Label自身の描画を行う。
         */
        Label.prototype.renderSelfFromCache = function (renderer) {
            // glyphのはみ出し量に応じて、描画先のX座標を調整する。
            var destOffsetX;
            switch (this.textAlign) {
                case g.TextAlign.Center:
                    destOffsetX = this.widthAutoAdjust ? this._overhangLeft : 0;
                    break;
                case g.TextAlign.Right:
                    destOffsetX = this.widthAutoAdjust ? this._overhangLeft : this._overhangRight;
                    break;
                default:
                    destOffsetX = this._overhangLeft;
                    break;
            }
            renderer.drawImage(this._cache, 0, 0, this._cacheSize.width + g.CacheableE.PADDING, this._cacheSize.height + g.CacheableE.PADDING, destOffsetX, 0);
        };
        Label.prototype.renderCache = function (renderer) {
            if (!this.fontSize || this.height <= 0 || this._textWidth <= 0) {
                return;
            }
            var scale = (this.maxWidth > 0 && this.maxWidth < this._textWidth) ? this.maxWidth / this._textWidth : 1;
            var offsetX = 0;
            switch (this.textAlign) {
                case g.TextAlign.Center:
                    offsetX = this.width / 2 - (this._textWidth + this._overhangLeft) / 2 * scale;
                    break;
                case g.TextAlign.Right:
                    offsetX = this.width - (this._textWidth + this._overhangLeft) * scale;
                    break;
                default:
                    offsetX -= this._overhangLeft * scale;
                    break;
            }
            renderer.translate(offsetX, 0);
            if (scale !== 1) {
                renderer.transform([scale, 0, 0, 1, 0, 0]);
            }
            renderer.save();
            var glyphScale = this.fontSize / this.font.size;
            for (var i = 0; i < this.glyphs.length; ++i) {
                var glyph = this.glyphs[i];
                var glyphWidth = glyph.advanceWidth * glyphScale;
                var code = glyph.code;
                if (!glyph.isSurfaceValid) {
                    glyph = this.font.glyphForCharacter(code);
                    if (!glyph) {
                        this._outputOfWarnLogWithNoGlyph(code, "renderCache()");
                        continue;
                    }
                }
                if (glyph.surface) { // 非空白文字
                    renderer.save();
                    renderer.transform([glyphScale, 0, 0, glyphScale, 0, 0]);
                    renderer.drawImage(glyph.surface, glyph.x, glyph.y, glyph.width, glyph.height, glyph.offsetX, glyph.offsetY);
                    renderer.restore();
                }
                renderer.translate(glyphWidth, 0);
            }
            renderer.restore();
            renderer.save();
            if (this.textColor) {
                renderer.setCompositeOperation(g.CompositeOperation.SourceAtop);
                renderer.fillRect(0, 0, this._textWidth, this.height, this.textColor);
            }
            renderer.restore();
        };
        /**
         * このエンティティを破棄する。
         * 利用している `BitmapFont` の破棄は行わないため、 `BitmapFont` の破棄はコンテンツ製作者が明示的に行う必要がある。
         */
        Label.prototype.destroy = function () {
            _super.prototype.destroy.call(this);
        };
        Label.prototype._invalidateSelf = function () {
            this.glyphs.length = 0;
            this._textWidth = 0;
            if (!this.fontSize) {
                this.height = 0;
                return;
            }
            var effectiveTextLastIndex = this.text.length - 1;
            // 右のはみだし量を求めるため、text内での有効な最後の glyph のindexを解決する。
            for (var i = this.text.length - 1; i >= 0; --i) {
                var code = g.Util.charCodeAt(this.text, i);
                if (!code) {
                    continue;
                }
                var glyph = this.font.glyphForCharacter(code);
                if (glyph && glyph.width !== 0 && glyph.advanceWidth !== 0) {
                    effectiveTextLastIndex = i;
                    break;
                }
            }
            var maxHeight = 0;
            var glyphScale = this.font.size > 0 ? this.fontSize / this.font.size : 0;
            for (var i = 0; i <= effectiveTextLastIndex; ++i) {
                var code_1 = g.Util.charCodeAt(this.text, i);
                if (!code_1) {
                    continue;
                }
                var glyph = this.font.glyphForCharacter(code_1);
                if (!glyph) {
                    this._outputOfWarnLogWithNoGlyph(code_1, "_invalidateSelf()");
                    continue;
                }
                if (glyph.width < 0 || glyph.height < 0) {
                    continue;
                }
                if (glyph.x < 0 || glyph.y < 0) {
                    continue;
                }
                this.glyphs.push(glyph);
                // Font に StrokeWidth が設定されている場合、文字の描画内容は、描画の基準点よりも左にはみ出る場合や、glyph.advanceWidth より右にはみ出る場合がある。
                // キャッシュサーフェスの幅は、最初の文字と最後の文字のはみ出し部分を考慮して求める必要がある。
                var overhang = 0;
                if (i === 0) {
                    this._overhangLeft = Math.min(glyph.offsetX, 0);
                    overhang = -this._overhangLeft;
                }
                if (i === effectiveTextLastIndex) {
                    this._overhangRight = Math.max((glyph.width + glyph.offsetX) - glyph.advanceWidth, 0);
                    overhang += this._overhangRight;
                }
                this._textWidth += (glyph.advanceWidth + overhang) * glyphScale;
                var height = glyph.offsetY + glyph.height;
                if (maxHeight < height) {
                    maxHeight = height;
                }
            }
            if (this.widthAutoAdjust) {
                this.width = this._textWidth;
            }
            this.height = maxHeight * glyphScale;
        };
        Label.prototype._outputOfWarnLogWithNoGlyph = function (code, functionName) {
            var str = (code & 0xFFFF0000) ? String.fromCharCode((code & 0xFFFF0000) >>> 16, code & 0xFFFF) : String.fromCharCode(code);
            this.game().logger.warn("Label#" + functionName + ": failed to get a glyph for '" + str + "' " +
                "(BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).");
        };
        return Label;
    }(g.CacheableE));
    g.Label = Label;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * グリフ。
     */
    var Glyph = /** @class */ (function () {
        /**
         * `Glyph` のインスタンスを生成する。
         */
        function Glyph(code, x, y, width, height, offsetX, offsetY, advanceWidth, surface, isSurfaceValid) {
            if (offsetX === void 0) { offsetX = 0; }
            if (offsetY === void 0) { offsetY = 0; }
            if (advanceWidth === void 0) { advanceWidth = width; }
            if (isSurfaceValid === void 0) { isSurfaceValid = !!surface; }
            this.code = code;
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;
            this.offsetX = offsetX;
            this.offsetY = offsetY;
            this.advanceWidth = advanceWidth;
            this.surface = surface;
            this.isSurfaceValid = isSurfaceValid;
            this._atlas = null;
        }
        /**
         * グリフの描画上の幅を求める。
         * 通常、ゲーム開発者がこのメソッドを呼び出す必要はない。
         * @param fontSize フォントサイズ
         */
        Glyph.prototype.renderingWidth = function (fontSize) {
            if (!this.width || !this.height) {
                return 0;
            }
            return fontSize / this.height * this.width;
        };
        return Glyph;
    }());
    g.Glyph = Glyph;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 塗りつぶされた矩形を表すエンティティ。
     */
    var FilledRect = /** @class */ (function (_super) {
        __extends(FilledRect, _super);
        /**
         * 各種パラメータを指定して `FilledRect` のインスタンスを生成する。
         * @param param このエンティティに対するパラメータ
         */
        function FilledRect(param) {
            var _this = _super.call(this, param) || this;
            if (typeof param.cssColor !== "string")
                throw g.ExceptionFactory.createTypeMismatchError("ColorBox#constructor(cssColor)", "string", param.cssColor);
            _this.cssColor = param.cssColor;
            return _this;
        }
        /**
         * このエンティティ自身の描画を行う。
         * このメソッドはエンジンから暗黙に呼び出され、ゲーム開発者が呼び出す必要はない。
         */
        FilledRect.prototype.renderSelf = function (renderer) {
            renderer.fillRect(0, 0, this.width, this.height, this.cssColor);
            return true;
        };
        return FilledRect;
    }(g.E));
    g.FilledRect = FilledRect;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 枠を表すエンティティ。
     * クリッピングやパディング、バックグラウンドイメージの演出等の機能を持つため、
     * メニューやメッセージ、ステータスのウィンドウ等に利用されることが期待される。
     * このエンティティの子要素は、このエンティティの持つ `Surface` に描画される。
     */
    var Pane = /** @class */ (function (_super) {
        __extends(Pane, _super);
        /**
         * 各種パラメータを指定して `Pane` のインスタンスを生成する。
         * @param param このエンティティに指定するパラメータ
         */
        function Pane(param) {
            var _this = _super.call(this, param) || this;
            _this._oldWidth = param.width;
            _this._oldHeight = param.height;
            _this.backgroundImage = g.Util.asSurface(param.backgroundImage);
            _this.backgroundEffector = param.backgroundEffector;
            _this._shouldRenderChildren = false;
            _this._padding = param.padding;
            _this._initialize();
            _this._paddingChanged = false;
            _this._bgSurface = undefined;
            _this._bgRenderer = undefined;
            return _this;
        }
        Object.defineProperty(Pane.prototype, "padding", {
            get: function () {
                return this._padding;
            },
            /**
             * パディング。
             * このエンティティの子孫は、パディングに指定された分だけ右・下にずれた場所に描画され、またパディングの矩形サイズでクリッピングされる。
             */
            // NOTE: paddingの変更は頻繁に行われるものでは無いと思われるので、フラグを立てるためにアクセサを使う
            set: function (padding) {
                this._padding = padding;
                this._paddingChanged = true;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * このエンティティに対する変更をエンジンに通知する。
         * このメソッドの呼び出し後、 `this` に対する変更が各 `Renderer` の描画に反映される。
         * このメソッドは描画キャッシュの無効化を保証しない。描画キャッシュの無効化も必要な場合、 `invalidate()`を呼び出さなければならない。
         * 詳細は `E#modified()` のドキュメントを参照。
         */
        Pane.prototype.modified = function (isBubbling) {
            if (isBubbling)
                this.state &= ~2 /* Cached */;
            _super.prototype.modified.call(this);
        };
        Pane.prototype.shouldFindChildrenByPoint = function (point) {
            var p = this._normalizedPadding;
            if (p.left < point.x && this.width - p.right > point.x && p.top < point.y && this.height - p.bottom > point.y) {
                return true;
            }
            return false;
        };
        Pane.prototype.renderCache = function (renderer, camera) {
            if (this.width <= 0 || this.height <= 0) {
                return;
            }
            this._renderBackground();
            this._renderChildren(camera);
            if (this._bgSurface) {
                renderer.drawImage(this._bgSurface, 0, 0, this.width, this.height, 0, 0);
            }
            else if (this.backgroundImage) {
                renderer.drawImage(this.backgroundImage, 0, 0, this.width, this.height, 0, 0);
            }
            if (this._childrenArea.width <= 0 || this._childrenArea.height <= 0) {
                return;
            }
            renderer.save();
            if (this._childrenArea.x !== 0 || this._childrenArea.y !== 0) {
                renderer.translate(this._childrenArea.x, this._childrenArea.y);
            }
            renderer.drawImage(this._childrenSurface, 0, 0, this._childrenArea.width, this._childrenArea.height, 0, 0);
            renderer.restore();
        };
        /**
         * このエンティティを破棄する。また、バックバッファで利用している `Surface` も合わせて破棄される。
         * ただし、 `backgroundImage` に利用している `Surface` の破棄は行わない。
         * @param destroySurface trueを指定した場合、 `backgroundImage` に利用している `Surface` も合わせて破棄する。
         */
        Pane.prototype.destroy = function (destroySurface) {
            if (destroySurface && this.backgroundImage && !this.backgroundImage.destroyed()) {
                this.backgroundImage.destroy();
            }
            if (this._bgSurface && !this._bgSurface.destroyed()) {
                this._bgSurface.destroy();
            }
            if (this._childrenSurface && !this._childrenSurface.destroyed()) {
                this._childrenSurface.destroy();
            }
            this.backgroundImage = undefined;
            this._bgSurface = undefined;
            this._childrenSurface = undefined;
            _super.prototype.destroy.call(this);
        };
        /**
         * @private
         */
        Pane.prototype._renderBackground = function () {
            if (this.backgroundImage && this.backgroundEffector) {
                var bgSurface = this.backgroundEffector.render(this.backgroundImage, this.width, this.height);
                if (this._bgSurface !== bgSurface) {
                    if (this._bgSurface && !this._bgSurface.destroyed()) {
                        this._bgSurface.destroy();
                    }
                    this._bgSurface = bgSurface;
                }
            }
            else {
                this._bgSurface = undefined;
            }
        };
        /**
         * @private
         */
        Pane.prototype._renderChildren = function (camera) {
            var isNew = this._oldWidth !== this.width || this._oldHeight !== this.height || this._paddingChanged;
            if (isNew) {
                this._initialize();
                this._paddingChanged = false;
                this._oldWidth = this.width;
                this._oldHeight = this.height;
            }
            this._childrenRenderer.begin();
            if (!isNew) {
                this._childrenRenderer.clear();
            }
            if (this.children) {
                // Note: concatしていないのでunsafeだが、render中に配列の中身が変わる事はない前提とする
                var children = this.children;
                for (var i = 0; i < children.length; ++i) {
                    children[i].render(this._childrenRenderer, camera);
                }
            }
            this._childrenRenderer.end();
        };
        /**
         * @private
         */
        Pane.prototype._initialize = function () {
            var p = this._padding === undefined ? 0 : this._padding;
            var r;
            if (typeof p === "number") {
                r = { top: p, bottom: p, left: p, right: p };
            }
            else {
                r = this._padding;
            }
            this._childrenArea = {
                x: r.left,
                y: r.top,
                width: this.width - r.left - r.right,
                height: this.height - r.top - r.bottom
            };
            var resourceFactory = this.scene.game.resourceFactory;
            if (this._childrenSurface && !this._childrenSurface.destroyed()) {
                this._childrenSurface.destroy();
            }
            this._childrenSurface =
                resourceFactory.createSurface(Math.ceil(this._childrenArea.width), Math.ceil(this._childrenArea.height));
            this._childrenRenderer = this._childrenSurface.renderer();
            this._normalizedPadding = r;
        };
        /**
         * このPaneの包含矩形を計算する。
         * Eを継承する他のクラスと異なり、Paneは子要素の位置を包括矩形に含まない。
         * @private
         */
        Pane.prototype._calculateBoundingRect = function (m, c) {
            var matrix = this.getMatrix();
            if (m) {
                matrix = m.multiplyNew(matrix);
            }
            if (!this.visible() || (c && (!this._targetCameras || this._targetCameras.indexOf(c) === -1))) {
                return undefined;
            }
            var thisBoundingRect = { left: 0, right: this.width, top: 0, bottom: this.height };
            var targetCoordinates = [
                { x: thisBoundingRect.left, y: thisBoundingRect.top },
                { x: thisBoundingRect.left, y: thisBoundingRect.bottom },
                { x: thisBoundingRect.right, y: thisBoundingRect.top },
                { x: thisBoundingRect.right, y: thisBoundingRect.bottom }
            ];
            var convertedPoint = matrix.multiplyPoint(targetCoordinates[0]);
            var result = { left: convertedPoint.x, right: convertedPoint.x, top: convertedPoint.y, bottom: convertedPoint.y };
            for (var i = 1; i < targetCoordinates.length; ++i) {
                convertedPoint = matrix.multiplyPoint(targetCoordinates[i]);
                if (result.left > convertedPoint.x)
                    result.left = convertedPoint.x;
                if (result.right < convertedPoint.x)
                    result.right = convertedPoint.x;
                if (result.top > convertedPoint.y)
                    result.top = convertedPoint.y;
                if (result.bottom < convertedPoint.y)
                    result.bottom = convertedPoint.y;
            }
            return result;
        };
        return Pane;
    }(g.CacheableE));
    g.Pane = Pane;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 操作プラグインからの通知をハンドルするクラス。
     * 本クラスのインスタンスをゲーム開発者が直接生成することはなく、ゲーム開発者が利用する必要もない。
     */
    var OperationHandler = /** @class */ (function () {
        function OperationHandler(code, owner, handler) {
            this._code = code;
            this._handler = handler;
            this._handlerOwner = owner;
        }
        OperationHandler.prototype.onOperation = function (op) {
            var iop;
            if (op instanceof Array) {
                iop = { _code: this._code, data: op };
            }
            else {
                iop = op;
                iop._code = this._code;
            }
            this._handler.call(this._handlerOwner, iop);
        };
        return OperationHandler;
    }());
    /**
     * 操作プラグインを管理するクラス。
     * 本クラスのインスタンスをゲーム開発者が直接生成することはなく、ゲーム開発者が利用する必要もない。
     */
    var OperationPluginManager = /** @class */ (function () {
        function OperationPluginManager(game, viewInfo, infos) {
            this.operated = new g.Trigger();
            this.plugins = {};
            this._game = game;
            this._viewInfo = viewInfo;
            this._infos = infos;
            this._initialized = false;
        }
        /**
         * 初期化する。
         * このメソッドの呼び出しは、`this.game._loaded` のfire後でなければならない。
         */
        OperationPluginManager.prototype.initialize = function () {
            if (!this._initialized) {
                this._initialized = true;
                this._loadOperationPlugins();
            }
            this._doAutoStart();
        };
        OperationPluginManager.prototype.destroy = function () {
            this.stopAll();
            this.operated.destroy();
            this.operated = undefined;
            this.plugins = undefined;
            this._game = undefined;
            this._viewInfo = undefined;
            this._infos = undefined;
        };
        OperationPluginManager.prototype.stopAll = function () {
            if (!this._initialized)
                return;
            for (var i = 0; i < this._infos.length; ++i) {
                var info = this._infos[i];
                if (info._plugin)
                    info._plugin.stop();
            }
        };
        OperationPluginManager.prototype._doAutoStart = function () {
            for (var i = 0; i < this._infos.length; ++i) {
                var info = this._infos[i];
                if (!info.manualStart && info._plugin)
                    info._plugin.start();
            }
        };
        OperationPluginManager.prototype._loadOperationPlugins = function () {
            for (var i = 0; i < this._infos.length; ++i) {
                var info = this._infos[i];
                if (!info.script)
                    continue;
                var pluginClass = g._require(this._game, info.script);
                if (!pluginClass.isSupported())
                    continue;
                var plugin = new pluginClass(this._game, this._viewInfo, info.option);
                var code = info.code;
                if (this.plugins[code]) {
                    throw new Error("Plugin#code conflicted for code: " + code);
                }
                this.plugins[code] = plugin;
                info._plugin = plugin;
                var handler = new OperationHandler(code, this.operated, this.operated.fire);
                plugin.operationTrigger.handle(handler, handler.onOperation);
            }
        };
        return OperationPluginManager;
    }());
    g.OperationPluginManager = OperationPluginManager;
})(g || (g = {}));
var g;
(function (g) {
})(g || (g = {}));
var g;
(function (g) {
    /**
     * フォント。
     */
    var Font = /** @class */ (function () {
        function Font() {
        }
        /**
         * 対象の文字列を一行で描画した際の計測情報を返す。
         *
         * @param text 文字列
         */
        Font.prototype.measureText = function (text) {
            var width = 0;
            var actualBoundingBoxLeft = 0;
            var actualBoundingBoxRight = 0;
            var lastGlyph;
            for (var i = 0; i < text.length; i++) {
                var code = g.Util.charCodeAt(text, i);
                if (!code)
                    continue;
                var glyph = this.glyphForCharacter(code);
                if (!glyph || glyph.x < 0 || glyph.y < 0 || glyph.width < 0 || glyph.height < 0)
                    continue;
                if (i === 0) {
                    actualBoundingBoxLeft = -glyph.offsetX;
                }
                lastGlyph = glyph;
                width += glyph.advanceWidth;
            }
            if (lastGlyph) {
                actualBoundingBoxRight = width + lastGlyph.offsetX + lastGlyph.width - lastGlyph.advanceWidth;
            }
            return {
                width: width,
                actualBoundingBoxLeft: actualBoundingBoxLeft,
                actualBoundingBoxRight: actualBoundingBoxRight
            };
        };
        return Font;
    }());
    g.Font = Font;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 文字列描画のフォントウェイト。
     */
    var FontWeight;
    (function (FontWeight) {
        /**
         * 通常のフォントウェイト。
         */
        FontWeight[FontWeight["Normal"] = 0] = "Normal";
        /**
         * 太字のフォントウェイト。
         */
        FontWeight[FontWeight["Bold"] = 1] = "Bold";
    })(FontWeight = g.FontWeight || (g.FontWeight = {}));
    /**
     * ビットマップフォントを逐次生成するフォント。
     */
    var DynamicFont = /** @class */ (function (_super) {
        __extends(DynamicFont, _super);
        /**
         * 各種パラメータを指定して `DynamicFont` のインスタンスを生成する。
         * @param param `DynamicFont` に設定するパラメータ
         */
        function DynamicFont(param) {
            var _this = _super.call(this) || this;
            _this.fontFamily = param.fontFamily;
            _this.size = param.size;
            _this.hint = ("hint" in param) ? param.hint : {};
            _this.fontColor = ("fontColor" in param) ? param.fontColor : "black";
            _this.fontWeight = ("fontWeight" in param) ? param.fontWeight : FontWeight.Normal;
            _this.strokeWidth = ("strokeWidth" in param) ? param.strokeWidth : 0;
            _this.strokeColor = ("strokeColor" in param) ? param.strokeColor : "black";
            _this.strokeOnly = ("strokeOnly" in param) ? param.strokeOnly : false;
            _this._resourceFactory = param.game.resourceFactory;
            _this._glyphFactory =
                _this._resourceFactory.createGlyphFactory(_this.fontFamily, _this.size, _this.hint.baselineHeight, _this.fontColor, _this.strokeWidth, _this.strokeColor, _this.strokeOnly, _this.fontWeight);
            _this._glyphs = {};
            _this._destroyed = false;
            _this._isSurfaceAtlasSetOwner = false;
            // NOTE: hint の特定プロパティ(baselineHeight)を分岐の条件にした場合、後でプロパティを追加した時に
            // ここで追従漏れの懸念があるため、引数の hint が省略されているかで分岐させている。
            if (param.surfaceAtlasSet) {
                _this._atlasSet = param.surfaceAtlasSet;
            }
            else if (!!param.hint) {
                _this._isSurfaceAtlasSetOwner = true;
                _this._atlasSet = new g.SurfaceAtlasSet({
                    game: param.game,
                    hint: _this.hint
                });
            }
            else {
                _this._atlasSet = param.game.surfaceAtlasSet;
            }
            _this._atlasSet.addAtlas();
            if (_this.hint.presetChars) {
                for (var i = 0, len = _this.hint.presetChars.length; i < len; i++) {
                    var code = g.Util.charCodeAt(_this.hint.presetChars, i);
                    if (!code) {
                        continue;
                    }
                    _this.glyphForCharacter(code);
                }
            }
            return _this;
        }
        /**
         * グリフの取得。
         *
         * 取得に失敗するとnullが返る。
         *
         * 取得に失敗した時、次のようにすることで成功するかもしれない。
         * - DynamicFont生成時に指定する文字サイズを小さくする
         * - アトラスの初期サイズ・最大サイズを大きくする
         *
         * @param code 文字コード
         */
        DynamicFont.prototype.glyphForCharacter = function (code) {
            var glyph = this._glyphs[code];
            if (!(glyph && glyph.isSurfaceValid)) {
                glyph = this._glyphFactory.create(code);
                if (glyph.surface) { // 空白文字でなければアトラス化する
                    var atlas_1 = this._atlasSet.addGlyph(glyph);
                    if (!atlas_1) {
                        return null;
                    }
                    glyph._atlas = atlas_1;
                    glyph._atlas._accessScore += 1;
                }
                this._glyphs[code] = glyph;
            }
            // スコア更新
            // NOTE: LRUを捨てる方式なら単純なタイムスタンプのほうがわかりやすいかもしれない
            // NOTE: 正確な時刻は必要ないはずで、インクリメンタルなカウンタで代用すればDate()生成コストは省略できる
            for (var i = 0; i < this._atlasSet.getAtlasNum(); i++) {
                var atlas = this._atlasSet.getAtlas(i);
                atlas._accessScore /= 2;
            }
            return glyph;
        };
        /**
         * BtimapFontの生成。
         *
         * 実装上の制限から、このメソッドを呼び出す場合、maxAtlasNum が 1 または undefined/null(1として扱われる) である必要がある。
         * そうでない場合、失敗する可能性がある。
         *
         * @param missingGlyph `BitmapFont#map` に存在しないコードポイントの代わりに表示するべき文字。最初の一文字が用いられる。
         */
        DynamicFont.prototype.asBitmapFont = function (missingGlyphChar) {
            var _this = this;
            if (this._atlasSet.getAtlasNum() !== 1) {
                return null;
            }
            var missingGlyphCharCodePoint;
            if (missingGlyphChar) {
                missingGlyphCharCodePoint = g.Util.charCodeAt(missingGlyphChar, 0);
                this.glyphForCharacter(missingGlyphCharCodePoint);
            }
            var glyphAreaMap = {};
            Object.keys(this._glyphs).forEach(function (_key) {
                var key = Number(_key);
                var glyph = _this._glyphs[key];
                var glyphArea = {
                    x: glyph.x,
                    y: glyph.y,
                    width: glyph.width,
                    height: glyph.height,
                    offsetX: glyph.offsetX,
                    offsetY: glyph.offsetY,
                    advanceWidth: glyph.advanceWidth
                };
                glyphAreaMap[key] = glyphArea;
            });
            // NOTE: (defaultGlyphWidth, defaultGlyphHeight)= (0, this.size) とする
            //
            // それぞれの役割は第一に `GlyphArea#width`, `GlyphArea#height` が与えられないときの
            // デフォルト値である。ここでは必ず与えているのでデフォルト値としては利用されない。
            // しかし defaultGlyphHeight は BitmapFont#size にも用いられる。
            // そのために this.size をコンストラクタの第４引数に与えることにする。
            var missingGlyph = glyphAreaMap[missingGlyphCharCodePoint];
            var surface = this._atlasSet.getAtlas(0).duplicateSurface(this._resourceFactory);
            var bitmapFont = new g.BitmapFont({
                src: surface,
                map: glyphAreaMap,
                defaultGlyphWidth: 0,
                defaultGlyphHeight: this.size,
                missingGlyph: missingGlyph
            });
            return bitmapFont;
        };
        DynamicFont.prototype.destroy = function () {
            if (this._isSurfaceAtlasSetOwner) {
                this._atlasSet.destroy();
            }
            this._glyphs = null;
            this._glyphFactory = null;
            this._destroyed = true;
        };
        DynamicFont.prototype.destroyed = function () {
            return this._destroyed;
        };
        return DynamicFont;
    }(g.Font));
    g.DynamicFont = DynamicFont;
})(g || (g = {}));
var g;
(function (g_1) {
    /**
     * ラスタ画像によるフォント。
     */
    var BitmapFont = /** @class */ (function (_super) {
        __extends(BitmapFont, _super);
        /**
         * 各種パラメータを指定して `BitmapFont` のインスタンスを生成する。
         * @param param `BitmapFont` に設定するパラメータ
         */
        function BitmapFont(param) {
            var _this = _super.call(this) || this;
            _this.surface = g_1.Util.asSurface(param.src);
            _this.map = param.map;
            _this.defaultGlyphWidth = param.defaultGlyphWidth;
            _this.defaultGlyphHeight = param.defaultGlyphHeight;
            _this.missingGlyph = param.missingGlyph;
            _this.size = param.defaultGlyphHeight;
            return _this;
        }
        /**
         * コードポイントに対応するグリフを返す。
         * @param code コードポイント
         */
        BitmapFont.prototype.glyphForCharacter = function (code) {
            var g = this.map[code] || this.missingGlyph;
            if (!g) {
                return null;
            }
            var w = g.width === undefined ? this.defaultGlyphWidth : g.width;
            var h = g.height === undefined ? this.defaultGlyphHeight : g.height;
            var offsetX = g.offsetX || 0;
            var offsetY = g.offsetY || 0;
            var advanceWidth = g.advanceWidth === undefined ? w : g.advanceWidth;
            var surface = (w === 0 || h === 0) ? undefined : this.surface;
            return new g_1.Glyph(code, g.x, g.y, w, h, offsetX, offsetY, advanceWidth, surface, true);
        };
        /**
         * 利用している `Surface` を破棄した上で、このフォントを破棄する。
         */
        BitmapFont.prototype.destroy = function () {
            if (this.surface && !this.surface.destroyed()) {
                this.surface.destroy();
            }
            this.map = undefined;
        };
        /**
         * 破棄されたオブジェクトかどうかを判定する。
         */
        BitmapFont.prototype.destroyed = function () {
            // mapをfalsy値で作成された場合最初から破棄扱いになるが、仕様とする
            return !this.map;
        };
        return BitmapFont;
    }(g_1.Font));
    g_1.BitmapFont = BitmapFont;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * SurfaceAtlasの空き領域管理クラス。
     *
     * 本クラスのインスタンスをゲーム開発者が直接生成することはなく、ゲーム開発者が利用する必要もない。
     */
    var SurfaceAtlasSlot = /** @class */ (function () {
        function SurfaceAtlasSlot(x, y, width, height) {
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;
            this.prev = null;
            this.next = null;
        }
        return SurfaceAtlasSlot;
    }());
    g.SurfaceAtlasSlot = SurfaceAtlasSlot;
    function getSurfaceAtlasSlot(slot, width, height) {
        while (slot) {
            if (slot.width >= width && slot.height >= height) {
                return slot;
            }
            slot = slot.next;
        }
        return null;
    }
    function calcAtlasSize(hint) {
        var width = Math.ceil(Math.min(hint.initialAtlasWidth, hint.maxAtlasWidth));
        var height = Math.ceil(Math.min(hint.initialAtlasHeight, hint.maxAtlasHeight));
        return { width: width, height: height };
    }
    /**
     * サーフェスアトラス。
     *
     * 与えられたサーフェスの指定された領域をコピーし一枚のサーフェスにまとめる。
     *
     * 本クラスのインスタンスをゲーム開発者が直接生成することはなく、ゲーム開発者が利用する必要もない。
     */
    var SurfaceAtlas = /** @class */ (function () {
        function SurfaceAtlas(surface) {
            this._surface = surface;
            this._emptySurfaceAtlasSlotHead = new SurfaceAtlasSlot(0, 0, this._surface.width, this._surface.height);
            this._accessScore = 0;
            this._usedRectangleAreaSize = { width: 0, height: 0 };
        }
        /**
         * @private
         */
        SurfaceAtlas.prototype._acquireSurfaceAtlasSlot = function (width, height) {
            // Renderer#drawImage()でサーフェス上の一部を描画するとき、
            // 指定した部分に隣接する画素がにじみ出る現象が確認されている。
            // ここれではそれを避けるため1pixelの余白を与えている。
            width += 1;
            height += 1;
            var slot = getSurfaceAtlasSlot(this._emptySurfaceAtlasSlotHead, width, height);
            if (!slot) {
                return null;
            }
            var remainWidth = slot.width - width;
            var remainHeight = slot.height - height;
            var left;
            var right;
            if (remainWidth <= remainHeight) {
                left = new SurfaceAtlasSlot(slot.x + width, slot.y, remainWidth, height);
                right = new SurfaceAtlasSlot(slot.x, slot.y + height, slot.width, remainHeight);
            }
            else {
                left = new SurfaceAtlasSlot(slot.x, slot.y + height, width, remainHeight);
                right = new SurfaceAtlasSlot(slot.x + width, slot.y, remainWidth, slot.height);
            }
            left.prev = slot.prev;
            left.next = right;
            if (left.prev === null) { // left is head
                this._emptySurfaceAtlasSlotHead = left;
            }
            else {
                left.prev.next = left;
            }
            right.prev = left;
            right.next = slot.next;
            if (right.next) {
                right.next.prev = right;
            }
            var acquiredSlot = new SurfaceAtlasSlot(slot.x, slot.y, width, height);
            this._updateUsedRectangleAreaSize(acquiredSlot);
            return acquiredSlot;
        };
        /**
         * @private
         */
        SurfaceAtlas.prototype._updateUsedRectangleAreaSize = function (slot) {
            var slotRight = slot.x + slot.width;
            var slotBottom = slot.y + slot.height;
            if (slotRight > this._usedRectangleAreaSize.width) {
                this._usedRectangleAreaSize.width = slotRight;
            }
            if (slotBottom > this._usedRectangleAreaSize.height) {
                this._usedRectangleAreaSize.height = slotBottom;
            }
        };
        /**
         * サーフェスの追加。
         *
         * @param glyph グリフのサーフェスが持つ情報をSurfaceAtlasへ配置
         */
        SurfaceAtlas.prototype.addSurface = function (glyph) {
            var slot = this._acquireSurfaceAtlasSlot(glyph.width, glyph.height);
            if (!slot) {
                return null;
            }
            var renderer = this._surface.renderer();
            renderer.begin();
            renderer.drawImage(glyph.surface, glyph.x, glyph.y, glyph.width, glyph.height, slot.x, slot.y);
            renderer.end();
            return slot;
        };
        /**
         * このSurfaceAtlasの破棄を行う。
         * 以後、このSurfaceを利用することは出来なくなる。
         */
        SurfaceAtlas.prototype.destroy = function () {
            this._surface.destroy();
        };
        /**
         * このSurfaceAtlasが破棄済であるかどうかを判定する。
         */
        SurfaceAtlas.prototype.destroyed = function () {
            return this._surface.destroyed();
        };
        /**
         * _surfaceを複製する。
         *
         * 複製されたSurfaceは文字を格納するのに必要な最低限のサイズになる。
         */
        SurfaceAtlas.prototype.duplicateSurface = function (resourceFactory) {
            var src = this._surface;
            var dst = resourceFactory.createSurface(this._usedRectangleAreaSize.width, this._usedRectangleAreaSize.height);
            var renderer = dst.renderer();
            renderer.begin();
            renderer.drawImage(src, 0, 0, this._usedRectangleAreaSize.width, this._usedRectangleAreaSize.height, 0, 0);
            renderer.end();
            return dst;
        };
        return SurfaceAtlas;
    }());
    g.SurfaceAtlas = SurfaceAtlas;
    /**
     * DynamicFontで使用される、SurfaceAtlasを管理する。
     */
    var SurfaceAtlasSet = /** @class */ (function () {
        function SurfaceAtlasSet(params) {
            this._surfaceAtlases = [];
            this._atlasGlyphsTable = [];
            this._resourceFactory = params.game.resourceFactory;
            this._currentAtlasIndex = 0;
            var hint = params.hint ? params.hint : {};
            this._maxAtlasNum = hint.maxAtlasNum ? hint.maxAtlasNum : SurfaceAtlasSet.INITIAL_MAX_SURFACEATLAS_NUM;
            // 指定がないとき、やや古いモバイルデバイスでも確保できると言われる
            // 縦横512pxのテクスチャ一枚のアトラスにまとめる形にする
            // 2048x2048で確保してしまうと、Edge, Chrome にて処理が非常に遅くなることがある
            hint.initialAtlasWidth = hint.initialAtlasWidth ? hint.initialAtlasWidth : 512;
            hint.initialAtlasHeight = hint.initialAtlasHeight ? hint.initialAtlasHeight : 512;
            hint.maxAtlasWidth = hint.maxAtlasWidth ? hint.maxAtlasWidth : 512;
            hint.maxAtlasHeight = hint.maxAtlasHeight ? hint.maxAtlasHeight : 512;
            this._atlasSize = calcAtlasSize(hint);
        }
        /**
         * @private
         */
        SurfaceAtlasSet.prototype._deleteAtlas = function (delteNum) {
            var removedObject = this._removeLeastFrequentlyUsedAtlas(delteNum);
            var removedAtlases = removedObject.surfaceAtlases;
            for (var i = 0; i < removedAtlases.length; ++i) {
                removedAtlases[i].destroy();
            }
        };
        /**
         * 使用度の低いサーフェスアトラスを配列から削除する。
         * @private
         */
        SurfaceAtlasSet.prototype._removeLeastFrequentlyUsedAtlas = function (removedNum) {
            var removedAtlases = [];
            var removedGlyphs = [];
            for (var n = 0; n < removedNum; ++n) {
                var minScore = Number.MAX_VALUE;
                var lowScoreAtlasIndex = -1;
                for (var i = 0; i < this._surfaceAtlases.length; ++i) {
                    if (this._surfaceAtlases[i]._accessScore <= minScore) {
                        minScore = this._surfaceAtlases[i]._accessScore;
                        lowScoreAtlasIndex = i;
                    }
                }
                var removedAtlas = this._surfaceAtlases.splice(lowScoreAtlasIndex, 1)[0];
                removedAtlases.push(removedAtlas);
                removedGlyphs.push(this._atlasGlyphsTable.splice(lowScoreAtlasIndex, 1)[0]);
            }
            return { surfaceAtlases: removedAtlases, glyphs: removedGlyphs };
        };
        /**
         * 空き領域のあるSurfaceAtlasを探索する。
         * glyphが持つ情報をSurfaceAtlasへ移動し、移動したSurfaceAtlasの情報でglyphを置き換える。
         * @private
         */
        SurfaceAtlasSet.prototype._moveGlyphSurface = function (glyph) {
            for (var i = 0; i < this._surfaceAtlases.length; ++i) {
                var index = (this._currentAtlasIndex + i) % this._surfaceAtlases.length;
                var atlas = this._surfaceAtlases[index];
                var slot = atlas.addSurface(glyph);
                if (slot) {
                    this._currentAtlasIndex = index;
                    glyph.surface.destroy();
                    glyph.surface = atlas._surface;
                    glyph.x = slot.x;
                    glyph.y = slot.y;
                    if (!this._atlasGlyphsTable[index])
                        this._atlasGlyphsTable[index] = [];
                    this._atlasGlyphsTable[index].push(glyph);
                    return atlas;
                }
            }
            return null;
        };
        /**
         * サーフェスアトラスの再割り当てを行う。
         * @private
         */
        SurfaceAtlasSet.prototype._reallocateAtlas = function () {
            if (this._surfaceAtlases.length >= this._maxAtlasNum) {
                var removedObject = this._removeLeastFrequentlyUsedAtlas(1);
                var atlas = removedObject.surfaceAtlases[0];
                var glyphs = removedObject.glyphs[0];
                for (var i = 0; i < glyphs.length; i++) {
                    var glyph = glyphs[i];
                    glyph.surface = null;
                    glyph.isSurfaceValid = false;
                    glyph._atlas = null;
                }
                atlas.destroy();
            }
            this._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width, this._atlasSize.height));
            this._currentAtlasIndex = this._surfaceAtlases.length - 1;
        };
        /**
         * サーフェスアトラスを追加する。
         *
         * 保持している_surfaceAtlasesの数が最大値以上の場合、削除してから追加する。
         *
         * このメソッドは、このSurfaceAtlasSetに紐づいている `DynamnicFont` の `constructor` から暗黙に呼び出される。
         * 通常、ゲーム開発者がこのメソッドを呼び出す必要はない。
         */
        SurfaceAtlasSet.prototype.addAtlas = function () {
            // removeLeastFrequentlyUsedAtlas()では、SurfaceAtlas#_accessScoreの一番小さい値を持つSurfaceAtlasを削除するため、
            // SurfaceAtlas作成時は_accessScoreは0となっているため、削除判定後に作成,追加処理を行う。
            if (this._surfaceAtlases.length >= this._maxAtlasNum) {
                this._deleteAtlas(1);
            }
            this._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width, this._atlasSize.height));
        };
        /**
         * 引数で指定されたindexのサーフェスアトラスを取得する。
         *
         * このメソッドは、このSurfaceAtlasSetに紐づいている `DynamnicFont` の `glyphForCharacter()` から暗黙に呼び出される。
         * 通常、ゲーム開発者がこのメソッドを呼び出す必要はない。
         * @param index 取得対象のインデックス
         */
        SurfaceAtlasSet.prototype.getAtlas = function (index) {
            return this._surfaceAtlases[index];
        };
        /**
         * サーフェスアトラスの保持数を取得する。
         *
         * このメソッドは、このSurfaceAtlasSetに紐づいている `DynamnicFont` の `glyphForCharacter()` から暗黙に呼び出される。
         * 通常、ゲーム開発者がこのメソッドを呼び出す必要はない。
         */
        SurfaceAtlasSet.prototype.getAtlasNum = function () {
            return this._surfaceAtlases.length;
        };
        /**
         * 最大サーフェスアトラス保持数取得する。
         */
        SurfaceAtlasSet.prototype.getMaxAtlasNum = function () {
            return this._maxAtlasNum;
        };
        /**
         * 最大アトラス保持数設定する。
         *
         * 設定された値が、現在保持している_surfaceAtlasesの数より大きい場合、
         * removeLeastFrequentlyUsedAtlas()で設定値まで削除する。
         * @param value 設定値
         */
        SurfaceAtlasSet.prototype.changeMaxAtlasNum = function (value) {
            this._maxAtlasNum = value;
            if (this._surfaceAtlases.length > this._maxAtlasNum) {
                var diff = this._surfaceAtlases.length - this._maxAtlasNum;
                this._deleteAtlas(diff);
            }
        };
        /**
         * サーフェスアトラスのサイズを取得する。
         *
         * このメソッドは、このSurfaceAtlasSetに紐づいている `DynamnicFont` の `glyphForCharacter()` から暗黙に呼び出される。
         * 通常、ゲーム開発者がこのメソッドを呼び出す必要はない。
         */
        SurfaceAtlasSet.prototype.getAtlasSize = function () {
            return this._atlasSize;
        };
        /**
         * サーフェスアトラスにグリフを追加する。
         *
         * このメソッドは、このSurfaceAtlasSetに紐づいている `DynamnicFont` の `glyphForCharacter()` から暗黙に呼び出される。
         * 通常、ゲーム開発者がこのメソッドを呼び出す必要はない。
         * @param glyph グリフ
         */
        SurfaceAtlasSet.prototype.addGlyph = function (glyph) {
            // グリフがアトラスより大きいとき、`_atlasSet.addGlyph()`は失敗する。
            // `_reallocateAtlas()`でアトラス増やしてもこれは解決できない。
            // 無駄な空き領域探索とアトラスの再確保を避けるためにここでリターンする。
            if (glyph.width > this._atlasSize.width || glyph.height > this._atlasSize.height) {
                return null;
            }
            var atlas = this._moveGlyphSurface(glyph);
            if (!atlas) {
                // retry
                this._reallocateAtlas();
                atlas = this._moveGlyphSurface(glyph);
            }
            return atlas;
        };
        /**
         * このインスタンスを破棄する。
         */
        SurfaceAtlasSet.prototype.destroy = function () {
            for (var i = 0; i < this._surfaceAtlases.length; ++i) {
                this._surfaceAtlases[i].destroy();
            }
            this._surfaceAtlases = undefined;
            this._resourceFactory = undefined;
            this._atlasGlyphsTable = undefined;
        };
        /**
         * このインスタンスが破棄済みであるかどうかを返す。
         */
        SurfaceAtlasSet.prototype.destroyed = function () {
            return this._surfaceAtlases === undefined;
        };
        /**
         * SurfaceAtlas最大保持数初期値
         */
        SurfaceAtlasSet.INITIAL_MAX_SURFACEATLAS_NUM = 10;
        return SurfaceAtlasSet;
    }());
    g.SurfaceAtlasSet = SurfaceAtlasSet;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * `Game#audio` の管理クラス。
     *
     * 複数の `AudioSystem` に一括で必要な状態設定を行う。
     * 本クラスのインスタンスをゲーム開発者が直接生成することはなく、ゲーム開発者が利用する必要もない。
     */
    var AudioSystemManager = /** @class */ (function () {
        function AudioSystemManager(game) {
            this._game = game;
            this._muted = false;
            this._playbackRate = 1.0;
        }
        /**
         * @private
         */
        AudioSystemManager.prototype._reset = function () {
            this._muted = false;
            this._playbackRate = 1.0;
            var systems = this._game.audio;
            for (var id in systems) {
                if (!systems.hasOwnProperty(id))
                    continue;
                systems[id]._reset();
            }
        };
        /**
         * @private
         */
        AudioSystemManager.prototype._setMuted = function (muted) {
            if (this._muted === muted)
                return;
            this._muted = muted;
            var systems = this._game.audio;
            for (var id in systems) {
                if (!systems.hasOwnProperty(id))
                    continue;
                systems[id]._setMuted(muted);
            }
        };
        /**
         * @private
         */
        AudioSystemManager.prototype._setPlaybackRate = function (rate) {
            if (this._playbackRate === rate)
                return;
            this._playbackRate = rate;
            var systems = this._game.audio;
            for (var id in systems) {
                if (!systems.hasOwnProperty(id))
                    continue;
                systems[id]._setPlaybackRate(rate);
            }
        };
        return AudioSystemManager;
    }());
    g.AudioSystemManager = AudioSystemManager;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 描画時の合成方法。
     */
    var CompositeOperation;
    (function (CompositeOperation) {
        /**
         * 先に描画された領域の上に描画する。
         */
        CompositeOperation[CompositeOperation["SourceOver"] = 0] = "SourceOver";
        /**
         * 先に描画された領域と重なった部分のみを描画する。
         */
        CompositeOperation[CompositeOperation["SourceAtop"] = 1] = "SourceAtop";
        /**
         * 先に描画された領域と重なった部分の色を加算して描画する。
         */
        CompositeOperation[CompositeOperation["Lighter"] = 2] = "Lighter";
        /**
         * 先に描画された領域を全て無視して描画する。
         */
        CompositeOperation[CompositeOperation["Copy"] = 3] = "Copy";
        /**
         * 先に描画された領域と重なった部分に描画を行い、それ以外の部分を透明にする。
         * 環境により、描画結果が大きく異なる可能性があるため、試験的導入である。
         */
        CompositeOperation[CompositeOperation["ExperimentalSourceIn"] = 4] = "ExperimentalSourceIn";
        /**
         * 先に描画された領域と重なっていない部分に描画を行い、それ以外の部分を透明にする。
         * 環境により、描画結果が大きく異なる可能性があるため、試験的導入である。
         */
        CompositeOperation[CompositeOperation["ExperimentalSourceOut"] = 5] = "ExperimentalSourceOut";
        /**
         * 描画する領域だけを表示し、先に描画された領域と重なった部分は描画先を表示する。
         * 環境により、描画結果が大きく異なる可能性があるため、試験的導入である。
         */
        CompositeOperation[CompositeOperation["ExperimentalDestinationAtop"] = 6] = "ExperimentalDestinationAtop";
        /**
         * 先に描画された領域と重なっていない部分を透明にし、重なった部分は描画先を表示する。
         * 環境により、描画結果が大きく異なる可能性があるため、試験的導入である。
         */
        CompositeOperation[CompositeOperation["ExperimentalDestinationIn"] = 7] = "ExperimentalDestinationIn";
        /**
         * 描画する領域を透明にする。
         */
        CompositeOperation[CompositeOperation["DestinationOut"] = 8] = "DestinationOut";
        /**
         * 先に描画された領域の下に描画する。
         */
        CompositeOperation[CompositeOperation["DestinationOver"] = 9] = "DestinationOver";
        /**
         * 先に描画された領域と重なった部分のみ透明にする。
         */
        CompositeOperation[CompositeOperation["Xor"] = 10] = "Xor";
    })(CompositeOperation = g.CompositeOperation || (g.CompositeOperation = {}));
})(g || (g = {}));
var g;
(function (g) {
    /**
     * グリフファクトリ。
     *
     * `DynamicFont` はこれを利用してグリフを生成する。
     *
     * 本クラスのインスタンスをゲーム開発者が直接生成することはなく、ゲーム開発者が利用する必要もない。
     */
    var GlyphFactory = /** @class */ (function () {
        /**
         * `GlyphFactory` を生成する。
         *
         * @param fontFamily フォントファミリ。g.FontFamilyの定義する定数、フォント名、またはそれらの配列
         * @param fontSize フォントサイズ
         * @param baselineHeight ベースラインの高さ
         * @param strokeWidth 輪郭幅
         * @param strokeColor 輪郭色
         * @param strokeOnly 輪郭を描画するか否か
         * @param fontWeight フォントウェイト
         */
        function GlyphFactory(fontFamily, fontSize, baselineHeight, fontColor, strokeWidth, strokeColor, strokeOnly, fontWeight) {
            if (baselineHeight === void 0) { baselineHeight = fontSize; }
            if (fontColor === void 0) { fontColor = "black"; }
            if (strokeWidth === void 0) { strokeWidth = 0; }
            if (strokeColor === void 0) { strokeColor = "black"; }
            if (strokeOnly === void 0) { strokeOnly = false; }
            if (fontWeight === void 0) { fontWeight = g.FontWeight.Normal; }
            this.fontFamily = fontFamily;
            this.fontSize = fontSize;
            this.fontWeight = fontWeight;
            this.baselineHeight = baselineHeight;
            this.fontColor = fontColor;
            this.strokeWidth = strokeWidth;
            this.strokeColor = strokeColor;
            this.strokeOnly = strokeOnly;
        }
        return GlyphFactory;
    }());
    g.GlyphFactory = GlyphFactory;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * シーンに与えるローカルティックの種類
     */
    var LocalTickMode;
    (function (LocalTickMode) {
        /**
         * ローカルティックを受け取らない。
         * 通常の(非ローカル)シーン。
         */
        LocalTickMode[LocalTickMode["NonLocal"] = 0] = "NonLocal";
        /**
         * ローカルティックのみ受け取る。
         * ローカルシーン。
         */
        LocalTickMode[LocalTickMode["FullLocal"] = 1] = "FullLocal";
        /**
         * 消化すべきティックがない場合にローカルティックを受け取る。
         * ローカルティック補間シーン。
         */
        LocalTickMode[LocalTickMode["InterpolateLocal"] = 2] = "InterpolateLocal";
    })(LocalTickMode = g.LocalTickMode || (g.LocalTickMode = {}));
})(g || (g = {}));
var g;
(function (g) {
    /**
     * ナインパッチによる描画処理を提供するSurfaceEffector。
     *
     * このSurfaceEffectorは、画像素材の拡大・縮小において「枠」の表現を実現するものである。
     * 画像の上下左右の「枠」部分の幅・高さを渡すことで、上下の「枠」を縦に引き延ばすことなく、
     * また左右の「枠」を横に引き延ばすことなく画像を任意サイズに拡大・縮小できる。
     * ゲームにおけるメッセージウィンドウやダイアログの表現に利用することを想定している。
     */
    var NinePatchSurfaceEffector = /** @class */ (function () {
        /**
         * `NinePatchSurfaceEffector` のインスタンスを生成する。
         * @param game このインスタンスが属する `Game`
         * @param borderWidth 上下左右の「拡大しない」領域の大きさ。すべて同じ値なら数値一つを渡すことができる。省略された場合、 `4`
         */
        function NinePatchSurfaceEffector(game, borderWidth) {
            if (borderWidth === void 0) { borderWidth = 4; }
            this.game = game;
            if (typeof borderWidth === "number") {
                this.borderWidth = { top: borderWidth, bottom: borderWidth, left: borderWidth, right: borderWidth };
            }
            else {
                this.borderWidth = borderWidth;
            }
        }
        /**
         * 指定の大きさに拡大・縮小した描画結果の `Surface` を生成して返す。詳細は `SurfaceEffector#render` の項を参照。
         */
        NinePatchSurfaceEffector.prototype.render = function (srcSurface, width, height) {
            var isCreateSurface = true;
            if (!this._surface || this._surface.width !== width ||
                this._surface.height !== height || this._beforeSrcSurface !== srcSurface) {
                this._surface = this.game.resourceFactory.createSurface(Math.ceil(width), Math.ceil(height));
                this._beforeSrcSurface = srcSurface;
            }
            else {
                isCreateSurface = false;
            }
            var renderer = this._surface.renderer();
            renderer.begin();
            if (!isCreateSurface)
                renderer.clear();
            //    x0  x1                          x2
            // y0 +-----------------------------------+
            //    | 1 |             5             | 2 |
            // y1 |---+---------------------------+---|
            //    |   |                           |   |
            //    | 7 |             9             | 8 |
            //    |   |                           |   |
            // y2 |---+---------------------------+---|
            //    | 3 |             6             | 4 |
            //    +-----------------------------------+
            //
            // 1-4: 拡縮無し
            // 5-6: 水平方向へ拡縮
            // 7-8: 垂直方向へ拡縮
            // 9  : 全方向へ拡縮
            var sx1 = this.borderWidth.left;
            var sx2 = srcSurface.width - this.borderWidth.right;
            var sy1 = this.borderWidth.top;
            var sy2 = srcSurface.height - this.borderWidth.bottom;
            var dx1 = this.borderWidth.left;
            var dx2 = width - this.borderWidth.right;
            var dy1 = this.borderWidth.top;
            var dy2 = height - this.borderWidth.bottom;
            // Draw corners
            var srcCorners = [
                { x: 0, y: 0, width: this.borderWidth.left, height: this.borderWidth.top },
                { x: sx2, y: 0, width: this.borderWidth.right, height: this.borderWidth.top },
                { x: 0, y: sy2, width: this.borderWidth.left, height: this.borderWidth.bottom },
                { x: sx2, y: sy2, width: this.borderWidth.right, height: this.borderWidth.bottom }
            ];
            var destCorners = [
                { x: 0, y: 0 },
                { x: dx2, y: 0 },
                { x: 0, y: dy2 },
                { x: dx2, y: dy2 }
            ];
            var i = 0;
            for (i = 0; i < srcCorners.length; ++i) {
                var c = srcCorners[i];
                renderer.save();
                renderer.translate(destCorners[i].x, destCorners[i].y);
                renderer.drawImage(srcSurface, c.x, c.y, c.width, c.height, 0, 0);
                renderer.restore();
            }
            // Draw borders
            var srcBorders = [
                { x: sx1, y: 0, width: sx2 - sx1, height: this.borderWidth.top },
                { x: 0, y: sy1, width: this.borderWidth.left, height: sy2 - sy1 },
                { x: sx2, y: sy1, width: this.borderWidth.right, height: sy2 - sy1 },
                { x: sx1, y: sy2, width: sx2 - sx1, height: this.borderWidth.bottom }
            ];
            var destBorders = [
                { x: dx1, y: 0, width: dx2 - dx1, height: this.borderWidth.top },
                { x: 0, y: dy1, width: this.borderWidth.left, height: dy2 - dy1 },
                { x: dx2, y: dy1, width: this.borderWidth.right, height: dy2 - dy1 },
                { x: dx1, y: dy2, width: dx2 - dx1, height: this.borderWidth.bottom }
            ];
            for (i = 0; i < srcBorders.length; ++i) {
                var s = srcBorders[i];
                var d = destBorders[i];
                renderer.save();
                renderer.translate(d.x, d.y);
                renderer.transform([d.width / s.width, 0, 0, d.height / s.height, 0, 0]);
                renderer.drawImage(srcSurface, s.x, s.y, s.width, s.height, 0, 0);
                renderer.restore();
            }
            // Draw center
            var sw = sx2 - sx1;
            var sh = sy2 - sy1;
            var dw = dx2 - dx1;
            var dh = dy2 - dy1;
            renderer.save();
            renderer.translate(dx1, dy1);
            renderer.transform([dw / sw, 0, 0, dh / sh, 0, 0]);
            renderer.drawImage(srcSurface, sx1, sy1, sw, sh, 0, 0);
            renderer.restore();
            renderer.end();
            return this._surface;
        };
        return NinePatchSurfaceEffector;
    }());
    g.NinePatchSurfaceEffector = NinePatchSurfaceEffector;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * パスユーティリティ。
     * 通常、ゲーム開発者がファイルパスを扱うことはなく、このモジュールのメソッドを呼び出す必要はない。
     */
    var PathUtil;
    (function (PathUtil) {
        /**
         * 二つのパス文字列をつなぎ、相対パス表現 (".", "..") を解決して返す。
         * @param base 左辺パス文字列 (先頭の "./" を除き、".", ".." を含んではならない)
         * @param path 右辺パス文字列
         */
        function resolvePath(base, path) {
            function split(str) {
                var ret = str.split("/");
                if (ret[ret.length - 1] === "")
                    ret.pop();
                return ret;
            }
            if (path === "")
                return base;
            var baseComponents = PathUtil.splitPath(base);
            var parts = split(baseComponents.path).concat(split(path));
            var resolved = [];
            for (var i = 0; i < parts.length; ++i) {
                var part = parts[i];
                switch (part) {
                    case "..":
                        var popped = resolved.pop();
                        if (popped === undefined || popped === "" || popped === ".")
                            throw g.ExceptionFactory.createAssertionError("PathUtil.resolvePath: invalid arguments");
                        break;
                    case ".":
                        if (resolved.length === 0) {
                            resolved.push(".");
                        }
                        break;
                    case "": // 絶対パス
                        resolved = [""];
                        break;
                    default:
                        resolved.push(part);
                }
            }
            return baseComponents.host + resolved.join("/");
        }
        PathUtil.resolvePath = resolvePath;
        /**
         * パス文字列からディレクトリ名部分を切り出して返す。
         * @param path パス文字列
         */
        function resolveDirname(path) {
            var index = path.lastIndexOf("/");
            if (index === -1)
                return path;
            return path.substr(0, index);
        }
        PathUtil.resolveDirname = resolveDirname;
        /**
         * パス文字列から拡張子部分を切り出して返す。
         * @param path パス文字列
         */
        function resolveExtname(path) {
            for (var i = path.length - 1; i >= 0; --i) {
                var c = path.charAt(i);
                if (c === ".") {
                    return path.substr(i);
                }
                else if (c === "/") {
                    return "";
                }
            }
            return "";
        }
        PathUtil.resolveExtname = resolveExtname;
        /**
         * パス文字列から、node.js において require() の探索範囲になるパスの配列を作成して返す。
         * @param path ディレクトリを表すパス文字列
         */
        function makeNodeModulePaths(path) {
            var pathComponents = PathUtil.splitPath(path);
            var host = pathComponents.host;
            path = pathComponents.path;
            if (path[path.length - 1] === "/") {
                path = path.slice(0, path.length - 1);
            }
            var parts = path.split("/");
            var firstDir = parts.indexOf("node_modules");
            var root = (firstDir > 0) ? firstDir - 1 : 0;
            var dirs = [];
            for (var i = parts.length - 1; i >= root; --i) {
                if (parts[i] === "node_modules")
                    continue;
                var dirParts = parts.slice(0, i + 1);
                dirParts.push("node_modules");
                var dir = dirParts.join("/");
                dirs.push(host + dir);
            }
            return dirs;
        }
        PathUtil.makeNodeModulePaths = makeNodeModulePaths;
        /**
         * 与えられたパス文字列に与えられた拡張子を追加する。
         * @param path パス文字列
         * @param ext 追加する拡張子
         */
        function addExtname(path, ext) {
            var index = path.indexOf("?");
            if (index === -1) {
                return path + "." + ext;
            }
            // hoge?query => hoge.ext?query
            return path.substring(0, index) + "." + ext + path.substring(index, path.length);
        }
        PathUtil.addExtname = addExtname;
        /**
         * 与えられたパス文字列からホストを切り出す。
         * @param path パス文字列
         */
        function splitPath(path) {
            var host = "";
            var doubleSlashIndex = path.indexOf("//");
            if (doubleSlashIndex >= 0) {
                var hostSlashIndex = path.indexOf("/", doubleSlashIndex + 2); // 2 === "//".length
                if (hostSlashIndex >= 0) {
                    host = path.slice(0, hostSlashIndex);
                    path = path.slice(hostSlashIndex); // 先頭に "/" を残して絶対パス扱いさせる
                }
                else {
                    host = path;
                    path = "/"; // path全体がホストだったので、絶対パス扱いさせる
                }
            }
            else {
                host = "";
            }
            return { host: host, path: path };
        }
        PathUtil.splitPath = splitPath;
    })(PathUtil = g.PathUtil || (g.PathUtil = {}));
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 文字列描画のフォントファミリ。
     * 現バージョンのakashic-engineの `SystemLabel` 及び `DynamicFont` において、この値の指定は参考値に過ぎない。
     * そのため、 それらにおいて 'fontFamily` プロパティを指定した際、実行環境によっては無視される事がありえる。
     */
    var FontFamily;
    (function (FontFamily) {
        /**
         * サンセリフ体。ＭＳ Ｐゴシック等
         */
        FontFamily[FontFamily["SansSerif"] = 0] = "SansSerif";
        /**
         * セリフ体。ＭＳ 明朝等
         */
        FontFamily[FontFamily["Serif"] = 1] = "Serif";
        /**
         * 等幅。ＭＳ ゴシック等
         */
        FontFamily[FontFamily["Monospace"] = 2] = "Monospace";
    })(FontFamily = g.FontFamily || (g.FontFamily = {}));
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 文字列描画のベースライン。
     */
    var TextBaseline;
    (function (TextBaseline) {
        /**
         * em squareの上。
         */
        TextBaseline[TextBaseline["Top"] = 0] = "Top";
        /**
         * em squareの中央。
         */
        TextBaseline[TextBaseline["Middle"] = 1] = "Middle";
        /**
         * 標準的とされるベースライン。Bottomよりやや上方。
         */
        TextBaseline[TextBaseline["Alphabetic"] = 2] = "Alphabetic";
        /**
         * em squareの下。
         */
        TextBaseline[TextBaseline["Bottom"] = 3] = "Bottom";
    })(TextBaseline = g.TextBaseline || (g.TextBaseline = {}));
    /**
     * システムフォントで文字列を描画するエンティティ。
     *
     * ここでいうシステムフォントとは、akashic-engine実行環境でのデフォルトフォントである。
     * システムフォントは実行環境によって異なる場合がある。したがって `SystemLabel` による描画結果が各実行環境で同一となることは保証されない。
     * その代わりに `SystemLabel` は、Assetの読み込みなしで文字列を描画する機能を提供する。
     *
     * 絵文字などを含むユニコード文字列をすべて `BitmapFont` で提供する事は難しいことから、
     * このクラスは、事実上akashic-engineにおいてユーザ入力文字列を取り扱う唯一の手段である。
     *
     * `SystemLabel` はユーザインタラクションの対象に含めるべきではない。
     * 上述のとおり、各実行環境で描画内容の同一性が保証されないためである。
     * ユーザ入力文字列を含め、 `SystemLabel` によって提示される情報は、参考程度に表示されるなどに留めるべきである。
     * 具体的には `SystemLabel` を `touchable` にする、 `Util.createSpriteFromE()` の対象に含めるなどを行うべきではない。
     * ボタンのようなエンティティのキャプション部分も出来る限り `Label` を用いるべきで、 `SystemLabel` を利用するべきではない。
     *
     * また、akashic-engineは `SystemLabel` の描画順を保証しない。
     * 実行環境によって、次のどちらかが成立する:
     * * `SystemLabel` は、他エンティティ同様に `Scene#children` のツリー構造のpre-order順で描かれる。
     * * `SystemLabel` は、他の全エンティティが描画された後に(画面最前面に)描画される。
     *
     * 実行環境に依存しないゲームを作成するためには、`SystemLabel` はこのいずれでも正しく動作するように利用される必要がある。
     */
    var SystemLabel = /** @class */ (function (_super) {
        __extends(SystemLabel, _super);
        /**
         * 各種パラメータを指定して `SystemLabel` のインスタンスを生成する。
         * @param param このエンティティに指定するパラメータ
         */
        function SystemLabel(param) {
            var _this = _super.call(this, param) || this;
            _this.text = param.text;
            _this.fontSize = param.fontSize;
            _this.textAlign = ("textAlign" in param) ? param.textAlign : g.TextAlign.Left;
            _this.textBaseline = ("textBaseline" in param) ? param.textBaseline : TextBaseline.Alphabetic;
            _this.maxWidth = param.maxWidth;
            _this.textColor = ("textColor" in param) ? param.textColor : "black";
            _this.fontFamily = ("fontFamily" in param) ? param.fontFamily : g.FontFamily.SansSerif;
            _this.strokeWidth = ("strokeWidth" in param) ? param.strokeWidth : 0;
            _this.strokeColor = ("strokeColor" in param) ? param.strokeColor : "black";
            _this.strokeOnly = ("strokeOnly" in param) ? param.strokeOnly : false;
            return _this;
        }
        SystemLabel.prototype.renderSelf = function (renderer, camera) {
            if (this.text) {
                var offsetX;
                switch (this.textAlign) {
                    case g.TextAlign.Right:
                        offsetX = this.width;
                        break;
                    case g.TextAlign.Center:
                        offsetX = this.width / 2;
                        break;
                    default:
                        offsetX = 0;
                }
                renderer.drawSystemText(this.text, offsetX, 0, this.maxWidth, this.fontSize, this.textAlign, this.textBaseline, this.textColor, this.fontFamily, this.strokeWidth, this.strokeColor, this.strokeOnly);
            }
            return true;
        };
        return SystemLabel;
    }(g.E));
    g.SystemLabel = SystemLabel;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * テキストの描画位置。
     */
    var TextAlign;
    (function (TextAlign) {
        /**
         * 左寄せ。
         */
        TextAlign[TextAlign["Left"] = 0] = "Left";
        /**
         * 中央寄せ。
         */
        TextAlign[TextAlign["Center"] = 1] = "Center";
        /**
         * 右寄せ。
         */
        TextAlign[TextAlign["Right"] = 2] = "Right";
    })(TextAlign = g.TextAlign || (g.TextAlign = {}));
})(g || (g = {}));
var g;
(function (g) {
    /**
     * 時間経過の契機(ティック)をどのように生成するか。
     * ただしローカルティック(ローカルシーンの間などの「各プレイヤー間で独立な時間経過処理」)はこのモードの影響を受けない。
     */
    var TickGenerationMode;
    (function (TickGenerationMode) {
        /**
         * 実際の時間経過に従う。
         */
        TickGenerationMode[TickGenerationMode["ByClock"] = 0] = "ByClock";
        /**
         * 時間経過は明示的に要求する。
         * この値を用いる `Scene` の間は、 `Game#raiseTick()` を呼び出さない限り時間経過が起きない。
         */
        TickGenerationMode[TickGenerationMode["Manual"] = 1] = "Manual";
    })(TickGenerationMode = g.TickGenerationMode || (g.TickGenerationMode = {}));
})(g || (g = {}));
var g;
(function (g) {
    // Copyright (c) 2014 Andreas Madsen & Emil Bay
    // From https://github.com/AndreasMadsen/xorshift
    // https://github.com/AndreasMadsen/xorshift/blob/master/LICENSE.md
    // Arranged by DWANGO Co., Ltd.
    var Xorshift = /** @class */ (function () {
        function Xorshift(seed) {
            this.initState(seed);
        }
        Xorshift.deserialize = function (ser) {
            var ret = new Xorshift(0);
            ret._state0U = ser._state0U;
            ret._state0L = ser._state0L;
            ret._state1U = ser._state1U;
            ret._state1L = ser._state1L;
            return ret;
        };
        // シード値が1つの場合にどのようにして初期状態を定義するかは特に定まっていない
        // このコードはロジック的な裏付けは無いが採用例が多いために採用した
        // 以下採用例
        // http://meme.biology.tohoku.ac.jp/klabo-wiki/index.php?cmd=read&page=%B7%D7%BB%BB%B5%A1%2FC%2B%2B#y919a7e1
        // http://hexadrive.sblo.jp/article/63660775.html
        // http://meme.biology.tohoku.ac.jp/students/iwasaki/cxx/random.html#xorshift
        Xorshift.prototype.initState = function (seed) {
            var factor = 1812433253;
            seed = factor * (seed ^ (seed >> 30)) + 1;
            this._state0U = seed;
            seed = factor * (seed ^ (seed >> 30)) + 2;
            this._state0L = seed;
            seed = factor * (seed ^ (seed >> 30)) + 3;
            this._state1U = seed;
            seed = factor * (seed ^ (seed >> 30)) + 4;
            this._state1L = seed;
        };
        Xorshift.prototype.randomInt = function () {
            var s1U = this._state0U;
            var s1L = this._state0L;
            var s0U = this._state1U;
            var s0L = this._state1L;
            this._state0U = s0U;
            this._state0L = s0L;
            var t1U = 0;
            var t1L = 0;
            var t2U = 0;
            var t2L = 0;
            var a1 = 23;
            var m1 = 0xFFFFFFFF << (32 - a1);
            t1U = (s1U << a1) | ((s1L & m1) >>> (32 - a1));
            t1L = s1L << a1;
            s1U = s1U ^ t1U;
            s1L = s1L ^ t1L;
            t1U = s1U ^ s0U;
            t1L = s1L ^ s0L;
            var a2 = 17;
            var m2 = 0xFFFFFFFF >>> (32 - a2);
            t2U = s1U >>> a2;
            t2L = (s1L >>> a2) | ((s1U & m2) << (32 - a2));
            t1U = t1U ^ t2U;
            t1L = t1L ^ t2L;
            var a3 = 26;
            var m3 = 0xFFFFFFFF >>> (32 - a3);
            t2U = s0U >>> a3;
            t2L = (s0L >>> a3) | ((s0U & m3) << (32 - a3));
            t1U = t1U ^ t2U;
            t1L = t1L ^ t2L;
            this._state1U = t1U;
            this._state1L = t1L;
            var sumL = (t1L >>> 0) + (s0L >>> 0);
            t2U = (t1U + s0U + (sumL / 2 >>> 31)) >>> 0;
            t2L = sumL >>> 0;
            return [t2U, t2L];
        };
        Xorshift.prototype.random = function () {
            var t2 = this.randomInt();
            return (t2[0] * 4294967296 + t2[1]) / 18446744073709551616;
        };
        Xorshift.prototype.nextInt = function (min, sup) {
            return Math.floor(min + this.random() * (sup - min));
        };
        Xorshift.prototype.serialize = function () {
            return {
                _state0U: this._state0U,
                _state0L: this._state0L,
                _state1U: this._state1U,
                _state1L: this._state1L
            };
        };
        return Xorshift;
    }());
    g.Xorshift = Xorshift;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * Xorshiftを用いた乱数生成期。
     */
    var XorshiftRandomGenerator = /** @class */ (function (_super) {
        __extends(XorshiftRandomGenerator, _super);
        function XorshiftRandomGenerator(seed, xorshift) {
            var _this = this;
            if (seed === undefined) {
                throw g.ExceptionFactory.createAssertionError("XorshiftRandomGenerator#constructor: seed is undefined");
            }
            else {
                _this = _super.call(this, seed) || this;
                if (!!xorshift) {
                    _this._xorshift = g.Xorshift.deserialize(xorshift);
                }
                else {
                    _this._xorshift = new g.Xorshift(seed);
                }
            }
            return _this;
        }
        XorshiftRandomGenerator.deserialize = function (ser) {
            return new XorshiftRandomGenerator(ser._seed, ser._xorshift);
        };
        /**
         * 指定された範囲の整数の疑似乱数を生成する。
         * 生成される値は両端を含む(i.e. [min, max])ことに注意。
         *
         * @param min 生成する疑似乱数の最小値
         * @param max 生成する疑似乱数の最大値
         */
        XorshiftRandomGenerator.prototype.get = function (min, max) {
            return this._xorshift.nextInt(min, max + 1);
        };
        /**
         * 0 以上 1 未満の疑似乱数を生成する。
         */
        XorshiftRandomGenerator.prototype.generate = function () {
            return this._xorshift.random();
        };
        XorshiftRandomGenerator.prototype.serialize = function () {
            return {
                _seed: this.seed,
                _xorshift: this._xorshift.serialize()
            };
        };
        return XorshiftRandomGenerator;
    }(g.RandomGenerator));
    g.XorshiftRandomGenerator = XorshiftRandomGenerator;
})(g || (g = {}));
var g;
(function (g) {
    /**
     * akashic-engineにおけるシェーダ機能を提供するクラス。
     * 現バージョンのakashic-engineではフラグメントシェーダのみをサポートする。
     */
    var ShaderProgram = /** @class */ (function () {
        /**
         * 各種パラメータを指定して `ShaderProgram` のインスタンスを生成する。
         * @param param `ShaderProgram` に設定するパラメータ
         */
        function ShaderProgram(param) {
            this.fragmentShader = param.fragmentShader;
            this.uniforms = param.uniforms;
        }
        return ShaderProgram;
    }());
    g.ShaderProgram = ShaderProgram;
})(g || (g = {}));
// ordered files
/// <reference path="AssetLoadErrorType.ts" />
/// <reference path="errors.ts" />
/// <reference path="ResourceFactory.ts" />
/// <reference path="commons.ts" />
/// <reference path="RequireCacheable.ts" />
/// <reference path="RequireCachedValue.ts" />
/// <reference path="Destroyable.ts" />
/// <reference path="Registrable.ts" />
/// <reference path="RandomGenerator.ts" />
/// <reference path="EntityStateFlags.ts" />
/// <reference path="AssetLoadHandler.ts" />
/// <reference path="Asset.ts" />
/// <reference path="AssetManagerLoadHandler.ts" />
/// <reference path="AssetLoadFailureInfo.ts" />
/// <reference path="AssetManager.ts" />
/// <reference path="Module.ts" />
/// <reference path="ScriptAssetExecuteEnvironment.ts" />
/// <reference path="ScriptAssetContext.ts" />
/// <reference path="Matrix.ts" />
/// <reference path="Util.ts" />
/// <reference path="Collision.ts" />
/// <reference path="Trigger.ts" />
/// <reference path="Timer.ts" />
/// <reference path="TimerManager.ts" />
/// <reference path="AudioPlayer.ts" />
/// <reference path="AudioSystem.ts" />
/// <reference path="VideoPlayer.ts" />
/// <reference path="VideoSystem.ts" />
/// <reference path="Object2D.ts" />
/// <reference path="E.ts" />
/// <reference path="CacheableE.ts" />
/// <reference path="Storage.ts" />
/// <reference path="Scene.ts" />
/// <reference path="LoadingScene.ts" />
/// <reference path="DefaultLoadingScene.ts" />
/// <reference path="Sprite.ts" />
/// <reference path="FrameSprite.ts" />
/// <reference path="Player.ts" />
/// <reference path="Event.ts" />
/// <reference path="Logger.ts" />
/// <reference path="GameConfiguration.ts" />
/// <reference path="Game.ts" />
/// <reference path="Camera.ts" />
/// <reference path="ImageData.ts" />
/// <reference path="Renderer.ts" />
/// <reference path="Surface.ts" />
/// <reference path="Label.ts" />
/// <reference path="Glyph.ts" />
/// <reference path="FilledRect.ts" />
/// <reference path="Pane.ts" />
/// <reference path="SurfaceEffector.ts" />
/// <reference path="OperationPluginOperation.ts" />
/// <reference path="OperationPlugin.ts" />
/// <reference path="OperationPluginStatic.ts" />
/// <reference path="OperationPluginInfo.ts" />
/// <reference path="OperationPluginView.ts" />
/// <reference path="OperationPluginViewInfo.ts" />
/// <reference path="OperationPluginManager.ts" />
/// <reference path="executeEnvironmentVariables.ts" />
/// <reference path="TextMetrix.ts" />
/// <reference path="Font.ts" />
/// <reference path="DynamicFont.ts" />
/// <reference path="BitmapFont.ts" />
/// <reference path="SurfaceAtlasSet.ts" />
// non-ordered files
/// <reference path="AudioSystemManager.ts" />
/// <reference path="CompositeOperation.ts" />
/// <reference path="EventFilter.ts" />
/// <reference path="GlyphFactory.ts" />
/// <reference path="GameMainParameterObject.ts" />
/// <reference path="LocalTickMode.ts" />
/// <reference path="NinePatchSurfaceEffector.ts" />
/// <reference path="PathUtil.ts" />
/// <reference path="FontFamily.ts" />
/// <reference path="SystemLabel.ts" />
/// <reference path="TextAlign.ts" />
/// <reference path="TickGenerationMode.ts" />
/// <reference path="Xorshift.ts" />
/// <reference path="XorshiftRandomGenerator.ts" />
/// <reference path="Shader.ts" />

module.exports = g;
}).call(this);

},{}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });

},{}],4:[function(require,module,exports){
module.exports = require("./lib/index");

},{"./lib/index":27}],5:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Clock = void 0;
var g = require("@akashic/akashic-engine");
/**
 * FPS管理用のクロック。
 *
 * `pdi.Looper` の定期または不定期の呼び出しを受け付け、指定されたFPSから求めた
 * 1フレーム分の時間(1フレーム時間)が経過するたびに `frameTrigger` をfireする。
 */
var Clock = /** @class */ (function () {
    function Clock(param) {
        this.fps = param.fps;
        this.scaleFactor = param.scaleFactor || 1;
        this.frameTrigger = new g.Trigger();
        this.rawFrameTrigger = new g.Trigger();
        this._platform = param.platform;
        this._maxFramePerOnce = param.maxFramePerOnce;
        this._deltaTimeBrokenThreshold = param.deltaTimeBrokenThreshold || Clock.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD;
        if (param.frameHandler) {
            this.frameTrigger.add(param.frameHandler, param.frameHandlerOwner);
        }
        this.running = false;
        this._totalDeltaTime = 0;
        this._onLooperCall_bound = this._onLooperCall.bind(this);
        this._looper = this._platform.createLooper(this._onLooperCall_bound);
        this._waitTime = 0;
        this._waitTimeDoubled = 0;
        this._waitTimeMax = 0;
        this._skipFrameWaitTime = 0;
        this._realMaxFramePerOnce = 0;
    }
    Clock.prototype.start = function () {
        if (this.running)
            return;
        this._totalDeltaTime = 0;
        this._updateWaitTimes(this.fps, this.scaleFactor);
        this._looper.start();
        this.running = true;
    };
    Clock.prototype.stop = function () {
        if (!this.running)
            return;
        this._looper.stop();
        this.running = false;
    };
    /**
     * `scaleFactor` を変更する。
     * start()した後にも呼び出せるが、1フレーム以下の経過時間情報はリセットされる点に注意。
     */
    Clock.prototype.changeScaleFactor = function (scaleFactor) {
        if (this.running) {
            this.stop();
            this.scaleFactor = scaleFactor;
            this.start();
        }
        else {
            this.scaleFactor = scaleFactor;
        }
    };
    Clock.prototype._onLooperCall = function (deltaTime) {
        var rawDeltaTime = deltaTime;
        if (deltaTime <= 0) {
            // 時間が止まっているか巻き戻っている。初回呼び出しか、あるいは何かがおかしい。時間経過0と見なす。
            return this._waitTime - this._totalDeltaTime;
        }
        if (deltaTime > this._deltaTimeBrokenThreshold) {
            // 間隔が長すぎる。何かがおかしい。時間経過を1フレーム分とみなす。
            deltaTime = this._waitTime;
        }
        var totalDeltaTime = this._totalDeltaTime;
        totalDeltaTime += deltaTime;
        if (totalDeltaTime <= this._skipFrameWaitTime) {
            // 1フレーム分消化するほどの時間が経っていない。
            this._totalDeltaTime = totalDeltaTime;
            return this._waitTime - totalDeltaTime;
        }
        var frameCount = (totalDeltaTime < this._waitTimeDoubled) ? 1
            : (totalDeltaTime > this._waitTimeMax) ? this._realMaxFramePerOnce
                : (totalDeltaTime / this._waitTime) | 0;
        var fc = frameCount;
        var arg = {
            deltaTime: rawDeltaTime,
            interrupt: false
        };
        while (fc > 0 && this.running && !arg.interrupt) {
            --fc;
            this.frameTrigger.fire(arg);
            arg.deltaTime = 0; // 同ループによる2度目以降の呼び出しは差分を0とみなす。
        }
        totalDeltaTime -= ((frameCount - fc) * this._waitTime);
        this.rawFrameTrigger.fire();
        this._totalDeltaTime = totalDeltaTime;
        return this._waitTime - totalDeltaTime;
    };
    Clock.prototype._updateWaitTimes = function (fps, scaleFactor) {
        var realFps = fps * scaleFactor;
        this._waitTime = 1000 / realFps;
        this._waitTimeDoubled = Math.max((2000 / realFps) | 0, 1);
        this._waitTimeMax = Math.max(scaleFactor * (1000 * this._maxFramePerOnce / realFps) | 0, 1);
        this._skipFrameWaitTime = (this._waitTime * Clock.ANTICIPATE_RATE) | 0;
        this._realMaxFramePerOnce = this._maxFramePerOnce * scaleFactor;
    };
    /**
     * 経過時間先取りの比率。
     *
     * FPSから定まる「1フレーム」の経過時間が経っていなくても、この割合の時間が経過していれば1フレーム分の計算を進めてしまう。
     * その代わりに次フレームまでの所要時間を長くする。
     * 例えば20FPSであれば50msで1フレームだが、50*0.8 = 40ms 時点で1フレーム進めてしまい、次フレームまでの時間を60msにする。
     */
    Clock.ANTICIPATE_RATE = 0.8;
    /**
     * 異常値とみなして無視する `Looper` の呼び出し間隔[ms]のデフォルト値。
     */
    Clock.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD = 150;
    return Clock;
}());
exports.Clock = Clock;

},{"@akashic/akashic-engine":1}],6:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.EventBuffer = void 0;
var pdi = require("@akashic/akashic-pdi");
var g = require("@akashic/akashic-engine");
var PointEventResolver_1 = require("./PointEventResolver");
/**
 * AMFlowとPDIから流れ込むイベントを蓄積するバッファ。
 *
 * AMFLowから受信するかどうか、AMFlowに送るかどうかは外部から切り替えることができる。
 * 状態によっては、`_amflow` の認証で `subscribeEvent` と `sendEvent` のいずれかまたは両方の権限を取得している必要がある。
 * 詳細は `setMode()` のコメントを参照。
 */
var EventBuffer = /** @class */ (function () {
    function EventBuffer(param) {
        this._amflow = param.amflow;
        this._isLocalReceiver = true;
        this._isReceiver = false;
        this._isSender = false;
        this._isDiscarder = false;
        this._defaultEventPriority = 0;
        this._buffer = [];
        this._joinLeaveBuffer = [];
        this._localBuffer = [];
        this._filters = null;
        this._unfilteredLocalEvents = [];
        this._unfilteredEvents = [];
        this._pointEventResolver = new PointEventResolver_1.PointEventResolver({ game: param.game });
        this._onEvent_bound = this.onEvent.bind(this);
    }
    EventBuffer.isEventLocal = function (pev) {
        switch (pev[0 /* Code */]) {
            case 0 /* Join */:
                return pev[5 /* Local */];
            case 1 /* Leave */:
                return pev[3 /* Local */];
            case 2 /* Timestamp */:
                return pev[4 /* Local */];
            case 32 /* Message */:
                return pev[4 /* Local */];
            case 33 /* PointDown */:
                return pev[7 /* Local */];
            case 34 /* PointMove */:
                return pev[11 /* Local */];
            case 35 /* PointUp */:
                return pev[11 /* Local */];
            case 64 /* Operation */:
                return pev[5 /* Local */];
            default:
                throw g.ExceptionFactory.createAssertionError("EventBuffer.isEventLocal");
        }
    };
    /**
     * モードを切り替える。
     *
     * この関数の呼び出す場合、最後に呼び出された _amflow#authenticate() から得た Permission は次の条件を満たさねばならない:
     * * 引数 `param.isReceiver` に真を渡す場合、次に偽を渡すまでの間、 `subscribeEvent` が真であること。
     * * 引数 `param.isSender` に真を渡す場合、次に偽を渡すまでの間、 `sendEvent` が真であること。
     */
    EventBuffer.prototype.setMode = function (param) {
        if (param.isLocalReceiver != null) {
            this._isLocalReceiver = param.isLocalReceiver;
        }
        if (param.isReceiver != null) {
            if (this._isReceiver !== param.isReceiver) {
                this._isReceiver = param.isReceiver;
                if (param.isReceiver) {
                    this._amflow.onEvent(this._onEvent_bound);
                }
                else {
                    this._amflow.offEvent(this._onEvent_bound);
                }
            }
        }
        if (param.isSender != null) {
            this._isSender = param.isSender;
        }
        if (param.isDiscarder != null) {
            this._isDiscarder = param.isDiscarder;
        }
        if (param.defaultEventPriority != null) {
            this._defaultEventPriority = 3 /* Priority */ & param.defaultEventPriority;
        }
    };
    EventBuffer.prototype.getMode = function () {
        return {
            isLocalReceiver: this._isLocalReceiver,
            isReceiver: this._isReceiver,
            isSender: this._isSender,
            isDiscarder: this._isDiscarder,
            defaultEventPriority: this._defaultEventPriority
        };
    };
    EventBuffer.prototype.onEvent = function (pev) {
        if (EventBuffer.isEventLocal(pev)) {
            if (this._isLocalReceiver && !this._isDiscarder) {
                this._unfilteredLocalEvents.push(pev);
            }
            return;
        }
        if (this._isReceiver && !this._isDiscarder) {
            this._unfilteredEvents.push(pev);
        }
        if (this._isSender) {
            if (pev[1 /* EventFlags */] == null) {
                pev[1 /* EventFlags */] = this._defaultEventPriority;
            }
            this._amflow.sendEvent(pev);
        }
    };
    EventBuffer.prototype.onPointEvent = function (e) {
        var pev;
        switch (e.type) {
            case 0 /* Down */:
                pev = this._pointEventResolver.pointDown(e);
                break;
            case 1 /* Move */:
                pev = this._pointEventResolver.pointMove(e);
                break;
            case 2 /* Up */:
                pev = this._pointEventResolver.pointUp(e);
                break;
        }
        if (!pev)
            return;
        this.onEvent(pev);
    };
    /**
     * filterを無視してイベントを追加する。
     */
    EventBuffer.prototype.addEventDirect = function (pev) {
        if (EventBuffer.isEventLocal(pev)) {
            if (!this._isLocalReceiver || this._isDiscarder)
                return;
            this._localBuffer.push(pev);
            return;
        }
        if (this._isReceiver && !this._isDiscarder) {
            if (pev[0 /* Code */] === 0 /* Join */ || pev[0 /* Code */] === 1 /* Leave */) {
                this._joinLeaveBuffer.push(pev);
            }
            else {
                this._buffer.push(pev);
            }
        }
        if (this._isSender) {
            if (pev[1 /* EventFlags */] == null) {
                pev[1 /* EventFlags */] = this._defaultEventPriority;
            }
            this._amflow.sendEvent(pev);
        }
    };
    EventBuffer.prototype.readEvents = function () {
        var ret = this._buffer;
        if (ret.length === 0)
            return null;
        this._buffer = [];
        return ret;
    };
    EventBuffer.prototype.readJoinLeaves = function () {
        var ret = this._joinLeaveBuffer;
        if (ret.length === 0)
            return null;
        this._joinLeaveBuffer = [];
        return ret;
    };
    EventBuffer.prototype.readLocalEvents = function () {
        var ret = this._localBuffer;
        if (ret.length === 0)
            return null;
        this._localBuffer = [];
        return ret;
    };
    EventBuffer.prototype.addFilter = function (filter, handleEmpty) {
        if (!this._filters)
            this._filters = [];
        this._filters.push({ func: filter, handleEmpty: !!handleEmpty });
    };
    EventBuffer.prototype.removeFilter = function (filter) {
        if (!this._filters)
            return;
        if (!filter) {
            this._filters = null;
            return;
        }
        for (var i = this._filters.length - 1; i >= 0; --i) {
            if (this._filters[i].func === filter)
                this._filters.splice(i, 1);
        }
    };
    EventBuffer.prototype.processEvents = function (isLocal) {
        var ulpevs = this._unfilteredLocalEvents;
        var upevs = this._unfilteredEvents;
        this._unfilteredLocalEvents = [];
        var pevs = ulpevs;
        if (!isLocal && upevs.length > 0) {
            pevs = (pevs.length > 0) ? pevs.concat(upevs) : upevs;
            this._unfilteredEvents = [];
        }
        if (this._filters) {
            for (var i = 0; i < this._filters.length; ++i) {
                var filter = this._filters[i];
                if (pevs.length > 0 || filter.handleEmpty)
                    pevs = this._filters[i].func(pevs) || [];
            }
        }
        for (var i = 0; i < pevs.length; ++i) {
            var pev = pevs[i];
            if (EventBuffer.isEventLocal(pev)) {
                this._localBuffer.push(pev);
            }
            else if (pev[0 /* Code */] === 0 /* Join */ || pev[0 /* Code */] === 1 /* Leave */) {
                this._joinLeaveBuffer.push(pev);
            }
            else {
                this._buffer.push(pev);
            }
        }
    };
    return EventBuffer;
}());
exports.EventBuffer = EventBuffer;

},{"./PointEventResolver":17,"@akashic/akashic-engine":1,"@akashic/akashic-pdi":3}],7:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.EventConverter = void 0;
var g = require("@akashic/akashic-engine");
var EventConverter = /** @class */ (function () {
    function EventConverter(param) {
        this._game = param.game;
        this._playerTable = {};
    }
    /**
     * playlog.Eventからg.Eventへ変換する。
     */
    EventConverter.prototype.toGameEvent = function (pev) {
        var pointerId;
        var entityId;
        var target;
        var point;
        var startDelta;
        var prevDelta;
        var local;
        var timestamp;
        var eventCode = pev[0 /* Code */];
        // TODO: transient event 対応
        var prio = pev[1 /* EventFlags */];
        var playerId = pev[2 /* PlayerId */];
        var player = this._playerTable[playerId] || { id: playerId };
        switch (eventCode) {
            case 0 /* Join */:
                player = {
                    id: playerId,
                    name: pev[3 /* PlayerName */]
                };
                this._playerTable[playerId] = player;
                var store = undefined;
                if (pev[4 /* StorageData */]) {
                    var keys = [];
                    var values = [];
                    pev[4 /* StorageData */].map(function (data) {
                        keys.push(data.readKey);
                        values.push(data.values);
                    });
                    store = new g.StorageValueStore(keys, values);
                }
                return new g.JoinEvent(player, store, prio);
            case 1 /* Leave */:
                delete this._playerTable[player.id];
                return new g.LeaveEvent(player, prio);
            case 2 /* Timestamp */:
                timestamp = pev[3 /* Timestamp */];
                return new g.TimestampEvent(timestamp, player, prio);
            case 32 /* Message */:
                local = pev[4 /* Local */];
                return new g.MessageEvent(pev[3 /* Message */], player, local, prio);
            case 33 /* PointDown */:
                local = pev[7 /* Local */];
                pointerId = pev[3 /* PointerId */];
                entityId = pev[6 /* EntityId */];
                target = (entityId == null) ? undefined
                    : (entityId >= 0) ? this._game.db[entityId]
                        : this._game._localDb[entityId];
                point = {
                    x: pev[4 /* X */],
                    y: pev[5 /* Y */]
                };
                return new g.PointDownEvent(pointerId, target, point, player, local, prio);
            case 34 /* PointMove */:
                local = pev[11 /* Local */];
                pointerId = pev[3 /* PointerId */];
                entityId = pev[10 /* EntityId */];
                target = (entityId == null) ? undefined
                    : (entityId >= 0) ? this._game.db[entityId]
                        : this._game._localDb[entityId];
                point = {
                    x: pev[4 /* X */],
                    y: pev[5 /* Y */]
                };
                startDelta = {
                    x: pev[6 /* StartDeltaX */],
                    y: pev[7 /* StartDeltaY */]
                };
                prevDelta = {
                    x: pev[8 /* PrevDeltaX */],
                    y: pev[9 /* PrevDeltaY */]
                };
                return new g.PointMoveEvent(pointerId, target, point, prevDelta, startDelta, player, local, prio);
            case 35 /* PointUp */:
                local = pev[11 /* Local */];
                pointerId = pev[3 /* PointerId */];
                entityId = pev[10 /* EntityId */];
                target = (entityId == null) ? undefined
                    : (entityId >= 0) ? this._game.db[entityId]
                        : this._game._localDb[entityId];
                point = {
                    x: pev[4 /* X */],
                    y: pev[5 /* Y */]
                };
                startDelta = {
                    x: pev[6 /* StartDeltaX */],
                    y: pev[7 /* StartDeltaY */]
                };
                prevDelta = {
                    x: pev[8 /* PrevDeltaX */],
                    y: pev[9 /* PrevDeltaY */]
                };
                return new g.PointUpEvent(pointerId, target, point, prevDelta, startDelta, player, local, prio);
            case 64 /* Operation */:
                local = pev[5 /* Local */];
                var operationCode = pev[3 /* OperationCode */];
                var operationData = pev[4 /* OperationData */];
                var decodedData = this._game._decodeOperationPluginOperation(operationCode, operationData);
                return new g.OperationEvent(operationCode, decodedData, player, local, prio);
            default:
                // TODO handle error
                throw g.ExceptionFactory.createAssertionError("EventConverter#toGameEvent");
        }
    };
    /**
     * g.Eventからplaylog.Eventに変換する。
     */
    EventConverter.prototype.toPlaylogEvent = function (e, preservePlayer) {
        var targetId;
        var playerId;
        var priority = e.priority; // NOTE: このレイヤーでは priority (eventFlags) の中身を精査しないこととする
        switch (e.type) {
            case g.EventType.Join:
            case g.EventType.Leave:
                // game-driver は決して Join と Leave を生成しない
                throw g.ExceptionFactory.createAssertionError("EventConverter#toPlaylogEvent: Invalid type: " + g.EventType[e.type]);
            case g.EventType.Timestamp:
                var ts = e;
                playerId = preservePlayer ? ts.player.id : this._game.player.id;
                return [
                    2 /* Timestamp */,
                    priority,
                    playerId,
                    ts.timestamp // 3: タイムスタンプ
                ];
            case g.EventType.PointDown:
                var pointDown = e;
                targetId = pointDown.target ? pointDown.target.id : null;
                playerId = preservePlayer ? pointDown.player.id : this._game.player.id;
                return [
                    33 /* PointDown */,
                    priority,
                    playerId,
                    pointDown.pointerId,
                    pointDown.point.x,
                    pointDown.point.y,
                    targetId,
                    !!pointDown.local // 7?: 直前のポイントムーブイベントからのY座標の差
                ];
            case g.EventType.PointMove:
                var pointMove = e;
                targetId = pointMove.target ? pointMove.target.id : null;
                playerId = preservePlayer ? pointMove.player.id : this._game.player.id;
                return [
                    34 /* PointMove */,
                    priority,
                    playerId,
                    pointMove.pointerId,
                    pointMove.point.x,
                    pointMove.point.y,
                    pointMove.startDelta.x,
                    pointMove.startDelta.y,
                    pointMove.prevDelta.x,
                    pointMove.prevDelta.y,
                    targetId,
                    !!pointMove.local // 11?: 直前のポイントムーブイベントからのY座標の差
                ];
            case g.EventType.PointUp:
                var pointUp = e;
                targetId = pointUp.target ? pointUp.target.id : null;
                playerId = preservePlayer ? pointUp.player.id : this._game.player.id;
                return [
                    35 /* PointUp */,
                    priority,
                    playerId,
                    pointUp.pointerId,
                    pointUp.point.x,
                    pointUp.point.y,
                    pointUp.startDelta.x,
                    pointUp.startDelta.y,
                    pointUp.prevDelta.x,
                    pointUp.prevDelta.y,
                    targetId,
                    !!pointUp.local // 11?: 直前のポイントムーブイベントからのY座標の差
                ];
            case g.EventType.Message:
                var message = e;
                playerId = preservePlayer ? message.player.id : this._game.player.id;
                return [
                    32 /* Message */,
                    priority,
                    playerId,
                    message.data,
                    !!message.local // 4?: ローカル
                ];
            case g.EventType.Operation:
                var op = e;
                playerId = preservePlayer ? op.player.id : this._game.player.id;
                return [
                    64 /* Operation */,
                    priority,
                    playerId,
                    op.code,
                    op.data,
                    !!op.local // 5?: ローカル
                ];
            default:
                throw g.ExceptionFactory.createAssertionError("Unknown type: " + e.type);
        }
    };
    EventConverter.prototype.makePlaylogOperationEvent = function (op) {
        var playerId = this._game.player.id;
        var priority = (op.priority != null) ? 3 /* Priority */ & op.priority : 0;
        return [
            64 /* Operation */,
            priority,
            playerId,
            op._code,
            op.data,
            !!op.local // 5: ローカル
        ];
    };
    return EventConverter;
}());
exports.EventConverter = EventConverter;

},{"@akashic/akashic-engine":1}],8:[function(require,module,exports){
arguments[4][3][0].apply(exports,arguments)
},{"dup":3}],9:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * `GameLoop` の実行モード。
 */
var ExecutionMode;
(function (ExecutionMode) {
    /**
     * `GameLoop` がactiveである。
     *
     * `GameLoop#_executionMode` がこの値である場合、そのインスタンスは:
     *  - playlog.Eventを外部から受け付ける
     *  - playlog.Tickを生成し外部へ送信する
     */
    ExecutionMode[ExecutionMode["Active"] = 0] = "Active";
    /**
     * `GameLoop` がpassiveである。
     *
     * `GameLoop#_executionMode` がこの値である場合、そのインスタンスは:
     *  - playlog.Eventを外部に送信する
     *  - playlog.Tickを受信し、それに基づいて `g.Game#tick()` を呼び出す
     */
    ExecutionMode[ExecutionMode["Passive"] = 1] = "Passive";
})(ExecutionMode || (ExecutionMode = {}));
exports.default = ExecutionMode;

},{}],10:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Game = void 0;
var g = require("@akashic/akashic-engine");
/**
 * Gameクラス。
 *
 * このクラスはakashic-engineに由来するクラスであり、
 * アンダースコアで始まるプロパティ (e.g. _foo) を外部から参照する場合がある点に注意。
 * (akashic-engine においては、_foo は「ゲーム開発者向けでない」ことしか意味しない。)
 */
var Game = /** @class */ (function (_super) {
    __extends(Game, _super);
    function Game(param) {
        var _this = _super.call(this, param.configuration, param.resourceFactory, param.assetBase, param.player.id, param.operationPluginViewInfo) || this;
        _this.agePassedTrigger = new g.Trigger();
        _this.targetTimeReachedTrigger = new g.Trigger();
        _this.skippingChangedTrigger = new g.Trigger();
        _this.abortTrigger = new g.Trigger();
        _this.player = param.player;
        _this.raiseEventTrigger = new g.Trigger();
        _this.raiseTickTrigger = new g.Trigger();
        _this.snapshotTrigger = new g.Trigger();
        _this.isSnapshotSaver = !!param.isSnapshotSaver;
        _this._getCurrentTimeFunc = null;
        _this._eventFilterFuncs = null;
        _this._notifyPassedAgeTable = {};
        _this._notifiesTargetTimeReached = false;
        _this._isSkipAware = false;
        _this._gameArgs = param.gameArgs;
        _this._globalGameArgs = param.globalGameArgs;
        _this.skippingChangedTrigger.add(_this._onSkippingChanged, _this);
        return _this;
    }
    /**
     * 特定age到達時の通知を要求する。
     * @param age 通知を要求するage
     */
    Game.prototype.requestNotifyAgePassed = function (age) {
        this._notifyPassedAgeTable[age] = true;
    };
    /**
     * 特定age到達時の通知要求を解除する。
     * @param age 通知要求を解除するage
     */
    Game.prototype.cancelNotifyAgePassed = function (age) {
        delete this._notifyPassedAgeTable[age];
    };
    /**
     * 次に目標時刻を到達した時点を通知するよう要求する。
     * 重複呼び出しはサポートしていない。すなわち、呼び出し後 `targetTimeReachedTrigger` がfireされるまでの呼び出しは無視される。
     */
    Game.prototype.requestNotifyTargetTimeReached = function () {
        this._notifiesTargetTimeReached = true;
    };
    /**
     * 目標時刻を到達した時点を通知要求を解除する。
     */
    Game.prototype.cancelNofityTargetTimeReached = function () {
        this._notifiesTargetTimeReached = false;
    };
    Game.prototype.fireAgePassedIfNeeded = function () {
        var age = this.age - 1; // 通過済みのageを確認するため -1 する。
        if (this._notifyPassedAgeTable[age]) {
            delete this._notifyPassedAgeTable[age];
            this.agePassedTrigger.fire(age);
            return true;
        }
        return false;
    };
    /**
     * `Game` が利用する時刻取得関数をセットする。
     * このメソッドは `Game#_load()` 呼び出しに先行して呼び出されていなければならない。
     */
    Game.prototype.setCurrentTimeFunc = function (fun) {
        this._getCurrentTimeFunc = fun;
    };
    /**
     * `Game` のイベントフィルタ関連実装をセットする。
     * このメソッドは `Game#_load()` 呼び出しに先行して呼び出されていなければならない。
     */
    Game.prototype.setEventFilterFuncs = function (funcs) {
        this._eventFilterFuncs = funcs;
    };
    Game.prototype.setStorageFunc = function (funcs) {
        this.storage._registerLoad(funcs.storageGetFunc);
        this.storage._registerWrite(funcs.storagePutFunc);
        // TODO: akashic-engine 側で書き換えられるようにする
        this.storage.requestValuesForJoinPlayer = funcs.requestValuesForJoinFunc;
    };
    Game.prototype.getIsSkipAware = function () {
        return this._isSkipAware;
    };
    Game.prototype.setIsSkipAware = function (aware) {
        this._isSkipAware = aware;
    };
    Game.prototype.getCurrentTime = function () {
        // GameLoopの同名メソッドとは戻り値が異なるが、 `Game.getCurrentTime()` は `Date.now()` の代替として使用されるため、整数値を返す。
        return Math.floor(this._getCurrentTimeFunc());
    };
    Game.prototype.raiseEvent = function (event) {
        this.raiseEventTrigger.fire(event);
    };
    // TODO: (WIP) playlog.Event[] をとるべきか検討し対応する。
    Game.prototype.raiseTick = function (events) {
        if (!this.scene() || this.scene().tickGenerationMode !== g.TickGenerationMode.Manual)
            throw g.ExceptionFactory.createAssertionError("Game#raiseTick(): tickGenerationMode for the current scene is not Manual.");
        this.raiseTickTrigger.fire(events);
    };
    Game.prototype.addEventFilter = function (filter, handleEmpty) {
        this._eventFilterFuncs.addFilter(filter, handleEmpty);
    };
    Game.prototype.removeEventFilter = function (filter) {
        this._eventFilterFuncs.removeFilter(filter);
    };
    Game.prototype.shouldSaveSnapshot = function () {
        return this.isSnapshotSaver;
    };
    // NOTE: 現状実装が `shouldSaveSnapshot()` と等価なので、簡易対応としてこの実装を用いる。
    Game.prototype.isActiveInstance = function () {
        return this.shouldSaveSnapshot();
    };
    Game.prototype.saveSnapshot = function (gameSnapshot, timestamp) {
        if (timestamp === void 0) { timestamp = this._getCurrentTimeFunc(); }
        if (!this.shouldSaveSnapshot())
            return;
        this.snapshotTrigger.fire({
            frame: this.age,
            timestamp: timestamp,
            data: {
                randGenSer: this.random[0].serialize(),
                gameSnapshot: gameSnapshot
            }
        });
    };
    Game.prototype._destroy = function () {
        this.agePassedTrigger.destroy();
        this.agePassedTrigger = null;
        this.targetTimeReachedTrigger.destroy();
        this.targetTimeReachedTrigger = null;
        this.skippingChangedTrigger.destroy();
        this.skippingChangedTrigger = null;
        this.abortTrigger.destroy();
        this.abortTrigger = null;
        this.player = null;
        this.raiseEventTrigger.destroy();
        this.raiseEventTrigger = null;
        this.raiseTickTrigger.destroy();
        this.raiseTickTrigger = null;
        this.snapshotTrigger.destroy();
        this.snapshotTrigger = null;
        this.isSnapshotSaver = false;
        this._getCurrentTimeFunc = null;
        this._eventFilterFuncs = null;
        this._notifyPassedAgeTable = null;
        this._gameArgs = null;
        this._globalGameArgs = null;
        _super.prototype._destroy.call(this);
    };
    Game.prototype._restartWithSnapshot = function (snapshot) {
        var data = snapshot.data;
        this._eventFilterFuncs.removeFilter();
        if (data.seed != null) {
            // 例外ケース: 第0スタートポイントでスナップショットは持っていないので特別対応
            var randGen = new g.XorshiftRandomGenerator(data.seed);
            this._reset({ age: snapshot.frame, randGen: randGen });
            this._loadAndStart({ args: this._gameArgs, globalArgs: this._globalGameArgs });
        }
        else {
            var randGen = new g.XorshiftRandomGenerator(0, data.randGenSer);
            this._reset({ age: snapshot.frame, randGen: randGen });
            this._loadAndStart({ snapshot: data.gameSnapshot });
        }
    };
    Game.prototype._leaveGame = function () {
        // do nothing.
    };
    Game.prototype._abortGame = function () {
        this.abortTrigger.fire();
    };
    Game.prototype._onRawTargetTimeReached = function (targetTime) {
        if (this._notifiesTargetTimeReached) {
            this._notifiesTargetTimeReached = false;
            this.targetTimeReachedTrigger.fire(targetTime);
        }
    };
    Game.prototype._onSkippingChanged = function (skipping) {
        if (this._isSkipAware) {
            this.skippingChanged.fire(skipping);
        }
    };
    return Game;
}(g.Game));
exports.Game = Game;

},{"@akashic/akashic-engine":1}],11:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.GameDriver = void 0;
var es6_promise_1 = require("es6-promise");
var g = require("@akashic/akashic-engine");
var ExecutionMode_1 = require("./ExecutionMode");
var Game_1 = require("./Game");
var EventBuffer_1 = require("./EventBuffer");
var GameLoop_1 = require("./GameLoop");
var PdiUtil_1 = require("./PdiUtil");
var GAME_DESTROYED_MESSAGE = "GAME_DESTROYED";
var GameDriver = /** @class */ (function () {
    function GameDriver(param) {
        this.errorTrigger = new g.Trigger();
        if (param.errorHandler)
            this.errorTrigger.add(param.errorHandler, param.errorHandlerOwner);
        this.configurationLoadedTrigger = new g.Trigger();
        this.gameCreatedTrigger = new g.Trigger();
        this._platform = param.platform;
        this._loadConfigurationFunc = PdiUtil_1.PdiUtil.makeLoadConfigurationFunc(param.platform);
        this._player = param.player;
        this._rendererRequirement = null;
        this._playId = null;
        this._game = null;
        this._gameLoop = null;
        this._eventBuffer = null;
        this._openedAmflow = false;
        this._playToken = null;
        this._permission = null;
        this._hidden = false;
        this._destroyed = false;
    }
    /**
     * `GameDriver` を初期化する。
     */
    GameDriver.prototype.initialize = function (param, callback) {
        this.doInitialize(param).then(function () { callback(); }, callback);
    };
    /**
     * `GameDriver` の各種状態を変更する。
     *
     * 引数 `param` のうち、省略されなかった値が新たに設定される。
     * `startGame()` によりゲームが開始されていた場合、暗黙に `stopGame()` が行われ、完了後 `startGame()` される。
     */
    GameDriver.prototype.changeState = function (param, callback) {
        var _this = this;
        var pausing = this._gameLoop && this._gameLoop.running;
        if (pausing)
            this._gameLoop.stop();
        this.initialize(param, function (err) {
            if (err) {
                callback(err);
                return;
            }
            if (pausing)
                _this._gameLoop.start();
            callback();
        });
    };
    /**
     * ゲームを開始する。
     * このメソッドの呼び出しは、 `initialize()` の完了後でなければならない。
     */
    GameDriver.prototype.startGame = function () {
        if (!this._gameLoop) {
            this.errorTrigger.fire(new Error("Not initialized"));
            return;
        }
        this._gameLoop.start();
    };
    /**
     * ゲームを(一時的に)止める。
     *
     * このメソッドの呼び出し後、 `startGame()` が呼び出されるまで、 `Game#tick()` は呼び出されない。
     * Active であればティックの生成が行われず、 Passive であれば受信したティックは蓄積される。
     */
    GameDriver.prototype.stopGame = function () {
        if (this._gameLoop) {
            this._gameLoop.stop();
        }
    };
    /**
     * このドライバが次にティックを生成する場合の、ageの値を設定する。
     * `ExecutionMode.Active` でない場合、動作に影響を与えない。
     * このメソッドの呼び出しは、 `initialize()` の完了後でなければならない。
     *
     * @param age 次に生成されるティックのage
     */
    GameDriver.prototype.setNextAge = function (age) {
        this._gameLoop.setNextAge(age);
    };
    GameDriver.prototype.getPermission = function () {
        return this._permission;
    };
    GameDriver.prototype.getDriverConfiguration = function () {
        return {
            playId: this._playId,
            playToken: this._playToken,
            executionMode: this._gameLoop ? this._gameLoop.getExecutionMode() : undefined,
            eventBufferMode: this._eventBuffer ? this._eventBuffer.getMode() : undefined
        };
    };
    GameDriver.prototype.getLoopConfiguration = function () {
        return this._gameLoop ? this._gameLoop.getLoopConfiguration() : null;
    };
    GameDriver.prototype.getHidden = function () {
        return this._hidden;
    };
    /**
     * PDIに対してプライマリサーフェスのリセットを要求する。
     *
     * @param width プライマリサーフェスの幅。
     * @param height プライマリサーフェスの高さ。
     * @param rendererCandidates Rendererのタイプ。
     */
    GameDriver.prototype.resetPrimarySurface = function (width, height, rendererCandidates) {
        rendererCandidates = rendererCandidates ? rendererCandidates
            : this._rendererRequirement ? this._rendererRequirement.rendererCandidates
                : null;
        var game = this._game;
        var pf = this._platform;
        var primarySurface = pf.getPrimarySurface();
        game.renderers = game.renderers.filter(function (renderer) { return renderer !== primarySurface.renderer(); });
        pf.setRendererRequirement({
            primarySurfaceWidth: width,
            primarySurfaceHeight: height,
            rendererCandidates: rendererCandidates
        });
        this._rendererRequirement = {
            primarySurfaceWidth: width,
            primarySurfaceHeight: height,
            rendererCandidates: rendererCandidates
        };
        game.renderers.push(pf.getPrimarySurface().renderer());
        game.width = width;
        game.height = height;
        game.resized.fire({ width: width, height: height });
        game.modified = true;
    };
    GameDriver.prototype.doInitialize = function (param) {
        var _this = this;
        var p = new es6_promise_1.Promise(function (resolve, reject) {
            if (_this._gameLoop && _this._gameLoop.running) {
                return reject(new Error("Game is running. Must be stopped."));
            }
            if (_this._gameLoop && param.loopConfiguration) {
                _this._gameLoop.setLoopConfiguration(param.loopConfiguration);
            }
            if (param.hidden != null) {
                _this._hidden = param.hidden;
                if (_this._game) {
                    _this._game._setMuted(param.hidden);
                }
            }
            resolve();
        }).then(function () {
            _this._assertLive();
            return _this._doSetDriverConfiguration(param.driverConfiguration);
        });
        if (!param.configurationUrl)
            return p;
        return p.then(function () {
            _this._assertLive();
            return _this._loadConfiguration(param.configurationUrl, param.assetBase, param.configurationBase);
        }).then(function (conf) {
            _this._assertLive();
            return _this._createGame(conf, _this._player, param);
        });
    };
    GameDriver.prototype.destroy = function () {
        var _this = this;
        // NOTE: ここで破棄されるTriggerのfire中に呼ばれるとクラッシュするので、同期的処理だが念のためPromiseに包んで非同期で実行する
        return new es6_promise_1.Promise(function (resolve, reject) {
            _this.stopGame();
            if (_this._game) {
                _this._game._destroy();
                _this._game = null;
            }
            _this.errorTrigger.destroy();
            _this.errorTrigger = null;
            _this.configurationLoadedTrigger.destroy();
            _this.configurationLoadedTrigger = null;
            _this.gameCreatedTrigger.destroy();
            _this.gameCreatedTrigger = null;
            if (_this._platform.destroy) {
                _this._platform.destroy();
            }
            else {
                _this._platform.setRendererRequirement(undefined);
            }
            _this._platform = null;
            _this._loadConfigurationFunc = null;
            _this._player = null;
            _this._rendererRequirement = null;
            _this._playId = null;
            _this._gameLoop = null;
            _this._eventBuffer = null;
            _this._openedAmflow = false;
            _this._playToken = null;
            _this._permission = null;
            _this._hidden = false;
            _this._destroyed = true;
            resolve();
        });
    };
    GameDriver.prototype._doSetDriverConfiguration = function (dconf) {
        var _this = this;
        if (dconf == null) {
            return es6_promise_1.Promise.resolve();
        }
        // デフォルト値の補完
        if (dconf.playId === undefined)
            dconf.playId = this._playId;
        if (dconf.playToken === undefined)
            dconf.playToken = this._playToken;
        if (dconf.eventBufferMode === undefined) {
            if (dconf.executionMode === ExecutionMode_1.default.Active) {
                dconf.eventBufferMode = { isReceiver: true, isSender: false };
            }
            else if (dconf.executionMode === ExecutionMode_1.default.Passive) {
                dconf.eventBufferMode = { isReceiver: false, isSender: true };
            }
        }
        var p = es6_promise_1.Promise.resolve();
        if (this._playId !== dconf.playId) {
            p = p.then(function () {
                _this._assertLive();
                return _this._doOpenAmflow(dconf.playId);
            });
        }
        if (this._playToken !== dconf.playToken) {
            p = p.then(function () {
                _this._assertLive();
                return _this._doAuthenticate(dconf.playToken);
            });
        }
        return p.then(function () {
            _this._assertLive();
            if (dconf.eventBufferMode != null) {
                if (dconf.eventBufferMode.defaultEventPriority == null) {
                    dconf.eventBufferMode.defaultEventPriority = 3 /* Priority */ & _this._permission.maxEventPriority;
                }
                if (_this._eventBuffer) {
                    _this._eventBuffer.setMode(dconf.eventBufferMode);
                }
            }
            if (dconf.executionMode != null) {
                if (_this._gameLoop) {
                    _this._gameLoop.setExecutionMode(dconf.executionMode);
                }
            }
        });
    };
    GameDriver.prototype._doCloseAmflow = function () {
        var _this = this;
        return new es6_promise_1.Promise(function (resolve, reject) {
            if (!_this._openedAmflow)
                return resolve();
            _this._platform.amflow.close(function (err) {
                _this._openedAmflow = false;
                var error = _this._getCallbackError(err);
                if (error) {
                    return reject(error);
                }
                resolve();
            });
        });
    };
    GameDriver.prototype._doOpenAmflow = function (playId) {
        var _this = this;
        if (playId === undefined) {
            return es6_promise_1.Promise.resolve();
        }
        var p = this._doCloseAmflow();
        return p.then(function () {
            _this._assertLive();
            return new es6_promise_1.Promise(function (resolve, reject) {
                if (playId === null)
                    return resolve();
                _this._platform.amflow.open(playId, function (err) {
                    var error = _this._getCallbackError(err);
                    if (error) {
                        return reject(error);
                    }
                    _this._openedAmflow = true;
                    _this._playId = playId;
                    if (_this._game)
                        _this._updateGamePlayId(_this._game);
                    resolve();
                });
            });
        });
    };
    GameDriver.prototype._doAuthenticate = function (playToken) {
        var _this = this;
        if (playToken == null)
            return es6_promise_1.Promise.resolve();
        return new es6_promise_1.Promise(function (resolve, reject) {
            _this._platform.amflow.authenticate(playToken, function (err, permission) {
                var error = _this._getCallbackError(err);
                if (error) {
                    return reject(error);
                }
                _this._playToken = playToken;
                _this._permission = permission;
                if (_this._game) {
                    _this._game.isSnapshotSaver = _this._permission.writeTick;
                }
                resolve();
            });
        });
    };
    GameDriver.prototype._loadConfiguration = function (configurationUrl, assetBase, configurationBase) {
        var _this = this;
        return new es6_promise_1.Promise(function (resolve, reject) {
            _this._loadConfigurationFunc(configurationUrl, assetBase, configurationBase, function (err, conf) {
                var error = _this._getCallbackError(err);
                if (error) {
                    return reject(error);
                }
                _this.configurationLoadedTrigger.fire(conf);
                resolve(conf);
            });
        });
    };
    GameDriver.prototype._putZerothStartPoint = function (data) {
        var _this = this;
        return new es6_promise_1.Promise(function (resolve, reject) {
            // AMFlowは第0スタートポイントに関して「書かれるまで待つ」という動作をするため、「なければ書き込む」ことはできない。
            var zerothStartPoint = { frame: 0, timestamp: data.startedAt, data: data };
            _this._platform.amflow.putStartPoint(zerothStartPoint, function (err) {
                var error = _this._getCallbackError(err);
                if (error) {
                    return reject(error);
                }
                resolve();
            });
        });
    };
    GameDriver.prototype._getZerothStartPointData = function () {
        var _this = this;
        return new es6_promise_1.Promise(function (resolve, reject) {
            _this._platform.amflow.getStartPoint({ frame: 0 }, function (err, startPoint) {
                var error = _this._getCallbackError(err);
                if (error) {
                    return reject(error);
                }
                var data = startPoint.data;
                if (typeof data.seed !== "number") // 型がないので一応確認
                    return reject(new Error("GameDriver#_getRandomSeed: No seed found."));
                resolve(data);
            });
        });
    };
    GameDriver.prototype._createGame = function (conf, player, param) {
        var _this = this;
        var putSeed = (param.driverConfiguration.executionMode === ExecutionMode_1.default.Active) && this._permission.writeTick;
        var p;
        if (putSeed) {
            p = this._putZerothStartPoint({
                seed: Date.now(),
                globalArgs: param.globalGameArgs,
                fps: conf.fps,
                startedAt: Date.now()
            });
        }
        else {
            p = es6_promise_1.Promise.resolve();
        }
        p = p.then(function () {
            _this._assertLive();
            return _this._getZerothStartPointData();
        });
        return p.then(function (zerothData) {
            _this._assertLive();
            var pf = _this._platform;
            var driverConf = param.driverConfiguration || {
                eventBufferMode: { isReceiver: true, isSender: false },
                executionMode: ExecutionMode_1.default.Active
            };
            var seed = zerothData.seed;
            var args = param.gameArgs;
            var globalArgs = zerothData.globalArgs;
            var startedAt = zerothData.startedAt;
            var rendererRequirement = {
                primarySurfaceWidth: conf.width,
                primarySurfaceHeight: conf.height,
                rendererCandidates: conf.renderers // TODO: akashic-engineのGameConfigurationにrenderersの定義を加える
            };
            pf.setRendererRequirement(rendererRequirement);
            var game = new Game_1.Game({
                configuration: conf,
                player: player,
                resourceFactory: pf.getResourceFactory(),
                assetBase: param.assetBase,
                isSnapshotSaver: _this._permission.writeTick,
                operationPluginViewInfo: (pf.getOperationPluginViewInfo ? pf.getOperationPluginViewInfo() : null),
                gameArgs: args,
                globalGameArgs: globalArgs
            });
            var eventBuffer = new EventBuffer_1.EventBuffer({ game: game, amflow: pf.amflow });
            eventBuffer.setMode(driverConf.eventBufferMode);
            pf.setPlatformEventHandler(eventBuffer);
            game.setEventFilterFuncs({
                addFilter: eventBuffer.addFilter.bind(eventBuffer),
                removeFilter: eventBuffer.removeFilter.bind(eventBuffer)
            });
            game.renderers.push(pf.getPrimarySurface().renderer());
            var gameLoop = new GameLoop_1.GameLoop({
                game: game,
                amflow: pf.amflow,
                platform: pf,
                executionMode: driverConf.executionMode,
                eventBuffer: eventBuffer,
                configuration: param.loopConfiguration,
                startedAt: startedAt,
                profiler: param.profiler
            });
            gameLoop.rawTargetTimeReachedTrigger.add(game._onRawTargetTimeReached, game);
            game.setCurrentTimeFunc(gameLoop.getCurrentTime.bind(gameLoop));
            game._reset({ age: 0, randGen: new g.XorshiftRandomGenerator(seed) });
            _this._updateGamePlayId(game);
            if (_this._hidden)
                game._setMuted(true);
            game.snapshotTrigger.add(function (startPoint) {
                _this._platform.amflow.putStartPoint(startPoint, function (err) {
                    var error = _this._getCallbackError(err);
                    if (error) {
                        _this.errorTrigger.fire(error);
                    }
                });
            });
            _this._game = game;
            _this._eventBuffer = eventBuffer;
            _this._gameLoop = gameLoop;
            _this._rendererRequirement = rendererRequirement;
            _this.gameCreatedTrigger.fire(game);
            _this._game._loadAndStart({ args: param.gameArgs || undefined }); // TODO: Game#_restartWithSnapshot()と統合すべき
        });
    };
    GameDriver.prototype._updateGamePlayId = function (game) {
        var _this = this;
        game.playId = this._playId;
        game.external.send = function (data) {
            _this._platform.sendToExternal(_this._playId, data);
        };
    };
    // 非同期処理中にゲームがdestroy済みかどうか判定するためのメソッド
    GameDriver.prototype._assertLive = function () {
        if (this._destroyed) {
            throw new Error(GAME_DESTROYED_MESSAGE);
        }
    };
    // コールバック時にエラーが発生もしくはゲームがdestroy済みの場合はErrorを返す
    GameDriver.prototype._getCallbackError = function (err) {
        if (err) {
            return err;
        }
        else if (this._destroyed) {
            return new Error(GAME_DESTROYED_MESSAGE);
        }
        return null;
    };
    return GameDriver;
}());
exports.GameDriver = GameDriver;

},{"./EventBuffer":6,"./ExecutionMode":9,"./Game":10,"./GameLoop":12,"./PdiUtil":16,"@akashic/akashic-engine":1,"es6-promise":83}],12:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.GameLoop = void 0;
var g = require("@akashic/akashic-engine");
var constants = require("./constants");
var LoopMode_1 = require("./LoopMode");
var LoopRenderMode_1 = require("./LoopRenderMode");
var ExecutionMode_1 = require("./ExecutionMode");
var Clock_1 = require("./Clock");
var ProfilerClock_1 = require("./ProfilerClock");
var EventConverter_1 = require("./EventConverter");
var TickController_1 = require("./TickController");
/**
 * ゲームのメインループ管理クラス。
 * clock frameの度にTickBufferに蓄積されたTickを元にゲームを動かす。
 *
 * start() から stop() までの間、最後に呼び出された _amflow.authenticate() は Permission#readTick を返していなければならない。
 */
var GameLoop = /** @class */ (function () {
    function GameLoop(param) {
        this.errorTrigger = new g.Trigger();
        this.rawTargetTimeReachedTrigger = new g.Trigger();
        this.running = false;
        this._currentTime = param.startedAt;
        this._frameTime = 1000 / param.game.fps;
        this._omittedTickDuration = 0;
        if (param.errorHandler) {
            this.errorTrigger.add(param.errorHandler, param.errorHandlerOwner);
        }
        var conf = param.configuration;
        this._startedAt = param.startedAt;
        this._targetTimeFunc = conf.targetTimeFunc || null;
        this._targetTimeOffset = conf.targetTimeOffset || null;
        this._originDate = conf.originDate || null;
        this._realTargetTimeOffset = (this._originDate != null) ? this._originDate : (this._targetTimeOffset || 0) + this._startedAt;
        this._delayIgnoreThreshold = conf.delayIgnoreThreshold || constants.DEFAULT_DELAY_IGNORE_THRESHOLD;
        this._skipTicksAtOnce = conf.skipTicksAtOnce || constants.DEFAULT_SKIP_TICKS_AT_ONCE;
        this._skipThreshold = conf.skipThreshold || constants.DEFAULT_SKIP_THRESHOLD;
        this._skipThresholdTime = this._skipThreshold * this._frameTime;
        // this._skipAwareGame はないことに注意 (Game#getIsSkipAware()) を使う
        this._jumpTryThreshold = conf.jumpTryThreshold || constants.DEFAULT_JUMP_TRY_THRESHOLD;
        this._jumpIgnoreThreshold = conf.jumpIgnoreThreshold || constants.DEFAULT_JUMP_IGNORE_THRESHOLD;
        this._pollingTickThreshold = conf._pollingTickThreshold || constants.DEFAULT_POLLING_TICK_THRESHOLD;
        this._playbackRate = conf.playbackRate || 1;
        var loopRenderMode = (conf.loopRenderMode != null) ? conf.loopRenderMode : LoopRenderMode_1.default.AfterRawFrame;
        this._loopRenderMode = null; // 後の_setLoopRenderMode()で初期化
        this._omitInterpolatedTickOnReplay = (conf.omitInterpolatedTickOnReplay != null) ? conf.omitInterpolatedTickOnReplay : true;
        this._loopMode = conf.loopMode;
        this._amflow = param.amflow;
        this._game = param.game;
        this._eventBuffer = param.eventBuffer;
        this._executionMode = param.executionMode;
        this._sceneTickMode = null;
        this._sceneLocalMode = null;
        this._targetAge = (conf.targetAge != null) ? conf.targetAge : null;
        this._waitingStartPoint = false;
        this._lastRequestedStartPointAge = -1;
        this._lastRequestedStartPointTime = -1;
        this._waitingNextTick = false;
        this._consumedLatestTick = false;
        this._skipping = false;
        this._lastPollingTickTime = 0;
        // todo: 本来は、パフォーマンス測定機構を含まないリリースモードによるビルド方式も提供すべき。
        if (!param.profiler) {
            this._clock = new Clock_1.Clock({
                fps: param.game.fps,
                scaleFactor: this._playbackRate,
                platform: param.platform,
                maxFramePerOnce: 5
            });
        }
        else {
            this._clock = new ProfilerClock_1.ProfilerClock({
                fps: param.game.fps,
                scaleFactor: this._playbackRate,
                platform: param.platform,
                maxFramePerOnce: 5,
                profiler: param.profiler
            });
        }
        this._tickController = new TickController_1.TickController({
            amflow: param.amflow,
            clock: this._clock,
            game: param.game,
            eventBuffer: param.eventBuffer,
            executionMode: param.executionMode,
            startedAt: param.startedAt,
            errorHandler: this.errorTrigger.fire,
            errorHandlerOwner: this.errorTrigger
        });
        this._eventConverter = new EventConverter_1.EventConverter({ game: param.game });
        this._tickBuffer = this._tickController.getBuffer();
        this._onGotStartPoint_bound = this._onGotStartPoint.bind(this);
        this._setLoopRenderMode(loopRenderMode);
        this._game.setIsSkipAware(conf.skipAwareGame != null ? conf.skipAwareGame : true);
        this._game.setStorageFunc(this._tickController.storageFunc());
        this._game.raiseEventTrigger.add(this._onGameRaiseEvent, this);
        this._game.raiseTickTrigger.add(this._onGameRaiseTick, this);
        this._game._started.add(this._onGameStarted, this);
        this._game._operationPluginOperated.add(this._onGameOperationPluginOperated, this);
        this._tickBuffer.gotNextTickTrigger.add(this._onGotNextFrameTick, this);
        this._tickBuffer.gotNoTickTrigger.add(this._onGotNoTick, this);
        this._tickBuffer.start();
        this._updateGamePlaybackRate();
        this._handleSceneChange();
    }
    GameLoop.prototype.start = function () {
        this.running = true;
        this._clock.start();
    };
    GameLoop.prototype.stop = function () {
        this._clock.stop();
        this.running = false;
    };
    GameLoop.prototype.setNextAge = function (age) {
        this._tickController.setNextAge(age);
    };
    GameLoop.prototype.getExecutionMode = function () {
        return this._executionMode;
    };
    GameLoop.prototype.setExecutionMode = function (execMode) {
        this._executionMode = execMode;
        this._tickController.setExecutionMode(execMode);
    };
    GameLoop.prototype.getLoopConfiguration = function () {
        return {
            loopMode: this._loopMode,
            delayIgnoreThreshold: this._delayIgnoreThreshold,
            skipTicksAtOnce: this._skipTicksAtOnce,
            skipThreshold: this._skipThreshold,
            skipAwareGame: this._game.getIsSkipAware(),
            jumpTryThreshold: this._jumpTryThreshold,
            jumpIgnoreThreshold: this._jumpIgnoreThreshold,
            playbackRate: this._playbackRate,
            loopRenderMode: this._loopRenderMode,
            targetTimeFunc: this._targetTimeFunc,
            targetTimeOffset: this._targetTimeOffset,
            originDate: this._originDate,
            omitInterpolatedTickOnReplay: this._omitInterpolatedTickOnReplay,
            targetAge: this._targetAge
        };
    };
    GameLoop.prototype.setLoopConfiguration = function (conf) {
        if (conf.loopMode != null)
            this._loopMode = conf.loopMode;
        if (conf.delayIgnoreThreshold != null)
            this._delayIgnoreThreshold = conf.delayIgnoreThreshold;
        if (conf.skipTicksAtOnce != null)
            this._skipTicksAtOnce = conf.skipTicksAtOnce;
        if (conf.skipThreshold != null) {
            this._skipThreshold = conf.skipThreshold;
            this._skipThresholdTime = this._skipThreshold * this._frameTime;
        }
        if (conf.skipAwareGame != null)
            this._game.setIsSkipAware(conf.skipAwareGame);
        if (conf.jumpTryThreshold != null)
            this._jumpTryThreshold = conf.jumpTryThreshold;
        if (conf.jumpIgnoreThreshold != null)
            this._jumpIgnoreThreshold = conf.jumpIgnoreThreshold;
        if (conf.playbackRate != null) {
            this._playbackRate = conf.playbackRate;
            this._clock.changeScaleFactor(this._playbackRate);
            this._updateGamePlaybackRate();
        }
        if (conf.loopRenderMode != null)
            this._setLoopRenderMode(conf.loopRenderMode);
        if (conf.targetTimeFunc != null) {
            this._targetTimeFunc = conf.targetTimeFunc;
        }
        if (conf.targetTimeOffset != null)
            this._targetTimeOffset = conf.targetTimeOffset;
        if (conf.originDate != null)
            this._originDate = conf.originDate;
        this._realTargetTimeOffset = (this._originDate != null) ? this._originDate : (this._targetTimeOffset || 0) + this._startedAt;
        if (conf.omitInterpolatedTickOnReplay != null)
            this._omitInterpolatedTickOnReplay = conf.omitInterpolatedTickOnReplay;
        if (conf.targetAge != null) {
            if (this._targetAge !== conf.targetAge) {
                // targetAgeの変化によって必要なティックが変化した可能性がある。
                // 一度リセットして _onFrame() で改めて _waitingNextTick を求め直す。
                this._waitingNextTick = false;
            }
            this._targetAge = conf.targetAge;
        }
    };
    GameLoop.prototype.addTickList = function (tickList) {
        this._tickBuffer.addTickList(tickList);
    };
    GameLoop.prototype.getCurrentTime = function () {
        return this._currentTime;
    };
    /**
     * 早送り状態に入る。
     *
     * すべての早回し(1フレームでの複数ティック消費)で早送り状態に入るわけではないことに注意。
     * 少々の遅れはこのクラスが暗黙に早回しして吸収する。
     * 早送り状態は、暗黙の早回しでは吸収しきれない規模の早回しの開始時に通知される。
     * 具体的な値との関連は `skipThreshold` など `LoopConfiguration` のメンバを参照のこと。
     */
    GameLoop.prototype._startSkipping = function () {
        this._skipping = true;
        this._updateGamePlaybackRate();
        this._game.skippingChangedTrigger.fire(true);
    };
    /**
     * 早送り状態を終える。
     */
    GameLoop.prototype._stopSkipping = function () {
        this._skipping = false;
        this._updateGamePlaybackRate();
        this._game.skippingChangedTrigger.fire(false);
    };
    /**
     * Gameの再生速度設定を変える。
     * 実際に再生速度(ティックの消費速度)を決めているのはこのクラスである点に注意。
     */
    GameLoop.prototype._updateGamePlaybackRate = function () {
        var realPlaybackRate = this._skipping ? (this._playbackRate * this._skipTicksAtOnce) : this._playbackRate;
        this._game._setAudioPlaybackRate(realPlaybackRate);
    };
    GameLoop.prototype._handleSceneChange = function () {
        var scene = this._game.scene();
        var localMode = scene ? scene.local : g.LocalTickMode.FullLocal; // シーンがない場合はローカルシーン同様に振る舞う(ティックは消化しない)
        var tickMode = scene ? scene.tickGenerationMode : g.TickGenerationMode.ByClock;
        if (this._sceneLocalMode !== localMode || this._sceneTickMode !== tickMode) {
            this._sceneLocalMode = localMode;
            this._sceneTickMode = tickMode;
            this._clock.frameTrigger.remove(this._onFrame, this);
            this._clock.frameTrigger.remove(this._onLocalFrame, this);
            switch (localMode) {
                case g.LocalTickMode.FullLocal:
                    // ローカルシーン: TickGenerationMode に関係なくローカルティックのみ
                    this._tickController.stopTick();
                    this._clock.frameTrigger.add(this._onLocalFrame, this);
                    break;
                case g.LocalTickMode.NonLocal:
                case g.LocalTickMode.InterpolateLocal:
                    if (tickMode === g.TickGenerationMode.ByClock) {
                        this._tickController.startTick();
                    }
                    else {
                        // Manual の場合: storageDataが乗る可能性がある最初のTickだけ生成させ、あとは生成を止める。(Manualの仕様どおりの挙動)
                        // storageDataがある場合は送らないとPassiveのインスタンスがローディングシーンを終えられない。
                        this._tickController.startTickOnce();
                    }
                    this._clock.frameTrigger.add(this._onFrame, this);
                    break;
                default:
                    this.errorTrigger.fire(new Error("Unknown LocalTickMode: " + localMode));
                    return;
            }
        }
    };
    /**
     * ローカルシーンのフレーム処理。
     *
     * `this._clock` の管理する時間経過に従い、ローカルシーンにおいて1フレーム時間につき1回呼び出される。
     */
    GameLoop.prototype._onLocalFrame = function () {
        this._doLocalTick();
    };
    GameLoop.prototype._doLocalTick = function () {
        var game = this._game;
        var pevs = this._eventBuffer.readLocalEvents();
        this._currentTime += this._frameTime;
        if (pevs) {
            for (var i = 0, len = pevs.length; i < len; ++i)
                game.events.push(this._eventConverter.toGameEvent(pevs[i]));
        }
        var sceneChanged = game.tick(false, Math.floor(this._omittedTickDuration / this._frameTime));
        this._omittedTickDuration = 0;
        if (sceneChanged)
            this._handleSceneChange();
    };
    /**
     * 非ローカルシーンのフレーム処理。
     *
     * `this._clock` の管理する時間経過に従い、非ローカルシーンにおいて1フレーム時間につき1回呼び出される。
     */
    GameLoop.prototype._onFrame = function (frameArg) {
        if (this._loopMode !== LoopMode_1.default.Replay || !this._targetTimeFunc) {
            this._onFrameNormal(frameArg);
        }
        else {
            var givenTargetTime = this._targetTimeFunc();
            var targetTime = givenTargetTime + this._realTargetTimeOffset;
            var prevTime = this._currentTime;
            this._onFrameForTimedReplay(targetTime, frameArg);
            // 目標時刻到達判定: 進めなくなり、あと1フレームで目標時刻を過ぎるタイミングを到達として通知する。
            // 時間進行を進めていっても目標時刻 "以上" に進むことはないので「過ぎた」タイミングは使えない点に注意。
            // (また、それでもなお (prevTime <= targetTime) の条件はなくせない点にも注意。巻き戻す時は (prevTime > targetTime) になる)
            if ((prevTime === this._currentTime) && (prevTime <= targetTime) && (targetTime <= prevTime + this._frameTime))
                this.rawTargetTimeReachedTrigger.fire(givenTargetTime);
        }
    };
    /**
     * 時刻関数が与えられている場合のフレーム処理。
     *
     * 通常ケース (`_onFrameNormal()`) とは主に次の点で異なる:
     *  1. `Replay` 時の実装しか持たない (`Realtime` は時刻関数を使わずとにかく最新ティックを目指すので不要)
     *  2. ローカルティック補間をタイムスタンプに従ってしか行わない
     * 後者は、ティック受信待ちなどの状況で起きるローカルティック補間がなくなることを意味する。
     */
    GameLoop.prototype._onFrameForTimedReplay = function (targetTime, frameArg) {
        var sceneChanged = false;
        var game = this._game;
        var timeGap = targetTime - this._currentTime;
        var frameGap = (timeGap / this._frameTime);
        if ((frameGap > this._jumpTryThreshold || frameGap < 0) &&
            (!this._waitingStartPoint) &&
            (this._lastRequestedStartPointTime < this._currentTime)) {
            // スナップショットを要求だけして続行する(スナップショットが来るまで進める限りは進む)。
            this._waitingStartPoint = true;
            this._lastRequestedStartPointTime = targetTime;
            this._amflow.getStartPoint({ timestamp: targetTime }, this._onGotStartPoint_bound);
        }
        if (frameGap <= 0) {
            if (this._skipping)
                this._stopSkipping();
            return;
        }
        if (!this._skipping) {
            if ((frameGap > this._skipThreshold || this._tickBuffer.currentAge === 0) &&
                (this._tickBuffer.hasNextTick() || (this._omitInterpolatedTickOnReplay && this._consumedLatestTick))) {
                // ここでは常に `frameGap > 0` であることに注意。0の時にskipに入ってもすぐ戻ってしまう
                this._startSkipping();
            }
        }
        var consumedFrame = 0;
        for (; consumedFrame < this._skipTicksAtOnce; ++consumedFrame) {
            var nextFrameTime = this._currentTime + this._frameTime;
            if (!this._tickBuffer.hasNextTick()) {
                if (!this._waitingNextTick) {
                    this._startWaitingNextTick();
                    if (!this._consumedLatestTick)
                        this._tickBuffer.requestTicks();
                }
                if (this._omitInterpolatedTickOnReplay && this._sceneLocalMode === g.LocalTickMode.InterpolateLocal) {
                    if (this._consumedLatestTick) {
                        // 最新のティックが存在しない場合は現在時刻を目標時刻に合わせる。
                        // (_doLocalTick() により現在時刻が this._frameTime 進むのでその直前まで進める)
                        this._currentTime = targetTime - this._frameTime;
                    }
                    // ティックがなく、目標時刻に到達していない場合、補間ティックを挿入する。
                    // (経緯上ここだけフラグ名と逆っぽい挙動になってしまっている点に注意。TODO フラグを改名する)
                    if (targetTime > nextFrameTime)
                        this._doLocalTick();
                }
                break;
            }
            var nextTickTime = this._tickBuffer.readNextTickTime();
            if (nextTickTime == null)
                nextTickTime = nextFrameTime;
            if (targetTime < nextFrameTime) {
                // 次フレームに進むと目標時刻を超過する＝次フレーム時刻までは進めない＝補間ティックは必要ない。
                if (nextTickTime <= targetTime) {
                    // 特殊ケース: 目標時刻より手前に次ティックがあるので、目標時刻までは進んで次ティックは消化してしまう。
                    // (この処理がないと、特にリプレイで「最後のティックの0.1フレーム時間前」などに来たときに進めなくなってしまう。)
                    nextFrameTime = targetTime;
                }
                else {
                    break;
                }
            }
            else {
                if (nextFrameTime < nextTickTime) {
                    if (this._omitInterpolatedTickOnReplay && this._skipping) {
                        // スキップ中、ティック補間不要なら即座に次ティック時刻(かその手前の目標時刻)まで進める。
                        // (_onFrameNormal()の対応箇所と異なり、ここでは「次ティック時刻の "次フレーム時刻"」に切り上げないことに注意。
                        //  時間ベースリプレイでは目標時刻 "以後" には進めないという制約がある。これを単純な実装で守るべく切り上げを断念している)
                        if (targetTime <= nextTickTime) {
                            // 次ティック時刻まで進めると目標時刻を超えてしまう: 目標時刻直前まで動いて抜ける(目標時刻直前までは来ないと目標時刻到達通知が永久にできない)
                            this._omittedTickDuration += targetTime - this._currentTime;
                            this._currentTime = Math.floor(targetTime / this._frameTime) * this._frameTime;
                            break;
                        }
                        nextFrameTime = nextTickTime;
                        this._omittedTickDuration += nextTickTime - this._currentTime;
                    }
                    else {
                        if (this._sceneLocalMode === g.LocalTickMode.InterpolateLocal) {
                            this._doLocalTick();
                        }
                        continue;
                    }
                }
            }
            this._currentTime = nextFrameTime;
            var tick = this._tickBuffer.consume();
            var consumedAge = -1;
            var plEvents = this._eventBuffer.readLocalEvents();
            if (plEvents) {
                for (var j = 0, len = plEvents.length; j < len; ++j) {
                    game.events.push(this._eventConverter.toGameEvent(plEvents[j]));
                }
            }
            if (typeof tick === "number") {
                consumedAge = tick;
                sceneChanged = game.tick(true, Math.floor(this._omittedTickDuration / this._frameTime));
            }
            else {
                consumedAge = tick[0 /* Age */];
                var pevs = tick[1 /* Events */];
                if (pevs) {
                    for (var j = 0, len = pevs.length; j < len; ++j) {
                        game.events.push(this._eventConverter.toGameEvent(pevs[j]));
                    }
                }
                sceneChanged = game.tick(true, Math.floor(this._omittedTickDuration / this._frameTime));
            }
            this._omittedTickDuration = 0;
            if (game._notifyPassedAgeTable[consumedAge]) {
                // ↑ 無駄な関数コールを避けるため汚いが外部から事前チェック
                if (game.fireAgePassedIfNeeded()) {
                    // age到達通知したらドライバユーザが何かしている可能性があるので抜ける
                    frameArg.interrupt = true;
                    break;
                }
            }
            if (sceneChanged) {
                this._handleSceneChange();
                break; // シーンが変わったらローカルシーンに入っているかもしれないので一度抜ける
            }
        }
        if (this._skipping && (targetTime - this._currentTime < this._frameTime))
            this._stopSkipping();
    };
    /**
     * 非ローカルシーンの通常ケースのフレーム処理。
     * 時刻関数が与えられていない、またはリプレイでない場合に用いられる。
     */
    GameLoop.prototype._onFrameNormal = function (frameArg) {
        var sceneChanged = false;
        var game = this._game;
        // NOTE: ブラウザが長時間非アクティブ状態 (裏タブに遷移していたなど) であったとき、長時間ゲームループが呼ばれないケースがある。
        // もしその期間がスキップの閾値を超えていたら、即座にスキップに入る。
        if (!this._skipping && frameArg.deltaTime > this._skipThresholdTime) {
            this._startSkipping();
            // ただしティック待ちが無ければすぐにスキップを抜ける。
            if (this._waitingNextTick)
                this._stopSkipping();
        }
        if (this._waitingNextTick) {
            if (this._sceneLocalMode === g.LocalTickMode.InterpolateLocal)
                this._doLocalTick();
            return;
        }
        var targetAge;
        var ageGap;
        var currentAge = this._tickBuffer.currentAge;
        if (this._loopMode === LoopMode_1.default.Realtime) {
            targetAge = this._tickBuffer.knownLatestAge + 1;
            ageGap = targetAge - currentAge;
        }
        else {
            if (this._targetAge === null) {
                // targetAgeがない: ただリプレイして見ているだけの状態。1フレーム時間経過 == 1age消化。
                targetAge = null;
                ageGap = 1;
            }
            else if (this._targetAge === currentAge) {
                // targetAgeに到達した: targetAgeなし状態になる。
                targetAge = this._targetAge = null;
                ageGap = 1;
            }
            else {
                // targetAgeがあり、まだ到達していない。
                targetAge = this._targetAge;
                ageGap = targetAge - currentAge;
            }
        }
        if ((ageGap > this._jumpTryThreshold || ageGap < 0) &&
            (!this._waitingStartPoint) &&
            (this._lastRequestedStartPointAge < currentAge)) {
            // スナップショットを要求だけして続行する(スナップショットが来るまで進める限りは進む)。
            //
            // 上の条件が _lastRequestedStartPointAge を参照しているのは、スナップショットで飛んだ後もなお
            // `ageGap` が大きい場合に、延々スナップショットをリクエストし続けるのを避けるためである。
            // 実際にはageが進めば新たなスナップショットが保存されている可能性もあるので、
            // `targetAge` が変わればリクエストし続けるのが全くの無駄というわけではない。
            // が、`Realtime` で実行している場合 `targetAge` は毎フレーム変化してしまうし、
            // スナップショットがそれほど頻繁に保存されるとは思えない(すべきでもない)。ここでは割り切って抑制しておく。
            this._waitingStartPoint = true;
            this._lastRequestedStartPointAge = targetAge;
            this._amflow.getStartPoint({ frame: targetAge }, this._onGotStartPoint_bound);
        }
        if (ageGap <= 0) {
            if (ageGap === 0) {
                if (currentAge === 0) {
                    // NOTE: Manualのシーンでは age=1 のティックが長時間受信できない場合がある。(TickBuffer#addTick()が呼ばれない)
                    // そのケースでは最初のティックの受信にポーリング時間(初期値: 10秒)かかってしまうため、ここで最新ティックを要求する。
                    // (初期シーンがNonLocalであってもティックの進行によりManualのシーンに移行してしまう可能性があるため、常に最新のティックを要求している。)
                    this._tickBuffer.requestTicks();
                }
                // 既知最新ティックに追いついたので、ポーリング処理により後続ティックを要求する。
                // NOTE: Manualのシーンでは最新ティックの生成そのものが長時間起きない可能性がある。
                // (Manualでなくても、最新ティックの受信が長時間起きないことはありうる(長いローディングシーンなど))
                this._startWaitingNextTick();
            }
            if (this._sceneLocalMode === g.LocalTickMode.InterpolateLocal) {
                // ティック待ちの間、ローカルティックを(補間して)消費: 上の暫定対処のrequestTicks()より後に行うべきである点に注意。
                // ローカルティックを消費すると、ゲームスクリプトがraiseTick()する(_waitingNextTickが立つのはおかしい)可能性がある。
                this._doLocalTick();
            }
            if (this._skipping)
                this._stopSkipping();
            return;
        }
        if (!this._skipping && (ageGap > this._skipThreshold || currentAge === 0) && this._tickBuffer.hasNextTick()) {
            // ここでは常に (ageGap > 0) であることに注意。(0の時にskipに入ってもすぐ戻ってしまう)
            this._startSkipping();
        }
        var loopCount = (!this._skipping && ageGap <= this._delayIgnoreThreshold) ? 1 : Math.min(ageGap, this._skipTicksAtOnce);
        var consumedFrame = 0;
        for (; consumedFrame < loopCount; ++consumedFrame) {
            // ティック時刻確認
            var nextFrameTime = this._currentTime + this._frameTime;
            var nextTickTime = this._tickBuffer.readNextTickTime();
            if (nextTickTime != null && nextFrameTime < nextTickTime) {
                if (this._loopMode === LoopMode_1.default.Realtime || (this._omitInterpolatedTickOnReplay && this._skipping)) {
                    // リアルタイムモード(と早送り中のリプレイでティック補間しない場合)ではティック時刻を気にせず続行するが、
                    // リプレイモードに切り替えた時に矛盾しないよう時刻を補正する(当該ティック時刻まで待った扱いにする)。
                    nextFrameTime = Math.ceil(nextTickTime / this._frameTime) * this._frameTime;
                    this._omittedTickDuration += nextFrameTime - this._currentTime;
                }
                else {
                    if (this._sceneLocalMode === g.LocalTickMode.InterpolateLocal) {
                        this._doLocalTick();
                        continue;
                    }
                    break;
                }
            }
            this._currentTime = nextFrameTime;
            var tick = this._tickBuffer.consume();
            var consumedAge = -1;
            if (tick != null) {
                var plEvents = this._eventBuffer.readLocalEvents();
                if (plEvents) {
                    for (var i = 0, len = plEvents.length; i < len; ++i) {
                        game.events.push(this._eventConverter.toGameEvent(plEvents[i]));
                    }
                }
                if (typeof tick === "number") {
                    consumedAge = tick;
                    sceneChanged = game.tick(true, Math.floor(this._omittedTickDuration / this._frameTime));
                }
                else {
                    consumedAge = tick[0 /* Age */];
                    var pevs = tick[1 /* Events */];
                    if (pevs) {
                        for (var j = 0, len = pevs.length; j < len; ++j) {
                            game.events.push(this._eventConverter.toGameEvent(pevs[j]));
                        }
                    }
                    sceneChanged = game.tick(true, Math.floor(this._omittedTickDuration / this._frameTime));
                }
                this._omittedTickDuration = 0;
            }
            else {
                // 時間は経過しているが消費すべきティックが届いていない
                this._tickBuffer.requestTicks();
                this._startWaitingNextTick();
                break;
            }
            if (game._notifyPassedAgeTable[consumedAge]) {
                // ↑ 無駄な関数コールを避けるため汚いが外部から事前チェック
                if (game.fireAgePassedIfNeeded()) {
                    // age到達通知したらドライバユーザが何かしている可能性があるので抜ける
                    frameArg.interrupt = true;
                    break;
                }
            }
            if (sceneChanged) {
                this._handleSceneChange();
                break; // シーンが変わったらローカルシーンに入っているかもしれないので一度抜ける
            }
        }
        if (this._skipping && (targetAge - this._tickBuffer.currentAge < 1))
            this._stopSkipping();
    };
    GameLoop.prototype._onGotNextFrameTick = function () {
        this._consumedLatestTick = false;
        if (!this._waitingNextTick)
            return;
        if (this._loopMode === LoopMode_1.default.FrameByFrame) {
            // コマ送り実行時、Tickの受信は実行に影響しない。
            return;
        }
        this._stopWaitingNextTick();
    };
    GameLoop.prototype._onGotNoTick = function () {
        if (this._waitingNextTick)
            this._consumedLatestTick = true;
    };
    GameLoop.prototype._onGotStartPoint = function (err, startPoint) {
        this._waitingStartPoint = false;
        if (err) {
            this.errorTrigger.fire(err);
            return;
        }
        if (!this._targetTimeFunc || this._loopMode === LoopMode_1.default.Realtime) {
            var targetAge = (this._loopMode === LoopMode_1.default.Realtime) ? this._tickBuffer.knownLatestAge + 1 : this._targetAge;
            if (targetAge === null || targetAge < startPoint.frame) {
                // 要求した時点と今で目標age(targetAge)が変わっている。
                // 現在の状況では飛ぶ必要がないか、得られたStartPointでは目標ageより未来に飛んでしまう。
                return;
            }
            var currentAge = this._tickBuffer.currentAge;
            if (currentAge <= targetAge && startPoint.frame < currentAge + this._jumpIgnoreThreshold) {
                // 今の目標age(targetAge)は過去でない一方、得られたStartPointは至近未来または過去のもの → 飛ぶ価値なし。
                return;
            }
        }
        else {
            var targetTime = this._targetTimeFunc() + this._realTargetTimeOffset;
            if (targetTime < startPoint.timestamp) {
                // 要求した時点と今で目標時刻(targetTime)が変わっている。得られたStartPointでは目標時刻より未来に飛んでしまう。
                return;
            }
            var currentTime = this._currentTime;
            if (currentTime <= targetTime && startPoint.timestamp < currentTime + (this._jumpIgnoreThreshold * this._frameTime)) {
                // 今の目標時刻(targetTime)は過去でない一方、得られたStartPointは至近未来または過去のもの → 飛ぶ価値なし。
                return;
            }
        }
        // リセットから `g.Game#_start()` まで(エントリポイント実行まで)の間、processEvents() は起こらないようにする。
        // すなわちこれ以降 `_onGameStarted()` までの間 EventBuffer からイベントは取得できない。しかしそもそもこの状態では
        // イベントを処理するシーンがいない = 非ローカルティックは生成されない = 非ローカルティック生成時にのみ行われるイベントの取得もない。
        this._clock.frameTrigger.remove(this._onEventsProcessed, this);
        if (this._skipping)
            this._stopSkipping();
        this._tickBuffer.setCurrentAge(startPoint.frame);
        this._currentTime = startPoint.timestamp || startPoint.data.timestamp || 0; // data.timestamp は後方互換性のために存在。現在は使っていない。
        this._waitingNextTick = false; // 現在ageを変えた後、さらに後続のTickが足りないかどうかは_onFrameで判断する。
        this._consumedLatestTick = false; // 同上。
        this._lastRequestedStartPointAge = -1; // 現在ageを変えた時はリセットしておく(場合によっては不要だが、安全のため)。
        this._lastRequestedStartPointTime = -1; // 同上。
        this._omittedTickDuration = 0;
        this._game._restartWithSnapshot(startPoint);
        this._handleSceneChange();
    };
    GameLoop.prototype._onGameStarted = function () {
        // 必ず先頭に挿入することで、同じClockを参照する `TickGenerator` のティック生成などに毎フレーム先行してイベントフィルタを適用する。
        // 全体的に `this._clock` のhandle順は動作順に直結するので注意が必要。
        this._clock.frameTrigger.add({ index: 0, owner: this, func: this._onEventsProcessed });
    };
    GameLoop.prototype._onEventsProcessed = function () {
        this._eventBuffer.processEvents(this._sceneLocalMode === g.LocalTickMode.FullLocal);
    };
    GameLoop.prototype._setLoopRenderMode = function (mode) {
        if (mode === this._loopRenderMode)
            return;
        this._loopRenderMode = mode;
        switch (mode) {
            case LoopRenderMode_1.default.AfterRawFrame:
                this._clock.rawFrameTrigger.add(this._renderOnRawFrame, this);
                break;
            case LoopRenderMode_1.default.None:
                this._clock.rawFrameTrigger.remove(this._renderOnRawFrame, this);
                break;
            default:
                this.errorTrigger.fire(new Error("GameLoop#_setLoopRenderMode: unknown mode: " + mode));
                break;
        }
    };
    GameLoop.prototype._renderOnRawFrame = function () {
        var game = this._game;
        if (game.modified && game.scenes.length > 0) {
            game.render();
        }
    };
    GameLoop.prototype._onGameRaiseEvent = function (e) {
        var pev = this._eventConverter.toPlaylogEvent(e);
        this._eventBuffer.onEvent(pev);
    };
    GameLoop.prototype._onGameRaiseTick = function (es) {
        if (this._executionMode !== ExecutionMode_1.default.Active)
            return;
        // TODO: イベントフィルタの中で呼ばれるとおかしくなる(フィルタ中のイベントがtickに乗らない)。
        if (es) {
            for (var i = 0; i < es.length; ++i)
                this._eventBuffer.addEventDirect(this._eventConverter.toPlaylogEvent(es[i]));
        }
        this._tickController.forceGenerateTick();
    };
    GameLoop.prototype._onGameOperationPluginOperated = function (op) {
        var pev = this._eventConverter.makePlaylogOperationEvent(op);
        this._eventBuffer.onEvent(pev);
    };
    GameLoop.prototype._onPollingTick = function () {
        // この関数が呼ばれる時、 `this._waitingNextTick` は必ず真である。
        // TODO: rawFrameTriggerのfire時に前回呼び出し時からの経過時間を渡せばnew Dateする必要はなくなる。
        var time = Date.now();
        if (time - this._lastPollingTickTime > this._pollingTickThreshold) {
            this._lastPollingTickTime = time;
            this._tickBuffer.requestTicks();
        }
    };
    GameLoop.prototype._startWaitingNextTick = function () {
        this._waitingNextTick = true;
        // TODO: Active時はポーリングしない (要 Active/Passive 切り替えの対応)
        this._clock.rawFrameTrigger.add(this._onPollingTick, this);
        this._lastPollingTickTime = Date.now();
        if (this._skipping)
            this._stopSkipping();
    };
    GameLoop.prototype._stopWaitingNextTick = function () {
        this._waitingNextTick = false;
        this._clock.rawFrameTrigger.remove(this._onPollingTick, this);
    };
    return GameLoop;
}());
exports.GameLoop = GameLoop;

},{"./Clock":5,"./EventConverter":7,"./ExecutionMode":9,"./LoopMode":14,"./LoopRenderMode":15,"./ProfilerClock":18,"./TickController":21,"./constants":26,"@akashic/akashic-engine":1}],13:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.JoinResolver = exports.JoinLeaveRequest = void 0;
var g = require("@akashic/akashic-engine");
var JoinLeaveRequest = /** @class */ (function () {
    function JoinLeaveRequest(pev, joinResolver, amflow, keys) {
        this.joinResolver = joinResolver;
        this.pev = pev;
        if (pev[0 /* Code */] === 0 /* Join */ && keys) {
            this.resolved = false;
            amflow.getStorageData(keys, this._onGotStorageData.bind(this));
        }
        else {
            this.resolved = true;
        }
    }
    JoinLeaveRequest.prototype._onGotStorageData = function (err, sds) {
        this.resolved = true;
        if (err) {
            this.joinResolver.errorTrigger.fire(err);
            return;
        }
        this.pev[4 /* StorageData */] = sds;
    };
    return JoinLeaveRequest;
}());
exports.JoinLeaveRequest = JoinLeaveRequest;
var JoinResolver = /** @class */ (function () {
    function JoinResolver(param) {
        this.errorTrigger = new g.Trigger();
        if (param.errorHandler)
            this.errorTrigger.add(param.errorHandler, param.errorHandlerOwner);
        this._amflow = param.amflow;
        this._keysForJoin = null;
        this._requested = [];
    }
    JoinResolver.prototype.request = function (pev) {
        this._requested.push(new JoinLeaveRequest(pev, this, this._amflow, this._keysForJoin));
    };
    JoinResolver.prototype.readResolved = function () {
        var len = this._requested.length;
        if (len === 0 || !this._requested[0].resolved)
            return null;
        var ret = [];
        for (var i = 0; i < len; ++i) {
            var req = this._requested[i];
            if (!req.resolved)
                break;
            ret.push(req.pev);
        }
        this._requested.splice(0, i);
        return ret;
    };
    JoinResolver.prototype.setRequestValuesForJoin = function (keys) {
        this._keysForJoin = keys;
    };
    return JoinResolver;
}());
exports.JoinResolver = JoinResolver;

},{"@akashic/akashic-engine":1}],14:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * `GameLoop` のループ制御のモード。
 * `GameLoop` は、この値に応じて `g.Game#tick()` の呼び出し方法を変える。
 */
var LoopMode;
(function (LoopMode) {
    /**
     * 最新フレームに最大限追いつくモード。
     *
     * Passiveである場合、自分の現在フレームが取得済みの最新フレームから大きく遅れているなら、
     * 早送りやスナップショットによるジャンプを行う。
     *
     * ローカルティック補間シーンにおいては、ティックの受信を待っている間ティック補間を行う。すなわち:
     *  * 次ティックがある場合: ローカルティックを生成せず、ただちに次ティックを消化する(補間しない)
     *  * 次ティックがない場合: ローカルティックを生成して消化する(補間する)
     */
    LoopMode[LoopMode["Realtime"] = 0] = "Realtime";
    /**
     * 追いつこうとするフレームを自分で制御するモード。
     *
     * `Realtime` と同様早送りやスナップショットによるジャンプを行うが、
     * その基準フレームとして `LoopConfiguration#targetAge` (を保持する `GameLoop#_targetAge`) を使う。
     * 早送りやスナップショットによるジャンプを行う。
     *
     * ローカルティック補間シーンにおいては、ティックのタイムスタンプ情報にできるだけ忠実にティック補間を行う。すなわち:
     *  * 次ティックがある場合: 現在時刻が次ティックのタイムスタンプか目標時刻に至るまで、ローカルティックを生成して消化する(補間する)。
     *  * 次ティックがない場合: 何もしない(補間しない)。
     * ただし LoopConfiguration#omitInterpolatedTickOnReplay が真の場合は、次の規則が追加で適用される。
     *  * 次ティックがある場合、スキップ中ならば: ローカルティックを生成せず、ただちに次ティックを消化する(補間しない; Realtimeと同じになる)
     *  * 次ティックがない場合、目標時刻に到達していなければ: ローカルティックを生成して消化する(補間する; Realtimeと同じになる)
     */
    LoopMode[LoopMode["Replay"] = 1] = "Replay";
    /**
     * 正しく使っていない。削除する予定。
     *
     * コマ送りモード。
     * `GameLoop#step()` 呼び出し時に1フレーム進む。それ以外の方法では進まない。
     * 早送りやスナップショットによるジャンプは行わない。
     */
    LoopMode[LoopMode["FrameByFrame"] = 2] = "FrameByFrame";
})(LoopMode || (LoopMode = {}));
exports.default = LoopMode;

},{}],15:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * `GameLoop` が描画を行う基準。
 */
var LoopRenderMode;
(function (LoopRenderMode) {
    /**
     * 毎raw frame後に描画する。
     * raw frameの詳細についてはClock.tsのコメントを参照。
     */
    LoopRenderMode[LoopRenderMode["AfterRawFrame"] = 0] = "AfterRawFrame";
    /**
     * 描画をまったく行わない。
     */
    LoopRenderMode[LoopRenderMode["None"] = 1] = "None";
})(LoopRenderMode || (LoopRenderMode = {}));
exports.default = LoopRenderMode;

},{}],16:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PdiUtil = void 0;
var es6_promise_1 = require("es6-promise");
var g = require("@akashic/akashic-engine");
var PdiUtil;
(function (PdiUtil) {
    /**
     * 与えられた `Platform` の `loadGameConfiguration()` をラップした、`GameConfiguration` 読み込み関数を作成して返す。
     *
     * 戻り値の関数は、次の点で `Platform#loadGameConfiguration()` と異なる。
     * * "definitions" フィールドを解決する (再帰的に読み込みを行い、_mergeGameConfiguration() でカスケード解決する)
     * * "assetBase" を使って `GameConfiguration` 内のアセットのパスを絶対パスに変換する
     * * "configurationBase" を使って "definitions" フィールド内のパスを絶対パスに変換する
     *
     * @param pf ラップする `loadGameConfiguration()` を持つ `Platform`
     */
    function makeLoadConfigurationFunc(pf) {
        function loadResolvedConfiguration(url, assetBase, configurationBase, callback) {
            pf.loadGameConfiguration(url, function (err, conf) {
                if (err) {
                    callback(err, null);
                    return;
                }
                try {
                    conf = PdiUtil._resolveConfigurationBasePath(conf, ((assetBase != null) ? assetBase : g.PathUtil.resolveDirname(url)));
                }
                catch (e) {
                    callback(e, null);
                    return;
                }
                if (!conf.definitions) {
                    callback(null, conf);
                    return;
                }
                var defs = conf.definitions.map(function (def) {
                    if (typeof def === "string") {
                        var resolvedUrl = configurationBase != null ? g.PathUtil.resolvePath(configurationBase, def) : def;
                        return promisifiedLoad(resolvedUrl, undefined, configurationBase);
                    }
                    else {
                        var resolvedUrl = configurationBase != null ? g.PathUtil.resolvePath(configurationBase, def.url) : def.url;
                        return promisifiedLoad(resolvedUrl, def.basePath, configurationBase);
                    }
                });
                es6_promise_1.Promise.all(defs)
                    .then(function (confs) { return callback(null, confs.reduce(PdiUtil._mergeGameConfiguration)); })
                    .catch(function (e) { return callback(e, null); });
            });
        }
        function promisifiedLoad(url, assetBase, configurationBase) {
            return new es6_promise_1.Promise(function (resolve, reject) {
                loadResolvedConfiguration(url, assetBase, configurationBase, function (err, conf) {
                    err ? reject(err) : resolve(conf);
                });
            });
        }
        return loadResolvedConfiguration;
    }
    PdiUtil.makeLoadConfigurationFunc = makeLoadConfigurationFunc;
    /**
     * 与えられた `GameConfiguration` のパス(相対パスになっている)を絶対パスに変える。
     * @param configuration 対象の `GameConfiguration`
     * @param assetBase アセットの相対パスの基準となるパス
     */
    function _resolveConfigurationBasePath(configuration, assetBase) {
        function resolvePath(base, path) {
            var ret = g.PathUtil.resolvePath(base, path);
            if (ret.indexOf(base) !== 0)
                throw g.ExceptionFactory.createAssertionError("PdiUtil._resolveConfigurationBasePath: invalid path: " + path);
            return ret;
        }
        var assets = configuration.assets;
        if (assets instanceof Object) {
            for (var p in assets) {
                if (!assets.hasOwnProperty(p))
                    continue;
                if ("path" in assets[p]) {
                    assets[p].virtualPath = assets[p].virtualPath || assets[p].path;
                    assets[p].path = resolvePath(assetBase, assets[p].path);
                }
            }
        }
        if (configuration.globalScripts) {
            configuration.globalScripts.forEach(function (path) {
                if (assets.hasOwnProperty(path))
                    throw g.ExceptionFactory.createAssertionError("PdiUtil._resolveConfigurationBasePath: asset ID already exists: " + path);
                assets[path] = {
                    type: /\.json$/i.test(path) ? "text" : "script",
                    virtualPath: path,
                    path: resolvePath(assetBase, path),
                    global: true
                };
            });
            delete configuration.globalScripts;
        }
        return configuration;
    }
    PdiUtil._resolveConfigurationBasePath = _resolveConfigurationBasePath;
    /**
     * 与えられたオブジェクト二つを「マージ」する。
     * ここでマージとは、オブジェクトのフィールドをイテレートし、
     * プリミティブ値であれば上書き、配列であればconcat、オブジェクトであれば再帰的にマージする処理である。
     *
     * @param target マージされるオブジェクト。この値は破壊される
     * @param source マージするオブジェクト
     */
    function _mergeObject(target, source) {
        var ks = Object.keys(source);
        for (var i = 0, len = ks.length; i < len; ++i) {
            var k = ks[i];
            var sourceVal = source[k];
            var sourceValType = typeof sourceVal;
            var targetValType = typeof target[k];
            if (sourceValType !== targetValType) {
                target[k] = sourceVal;
                continue;
            }
            switch (typeof sourceVal) {
                case "string":
                case "number":
                case "boolean":
                    target[k] = sourceVal;
                    break;
                case "object":
                    if (sourceVal == null) {
                        target[k] = sourceVal;
                    }
                    else if (Array.isArray(sourceVal)) {
                        target[k] = target[k].concat(sourceVal);
                    }
                    else {
                        PdiUtil._mergeObject(target[k], sourceVal);
                    }
                    break;
                default:
                    throw new Error("PdiUtil._mergeObject(): unknown type");
            }
        }
        return target;
    }
    PdiUtil._mergeObject = _mergeObject;
    function _mergeGameConfiguration(target, source) {
        return PdiUtil._mergeObject(target, source);
    }
    PdiUtil._mergeGameConfiguration = _mergeGameConfiguration;
})(PdiUtil = exports.PdiUtil || (exports.PdiUtil = {}));

},{"@akashic/akashic-engine":1,"es6-promise":83}],17:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PointEventResolver = void 0;
/**
 * pdi.PointEventからg.Eventへの変換機構。
 *
 * ほぼ座標しか持たないpdi.PointEventに対して、g.Point(Down|Move|Up)Eventはその座標にあるエンティティや、
 * (g.Point(Move|Up)Eventの場合)g.PointDownEventからの座標の差分を持っている。
 * それらの足りない情報を管理・追加して、pdi.PointEventをg.Eventに変換するクラス。
 * PDI実装はpointDown()なしでpointMove()を呼び出してくることも考えられるため、
 * Down -> Move -> Up の流れを保証する機能も持つ。
 */
var PointEventResolver = /** @class */ (function () {
    function PointEventResolver(param) {
        this._game = param.game;
        this._pointEventMap = {};
    }
    PointEventResolver.prototype.pointDown = function (e) {
        var player = this._game.player;
        var source = this._game.findPointSource(e.offset);
        var point = source.point ? source.point : e.offset;
        var targetId = source.target ? source.target.id : null;
        this._pointEventMap[e.identifier] = {
            targetId: targetId,
            local: source.local,
            point: point,
            start: { x: e.offset.x, y: e.offset.y },
            prev: { x: e.offset.x, y: e.offset.y }
        };
        // NOTE: 優先度は機械的にJoinedをつけておく。Joinしていない限りPointDownEventなどはリジェクトされる。
        var ret = [
            33 /* PointDown */,
            2 /* Joined */,
            player.id,
            e.identifier,
            point.x,
            point.y,
            targetId // 6?: エンティティID
        ];
        if (source.local)
            ret.push(source.local); // 7?: ローカル
        return ret;
    };
    PointEventResolver.prototype.pointMove = function (e) {
        var player = this._game.player;
        var holder = this._pointEventMap[e.identifier];
        if (!holder)
            return null;
        var prev = { x: 0, y: 0 };
        var start = { x: 0, y: 0 };
        this._pointMoveAndUp(holder, e.offset, prev, start);
        var ret = [
            34 /* PointMove */,
            2 /* Joined */,
            player.id,
            e.identifier,
            holder.point.x,
            holder.point.y,
            start.x,
            start.y,
            prev.x,
            prev.y,
            holder.targetId // 10?: エンティティID
        ];
        if (holder.local)
            ret.push(holder.local); // 11?: ローカル
        return ret;
    };
    PointEventResolver.prototype.pointUp = function (e) {
        var player = this._game.player;
        var holder = this._pointEventMap[e.identifier];
        if (!holder)
            return null;
        var prev = { x: 0, y: 0 };
        var start = { x: 0, y: 0 };
        this._pointMoveAndUp(holder, e.offset, prev, start);
        delete this._pointEventMap[e.identifier];
        var ret = [
            35 /* PointUp */,
            2 /* Joined */,
            player.id,
            e.identifier,
            holder.point.x,
            holder.point.y,
            start.x,
            start.y,
            prev.x,
            prev.y,
            holder.targetId // 10?: エンティティID
        ];
        if (holder.local)
            ret.push(holder.local); // 11?: ローカル
        return ret;
    };
    PointEventResolver.prototype._pointMoveAndUp = function (holder, offset, prevDelta, startDelta) {
        startDelta.x = offset.x - holder.start.x;
        startDelta.y = offset.y - holder.start.y;
        prevDelta.x = offset.x - holder.prev.x;
        prevDelta.y = offset.y - holder.prev.y;
        holder.prev.x = offset.x;
        holder.prev.y = offset.y;
    };
    return PointEventResolver;
}());
exports.PointEventResolver = PointEventResolver;

},{}],18:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProfilerClock = void 0;
var Clock_1 = require("./Clock");
/**
 * プロファイラーを有するクロック。
 *
 * note: _onLooperCall()のみをオーバーライドし、 `this._profiler.~~` を追加しただけとなっています。
 */
var ProfilerClock = /** @class */ (function (_super) {
    __extends(ProfilerClock, _super);
    function ProfilerClock(param) {
        var _this = _super.call(this, param) || this;
        _this._profiler = param.profiler;
        return _this;
    }
    ProfilerClock.prototype._onLooperCall = function (deltaTime) {
        var rawDeltaTime = deltaTime;
        if (deltaTime <= 0) {
            // 時間が止まっているか巻き戻っている。初回呼び出しか、あるいは何かがおかしい。時間経過0と見なす。
            return this._waitTime - this._totalDeltaTime;
        }
        if (deltaTime > this._deltaTimeBrokenThreshold) {
            // 間隔が長すぎる。何かがおかしい。時間経過を1フレーム分とみなす。
            deltaTime = this._waitTime;
        }
        var totalDeltaTime = this._totalDeltaTime;
        totalDeltaTime += deltaTime;
        if (totalDeltaTime <= this._skipFrameWaitTime) {
            // 1フレーム分消化するほどの時間が経っていない。
            this._totalDeltaTime = totalDeltaTime;
            return this._waitTime - totalDeltaTime;
        }
        this._profiler.timeEnd(1 /* RawFrameInterval */);
        this._profiler.time(1 /* RawFrameInterval */);
        var frameCount = (totalDeltaTime < this._waitTimeDoubled) ? 1
            : (totalDeltaTime > this._waitTimeMax) ? this._realMaxFramePerOnce
                : (totalDeltaTime / this._waitTime) | 0;
        var fc = frameCount;
        var arg = {
            deltaTime: rawDeltaTime,
            interrupt: false
        };
        this._profiler.setValue(0 /* SkippedFrameCount */, fc - 1);
        while (fc > 0 && this.running && !arg.interrupt) {
            --fc;
            this._profiler.time(2 /* FrameTime */);
            this.frameTrigger.fire(arg);
            this._profiler.timeEnd(2 /* FrameTime */);
            arg.deltaTime = 0; // 同ループによる2度目以降の呼び出しは差分を0とみなす。
        }
        totalDeltaTime -= ((frameCount - fc) * this._waitTime);
        this._profiler.time(3 /* RenderingTime */);
        this.rawFrameTrigger.fire();
        this._profiler.timeEnd(3 /* RenderingTime */);
        this._totalDeltaTime = totalDeltaTime;
        this._profiler.flush();
        return this._waitTime - totalDeltaTime;
    };
    return ProfilerClock;
}(Clock_1.Clock));
exports.ProfilerClock = ProfilerClock;

},{"./Clock":5}],19:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.StorageResolver = void 0;
var g = require("@akashic/akashic-engine");
var ExecutionMode_1 = require("./ExecutionMode");
/**
 * ストレージの読み書きを担うクラス。
 * Gameのストレージアクセスはすべてこのクラスが一次受けする(一次受けする関数を提供する)。
 *
 * ただし読み込みに関しては、実際にはこのクラスでは行わない。
 * Activeモードの場合、ストレージから読み込んだデータはTickに乗せる必要がある。
 * このクラスはTickGeneratorにリクエストを通知し、読み込みはTickGeneratorが解決する。
 * Passiveモードやスナップショットからの復元の場合、ストレージのデータは `TickBuffer` で受信したTickから得られる。
 * このクラスは、読み込みリクエストを得られたストレージデータと付き合わせて完了を通知する役割を持つ。
 */
var StorageResolver = /** @class */ (function () {
    function StorageResolver(param) {
        this.errorTrigger = new g.Trigger();
        if (param.errorHandler)
            this.errorTrigger.add(param.errorHandler, param.errorHandlerOwner);
        this.getStorageFunc = this._getStorage.bind(this);
        this.putStorageFunc = this._putStorage.bind(this);
        this.requestValuesForJoinFunc = this._requestValuesForJoin.bind(this);
        this._game = param.game;
        this._amflow = param.amflow;
        this._tickGenerator = param.tickGenerator;
        this._tickBuffer = param.tickBuffer;
        this._executionMode = null; // 後続のsetExecutionMode()で設定する。
        this.setExecutionMode(param.executionMode);
        this._unresolvedLoaders = {};
        this._unresolvedStorages = {};
        this._onStoragePut_bound = this._onStoragePut.bind(this);
    }
    /**
     * ExecutionModeを変更する。
     */
    StorageResolver.prototype.setExecutionMode = function (executionMode) {
        if (this._executionMode === executionMode)
            return;
        this._executionMode = executionMode;
        var tickBuf = this._tickBuffer;
        var tickGen = this._tickGenerator;
        if (executionMode === ExecutionMode_1.default.Active) {
            tickBuf.gotStorageTrigger.remove(this._onGotStorageOnTick, this);
            tickGen.gotStorageTrigger.add(this._onGotStorageOnTick, this);
        }
        else {
            tickGen.gotStorageTrigger.remove(this._onGotStorageOnTick, this);
            tickBuf.gotStorageTrigger.add(this._onGotStorageOnTick, this);
        }
    };
    StorageResolver.prototype._onGotStorageOnTick = function (storageOnTick) {
        var resolvingAge = storageOnTick.age;
        var storageData = storageOnTick.storageData;
        var loader = this._unresolvedLoaders[resolvingAge];
        if (!loader) {
            this._unresolvedStorages[resolvingAge] = storageData;
            return;
        }
        delete this._unresolvedLoaders[resolvingAge];
        var serialization = resolvingAge;
        var values = storageData.map(function (d) { return d.values; });
        loader._onLoaded(values, serialization);
    };
    StorageResolver.prototype._getStorage = function (keys, loader, ser) {
        var resolvingAge;
        if (ser != null) {
            // akashic-engineにとって `ser' の型は単にanyである。実態は実装(game-driver)に委ねられている。
            // game-driverはシリアリゼーションとして「ストレージが含められていたTickのage」を採用する。
            resolvingAge = ser;
            this._tickBuffer.requestTicks(resolvingAge, 1); // request しておけば後は _onGotStorageOnTick() に渡ってくる
        }
        else {
            if (this._executionMode === ExecutionMode_1.default.Active) {
                resolvingAge = this._tickGenerator.requestStorageTick(keys);
            }
            else {
                resolvingAge = this._game.age; // TODO: gameを参照せずともageがとれるようにすべき。
                this._tickBuffer.requestTicks(resolvingAge, 1); // request しておけば後は _onGotStorageOnTick() に渡ってくる
            }
        }
        var sd = this._unresolvedStorages[resolvingAge];
        if (!sd) {
            this._unresolvedLoaders[resolvingAge] = loader;
            return;
        }
        delete this._unresolvedStorages[resolvingAge];
        var serialization = resolvingAge;
        var values = sd.map(function (d) { return d.values; });
        loader._onLoaded(values, serialization);
    };
    StorageResolver.prototype._putStorage = function (key, value, option) {
        if (this._executionMode === ExecutionMode_1.default.Active) {
            this._amflow.putStorageData(key, value, option, this._onStoragePut_bound);
        }
    };
    StorageResolver.prototype._requestValuesForJoin = function (keys) {
        this._tickGenerator.setRequestValuesForJoin(keys);
    };
    StorageResolver.prototype._onStoragePut = function (err) {
        if (err)
            this.errorTrigger.fire(err);
    };
    return StorageResolver;
}());
exports.StorageResolver = StorageResolver;

},{"./ExecutionMode":9,"@akashic/akashic-engine":1}],20:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TickBuffer = void 0;
var g = require("@akashic/akashic-engine");
var ExecutionMode_1 = require("./ExecutionMode");
/**
 * AMFlowから流れ込むTickを蓄積するバッファ。
 *
 * 主に以下を行う。
 * * 受信済みのTickの管理
 * * 現在age・既知の最新age・直近の欠けているTickの管理
 * * 足りなそうなTickの先行リクエスト
 * * 処理済みTickの破棄
 */
var TickBuffer = /** @class */ (function () {
    function TickBuffer(param) {
        this.currentAge = 0;
        this.knownLatestAge = -1;
        this.gotNextTickTrigger = new g.Trigger();
        this.gotNoTickTrigger = new g.Trigger();
        this.gotStorageTrigger = new g.Trigger();
        this._amflow = param.amflow;
        this._prefetchThreshold = param.prefetchThreshold || TickBuffer.DEFAULT_PREFETCH_THRESHOLD;
        this._sizeRequestOnce = param.sizeRequestOnce || TickBuffer.DEFAULT_SIZE_REQUEST_ONCE;
        this._executionMode = param.executionMode;
        this._startedAt = param.startedAt || 0;
        this._oldTimestampThreshold = (param.startedAt != null) ? (param.startedAt - (86400 * 1000 * 10)) : 0; // 数字は適当な値(10日分)。
        this._receiving = false;
        this._tickRanges = [];
        this._nearestAbsentAge = this.currentAge;
        this._nextTickTimeCache = null;
        this._addTick_bound = this.addTick.bind(this);
        this._onTicks_bound = this._onTicks.bind(this);
    }
    TickBuffer.prototype.start = function () {
        this._receiving = true;
        this._updateAmflowReceiveState();
    };
    TickBuffer.prototype.stop = function () {
        this._receiving = false;
        this._updateAmflowReceiveState();
    };
    TickBuffer.prototype.setExecutionMode = function (execMode) {
        // TODO: getTickList()中にauthenticate()しなおした場合の挙動確認
        if (this._executionMode === execMode)
            return;
        this._dropUntil(this.knownLatestAge + 1); // 既存データは捨てる(特にPassive->Activeで既存Tickを上書きする必要がありうる)
        this.knownLatestAge = this.currentAge;
        this._nextTickTimeCache = null;
        this._nearestAbsentAge = this.currentAge;
        this._executionMode = execMode;
        this._updateAmflowReceiveState();
    };
    TickBuffer.prototype.setCurrentAge = function (age) {
        this._dropUntil(age);
        this._nextTickTimeCache = null;
        this.currentAge = age;
        this._nearestAbsentAge = this._findNearestAbscentAge(age);
    };
    TickBuffer.prototype.hasNextTick = function () {
        return this.currentAge !== this._nearestAbsentAge;
    };
    TickBuffer.prototype.consume = function () {
        if (this.currentAge === this._nearestAbsentAge)
            return null;
        var age = this.currentAge;
        var range = this._tickRanges[0];
        if (age === range.start) {
            this._nextTickTimeCache = null;
            ++this.currentAge;
            ++range.start;
            if (age + this._prefetchThreshold === this._nearestAbsentAge) {
                this.requestTicks(this._nearestAbsentAge, this._sizeRequestOnce);
            }
            if (range.start === range.end)
                this._tickRanges.shift();
            return (range.ticks.length > 0 && range.ticks[0][0 /* Age */] === age) ? range.ticks.shift() : age;
        }
        // range.start < age。外部から前に追加された場合。破棄してリトライする。
        this._dropUntil(this.currentAge);
        return this.consume();
    };
    TickBuffer.prototype.readNextTickTime = function () {
        if (this._nextTickTimeCache != null)
            return this._nextTickTimeCache;
        if (this.currentAge === this._nearestAbsentAge)
            return null;
        var age = this.currentAge;
        var range = this._tickRanges[0];
        if (age === range.start) {
            if (range.ticks.length === 0)
                return null;
            var tick = range.ticks[0];
            if (tick[0 /* Age */] !== age)
                return null;
            var pevs = tick[1 /* Events */];
            if (!pevs)
                return null;
            for (var i = 0; i < pevs.length; ++i) {
                if (pevs[i][0 /* Code */] === 2 /* Timestamp */) {
                    var nextTickTime = pevs[i][3 /* Timestamp */];
                    // 暫定処理: 旧仕様(相対時刻)用ワークアラウンド。小さすぎる時刻は相対とみなす
                    if (nextTickTime < this._oldTimestampThreshold)
                        nextTickTime += this._startedAt;
                    this._nextTickTimeCache = nextTickTime;
                    return nextTickTime;
                }
            }
            return null;
        }
        // range.start < age。外部から前に追加された場合。破棄してリトライする。
        this._dropUntil(this.currentAge);
        return this.readNextTickTime();
    };
    TickBuffer.prototype.requestTicks = function (from, len) {
        if (from === void 0) { from = this.currentAge; }
        if (len === void 0) { len = this._sizeRequestOnce; }
        if (this._executionMode !== ExecutionMode_1.default.Passive)
            return;
        this._amflow.getTickList(from, from + len, this._onTicks_bound);
    };
    TickBuffer.prototype.addTick = function (tick) {
        var age = tick[0 /* Age */];
        var gotNext = (this.currentAge === age) && (this._nearestAbsentAge === age);
        if (this.knownLatestAge < age) {
            this.knownLatestAge = age;
        }
        if (tick[2 /* StorageData */]) {
            this.gotStorageTrigger.fire({ age: tick[0 /* Age */], storageData: tick[2 /* StorageData */] });
        }
        var i = this._tickRanges.length - 1;
        for (; i >= 0; --i) {
            var range = this._tickRanges[i];
            if (age >= range.start)
                break;
        }
        var nextRange = this._tickRanges[i + 1];
        if (i < 0) {
            // 既知のどの tick よりも過去、または単に既知の tick がない。
            // NOTE: _tickRanges[0]を過去方向に拡張できるかもしれないが、
            //       addTickはほぼ最新フレームしか受信しないので気にせず新たにTickRangeを作る。
            this._tickRanges.unshift(this._createTickRangeFromTick(tick));
        }
        else {
            var range = this._tickRanges[i];
            if (age === range.end) {
                // 直近の TickRange のすぐ後に続く tick だった。
                ++range.end;
                if (tick[1 /* Events */]) {
                    range.ticks.push(tick);
                }
            }
            else if (age > range.end) {
                // 既存 TickList に続かない tick だった。新規に TickList を作って挿入
                this._tickRanges.splice(i + 1, 0, this._createTickRangeFromTick(tick));
            }
            else {
                // (start <= age < end) 既存 tick と重複している。何もしない。
            }
        }
        if (this._nearestAbsentAge === age) {
            ++this._nearestAbsentAge;
            if (nextRange && this._nearestAbsentAge === nextRange.start) {
                // 直近の欠けているageを追加したら前後のrangeが繋がってしまった。諦めて_nearestAbsentAgeを求め直す。
                this._nearestAbsentAge = this._findNearestAbscentAge(this._nearestAbsentAge);
            }
        }
        if (gotNext)
            this.gotNextTickTrigger.fire();
    };
    TickBuffer.prototype.addTickList = function (tickList) {
        var start = tickList[0 /* From */];
        var end = tickList[1 /* To */] + 1;
        var ticks = tickList[2 /* TicksWithEvents */];
        var origStart = start;
        var origEnd = end;
        if (this.knownLatestAge < end - 1) {
            this.knownLatestAge = end - 1;
        }
        // 今回挿入分の開始ageよりも「後」に開始される最初のrangeを探す
        var i = 0;
        var len = this._tickRanges.length;
        for (i = 0; i < len; ++i) {
            var range = this._tickRanges[i];
            if (start < range.start)
                break;
        }
        var insertPoint = i;
        // 左側が重複しうるrangeを探して重複を除く
        if (i > 0) {
            // 左側が重複しうるrangeは、今回挿入分の開始ageの直前に始まるもの
            --i;
            var leftEndAge = this._tickRanges[i].end;
            if (start < leftEndAge)
                start = leftEndAge;
        }
        // 右側で重複しうるrangeを探して重複を除く
        for (; i < len; ++i) {
            var range = this._tickRanges[i];
            if (end <= range.end)
                break;
        }
        if (i < len) {
            var rightStartAge = this._tickRanges[i].start;
            if (end > rightStartAge)
                end = rightStartAge;
        }
        if (start >= end) {
            // 今回挿入分はすべて重複だった。何もせずreturn
            return { start: start, end: start, ticks: [] };
        }
        if (!ticks)
            ticks = [];
        if (origStart !== start || origEnd !== end) {
            ticks = ticks.filter(function (tick) {
                var age = tick[0 /* Age */];
                return start <= age && age < end;
            });
        }
        for (var j = 0; j < ticks.length; ++j) {
            var tick = ticks[j];
            if (tick[2 /* StorageData */])
                this.gotStorageTrigger.fire({ age: tick[0 /* Age */], storageData: tick[2 /* StorageData */] });
        }
        var tickRange = { start: start, end: end, ticks: ticks };
        var delLen = Math.max(0, i - insertPoint);
        this._tickRanges.splice(insertPoint, delLen, tickRange);
        if (start <= this._nearestAbsentAge && this._nearestAbsentAge < end) {
            this._nearestAbsentAge = this._findNearestAbscentAge(this._nearestAbsentAge);
        }
        return tickRange;
    };
    TickBuffer.prototype._updateAmflowReceiveState = function () {
        if (this._receiving && this._executionMode === ExecutionMode_1.default.Passive) {
            this._amflow.onTick(this._addTick_bound);
        }
        else {
            this._amflow.offTick(this._addTick_bound);
        }
    };
    TickBuffer.prototype._onTicks = function (err, ticks) {
        if (err)
            throw new Error();
        if (!ticks) {
            this.gotNoTickTrigger.fire();
            return;
        }
        var mayGotNext = (this.currentAge === this._nearestAbsentAge);
        var inserted = this.addTickList(ticks);
        if (mayGotNext && (inserted.start <= this.currentAge && this.currentAge < inserted.end)) {
            this.gotNextTickTrigger.fire();
        }
        if (!inserted.ticks.length) {
            this.gotNoTickTrigger.fire();
        }
    };
    TickBuffer.prototype._findNearestAbscentAge = function (age) {
        var i = 0, len = this._tickRanges.length;
        for (; i < len; ++i) {
            if (age <= this._tickRanges[i].end)
                break;
        }
        for (; i < len; ++i) {
            var range = this._tickRanges[i];
            if (age < range.start)
                break;
            age = range.end;
        }
        return age;
    };
    TickBuffer.prototype._dropUntil = function (age) {
        // [start,end) が全部 age 以前のものを削除
        var i;
        for (i = 0; i < this._tickRanges.length; ++i) {
            if (age < this._tickRanges[i].end)
                break;
        }
        this._tickRanges = this._tickRanges.slice(i);
        if (this._tickRanges.length === 0)
            return;
        // start を書き換えることで、[start, age) の範囲を削除
        var range = this._tickRanges[0];
        if (age < range.start)
            return;
        range.start = age;
        for (i = 0; i < range.ticks.length; ++i) {
            if (age <= range.ticks[i][0 /* Age */])
                break;
        }
        range.ticks = range.ticks.slice(i);
    };
    TickBuffer.prototype._createTickRangeFromTick = function (tick) {
        var age = tick[0 /* Age */];
        var range = {
            start: age,
            end: age + 1,
            ticks: []
        };
        if (tick[1 /* Events */]) {
            range.ticks.push(tick);
        }
        return range;
    };
    TickBuffer.DEFAULT_PREFETCH_THRESHOLD = 30 * 60; // 数字は適当に30FPSで1分間分。30FPS * 60秒。
    TickBuffer.DEFAULT_SIZE_REQUEST_ONCE = 30 * 60 * 5; // 数字は適当に30FPSで5分間分。
    return TickBuffer;
}());
exports.TickBuffer = TickBuffer;

},{"./ExecutionMode":9,"@akashic/akashic-engine":1}],21:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TickController = void 0;
var g = require("@akashic/akashic-engine");
var ExecutionMode_1 = require("./ExecutionMode");
var TickBuffer_1 = require("./TickBuffer");
var TickGenerator_1 = require("./TickGenerator");
var sr = require("./StorageResolver");
/**
 * `GameLoop` に流れるTickを管理するクラス。
 *
 * `GameLoop` に対して `TickGenerator` と `AMFlow` を隠蔽し、
 * Active/Passiveに(ほぼ)関係なくTickを扱えるようにする。
 */
var TickController = /** @class */ (function () {
    function TickController(param) {
        this.errorTrigger = new g.Trigger();
        if (param.errorHandler)
            this.errorTrigger.add(param.errorHandler, param.errorHandlerOwner);
        this._amflow = param.amflow;
        this._clock = param.clock;
        this._started = false;
        this._executionMode = param.executionMode;
        this._generator = new TickGenerator_1.TickGenerator({
            amflow: param.amflow,
            eventBuffer: param.eventBuffer,
            errorHandler: this.errorTrigger.fire,
            errorHandlerOwner: this.errorTrigger
        });
        this._buffer = new TickBuffer_1.TickBuffer({
            amflow: param.amflow,
            executionMode: param.executionMode,
            startedAt: param.startedAt
        });
        this._storageResolver = new sr.StorageResolver({
            game: param.game,
            amflow: param.amflow,
            tickGenerator: this._generator,
            tickBuffer: this._buffer,
            executionMode: param.executionMode,
            errorHandler: this.errorTrigger.fire,
            errorHandlerOwner: this.errorTrigger
        });
        this._generator.tickTrigger.add(this._onTickGenerated, this);
        this._clock.frameTrigger.add(this._generator.next, this._generator);
    }
    TickController.prototype.startTick = function () {
        this._started = true;
        this._updateGeneratorState();
    };
    TickController.prototype.stopTick = function () {
        this._started = false;
        this._updateGeneratorState();
    };
    TickController.prototype.startTickOnce = function () {
        this._started = true;
        this._generator.tickTrigger.addOnce(this._stopTriggerOnTick, this);
        this._updateGeneratorState();
    };
    TickController.prototype.setNextAge = function (age) {
        this._generator.setNextAge(age);
    };
    TickController.prototype.forceGenerateTick = function () {
        this._generator.forceNext();
    };
    TickController.prototype.getBuffer = function () {
        return this._buffer;
    };
    TickController.prototype.storageFunc = function () {
        return {
            storageGetFunc: this._storageResolver.getStorageFunc,
            storagePutFunc: this._storageResolver.putStorageFunc,
            requestValuesForJoinFunc: this._storageResolver.requestValuesForJoinFunc
        };
    };
    TickController.prototype.setExecutionMode = function (execMode) {
        if (this._executionMode === execMode)
            return;
        this._executionMode = execMode;
        this._updateGeneratorState();
        this._buffer.setExecutionMode(execMode);
        this._storageResolver.setExecutionMode(execMode);
    };
    TickController.prototype._stopTriggerOnTick = function () {
        this.stopTick();
    };
    TickController.prototype._updateGeneratorState = function () {
        var toGenerate = (this._started && this._executionMode === ExecutionMode_1.default.Active);
        this._generator.startStopGenerate(toGenerate);
    };
    TickController.prototype._onTickGenerated = function (tick) {
        this._amflow.sendTick(tick);
        this._buffer.addTick(tick);
    };
    return TickController;
}());
exports.TickController = TickController;

},{"./ExecutionMode":9,"./StorageResolver":19,"./TickBuffer":20,"./TickGenerator":22,"@akashic/akashic-engine":1}],22:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TickGenerator = void 0;
var g = require("@akashic/akashic-engine");
var JoinResolver_1 = require("./JoinResolver");
/**
 * `playlog.Tick` の生成器。
 * `next()` が呼ばれる度に、EventBuffer に蓄積されたイベントを集めてtickを生成、`tickTrigger` で通知する。
 */
var TickGenerator = /** @class */ (function () {
    function TickGenerator(param) {
        this.tickTrigger = new g.Trigger();
        this.gotStorageTrigger = new g.Trigger();
        this.errorTrigger = new g.Trigger();
        if (param.errorHandler)
            this.errorTrigger.add(param.errorHandler, param.errorHandlerOwner);
        this._amflow = param.amflow;
        this._eventBuffer = param.eventBuffer;
        this._joinResolver = new JoinResolver_1.JoinResolver({
            amflow: param.amflow,
            errorHandler: this.errorTrigger.fire,
            errorHandlerOwner: this.errorTrigger
        });
        this._nextAge = 0;
        this._storageDataForNext = null;
        this._generatingTick = false;
        this._waitingStorage = false;
        this._onGotStorageData_bound = this._onGotStorageData.bind(this);
    }
    TickGenerator.prototype.next = function () {
        if (!this._generatingTick || this._waitingStorage)
            return;
        var joinLeaves = this._eventBuffer.readJoinLeaves();
        if (joinLeaves) {
            for (var i = 0; i < joinLeaves.length; ++i)
                this._joinResolver.request(joinLeaves[i]);
        }
        var evs = this._eventBuffer.readEvents();
        var resolvedJoinLeaves = this._joinResolver.readResolved();
        if (resolvedJoinLeaves) {
            if (evs) {
                evs.push.apply(evs, resolvedJoinLeaves);
            }
            else {
                evs = resolvedJoinLeaves;
            }
        }
        var sds = this._storageDataForNext;
        this._storageDataForNext = null;
        this.tickTrigger.fire([
            this._nextAge++,
            evs,
            sds // 2?: ストレージデータ
        ]);
    };
    TickGenerator.prototype.forceNext = function () {
        if (this._waitingStorage) {
            this.errorTrigger.fire(new Error("TickGenerator#forceNext(): cannot generate tick while waiting storage."));
            return;
        }
        var origValue = this._generatingTick;
        this._generatingTick = true;
        this.next();
        this._generatingTick = origValue;
    };
    TickGenerator.prototype.startStopGenerate = function (toGenerate) {
        this._generatingTick = toGenerate;
    };
    TickGenerator.prototype.startTick = function () {
        this._generatingTick = true;
    };
    TickGenerator.prototype.stopTick = function () {
        this._generatingTick = false;
    };
    TickGenerator.prototype.setNextAge = function (age) {
        if (this._waitingStorage) {
            // エッジケース: 次のtickにストレージを乗せるはずだったが、ageが変わってしまうのでできない。
            // Activeでストレージ要求(シーン切り替え)して待っている間にここに来るとこのパスにかかる。
            // 現実にはActiveで実行開始した後にageを変えるケースは想像しにくい(tickが飛び飛びになったり重複したりする)。
            this.errorTrigger.fire(new Error("TickGenerator#setNextAge(): cannot change the next age while waiting storage."));
            return;
        }
        this._nextAge = age;
    };
    /**
     * 次に生成するtickにstorageDataを持たせる。
     * 取得が完了するまで、次のtickは生成されない。
     */
    TickGenerator.prototype.requestStorageTick = function (keys) {
        if (this._waitingStorage) {
            var err = g.ExceptionFactory.createAssertionError("TickGenerator#requestStorageTick(): Unsupported: multiple storage request");
            this.errorTrigger.fire(err);
            return -1;
        }
        this._waitingStorage = true;
        this._amflow.getStorageData(keys, this._onGotStorageData_bound);
        return this._nextAge;
    };
    TickGenerator.prototype.setRequestValuesForJoin = function (keys) {
        this._joinResolver.setRequestValuesForJoin(keys);
    };
    TickGenerator.prototype._onGotStorageData = function (err, sds) {
        this._waitingStorage = false;
        if (err) {
            this.errorTrigger.fire(err);
            return;
        }
        this._storageDataForNext = sds;
        this.gotStorageTrigger.fire({ age: this._nextAge, storageData: sds });
    };
    return TickGenerator;
}());
exports.TickGenerator = TickGenerator;

},{"./JoinResolver":13,"@akashic/akashic-engine":1}],23:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports._cloneDeep = exports.MemoryAmflowClient = void 0;
var MemoryAmflowClient = /** @class */ (function () {
    function MemoryAmflowClient(param) {
        this._playId = param.playId;
        this._putStorageDataSyncFunc = param.putStorageDataSyncFunc || (function () { throw new Error("Implementation not given"); });
        this._getStorageDataSyncFunc = param.getStorageDataSyncFunc || (function () { throw new Error("Implementation not given"); });
        this._tickHandlers = [];
        this._eventHandlers = [];
        this._events = [];
        this._tickList = null;
        if (param.startPoints) {
            this._tickList = param.tickList;
            this._startPoints = param.startPoints;
        }
        else {
            this._startPoints = [];
        }
    }
    MemoryAmflowClient.prototype.dump = function () {
        return {
            tickList: this._tickList,
            startPoints: this._startPoints
        };
    };
    MemoryAmflowClient.prototype.open = function (playId, callback) {
        var _this = this;
        setTimeout(function () {
            if (playId !== _this._playId)
                return void callback(new Error("MemoryAmflowClient#open: unknown playId"));
            callback(null);
        }, 0);
    };
    MemoryAmflowClient.prototype.close = function (callback) {
        setTimeout(function () { callback(null); }, 0);
    };
    MemoryAmflowClient.prototype.authenticate = function (token, callback) {
        setTimeout(function () {
            switch (token) {
                case MemoryAmflowClient.TOKEN_ACTIVE:
                    callback(null, {
                        writeTick: true,
                        readTick: true,
                        subscribeTick: false,
                        sendEvent: false,
                        subscribeEvent: true,
                        maxEventPriority: 2
                    });
                    break;
                case MemoryAmflowClient.TOKEN_PASSIVE:
                    callback(null, {
                        writeTick: false,
                        readTick: true,
                        subscribeTick: true,
                        sendEvent: true,
                        subscribeEvent: false,
                        maxEventPriority: 2
                    });
                    break;
                default:
                    callback(null, {
                        writeTick: true,
                        readTick: true,
                        subscribeTick: true,
                        sendEvent: true,
                        subscribeEvent: true,
                        maxEventPriority: 2
                    });
                    break;
            }
        }, 0);
    };
    MemoryAmflowClient.prototype.sendTick = function (tick) {
        tick = _cloneDeep(tick); // 元の値が後から変更されてもいいようにコピーしておく
        if (!this._tickList) {
            this._tickList = [tick[0 /* Age */], tick[0 /* Age */], []];
        }
        else {
            // 既に存在するTickListのfrom~to間にtickが挿入されることは無い
            if (this._tickList[0 /* From */] <= tick[0 /* Age */] &&
                tick[0 /* Age */] <= this._tickList[1 /* To */])
                throw new Error("illegal age tick");
            this._tickList[1 /* To */] = tick[0 /* Age */];
        }
        if (!!tick[1 /* Events */] || !!tick[2 /* StorageData */]) {
            if (!!tick[1 /* Events */]) {
                tick[1 /* Events */] = tick[1 /* Events */]
                    .filter(function (event) { return !(event[1 /* EventFlags */] & 8 /* Transient */); });
            }
            this._tickList[2 /* TicksWithEvents */].push(tick);
        }
        this._tickHandlers.forEach(function (h) { return h(tick); });
    };
    MemoryAmflowClient.prototype.onTick = function (handler) {
        this._tickHandlers.push(handler);
    };
    MemoryAmflowClient.prototype.offTick = function (handler) {
        this._tickHandlers = this._tickHandlers.filter(function (h) { return (h !== handler); });
    };
    MemoryAmflowClient.prototype.sendEvent = function (pev) {
        pev = _cloneDeep(pev); // 元の値が後から変更されてもいいようにコピーしておく
        if (this._eventHandlers.length === 0) {
            this._events.push(pev);
            return;
        }
        this._eventHandlers.forEach(function (h) { return h(pev); });
    };
    MemoryAmflowClient.prototype.onEvent = function (handler) {
        var _this = this;
        this._eventHandlers.push(handler);
        if (this._events.length > 0) {
            this._events.forEach(function (pev) {
                _this._eventHandlers.forEach(function (h) { return h(pev); });
            });
            this._events = [];
        }
    };
    MemoryAmflowClient.prototype.offEvent = function (handler) {
        this._eventHandlers = this._eventHandlers.filter(function (h) { return (h !== handler); });
    };
    MemoryAmflowClient.prototype.getTickList = function (optsOrBegin, endOrCallback, callback) {
        if (!this._tickList)
            return void setTimeout(function () { return callback(null, null); }, 0);
        // TODO: @akashic/amflow@3.0.0 追従
        if (typeof optsOrBegin !== "number" ||
            typeof endOrCallback !== "number" ||
            typeof callback !== "function") {
            if (typeof endOrCallback === "function") {
                endOrCallback(new Error("not implemented"));
                return;
            }
            throw new Error("not implemented");
        }
        var from = Math.max(optsOrBegin, this._tickList[0 /* From */]);
        var to = Math.min(endOrCallback, this._tickList[1 /* To */]);
        var ticks = this._tickList[2 /* TicksWithEvents */].filter(function (tick) {
            var age = tick[0 /* Age */];
            return from <= age && age <= to;
        });
        var tickList = [from, to, ticks];
        setTimeout(function () { return callback(null, tickList); }, 0);
    };
    MemoryAmflowClient.prototype.putStartPoint = function (startPoint, callback) {
        var _this = this;
        setTimeout(function () {
            _this._startPoints.push(startPoint);
            callback(null);
        }, 0);
    };
    MemoryAmflowClient.prototype.getStartPoint = function (opts, callback) {
        var _this = this;
        setTimeout(function () {
            if (!_this._startPoints || _this._startPoints.length === 0)
                return void callback(new Error("no startpoint"));
            var index = 0;
            if (opts.frame != null) {
                var nearestFrame = _this._startPoints[0].frame;
                for (var i = 1; i < _this._startPoints.length; ++i) {
                    var frame = _this._startPoints[i].frame;
                    if (frame <= opts.frame && nearestFrame < frame) {
                        nearestFrame = frame;
                        index = i;
                    }
                }
            }
            else {
                var nearestTimestamp = _this._startPoints[0].timestamp;
                for (var i = 1; i < _this._startPoints.length; ++i) {
                    var timestamp = _this._startPoints[i].timestamp;
                    if (timestamp <= opts.timestamp && nearestTimestamp < timestamp) {
                        nearestTimestamp = timestamp;
                        index = i;
                    }
                }
            }
            callback(null, _this._startPoints[index]);
        }, 0);
    };
    MemoryAmflowClient.prototype.putStorageData = function (key, value, options, callback) {
        var _this = this;
        setTimeout(function () {
            try {
                _this._putStorageDataSyncFunc(key, value, options);
                callback(null);
            }
            catch (e) {
                callback(e);
            }
        }, 0);
    };
    MemoryAmflowClient.prototype.getStorageData = function (keys, callback) {
        var _this = this;
        setTimeout(function () {
            try {
                var data = _this._getStorageDataSyncFunc(keys);
                callback(null, data);
            }
            catch (e) {
                callback(e);
            }
        }, 0);
    };
    /**
     * 与えられていたティックリストを部分的に破棄する。
     * @param age ティックを破棄する基準のage(このageのティックも破棄される)
     */
    MemoryAmflowClient.prototype.dropAfter = function (age) {
        if (!this._tickList)
            return;
        var from = this._tickList[0 /* From */];
        var to = this._tickList[1 /* To */];
        if (age <= from) {
            this._tickList = null;
            this._startPoints = [];
        }
        else if (age <= to) {
            this._tickList[1 /* To */] = age - 1;
            this._tickList[2 /* TicksWithEvents */] = this._tickList[2 /* TicksWithEvents */].filter(function (tick) {
                var ta = tick[0 /* Age */];
                return from <= ta && ta <= (age - 1);
            });
            this._startPoints = this._startPoints.filter(function (sp) { return sp.frame < age; });
        }
    };
    /**
     * `writeTick` 権限を持つトークン。
     * この値は authenticate() の挙動以外は変更しない。
     * 他メソッド(sendEvent()など)の呼び出しは(権限に反していても)エラーを起こすとは限らない。
     */
    MemoryAmflowClient.TOKEN_ACTIVE = "mamfc-token:active";
    /**
     * `subscribeTick` 権限を持つトークン。
     * この値は authenticate() の挙動以外は変更しない。
     * 他メソッド(sendTick()など)の呼び出しは(権限に反していても)エラーを起こすとは限らない。
     */
    MemoryAmflowClient.TOKEN_PASSIVE = "mamfc-token:passive";
    return MemoryAmflowClient;
}());
exports.MemoryAmflowClient = MemoryAmflowClient;
function _cloneDeep(v) {
    if (v && typeof v === "object") {
        if (Array.isArray(v)) {
            return v.map(_cloneDeep);
        }
        else {
            return Object.keys(v).reduce(function (acc, k) { return (acc[k] = _cloneDeep(v[k]), acc); }, {});
        }
    }
    return v;
}
exports._cloneDeep = _cloneDeep;

},{}],24:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ReplayAmflowProxy = void 0;
var ReplayAmflowProxy = /** @class */ (function () {
    function ReplayAmflowProxy(param) {
        this._amflow = param.amflow;
        this._tickList = param.tickList;
        this._startPoints = param.startPoints;
    }
    /**
     * 与えられていたティックリストを部分的に破棄する。
     * ReplayAmflowProxy の独自メソッド。
     * @param age ティックを破棄する基準のage(このageのティックも破棄される)
     */
    ReplayAmflowProxy.prototype.dropAfter = function (age) {
        if (!this._tickList)
            return;
        var givenFrom = this._tickList[0 /* From */];
        var givenTo = this._tickList[1 /* To */];
        var givenTicksWithEvents = this._tickList[2 /* TicksWithEvents */];
        if (age <= givenFrom) {
            this._tickList = null;
            this._startPoints = [];
        }
        else if (age <= givenTo) {
            this._tickList[1 /* To */] = age - 1;
            this._tickList[2 /* TicksWithEvents */] = this._sliceTicks(givenTicksWithEvents, givenTo, age - 1);
            this._startPoints = this._startPoints.filter(function (sp) { return sp.frame < age; });
        }
    };
    ReplayAmflowProxy.prototype.open = function (playId, callback) {
        this._amflow.open(playId, callback);
    };
    ReplayAmflowProxy.prototype.close = function (callback) {
        this._amflow.close(callback);
    };
    ReplayAmflowProxy.prototype.authenticate = function (token, callback) {
        this._amflow.authenticate(token, callback);
    };
    ReplayAmflowProxy.prototype.sendTick = function (tick) {
        this._amflow.sendTick(tick);
    };
    ReplayAmflowProxy.prototype.onTick = function (handler) {
        this._amflow.onTick(handler);
    };
    ReplayAmflowProxy.prototype.offTick = function (handler) {
        this._amflow.offTick(handler);
    };
    ReplayAmflowProxy.prototype.sendEvent = function (event) {
        this._amflow.sendEvent(event);
    };
    ReplayAmflowProxy.prototype.onEvent = function (handler) {
        this._amflow.onEvent(handler);
    };
    ReplayAmflowProxy.prototype.offEvent = function (handler) {
        this._amflow.offEvent(handler);
    };
    ReplayAmflowProxy.prototype.getTickList = function (optsOrBegin, endOrCallback, callback) {
        var _this = this;
        // TODO: @akashic/amflow@3.0.0 追従
        if (typeof optsOrBegin !== "number" ||
            typeof endOrCallback !== "number" ||
            typeof callback !== "function") {
            if (typeof endOrCallback === "function") {
                endOrCallback(new Error("not implemented"));
                return;
            }
            throw new Error("not implemented");
        }
        var from = optsOrBegin;
        var to = endOrCallback;
        if (!this._tickList) {
            // TODO: 後方互換性のため旧インタフェースを一時的に利用する
            this._amflow.getTickList(from, to, callback);
            return;
        }
        var givenFrom = this._tickList[0 /* From */];
        var givenTo = this._tickList[1 /* To */];
        var givenTicksWithEvents = this._tickList[2 /* TicksWithEvents */];
        var fromInGiven = givenFrom <= from && from <= givenTo;
        var toInGiven = givenFrom <= to && to <= givenTo;
        if (fromInGiven && toInGiven) { // 手持ちが要求範囲を包含
            setTimeout(function () {
                callback(null, [from, to, _this._sliceTicks(givenTicksWithEvents, from, to)]);
            }, 0);
        }
        else {
            this._amflow.getTickList(from, to, function (err, tickList) {
                if (err)
                    return void callback(err);
                if (!tickList) {
                    // 何も得られなかった。手持ちの重複範囲を返すだけ。
                    if (!fromInGiven && !toInGiven) {
                        if (to < givenFrom || givenTo < from) { // 重複なし
                            callback(null, tickList);
                        }
                        else { // 要求範囲が手持ちを包含
                            callback(null, [givenFrom, givenTo, _this._sliceTicks(givenTicksWithEvents, from, to)]);
                        }
                    }
                    else if (fromInGiven) { // 前半重複
                        callback(null, [from, givenTo, _this._sliceTicks(givenTicksWithEvents, from, to)]);
                    }
                    else { // 後半重複
                        callback(null, [givenFrom, to, _this._sliceTicks(givenTicksWithEvents, from, to)]);
                    }
                }
                else {
                    // 何かは得られた。手持ちとマージする。
                    if (!fromInGiven && !toInGiven) {
                        if (to < givenFrom || givenTo < from) { // 重複なし
                            callback(null, tickList);
                        }
                        else { // 要求範囲が手持ちを包含
                            var ticksWithEvents = tickList[2 /* TicksWithEvents */];
                            if (ticksWithEvents) {
                                var beforeGiven = _this._sliceTicks(ticksWithEvents, from, givenFrom - 1);
                                var afterGiven = _this._sliceTicks(ticksWithEvents, givenTo + 1, to);
                                ticksWithEvents = beforeGiven.concat(givenTicksWithEvents, afterGiven);
                            }
                            else {
                                ticksWithEvents = givenTicksWithEvents;
                            }
                            callback(null, [from, to, ticksWithEvents]);
                        }
                    }
                    else if (fromInGiven) { // 前半重複
                        var ticksWithEvents = _this._sliceTicks(givenTicksWithEvents, from, to).concat(tickList[2 /* TicksWithEvents */] || []);
                        callback(null, [from, tickList[1 /* To */], ticksWithEvents]);
                    }
                    else { // 後半重複
                        var ticksWithEvents = (tickList[2 /* TicksWithEvents */] || []).concat(_this._sliceTicks(givenTicksWithEvents, from, to));
                        callback(null, [tickList[0 /* From */], to, ticksWithEvents]);
                    }
                }
            });
        }
    };
    ReplayAmflowProxy.prototype.putStartPoint = function (startPoint, callback) {
        this._amflow.putStartPoint(startPoint, callback);
    };
    ReplayAmflowProxy.prototype.getStartPoint = function (opts, callback) {
        var _this = this;
        var index = 0;
        if (this._startPoints.length > 0) {
            if (opts.frame != null) {
                var nearestFrame = this._startPoints[0].frame;
                for (var i = 1; i < this._startPoints.length; ++i) {
                    var frame = this._startPoints[i].frame;
                    if (frame <= opts.frame && nearestFrame < frame) {
                        nearestFrame = frame;
                        index = i;
                    }
                }
            }
            else {
                var nearestTimestamp = this._startPoints[0].timestamp;
                for (var i = 1; i < this._startPoints.length; ++i) {
                    var timestamp = this._startPoints[i].timestamp;
                    if (timestamp <= opts.timestamp && nearestTimestamp < timestamp) {
                        nearestTimestamp = timestamp;
                        index = i;
                    }
                }
            }
        }
        var givenTo = this._tickList ? this._tickList[1 /* To */] : -1;
        if (opts.frame > givenTo) {
            this._amflow.getStartPoint(opts, function (err, startPoint) {
                if (err) {
                    callback(err);
                    return;
                }
                if (givenTo < startPoint.frame) {
                    callback(null, startPoint);
                }
                else {
                    // 与えられたティックリストの範囲内のスタートポイントが見つかったとしてもなかったかのように振る舞う
                    callback(null, _this._startPoints[index]);
                }
            });
        }
        else {
            setTimeout(function () {
                callback(null, _this._startPoints[index]);
            }, 0);
        }
    };
    ReplayAmflowProxy.prototype.putStorageData = function (key, value, options, callback) {
        this._amflow.putStorageData(key, value, options, callback);
    };
    ReplayAmflowProxy.prototype.getStorageData = function (keys, callback) {
        this._amflow.getStorageData(keys, callback);
    };
    ReplayAmflowProxy.prototype._sliceTicks = function (ticks, from, to) {
        return ticks.filter(function (t) {
            var age = t[0 /* Age */];
            return from <= age && age <= to;
        });
    };
    return ReplayAmflowProxy;
}());
exports.ReplayAmflowProxy = ReplayAmflowProxy;

},{}],25:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SimpleProfiler = void 0;
var g = require("@akashic/akashic-engine");
var SimpleProfiler = /** @class */ (function () {
    function SimpleProfiler(param) {
        this._interval = param.interval != null ? param.interval : SimpleProfiler.DEFAULT_INTERVAL;
        if (param.limit != null) {
            this._limit = param.limit >= SimpleProfiler.DEFAULT_LIMIT ? param.limit : SimpleProfiler.DEFAULT_LIMIT;
        }
        else {
            this._limit = SimpleProfiler.DEFAULT_LIMIT;
        }
        this._calculateProfilerValueTrigger = new g.Trigger();
        if (param.getValueHandler) {
            this._calculateProfilerValueTrigger.add(param.getValueHandler, param.getValueHandlerOwner);
        }
        this._reset();
    }
    SimpleProfiler.prototype.time = function (type) {
        this._beforeTimes[type] = this._getCurrentTime();
    };
    SimpleProfiler.prototype.timeEnd = function (type) {
        var now = this._getCurrentTime();
        var value = this._beforeTimes[type] != null ? now - this._beforeTimes[type] : 0;
        this._values[type].push({
            time: now,
            value: value
        });
    };
    SimpleProfiler.prototype.flush = function () {
        var now = this._getCurrentTime();
        if (this._beforeFlushTime === 0)
            this._beforeFlushTime = now;
        if (this._beforeFlushTime + this._interval < now) {
            this._calculateProfilerValueTrigger.fire(this.getProfilerValue(this._interval));
            this._beforeFlushTime = now;
        }
        if (this._values[1 /* RawFrameInterval */].length > this._limit) {
            for (var i in this._values) {
                if (this._values.hasOwnProperty(i))
                    this._values[i] = this._values[i].slice(-SimpleProfiler.BACKUP_MARGIN);
            }
        }
    };
    SimpleProfiler.prototype.setValue = function (type, value) {
        this._values[type].push({
            time: this._getCurrentTime(),
            value: value
        });
    };
    /**
     * 現在時刻から、指定した時間までを遡った期間の `SimpleProfilerValue` を取得する。
     */
    SimpleProfiler.prototype.getProfilerValue = function (time) {
        var rawFrameInterval = this._calculateProfilerValue(1 /* RawFrameInterval */, time);
        return {
            skippedFrameCount: this._calculateProfilerValue(0 /* SkippedFrameCount */, time),
            rawFrameInterval: rawFrameInterval,
            framePerSecond: {
                ave: 1000 / rawFrameInterval.ave,
                max: 1000 / rawFrameInterval.min,
                min: 1000 / rawFrameInterval.max
            },
            frameTime: this._calculateProfilerValue(2 /* FrameTime */, time),
            renderingTime: this._calculateProfilerValue(3 /* RenderingTime */, time)
        };
    };
    SimpleProfiler.prototype._reset = function () {
        this._startTime = this._getCurrentTime();
        this._beforeFlushTime = 0;
        this._beforeTimes = [];
        this._beforeTimes[1 /* RawFrameInterval */] = 0;
        this._beforeTimes[2 /* FrameTime */] = 0;
        this._beforeTimes[3 /* RenderingTime */] = 0;
        this._beforeTimes[0 /* SkippedFrameCount */] = 0;
        this._values = [];
        this._values[1 /* RawFrameInterval */] = [];
        this._values[2 /* FrameTime */] = [];
        this._values[3 /* RenderingTime */] = [];
        this._values[0 /* SkippedFrameCount */] = [];
    };
    SimpleProfiler.prototype._calculateProfilerValue = function (type, time) {
        var limit = this._getCurrentTime() - time;
        var sum = 0;
        var num = 0;
        var max = 0;
        var min = Number.MAX_VALUE;
        for (var i = this._values[type].length - 1; i >= 0; --i) {
            if (0 < num && this._values[type][i].time < limit)
                break;
            var value = this._values[type][i].value;
            if (max < value)
                max = value;
            if (value < min)
                min = value;
            sum += value;
            ++num;
        }
        return {
            ave: sum / num,
            max: max,
            min: min
        };
    };
    SimpleProfiler.prototype._getCurrentTime = function () {
        return +new Date();
    };
    SimpleProfiler.DEFAULT_INTERVAL = 1000;
    SimpleProfiler.DEFAULT_LIMIT = 1000;
    SimpleProfiler.BACKUP_MARGIN = 100;
    return SimpleProfiler;
}());
exports.SimpleProfiler = SimpleProfiler;

},{"@akashic/akashic-engine":1}],26:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DEFAULT_POLLING_TICK_THRESHOLD = exports.DEFAULT_JUMP_IGNORE_THRESHOLD = exports.DEFAULT_JUMP_TRY_THRESHOLD = exports.DEFAULT_SKIP_THRESHOLD = exports.DEFAULT_SKIP_TICKS_AT_ONCE = exports.DEFAULT_DELAY_IGNORE_THRESHOLD = void 0;
/**
 * 遅延を無視する域値のデフォルト。
 * `LoopConfiguration#delayIgnoreThreshold` のデフォルト値。
 * このフレーム以下の遅延は遅れてないものとみなす(常時コマが飛ぶのを避けるため)。
 */
exports.DEFAULT_DELAY_IGNORE_THRESHOLD = 6;
/**
 * 「早送り」時倍率のデフォルト値。
 * `LoopConfiguration#skipTicksAtOnce` のデフォルト値。
 */
exports.DEFAULT_SKIP_TICKS_AT_ONCE = 100;
/**
 * 「早送り」状態に移る域値のデフォルト。
 * `LoopConfiguration#skipThreshold` のデフォルト値。
 */
exports.DEFAULT_SKIP_THRESHOLD = 100;
/**
 * スナップショットジャンプを試みる域値のデフォルト。
 * `LoopConfiguration#jumpTryThreshold` のデフォルト値。
 */
exports.DEFAULT_JUMP_TRY_THRESHOLD = 30000; // 30FPSの100倍早送りで換算3000FPSで進めても10秒かかる閾値
/**
 * 取得したスナップショットを無視する域値のデフォルト。
 * `LoopConfiguration#jumpIgnoreThreshold` のデフォルト値。
 */
exports.DEFAULT_JUMP_IGNORE_THRESHOLD = 15000; // 30FPSの100倍早送りで換算3000FPSで進めて5秒で済む閾値
/**
 * 最新ティックをポーリングする間隔(ms)のデフォルト。
 */
exports.DEFAULT_POLLING_TICK_THRESHOLD = 10000;

},{}],27:[function(require,module,exports){
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !exports.hasOwnProperty(p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.SimpleProfiler = exports.MemoryAmflowClient = exports.ReplayAmflowProxy = exports.Game = exports.GameDriver = exports.ExecutionMode = exports.LoopRenderMode = exports.LoopMode = exports.EventIndex = void 0;
__exportStar(require("./constants"), exports);
var EventIndex = require("./EventIndex");
exports.EventIndex = EventIndex;
var LoopMode_1 = require("./LoopMode");
exports.LoopMode = LoopMode_1.default;
var LoopRenderMode_1 = require("./LoopRenderMode");
exports.LoopRenderMode = LoopRenderMode_1.default;
var ExecutionMode_1 = require("./ExecutionMode");
exports.ExecutionMode = ExecutionMode_1.default;
var GameDriver_1 = require("./GameDriver");
Object.defineProperty(exports, "GameDriver", { enumerable: true, get: function () { return GameDriver_1.GameDriver; } });
var Game_1 = require("./Game");
Object.defineProperty(exports, "Game", { enumerable: true, get: function () { return Game_1.Game; } });
var ReplayAmflowProxy_1 = require("./auxiliary/ReplayAmflowProxy");
Object.defineProperty(exports, "ReplayAmflowProxy", { enumerable: true, get: function () { return ReplayAmflowProxy_1.ReplayAmflowProxy; } });
var MemoryAmflowClient_1 = require("./auxiliary/MemoryAmflowClient");
Object.defineProperty(exports, "MemoryAmflowClient", { enumerable: true, get: function () { return MemoryAmflowClient_1.MemoryAmflowClient; } });
var SimpleProfiler_1 = require("./auxiliary/SimpleProfiler");
Object.defineProperty(exports, "SimpleProfiler", { enumerable: true, get: function () { return SimpleProfiler_1.SimpleProfiler; } });

},{"./EventIndex":8,"./ExecutionMode":9,"./Game":10,"./GameDriver":11,"./LoopMode":14,"./LoopRenderMode":15,"./auxiliary/MemoryAmflowClient":23,"./auxiliary/ReplayAmflowProxy":24,"./auxiliary/SimpleProfiler":25,"./constants":26}],28:[function(require,module,exports){
module.exports = require("./lib/full/index");

},{"./lib/full/index":63}],29:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AudioManager = void 0;
var AudioManager = /** @class */ (function () {
    function AudioManager() {
        this.audioAssets = [];
        this._masterVolume = 1.0;
    }
    AudioManager.prototype.registerAudioAsset = function (asset) {
        if (this.audioAssets.indexOf(asset) === -1)
            this.audioAssets.push(asset);
    };
    AudioManager.prototype.removeAudioAsset = function (asset) {
        var index = this.audioAssets.indexOf(asset);
        if (index === -1)
            this.audioAssets.splice(index, 1);
    };
    AudioManager.prototype.setMasterVolume = function (volume) {
        this._masterVolume = volume;
        for (var i = 0; i < this.audioAssets.length; i++) {
            if (this.audioAssets[i]._lastPlayedPlayer) {
                this.audioAssets[i]._lastPlayedPlayer.notifyMasterVolumeChanged();
            }
        }
    };
    AudioManager.prototype.getMasterVolume = function () {
        return this._masterVolume;
    };
    return AudioManager;
}());
exports.AudioManager = AudioManager;

},{}],30:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ContainerController = void 0;
var g = require("@akashic/akashic-engine");
var InputHandlerLayer_1 = require("./InputHandlerLayer");
/*
 HTML要素のContainerを管理するクラス。
 CanvasやInputHandlerの実態となる要素の順番や追加済みなのかを管理する。
 ContainerはInput、Canvasを1つのセットとして扱う。

 以下のようなDOM構造を持つ

 ContainerController.rootView
 └── InputHandlerLayer
     └── CanvasSurface
 */
var ContainerController = /** @class */ (function () {
    function ContainerController(resourceFactory) {
        this.container = null;
        this.surface = null;
        this.inputHandlerLayer = null;
        this.rootView = null;
        this.useResizeForScaling = false;
        this.pointEventTrigger = new g.Trigger();
        this._rendererReq = null;
        this._disablePreventDefault = false;
        this.resourceFactory = resourceFactory;
    }
    ContainerController.prototype.initialize = function (param) {
        this._rendererReq = param.rendererRequirement;
        this._disablePreventDefault = !!param.disablePreventDefault;
        this._loadView();
    };
    ContainerController.prototype.setRootView = function (rootView) {
        if (rootView === this.rootView) {
            return;
        }
        // 一つのContainerは一つのrootしか持たないのでloadし直す
        if (this.rootView) {
            this.unloadView();
            this._loadView();
        }
        this.rootView = rootView;
        this._appendToRootView(rootView);
    };
    ContainerController.prototype.resetView = function (rendererReq) {
        this.unloadView();
        this._rendererReq = rendererReq;
        this._loadView();
        this._appendToRootView(this.rootView);
    };
    ContainerController.prototype.getRenderer = function () {
        if (!this.surface) {
            throw new Error("this container has no surface");
        }
        // TODO: should be cached?
        return this.surface.renderer();
    };
    ContainerController.prototype.changeScale = function (xScale, yScale) {
        if (this.useResizeForScaling) {
            this.surface.changePhysicalScale(xScale, yScale);
        }
        else {
            this.surface.changeVisualScale(xScale, yScale);
        }
        this.inputHandlerLayer._inputHandler.setScale(xScale, yScale);
    };
    ContainerController.prototype.unloadView = function () {
        // イベントを片付けてから、rootViewに所属するElementを開放する
        this.inputHandlerLayer.disablePointerEvent();
        if (this.rootView) {
            while (this.rootView.firstChild) {
                this.rootView.removeChild(this.rootView.firstChild);
            }
        }
    };
    ContainerController.prototype._loadView = function () {
        var _a = this._rendererReq, width = _a.primarySurfaceWidth, height = _a.primarySurfaceHeight;
        var disablePreventDefault = this._disablePreventDefault;
        // DocumentFragmentはinsertした時点で開放されているため毎回作る
        // https://dom.spec.whatwg.org/#concept-node-insert
        this.container = document.createDocumentFragment();
        // 入力受け付けレイヤー - DOM Eventの管理
        if (!this.inputHandlerLayer) {
            this.inputHandlerLayer = new InputHandlerLayer_1.InputHandlerLayer({ width: width, height: height, disablePreventDefault: disablePreventDefault });
        }
        else {
            // Note: 操作プラグインに与えた view 情報を削除しないため、 inputHandlerLayer を使いまわしている
            this.inputHandlerLayer.setViewSize({ width: width, height: height });
            this.inputHandlerLayer.pointEventTrigger.removeAll();
            if (this.surface && !this.surface.destroyed()) {
                this.inputHandlerLayer.view.removeChild(this.surface.canvas);
                this.surface.destroy();
            }
        }
        // 入力受け付けレイヤー > 描画レイヤー
        this.surface = this.resourceFactory.createPrimarySurface(width, height);
        this.inputHandlerLayer.view.appendChild(this.surface.getHTMLElement());
        // containerController -> input -> canvas
        this.container.appendChild(this.inputHandlerLayer.view);
    };
    ContainerController.prototype._appendToRootView = function (rootView) {
        rootView.appendChild(this.container);
        this.inputHandlerLayer.enablePointerEvent(); // Viewが追加されてから設定する
        this.inputHandlerLayer.pointEventTrigger.add(this.pointEventTrigger.fire, this.pointEventTrigger);
    };
    return ContainerController;
}());
exports.ContainerController = ContainerController;

},{"./InputHandlerLayer":31,"@akashic/akashic-engine":1}],31:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.InputHandlerLayer = void 0;
var g = require("@akashic/akashic-engine");
var TouchHandler_1 = require("./handler/TouchHandler");
/**
 * ユーザの入力を受け付けるViewのレイヤー。
 *
 * 実行環境に適切なDOMイベントを設定し、DOMイベントから座標データへ変換した結果をGameに伝える。
 * InputHandlerLayerはあくまで一つのレイヤーであり、Containerではない。
 * 従ってこのViewの親子要素がどうなっているかを知る必要はない。
 */
var InputHandlerLayer = /** @class */ (function () {
    /**
     * @example
     *
     * var inputHandlerLayer = new InputHandlerLayer();
     * inputHandlerLayer.pointEventTrigger.add(function(pointEvent){
     *   console.log(pointEvent);
     * });
     * containerController.appendChild(inputHandlerLayer.view);
     */
    function InputHandlerLayer(param) {
        this.view = this._createInputView(param.width, param.height);
        this._inputHandler = undefined;
        this.pointEventTrigger = new g.Trigger();
        this._disablePreventDefault = !!param.disablePreventDefault;
    }
    // 実行環境でサポートしてるDOM Eventを使い、それぞれonPoint*Triggerを関連付ける
    InputHandlerLayer.prototype.enablePointerEvent = function () {
        var _this = this;
        this._inputHandler = new TouchHandler_1.TouchHandler(this.view, this._disablePreventDefault);
        // 各種イベントのTrigger
        this._inputHandler.pointTrigger.add(function (e) {
            _this.pointEventTrigger.fire(e);
        });
        this._inputHandler.start();
    };
    // DOMイベントハンドラを開放する
    InputHandlerLayer.prototype.disablePointerEvent = function () {
        if (this._inputHandler)
            this._inputHandler.stop();
    };
    InputHandlerLayer.prototype.setOffset = function (offset) {
        var inputViewStyle = "position:relative; left:" + offset.x + "px; top:" + offset.y + "px";
        this._inputHandler.inputView.setAttribute("style", inputViewStyle);
    };
    InputHandlerLayer.prototype.setViewSize = function (size) {
        var view = this.view;
        view.style.width = size.width + "px";
        view.style.height = size.height + "px";
    };
    InputHandlerLayer.prototype._createInputView = function (width, height) {
        var view = document.createElement("div");
        view.setAttribute("tabindex", "1");
        view.className = "input-handler";
        view.setAttribute("style", "display:inline-block; outline:none;");
        view.style.width = width + "px";
        view.style.height = height + "px";
        return view;
    };
    return InputHandlerLayer;
}());
exports.InputHandlerLayer = InputHandlerLayer;

},{"./handler/TouchHandler":62,"@akashic/akashic-engine":1}],32:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Platform = void 0;
var RafLooper_1 = require("./RafLooper");
var ResourceFactory_1 = require("./ResourceFactory");
var ContainerController_1 = require("./ContainerController");
var AudioPluginManager_1 = require("./plugin/AudioPluginManager");
var AudioManager_1 = require("./AudioManager");
var AudioPluginRegistry_1 = require("./plugin/AudioPluginRegistry");
var XHRTextAsset_1 = require("./asset/XHRTextAsset");
var Platform = /** @class */ (function () {
    function Platform(param) {
        this.containerView = param.containerView;
        this.audioPluginManager = new AudioPluginManager_1.AudioPluginManager();
        if (param.audioPlugins) {
            this.audioPluginManager.tryInstallPlugin(param.audioPlugins);
        }
        // TODO: make it deprecated
        this.audioPluginManager.tryInstallPlugin(AudioPluginRegistry_1.AudioPluginRegistry.getRegisteredAudioPlugins());
        this._audioManager = new AudioManager_1.AudioManager();
        this.amflow = param.amflow;
        this._platformEventHandler = null;
        this._resourceFactory = param.resourceFactory || new ResourceFactory_1.ResourceFactory({
            audioPluginManager: this.audioPluginManager,
            platform: this,
            audioManager: this._audioManager
        });
        this.containerController = new ContainerController_1.ContainerController(this._resourceFactory);
        this._rendererReq = null;
        this._disablePreventDefault = !!param.disablePreventDefault;
    }
    Platform.prototype.setPlatformEventHandler = function (handler) {
        if (this.containerController) {
            this.containerController.pointEventTrigger.removeAll({ owner: this._platformEventHandler });
            this.containerController.pointEventTrigger.add(handler.onPointEvent, handler);
        }
        this._platformEventHandler = handler;
    };
    Platform.prototype.loadGameConfiguration = function (url, callback) {
        var a = new XHRTextAsset_1.XHRTextAsset("(game.json)", url);
        a._load({
            _onAssetLoad: function (asset) { callback(null, JSON.parse(a.data)); },
            _onAssetError: function (asset, error) { callback(error, null); }
        });
    };
    Platform.prototype.getResourceFactory = function () {
        return this._resourceFactory;
    };
    Platform.prototype.setRendererRequirement = function (requirement) {
        if (!requirement) {
            if (this.containerController)
                this.containerController.unloadView();
            return;
        }
        this._rendererReq = requirement;
        this._resourceFactory._rendererCandidates = this._rendererReq.rendererCandidates;
        // Note: this.containerController.inputHandlerLayer の存在により this.containerController が初期化されているかを判定
        if (this.containerController && !this.containerController.inputHandlerLayer) {
            this.containerController.initialize({
                rendererRequirement: requirement,
                disablePreventDefault: this._disablePreventDefault
            });
            this.containerController.setRootView(this.containerView);
            if (this._platformEventHandler) {
                this.containerController.pointEventTrigger.add(this._platformEventHandler.onPointEvent, this._platformEventHandler);
            }
        }
        else {
            this.containerController.resetView(requirement);
        }
    };
    Platform.prototype.getPrimarySurface = function () {
        return this.containerController.surface;
    };
    Platform.prototype.getOperationPluginViewInfo = function () {
        var _this = this;
        return {
            type: "pdi-browser",
            view: this.containerController.inputHandlerLayer.view,
            getScale: function () { return _this.containerController.inputHandlerLayer._inputHandler.getScale(); }
        };
    };
    Platform.prototype.createLooper = function (fun) {
        return new RafLooper_1.RafLooper(fun);
    };
    Platform.prototype.sendToExternal = function (playId, data) {
        // Nothing to do.
    };
    Platform.prototype.registerAudioPlugins = function (plugins) {
        return this.audioPluginManager.tryInstallPlugin(plugins);
    };
    Platform.prototype.setScale = function (xScale, yScale) {
        this.containerController.changeScale(xScale, yScale);
    };
    Platform.prototype.notifyViewMoved = function () {
        // 既に役割のないメソッド(呼び出さなくても正しく動作する)。公開APIのため後方互換性のために残している。
    };
    /**
     * 最終的に出力されるマスター音量を変更する
     *
     * @param volume マスター音量
     */
    Platform.prototype.setMasterVolume = function (volume) {
        if (this._audioManager)
            this._audioManager.setMasterVolume(volume);
    };
    /**
     * 最終的に出力されるマスター音量を取得する
     */
    Platform.prototype.getMasterVolume = function () {
        if (this._audioManager)
            return this._audioManager.getMasterVolume();
    };
    Platform.prototype.destroy = function () {
        this.setRendererRequirement(undefined);
        this.setMasterVolume(0);
    };
    return Platform;
}());
exports.Platform = Platform;

},{"./AudioManager":29,"./ContainerController":30,"./RafLooper":33,"./ResourceFactory":34,"./asset/XHRTextAsset":39,"./plugin/AudioPluginManager":64,"./plugin/AudioPluginRegistry":65}],33:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RafLooper = void 0;
var RafLooper = /** @class */ (function () {
    function RafLooper(fun) {
        this._fun = fun;
        this._timerId = undefined;
        this._prev = 0;
    }
    RafLooper.prototype.start = function () {
        var _this = this;
        var onAnimationFrame = function (deltaTime) {
            if (_this._timerId == null) {
                // NOTE: Firefox Quantum 57.0.2の不具合(？)(cancelAnimationFrame()が機能しないことがある)暫定対策
                return;
            }
            _this._timerId = requestAnimationFrame(onAnimationFrame);
            _this._fun(deltaTime - _this._prev);
            _this._prev = deltaTime;
        };
        var onFirstFrame = function (deltaTime) {
            _this._timerId = requestAnimationFrame(onAnimationFrame);
            _this._fun(0);
            _this._prev = deltaTime;
        };
        this._timerId = requestAnimationFrame(onFirstFrame);
    };
    RafLooper.prototype.stop = function () {
        cancelAnimationFrame(this._timerId);
        this._timerId = undefined;
        this._prev = 0;
    };
    return RafLooper;
}());
exports.RafLooper = RafLooper;

},{}],34:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.ResourceFactory = void 0;
var g = require("@akashic/akashic-engine");
var HTMLImageAsset_1 = require("./asset/HTMLImageAsset");
var HTMLVideoAsset_1 = require("./asset/HTMLVideoAsset");
var XHRTextAsset_1 = require("./asset/XHRTextAsset");
var XHRScriptAsset_1 = require("./asset/XHRScriptAsset");
var GlyphFactory_1 = require("./canvas/GlyphFactory");
var SurfaceFactory_1 = require("./canvas/shims/SurfaceFactory");
var ResourceFactory = /** @class */ (function (_super) {
    __extends(ResourceFactory, _super);
    function ResourceFactory(param) {
        var _this = _super.call(this) || this;
        _this._audioPluginManager = param.audioPluginManager;
        _this._audioManager = param.audioManager;
        _this._platform = param.platform;
        _this._surfaceFactory = new SurfaceFactory_1.SurfaceFactory();
        return _this;
    }
    ResourceFactory.prototype.createAudioAsset = function (id, assetPath, duration, system, loop, hint) {
        var activePlugin = this._audioPluginManager.getActivePlugin();
        var audioAsset = activePlugin.createAsset(id, assetPath, duration, system, loop, hint);
        if (audioAsset.onDestroyed) {
            this._audioManager.registerAudioAsset(audioAsset);
            audioAsset.onDestroyed.add(this._onAudioAssetDestroyed, this);
        }
        return audioAsset;
    };
    ResourceFactory.prototype.createAudioPlayer = function (system) {
        var activePlugin = this._audioPluginManager.getActivePlugin();
        return activePlugin.createPlayer(system, this._audioManager);
    };
    ResourceFactory.prototype.createImageAsset = function (id, assetPath, width, height) {
        return new HTMLImageAsset_1.HTMLImageAsset(id, assetPath, width, height);
    };
    ResourceFactory.prototype.createVideoAsset = function (id, assetPath, width, height, system, loop, useRealSize) {
        return new HTMLVideoAsset_1.HTMLVideoAsset(id, assetPath, width, height, system, loop, useRealSize);
    };
    ResourceFactory.prototype.createTextAsset = function (id, assetPath) {
        return new XHRTextAsset_1.XHRTextAsset(id, assetPath);
    };
    ResourceFactory.prototype.createScriptAsset = function (id, assetPath) {
        return new XHRScriptAsset_1.XHRScriptAsset(id, assetPath);
    };
    ResourceFactory.prototype.createPrimarySurface = function (width, height) {
        return this._surfaceFactory.createPrimarySurface(width, height, this._rendererCandidates);
    };
    ResourceFactory.prototype.createSurface = function (width, height) {
        return this._surfaceFactory.createBackSurface(width, height, this._rendererCandidates);
    };
    ResourceFactory.prototype.createGlyphFactory = function (fontFamily, fontSize, baseline, fontColor, strokeWidth, strokeColor, strokeOnly, fontWeight) {
        return new GlyphFactory_1.GlyphFactory(fontFamily, fontSize, baseline, fontColor, strokeWidth, strokeColor, strokeOnly, fontWeight);
    };
    ResourceFactory.prototype._onAudioAssetDestroyed = function (asset) {
        this._audioManager.removeAudioAsset(asset);
    };
    return ResourceFactory;
}(g.ResourceFactory));
exports.ResourceFactory = ResourceFactory;

},{"./asset/HTMLImageAsset":35,"./asset/HTMLVideoAsset":36,"./asset/XHRScriptAsset":38,"./asset/XHRTextAsset":39,"./canvas/GlyphFactory":42,"./canvas/shims/SurfaceFactory":48,"@akashic/akashic-engine":1}],35:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.HTMLImageAsset = exports.ImageAssetSurface = void 0;
var g = require("@akashic/akashic-engine");
var ImageAssetSurface = /** @class */ (function (_super) {
    __extends(ImageAssetSurface, _super);
    function ImageAssetSurface(width, height, drawable) {
        return _super.call(this, width, height, drawable) || this;
    }
    ImageAssetSurface.prototype.renderer = function () {
        throw g.ExceptionFactory.createAssertionError("ImageAssetSurface cannot be rendered.");
    };
    ImageAssetSurface.prototype.isPlaying = function () {
        return false;
    };
    return ImageAssetSurface;
}(g.Surface));
exports.ImageAssetSurface = ImageAssetSurface;
var HTMLImageAsset = /** @class */ (function (_super) {
    __extends(HTMLImageAsset, _super);
    function HTMLImageAsset(id, path, width, height) {
        var _this = _super.call(this, id, path, width, height) || this;
        _this.data = undefined;
        _this._surface = undefined;
        return _this;
    }
    HTMLImageAsset.prototype.destroy = function () {
        if (this._surface && !this._surface.destroyed()) {
            this._surface.destroy();
        }
        this.data = undefined;
        this._surface = undefined;
        _super.prototype.destroy.call(this);
    };
    HTMLImageAsset.prototype._load = function (loader) {
        var _this = this;
        var image = new Image();
        if (this.hint && this.hint.untainted) {
            image.crossOrigin = "anonymous";
        }
        image.onerror = function () {
            loader._onAssetError(_this, g.ExceptionFactory.createAssetLoadError("HTMLImageAsset unknown loading error"));
        };
        image.onload = function () {
            _this.data = image;
            loader._onAssetLoad(_this);
        };
        image.src = this.path;
    };
    HTMLImageAsset.prototype.asSurface = function () {
        if (!this.data) {
            throw g.ExceptionFactory.createAssertionError("ImageAssetImpl#asSurface: not yet loaded.");
        }
        if (this._surface) {
            return this._surface;
        }
        this._surface = new ImageAssetSurface(this.width, this.height, this.data);
        return this._surface;
    };
    return HTMLImageAsset;
}(g.ImageAsset));
exports.HTMLImageAsset = HTMLImageAsset;

},{"@akashic/akashic-engine":1}],36:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.HTMLVideoAsset = void 0;
var g = require("@akashic/akashic-engine");
var HTMLVideoPlayer_1 = require("./HTMLVideoPlayer");
var VideoAssetSurface = /** @class */ (function (_super) {
    __extends(VideoAssetSurface, _super);
    function VideoAssetSurface(width, height, drawable) {
        return _super.call(this, width, height, drawable, true) || this;
    }
    VideoAssetSurface.prototype.renderer = function () {
        throw g.ExceptionFactory.createAssertionError("VideoAssetSurface cannot be rendered.");
    };
    VideoAssetSurface.prototype.isPlaying = function () {
        return false;
    };
    return VideoAssetSurface;
}(g.Surface));
var HTMLVideoAsset = /** @class */ (function (_super) {
    __extends(HTMLVideoAsset, _super);
    function HTMLVideoAsset(id, assetPath, width, height, system, loop, useRealSize) {
        var _this = _super.call(this, id, assetPath, width, height, system, loop, useRealSize) || this;
        _this._player = new HTMLVideoPlayer_1.HTMLVideoPlayer();
        _this._surface = new VideoAssetSurface(width, height, null);
        return _this;
    }
    HTMLVideoAsset.prototype.inUse = function () {
        return false;
    };
    HTMLVideoAsset.prototype._load = function (loader) {
        var _this = this;
        setTimeout(function () {
            loader._onAssetLoad(_this);
        }, 0);
    };
    HTMLVideoAsset.prototype.getPlayer = function () {
        return this._player;
    };
    HTMLVideoAsset.prototype.asSurface = function () {
        return this._surface;
    };
    return HTMLVideoAsset;
}(g.VideoAsset));
exports.HTMLVideoAsset = HTMLVideoAsset;

},{"./HTMLVideoPlayer":37,"@akashic/akashic-engine":1}],37:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.HTMLVideoPlayer = void 0;
var g = require("@akashic/akashic-engine");
var HTMLVideoPlayer = /** @class */ (function (_super) {
    __extends(HTMLVideoPlayer, _super);
    function HTMLVideoPlayer(loop) {
        var _this = _super.call(this, loop) || this;
        _this.isDummy = true;
        return _this;
    }
    HTMLVideoPlayer.prototype.play = function (videoAsset) {
        // not yet supported
    };
    HTMLVideoPlayer.prototype.stop = function () {
        // not yet supported
    };
    HTMLVideoPlayer.prototype.changeVolume = function (volume) {
        // not yet supported
    };
    return HTMLVideoPlayer;
}(g.VideoPlayer));
exports.HTMLVideoPlayer = HTMLVideoPlayer;

},{"@akashic/akashic-engine":1}],38:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.XHRScriptAsset = void 0;
var g = require("@akashic/akashic-engine");
var XHRLoader_1 = require("../utils/XHRLoader");
var XHRScriptAsset = /** @class */ (function (_super) {
    __extends(XHRScriptAsset, _super);
    function XHRScriptAsset(id, path) {
        var _this = _super.call(this, id, path) || this;
        _this.script = undefined;
        return _this;
    }
    XHRScriptAsset.prototype._load = function (handler) {
        var _this = this;
        var loader = new XHRLoader_1.XHRLoader();
        loader.get(this.path, function (error, responseText) {
            if (error) {
                handler._onAssetError(_this, error);
                return;
            }
            _this.script = responseText + "\n";
            handler._onAssetLoad(_this);
        });
    };
    XHRScriptAsset.prototype.execute = function (execEnv) {
        // TODO: この方式では読み込んだスクリプトがcookie参照できる等本質的な危険性がある
        // 信頼できないスクリプトを読み込むようなケースでは、iframeに閉じ込めて実行などの方式を検討する事。
        var func = this._wrap();
        func(execEnv);
        return execEnv.module.exports;
    };
    XHRScriptAsset.prototype._wrap = function () {
        var func = new Function("g", XHRScriptAsset.PRE_SCRIPT + this.script + XHRScriptAsset.POST_SCRIPT);
        return func;
    };
    XHRScriptAsset.PRE_SCRIPT = "(function(exports, require, module, __filename, __dirname) {";
    XHRScriptAsset.POST_SCRIPT = "\n})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);";
    return XHRScriptAsset;
}(g.ScriptAsset));
exports.XHRScriptAsset = XHRScriptAsset;

},{"../utils/XHRLoader":82,"@akashic/akashic-engine":1}],39:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.XHRTextAsset = void 0;
var g = require("@akashic/akashic-engine");
var XHRLoader_1 = require("../utils/XHRLoader");
var XHRTextAsset = /** @class */ (function (_super) {
    __extends(XHRTextAsset, _super);
    function XHRTextAsset(id, path) {
        var _this = _super.call(this, id, path) || this;
        _this.data = undefined;
        return _this;
    }
    XHRTextAsset.prototype._load = function (handler) {
        var _this = this;
        var loader = new XHRLoader_1.XHRLoader();
        loader.get(this.path, function (error, responseText) {
            if (error) {
                handler._onAssetError(_this, error);
                return;
            }
            _this.data = responseText;
            handler._onAssetLoad(_this);
        });
    };
    return XHRTextAsset;
}(g.TextAsset));
exports.XHRTextAsset = XHRTextAsset;

},{"../utils/XHRLoader":82,"@akashic/akashic-engine":1}],40:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AffineTransformer = void 0;
var AffineTransformer = /** @class */ (function () {
    function AffineTransformer(rhs) {
        if (rhs) {
            this.matrix = new Float32Array(rhs.matrix);
        }
        else {
            this.matrix = new Float32Array([1, 0, 0, 1, 0, 0]);
        }
    }
    AffineTransformer.prototype.scale = function (x, y) {
        var m = this.matrix;
        m[0] *= x;
        m[1] *= x;
        m[2] *= y;
        m[3] *= y;
        return this;
    };
    AffineTransformer.prototype.translate = function (x, y) {
        var m = this.matrix;
        m[4] += m[0] * x + m[2] * y;
        m[5] += m[1] * x + m[3] * y;
        return this;
    };
    AffineTransformer.prototype.transform = function (matrix) {
        var m = this.matrix;
        var a = matrix[0] * m[0] + matrix[1] * m[2];
        var b = matrix[0] * m[1] + matrix[1] * m[3];
        var c = matrix[2] * m[0] + matrix[3] * m[2];
        var d = matrix[2] * m[1] + matrix[3] * m[3];
        var e = matrix[4] * m[0] + matrix[5] * m[2] + m[4];
        var f = matrix[4] * m[1] + matrix[5] * m[3] + m[5];
        m[0] = a;
        m[1] = b;
        m[2] = c;
        m[3] = d;
        m[4] = e;
        m[5] = f;
        return this;
    };
    AffineTransformer.prototype.setTransform = function (matrix) {
        var m = this.matrix;
        m[0] = matrix[0];
        m[1] = matrix[1];
        m[2] = matrix[2];
        m[3] = matrix[3];
        m[4] = matrix[4];
        m[5] = matrix[5];
    };
    AffineTransformer.prototype.copyFrom = function (rhs) {
        this.matrix.set(rhs.matrix);
        return this;
    };
    return AffineTransformer;
}());
exports.AffineTransformer = AffineTransformer;

},{}],41:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.CanvasSurface = void 0;
var g = require("@akashic/akashic-engine");
var CanvasSurface = /** @class */ (function (_super) {
    __extends(CanvasSurface, _super);
    function CanvasSurface(width, height) {
        var _this = this;
        var canvas = document.createElement("canvas");
        _this = _super.call(this, width, height, canvas) || this;
        canvas.width = width;
        canvas.height = height;
        _this.canvas = canvas;
        _this._renderer = undefined;
        return _this;
    }
    CanvasSurface.prototype.destroy = function () {
        this.canvas.width = 1;
        this.canvas.height = 1;
        this.canvas = null;
        this._renderer = null;
        _super.prototype.destroy.call(this);
    };
    CanvasSurface.prototype.getHTMLElement = function () {
        return this.canvas;
    };
    /**
     * 表示上の拡大率を変更する。
     * `changeRawSize()` との差異に注意。
     */
    CanvasSurface.prototype.changeVisualScale = function (xScale, yScale) {
        /*
         Canvas要素のリサイズをCSS transformで行う。
         CSSのwidth/height styleによるリサイズはおかしくなるケースが存在するので、可能な限りtransformを使う。
         - https://twitter.com/uupaa/status/639002317576998912
         - http://havelog.ayumusato.com/develop/performance/e554-paint_gpu_acceleration_problems.html
         - http://buccchi.jp/blog/2013/03/android_canvas_deathpoint/
         */
        var canvasStyle = this.canvas.style;
        if ("transform" in canvasStyle) {
            canvasStyle.transformOrigin = "0 0";
            canvasStyle.transform = "scale(" + xScale + "," + yScale + ")";
        }
        else if ("webkitTransform" in canvasStyle) {
            canvasStyle.webkitTransformOrigin = "0 0";
            canvasStyle.webkitTransform = "scale(" + xScale + "," + yScale + ")";
        }
        else {
            canvasStyle.width = Math.floor(xScale * this.width) + "px";
            canvasStyle.height = Math.floor(yScale * this.width) + "px";
        }
    };
    return CanvasSurface;
}(g.Surface));
exports.CanvasSurface = CanvasSurface;

},{"@akashic/akashic-engine":1}],42:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.GlyphFactory = void 0;
var g = require("@akashic/akashic-engine");
var Context2DSurface_1 = require("./context2d/Context2DSurface");
function createGlyphRenderedSurface(code, fontSize, cssFontFamily, baselineHeight, marginW, marginH, needImageData, fontColor, strokeWidth, strokeColor, strokeOnly, fontWeight) {
    // 要求されたフォントサイズが描画可能な最小フォントサイズ以下だった場合、必要なスケーリング係数
    var scale = fontSize < GlyphFactory._environmentMinimumFontSize ? fontSize / GlyphFactory._environmentMinimumFontSize : 1;
    var surfaceWidth = Math.ceil((fontSize + marginW * 2) * scale);
    var surfaceHeight = Math.ceil((fontSize + marginH * 2) * scale);
    var surface = new Context2DSurface_1.Context2DSurface(surfaceWidth, surfaceHeight);
    // NOTE: canvasを直接操作する
    // 理由:
    // * Renderer#drawSystemText()を廃止または非推奨にしたいのでそれを用いず文字列を描画する
    // * RenderingHelperがcontextの状態を復帰するためTextMetricsを取れない
    var canvas = surface.canvas;
    var context = canvas.getContext("2d");
    var str = (code & 0xFFFF0000) ? String.fromCharCode((code & 0xFFFF0000) >>> 16, code & 0xFFFF) : String.fromCharCode(code);
    var fontWeightValue = fontWeight === g.FontWeight.Bold ? "bold " : "";
    context.save();
    // CanvasRenderingContext2D.font
    // see: https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/font
    // > This string uses the same syntax as the CSS font specifier. The default font is 10px sans-serif.
    context.font = fontWeightValue + fontSize + "px " + cssFontFamily;
    context.textAlign = "left";
    context.textBaseline = "alphabetic";
    context.lineJoin = "bevel";
    // 描画可能な最小フォントサイズ以下のフォントサイズはスケーリングで実現する
    if (scale !== 1)
        context.scale(scale, scale);
    if (strokeWidth > 0) {
        context.lineWidth = strokeWidth;
        context.strokeStyle = strokeColor;
        context.strokeText(str, marginW, marginH + baselineHeight);
    }
    if (!strokeOnly) {
        context.fillStyle = fontColor;
        context.fillText(str, marginW, marginH + baselineHeight);
    }
    var advanceWidth = context.measureText(str).width;
    context.restore();
    var result = {
        surface: surface,
        advanceWidth: advanceWidth,
        imageData: needImageData ? context.getImageData(0, 0, canvas.width, canvas.height) : undefined
    };
    return result;
}
function calcGlyphArea(imageData) {
    var sx = imageData.width;
    var sy = imageData.height;
    var ex = 0;
    var ey = 0;
    var currentPos = 0;
    for (var y = 0, height = imageData.height; y < height; y = (y + 1) | 0) {
        for (var x = 0, width = imageData.width; x < width; x = (x + 1) | 0) {
            var a = imageData.data[currentPos + 3]; // get alpha value
            if (a !== 0) {
                if (x < sx) {
                    sx = x;
                }
                if (x > ex) {
                    ex = x;
                }
                if (y < sy) {
                    sy = y;
                }
                if (y > ey) {
                    ey = y;
                }
            }
            currentPos += 4; // go to next pixel
        }
    }
    var glyphArea = undefined;
    if (sx === imageData.width) { // 空白文字
        glyphArea = { x: 0, y: 0, width: 0, height: 0 }; // 空の領域に設定
    }
    else {
        // sx, sy, ex, eyは座標ではなく画素のメモリ上の位置を指す添字。
        // 故にwidth, heightを算出する時 1 加算する。
        glyphArea = { x: sx, y: sy, width: ex - sx + 1, height: ey - sy + 1 };
    }
    return glyphArea;
}
function isGlyphAreaEmpty(glyphArea) {
    return glyphArea.width === 0 || glyphArea.height === 0;
}
function fontFamily2FontFamilyName(fontFamily) {
    switch (fontFamily) {
        case g.FontFamily.Monospace:
            return "monospace";
        case g.FontFamily.Serif:
            return "serif";
        default:
            return "sans-serif";
    }
}
// ジェネリックフォントファミリとして定義されているキーワードのリスト
// see: https://developer.mozilla.org/en-US/docs/Web/CSS/font-family
var genericFontFamilyNames = [
    "serif", "sans-serif", "monospace", "cursive", "fantasy", "system-ui"
];
// ジェネリックフォントファミリでない時クォートする。
// > Font family names must either be given quoted as strings, or unquoted as a sequence of one or more identifiers.
// > Generic family names are keywords and must not be quoted.
// see: https://developer.mozilla.org/en-US/docs/Web/CSS/font-family
function quoteIfNotGeneric(name) {
    if (genericFontFamilyNames.indexOf(name) !== -1) {
        return name;
    }
    else {
        return "\"" + name + "\"";
    }
}
function fontFamily2CSSFontFamily(fontFamily) {
    if (typeof fontFamily === "number") {
        return fontFamily2FontFamilyName(fontFamily);
    }
    else if (typeof fontFamily === "string") {
        return quoteIfNotGeneric(fontFamily);
    }
    else {
        return fontFamily.map(function (font) {
            if (typeof font === "string") {
                return quoteIfNotGeneric(font);
            }
            else {
                return fontFamily2FontFamilyName(font);
            }
        }).join(",");
    }
}
var GlyphFactory = /** @class */ (function (_super) {
    __extends(GlyphFactory, _super);
    function GlyphFactory(fontFamily, fontSize, baselineHeight, fontColor, strokeWidth, strokeColor, strokeOnly, fontWeight) {
        var _this = _super.call(this, fontFamily, fontSize, baselineHeight, fontColor, strokeWidth, strokeColor, strokeOnly, fontWeight) || this;
        _this._glyphAreas = {};
        _this._cssFontFamily = fontFamily2CSSFontFamily(fontFamily);
        // Akashicエンジンは指定されたフォントに利用可能なものが見つからない時
        // `g.FontFamily.SansSerif` を利用する、と仕様して定められている。
        var fallbackFontFamilyName = fontFamily2FontFamilyName(g.FontFamily.SansSerif);
        if (_this._cssFontFamily.indexOf(fallbackFontFamilyName) === -1) {
            _this._cssFontFamily += "," + fallbackFontFamilyName;
        }
        // `this.fontSize`の大きさの文字を描画するためのサーフェスを生成する。
        // 一部の文字は縦横が`this.fontSize`幅の矩形に収まらない。
        // そこで上下左右にマージンを設ける。マージン幅は`this.fontSize`に
        // 0.3 を乗じたものにする。0.3に確たる根拠はないが、検証した範囲では
        // これで十分であることを確認している。
        //
        // strokeWidthサポートに伴い、輪郭線の厚みを加味している。
        _this._marginW = Math.ceil(_this.fontSize * 0.3 + _this.strokeWidth / 2);
        _this._marginH = Math.ceil(_this.fontSize * 0.3 + _this.strokeWidth / 2);
        if (GlyphFactory._environmentMinimumFontSize === undefined) {
            GlyphFactory._environmentMinimumFontSize = _this.measureMinimumFontSize();
        }
        return _this;
    }
    GlyphFactory.prototype.create = function (code) {
        var result;
        var glyphArea = this._glyphAreas[code];
        if (!glyphArea) {
            result = createGlyphRenderedSurface(code, this.fontSize, this._cssFontFamily, this.baselineHeight, this._marginW, this._marginH, true, this.fontColor, this.strokeWidth, this.strokeColor, this.strokeOnly, this.fontWeight);
            glyphArea = calcGlyphArea(result.imageData);
            glyphArea.advanceWidth = result.advanceWidth;
            this._glyphAreas[code] = glyphArea;
        }
        if (isGlyphAreaEmpty(glyphArea)) {
            if (result) {
                result.surface.destroy();
            }
            return new g.Glyph(code, 0, 0, 0, 0, 0, 0, glyphArea.advanceWidth, undefined, true);
        }
        else {
            // g.Glyphに格納するサーフェスを生成する。
            // glyphAreaはサーフェスをキャッシュしないため、描画する内容を持つグリフに対しては
            // サーフェスを生成する。もし前段でcalcGlyphArea()のためのサーフェスを生成して
            // いればここでは生成せずにそれを利用する。
            if (!result) {
                result = createGlyphRenderedSurface(code, this.fontSize, this._cssFontFamily, this.baselineHeight, this._marginW, this._marginH, false, this.fontColor, this.strokeWidth, this.strokeColor, this.strokeOnly, this.fontWeight);
            }
            return new g.Glyph(code, glyphArea.x, glyphArea.y, glyphArea.width, glyphArea.height, glyphArea.x - this._marginW, glyphArea.y - this._marginH, glyphArea.advanceWidth, result.surface, true);
        }
    };
    // 実行環境の描画可能なフォントサイズの最小値を返す
    GlyphFactory.prototype.measureMinimumFontSize = function () {
        var fontSize = 1;
        var str = "M";
        var canvas = document.createElement("canvas");
        var context = canvas.getContext("2d");
        context.textAlign = "left";
        context.textBaseline = "alphabetic";
        context.lineJoin = "bevel";
        var preWidth;
        context.font = fontSize + "px sans-serif";
        var width = context.measureText(str).width;
        do {
            preWidth = width;
            fontSize += 1;
            context.font = fontSize + "px sans-serif";
            width = context.measureText(str).width;
        } while (preWidth === width || fontSize > 50); // フォントサイズに対応しない動作環境の場合を考慮して上限値を設ける
        return fontSize;
    };
    return GlyphFactory;
}(g.GlyphFactory));
exports.GlyphFactory = GlyphFactory;

},{"./context2d/Context2DSurface":47,"@akashic/akashic-engine":1}],43:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RenderingHelper = void 0;
var RenderingHelper;
(function (RenderingHelper) {
    function toPowerOfTwo(x) {
        if ((x & (x - 1)) !== 0) {
            var y = 1;
            while (y < x) {
                y *= 2;
            }
            return y;
        }
        return x;
    }
    RenderingHelper.toPowerOfTwo = toPowerOfTwo;
    function clamp(x) {
        return Math.min(Math.max(x, 0.0), 1.0);
    }
    RenderingHelper.clamp = clamp;
    function usedWebGL(rendererCandidates) {
        var used = false;
        if (rendererCandidates && (0 < rendererCandidates.length)) {
            used = (rendererCandidates[0] === "webgl");
        }
        return used;
    }
    RenderingHelper.usedWebGL = usedWebGL;
})(RenderingHelper = exports.RenderingHelper || (exports.RenderingHelper = {}));

},{}],44:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CanvasRenderingState = void 0;
var AffineTransformer_1 = require("../AffineTransformer");
var CanvasRenderingState = /** @class */ (function () {
    function CanvasRenderingState(crs) {
        if (crs) {
            this.fillStyle = crs.fillStyle;
            this.globalAlpha = crs.globalAlpha;
            this.globalCompositeOperation = crs.globalCompositeOperation;
            this.transformer = new AffineTransformer_1.AffineTransformer(crs.transformer);
        }
        else {
            this.fillStyle = "#000000";
            this.globalAlpha = 1.0;
            this.globalCompositeOperation = "source-over";
            this.transformer = new AffineTransformer_1.AffineTransformer();
        }
    }
    return CanvasRenderingState;
}());
exports.CanvasRenderingState = CanvasRenderingState;

},{"../AffineTransformer":40}],45:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CanvasSurfaceContext = void 0;
var CanvasRenderingState_1 = require("./CanvasRenderingState");
var CanvasSurfaceContext = /** @class */ (function () {
    function CanvasSurfaceContext(context) {
        this._stateStack = [];
        this._modifiedTransform = false;
        this._context = context;
        var state = new CanvasRenderingState_1.CanvasRenderingState();
        this._currentFillStyle = state.fillStyle;
        this._currentGlobalAlpha = state.globalAlpha;
        this._currentGlobalCompositeOperation = state.globalCompositeOperation;
        this.pushState(state);
    }
    Object.defineProperty(CanvasSurfaceContext.prototype, "fillStyle", {
        get: function () {
            return this.currentState().fillStyle;
        },
        set: function (fillStyle) {
            this.currentState().fillStyle = fillStyle;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CanvasSurfaceContext.prototype, "globalAlpha", {
        get: function () {
            return this.currentState().globalAlpha;
        },
        set: function (globalAlpha) {
            this.currentState().globalAlpha = globalAlpha;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CanvasSurfaceContext.prototype, "globalCompositeOperation", {
        get: function () {
            return this.currentState().globalCompositeOperation;
        },
        set: function (operation) {
            this.currentState().globalCompositeOperation = operation;
        },
        enumerable: false,
        configurable: true
    });
    CanvasSurfaceContext.prototype.getCanvasRenderingContext2D = function () {
        return this._context;
    };
    CanvasSurfaceContext.prototype.clearRect = function (x, y, width, height) {
        this.prerender();
        this._context.clearRect(x, y, width, height);
    };
    CanvasSurfaceContext.prototype.save = function () {
        var state = new CanvasRenderingState_1.CanvasRenderingState(this.currentState());
        this.pushState(state);
    };
    CanvasSurfaceContext.prototype.restore = function () {
        this.popState();
    };
    CanvasSurfaceContext.prototype.scale = function (x, y) {
        this.currentState().transformer.scale(x, y);
        this._modifiedTransform = true;
    };
    CanvasSurfaceContext.prototype.drawImage = function (image, srcX, srcY, srcW, srcH, dstX, dstY, dstW, dstH) {
        this.prerender();
        this._context.drawImage(image, srcX, srcY, srcW, srcH, dstX, dstY, dstW, dstH);
    };
    CanvasSurfaceContext.prototype.fillRect = function (x, y, width, height) {
        this.prerender();
        this._context.fillRect(x, y, width, height);
    };
    CanvasSurfaceContext.prototype.fillText = function (text, x, y, maxWidth) {
        this.prerender();
        this._context.fillText(text, x, y, maxWidth);
    };
    CanvasSurfaceContext.prototype.strokeText = function (text, x, y, maxWidth) {
        this.prerender();
        this._context.strokeText(text, x, y, maxWidth);
    };
    CanvasSurfaceContext.prototype.translate = function (x, y) {
        this.currentState().transformer.translate(x, y);
        this._modifiedTransform = true;
    };
    CanvasSurfaceContext.prototype.transform = function (m11, m12, m21, m22, dx, dy) {
        this.currentState().transformer.transform([m11, m12, m21, m22, dx, dy]);
        this._modifiedTransform = true;
    };
    CanvasSurfaceContext.prototype.setTransform = function (m11, m12, m21, m22, dx, dy) {
        this.currentState().transformer.setTransform([m11, m12, m21, m22, dx, dy]);
        this._modifiedTransform = true;
    };
    CanvasSurfaceContext.prototype.setGlobalAlpha = function (globalAlpha) {
        this.currentState().globalAlpha = globalAlpha;
    };
    CanvasSurfaceContext.prototype.getImageData = function (sx, sy, sw, sh) {
        return this._context.getImageData(sx, sy, sw, sh);
    };
    CanvasSurfaceContext.prototype.putImageData = function (imagedata, dx, dy, dirtyX, dirtyY, dirtyWidth, dirtyHeight) {
        this._context.putImageData(imagedata, dx, dy, dirtyX, dirtyY, dirtyWidth, dirtyHeight);
    };
    CanvasSurfaceContext.prototype.prerender = function () {
        var currentState = this.currentState();
        if (currentState.fillStyle !== this._currentFillStyle) {
            this._context.fillStyle = currentState.fillStyle;
            this._currentFillStyle = currentState.fillStyle;
        }
        if (currentState.globalAlpha !== this._currentGlobalAlpha) {
            this._context.globalAlpha = currentState.globalAlpha;
            this._currentGlobalAlpha = currentState.globalAlpha;
        }
        if (currentState.globalCompositeOperation !== this._currentGlobalCompositeOperation) {
            this._context.globalCompositeOperation = currentState.globalCompositeOperation;
            this._currentGlobalCompositeOperation = currentState.globalCompositeOperation;
        }
        if (this._modifiedTransform) {
            var transformer = currentState.transformer;
            this._context.setTransform(transformer.matrix[0], transformer.matrix[1], transformer.matrix[2], transformer.matrix[3], transformer.matrix[4], transformer.matrix[5]);
            this._modifiedTransform = false;
        }
    };
    CanvasSurfaceContext.prototype.pushState = function (state) {
        this._stateStack.push(state);
    };
    CanvasSurfaceContext.prototype.popState = function () {
        if (this._stateStack.length <= 1) {
            return;
        }
        this._stateStack.pop();
        this._modifiedTransform = true;
    };
    CanvasSurfaceContext.prototype.currentState = function () {
        return this._stateStack[this._stateStack.length - 1];
    };
    return CanvasSurfaceContext;
}());
exports.CanvasSurfaceContext = CanvasSurfaceContext;

},{"./CanvasRenderingState":44}],46:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Context2DRenderer = void 0;
var g = require("@akashic/akashic-engine");
var Context2DRenderer = /** @class */ (function (_super) {
    __extends(Context2DRenderer, _super);
    function Context2DRenderer(surface) {
        var _this = _super.call(this) || this;
        _this.surface = surface;
        _this.context = surface.context();
        _this.canvasRenderingContext2D = _this.context.getCanvasRenderingContext2D();
        return _this;
    }
    Context2DRenderer.prototype.begin = function () {
        _super.prototype.begin.call(this);
        this.canvasRenderingContext2D.save();
        this.context.save();
    };
    Context2DRenderer.prototype.end = function () {
        this.canvasRenderingContext2D.restore();
        this.context.restore();
        _super.prototype.end.call(this);
    };
    Context2DRenderer.prototype.clear = function () {
        this.context.clearRect(0, 0, this.surface.width, this.surface.height);
    };
    Context2DRenderer.prototype.drawImage = function (surface, offsetX, offsetY, width, height, canvasOffsetX, canvasOffsetY) {
        this.context.drawImage(surface._drawable, offsetX, offsetY, width, height, canvasOffsetX, canvasOffsetY, width, height);
    };
    Context2DRenderer.prototype.drawSprites = function (surface, offsetX, offsetY, width, height, canvasOffsetX, canvasOffsetY, count) {
        for (var i = 0; i < count; ++i) {
            this.drawImage(surface, offsetX[i], offsetY[i], width[i], height[i], canvasOffsetX[i], canvasOffsetY[i]);
        }
    };
    Context2DRenderer.prototype.drawSystemText = function (text, x, y, maxWidth, fontSize, textAlign, textBaseline, textColor, fontFamily, strokeWidth, strokeColor, strokeOnly) {
        var context = this.canvasRenderingContext2D;
        var fontFamilyValue;
        var textAlignValue;
        var textBaselineValue;
        this.context.prerender();
        context.save();
        switch (fontFamily) {
            case g.FontFamily.Monospace:
                fontFamilyValue = "monospace";
                break;
            case g.FontFamily.Serif:
                fontFamilyValue = "serif";
                break;
            default:
                fontFamilyValue = "sans-serif";
                break;
        }
        context.font = fontSize + "px " + fontFamilyValue;
        switch (textAlign) {
            case g.TextAlign.Right:
                textAlignValue = "right";
                break;
            case g.TextAlign.Center:
                textAlignValue = "center";
                break;
            default:
                textAlignValue = "left";
                break;
        }
        context.textAlign = textAlignValue;
        switch (textBaseline) {
            case g.TextBaseline.Top:
                textBaselineValue = "top";
                break;
            case g.TextBaseline.Middle:
                textBaselineValue = "middle";
                break;
            case g.TextBaseline.Bottom:
                textBaselineValue = "bottom";
                break;
            default:
                textBaselineValue = "alphabetic";
                break;
        }
        context.textBaseline = textBaselineValue;
        context.lineJoin = "bevel";
        if (strokeWidth > 0) {
            context.lineWidth = strokeWidth;
            context.strokeStyle = strokeColor;
            if (typeof maxWidth === "undefined") {
                context.strokeText(text, x, y);
            }
            else {
                context.strokeText(text, x, y, maxWidth);
            }
        }
        if (!strokeOnly) {
            context.fillStyle = textColor;
            context.fillText(text, x, y, maxWidth);
        }
        context.restore();
    };
    Context2DRenderer.prototype.translate = function (x, y) {
        this.context.translate(x, y);
    };
    Context2DRenderer.prototype.transform = function (matrix) {
        this.context.transform(matrix[0], matrix[1], matrix[2], matrix[3], matrix[4], matrix[5]);
    };
    Context2DRenderer.prototype.opacity = function (opacity) {
        // Note:globalAlphaの初期値が1であることは仕様上保証されているため、常に掛け合わせる
        this.context.globalAlpha *= opacity;
    };
    Context2DRenderer.prototype.save = function () {
        this.context.save();
    };
    Context2DRenderer.prototype.restore = function () {
        this.context.restore();
    };
    Context2DRenderer.prototype.fillRect = function (x, y, width, height, cssColor) {
        this.context.fillStyle = cssColor;
        this.context.fillRect(x, y, width, height);
    };
    Context2DRenderer.prototype.setCompositeOperation = function (operation) {
        var operationText;
        switch (operation) {
            case g.CompositeOperation.SourceAtop:
                operationText = "source-atop";
                break;
            case g.CompositeOperation.Lighter:
                operationText = "lighter";
                break;
            case g.CompositeOperation.Copy:
                operationText = "copy";
                break;
            case g.CompositeOperation.ExperimentalSourceIn:
                operationText = "source-in";
                break;
            case g.CompositeOperation.ExperimentalSourceOut:
                operationText = "source-out";
                break;
            case g.CompositeOperation.ExperimentalDestinationAtop:
                operationText = "destination-atop";
                break;
            case g.CompositeOperation.ExperimentalDestinationIn:
                operationText = "destination-in";
                break;
            case g.CompositeOperation.DestinationOut:
                operationText = "destination-out";
                break;
            case g.CompositeOperation.DestinationOver:
                operationText = "destination-over";
                break;
            case g.CompositeOperation.Xor:
                operationText = "xor";
                break;
            default:
                operationText = "source-over";
                break;
        }
        this.context.globalCompositeOperation = operationText;
    };
    Context2DRenderer.prototype.setOpacity = function (opacity) {
        this.context.globalAlpha = opacity;
    };
    Context2DRenderer.prototype.setTransform = function (matrix) {
        this.context.setTransform(matrix[0], matrix[1], matrix[2], matrix[3], matrix[4], matrix[5]);
    };
    Context2DRenderer.prototype.setShaderProgram = function (shaderProgram) {
        throw g.ExceptionFactory.createAssertionError("Context2DRenderer#setShaderProgram() is not implemented");
    };
    Context2DRenderer.prototype.isSupportedShaderProgram = function () {
        return false;
    };
    Context2DRenderer.prototype._getImageData = function (sx, sy, sw, sh) {
        return this.context.getImageData(sx, sy, sw, sh);
    };
    Context2DRenderer.prototype._putImageData = function (imageData, dx, dy, dirtyX, dirtyY, dirtyWidth, dirtyHeight) {
        if (dirtyX === void 0) { dirtyX = 0; }
        if (dirtyY === void 0) { dirtyY = 0; }
        if (dirtyWidth === void 0) { dirtyWidth = imageData.width; }
        if (dirtyHeight === void 0) { dirtyHeight = imageData.height; }
        this.context.putImageData(imageData, dx, dy, dirtyX, dirtyY, dirtyWidth, dirtyHeight);
    };
    return Context2DRenderer;
}(g.Renderer));
exports.Context2DRenderer = Context2DRenderer;

},{"@akashic/akashic-engine":1}],47:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Context2DSurface = void 0;
var Context2DRenderer_1 = require("./Context2DRenderer");
var CanvasSurfaceContext_1 = require("./CanvasSurfaceContext");
var CanvasSurface_1 = require("../CanvasSurface");
var Context2DSurface = /** @class */ (function (_super) {
    __extends(Context2DSurface, _super);
    function Context2DSurface() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Context2DSurface.prototype.context = function () {
        if (!this._context) {
            this._context = new CanvasSurfaceContext_1.CanvasSurfaceContext(this.canvas.getContext("2d"));
        }
        return this._context;
    };
    Context2DSurface.prototype.renderer = function () {
        if (!this._renderer) {
            this._renderer = new Context2DRenderer_1.Context2DRenderer(this);
        }
        return this._renderer;
    };
    Context2DSurface.prototype.changePhysicalScale = function (xScale, yScale) {
        this.canvas.width = this.width * xScale;
        this.canvas.height = this.height * yScale;
        this._context.scale(xScale, yScale);
    };
    Context2DSurface.prototype.isPlaying = function () {
        return false;
    };
    return Context2DSurface;
}(CanvasSurface_1.CanvasSurface));
exports.Context2DSurface = Context2DSurface;

},{"../CanvasSurface":41,"./CanvasSurfaceContext":45,"./Context2DRenderer":46}],48:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SurfaceFactory = void 0;
var RenderingHelper_1 = require("../RenderingHelper");
var Context2DSurface_1 = require("../context2d/Context2DSurface");
var WebGLSharedObject_1 = require("../webgl/WebGLSharedObject");
var SurfaceFactory = /** @class */ (function () {
    function SurfaceFactory() {
    }
    SurfaceFactory.prototype.createPrimarySurface = function (width, height, rendererCandidates) {
        if (RenderingHelper_1.RenderingHelper.usedWebGL(rendererCandidates)) {
            if (!this._shared) {
                this._shared = new WebGLSharedObject_1.WebGLSharedObject(width, height);
            }
            return this._shared.getPrimarySurface();
        }
        else {
            return new Context2DSurface_1.Context2DSurface(width, height);
        }
    };
    SurfaceFactory.prototype.createBackSurface = function (width, height, rendererCandidates) {
        if (RenderingHelper_1.RenderingHelper.usedWebGL(rendererCandidates)) {
            return this._shared.createBackSurface(width, height);
        }
        else {
            return new Context2DSurface_1.Context2DSurface(width, height);
        }
    };
    return SurfaceFactory;
}());
exports.SurfaceFactory = SurfaceFactory;

},{"../RenderingHelper":43,"../context2d/Context2DSurface":47,"../webgl/WebGLSharedObject":57}],49:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebGLBackSurface = void 0;
var WebGLBackSurfaceRenderer_1 = require("./WebGLBackSurfaceRenderer");
var WebGLPrimarySurface_1 = require("./WebGLPrimarySurface");
var WebGLBackSurface = /** @class */ (function (_super) {
    __extends(WebGLBackSurface, _super);
    function WebGLBackSurface() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    // override
    WebGLBackSurface.prototype.renderer = function () {
        if (!this._renderer) {
            this._renderer = new WebGLBackSurfaceRenderer_1.WebGLBackSurfaceRenderer(this, this._shared);
        }
        return this._renderer;
    };
    WebGLBackSurface.prototype.destroy = function () {
        if (this._renderer) {
            this._renderer.destroy();
        }
        this._renderer = undefined;
        this._drawable = undefined;
        _super.prototype.destroy.call(this);
    };
    return WebGLBackSurface;
}(WebGLPrimarySurface_1.WebGLPrimarySurface));
exports.WebGLBackSurface = WebGLBackSurface;

},{"./WebGLBackSurfaceRenderer":50,"./WebGLPrimarySurface":52}],50:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebGLBackSurfaceRenderer = void 0;
var WebGLRenderer_1 = require("./WebGLRenderer");
var WebGLRenderingState_1 = require("./WebGLRenderingState");
var WebGLBackSurfaceRenderer = /** @class */ (function (_super) {
    __extends(WebGLBackSurfaceRenderer, _super);
    function WebGLBackSurfaceRenderer(surface, shared) {
        var _this = _super.call(this, shared, shared.createRenderTarget(surface.width, surface.height)) || this;
        surface._drawable = {
            texture: _this._renderTarget.texture,
            textureOffsetX: 0,
            textureOffsetY: 0,
            textureWidth: surface.width,
            textureHeight: surface.height
        };
        return _this;
    }
    WebGLBackSurfaceRenderer.prototype.begin = function () {
        _super.prototype.begin.call(this);
        // Canvas座標系とWebGL座標系の相互変換
        // height は描画対象の高さを与える
        this.save();
        var rs = new WebGLRenderingState_1.WebGLRenderingState(this.currentState());
        var matrix = rs.transformer.matrix;
        matrix[1] *= -1;
        matrix[3] *= -1;
        matrix[5] = -matrix[5] + this._renderTarget.height;
        this.currentState().copyFrom(rs);
        this._shared.pushRenderTarget(this._renderTarget);
    };
    WebGLBackSurfaceRenderer.prototype.end = function () {
        this.restore();
        this._shared.popRenderTarget();
        _super.prototype.end.call(this);
    };
    return WebGLBackSurfaceRenderer;
}(WebGLRenderer_1.WebGLRenderer));
exports.WebGLBackSurfaceRenderer = WebGLBackSurfaceRenderer;

},{"./WebGLRenderer":54,"./WebGLRenderingState":55}],51:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebGLColor = void 0;
var RenderingHelper_1 = require("../RenderingHelper");
var WebGLColor;
(function (WebGLColor) {
    WebGLColor.colorMap = {
        "ALICEBLUE": [0xF0 / 255.0, 0xF8 / 255.0, 0xFF / 255.0, 1.0],
        "ANTIQUEWHITE": [0xFA / 255.0, 0xEB / 255.0, 0xD7 / 255.0, 1.0],
        "AQUA": [0x00 / 255.0, 0xFF / 255.0, 0xFF / 255.0, 1.0],
        "AQUAMARINE": [0x7F / 255.0, 0xFF / 255.0, 0xD4 / 255.0, 1.0],
        "AZURE": [0xF0 / 255.0, 0xFF / 255.0, 0xFF / 255.0, 1.0],
        "BEIGE": [0xF5 / 255.0, 0xF5 / 255.0, 0xDC / 255.0, 1.0],
        "BISQUE": [0xFF / 255.0, 0xE4 / 255.0, 0xC4 / 255.0, 1.0],
        "BLACK": [0x00 / 255.0, 0x00 / 255.0, 0x00 / 255.0, 1.0],
        "BLANCHEDALMOND": [0xFF / 255.0, 0xEB / 255.0, 0xCD / 255.0, 1.0],
        "BLUE": [0x00 / 255.0, 0x00 / 255.0, 0xFF / 255.0, 1.0],
        "BLUEVIOLET": [0x8A / 255.0, 0x2B / 255.0, 0xE2 / 255.0, 1.0],
        "BROWN": [0xA5 / 255.0, 0x2A / 255.0, 0x2A / 255.0, 1.0],
        "BURLYWOOD": [0xDE / 255.0, 0xB8 / 255.0, 0x87 / 255.0, 1.0],
        "CADETBLUE": [0x5F / 255.0, 0x9E / 255.0, 0xA0 / 255.0, 1.0],
        "CHARTREUSE": [0x7F / 255.0, 0xFF / 255.0, 0x00 / 255.0, 1.0],
        "CHOCOLATE": [0xD2 / 255.0, 0x69 / 255.0, 0x1E / 255.0, 1.0],
        "CORAL": [0xFF / 255.0, 0x7F / 255.0, 0x50 / 255.0, 1.0],
        "CORNFLOWERBLUE": [0x64 / 255.0, 0x95 / 255.0, 0xED / 255.0, 1.0],
        "CORNSILK": [0xFF / 255.0, 0xF8 / 255.0, 0xDC / 255.0, 1.0],
        "CRIMSON": [0xDC / 255.0, 0x14 / 255.0, 0x3C / 255.0, 1.0],
        "CYAN": [0x00 / 255.0, 0xFF / 255.0, 0xFF / 255.0, 1.0],
        "DARKBLUE": [0x00 / 255.0, 0x00 / 255.0, 0x8B / 255.0, 1.0],
        "DARKCYAN": [0x00 / 255.0, 0x8B / 255.0, 0x8B / 255.0, 1.0],
        "DARKGOLDENROD": [0xB8 / 255.0, 0x86 / 255.0, 0x0B / 255.0, 1.0],
        "DARKGRAY": [0xA9 / 255.0, 0xA9 / 255.0, 0xA9 / 255.0, 1.0],
        "DARKGREEN": [0x00 / 255.0, 0x64 / 255.0, 0x00 / 255.0, 1.0],
        "DARKGREY": [0xA9 / 255.0, 0xA9 / 255.0, 0xA9 / 255.0, 1.0],
        "DARKKHAKI": [0xBD / 255.0, 0xB7 / 255.0, 0x6B / 255.0, 1.0],
        "DARKMAGENTA": [0x8B / 255.0, 0x00 / 255.0, 0x8B / 255.0, 1.0],
        "DARKOLIVEGREEN": [0x55 / 255.0, 0x6B / 255.0, 0x2F / 255.0, 1.0],
        "DARKORANGE": [0xFF / 255.0, 0x8C / 255.0, 0x00 / 255.0, 1.0],
        "DARKORCHID": [0x99 / 255.0, 0x32 / 255.0, 0xCC / 255.0, 1.0],
        "DARKRED": [0x8B / 255.0, 0x00 / 255.0, 0x00 / 255.0, 1.0],
        "DARKSALMON": [0xE9 / 255.0, 0x96 / 255.0, 0x7A / 255.0, 1.0],
        "DARKSEAGREEN": [0x8F / 255.0, 0xBC / 255.0, 0x8F / 255.0, 1.0],
        "DARKSLATEBLUE": [0x48 / 255.0, 0x3D / 255.0, 0x8B / 255.0, 1.0],
        "DARKSLATEGRAY": [0x2F / 255.0, 0x4F / 255.0, 0x4F / 255.0, 1.0],
        "DARKSLATEGREY": [0x2F / 255.0, 0x4F / 255.0, 0x4F / 255.0, 1.0],
        "DARKTURQUOISE": [0x00 / 255.0, 0xCE / 255.0, 0xD1 / 255.0, 1.0],
        "DARKVIOLET": [0x94 / 255.0, 0x00 / 255.0, 0xD3 / 255.0, 1.0],
        "DEEPPINK": [0xFF / 255.0, 0x14 / 255.0, 0x93 / 255.0, 1.0],
        "DEEPSKYBLUE": [0x00 / 255.0, 0xBF / 255.0, 0xFF / 255.0, 1.0],
        "DIMGRAY": [0x69 / 255.0, 0x69 / 255.0, 0x69 / 255.0, 1.0],
        "DIMGREY": [0x69 / 255.0, 0x69 / 255.0, 0x69 / 255.0, 1.0],
        "DODGERBLUE": [0x1E / 255.0, 0x90 / 255.0, 0xFF / 255.0, 1.0],
        "FIREBRICK": [0xB2 / 255.0, 0x22 / 255.0, 0x22 / 255.0, 1.0],
        "FLORALWHITE": [0xFF / 255.0, 0xFA / 255.0, 0xF0 / 255.0, 1.0],
        "FORESTGREEN": [0x22 / 255.0, 0x8B / 255.0, 0x22 / 255.0, 1.0],
        "FUCHSIA": [0xFF / 255.0, 0x00 / 255.0, 0xFF / 255.0, 1.0],
        "GAINSBORO": [0xDC / 255.0, 0xDC / 255.0, 0xDC / 255.0, 1.0],
        "GHOSTWHITE": [0xF8 / 255.0, 0xF8 / 255.0, 0xFF / 255.0, 1.0],
        "GOLD": [0xFF / 255.0, 0xD7 / 255.0, 0x00 / 255.0, 1.0],
        "GOLDENROD": [0xDA / 255.0, 0xA5 / 255.0, 0x20 / 255.0, 1.0],
        "GRAY": [0x80 / 255.0, 0x80 / 255.0, 0x80 / 255.0, 1.0],
        "GREEN": [0x00 / 255.0, 0x80 / 255.0, 0x00 / 255.0, 1.0],
        "GREENYELLOW": [0xAD / 255.0, 0xFF / 255.0, 0x2F / 255.0, 1.0],
        "GREY": [0x80 / 255.0, 0x80 / 255.0, 0x80 / 255.0, 1.0],
        "HONEYDEW": [0xF0 / 255.0, 0xFF / 255.0, 0xF0 / 255.0, 1.0],
        "HOTPINK": [0xFF / 255.0, 0x69 / 255.0, 0xB4 / 255.0, 1.0],
        "INDIANRED": [0xCD / 255.0, 0x5C / 255.0, 0x5C / 255.0, 1.0],
        "INDIGO": [0x4B / 255.0, 0x00 / 255.0, 0x82 / 255.0, 1.0],
        "IVORY": [0xFF / 255.0, 0xFF / 255.0, 0xF0 / 255.0, 1.0],
        "KHAKI": [0xF0 / 255.0, 0xE6 / 255.0, 0x8C / 255.0, 1.0],
        "LAVENDER": [0xE6 / 255.0, 0xE6 / 255.0, 0xFA / 255.0, 1.0],
        "LAVENDERBLUSH": [0xFF / 255.0, 0xF0 / 255.0, 0xF5 / 255.0, 1.0],
        "LAWNGREEN": [0x7C / 255.0, 0xFC / 255.0, 0x00 / 255.0, 1.0],
        "LEMONCHIFFON": [0xFF / 255.0, 0xFA / 255.0, 0xCD / 255.0, 1.0],
        "LIGHTBLUE": [0xAD / 255.0, 0xD8 / 255.0, 0xE6 / 255.0, 1.0],
        "LIGHTCORAL": [0xF0 / 255.0, 0x80 / 255.0, 0x80 / 255.0, 1.0],
        "LIGHTCYAN": [0xE0 / 255.0, 0xFF / 255.0, 0xFF / 255.0, 1.0],
        "LIGHTGOLDENRODYELLOW": [0xFA / 255.0, 0xFA / 255.0, 0xD2 / 255.0, 1.0],
        "LIGHTGRAY": [0xD3 / 255.0, 0xD3 / 255.0, 0xD3 / 255.0, 1.0],
        "LIGHTGREEN": [0x90 / 255.0, 0xEE / 255.0, 0x90 / 255.0, 1.0],
        "LIGHTGREY": [0xD3 / 255.0, 0xD3 / 255.0, 0xD3 / 255.0, 1.0],
        "LIGHTPINK": [0xFF / 255.0, 0xB6 / 255.0, 0xC1 / 255.0, 1.0],
        "LIGHTSALMON": [0xFF / 255.0, 0xA0 / 255.0, 0x7A / 255.0, 1.0],
        "LIGHTSEAGREEN": [0x20 / 255.0, 0xB2 / 255.0, 0xAA / 255.0, 1.0],
        "LIGHTSKYBLUE": [0x87 / 255.0, 0xCE / 255.0, 0xFA / 255.0, 1.0],
        "LIGHTSLATEGRAY": [0x77 / 255.0, 0x88 / 255.0, 0x99 / 255.0, 1.0],
        "LIGHTSLATEGREY": [0x77 / 255.0, 0x88 / 255.0, 0x99 / 255.0, 1.0],
        "LIGHTSTEELBLUE": [0xB0 / 255.0, 0xC4 / 255.0, 0xDE / 255.0, 1.0],
        "LIGHTYELLOW": [0xFF / 255.0, 0xFF / 255.0, 0xE0 / 255.0, 1.0],
        "LIME": [0x00 / 255.0, 0xFF / 255.0, 0x00 / 255.0, 1.0],
        "LIMEGREEN": [0x32 / 255.0, 0xCD / 255.0, 0x32 / 255.0, 1.0],
        "LINEN": [0xFA / 255.0, 0xF0 / 255.0, 0xE6 / 255.0, 1.0],
        "MAGENTA": [0xFF / 255.0, 0x00 / 255.0, 0xFF / 255.0, 1.0],
        "MAROON": [0x80 / 255.0, 0x00 / 255.0, 0x00 / 255.0, 1.0],
        "MEDIUMAQUAMARINE": [0x66 / 255.0, 0xCD / 255.0, 0xAA / 255.0, 1.0],
        "MEDIUMBLUE": [0x00 / 255.0, 0x00 / 255.0, 0xCD / 255.0, 1.0],
        "MEDIUMORCHID": [0xBA / 255.0, 0x55 / 255.0, 0xD3 / 255.0, 1.0],
        "MEDIUMPURPLE": [0x93 / 255.0, 0x70 / 255.0, 0xDB / 255.0, 1.0],
        "MEDIUMSEAGREEN": [0x3C / 255.0, 0xB3 / 255.0, 0x71 / 255.0, 1.0],
        "MEDIUMSLATEBLUE": [0x7B / 255.0, 0x68 / 255.0, 0xEE / 255.0, 1.0],
        "MEDIUMSPRINGGREEN": [0x00 / 255.0, 0xFA / 255.0, 0x9A / 255.0, 1.0],
        "MEDIUMTURQUOISE": [0x48 / 255.0, 0xD1 / 255.0, 0xCC / 255.0, 1.0],
        "MEDIUMVIOLETRED": [0xC7 / 255.0, 0x15 / 255.0, 0x85 / 255.0, 1.0],
        "MIDNIGHTBLUE": [0x19 / 255.0, 0x19 / 255.0, 0x70 / 255.0, 1.0],
        "MINTCREAM": [0xF5 / 255.0, 0xFF / 255.0, 0xFA / 255.0, 1.0],
        "MISTYROSE": [0xFF / 255.0, 0xE4 / 255.0, 0xE1 / 255.0, 1.0],
        "MOCCASIN": [0xFF / 255.0, 0xE4 / 255.0, 0xB5 / 255.0, 1.0],
        "NAVAJOWHITE": [0xFF / 255.0, 0xDE / 255.0, 0xAD / 255.0, 1.0],
        "NAVY": [0x00 / 255.0, 0x00 / 255.0, 0x80 / 255.0, 1.0],
        "OLDLACE": [0xFD / 255.0, 0xF5 / 255.0, 0xE6 / 255.0, 1.0],
        "OLIVE": [0x80 / 255.0, 0x80 / 255.0, 0x00 / 255.0, 1.0],
        "OLIVEDRAB": [0x6B / 255.0, 0x8E / 255.0, 0x23 / 255.0, 1.0],
        "ORANGE": [0xFF / 255.0, 0xA5 / 255.0, 0x00 / 255.0, 1.0],
        "ORANGERED": [0xFF / 255.0, 0x45 / 255.0, 0x00 / 255.0, 1.0],
        "ORCHID": [0xDA / 255.0, 0x70 / 255.0, 0xD6 / 255.0, 1.0],
        "PALEGOLDENROD": [0xEE / 255.0, 0xE8 / 255.0, 0xAA / 255.0, 1.0],
        "PALEGREEN": [0x98 / 255.0, 0xFB / 255.0, 0x98 / 255.0, 1.0],
        "PALETURQUOISE": [0xAF / 255.0, 0xEE / 255.0, 0xEE / 255.0, 1.0],
        "PALEVIOLETRED": [0xDB / 255.0, 0x70 / 255.0, 0x93 / 255.0, 1.0],
        "PAPAYAWHIP": [0xFF / 255.0, 0xEF / 255.0, 0xD5 / 255.0, 1.0],
        "PEACHPUFF": [0xFF / 255.0, 0xDA / 255.0, 0xB9 / 255.0, 1.0],
        "PERU": [0xCD / 255.0, 0x85 / 255.0, 0x3F / 255.0, 1.0],
        "PINK": [0xFF / 255.0, 0xC0 / 255.0, 0xCB / 255.0, 1.0],
        "PLUM": [0xDD / 255.0, 0xA0 / 255.0, 0xDD / 255.0, 1.0],
        "POWDERBLUE": [0xB0 / 255.0, 0xE0 / 255.0, 0xE6 / 255.0, 1.0],
        "PURPLE": [0x80 / 255.0, 0x00 / 255.0, 0x80 / 255.0, 1.0],
        "RED": [0xFF / 255.0, 0x00 / 255.0, 0x00 / 255.0, 1.0],
        "ROSYBROWN": [0xBC / 255.0, 0x8F / 255.0, 0x8F / 255.0, 1.0],
        "ROYALBLUE": [0x41 / 255.0, 0x69 / 255.0, 0xE1 / 255.0, 1.0],
        "SADDLEBROWN": [0x8B / 255.0, 0x45 / 255.0, 0x13 / 255.0, 1.0],
        "SALMON": [0xFA / 255.0, 0x80 / 255.0, 0x72 / 255.0, 1.0],
        "SANDYBROWN": [0xF4 / 255.0, 0xA4 / 255.0, 0x60 / 255.0, 1.0],
        "SEAGREEN": [0x2E / 255.0, 0x8B / 255.0, 0x57 / 255.0, 1.0],
        "SEASHELL": [0xFF / 255.0, 0xF5 / 255.0, 0xEE / 255.0, 1.0],
        "SIENNA": [0xA0 / 255.0, 0x52 / 255.0, 0x2D / 255.0, 1.0],
        "SILVER": [0xC0 / 255.0, 0xC0 / 255.0, 0xC0 / 255.0, 1.0],
        "SKYBLUE": [0x87 / 255.0, 0xCE / 255.0, 0xEB / 255.0, 1.0],
        "SLATEBLUE": [0x6A / 255.0, 0x5A / 255.0, 0xCD / 255.0, 1.0],
        "SLATEGRAY": [0x70 / 255.0, 0x80 / 255.0, 0x90 / 255.0, 1.0],
        "SLATEGREY": [0x70 / 255.0, 0x80 / 255.0, 0x90 / 255.0, 1.0],
        "SNOW": [0xFF / 255.0, 0xFA / 255.0, 0xFA / 255.0, 1.0],
        "SPRINGGREEN": [0x00 / 255.0, 0xFF / 255.0, 0x7F / 255.0, 1.0],
        "STEELBLUE": [0x46 / 255.0, 0x82 / 255.0, 0xB4 / 255.0, 1.0],
        "TAN": [0xD2 / 255.0, 0xB4 / 255.0, 0x8C / 255.0, 1.0],
        "TEAL": [0x00 / 255.0, 0x80 / 255.0, 0x80 / 255.0, 1.0],
        "THISTLE": [0xD8 / 255.0, 0xBF / 255.0, 0xD8 / 255.0, 1.0],
        "TOMATO": [0xFF / 255.0, 0x63 / 255.0, 0x47 / 255.0, 1.0],
        "TURQUOISE": [0x40 / 255.0, 0xE0 / 255.0, 0xD0 / 255.0, 1.0],
        "VIOLET": [0xEE / 255.0, 0x82 / 255.0, 0xEE / 255.0, 1.0],
        "WHEAT": [0xF5 / 255.0, 0xDE / 255.0, 0xB3 / 255.0, 1.0],
        "WHITE": [0xFF / 255.0, 0xFF / 255.0, 0xFF / 255.0, 1.0],
        "WHITESMOKE": [0xF5 / 255.0, 0xF5 / 255.0, 0xF5 / 255.0, 1.0],
        "YELLOW": [0xFF / 255.0, 0xFF / 255.0, 0x00 / 255.0, 1.0],
        "YELLOWGREEN": [0x9A / 255.0, 0xCD / 255.0, 0x32 / 255.0, 1.0]
    };
    function get(color) {
        var rgba = (typeof color === "string") ? WebGLColor._toColor(color) : [color[0], color[1], color[2], color[3]];
        rgba[3] = RenderingHelper_1.RenderingHelper.clamp(rgba[3]);
        rgba[0] = RenderingHelper_1.RenderingHelper.clamp(rgba[0]) * rgba[3];
        rgba[1] = RenderingHelper_1.RenderingHelper.clamp(rgba[1]) * rgba[3];
        rgba[2] = RenderingHelper_1.RenderingHelper.clamp(rgba[2]) * rgba[3];
        return rgba;
    }
    WebGLColor.get = get;
    function _hsl2rgb(hsl) {
        var h = hsl[0] % 360;
        var s = hsl[1];
        var l = (hsl[2] > 50) ? 100 - hsl[2] : hsl[2];
        var a = hsl[3];
        var max = l + l * s;
        var min = l - l * s;
        if (h < 60) {
            return [max, (h / 60.0) * (max - min) + min, min, a];
        }
        else if (h < 120) {
            return [((120 - h) / 60.0) * (max - min) + min, max, min, a];
        }
        else if (h < 180) {
            return [min, max, ((h - 120) / 60.0) * (max - min) + min, a];
        }
        else if (h < 240) {
            return [min, ((240 - h) / 60.0) * (max - min) + min, max, a];
        }
        else if (h < 300) {
            return [((h - 240) / 60.0) * (max - min) + min, min, max, a];
        }
        else {
            return [max, min, ((360 - h) / 60.0) * (max - min) + min, a];
        }
    }
    WebGLColor._hsl2rgb = _hsl2rgb;
    function _toColor(cssColor) {
        // 大文字化して空白を削除 (ncc: normalized css color)
        var ncc = cssColor.toUpperCase().replace(/\s+/g, "");
        var rgba = WebGLColor.colorMap[ncc];
        if (rgba) {
            return rgba;
        }
        if (ncc.match(/^#([\dA-F])([\dA-F])([\dA-F])$/)) {
            return [
                parseInt(RegExp.$1, 16) / 15.0,
                parseInt(RegExp.$2, 16) / 15.0,
                parseInt(RegExp.$3, 16) / 15.0, 1.0
            ];
        }
        else if (ncc.match(/^#([\dA-F]{2})([\dA-F]{2})([\dA-F]{2})$/)) {
            return [
                parseInt(RegExp.$1, 16) / 255.0,
                parseInt(RegExp.$2, 16) / 255.0,
                parseInt(RegExp.$3, 16) / 255.0, 1.0
            ];
        }
        else if (ncc.match(/^RGB\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)) {
            return [
                parseInt(RegExp.$1, 10) / 255.0,
                parseInt(RegExp.$2, 10) / 255.0,
                parseInt(RegExp.$3, 10) / 255.0, 1.0
            ];
        }
        else if (ncc.match(/^RGBA\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d*)?)\)$/)) {
            return [
                parseInt(RegExp.$1, 10) / 255.0,
                parseInt(RegExp.$2, 10) / 255.0,
                parseInt(RegExp.$3, 10) / 255.0,
                parseFloat(RegExp.$4)
            ];
        }
        else if (ncc.match(/^HSL\((\d{1,3}),(\d{1,3})%,(\d{1,3})%\)$/)) {
            return WebGLColor._hsl2rgb([
                parseInt(RegExp.$1, 10),
                RenderingHelper_1.RenderingHelper.clamp(parseInt(RegExp.$2, 10) / 100.0),
                RenderingHelper_1.RenderingHelper.clamp(parseInt(RegExp.$3, 10) / 100.0), 1.0
            ]);
        }
        else if (ncc.match(/^HSLA\((\d{1,3}),(\d{1,3})%,(\d{1,3})%,(\d(\.\d*)?)\)$/)) {
            return WebGLColor._hsl2rgb([
                parseInt(RegExp.$1, 10),
                RenderingHelper_1.RenderingHelper.clamp(parseInt(RegExp.$2, 10) / 100.0),
                RenderingHelper_1.RenderingHelper.clamp(parseInt(RegExp.$3, 10) / 100.0),
                parseFloat(RegExp.$4)
            ]);
        }
        else {
            throw Error("illigal cssColor format: " + ncc);
        }
    }
    WebGLColor._toColor = _toColor;
})(WebGLColor = exports.WebGLColor || (exports.WebGLColor = {}));

},{"../RenderingHelper":43}],52:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebGLPrimarySurface = void 0;
var CanvasSurface_1 = require("../CanvasSurface");
var WebGLPrimarySurfaceRenderer_1 = require("./WebGLPrimarySurfaceRenderer");
var WebGLPrimarySurface = /** @class */ (function (_super) {
    __extends(WebGLPrimarySurface, _super);
    function WebGLPrimarySurface(shared, width, height) {
        var _this = _super.call(this, width, height) || this;
        _this.canvas.style.position = "absolute";
        _this._shared = shared;
        return _this;
    }
    WebGLPrimarySurface.prototype.renderer = function () {
        if (!this._renderer) {
            this._renderer = new WebGLPrimarySurfaceRenderer_1.WebGLPrimarySurfaceRenderer(this._shared, this._shared.getPrimaryRenderTarget(this.width, this.height));
        }
        return this._renderer;
    };
    // override
    WebGLPrimarySurface.prototype.changePhysicalScale = function (xScale, yScale) {
        var width = Math.ceil(this.width * xScale);
        var height = Math.ceil(this.height * yScale);
        this.canvas.width = width;
        this.canvas.height = height;
        this.renderer().changeViewportSize(width, height);
    };
    WebGLPrimarySurface.prototype.isPlaying = function () {
        return false;
    };
    return WebGLPrimarySurface;
}(CanvasSurface_1.CanvasSurface));
exports.WebGLPrimarySurface = WebGLPrimarySurface;

},{"../CanvasSurface":41,"./WebGLPrimarySurfaceRenderer":53}],53:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebGLPrimarySurfaceRenderer = void 0;
var WebGLRenderer_1 = require("./WebGLRenderer");
var WebGLPrimarySurfaceRenderer = /** @class */ (function (_super) {
    __extends(WebGLPrimarySurfaceRenderer, _super);
    function WebGLPrimarySurfaceRenderer(shared, renderTarget) {
        var _this = _super.call(this, shared, renderTarget) || this;
        _this._shared.pushRenderTarget(_this._renderTarget);
        return _this;
    }
    WebGLPrimarySurfaceRenderer.prototype.begin = function () {
        _super.prototype.begin.call(this);
        this._shared.begin();
    };
    return WebGLPrimarySurfaceRenderer;
}(WebGLRenderer_1.WebGLRenderer));
exports.WebGLPrimarySurfaceRenderer = WebGLPrimarySurfaceRenderer;

},{"./WebGLRenderer":54}],54:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebGLRenderer = void 0;
var g = require("@akashic/akashic-engine");
var WebGLColor_1 = require("./WebGLColor");
var WebGLRenderingState_1 = require("./WebGLRenderingState");
var WebGLRenderer = /** @class */ (function (_super) {
    __extends(WebGLRenderer, _super);
    function WebGLRenderer(shared, renderTarget) {
        var _this = _super.call(this) || this;
        _this._stateStack = [];
        _this._stateStackPointer = 0;
        _this._capacity = 0;
        _this._reallocation(WebGLRenderer.DEFAULT_CAPACITY);
        _this._whiteColor = [1.0, 1.0, 1.0, 1.0];
        _this._shared = shared;
        _this._renderTarget = renderTarget;
        return _this;
    }
    WebGLRenderer.prototype.clear = function () {
        this._shared.clear();
    };
    WebGLRenderer.prototype.end = function () {
        this._shared.end();
    };
    WebGLRenderer.prototype.save = function () {
        this._pushState();
    };
    WebGLRenderer.prototype.restore = function () {
        this._popState();
    };
    WebGLRenderer.prototype.translate = function (x, y) {
        this.currentState().transformer.translate(x, y);
    };
    WebGLRenderer.prototype.transform = function (matrix) {
        this.currentState().transformer.transform(matrix);
    };
    WebGLRenderer.prototype.opacity = function (opacity) {
        this.currentState().globalAlpha *= opacity;
    };
    WebGLRenderer.prototype.setCompositeOperation = function (operation) {
        this.currentState().globalCompositeOperation = operation;
    };
    WebGLRenderer.prototype.currentState = function () {
        return this._stateStack[this._stateStackPointer];
    };
    WebGLRenderer.prototype.fillRect = function (x, y, width, height, cssColor) {
        this._shared.draw(this.currentState(), this._shared.getFillRectSurfaceTexture(), 0, 0, width, height, x, y, WebGLColor_1.WebGLColor.get(cssColor));
    };
    WebGLRenderer.prototype.drawSprites = function (surface, offsetX, offsetY, width, height, canvasOffsetX, canvasOffsetY, count) {
        for (var i = 0; i < count; ++i) {
            this.drawImage(surface, offsetX[i], offsetY[i], width[i], height[i], canvasOffsetX[i], canvasOffsetY[i]);
        }
    };
    WebGLRenderer.prototype.drawImage = function (surface, offsetX, offsetY, width, height, canvasOffsetX, canvasOffsetY) {
        if (!surface._drawable) {
            throw g.ExceptionFactory.createAssertionError("WebGLRenderer#drawImage: no drawable surface.");
        }
        // WebGLTexture でないなら変換する (HTMLVideoElement は対応しない)
        // NOTE: 対象の surface が動画の場合、独立した framebuffer に描画した方がパフォーマンス上優位になり得る
        if (!(surface._drawable.texture instanceof WebGLTexture)) {
            this._shared.makeTextureForSurface(surface);
        }
        if (!surface._drawable.texture) {
            throw g.ExceptionFactory.createAssertionError("WebGLRenderer#drawImage: could not create a texture.");
        }
        this._shared.draw(this.currentState(), surface._drawable, offsetX, offsetY, width, height, canvasOffsetX, canvasOffsetY, this._whiteColor);
    };
    WebGLRenderer.prototype.drawSystemText = function (text, x, y, maxWidth, fontSize, textAlign, textBaseline, textColor, fontFamily, strokeWidth, strokeColor, strokeOnly) {
        // do nothing.
    };
    WebGLRenderer.prototype.setTransform = function (matrix) {
        this.currentState().transformer.setTransform(matrix);
    };
    WebGLRenderer.prototype.setOpacity = function (opacity) {
        this.currentState().globalAlpha = opacity;
    };
    WebGLRenderer.prototype.setShaderProgram = function (shaderProgram) {
        this.currentState().shaderProgram = this._shared.initializeShaderProgram(shaderProgram);
    };
    WebGLRenderer.prototype.isSupportedShaderProgram = function () {
        return true;
    };
    WebGLRenderer.prototype.changeViewportSize = function (width, height) {
        var old = this._renderTarget;
        this._renderTarget = {
            width: old.width,
            height: old.height,
            viewportWidth: width,
            viewportHeight: height,
            texture: old.texture,
            framebuffer: old.framebuffer
        };
    };
    WebGLRenderer.prototype.destroy = function () {
        this._shared.requestDeleteRenderTarget(this._renderTarget);
        this._shared = undefined;
        this._renderTarget = undefined;
        this._whiteColor = undefined;
    };
    WebGLRenderer.prototype._getImageData = function () {
        throw g.ExceptionFactory.createAssertionError("WebGLRenderer#_getImageData() is not implemented");
    };
    WebGLRenderer.prototype._putImageData = function (imageData, dx, dy, dirtyX, dirtyY, dirtyWidth, dirtyHeight) {
        throw g.ExceptionFactory.createAssertionError("WebGLRenderer#_putImageData() is not implemented");
    };
    WebGLRenderer.prototype._pushState = function () {
        var old = this.currentState();
        ++this._stateStackPointer;
        if (this._isOverCapacity()) {
            this._reallocation(this._stateStackPointer + 1);
        }
        this.currentState().copyFrom(old);
    };
    WebGLRenderer.prototype._popState = function () {
        if (this._stateStackPointer > 0) {
            this.currentState().shaderProgram = null;
            --this._stateStackPointer;
        }
        else {
            throw g.ExceptionFactory.createAssertionError("WebGLRenderer#restore: state stack under-flow.");
        }
    };
    WebGLRenderer.prototype._isOverCapacity = function () {
        return this._capacity <= this._stateStackPointer;
    };
    WebGLRenderer.prototype._reallocation = function (newCapacity) {
        // 指数的成長ポリシーの再割当:
        var oldCapacity = this._capacity;
        if (oldCapacity < newCapacity) {
            if (newCapacity < (oldCapacity * 2)) {
                this._capacity *= 2;
            }
            else {
                this._capacity = newCapacity;
            }
            for (var i = oldCapacity; i < this._capacity; ++i) {
                this._stateStack.push(new WebGLRenderingState_1.WebGLRenderingState());
            }
        }
    };
    WebGLRenderer.DEFAULT_CAPACITY = 16;
    return WebGLRenderer;
}(g.Renderer));
exports.WebGLRenderer = WebGLRenderer;

},{"./WebGLColor":51,"./WebGLRenderingState":55,"@akashic/akashic-engine":1}],55:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebGLRenderingState = void 0;
var g = require("@akashic/akashic-engine");
var AffineTransformer_1 = require("../AffineTransformer");
var WebGLRenderingState = /** @class */ (function () {
    function WebGLRenderingState(rhs) {
        if (rhs) {
            this.globalAlpha = rhs.globalAlpha;
            this.globalCompositeOperation = rhs.globalCompositeOperation;
            this.transformer = new AffineTransformer_1.AffineTransformer(rhs.transformer);
            this.shaderProgram = rhs.shaderProgram;
        }
        else {
            this.globalAlpha = 1.0;
            this.globalCompositeOperation = g.CompositeOperation.SourceOver;
            this.transformer = new AffineTransformer_1.AffineTransformer();
            this.shaderProgram = null;
        }
    }
    WebGLRenderingState.prototype.copyFrom = function (rhs) {
        this.globalAlpha = rhs.globalAlpha;
        this.globalCompositeOperation = rhs.globalCompositeOperation;
        this.transformer.copyFrom(rhs.transformer);
        this.shaderProgram = rhs.shaderProgram;
        return this;
    };
    return WebGLRenderingState;
}());
exports.WebGLRenderingState = WebGLRenderingState;

},{"../AffineTransformer":40,"@akashic/akashic-engine":1}],56:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebGLShaderProgram = void 0;
var g = require("@akashic/akashic-engine");
var WebGLShaderProgram = /** @class */ (function () {
    function WebGLShaderProgram(context, fSrc, uniforms) {
        var vSrc = WebGLShaderProgram._DEFAULT_VERTEX_SHADER;
        var fSrc = fSrc || WebGLShaderProgram._DEFAULT_FRAGMENT_SHADER;
        var program = WebGLShaderProgram._makeShaderProgram(context, vSrc, fSrc);
        this.program = program;
        this._context = context;
        this._aVertex = context.getAttribLocation(this.program, "aVertex");
        this._uColor = context.getUniformLocation(this.program, "uColor");
        this._uAlpha = context.getUniformLocation(this.program, "uAlpha");
        this._uSampler = context.getUniformLocation(this.program, "uSampler");
        this._uniforms = uniforms;
        this._uniformCaches = [];
        this._uniformSetterTable = {
            "float": this._uniform1f.bind(this),
            "int": this._uniform1i.bind(this),
            "float_v": this._uniform1fv.bind(this),
            "int_v": this._uniform1iv.bind(this),
            "vec2": this._uniform2fv.bind(this),
            "vec3": this._uniform3fv.bind(this),
            "vec4": this._uniform4fv.bind(this),
            "ivec2": this._uniform2iv.bind(this),
            "ivec3": this._uniform3iv.bind(this),
            "ivec4": this._uniform4iv.bind(this),
            "mat2": this._uniformMatrix2fv.bind(this),
            "mat3": this._uniformMatrix3fv.bind(this),
            "mat4": this._uniformMatrix4fv.bind(this)
        };
    }
    WebGLShaderProgram._makeShader = function (gl, typ, src) {
        var shader = gl.createShader(typ);
        gl.shaderSource(shader, src);
        gl.compileShader(shader);
        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
            var msg = gl.getShaderInfoLog(shader);
            gl.deleteShader(shader);
            throw new Error(msg);
        }
        return shader;
    };
    WebGLShaderProgram._makeShaderProgram = function (gl, vSrc, fSrc) {
        var program = gl.createProgram();
        var vShader = WebGLShaderProgram._makeShader(gl, gl.VERTEX_SHADER, vSrc);
        gl.attachShader(program, vShader);
        gl.deleteShader(vShader);
        var fShader = WebGLShaderProgram._makeShader(gl, gl.FRAGMENT_SHADER, fSrc);
        gl.attachShader(program, fShader);
        gl.deleteShader(fShader);
        gl.linkProgram(program);
        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
            var msg = gl.getProgramInfoLog(program);
            gl.deleteProgram(program);
            throw new Error(msg);
        }
        return program;
    };
    /**
     * シェーダの attribute 変数 aVertex にバッファを登録する。
     * use()/unuse() 間のみで効果がある。
     */
    WebGLShaderProgram.prototype.set_aVertex = function (buffer) {
        this._context.bindBuffer(this._context.ARRAY_BUFFER, buffer);
        this._context.enableVertexAttribArray(this._aVertex);
        this._context.vertexAttribPointer(this._aVertex, 4, this._context.FLOAT, false, 0, 0);
    };
    /**
     * シェーダの uniform 変数 uColor に値を設定する。
     * use()/unuse() 間のみで効果がある。
     */
    WebGLShaderProgram.prototype.set_uColor = function (rgba) {
        this._context.uniform4f(this._uColor, rgba[0], rgba[1], rgba[2], rgba[3]);
    };
    /**
     * シェーダの uniform 変数 uAlpha に値を設定する。
     * use()/unuse() 間のみで効果がある。
     */
    WebGLShaderProgram.prototype.set_uAlpha = function (alpha) {
        this._context.uniform1f(this._uAlpha, alpha);
    };
    /**
     * シェーダの uniform 変数 uSampler にテクスチャステージ番号を設定する。
     * use()/unuse() 間のみで効果がある。
     */
    WebGLShaderProgram.prototype.set_uSampler = function (value) {
        this._context.uniform1i(this._uSampler, value);
    };
    /**
     * ユーザ定義された uniform 値を更新する。
     * use()/unuse() 間のみで効果がある。
     */
    WebGLShaderProgram.prototype.updateUniforms = function () {
        for (var i = 0; i < this._uniformCaches.length; ++i) {
            var cache = this._uniformCaches[i];
            var value = this._uniforms[cache.name].value;
            if (!cache.isArray && value === cache.beforeValue)
                continue;
            cache.update(cache.loc, value);
            cache.beforeValue = value;
        }
    };
    /**
     * ユーザ定義されたシェーダの uniform 変数を初期化する。
     */
    WebGLShaderProgram.prototype.initializeUniforms = function () {
        var _this = this;
        var uniformCaches = [];
        var uniforms = this._uniforms;
        if (uniforms != null) {
            Object.keys(uniforms).forEach(function (k) {
                var type = uniforms[k].type;
                var isArray = !(typeof uniforms[k].value === "number");
                // typeがfloatまたはintで、valueが配列であれば配列としてuniform値を転送する。
                if (isArray && (type === "int" || type === "float")) {
                    type += "_v";
                }
                var update = _this._uniformSetterTable[type];
                if (!update) {
                    throw g.ExceptionFactory.createAssertionError("WebGLShaderProgram#initializeUniforms: Uniform type '" + type + "' is not supported.");
                }
                uniformCaches.push({
                    name: k,
                    update: update,
                    beforeValue: null,
                    isArray: isArray,
                    loc: _this._context.getUniformLocation(_this.program, k)
                });
            });
        }
        this._uniformCaches = uniformCaches;
    };
    /**
     * シェーダを有効化する。
     */
    WebGLShaderProgram.prototype.use = function () {
        this._context.useProgram(this.program);
    };
    /**
     * シェーダを無効化する。
     */
    WebGLShaderProgram.prototype.unuse = function () {
        this._context.useProgram(null);
    };
    WebGLShaderProgram.prototype.destroy = function () {
        this._context.deleteProgram(this.program);
    };
    WebGLShaderProgram.prototype._uniform1f = function (loc, v) {
        this._context.uniform1f(loc, v);
    };
    WebGLShaderProgram.prototype._uniform1i = function (loc, v) {
        this._context.uniform1i(loc, v);
    };
    WebGLShaderProgram.prototype._uniform1fv = function (loc, v) {
        this._context.uniform1fv(loc, v);
    };
    WebGLShaderProgram.prototype._uniform1iv = function (loc, v) {
        this._context.uniform1iv(loc, v);
    };
    WebGLShaderProgram.prototype._uniform2fv = function (loc, v) {
        this._context.uniform2fv(loc, v);
    };
    WebGLShaderProgram.prototype._uniform3fv = function (loc, v) {
        this._context.uniform3fv(loc, v);
    };
    WebGLShaderProgram.prototype._uniform4fv = function (loc, v) {
        this._context.uniform4fv(loc, v);
    };
    WebGLShaderProgram.prototype._uniform2iv = function (loc, v) {
        this._context.uniform2iv(loc, v);
    };
    WebGLShaderProgram.prototype._uniform3iv = function (loc, v) {
        this._context.uniform3iv(loc, v);
    };
    WebGLShaderProgram.prototype._uniform4iv = function (loc, v) {
        this._context.uniform4iv(loc, v);
    };
    WebGLShaderProgram.prototype._uniformMatrix2fv = function (loc, v) {
        this._context.uniformMatrix2fv(loc, false, v);
    };
    WebGLShaderProgram.prototype._uniformMatrix3fv = function (loc, v) {
        this._context.uniformMatrix3fv(loc, false, v);
    };
    WebGLShaderProgram.prototype._uniformMatrix4fv = function (loc, v) {
        this._context.uniformMatrix4fv(loc, false, v);
    };
    WebGLShaderProgram._DEFAULT_VERTEX_SHADER = "#version 100\n" +
        "precision mediump float;\n" +
        "attribute vec4 aVertex;\n" +
        "varying vec2 vTexCoord;\n" +
        "varying vec4 vColor;\n" +
        "uniform vec4 uColor;\n" +
        "uniform float uAlpha;\n" +
        "void main() {" +
        "    gl_Position = vec4(aVertex.xy, 0.0, 1.0);" +
        "    vTexCoord = aVertex.zw;" +
        "    vColor = uColor * uAlpha;" +
        "}";
    WebGLShaderProgram._DEFAULT_FRAGMENT_SHADER = "#version 100\n" +
        "precision mediump float;\n" +
        "varying vec2 vTexCoord;\n" +
        "varying vec4 vColor;\n" +
        "uniform sampler2D uSampler;\n" +
        "void main() {" +
        "    gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;" +
        "}";
    return WebGLShaderProgram;
}());
exports.WebGLShaderProgram = WebGLShaderProgram;

},{"@akashic/akashic-engine":1}],57:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebGLSharedObject = void 0;
var g = require("@akashic/akashic-engine");
var WebGLShaderProgram_1 = require("./WebGLShaderProgram");
var WebGLTextureAtlas_1 = require("./WebGLTextureAtlas");
var WebGLPrimarySurface_1 = require("./WebGLPrimarySurface");
var WebGLBackSurface_1 = require("./WebGLBackSurface");
var WebGLSharedObject = /** @class */ (function () {
    function WebGLSharedObject(width, height) {
        var surface = new WebGLPrimarySurface_1.WebGLPrimarySurface(this, width, height);
        var context = surface.canvas.getContext("webgl", { depth: false, preserveDrawingBuffer: true });
        if (!context) {
            throw g.ExceptionFactory.createAssertionError("WebGLSharedObject#constructor: could not initialize WebGLRenderingContext");
        }
        this._surface = surface;
        this._context = context;
        this._init();
    }
    WebGLSharedObject.prototype.getFillRectSurfaceTexture = function () {
        return this._fillRectSurfaceTexture;
    };
    WebGLSharedObject.prototype.getPrimarySurface = function () {
        // NOTE: 一つの WebGLSharedObject は一つの primary surface のみを保持するものとする。
        return this._surface;
    };
    WebGLSharedObject.prototype.createBackSurface = function (width, height) {
        return new WebGLBackSurface_1.WebGLBackSurface(this, width, height);
    };
    WebGLSharedObject.prototype.pushRenderTarget = function (renderTarget) {
        this._commit();
        this._renderTargetStack.push(renderTarget);
        this._context.bindFramebuffer(this._context.FRAMEBUFFER, renderTarget.framebuffer);
        this._context.viewport(0, 0, renderTarget.viewportWidth, renderTarget.viewportHeight);
    };
    WebGLSharedObject.prototype.popRenderTarget = function () {
        this._commit();
        this._renderTargetStack.pop();
        var renderTarget = this.getCurrentRenderTarget();
        this._context.bindFramebuffer(this._context.FRAMEBUFFER, renderTarget.framebuffer);
        this._context.viewport(0, 0, renderTarget.viewportWidth, renderTarget.viewportHeight);
    };
    WebGLSharedObject.prototype.getCurrentRenderTarget = function () {
        return this._renderTargetStack[this._renderTargetStack.length - 1];
    };
    WebGLSharedObject.prototype.begin = function () {
        this.clear();
        this._currentShaderProgram.use();
        this._currentShaderProgram.set_aVertex(this._vertices);
        this._currentShaderProgram.set_uColor(this._currentColor);
        this._currentShaderProgram.set_uAlpha(this._currentAlpha);
        this._currentShaderProgram.set_uSampler(0);
        this._currentShaderProgram.updateUniforms();
    };
    WebGLSharedObject.prototype.clear = function () {
        this._context.clear(this._context.COLOR_BUFFER_BIT);
    };
    WebGLSharedObject.prototype.draw = function (state, surfaceTexture, offsetX, offsetY, width, height, canvasOffsetX, canvasOffsetY, color) {
        if (this._numSprites >= this._maxSpriteCount) {
            this._commit();
        }
        var shaderProgram;
        // fillRectの場合はデフォルトのシェーダを利用
        if (surfaceTexture === this._fillRectSurfaceTexture || state.shaderProgram == null || state.shaderProgram._program == null) {
            shaderProgram = this._defaultShaderProgram;
        }
        else {
            shaderProgram = state.shaderProgram._program;
        }
        // シェーダプログラムを設定
        if (this._currentShaderProgram !== shaderProgram) {
            this._commit();
            this._currentShaderProgram = shaderProgram;
            this._currentShaderProgram.use();
            this._currentShaderProgram.updateUniforms();
            // シェーダプログラム変更時は全ての設定をクリア
            this._currentCompositeOperation = null;
            this._currentAlpha = null;
            this._currentColor = [];
            this._currentTexture = null;
        }
        // テクスチャを設定
        if (this._currentTexture !== surfaceTexture.texture) {
            this._currentTexture = surfaceTexture.texture;
            this._commit();
            this._context.bindTexture(this._context.TEXTURE_2D, surfaceTexture.texture);
        }
        // 色を設定
        if (this._currentColor[0] !== color[0] ||
            this._currentColor[1] !== color[1] ||
            this._currentColor[2] !== color[2] ||
            this._currentColor[3] !== color[3]) {
            this._currentColor = color;
            this._commit();
            this._currentShaderProgram.set_uColor(color);
        }
        // アルファを指定
        if (this._currentAlpha !== state.globalAlpha) {
            this._currentAlpha = state.globalAlpha;
            this._commit();
            this._currentShaderProgram.set_uAlpha(state.globalAlpha);
        }
        // 合成モードを設定
        if (this._currentCompositeOperation !== state.globalCompositeOperation) {
            this._currentCompositeOperation = state.globalCompositeOperation;
            this._commit();
            var compositeOperation = this._compositeOps[this._currentCompositeOperation];
            this._context.blendFunc(compositeOperation[0], compositeOperation[1]);
        }
        var tw = 1.0 / surfaceTexture.textureWidth;
        var th = 1.0 / surfaceTexture.textureHeight;
        var ox = surfaceTexture.textureOffsetX;
        var oy = surfaceTexture.textureOffsetY;
        var s = tw * (ox + offsetX + width);
        var t = th * (oy + offsetY + height);
        var u = tw * (ox + offsetX);
        var v = th * (oy + offsetY);
        // 変換行列を設定
        this._register(this._transformVertex(canvasOffsetX, canvasOffsetY, width, height, state.transformer), [u, v, s, v, s, t, u, v, s, t, u, t]);
    };
    WebGLSharedObject.prototype.end = function () {
        this._commit();
        if (this._deleteRequestedTargets.length > 0) {
            for (var i = 0; i < this._deleteRequestedTargets.length; ++i) {
                this.deleteRenderTarget(this._deleteRequestedTargets[i]);
            }
            this._deleteRequestedTargets = [];
        }
    };
    WebGLSharedObject.prototype.makeTextureForSurface = function (surface) {
        this._textureAtlas.makeTextureForSurface(this, surface);
    };
    WebGLSharedObject.prototype.disposeTexture = function (texture) {
        if (this._currentTexture === texture) {
            this._commit();
        }
    };
    /**
     * image を GPU 上のテクスチャメモリ領域にコピーする.
     */
    WebGLSharedObject.prototype.assignTexture = function (image, x, y, texture) {
        this._context.bindTexture(this._context.TEXTURE_2D, texture);
        if (image instanceof HTMLVideoElement) {
            throw g.ExceptionFactory.createAssertionError("WebGLRenderer#assignTexture: HTMLVideoElement is not supported.");
        }
        this._context.texSubImage2D(this._context.TEXTURE_2D, 0, x, y, this._context.RGBA, this._context.UNSIGNED_BYTE, image);
        this._context.bindTexture(this._context.TEXTURE_2D, this._currentTexture);
    };
    /**
     * GPU 上のテクスチャメモリ領域を texturePixels でクリアする.
     *
     * NOTE: 本来はGPUデバイス上で領域をクリアすることが望ましく、ホストから都度領域を転送する texSubImage2D() は適当でない。
     * FBOをTextureにバインドさせる方式などを考慮すべきである。
     * ただし、以下の2点より本操作の最適化を見送っている。
     * - 処理速度上最良のケースは本操作の呼び出しを行わないことである
     * - 本操作の呼び出し頻度がWebGLTextureAtlas#TEXTURE_SIZEやWebGLTextureAtlas#TEXTURE_COUNTの値に依存するため、
     *   そちらをチューニングする方が優先度が高い
     */
    WebGLSharedObject.prototype.clearTexture = function (texturePixels, width, height, texture) {
        this._context.bindTexture(this._context.TEXTURE_2D, texture);
        this._context.texSubImage2D(this._context.TEXTURE_2D, 0, 0, 0, width, height, this._context.RGBA, this._context.UNSIGNED_BYTE, texturePixels);
        this._context.bindTexture(this._context.TEXTURE_2D, this._currentTexture);
    };
    WebGLSharedObject.prototype.makeTextureRaw = function (width, height, pixels) {
        if (pixels === void 0) { pixels = null; }
        var texture = this._context.createTexture();
        this._context.bindTexture(this._context.TEXTURE_2D, texture);
        this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 1);
        this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_WRAP_S, this._context.CLAMP_TO_EDGE);
        this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_WRAP_T, this._context.CLAMP_TO_EDGE);
        this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_MAG_FILTER, this._context.NEAREST);
        this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_MIN_FILTER, this._context.NEAREST);
        this._context.texImage2D(this._context.TEXTURE_2D, 0, this._context.RGBA, width, height, 0, this._context.RGBA, this._context.UNSIGNED_BYTE, pixels);
        this._context.bindTexture(this._context.TEXTURE_2D, this._currentTexture);
        return texture;
    };
    WebGLSharedObject.prototype.makeTexture = function (data) {
        var texture = this._context.createTexture();
        this._context.bindTexture(this._context.TEXTURE_2D, texture);
        this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 1);
        this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_WRAP_S, this._context.CLAMP_TO_EDGE);
        this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_WRAP_T, this._context.CLAMP_TO_EDGE);
        this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_MAG_FILTER, this._context.NEAREST);
        this._context.texParameteri(this._context.TEXTURE_2D, this._context.TEXTURE_MIN_FILTER, this._context.NEAREST);
        if (data instanceof HTMLImageElement) {
            this._context.texImage2D(this._context.TEXTURE_2D, 0, this._context.RGBA, this._context.RGBA, this._context.UNSIGNED_BYTE, data);
        }
        else if (data instanceof HTMLCanvasElement) {
            this._context.texImage2D(this._context.TEXTURE_2D, 0, this._context.RGBA, this._context.RGBA, this._context.UNSIGNED_BYTE, data);
        }
        else if (data instanceof ImageData) {
            this._context.texImage2D(this._context.TEXTURE_2D, 0, this._context.RGBA, this._context.RGBA, this._context.UNSIGNED_BYTE, data);
        }
        this._context.bindTexture(this._context.TEXTURE_2D, this._currentTexture);
        return texture;
    };
    WebGLSharedObject.prototype.getPrimaryRenderTarget = function (width, height) {
        return this._renderTarget;
    };
    WebGLSharedObject.prototype.createRenderTarget = function (width, height) {
        var context = this._context;
        var framebuffer = context.createFramebuffer();
        context.bindFramebuffer(context.FRAMEBUFFER, framebuffer);
        var texture = context.createTexture();
        context.bindTexture(context.TEXTURE_2D, texture);
        context.texParameteri(context.TEXTURE_2D, context.TEXTURE_MAG_FILTER, context.LINEAR);
        context.texParameteri(context.TEXTURE_2D, context.TEXTURE_MIN_FILTER, context.LINEAR);
        context.texParameteri(context.TEXTURE_2D, context.TEXTURE_WRAP_S, context.CLAMP_TO_EDGE);
        context.texParameteri(context.TEXTURE_2D, context.TEXTURE_WRAP_T, context.CLAMP_TO_EDGE);
        context.texImage2D(context.TEXTURE_2D, 0, context.RGBA, width, height, 0, context.RGBA, context.UNSIGNED_BYTE, null);
        context.framebufferTexture2D(context.FRAMEBUFFER, context.COLOR_ATTACHMENT0, context.TEXTURE_2D, texture, 0);
        context.bindTexture(context.TEXTURE_2D, this._currentTexture);
        var renderTaget = this.getCurrentRenderTarget();
        context.bindFramebuffer(context.FRAMEBUFFER, renderTaget.framebuffer);
        return {
            width: width,
            height: height,
            viewportWidth: width,
            viewportHeight: height,
            framebuffer: framebuffer,
            texture: texture
        };
    };
    WebGLSharedObject.prototype.requestDeleteRenderTarget = function (renderTaget) {
        this._deleteRequestedTargets.push(renderTaget);
    };
    WebGLSharedObject.prototype.deleteRenderTarget = function (renderTaget) {
        var context = this._context;
        if (this.getCurrentRenderTarget() === renderTaget) {
            this._commit();
        }
        context.deleteFramebuffer(renderTaget.framebuffer);
        context.deleteTexture(renderTaget.texture);
    };
    WebGLSharedObject.prototype.getContext = function () {
        return this._context;
    };
    WebGLSharedObject.prototype.getDefaultShaderProgram = function () {
        return this._defaultShaderProgram;
    };
    WebGLSharedObject.prototype.initializeShaderProgram = function (shaderProgram) {
        if (shaderProgram) {
            if (!shaderProgram._program) {
                var program = new WebGLShaderProgram_1.WebGLShaderProgram(this._context, shaderProgram.fragmentShader, shaderProgram.uniforms);
                program.initializeUniforms();
                shaderProgram._program = program;
            }
        }
        return shaderProgram;
    };
    WebGLSharedObject.prototype._init = function () {
        var _a;
        var program = new WebGLShaderProgram_1.WebGLShaderProgram(this._context);
        // 描画用リソース
        this._textureAtlas = new WebGLTextureAtlas_1.WebGLTextureAtlas();
        this._fillRectTexture = this.makeTextureRaw(1, 1, new Uint8Array([255, 255, 255, 255]));
        this._fillRectSurfaceTexture = {
            texture: this._fillRectTexture,
            textureWidth: 1,
            textureHeight: 1,
            textureOffsetX: 0,
            textureOffsetY: 0
        };
        this._renderTarget = {
            width: this._surface.width,
            height: this._surface.height,
            viewportWidth: this._surface.width,
            viewportHeight: this._surface.height,
            framebuffer: null,
            texture: null
        };
        // 描画命令をため込んでおくバッファ
        this._maxSpriteCount = 1024;
        this._vertices = this._makeBuffer(this._maxSpriteCount * 24 * 4);
        this._verticesCache = new Float32Array(this._maxSpriteCount * 24);
        this._numSprites = 0; // the number of sprites
        this._currentTexture = null;
        this._currentColor = [1.0, 1.0, 1.0, 1.0];
        this._currentAlpha = 1.0;
        this._currentCompositeOperation = g.CompositeOperation.SourceOver;
        this._currentShaderProgram = program;
        this._defaultShaderProgram = program;
        this._renderTargetStack = [];
        this._deleteRequestedTargets = [];
        // シェーダの設定
        this._currentShaderProgram.use();
        try {
            this._currentShaderProgram.set_aVertex(this._vertices);
            this._currentShaderProgram.set_uColor(this._currentColor);
            this._currentShaderProgram.set_uAlpha(this._currentAlpha);
            this._currentShaderProgram.set_uSampler(0);
        }
        finally {
            this._currentShaderProgram.unuse();
        }
        // WebGL のパラメータを設定
        this._context.enable(this._context.BLEND);
        this._context.activeTexture(this._context.TEXTURE0);
        this._context.bindTexture(this._context.TEXTURE_2D, this._fillRectTexture);
        this._compositeOps = (_a = {},
            _a[g.CompositeOperation.SourceAtop] = [this._context.DST_ALPHA, this._context.ONE_MINUS_SRC_ALPHA],
            _a[g.CompositeOperation.ExperimentalSourceIn] = [this._context.DST_ALPHA, this._context.ZERO],
            _a[g.CompositeOperation.ExperimentalSourceOut] = [this._context.ONE_MINUS_DST_ALPHA, this._context.ZERO],
            _a[g.CompositeOperation.SourceOver] = [this._context.ONE, this._context.ONE_MINUS_SRC_ALPHA],
            _a[g.CompositeOperation.ExperimentalDestinationAtop] = [this._context.ONE_MINUS_DST_ALPHA, this._context.SRC_ALPHA],
            _a[g.CompositeOperation.ExperimentalDestinationIn] = [this._context.ZERO, this._context.SRC_ALPHA],
            _a[g.CompositeOperation.DestinationOut] = [this._context.ZERO, this._context.ONE_MINUS_SRC_ALPHA],
            _a[g.CompositeOperation.DestinationOver] = [this._context.ONE_MINUS_DST_ALPHA, this._context.ONE],
            _a[g.CompositeOperation.Lighter] = [this._context.ONE, this._context.ONE],
            _a[g.CompositeOperation.Copy] = [this._context.ONE, this._context.ZERO],
            _a[g.CompositeOperation.Xor] = [this._context.ONE_MINUS_DST_ALPHA, this._context.ONE_MINUS_SRC_ALPHA],
            _a);
        var compositeOperation = this._compositeOps[this._currentCompositeOperation];
        this._context.blendFunc(compositeOperation[0], compositeOperation[1]);
    };
    WebGLSharedObject.prototype._makeBuffer = function (data) {
        var buffer = this._context.createBuffer();
        this._context.bindBuffer(this._context.ARRAY_BUFFER, buffer);
        this._context.bufferData(this._context.ARRAY_BUFFER, data, this._context.DYNAMIC_DRAW);
        return buffer;
    };
    WebGLSharedObject.prototype._transformVertex = function (x, y, w, h, transformer) {
        var renderTaget = this.getCurrentRenderTarget();
        var cw = 2.0 / renderTaget.width;
        var ch = -2.0 / renderTaget.height;
        var m = transformer.matrix;
        var a = cw * w * m[0];
        var b = ch * w * m[1];
        var c = cw * h * m[2];
        var d = ch * h * m[3];
        var e = cw * (x * m[0] + y * m[2] + m[4]) - 1.0;
        var f = ch * (x * m[1] + y * m[3] + m[5]) + 1.0;
        return [
            e, f, a + e, b + f, a + c + e, b + d + f,
            e, f, a + c + e, b + d + f, c + e, d + f
        ];
    };
    WebGLSharedObject.prototype._register = function (vertex, texCoord) {
        var offset = this._numSprites * 6;
        ++this._numSprites;
        for (var i = 0; i < 6; ++i) {
            this._verticesCache[4 * (i + offset) + 0] = vertex[2 * i + 0];
            this._verticesCache[4 * (i + offset) + 1] = vertex[2 * i + 1];
            this._verticesCache[4 * (i + offset) + 2] = texCoord[2 * i + 0];
            this._verticesCache[4 * (i + offset) + 3] = texCoord[2 * i + 1];
        }
    };
    WebGLSharedObject.prototype._commit = function () {
        if (this._numSprites > 0) {
            this._context.bindBuffer(this._context.ARRAY_BUFFER, this._vertices);
            this._context.bufferSubData(this._context.ARRAY_BUFFER, 0, this._verticesCache.subarray(0, this._numSprites * 24));
            this._context.drawArrays(this._context.TRIANGLES, 0, this._numSprites * 6);
            this._numSprites = 0;
        }
    };
    return WebGLSharedObject;
}());
exports.WebGLSharedObject = WebGLSharedObject;

},{"./WebGLBackSurface":49,"./WebGLPrimarySurface":52,"./WebGLShaderProgram":56,"./WebGLTextureAtlas":58,"@akashic/akashic-engine":1}],58:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebGLTextureAtlas = void 0;
var WebGLTextureMap_1 = require("./WebGLTextureMap");
var RenderingHelper_1 = require("../RenderingHelper");
var WebGLTextureAtlas = /** @class */ (function () {
    function WebGLTextureAtlas() {
        this._maps = [];
        this._insertPos = 0;
        this.emptyTexturePixels = new Uint8Array(WebGLTextureAtlas.TEXTURE_SIZE * WebGLTextureAtlas.TEXTURE_SIZE * 4);
    }
    /**
     * 新しいシーンに遷移したとき呼ぶ。
     */
    WebGLTextureAtlas.prototype.clear = function () {
        for (var i = 0; i < this._maps.length; ++i) {
            this._maps[i].dispose();
        }
    };
    /**
     * 現在のテクスチャ領域使用効率を表示する。
     */
    WebGLTextureAtlas.prototype.showOccupancy = function () {
        for (var i = 0; i < this._maps.length; ++i) {
            console.log("occupancy[" + i + "]: " + this._maps[i].occupancy());
        }
    };
    /**
     * g.Surface 用にテクスチャを作成する。
     */
    WebGLTextureAtlas.prototype.makeTextureForSurface = function (shared, surface) {
        var image = surface._drawable;
        if (!image || image.texture) {
            return;
        }
        var width = image.width;
        var height = image.height;
        // サイズが大きいので単体のテクスチャとして扱う
        if ((width >= WebGLTextureAtlas.TEXTURE_SIZE) || (height >= WebGLTextureAtlas.TEXTURE_SIZE)) {
            // 画像サイズが 2^n でないときはリサイズする
            var w = RenderingHelper_1.RenderingHelper.toPowerOfTwo(image.width);
            var h = RenderingHelper_1.RenderingHelper.toPowerOfTwo(image.height);
            if ((w !== image.width) || (h !== image.height)) {
                var canvas = document.createElement("canvas");
                canvas.width = w;
                canvas.height = h;
                var canvasContext = canvas.getContext("2d");
                canvasContext.globalCompositeOperation = "copy";
                canvasContext.drawImage(image, 0, 0);
                image = canvasContext.getImageData(0, 0, w, h);
            }
            surface._drawable.texture = shared.makeTexture(image);
            surface._drawable.textureOffsetX = 0;
            surface._drawable.textureOffsetY = 0;
            surface._drawable.textureWidth = w;
            surface._drawable.textureHeight = h;
            return;
        }
        this._assign(shared, surface, this._maps);
    };
    /**
     * 適当なテクスチャアトラスにサーフィスを割り当てる
     */
    WebGLTextureAtlas.prototype._assign = function (shared, surface, maps) {
        // テクスチャアトラスに割り当てる
        var map;
        for (var i = 0; i < maps.length; ++i) {
            map = maps[(i + this._insertPos) % maps.length].insert(surface);
            if (map) {
                // 登録する
                this._register(shared, map, surface._drawable);
                this._insertPos = i;
                return;
            }
        }
        map = null;
        // テクスチャ容量があふれるので古いやつを消して再利用する
        if (maps.length >= WebGLTextureAtlas.TEXTURE_COUNT) {
            map = maps.shift();
            shared.disposeTexture(map.texture);
            map.dispose();
            shared.clearTexture(this.emptyTexturePixels, WebGLTextureAtlas.TEXTURE_SIZE, WebGLTextureAtlas.TEXTURE_SIZE, map.texture);
        }
        // 再利用できない場合は、新規生成する
        if (!map) {
            map = new WebGLTextureMap_1.WebGLTextureMap(shared.makeTextureRaw(WebGLTextureAtlas.TEXTURE_SIZE, WebGLTextureAtlas.TEXTURE_SIZE), 0, 0, WebGLTextureAtlas.TEXTURE_SIZE, WebGLTextureAtlas.TEXTURE_SIZE);
        }
        // 登録する
        maps.push(map);
        map = map.insert(surface);
        this._register(shared, map, surface._drawable);
    };
    /**
     * テクスチャを登録する。
     */
    WebGLTextureAtlas.prototype._register = function (shared, map, image) {
        image.texture = map.texture;
        image.textureOffsetX = map.offsetX;
        image.textureOffsetY = map.offsetY;
        image.textureWidth = WebGLTextureAtlas.TEXTURE_SIZE;
        image.textureHeight = WebGLTextureAtlas.TEXTURE_SIZE;
        shared.assignTexture(image, map.offsetX, map.offsetY, map.texture);
    };
    // 確保するテクスチャのサイズ (実際のゲームに合わせてチューニングする必要がある)
    WebGLTextureAtlas.TEXTURE_SIZE = 1024;
    // 確保するテクスチャの数 (実際のゲームに合わせてチューニングする必要がある)
    WebGLTextureAtlas.TEXTURE_COUNT = 16;
    return WebGLTextureAtlas;
}());
exports.WebGLTextureAtlas = WebGLTextureAtlas;

},{"../RenderingHelper":43,"./WebGLTextureMap":59}],59:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebGLTextureMap = void 0;
var WebGLTextureMap = /** @class */ (function () {
    function WebGLTextureMap(texture, offsetX, offsetY, width, height) {
        this.texture = texture;
        this.offsetX = offsetX;
        this.offsetY = offsetY;
        this._width = width;
        this._height = height;
    }
    WebGLTextureMap.prototype.dispose = function () {
        if (this._left) {
            this._left.dispose();
            this._left = null;
        }
        if (this._right) {
            this._right.dispose();
            this._right = null;
        }
        if (this._surface) {
            if (this._surface._drawable) {
                this._surface._drawable.texture = null;
            }
            this._surface = null;
        }
    };
    WebGLTextureMap.prototype.capacity = function () {
        return this._width * this._height;
    };
    WebGLTextureMap.prototype.area = function () {
        if (!this._surface) {
            return 0;
        }
        var image = this._surface._drawable;
        var a = image.width * image.height;
        if (this._left) {
            a += this._left.area();
        }
        if (this._right) {
            a += this._right.area();
        }
        return a;
    };
    WebGLTextureMap.prototype.occupancy = function () {
        return this.area() / this.capacity();
    };
    WebGLTextureMap.prototype.insert = function (surface) {
        var image = surface._drawable;
        // マージンを考慮した領域を確保
        var width = image.width + WebGLTextureMap.TEXTURE_MARGIN;
        var height = image.height + WebGLTextureMap.TEXTURE_MARGIN;
        // 再帰的にパッキング
        if (this._surface) {
            if (this._left) {
                var left = this._left.insert(surface);
                if (left) {
                    return left;
                }
            }
            if (this._right) {
                var right = this._right.insert(surface);
                if (right) {
                    return right;
                }
            }
            return null;
        }
        // 詰め込み不可能
        if ((this._width < width) || (this._height < height)) {
            return null;
        }
        var remainWidth = this._width - width;
        var remainHeight = this._height - height;
        if (remainWidth <= remainHeight) {
            this._left = new WebGLTextureMap(this.texture, this.offsetX + width, this.offsetY, remainWidth, height);
            this._right = new WebGLTextureMap(this.texture, this.offsetX, this.offsetY + height, this._width, remainHeight);
        }
        else {
            this._left = new WebGLTextureMap(this.texture, this.offsetX, this.offsetY + height, width, remainHeight);
            this._right = new WebGLTextureMap(this.texture, this.offsetX + width, this.offsetY, remainWidth, this._height);
        }
        this._surface = surface;
        return this;
    };
    // 各テクスチャを配置する際のマージンピクセル数
    // マージンを取らないと、隣接するテクスチャが滲んで描画される可能性がある。
    WebGLTextureMap.TEXTURE_MARGIN = 1;
    return WebGLTextureMap;
}());
exports.WebGLTextureMap = WebGLTextureMap;

},{}],60:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.InputAbstractHandler = void 0;
var g = require("@akashic/akashic-engine");
var pdi = require("@akashic/akashic-pdi");
/**
 * 入力ハンドラ。
 *
 * コンストラクタで受け取ったViewに対してDOMイベントのハンドラを設定する。
 * DOMイベント情報から `PointEventResponse` へ変換したデータを `point{Down, Move, Up}Trigger` を通して通知する。
 * Down -> Move -> Up のフローにおける、Moveイベントのロックを管理する。
 */
var InputAbstractHandler = /** @class */ (function () {
    /**
     * @param inputView inputViewはDOMイベントを設定するHTMLElement
     */
    function InputAbstractHandler(inputView, disablePreventDefault) {
        if (Object.getPrototypeOf && (Object.getPrototypeOf(this) === InputAbstractHandler.prototype)) {
            throw new Error("InputAbstractHandler is abstract and should not be directly instantiated");
        }
        this.inputView = inputView;
        this.pointerEventLock = {};
        this._xScale = 1;
        this._yScale = 1;
        this._disablePreventDefault = !!disablePreventDefault;
        this.pointTrigger = new g.Trigger();
    }
    // `start()` で設定するDOMイベントをサポートしているかを返す
    InputAbstractHandler.isSupported = function () {
        return false;
    };
    // 継承したクラスにおいて、適切なDOMイベントを設定する
    InputAbstractHandler.prototype.start = function () {
        throw new Error("This method is abstract");
    };
    // start() に対応するDOMイベントを開放する
    InputAbstractHandler.prototype.stop = function () {
        throw new Error("This method is abstract");
    };
    InputAbstractHandler.prototype.setScale = function (xScale, yScale) {
        if (yScale === void 0) { yScale = xScale; }
        this._xScale = xScale;
        this._yScale = yScale;
    };
    InputAbstractHandler.prototype.pointDown = function (identifier, pagePosition) {
        this.pointTrigger.fire({
            type: 0 /* Down */,
            identifier: identifier,
            offset: this.getOffsetFromEvent(pagePosition)
        });
        // downのイベントIDを保存して、moveとupのイベントの抑制をする(ロックする)
        this.pointerEventLock[identifier] = true;
    };
    InputAbstractHandler.prototype.pointMove = function (identifier, pagePosition) {
        if (!this.pointerEventLock.hasOwnProperty(identifier + "")) {
            return;
        }
        this.pointTrigger.fire({
            type: 1 /* Move */,
            identifier: identifier,
            offset: this.getOffsetFromEvent(pagePosition)
        });
    };
    InputAbstractHandler.prototype.pointUp = function (identifier, pagePosition) {
        if (!this.pointerEventLock.hasOwnProperty(identifier + "")) {
            return;
        }
        this.pointTrigger.fire({
            type: 2 /* Up */,
            identifier: identifier,
            offset: this.getOffsetFromEvent(pagePosition)
        });
        // Upが完了したら、Down->Upが完了したとしてロックを外す
        delete this.pointerEventLock[identifier];
    };
    InputAbstractHandler.prototype.getOffsetFromEvent = function (e) {
        return { x: e.offsetX, y: e.offsetY };
    };
    InputAbstractHandler.prototype.getScale = function () {
        return { x: this._xScale, y: this._yScale };
    };
    InputAbstractHandler.prototype.getOffsetPositionFromInputView = function (position) {
        // windowの左上を0,0とした時のinputViewのoffsetを取得する
        var bounding = this.inputView.getBoundingClientRect();
        var scale = this.getScale();
        return {
            offsetX: (position.pageX - Math.round(window.pageXOffset + bounding.left)) / scale.x,
            offsetY: (position.pageY - Math.round(window.pageYOffset + bounding.top)) / scale.y
        };
    };
    return InputAbstractHandler;
}());
exports.InputAbstractHandler = InputAbstractHandler;

},{"@akashic/akashic-engine":1,"@akashic/akashic-pdi":3}],61:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.MouseHandler = void 0;
var InputAbstractHandler_1 = require("./InputAbstractHandler");
var MouseHandler = /** @class */ (function (_super) {
    __extends(MouseHandler, _super);
    function MouseHandler(inputView, disablePreventDefault) {
        var _this = _super.call(this, inputView, disablePreventDefault) || this;
        var identifier = 1;
        _this.onMouseDown = function (e) {
            if (e.button !== 0)
                return; // NOTE: 左クリック以外を受け付けない
            _this.pointDown(identifier, _this.getOffsetPositionFromInputView(e));
            window.addEventListener("mousemove", _this.onMouseMove, false);
            window.addEventListener("mouseup", _this.onMouseUp, false);
            if (!_this._disablePreventDefault) {
                e.stopPropagation();
                e.preventDefault();
            }
        };
        _this.onMouseMove = function (e) {
            _this.pointMove(identifier, _this.getOffsetPositionFromInputView(e));
            if (!_this._disablePreventDefault) {
                e.stopPropagation();
                e.preventDefault();
            }
        };
        _this.onMouseUp = function (e) {
            _this.pointUp(identifier, _this.getOffsetPositionFromInputView(e));
            window.removeEventListener("mousemove", _this.onMouseMove, false);
            window.removeEventListener("mouseup", _this.onMouseUp, false);
            if (!_this._disablePreventDefault) {
                e.stopPropagation();
                e.preventDefault();
            }
        };
        return _this;
    }
    MouseHandler.prototype.start = function () {
        this.inputView.addEventListener("mousedown", this.onMouseDown, false);
    };
    MouseHandler.prototype.stop = function () {
        this.inputView.removeEventListener("mousedown", this.onMouseDown, false);
    };
    return MouseHandler;
}(InputAbstractHandler_1.InputAbstractHandler));
exports.MouseHandler = MouseHandler;

},{"./InputAbstractHandler":60}],62:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.TouchHandler = void 0;
var MouseHandler_1 = require("./MouseHandler");
var TouchHandler = /** @class */ (function (_super) {
    __extends(TouchHandler, _super);
    function TouchHandler(inputView, disablePreventDefault) {
        var _this = _super.call(this, inputView, disablePreventDefault) || this;
        _this.onTouchDown = function (e) {
            var touches = e.changedTouches;
            for (var i = 0, len = touches.length; i < len; i++) {
                var touch = touches[i];
                _this.pointDown(touch.identifier, _this.getOffsetPositionFromInputView(touch));
            }
            if (!_this._disablePreventDefault) {
                e.stopPropagation();
                if (e.cancelable)
                    e.preventDefault();
            }
        };
        _this.onTouchMove = function (e) {
            var touches = e.changedTouches;
            for (var i = 0, len = touches.length; i < len; i++) {
                var touch = touches[i];
                _this.pointMove(touch.identifier, _this.getOffsetPositionFromInputView(touch));
            }
            if (!_this._disablePreventDefault) {
                e.stopPropagation();
                if (e.cancelable)
                    e.preventDefault();
            }
        };
        _this.onTouchUp = function (e) {
            var touches = e.changedTouches;
            for (var i = 0, len = touches.length; i < len; i++) {
                var touch = touches[i];
                _this.pointUp(touch.identifier, _this.getOffsetPositionFromInputView(touch));
            }
            if (!_this._disablePreventDefault) {
                e.stopPropagation();
                if (e.cancelable)
                    e.preventDefault();
            }
        };
        return _this;
    }
    TouchHandler.prototype.start = function () {
        _super.prototype.start.call(this);
        this.inputView.addEventListener("touchstart", this.onTouchDown);
        this.inputView.addEventListener("touchmove", this.onTouchMove);
        this.inputView.addEventListener("touchend", this.onTouchUp);
    };
    TouchHandler.prototype.stop = function () {
        _super.prototype.stop.call(this);
        this.inputView.removeEventListener("touchstart", this.onTouchDown);
        this.inputView.removeEventListener("touchmove", this.onTouchMove);
        this.inputView.removeEventListener("touchend", this.onTouchUp);
    };
    return TouchHandler;
}(MouseHandler_1.MouseHandler));
exports.TouchHandler = TouchHandler;

},{"./MouseHandler":61}],63:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProxyAudioPlugin = exports.PostMessageAudioPlugin = exports.WebAudioPlugin = exports.HTMLAudioPlugin = exports.AudioPluginRegistry = exports.g = exports.ResourceFactory = exports.Platform = void 0;
var Platform_1 = require("./Platform");
Object.defineProperty(exports, "Platform", { enumerable: true, get: function () { return Platform_1.Platform; } });
var ResourceFactory_1 = require("./ResourceFactory");
Object.defineProperty(exports, "ResourceFactory", { enumerable: true, get: function () { return ResourceFactory_1.ResourceFactory; } });
// akashic-engine内部でresourceを使えるように初期設定
var g = require("@akashic/akashic-engine");
exports.g = g;
var AudioPluginRegistry_1 = require("./plugin/AudioPluginRegistry");
Object.defineProperty(exports, "AudioPluginRegistry", { enumerable: true, get: function () { return AudioPluginRegistry_1.AudioPluginRegistry; } });
var AudioPluginManager_1 = require("./plugin/AudioPluginManager");
Object.defineProperty(exports, "AudioPluginManager", { enumerable: true, get: function () { return AudioPluginManager_1.AudioPluginManager; } });
// TODO: Audio Pluginの実態は別リポジトリに切り出す事を検討する
var HTMLAudioPlugin_1 = require("./plugin/HTMLAudioPlugin/HTMLAudioPlugin");
Object.defineProperty(exports, "HTMLAudioPlugin", { enumerable: true, get: function () { return HTMLAudioPlugin_1.HTMLAudioPlugin; } });
var WebAudioPlugin_1 = require("./plugin/WebAudioPlugin/WebAudioPlugin");
Object.defineProperty(exports, "WebAudioPlugin", { enumerable: true, get: function () { return WebAudioPlugin_1.WebAudioPlugin; } });
// TODO 削除。誰も使っていない
var PostMessageAudioPlugin_1 = require("./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin");
Object.defineProperty(exports, "PostMessageAudioPlugin", { enumerable: true, get: function () { return PostMessageAudioPlugin_1.PostMessageAudioPlugin; } });
var ProxyAudioPlugin_1 = require("./plugin/ProxyAudioPlugin/ProxyAudioPlugin");
Object.defineProperty(exports, "ProxyAudioPlugin", { enumerable: true, get: function () { return ProxyAudioPlugin_1.ProxyAudioPlugin; } });

},{"./Platform":32,"./ResourceFactory":34,"./plugin/AudioPluginManager":64,"./plugin/AudioPluginRegistry":65,"./plugin/HTMLAudioPlugin/HTMLAudioPlugin":69,"./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin":72,"./plugin/ProxyAudioPlugin/ProxyAudioPlugin":76,"./plugin/WebAudioPlugin/WebAudioPlugin":81,"@akashic/akashic-engine":1}],64:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AudioPluginManager = void 0;
/*
 Audioプラグインを登録し、現在登録しているプラグインを管理するクラス

 TODO: 各Gameインスタンスが一つのAudioプラグインしか持たないので、
 PluginManagerが状態をもたずにGame自体にpluginを登録する方式もあり
 */
var AudioPluginManager = /** @class */ (function () {
    function AudioPluginManager() {
        this._activePlugin = null;
    }
    AudioPluginManager.prototype.getActivePlugin = function () {
        return this._activePlugin;
    };
    // Audioプラグインに登録を行い、どれか一つでも成功ならtrue、それ以外はfalseを返す
    AudioPluginManager.prototype.tryInstallPlugin = function (plugins) {
        for (var i = 0, len = plugins.length; i < len; i++) {
            var p = plugins[i];
            if (p.isSupported) {
                var PluginConstructor = p;
                if (PluginConstructor.isSupported()) {
                    this._activePlugin = new PluginConstructor();
                    return true;
                }
            }
            else {
                this._activePlugin = p;
                return true;
            }
        }
        return false;
    };
    return AudioPluginManager;
}());
exports.AudioPluginManager = AudioPluginManager;

},{}],65:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AudioPluginRegistry = void 0;
var audioPlugins = [];
exports.AudioPluginRegistry = {
    addPlugin: function (plugin) {
        if (audioPlugins.indexOf(plugin) === -1) {
            audioPlugins.push(plugin);
        }
    },
    getRegisteredAudioPlugins: function () {
        return audioPlugins;
    },
    clear: function () {
        audioPlugins = [];
    }
};

},{}],66:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.HTMLAudioAsset = void 0;
var g = require("@akashic/akashic-engine");
var HTMLAudioAsset = /** @class */ (function (_super) {
    __extends(HTMLAudioAsset, _super);
    function HTMLAudioAsset() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    HTMLAudioAsset.prototype._load = function (loader) {
        var _this = this;
        if (this.path == null) {
            // 再生可能な形式がない。実際には鳴らない音声としてロード成功しておく
            this.data = null;
            setTimeout(function () { return loader._onAssetLoad(_this); }, 0);
            return;
        }
        var audio = new Audio();
        var startLoadingAudio = function (path, handlers) {
            // autoplay は preload よりも優先されるため明示的にfalseとする
            audio.autoplay = false;
            audio.preload = "none";
            audio.src = path;
            _this._attachAll(audio, handlers);
            /* tslint:disable */
            // Firefoxはpreload="auto"でないと読み込みされない
            // preloadはブラウザに対するHint属性なので、どう扱うかはブラウザの実装次第となる
            // https://html.spec.whatwg.org/multipage/embedded-content.html#attr-media-preload
            // https://developer.mozilla.org/ja/docs/Web/HTML/Element/audio#attr-preload
            // https://github.com/CreateJS/SoundJS/blob/e2d4842a84ff425ada861edb9f6e9b57f63d7caf/src/soundjs/htmlaudio/HTMLAudioSoundInstance.js#L147-147
            /* tslint:enable:max-line-length */
            audio.preload = "auto";
            setAudioLoadInterval(audio, handlers);
            audio.load();
        };
        var handlers = {
            success: function () {
                _this._detachAll(audio, handlers);
                _this.data = audio;
                loader._onAssetLoad(_this);
                window.clearInterval(_this._intervalId);
            },
            error: function () {
                _this._detachAll(audio, handlers);
                _this.data = audio;
                loader._onAssetError(_this, g.ExceptionFactory.createAssetLoadError("HTMLAudioAsset loading error"));
                window.clearInterval(_this._intervalId);
            }
        };
        var setAudioLoadInterval = function (audio, handlers) {
            // IE11において、canplaythroughイベントが正常に発火しない問題が確認されたため、その対処として以下の処理を行っている。
            // なお、canplaythroughはreadyStateの値が4になった時点で呼び出されるイベントである。
            // インターバルとして指定している100msに根拠は無い。
            _this._intervalCount = 0;
            _this._intervalId = window.setInterval(function () {
                if (audio.readyState === 4) {
                    handlers.success();
                }
                else {
                    ++_this._intervalCount;
                    // readyStateの値が4にならない状態が1分（100ms×600）続いた場合、
                    // 読み込みに失敗したとする。1分という時間に根拠は無い。
                    if (_this._intervalCount === 600) {
                        handlers.error();
                    }
                }
            }, 100);
        };
        // 暫定対応：後方互換性のため、aacファイルが無い場合はmp4へのフォールバックを試みる。
        // この対応を止める際には、HTMLAudioPluginのsupportedExtensionsからaacを除外する必要がある。
        var delIndex = this.path.indexOf("?");
        var basePath = delIndex >= 0 ? this.path.substring(0, delIndex) : this.path;
        if (basePath.slice(-4) === ".aac" && HTMLAudioAsset.supportedFormats.indexOf("mp4") !== -1) {
            var altHandlers = {
                success: handlers.success,
                error: function () {
                    _this._detachAll(audio, altHandlers);
                    window.clearInterval(_this._intervalId);
                    _this.path = g.PathUtil.addExtname(_this.originalPath, "mp4");
                    startLoadingAudio(_this.path, handlers);
                }
            };
            startLoadingAudio(this.path, altHandlers);
            return;
        }
        startLoadingAudio(this.path, handlers);
    };
    HTMLAudioAsset.prototype.cloneElement = function () {
        return this.data ? new Audio(this.data.src) : null;
    };
    HTMLAudioAsset.prototype._assetPathFilter = function (path) {
        if (HTMLAudioAsset.supportedFormats.indexOf("ogg") !== -1) {
            return g.PathUtil.addExtname(path, "ogg");
        }
        if (HTMLAudioAsset.supportedFormats.indexOf("aac") !== -1) {
            return g.PathUtil.addExtname(path, "aac");
        }
        // ここで検出されるのは最初にアクセスを試みるオーディオアセットのファイルパスなので、
        // supportedFormatsに(後方互換性保持で使う可能性がある)mp4が含まれていても利用しない
        return null;
    };
    HTMLAudioAsset.prototype._attachAll = function (audio, handlers) {
        if (handlers.success) {
            /* tslint:disable:max-line-length */
            // https://developer.mozilla.org/en-US/docs/Web/Events/canplaythrough
            // https://github.com/goldfire/howler.js/blob/1dad25cdd9d6982232050454e8b45411902efe65/howler.js#L372
            // https://github.com/CreateJS/SoundJS/blob/e2d4842a84ff425ada861edb9f6e9b57f63d7caf/src/soundjs/htmlaudio/HTMLAudioSoundInstance.js#L145-145
            /* tslint:enable:max-line-length */
            audio.addEventListener("canplaythrough", handlers.success, false);
        }
        if (handlers.error) {
            // https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Media_events
            // stalledはfetchして取れなかった時に起きるイベント
            audio.addEventListener("stalled", handlers.error, false);
            audio.addEventListener("error", handlers.error, false);
            audio.addEventListener("abort", handlers.error, false);
        }
    };
    HTMLAudioAsset.prototype._detachAll = function (audio, handlers) {
        if (handlers.success) {
            audio.removeEventListener("canplaythrough", handlers.success, false);
        }
        if (handlers.error) {
            audio.removeEventListener("stalled", handlers.error, false);
            audio.removeEventListener("error", handlers.error, false);
            audio.removeEventListener("abort", handlers.error, false);
        }
    };
    return HTMLAudioAsset;
}(g.AudioAsset));
exports.HTMLAudioAsset = HTMLAudioAsset;

},{"@akashic/akashic-engine":1}],67:[function(require,module,exports){
"use strict";
/// chrome66以降などのブラウザに導入されるAutoplay Policyに対応する
// https://developers.google.com/web/updates/2017/09/autoplay-policy-changes
var state = 0 /* Unknown */;
var suspendedAudioElements = [];
var HTMLAudioAutoplayHelper;
(function (HTMLAudioAutoplayHelper) {
    function setupChromeMEIWorkaround(audio) {
        function playHandler() {
            switch (state) {
                case 0 /* Unknown */:
                case 1 /* WaitingInteraction */: // 通常のケースではここには到達しないが、何らかの外因によって音を鳴らすことができた場合
                    playSuspendedAudioElements();
                    break;
                case 2 /* Ready */:
                    break;
                default:
                // do nothing
            }
            state = 2 /* Ready */;
            clearTimeout(timer);
        }
        function suspendedHandler() {
            audio.removeEventListener("play", playHandler);
            switch (state) {
                case 0 /* Unknown */:
                    suspendedAudioElements.push(audio);
                    state = 1 /* WaitingInteraction */;
                    setUserInteractListener();
                    break;
                case 1 /* WaitingInteraction */:
                    suspendedAudioElements.push(audio);
                    break;
                case 2 /* Ready */:
                    audio.play(); // suspendedHandler が呼ばれるまでに音が鳴らせるようになった場合
                    break;
                default:
                // do nothing;
            }
        }
        switch (state) {
            case 0 /* Unknown */:
                audio.addEventListener("play", playHandler, true);
                var timer = setTimeout(suspendedHandler, 100); // 明確な根拠はないが100msec待ってもplayされなければ再生できないと判断する
                break;
            case 1 /* WaitingInteraction */:
                suspendedAudioElements.push(audio);
                break;
            case 2 /* Ready */:
                break;
            default:
            // do nothing
        }
    }
    HTMLAudioAutoplayHelper.setupChromeMEIWorkaround = setupChromeMEIWorkaround;
})(HTMLAudioAutoplayHelper || (HTMLAudioAutoplayHelper = {}));
function resumeHandler() {
    playSuspendedAudioElements();
    clearUserInteractListener();
}
function setUserInteractListener() {
    document.addEventListener("keydown", resumeHandler, true);
    document.addEventListener("mousedown", resumeHandler, true);
    document.addEventListener("touchend", resumeHandler, true);
}
function clearUserInteractListener() {
    document.removeEventListener("keydown", resumeHandler);
    document.removeEventListener("mousedown", resumeHandler);
    document.removeEventListener("touchend", resumeHandler);
}
function playSuspendedAudioElements() {
    state = 2 /* Ready */;
    suspendedAudioElements.forEach(function (audio) { return audio.play(); });
    suspendedAudioElements = [];
}
module.exports = HTMLAudioAutoplayHelper;

},{}],68:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.HTMLAudioPlayer = void 0;
var g = require("@akashic/akashic-engine");
var autoPlayHelper = require("./HTMLAudioAutoplayHelper");
var HTMLAudioPlayer = /** @class */ (function (_super) {
    __extends(HTMLAudioPlayer, _super);
    function HTMLAudioPlayer(system, manager) {
        var _this = _super.call(this, system) || this;
        _this._manager = manager;
        _this._endedEventHandler = function () {
            _this._onAudioEnded();
        };
        _this._onPlayEventHandler = function () {
            _this._onPlayEvent();
        };
        _this._dummyDurationWaitTimer = null;
        return _this;
    }
    HTMLAudioPlayer.prototype.play = function (asset) {
        if (this.currentAudio) {
            this.stop();
        }
        var audio = asset.cloneElement();
        if (audio) {
            autoPlayHelper.setupChromeMEIWorkaround(audio);
            audio.volume = this._calculateVolume();
            audio.play().catch(function (err) { });
            audio.loop = asset.loop;
            audio.addEventListener("ended", this._endedEventHandler, false);
            audio.addEventListener("play", this._onPlayEventHandler, false);
            this._isWaitingPlayEvent = true;
            this._audioInstance = audio;
        }
        else {
            // 再生できるオーディオがない場合。duration後に停止処理だけ行う(処理のみ進め音は鳴らさない)
            this._dummyDurationWaitTimer = setTimeout(this._endedEventHandler, asset.duration);
        }
        _super.prototype.play.call(this, asset);
    };
    HTMLAudioPlayer.prototype.stop = function () {
        if (!this.currentAudio) {
            _super.prototype.stop.call(this);
            return;
        }
        this._clearEndedEventHandler();
        if (this._audioInstance) {
            if (!this._isWaitingPlayEvent) {
                // _audioInstance が再び play されることは無いので、 removeEventListener("play") する必要は無い
                this._audioInstance.pause();
                this._audioInstance = null;
            }
            else {
                this._isStopRequested = true;
            }
        }
        _super.prototype.stop.call(this);
    };
    HTMLAudioPlayer.prototype.changeVolume = function (volume) {
        _super.prototype.changeVolume.call(this, volume);
        if (this._audioInstance) {
            this._audioInstance.volume = this._calculateVolume();
        }
    };
    HTMLAudioPlayer.prototype._changeMuted = function (muted) {
        _super.prototype._changeMuted.call(this, muted);
        if (this._audioInstance) {
            this._audioInstance.volume = this._calculateVolume();
        }
    };
    HTMLAudioPlayer.prototype.notifyMasterVolumeChanged = function () {
        if (this._audioInstance) {
            this._audioInstance.volume = this._calculateVolume();
        }
    };
    HTMLAudioPlayer.prototype._onAudioEnded = function () {
        this._clearEndedEventHandler();
        _super.prototype.stop.call(this);
    };
    HTMLAudioPlayer.prototype._clearEndedEventHandler = function () {
        if (this._audioInstance)
            this._audioInstance.removeEventListener("ended", this._endedEventHandler, false);
        if (this._dummyDurationWaitTimer != null) {
            clearTimeout(this._dummyDurationWaitTimer);
            this._dummyDurationWaitTimer = null;
        }
    };
    // audio.play() は非同期なので、 play が開始される前に stop を呼ばれた場合はこのハンドラ到達時に停止する
    HTMLAudioPlayer.prototype._onPlayEvent = function () {
        if (!this._isWaitingPlayEvent)
            return;
        this._isWaitingPlayEvent = false;
        if (this._isStopRequested) {
            this._isStopRequested = false;
            // _audioInstance が再び play されることは無いので、 removeEventListener("play") する必要は無い
            this._audioInstance.pause();
            this._audioInstance = null;
        }
    };
    HTMLAudioPlayer.prototype._calculateVolume = function () {
        return this._muted ? 0 : this.volume * this._system.volume * this._manager.getMasterVolume();
    };
    return HTMLAudioPlayer;
}(g.AudioPlayer));
exports.HTMLAudioPlayer = HTMLAudioPlayer;

},{"./HTMLAudioAutoplayHelper":67,"@akashic/akashic-engine":1}],69:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.HTMLAudioPlugin = void 0;
var HTMLAudioAsset_1 = require("./HTMLAudioAsset");
var HTMLAudioPlayer_1 = require("./HTMLAudioPlayer");
var HTMLAudioPlugin = /** @class */ (function () {
    function HTMLAudioPlugin() {
        this._supportedFormats = this._detectSupportedFormats();
        HTMLAudioAsset_1.HTMLAudioAsset.supportedFormats = this.supportedFormats;
    }
    // https://github.com/Modernizr/Modernizr/blob/master/feature-detects/audio.js
    // https://github.com/CreateJS/SoundJS/blob/master/src/soundjs/htmlaudio/HTMLAudioPlugin.js
    HTMLAudioPlugin.isSupported = function () {
        // Audio要素を実際に作って、canPlayTypeが存在するかで確認する
        var audioElement = document.createElement("audio");
        var result = false;
        try {
            result = (audioElement.canPlayType !== undefined);
        }
        catch (e) {
            // ignore Error
        }
        return result;
    };
    Object.defineProperty(HTMLAudioPlugin.prototype, "supportedFormats", {
        get: function () {
            return this._supportedFormats;
        },
        // TSLintのバグ - setterはreturn typeを書くとコンパイルエラー
        /* tslint:disable:typedef */
        // HTMLAudioAssetへ反映させるためsetterとする
        set: function (supportedFormats) {
            this._supportedFormats = supportedFormats;
            HTMLAudioAsset_1.HTMLAudioAsset.supportedFormats = supportedFormats;
        },
        enumerable: false,
        configurable: true
    });
    /* tslint:enable:typedef */
    HTMLAudioPlugin.prototype.createAsset = function (id, assetPath, duration, system, loop, hint) {
        return new HTMLAudioAsset_1.HTMLAudioAsset(id, assetPath, duration, system, loop, hint);
    };
    HTMLAudioPlugin.prototype.createPlayer = function (system, manager) {
        return new HTMLAudioPlayer_1.HTMLAudioPlayer(system, manager);
    };
    HTMLAudioPlugin.prototype._detectSupportedFormats = function () {
        // Edgeは再生できるファイル形式とcanPlayTypeの結果が一致しないため、固定でAACを利用する
        if (navigator.userAgent.indexOf("Edge/") !== -1)
            return ["aac"];
        // Audio要素を実際に作って、canPlayTypeで再生できるかを判定する
        var audioElement = document.createElement("audio");
        var supportedFormats = [];
        try {
            var supportedExtensions = ["ogg", "aac", "mp4"];
            for (var i = 0, len = supportedExtensions.length; i < len; i++) {
                var ext = supportedExtensions[i];
                var canPlay = audioElement.canPlayType("audio/" + ext);
                var supported = (canPlay !== "no" && canPlay !== "");
                if (supported) {
                    supportedFormats.push(ext);
                }
            }
        }
        catch (e) {
            // ignore Error
        }
        return supportedFormats;
    };
    return HTMLAudioPlugin;
}());
exports.HTMLAudioPlugin = HTMLAudioPlugin;

},{"./HTMLAudioAsset":66,"./HTMLAudioPlayer":68}],70:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.PostMessageAudioAsset = void 0;
var g = require("@akashic/akashic-engine");
var PostMessageAudioPlugin_1 = require("./PostMessageAudioPlugin");
var PostMessageAudioAsset = /** @class */ (function (_super) {
    __extends(PostMessageAudioAsset, _super);
    function PostMessageAudioAsset() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    PostMessageAudioAsset.prototype._load = function (loader) {
        var _this = this;
        var param = {
            id: this.id,
            assetPath: this.path,
            duration: this.duration,
            loop: this.loop,
            hint: this.hint
        };
        PostMessageAudioPlugin_1.PostMessageAudioPlugin.send("akashic:AudioAsset#_load", param);
        // TODO: 暫定対応。本来はPDI(iframeの親)側からの `akashic:AudioAsset#_load#success` または `akashic:AudioAsset#_load#failure` を待つ必要がある。
        setTimeout(function () { return loader._onAssetLoad(_this); });
    };
    PostMessageAudioAsset.prototype.destroy = function () {
        PostMessageAudioPlugin_1.PostMessageAudioPlugin.send("akashic:AudioAsset#destroy", { id: this.id });
        _super.prototype.destroy.call(this);
    };
    return PostMessageAudioAsset;
}(g.AudioAsset));
exports.PostMessageAudioAsset = PostMessageAudioAsset;

},{"./PostMessageAudioPlugin":72,"@akashic/akashic-engine":1}],71:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.PostMessageAudioPlayer = void 0;
var g = require("@akashic/akashic-engine");
var PostMessageAudioPlugin_1 = require("./PostMessageAudioPlugin");
var PostMessageAudioPlayer = /** @class */ (function (_super) {
    __extends(PostMessageAudioPlayer, _super);
    function PostMessageAudioPlayer(system, manager, id) {
        var _this = _super.call(this, system) || this;
        _this._manager = manager;
        _this.id = id;
        PostMessageAudioPlugin_1.PostMessageAudioPlugin.send("akashic:AudioPlayer#new", { id: id });
        return _this;
    }
    PostMessageAudioPlayer.prototype.play = function (asset) {
        PostMessageAudioPlugin_1.PostMessageAudioPlugin.send("akashic:AudioPlayer#play", { id: this.id, assetId: asset.id });
    };
    PostMessageAudioPlayer.prototype.stop = function () {
        PostMessageAudioPlugin_1.PostMessageAudioPlugin.send("akashic:AudioPlayer#stop", { id: this.id });
    };
    PostMessageAudioPlayer.prototype.changeVolume = function (volume) {
        _super.prototype.changeVolume.call(this, volume);
        PostMessageAudioPlugin_1.PostMessageAudioPlugin.send("akashic:AudioPlayer#changeVolume", { id: this.id, volume: this._calculateVolume() });
    };
    PostMessageAudioPlayer.prototype._changeMuted = function (muted) {
        _super.prototype._changeMuted.call(this, muted);
        PostMessageAudioPlugin_1.PostMessageAudioPlugin.send("akashic:AudioPlayer#changeVolume", { id: this.id, volume: this._calculateVolume() });
    };
    PostMessageAudioPlayer.prototype._changePlaybackRate = function (rate) {
        _super.prototype._changePlaybackRate.call(this, rate);
        PostMessageAudioPlugin_1.PostMessageAudioPlugin.send("akashic:AudioPlayer#changePlaybackRate", { id: this.id, rate: rate });
    };
    PostMessageAudioPlayer.prototype.notifyMasterVolumeChanged = function () {
        PostMessageAudioPlugin_1.PostMessageAudioPlugin.send("akashic:AudioPlayer#changeVolume", { id: this.id, volume: this._calculateVolume() });
    };
    PostMessageAudioPlayer.prototype._calculateVolume = function () {
        return this._muted ? 0 : this.volume * this._system.volume * this._manager.getMasterVolume();
    };
    return PostMessageAudioPlayer;
}(g.AudioPlayer));
exports.PostMessageAudioPlayer = PostMessageAudioPlayer;

},{"./PostMessageAudioPlugin":72,"@akashic/akashic-engine":1}],72:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PostMessageAudioPlugin = void 0;
var PostMessageAudioAsset_1 = require("./PostMessageAudioAsset");
var PostMessageAudioPlayer_1 = require("./PostMessageAudioPlayer");
var PostMessageHandler_1 = require("./PostMessageHandler");
var postMessageHandler;
var PostMessageAudioPlugin = /** @class */ (function () {
    function PostMessageAudioPlugin() {
        // NOTE: `AudioPlugin` を継承しているため、ここでは仮に undefined を指定しておく
        // `AudioPlugin#supportedFormats` の削除も検討
        this.supportedFormats = undefined;
        this._playerIdx = 0;
    }
    PostMessageAudioPlugin.isSupported = function () {
        return typeof window !== "undefined" && !!window.postMessage;
    };
    /**
     * 本pluginを初期化する。
     * TODO: デバッグ用に `postMessageHandler` のインスタンスを返している
     * TODO: このI/Fは将来的に変更される可能性がある
     */
    PostMessageAudioPlugin.initialize = function (targetWindow, targetOrigin) {
        postMessageHandler = new PostMessageHandler_1.PostMessageHandler(targetWindow, targetOrigin);
        // NOTE: AudioPluginのライフサイクルが未定なのでここで開始
        postMessageHandler.start();
        return postMessageHandler;
    };
    /**
     * PostMessageを送信する。
     * `PostMessageAudioPlugin#initialize()` 以降に呼び出さなければならない。
     */
    PostMessageAudioPlugin.send = function (type, parameters) {
        postMessageHandler.send({
            type: type,
            parameters: parameters
        });
    };
    PostMessageAudioPlugin.prototype.createAsset = function (id, assetPath, duration, system, loop, hint) {
        return new PostMessageAudioAsset_1.PostMessageAudioAsset(id, assetPath, duration, system, loop, hint);
    };
    PostMessageAudioPlugin.prototype.createPlayer = function (system, manager) {
        return new PostMessageAudioPlayer_1.PostMessageAudioPlayer(system, manager, "" + this._playerIdx++);
    };
    return PostMessageAudioPlugin;
}());
exports.PostMessageAudioPlugin = PostMessageAudioPlugin;

},{"./PostMessageAudioAsset":70,"./PostMessageAudioPlayer":71,"./PostMessageHandler":73}],73:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PostMessageHandler = void 0;
var g = require("@akashic/akashic-engine");
/**
 * PostMessageを利用したイベントエミッタ。
 * TODO: 暫定対応。このロジックを akashic-gameview-web 側に持たせる
 */
var PostMessageHandler = /** @class */ (function () {
    function PostMessageHandler(targetWindow, targetOrigin) {
        this.message = new g.Trigger();
        this.targetWindow = targetWindow;
        this.targetOrigin = targetOrigin;
        this.onMessage_bound = this.onMessage.bind(this);
    }
    PostMessageHandler.prototype.start = function () {
        window.addEventListener("message", this.onMessage_bound);
    };
    PostMessageHandler.prototype.stop = function () {
        window.removeEventListener("message", this.onMessage_bound);
    };
    PostMessageHandler.prototype.send = function (message) {
        this.targetWindow.postMessage(message, this.targetOrigin);
    };
    PostMessageHandler.prototype.onMessage = function (message) {
        if (message.origin !== this.targetOrigin) {
            return;
        }
        this.message.fire(message.data);
    };
    return PostMessageHandler;
}());
exports.PostMessageHandler = PostMessageHandler;

},{"@akashic/akashic-engine":1}],74:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProxyAudioAsset = void 0;
var g = require("@akashic/akashic-engine");
var ProxyAudioAsset = /** @class */ (function (_super) {
    __extends(ProxyAudioAsset, _super);
    function ProxyAudioAsset(handlerSet, id, assetPath, duration, system, loop, hint) {
        var _this = _super.call(this, id, assetPath, duration, system, loop, hint) || this;
        _this._handlerSet = handlerSet;
        return _this;
    }
    ProxyAudioAsset.prototype.destroy = function () {
        this._handlerSet.unloadAudioAsset(this.id);
        _super.prototype.destroy.call(this);
    };
    ProxyAudioAsset.prototype._load = function (loader) {
        var _this = this;
        this._handlerSet.loadAudioAsset({
            id: this.id,
            assetPath: this.path,
            duration: this.duration,
            loop: this.loop,
            hint: this.hint
        }, function (err) {
            if (err) {
                loader._onAssetError(_this, g.ExceptionFactory.createAssetLoadError(err));
            }
            else {
                loader._onAssetLoad(_this);
            }
        });
    };
    ProxyAudioAsset.prototype._assetPathFilter = function (path) {
        return path;
    };
    return ProxyAudioAsset;
}(g.AudioAsset));
exports.ProxyAudioAsset = ProxyAudioAsset;

},{"@akashic/akashic-engine":1}],75:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProxyAudioPlayer = void 0;
var g = require("@akashic/akashic-engine");
var ProxyAudioPlayer = /** @class */ (function (_super) {
    __extends(ProxyAudioPlayer, _super);
    function ProxyAudioPlayer(handlerSet, system, manager) {
        var _this = _super.call(this, system) || this;
        _this._audioPlayerId = null;
        _this._handlerSet = handlerSet;
        _this._manager = manager;
        return _this;
    }
    ProxyAudioPlayer.prototype.changeVolume = function (volume) {
        _super.prototype.changeVolume.call(this, volume);
        this._notifyVolumeToHandler();
    };
    ProxyAudioPlayer.prototype._changeMuted = function (muted) {
        _super.prototype._changeMuted.call(this, muted);
        this._notifyVolumeToHandler();
    };
    ProxyAudioPlayer.prototype.play = function (asset) {
        if (this._audioPlayerId != null) {
            this.stop();
        }
        this._audioPlayerId = "ap" + ProxyAudioPlayer._audioPlayerIdCounter++;
        this._handlerSet.createAudioPlayer({
            assetId: asset.id,
            audioPlayerId: this._audioPlayerId,
            isPlaying: true,
            volume: this._calculateVolume(),
            playbackRate: 1 // 未使用
        });
        _super.prototype.play.call(this, asset);
    };
    ProxyAudioPlayer.prototype.stop = function () {
        if (this._audioPlayerId != null) {
            this._handlerSet.stopAudioPlayer(this._audioPlayerId);
            this._handlerSet.destroyAudioPlayer(this._audioPlayerId);
            this._audioPlayerId = null;
        }
        _super.prototype.stop.call(this);
    };
    ProxyAudioPlayer.prototype.notifyMasterVolumeChanged = function () {
        this._notifyVolumeToHandler();
    };
    ProxyAudioPlayer.prototype._notifyVolumeToHandler = function () {
        if (this._audioPlayerId != null) {
            this._handlerSet.changeAudioVolume(this._audioPlayerId, this._calculateVolume());
        }
    };
    ProxyAudioPlayer.prototype._calculateVolume = function () {
        return this._muted ? 0 : this.volume * this._system.volume * this._manager.getMasterVolume();
    };
    ProxyAudioPlayer._audioPlayerIdCounter = 0;
    return ProxyAudioPlayer;
}(g.AudioPlayer));
exports.ProxyAudioPlayer = ProxyAudioPlayer;

},{"@akashic/akashic-engine":1}],76:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProxyAudioPlugin = void 0;
var ProxyAudioAsset_1 = require("./ProxyAudioAsset");
var ProxyAudioPlayer_1 = require("./ProxyAudioPlayer");
var ProxyAudioPlugin = /** @class */ (function () {
    function ProxyAudioPlugin(handlerSet) {
        this.supportedFormats = [];
        this._handlerSet = handlerSet;
    }
    ProxyAudioPlugin.isSupported = function () {
        return true;
    };
    ProxyAudioPlugin.prototype.createAsset = function (id, assetPath, duration, system, loop, hint) {
        return new ProxyAudioAsset_1.ProxyAudioAsset(this._handlerSet, id, assetPath, duration, system, loop, hint);
    };
    ProxyAudioPlugin.prototype.createPlayer = function (system, manager) {
        return new ProxyAudioPlayer_1.ProxyAudioPlayer(this._handlerSet, system, manager);
    };
    return ProxyAudioPlugin;
}());
exports.ProxyAudioPlugin = ProxyAudioPlugin;

},{"./ProxyAudioAsset":74,"./ProxyAudioPlayer":75}],77:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebAudioAsset = void 0;
var g = require("@akashic/akashic-engine");
var XHRLoader_1 = require("../../utils/XHRLoader");
var helper = require("./WebAudioHelper");
var WebAudioAsset = /** @class */ (function (_super) {
    __extends(WebAudioAsset, _super);
    function WebAudioAsset() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    WebAudioAsset.prototype._load = function (loader) {
        var _this = this;
        if (this.path == null) {
            // 再生可能な形式がない。実際には鳴らない音声としてロード成功しておく
            this.data = null;
            setTimeout(function () { return loader._onAssetLoad(_this); }, 0);
            return;
        }
        var successHandler = function (decodedAudio) {
            _this.data = decodedAudio;
            loader._onAssetLoad(_this);
        };
        var errorHandler = function () {
            loader._onAssetError(_this, g.ExceptionFactory.createAssetLoadError("WebAudioAsset unknown loading error"));
        };
        var onLoadArrayBufferHandler = function (response) {
            var audioContext = helper.getAudioContext();
            audioContext.decodeAudioData(response, successHandler, errorHandler);
        };
        var xhrLoader = new XHRLoader_1.XHRLoader();
        var loadArrayBuffer = function (path, onSuccess, onFailed) {
            xhrLoader.getArrayBuffer(path, function (error, response) {
                error ? onFailed(error) : onSuccess(response);
            });
        };
        var delIndex = this.path.indexOf("?");
        var basePath = delIndex >= 0 ? this.path.substring(0, delIndex) : this.path;
        if (basePath.slice(-4) === ".aac") {
            // 暫定対応：後方互換性のため、aacファイルが無い場合はmp4へのフォールバックを試みる。
            // この対応を止める際には、WebAudioPluginのsupportedExtensionsからaacを除外する必要がある。
            loadArrayBuffer(this.path, onLoadArrayBufferHandler, function (error) {
                var altPath = g.PathUtil.addExtname(_this.originalPath, "mp4");
                loadArrayBuffer(altPath, function (response) {
                    _this.path = altPath;
                    onLoadArrayBufferHandler(response);
                }, errorHandler);
            });
            return;
        }
        loadArrayBuffer(this.path, onLoadArrayBufferHandler, errorHandler);
    };
    WebAudioAsset.prototype._assetPathFilter = function (path) {
        if (WebAudioAsset.supportedFormats.indexOf("ogg") !== -1) {
            return g.PathUtil.addExtname(path, "ogg");
        }
        if (WebAudioAsset.supportedFormats.indexOf("aac") !== -1) {
            return g.PathUtil.addExtname(path, "aac");
        }
        // ここで検出されるのは最初にアクセスを試みるオーディオアセットのファイルパスなので、
        // supportedFormatsに(後方互換性保持で使う可能性がある)mp4が含まれていても利用しない
        return null;
    };
    // _assetPathFilterの判定処理を小さくするため、予めサポートしてる拡張子一覧を持つ
    WebAudioAsset.supportedFormats = [];
    return WebAudioAsset;
}(g.AudioAsset));
exports.WebAudioAsset = WebAudioAsset;

},{"../../utils/XHRLoader":82,"./WebAudioHelper":79,"@akashic/akashic-engine":1}],78:[function(require,module,exports){
"use strict";
var helper = require("./WebAudioHelper");
// chrome66以降などのブラウザに導入されるAutoplay Policyに対応する
// https://developers.google.com/web/updates/2017/09/autoplay-policy-changes
var WebAudioAutoplayHelper;
(function (WebAudioAutoplayHelper) {
    function setupChromeMEIWorkaround() {
        var context = helper.getAudioContext();
        if (context && typeof context.resume !== "function")
            return;
        var gain = helper.createGainNode(context);
        // テスト用の音源を用意する
        var osc = context.createOscillator();
        osc.type = "sawtooth";
        osc.frequency.value = 440; // 何でも良いがドの音
        osc.connect(gain);
        osc.start(0);
        var contextState = context.state;
        osc.disconnect();
        if (contextState !== "running")
            setUserInteractListener();
    }
    WebAudioAutoplayHelper.setupChromeMEIWorkaround = setupChromeMEIWorkaround;
})(WebAudioAutoplayHelper || (WebAudioAutoplayHelper = {}));
function resumeHandler() {
    var context = helper.getAudioContext();
    context.resume();
    clearUserInteractListener();
}
function setUserInteractListener() {
    document.addEventListener("keydown", resumeHandler, true);
    document.addEventListener("mousedown", resumeHandler, true);
    document.addEventListener("touchend", resumeHandler, true);
}
function clearUserInteractListener() {
    document.removeEventListener("keydown", resumeHandler);
    document.removeEventListener("mousedown", resumeHandler);
    document.removeEventListener("touchend", resumeHandler);
}
module.exports = WebAudioAutoplayHelper;

},{"./WebAudioHelper":79}],79:[function(require,module,exports){
"use strict";
// WebAudioのブラウザ間の差を吸収する
// Compatible Table: http://compatibility.shwups-cms.ch/en/home?&property=AudioParam.prototype
// http://qiita.com/mohayonao/items/d79e9fc56b4e9c157be1#polyfill
// https://github.com/cwilso/webkitAudioContext-MonkeyPatch
// https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Porting_webkitAudioContext_code_to_standards_based_AudioContext
var AudioContext = window.AudioContext || window.webkitAudioContext;
var WebAudioHelper;
(function (WebAudioHelper) {
    // AudioContextをシングルトンとして取得する
    // 一つのページに一つのContextが存在すれば良い
    function getAudioContext() {
        if (!window.__akashic__) {
            Object.defineProperty(window, "__akashic__", {
                value: {},
                enumerable: false,
                configurable: false,
                writable: false
            });
        }
        var ctx = window.__akashic__.audioContext;
        if (!(ctx instanceof AudioContext)) {
            ctx = window.__akashic__.audioContext = new AudioContext();
            WebAudioHelper._workAroundSafari();
        }
        return ctx;
    }
    WebAudioHelper.getAudioContext = getAudioContext;
    function createGainNode(context) {
        if (context.createGain) {
            return context.createGain();
        }
        return context.createGainNode();
    }
    WebAudioHelper.createGainNode = createGainNode;
    function createBufferNode(context) {
        var sourceNode = context.createBufferSource();
        // startがあるなら問題ないので、拡張しないで返す
        if (sourceNode.start) {
            return sourceNode;
        }
        // start/stopがない環境へのエイリアスを貼る
        sourceNode.start = sourceNode.noteOn;
        sourceNode.stop = sourceNode.noteOff;
        return sourceNode;
    }
    WebAudioHelper.createBufferNode = createBufferNode;
    // Safari対策ワークアラウンド
    function _workAroundSafari() {
        document.addEventListener("touchstart", function touchInitializeHandler() {
            document.removeEventListener("touchstart", touchInitializeHandler);
            WebAudioHelper.getAudioContext().createBufferSource().start(0);
        }, true);
    }
    WebAudioHelper._workAroundSafari = _workAroundSafari;
})(WebAudioHelper || (WebAudioHelper = {}));
module.exports = WebAudioHelper;

},{}],80:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebAudioPlayer = void 0;
var g = require("@akashic/akashic-engine");
var helper = require("./WebAudioHelper");
var WebAudioPlayer = /** @class */ (function (_super) {
    __extends(WebAudioPlayer, _super);
    function WebAudioPlayer(system, manager) {
        var _this = _super.call(this, system) || this;
        _this._audioContext = helper.getAudioContext();
        _this._manager = manager;
        _this._gainNode = helper.createGainNode(_this._audioContext);
        _this._gainNode.connect(_this._audioContext.destination);
        _this._sourceNode = undefined;
        _this._dummyDurationWaitTimer = null;
        _this._endedEventHandler = function () {
            _this._onAudioEnded();
        };
        return _this;
    }
    WebAudioPlayer.prototype.changeVolume = function (volume) {
        _super.prototype.changeVolume.call(this, volume);
        this._gainNode.gain.value = this._calculateVolume();
    };
    WebAudioPlayer.prototype._changeMuted = function (muted) {
        _super.prototype._changeMuted.call(this, muted);
        this._gainNode.gain.value = this._calculateVolume();
    };
    WebAudioPlayer.prototype.play = function (asset) {
        if (this.currentAudio) {
            this.stop();
        }
        if (asset.data) {
            var bufferNode = helper.createBufferNode(this._audioContext);
            bufferNode.loop = asset.loop;
            bufferNode.buffer = asset.data;
            this._gainNode.gain.value = this._calculateVolume();
            bufferNode.connect(this._gainNode);
            this._sourceNode = bufferNode;
            // Chromeだとevent listerで指定した場合に動かないことがある
            // https://github.com/mozilla-appmaker/appmaker/issues/1984
            this._sourceNode.onended = this._endedEventHandler;
            this._sourceNode.start(0);
        }
        else {
            // 再生できるオーディオがない場合。duration後に停止処理だけ行う(処理のみ進め音は鳴らさない)
            this._dummyDurationWaitTimer = setTimeout(this._endedEventHandler, asset.duration);
        }
        _super.prototype.play.call(this, asset);
    };
    WebAudioPlayer.prototype.stop = function () {
        if (!this.currentAudio) {
            _super.prototype.stop.call(this);
            return;
        }
        this._clearEndedEventHandler();
        if (this._sourceNode)
            this._sourceNode.stop(0);
        _super.prototype.stop.call(this);
    };
    WebAudioPlayer.prototype.notifyMasterVolumeChanged = function () {
        this._gainNode.gain.value = this._calculateVolume();
    };
    WebAudioPlayer.prototype._onAudioEnded = function () {
        this._clearEndedEventHandler();
        _super.prototype.stop.call(this);
    };
    WebAudioPlayer.prototype._clearEndedEventHandler = function () {
        if (this._sourceNode)
            this._sourceNode.onended = null;
        if (this._dummyDurationWaitTimer != null) {
            clearTimeout(this._dummyDurationWaitTimer);
            this._dummyDurationWaitTimer = null;
        }
    };
    WebAudioPlayer.prototype._calculateVolume = function () {
        return this._muted ? 0 : this.volume * this._system.volume * this._manager.getMasterVolume();
    };
    return WebAudioPlayer;
}(g.AudioPlayer));
exports.WebAudioPlayer = WebAudioPlayer;

},{"./WebAudioHelper":79,"@akashic/akashic-engine":1}],81:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebAudioPlugin = void 0;
var WebAudioAsset_1 = require("./WebAudioAsset");
var WebAudioPlayer_1 = require("./WebAudioPlayer");
var autoPlayHelper = require("./WebAudioAutoplayHelper");
var WebAudioPlugin = /** @class */ (function () {
    /* tslint:enable:typedef */
    function WebAudioPlugin() {
        this.supportedFormats = this._detectSupportedFormats();
        autoPlayHelper.setupChromeMEIWorkaround();
    }
    // AudioContextが存在するかどうかで判定する
    // http://mohayonao.hatenablog.com/entry/2012/12/12/103009
    // https://github.com/Modernizr/Modernizr/blob/master/feature-detects/audio/webaudio.js
    WebAudioPlugin.isSupported = function () {
        if ("AudioContext" in window) {
            return true;
        }
        else if ("webkitAudioContext" in window) {
            return true;
        }
        return false;
    };
    Object.defineProperty(WebAudioPlugin.prototype, "supportedFormats", {
        get: function () {
            return this._supportedFormats;
        },
        // TSLintのバグ - setterはreturn typeを書くとコンパイルエラーとなる
        /* tslint:disable:typedef */
        // WebAudioAssetへサポートしているフォーマット一覧を渡す
        set: function (supportedFormats) {
            this._supportedFormats = supportedFormats;
            WebAudioAsset_1.WebAudioAsset.supportedFormats = supportedFormats;
        },
        enumerable: false,
        configurable: true
    });
    WebAudioPlugin.prototype.createAsset = function (id, assetPath, duration, system, loop, hint) {
        return new WebAudioAsset_1.WebAudioAsset(id, assetPath, duration, system, loop, hint);
    };
    WebAudioPlugin.prototype.createPlayer = function (system, manager) {
        return new WebAudioPlayer_1.WebAudioPlayer(system, manager);
    };
    WebAudioPlugin.prototype._detectSupportedFormats = function () {
        // Edgeは再生できるファイル形式とcanPlayTypeの結果が一致しないため、固定でAACを利用する
        if (navigator.userAgent.indexOf("Edge/") !== -1)
            return ["aac"];
        // Audio要素を実際に作って、canPlayTypeで再生できるかを判定する
        var audioElement = document.createElement("audio");
        var supportedFormats = [];
        try {
            var supportedExtensions = ["ogg", "aac", "mp4"];
            for (var i = 0, len = supportedExtensions.length; i < len; i++) {
                var ext = supportedExtensions[i];
                var canPlay = audioElement.canPlayType("audio/" + ext);
                var supported = (canPlay !== "no" && canPlay !== "");
                if (supported) {
                    supportedFormats.push(ext);
                }
            }
        }
        catch (e) {
            // ignore Error
        }
        return supportedFormats;
    };
    return WebAudioPlugin;
}());
exports.WebAudioPlugin = WebAudioPlugin;

},{"./WebAudioAsset":77,"./WebAudioAutoplayHelper":78,"./WebAudioPlayer":80}],82:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.XHRLoader = void 0;
var g = require("@akashic/akashic-engine");
var XHRLoader = /** @class */ (function () {
    function XHRLoader(options) {
        if (options === void 0) { options = {}; }
        // デフォルトのタイムアウトは15秒
        // TODO: タイムアウト値はこれが妥当であるか後日詳細を検討する
        this.timeout = options.timeout || 15000;
    }
    XHRLoader.prototype.get = function (url, callback) {
        this._getRequestObject({
            url: url,
            responseType: "text"
        }, callback);
    };
    XHRLoader.prototype.getArrayBuffer = function (url, callback) {
        this._getRequestObject({
            url: url,
            responseType: "arraybuffer"
        }, callback);
    };
    XHRLoader.prototype._getRequestObject = function (requestObject, callback) {
        var request = new XMLHttpRequest();
        request.open("GET", requestObject.url, true);
        request.responseType = requestObject.responseType;
        request.timeout = this.timeout;
        request.addEventListener("timeout", function () {
            callback(g.ExceptionFactory.createAssetLoadError("loading timeout"));
        }, false);
        request.addEventListener("load", function () {
            if (request.status >= 200 && request.status < 300) {
                // "text" とそれ以外で取得方法を分類する
                var response = requestObject.responseType === "text" ? request.responseText : request.response;
                callback(null, response);
            }
            else {
                callback(g.ExceptionFactory.createAssetLoadError("loading error. status: " + request.status));
            }
        }, false);
        request.addEventListener("error", function () {
            callback(g.ExceptionFactory.createAssetLoadError("loading error. status: " + request.status));
        }, false);
        request.send();
    };
    return XHRLoader;
}());
exports.XHRLoader = XHRLoader;

},{"@akashic/akashic-engine":1}],83:[function(require,module,exports){
(function (process,global){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */

(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
	typeof define === 'function' && define.amd ? define(factory) :
	(global.ES6Promise = factory());
}(this, (function () { 'use strict';

function objectOrFunction(x) {
  var type = typeof x;
  return x !== null && (type === 'object' || type === 'function');
}

function isFunction(x) {
  return typeof x === 'function';
}



var _isArray = void 0;
if (Array.isArray) {
  _isArray = Array.isArray;
} else {
  _isArray = function (x) {
    return Object.prototype.toString.call(x) === '[object Array]';
  };
}

var isArray = _isArray;

var len = 0;
var vertxNext = void 0;
var customSchedulerFn = void 0;

var asap = function asap(callback, arg) {
  queue[len] = callback;
  queue[len + 1] = arg;
  len += 2;
  if (len === 2) {
    // If len is 2, that means that we need to schedule an async flush.
    // If additional callbacks are queued before the queue is flushed, they
    // will be processed by this flush that we are scheduling.
    if (customSchedulerFn) {
      customSchedulerFn(flush);
    } else {
      scheduleFlush();
    }
  }
};

function setScheduler(scheduleFn) {
  customSchedulerFn = scheduleFn;
}

function setAsap(asapFn) {
  asap = asapFn;
}

var browserWindow = typeof window !== 'undefined' ? window : undefined;
var browserGlobal = browserWindow || {};
var BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;
var isNode = typeof self === 'undefined' && typeof process !== 'undefined' && {}.toString.call(process) === '[object process]';

// test for web worker but not in IE10
var isWorker = typeof Uint8ClampedArray !== 'undefined' && typeof importScripts !== 'undefined' && typeof MessageChannel !== 'undefined';

// node
function useNextTick() {
  // node version 0.10.x displays a deprecation warning when nextTick is used recursively
  // see https://github.com/cujojs/when/issues/410 for details
  return function () {
    return process.nextTick(flush);
  };
}

// vertx
function useVertxTimer() {
  if (typeof vertxNext !== 'undefined') {
    return function () {
      vertxNext(flush);
    };
  }

  return useSetTimeout();
}

function useMutationObserver() {
  var iterations = 0;
  var observer = new BrowserMutationObserver(flush);
  var node = document.createTextNode('');
  observer.observe(node, { characterData: true });

  return function () {
    node.data = iterations = ++iterations % 2;
  };
}

// web worker
function useMessageChannel() {
  var channel = new MessageChannel();
  channel.port1.onmessage = flush;
  return function () {
    return channel.port2.postMessage(0);
  };
}

function useSetTimeout() {
  // Store setTimeout reference so es6-promise will be unaffected by
  // other code modifying setTimeout (like sinon.useFakeTimers())
  var globalSetTimeout = setTimeout;
  return function () {
    return globalSetTimeout(flush, 1);
  };
}

var queue = new Array(1000);
function flush() {
  for (var i = 0; i < len; i += 2) {
    var callback = queue[i];
    var arg = queue[i + 1];

    callback(arg);

    queue[i] = undefined;
    queue[i + 1] = undefined;
  }

  len = 0;
}

function attemptVertx() {
  try {
    var vertx = Function('return this')().require('vertx');
    vertxNext = vertx.runOnLoop || vertx.runOnContext;
    return useVertxTimer();
  } catch (e) {
    return useSetTimeout();
  }
}

var scheduleFlush = void 0;
// Decide what async method to use to triggering processing of queued callbacks:
if (isNode) {
  scheduleFlush = useNextTick();
} else if (BrowserMutationObserver) {
  scheduleFlush = useMutationObserver();
} else if (isWorker) {
  scheduleFlush = useMessageChannel();
} else if (browserWindow === undefined && typeof require === 'function') {
  scheduleFlush = attemptVertx();
} else {
  scheduleFlush = useSetTimeout();
}

function then(onFulfillment, onRejection) {
  var parent = this;

  var child = new this.constructor(noop);

  if (child[PROMISE_ID] === undefined) {
    makePromise(child);
  }

  var _state = parent._state;


  if (_state) {
    var callback = arguments[_state - 1];
    asap(function () {
      return invokeCallback(_state, child, callback, parent._result);
    });
  } else {
    subscribe(parent, child, onFulfillment, onRejection);
  }

  return child;
}

/**
  `Promise.resolve` returns a promise that will become resolved with the
  passed `value`. It is shorthand for the following:

  ```javascript
  let promise = new Promise(function(resolve, reject){
    resolve(1);
  });

  promise.then(function(value){
    // value === 1
  });
  ```

  Instead of writing the above, your code now simply becomes the following:

  ```javascript
  let promise = Promise.resolve(1);

  promise.then(function(value){
    // value === 1
  });
  ```

  @method resolve
  @static
  @param {Any} value value that the returned promise will be resolved with
  Useful for tooling.
  @return {Promise} a promise that will become fulfilled with the given
  `value`
*/
function resolve$1(object) {
  /*jshint validthis:true */
  var Constructor = this;

  if (object && typeof object === 'object' && object.constructor === Constructor) {
    return object;
  }

  var promise = new Constructor(noop);
  resolve(promise, object);
  return promise;
}

var PROMISE_ID = Math.random().toString(36).substring(2);

function noop() {}

var PENDING = void 0;
var FULFILLED = 1;
var REJECTED = 2;

function selfFulfillment() {
  return new TypeError("You cannot resolve a promise with itself");
}

function cannotReturnOwn() {
  return new TypeError('A promises callback cannot return that same promise.');
}

function tryThen(then$$1, value, fulfillmentHandler, rejectionHandler) {
  try {
    then$$1.call(value, fulfillmentHandler, rejectionHandler);
  } catch (e) {
    return e;
  }
}

function handleForeignThenable(promise, thenable, then$$1) {
  asap(function (promise) {
    var sealed = false;
    var error = tryThen(then$$1, thenable, function (value) {
      if (sealed) {
        return;
      }
      sealed = true;
      if (thenable !== value) {
        resolve(promise, value);
      } else {
        fulfill(promise, value);
      }
    }, function (reason) {
      if (sealed) {
        return;
      }
      sealed = true;

      reject(promise, reason);
    }, 'Settle: ' + (promise._label || ' unknown promise'));

    if (!sealed && error) {
      sealed = true;
      reject(promise, error);
    }
  }, promise);
}

function handleOwnThenable(promise, thenable) {
  if (thenable._state === FULFILLED) {
    fulfill(promise, thenable._result);
  } else if (thenable._state === REJECTED) {
    reject(promise, thenable._result);
  } else {
    subscribe(thenable, undefined, function (value) {
      return resolve(promise, value);
    }, function (reason) {
      return reject(promise, reason);
    });
  }
}

function handleMaybeThenable(promise, maybeThenable, then$$1) {
  if (maybeThenable.constructor === promise.constructor && then$$1 === then && maybeThenable.constructor.resolve === resolve$1) {
    handleOwnThenable(promise, maybeThenable);
  } else {
    if (then$$1 === undefined) {
      fulfill(promise, maybeThenable);
    } else if (isFunction(then$$1)) {
      handleForeignThenable(promise, maybeThenable, then$$1);
    } else {
      fulfill(promise, maybeThenable);
    }
  }
}

function resolve(promise, value) {
  if (promise === value) {
    reject(promise, selfFulfillment());
  } else if (objectOrFunction(value)) {
    var then$$1 = void 0;
    try {
      then$$1 = value.then;
    } catch (error) {
      reject(promise, error);
      return;
    }
    handleMaybeThenable(promise, value, then$$1);
  } else {
    fulfill(promise, value);
  }
}

function publishRejection(promise) {
  if (promise._onerror) {
    promise._onerror(promise._result);
  }

  publish(promise);
}

function fulfill(promise, value) {
  if (promise._state !== PENDING) {
    return;
  }

  promise._result = value;
  promise._state = FULFILLED;

  if (promise._subscribers.length !== 0) {
    asap(publish, promise);
  }
}

function reject(promise, reason) {
  if (promise._state !== PENDING) {
    return;
  }
  promise._state = REJECTED;
  promise._result = reason;

  asap(publishRejection, promise);
}

function subscribe(parent, child, onFulfillment, onRejection) {
  var _subscribers = parent._subscribers;
  var length = _subscribers.length;


  parent._onerror = null;

  _subscribers[length] = child;
  _subscribers[length + FULFILLED] = onFulfillment;
  _subscribers[length + REJECTED] = onRejection;

  if (length === 0 && parent._state) {
    asap(publish, parent);
  }
}

function publish(promise) {
  var subscribers = promise._subscribers;
  var settled = promise._state;

  if (subscribers.length === 0) {
    return;
  }

  var child = void 0,
      callback = void 0,
      detail = promise._result;

  for (var i = 0; i < subscribers.length; i += 3) {
    child = subscribers[i];
    callback = subscribers[i + settled];

    if (child) {
      invokeCallback(settled, child, callback, detail);
    } else {
      callback(detail);
    }
  }

  promise._subscribers.length = 0;
}

function invokeCallback(settled, promise, callback, detail) {
  var hasCallback = isFunction(callback),
      value = void 0,
      error = void 0,
      succeeded = true;

  if (hasCallback) {
    try {
      value = callback(detail);
    } catch (e) {
      succeeded = false;
      error = e;
    }

    if (promise === value) {
      reject(promise, cannotReturnOwn());
      return;
    }
  } else {
    value = detail;
  }

  if (promise._state !== PENDING) {
    // noop
  } else if (hasCallback && succeeded) {
    resolve(promise, value);
  } else if (succeeded === false) {
    reject(promise, error);
  } else if (settled === FULFILLED) {
    fulfill(promise, value);
  } else if (settled === REJECTED) {
    reject(promise, value);
  }
}

function initializePromise(promise, resolver) {
  try {
    resolver(function resolvePromise(value) {
      resolve(promise, value);
    }, function rejectPromise(reason) {
      reject(promise, reason);
    });
  } catch (e) {
    reject(promise, e);
  }
}

var id = 0;
function nextId() {
  return id++;
}

function makePromise(promise) {
  promise[PROMISE_ID] = id++;
  promise._state = undefined;
  promise._result = undefined;
  promise._subscribers = [];
}

function validationError() {
  return new Error('Array Methods must be provided an Array');
}

var Enumerator = function () {
  function Enumerator(Constructor, input) {
    this._instanceConstructor = Constructor;
    this.promise = new Constructor(noop);

    if (!this.promise[PROMISE_ID]) {
      makePromise(this.promise);
    }

    if (isArray(input)) {
      this.length = input.length;
      this._remaining = input.length;

      this._result = new Array(this.length);

      if (this.length === 0) {
        fulfill(this.promise, this._result);
      } else {
        this.length = this.length || 0;
        this._enumerate(input);
        if (this._remaining === 0) {
          fulfill(this.promise, this._result);
        }
      }
    } else {
      reject(this.promise, validationError());
    }
  }

  Enumerator.prototype._enumerate = function _enumerate(input) {
    for (var i = 0; this._state === PENDING && i < input.length; i++) {
      this._eachEntry(input[i], i);
    }
  };

  Enumerator.prototype._eachEntry = function _eachEntry(entry, i) {
    var c = this._instanceConstructor;
    var resolve$$1 = c.resolve;


    if (resolve$$1 === resolve$1) {
      var _then = void 0;
      var error = void 0;
      var didError = false;
      try {
        _then = entry.then;
      } catch (e) {
        didError = true;
        error = e;
      }

      if (_then === then && entry._state !== PENDING) {
        this._settledAt(entry._state, i, entry._result);
      } else if (typeof _then !== 'function') {
        this._remaining--;
        this._result[i] = entry;
      } else if (c === Promise$1) {
        var promise = new c(noop);
        if (didError) {
          reject(promise, error);
        } else {
          handleMaybeThenable(promise, entry, _then);
        }
        this._willSettleAt(promise, i);
      } else {
        this._willSettleAt(new c(function (resolve$$1) {
          return resolve$$1(entry);
        }), i);
      }
    } else {
      this._willSettleAt(resolve$$1(entry), i);
    }
  };

  Enumerator.prototype._settledAt = function _settledAt(state, i, value) {
    var promise = this.promise;


    if (promise._state === PENDING) {
      this._remaining--;

      if (state === REJECTED) {
        reject(promise, value);
      } else {
        this._result[i] = value;
      }
    }

    if (this._remaining === 0) {
      fulfill(promise, this._result);
    }
  };

  Enumerator.prototype._willSettleAt = function _willSettleAt(promise, i) {
    var enumerator = this;

    subscribe(promise, undefined, function (value) {
      return enumerator._settledAt(FULFILLED, i, value);
    }, function (reason) {
      return enumerator._settledAt(REJECTED, i, reason);
    });
  };

  return Enumerator;
}();

/**
  `Promise.all` accepts an array of promises, and returns a new promise which
  is fulfilled with an array of fulfillment values for the passed promises, or
  rejected with the reason of the first passed promise to be rejected. It casts all
  elements of the passed iterable to promises as it runs this algorithm.

  Example:

  ```javascript
  let promise1 = resolve(1);
  let promise2 = resolve(2);
  let promise3 = resolve(3);
  let promises = [ promise1, promise2, promise3 ];

  Promise.all(promises).then(function(array){
    // The array here would be [ 1, 2, 3 ];
  });
  ```

  If any of the `promises` given to `all` are rejected, the first promise
  that is rejected will be given as an argument to the returned promises's
  rejection handler. For example:

  Example:

  ```javascript
  let promise1 = resolve(1);
  let promise2 = reject(new Error("2"));
  let promise3 = reject(new Error("3"));
  let promises = [ promise1, promise2, promise3 ];

  Promise.all(promises).then(function(array){
    // Code here never runs because there are rejected promises!
  }, function(error) {
    // error.message === "2"
  });
  ```

  @method all
  @static
  @param {Array} entries array of promises
  @param {String} label optional string for labeling the promise.
  Useful for tooling.
  @return {Promise} promise that is fulfilled when all `promises` have been
  fulfilled, or rejected if any of them become rejected.
  @static
*/
function all(entries) {
  return new Enumerator(this, entries).promise;
}

/**
  `Promise.race` returns a new promise which is settled in the same way as the
  first passed promise to settle.

  Example:

  ```javascript
  let promise1 = new Promise(function(resolve, reject){
    setTimeout(function(){
      resolve('promise 1');
    }, 200);
  });

  let promise2 = new Promise(function(resolve, reject){
    setTimeout(function(){
      resolve('promise 2');
    }, 100);
  });

  Promise.race([promise1, promise2]).then(function(result){
    // result === 'promise 2' because it was resolved before promise1
    // was resolved.
  });
  ```

  `Promise.race` is deterministic in that only the state of the first
  settled promise matters. For example, even if other promises given to the
  `promises` array argument are resolved, but the first settled promise has
  become rejected before the other promises became fulfilled, the returned
  promise will become rejected:

  ```javascript
  let promise1 = new Promise(function(resolve, reject){
    setTimeout(function(){
      resolve('promise 1');
    }, 200);
  });

  let promise2 = new Promise(function(resolve, reject){
    setTimeout(function(){
      reject(new Error('promise 2'));
    }, 100);
  });

  Promise.race([promise1, promise2]).then(function(result){
    // Code here never runs
  }, function(reason){
    // reason.message === 'promise 2' because promise 2 became rejected before
    // promise 1 became fulfilled
  });
  ```

  An example real-world use case is implementing timeouts:

  ```javascript
  Promise.race([ajax('foo.json'), timeout(5000)])
  ```

  @method race
  @static
  @param {Array} promises array of promises to observe
  Useful for tooling.
  @return {Promise} a promise which settles in the same way as the first passed
  promise to settle.
*/
function race(entries) {
  /*jshint validthis:true */
  var Constructor = this;

  if (!isArray(entries)) {
    return new Constructor(function (_, reject) {
      return reject(new TypeError('You must pass an array to race.'));
    });
  } else {
    return new Constructor(function (resolve, reject) {
      var length = entries.length;
      for (var i = 0; i < length; i++) {
        Constructor.resolve(entries[i]).then(resolve, reject);
      }
    });
  }
}

/**
  `Promise.reject` returns a promise rejected with the passed `reason`.
  It is shorthand for the following:

  ```javascript
  let promise = new Promise(function(resolve, reject){
    reject(new Error('WHOOPS'));
  });

  promise.then(function(value){
    // Code here doesn't run because the promise is rejected!
  }, function(reason){
    // reason.message === 'WHOOPS'
  });
  ```

  Instead of writing the above, your code now simply becomes the following:

  ```javascript
  let promise = Promise.reject(new Error('WHOOPS'));

  promise.then(function(value){
    // Code here doesn't run because the promise is rejected!
  }, function(reason){
    // reason.message === 'WHOOPS'
  });
  ```

  @method reject
  @static
  @param {Any} reason value that the returned promise will be rejected with.
  Useful for tooling.
  @return {Promise} a promise rejected with the given `reason`.
*/
function reject$1(reason) {
  /*jshint validthis:true */
  var Constructor = this;
  var promise = new Constructor(noop);
  reject(promise, reason);
  return promise;
}

function needsResolver() {
  throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');
}

function needsNew() {
  throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
}

/**
  Promise objects represent the eventual result of an asynchronous operation. The
  primary way of interacting with a promise is through its `then` method, which
  registers callbacks to receive either a promise's eventual value or the reason
  why the promise cannot be fulfilled.

  Terminology
  -----------

  - `promise` is an object or function with a `then` method whose behavior conforms to this specification.
  - `thenable` is an object or function that defines a `then` method.
  - `value` is any legal JavaScript value (including undefined, a thenable, or a promise).
  - `exception` is a value that is thrown using the throw statement.
  - `reason` is a value that indicates why a promise was rejected.
  - `settled` the final resting state of a promise, fulfilled or rejected.

  A promise can be in one of three states: pending, fulfilled, or rejected.

  Promises that are fulfilled have a fulfillment value and are in the fulfilled
  state.  Promises that are rejected have a rejection reason and are in the
  rejected state.  A fulfillment value is never a thenable.

  Promises can also be said to *resolve* a value.  If this value is also a
  promise, then the original promise's settled state will match the value's
  settled state.  So a promise that *resolves* a promise that rejects will
  itself reject, and a promise that *resolves* a promise that fulfills will
  itself fulfill.


  Basic Usage:
  ------------

  ```js
  let promise = new Promise(function(resolve, reject) {
    // on success
    resolve(value);

    // on failure
    reject(reason);
  });

  promise.then(function(value) {
    // on fulfillment
  }, function(reason) {
    // on rejection
  });
  ```

  Advanced Usage:
  ---------------

  Promises shine when abstracting away asynchronous interactions such as
  `XMLHttpRequest`s.

  ```js
  function getJSON(url) {
    return new Promise(function(resolve, reject){
      let xhr = new XMLHttpRequest();

      xhr.open('GET', url);
      xhr.onreadystatechange = handler;
      xhr.responseType = 'json';
      xhr.setRequestHeader('Accept', 'application/json');
      xhr.send();

      function handler() {
        if (this.readyState === this.DONE) {
          if (this.status === 200) {
            resolve(this.response);
          } else {
            reject(new Error('getJSON: `' + url + '` failed with status: [' + this.status + ']'));
          }
        }
      };
    });
  }

  getJSON('/posts.json').then(function(json) {
    // on fulfillment
  }, function(reason) {
    // on rejection
  });
  ```

  Unlike callbacks, promises are great composable primitives.

  ```js
  Promise.all([
    getJSON('/posts'),
    getJSON('/comments')
  ]).then(function(values){
    values[0] // => postsJSON
    values[1] // => commentsJSON

    return values;
  });
  ```

  @class Promise
  @param {Function} resolver
  Useful for tooling.
  @constructor
*/

var Promise$1 = function () {
  function Promise(resolver) {
    this[PROMISE_ID] = nextId();
    this._result = this._state = undefined;
    this._subscribers = [];

    if (noop !== resolver) {
      typeof resolver !== 'function' && needsResolver();
      this instanceof Promise ? initializePromise(this, resolver) : needsNew();
    }
  }

  /**
  The primary way of interacting with a promise is through its `then` method,
  which registers callbacks to receive either a promise's eventual value or the
  reason why the promise cannot be fulfilled.
   ```js
  findUser().then(function(user){
    // user is available
  }, function(reason){
    // user is unavailable, and you are given the reason why
  });
  ```
   Chaining
  --------
   The return value of `then` is itself a promise.  This second, 'downstream'
  promise is resolved with the return value of the first promise's fulfillment
  or rejection handler, or rejected if the handler throws an exception.
   ```js
  findUser().then(function (user) {
    return user.name;
  }, function (reason) {
    return 'default name';
  }).then(function (userName) {
    // If `findUser` fulfilled, `userName` will be the user's name, otherwise it
    // will be `'default name'`
  });
   findUser().then(function (user) {
    throw new Error('Found user, but still unhappy');
  }, function (reason) {
    throw new Error('`findUser` rejected and we're unhappy');
  }).then(function (value) {
    // never reached
  }, function (reason) {
    // if `findUser` fulfilled, `reason` will be 'Found user, but still unhappy'.
    // If `findUser` rejected, `reason` will be '`findUser` rejected and we're unhappy'.
  });
  ```
  If the downstream promise does not specify a rejection handler, rejection reasons will be propagated further downstream.
   ```js
  findUser().then(function (user) {
    throw new PedagogicalException('Upstream error');
  }).then(function (value) {
    // never reached
  }).then(function (value) {
    // never reached
  }, function (reason) {
    // The `PedgagocialException` is propagated all the way down to here
  });
  ```
   Assimilation
  ------------
   Sometimes the value you want to propagate to a downstream promise can only be
  retrieved asynchronously. This can be achieved by returning a promise in the
  fulfillment or rejection handler. The downstream promise will then be pending
  until the returned promise is settled. This is called *assimilation*.
   ```js
  findUser().then(function (user) {
    return findCommentsByAuthor(user);
  }).then(function (comments) {
    // The user's comments are now available
  });
  ```
   If the assimliated promise rejects, then the downstream promise will also reject.
   ```js
  findUser().then(function (user) {
    return findCommentsByAuthor(user);
  }).then(function (comments) {
    // If `findCommentsByAuthor` fulfills, we'll have the value here
  }, function (reason) {
    // If `findCommentsByAuthor` rejects, we'll have the reason here
  });
  ```
   Simple Example
  --------------
   Synchronous Example
   ```javascript
  let result;
   try {
    result = findResult();
    // success
  } catch(reason) {
    // failure
  }
  ```
   Errback Example
   ```js
  findResult(function(result, err){
    if (err) {
      // failure
    } else {
      // success
    }
  });
  ```
   Promise Example;
   ```javascript
  findResult().then(function(result){
    // success
  }, function(reason){
    // failure
  });
  ```
   Advanced Example
  --------------
   Synchronous Example
   ```javascript
  let author, books;
   try {
    author = findAuthor();
    books  = findBooksByAuthor(author);
    // success
  } catch(reason) {
    // failure
  }
  ```
   Errback Example
   ```js
   function foundBooks(books) {
   }
   function failure(reason) {
   }
   findAuthor(function(author, err){
    if (err) {
      failure(err);
      // failure
    } else {
      try {
        findBoooksByAuthor(author, function(books, err) {
          if (err) {
            failure(err);
          } else {
            try {
              foundBooks(books);
            } catch(reason) {
              failure(reason);
            }
          }
        });
      } catch(error) {
        failure(err);
      }
      // success
    }
  });
  ```
   Promise Example;
   ```javascript
  findAuthor().
    then(findBooksByAuthor).
    then(function(books){
      // found books
  }).catch(function(reason){
    // something went wrong
  });
  ```
   @method then
  @param {Function} onFulfilled
  @param {Function} onRejected
  Useful for tooling.
  @return {Promise}
  */

  /**
  `catch` is simply sugar for `then(undefined, onRejection)` which makes it the same
  as the catch block of a try/catch statement.
  ```js
  function findAuthor(){
  throw new Error('couldn't find that author');
  }
  // synchronous
  try {
  findAuthor();
  } catch(reason) {
  // something went wrong
  }
  // async with promises
  findAuthor().catch(function(reason){
  // something went wrong
  });
  ```
  @method catch
  @param {Function} onRejection
  Useful for tooling.
  @return {Promise}
  */


  Promise.prototype.catch = function _catch(onRejection) {
    return this.then(null, onRejection);
  };

  /**
    `finally` will be invoked regardless of the promise's fate just as native
    try/catch/finally behaves
  
    Synchronous example:
  
    ```js
    findAuthor() {
      if (Math.random() > 0.5) {
        throw new Error();
      }
      return new Author();
    }
  
    try {
      return findAuthor(); // succeed or fail
    } catch(error) {
      return findOtherAuther();
    } finally {
      // always runs
      // doesn't affect the return value
    }
    ```
  
    Asynchronous example:
  
    ```js
    findAuthor().catch(function(reason){
      return findOtherAuther();
    }).finally(function(){
      // author was either found, or not
    });
    ```
  
    @method finally
    @param {Function} callback
    @return {Promise}
  */


  Promise.prototype.finally = function _finally(callback) {
    var promise = this;
    var constructor = promise.constructor;

    if (isFunction(callback)) {
      return promise.then(function (value) {
        return constructor.resolve(callback()).then(function () {
          return value;
        });
      }, function (reason) {
        return constructor.resolve(callback()).then(function () {
          throw reason;
        });
      });
    }

    return promise.then(callback, callback);
  };

  return Promise;
}();

Promise$1.prototype.then = then;
Promise$1.all = all;
Promise$1.race = race;
Promise$1.resolve = resolve$1;
Promise$1.reject = reject$1;
Promise$1._setScheduler = setScheduler;
Promise$1._setAsap = setAsap;
Promise$1._asap = asap;

/*global self*/
function polyfill() {
  var local = void 0;

  if (typeof global !== 'undefined') {
    local = global;
  } else if (typeof self !== 'undefined') {
    local = self;
  } else {
    try {
      local = Function('return this')();
    } catch (e) {
      throw new Error('polyfill failed because global object is unavailable in this environment');
    }
  }

  var P = local.Promise;

  if (P) {
    var promiseToString = null;
    try {
      promiseToString = Object.prototype.toString.call(P.resolve());
    } catch (e) {
      // silently ignored
    }

    if (promiseToString === '[object Promise]' && !P.cast) {
      return;
    }
  }

  local.Promise = Promise$1;
}

// Strange compat..
Promise$1.polyfill = polyfill;
Promise$1.Promise = Promise$1;

return Promise$1;

})));





}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"_process":84}],84:[function(require,module,exports){
// shim for using process in browser
var process = module.exports = {};

// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;

function defaultSetTimout() {
    throw new Error('setTimeout has not been defined');
}
function defaultClearTimeout () {
    throw new Error('clearTimeout has not been defined');
}
(function () {
    try {
        if (typeof setTimeout === 'function') {
            cachedSetTimeout = setTimeout;
        } else {
            cachedSetTimeout = defaultSetTimout;
        }
    } catch (e) {
        cachedSetTimeout = defaultSetTimout;
    }
    try {
        if (typeof clearTimeout === 'function') {
            cachedClearTimeout = clearTimeout;
        } else {
            cachedClearTimeout = defaultClearTimeout;
        }
    } catch (e) {
        cachedClearTimeout = defaultClearTimeout;
    }
} ())
function runTimeout(fun) {
    if (cachedSetTimeout === setTimeout) {
        //normal enviroments in sane situations
        return setTimeout(fun, 0);
    }
    // if setTimeout wasn't available but was latter defined
    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
        cachedSetTimeout = setTimeout;
        return setTimeout(fun, 0);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedSetTimeout(fun, 0);
    } catch(e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
            return cachedSetTimeout.call(null, fun, 0);
        } catch(e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
            return cachedSetTimeout.call(this, fun, 0);
        }
    }


}
function runClearTimeout(marker) {
    if (cachedClearTimeout === clearTimeout) {
        //normal enviroments in sane situations
        return clearTimeout(marker);
    }
    // if clearTimeout wasn't available but was latter defined
    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
        cachedClearTimeout = clearTimeout;
        return clearTimeout(marker);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedClearTimeout(marker);
    } catch (e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
            return cachedClearTimeout.call(null, marker);
        } catch (e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
            // Some versions of I.E. have different rules for clearTimeout vs setTimeout
            return cachedClearTimeout.call(this, marker);
        }
    }



}
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    if (!draining || !currentQueue) {
        return;
    }
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = runTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    runClearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        runTimeout(drainQueue);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;
process.prependListener = noop;
process.prependOnceListener = noop;

process.listeners = function (name) { return [] }

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };

},{}],85:[function(require,module,exports){
module.exports = {
	gameDriver: require("@akashic/game-driver"),
	akashicEngine: require("@akashic/akashic-engine"),
	pdiBrowser: require("@akashic/pdi-browser")
};

},{"@akashic/akashic-engine":1,"@akashic/game-driver":4,"@akashic/pdi-browser":28}]},{},[85])(85)
});

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvYWthc2hpYy1lbmdpbmUvaW5kZXguanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvYWthc2hpYy1lbmdpbmUvbGliL21haW4ubm9kZS5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9ha2FzaGljLXBkaS9saWIvaW5kZXguanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvZ2FtZS1kcml2ZXIvaW5kZXguanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvZ2FtZS1kcml2ZXIvbGliL0Nsb2NrLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL2dhbWUtZHJpdmVyL2xpYi9FdmVudEJ1ZmZlci5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9nYW1lLWRyaXZlci9saWIvRXZlbnRDb252ZXJ0ZXIuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvZ2FtZS1kcml2ZXIvbGliL0V4ZWN1dGlvbk1vZGUuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvZ2FtZS1kcml2ZXIvbGliL0dhbWUuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvZ2FtZS1kcml2ZXIvbGliL0dhbWVEcml2ZXIuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvZ2FtZS1kcml2ZXIvbGliL0dhbWVMb29wLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL2dhbWUtZHJpdmVyL2xpYi9Kb2luUmVzb2x2ZXIuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvZ2FtZS1kcml2ZXIvbGliL0xvb3BNb2RlLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL2dhbWUtZHJpdmVyL2xpYi9Mb29wUmVuZGVyTW9kZS5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9nYW1lLWRyaXZlci9saWIvUGRpVXRpbC5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9nYW1lLWRyaXZlci9saWIvUG9pbnRFdmVudFJlc29sdmVyLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL2dhbWUtZHJpdmVyL2xpYi9Qcm9maWxlckNsb2NrLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL2dhbWUtZHJpdmVyL2xpYi9TdG9yYWdlUmVzb2x2ZXIuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvZ2FtZS1kcml2ZXIvbGliL1RpY2tCdWZmZXIuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvZ2FtZS1kcml2ZXIvbGliL1RpY2tDb250cm9sbGVyLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL2dhbWUtZHJpdmVyL2xpYi9UaWNrR2VuZXJhdG9yLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL2dhbWUtZHJpdmVyL2xpYi9hdXhpbGlhcnkvTWVtb3J5QW1mbG93Q2xpZW50LmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL2dhbWUtZHJpdmVyL2xpYi9hdXhpbGlhcnkvUmVwbGF5QW1mbG93UHJveHkuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvZ2FtZS1kcml2ZXIvbGliL2F1eGlsaWFyeS9TaW1wbGVQcm9maWxlci5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9nYW1lLWRyaXZlci9saWIvY29uc3RhbnRzLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL2dhbWUtZHJpdmVyL2xpYi9pbmRleC5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9pbmRleC5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9BdWRpb01hbmFnZXIuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvQ29udGFpbmVyQ29udHJvbGxlci5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9JbnB1dEhhbmRsZXJMYXllci5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9QbGF0Zm9ybS5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9SYWZMb29wZXIuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvUmVzb3VyY2VGYWN0b3J5LmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL2Fzc2V0L0hUTUxJbWFnZUFzc2V0LmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL2Fzc2V0L0hUTUxWaWRlb0Fzc2V0LmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL2Fzc2V0L0hUTUxWaWRlb1BsYXllci5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9hc3NldC9YSFJTY3JpcHRBc3NldC5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9hc3NldC9YSFJUZXh0QXNzZXQuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvY2FudmFzL0FmZmluZVRyYW5zZm9ybWVyLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL2NhbnZhcy9DYW52YXNTdXJmYWNlLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL2NhbnZhcy9HbHlwaEZhY3RvcnkuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvY2FudmFzL1JlbmRlcmluZ0hlbHBlci5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9jYW52YXMvY29udGV4dDJkL0NhbnZhc1JlbmRlcmluZ1N0YXRlLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL2NhbnZhcy9jb250ZXh0MmQvQ2FudmFzU3VyZmFjZUNvbnRleHQuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvY2FudmFzL2NvbnRleHQyZC9Db250ZXh0MkRSZW5kZXJlci5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9jYW52YXMvY29udGV4dDJkL0NvbnRleHQyRFN1cmZhY2UuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvY2FudmFzL3NoaW1zL1N1cmZhY2VGYWN0b3J5LmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL2NhbnZhcy93ZWJnbC9XZWJHTEJhY2tTdXJmYWNlLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL2NhbnZhcy93ZWJnbC9XZWJHTEJhY2tTdXJmYWNlUmVuZGVyZXIuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvY2FudmFzL3dlYmdsL1dlYkdMQ29sb3IuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvY2FudmFzL3dlYmdsL1dlYkdMUHJpbWFyeVN1cmZhY2UuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvY2FudmFzL3dlYmdsL1dlYkdMUHJpbWFyeVN1cmZhY2VSZW5kZXJlci5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9jYW52YXMvd2ViZ2wvV2ViR0xSZW5kZXJlci5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9jYW52YXMvd2ViZ2wvV2ViR0xSZW5kZXJpbmdTdGF0ZS5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9jYW52YXMvd2ViZ2wvV2ViR0xTaGFkZXJQcm9ncmFtLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL2NhbnZhcy93ZWJnbC9XZWJHTFNoYXJlZE9iamVjdC5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9jYW52YXMvd2ViZ2wvV2ViR0xUZXh0dXJlQXRsYXMuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvY2FudmFzL3dlYmdsL1dlYkdMVGV4dHVyZU1hcC5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9oYW5kbGVyL0lucHV0QWJzdHJhY3RIYW5kbGVyLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL2hhbmRsZXIvTW91c2VIYW5kbGVyLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL2hhbmRsZXIvVG91Y2hIYW5kbGVyLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL2luZGV4LmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL3BsdWdpbi9BdWRpb1BsdWdpbk1hbmFnZXIuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvcGx1Z2luL0F1ZGlvUGx1Z2luUmVnaXN0cnkuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvcGx1Z2luL0hUTUxBdWRpb1BsdWdpbi9IVE1MQXVkaW9Bc3NldC5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9wbHVnaW4vSFRNTEF1ZGlvUGx1Z2luL0hUTUxBdWRpb0F1dG9wbGF5SGVscGVyLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL3BsdWdpbi9IVE1MQXVkaW9QbHVnaW4vSFRNTEF1ZGlvUGxheWVyLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL3BsdWdpbi9IVE1MQXVkaW9QbHVnaW4vSFRNTEF1ZGlvUGx1Z2luLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL3BsdWdpbi9Qb3N0TWVzc2FnZUF1ZGlvUGx1Z2luL1Bvc3RNZXNzYWdlQXVkaW9Bc3NldC5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9wbHVnaW4vUG9zdE1lc3NhZ2VBdWRpb1BsdWdpbi9Qb3N0TWVzc2FnZUF1ZGlvUGxheWVyLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL3BsdWdpbi9Qb3N0TWVzc2FnZUF1ZGlvUGx1Z2luL1Bvc3RNZXNzYWdlQXVkaW9QbHVnaW4uanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvcGx1Z2luL1Bvc3RNZXNzYWdlQXVkaW9QbHVnaW4vUG9zdE1lc3NhZ2VIYW5kbGVyLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL3BsdWdpbi9Qcm94eUF1ZGlvUGx1Z2luL1Byb3h5QXVkaW9Bc3NldC5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9wbHVnaW4vUHJveHlBdWRpb1BsdWdpbi9Qcm94eUF1ZGlvUGxheWVyLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL3BsdWdpbi9Qcm94eUF1ZGlvUGx1Z2luL1Byb3h5QXVkaW9QbHVnaW4uanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvcGx1Z2luL1dlYkF1ZGlvUGx1Z2luL1dlYkF1ZGlvQXNzZXQuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvcGx1Z2luL1dlYkF1ZGlvUGx1Z2luL1dlYkF1ZGlvQXV0b3BsYXlIZWxwZXIuanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvcGx1Z2luL1dlYkF1ZGlvUGx1Z2luL1dlYkF1ZGlvSGVscGVyLmpzIiwibm9kZV9tb2R1bGVzL0Bha2FzaGljL3BkaS1icm93c2VyL2xpYi9mdWxsL3BsdWdpbi9XZWJBdWRpb1BsdWdpbi9XZWJBdWRpb1BsYXllci5qcyIsIm5vZGVfbW9kdWxlcy9AYWthc2hpYy9wZGktYnJvd3Nlci9saWIvZnVsbC9wbHVnaW4vV2ViQXVkaW9QbHVnaW4vV2ViQXVkaW9QbHVnaW4uanMiLCJub2RlX21vZHVsZXMvQGFrYXNoaWMvcGRpLWJyb3dzZXIvbGliL2Z1bGwvdXRpbHMvWEhSTG9hZGVyLmpzIiwibm9kZV9tb2R1bGVzL2VzNi1wcm9taXNlL2Rpc3QvZXM2LXByb21pc2UuanMiLCJub2RlX21vZHVsZXMvcHJvY2Vzcy9icm93c2VyLmpzIiwic3JjL2VuZ2luZUZpbGVzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7O0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNybFBBO0FBQ0E7QUFDQTs7QUNGQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUNuT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL01BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbGRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcFRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNVBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaENBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3TkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbE1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeFBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbk5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdFdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3REQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDdHBDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4vbGliL21haW4ubm9kZScpOyIsIihmdW5jdGlvbigpIHtcblwidXNlIHN0cmljdFwiO1xuXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog44Ki44K744OD44OI6Kqt44G/6L6844G/5aSx5pWX5pmC44Gu44Ko44Op44O844Gu56iu5Yil44CCXG4gICAgICpcbiAgICAgKiDjgZPjga7lgKTjga/jgYLjgY/jgb7jgafjgoLjgqjjg6njg7zjg6Hjg4Pjgrvjg7zjgrjlh7rlipvjga7jgZ/jgoHjga7oo5zliqnmg4XloLHjgafjgYLjgorjgIFcbiAgICAgKiDntrLnvoXmgKfjg7vljrPlr4bmgKfjgpLov73msYLjgZfjgZ/jgoLjga7jgafjga/jgarjgYTjgZPjgajjgavms6jmhI/jgIJcbiAgICAgKi9cbiAgICB2YXIgQXNzZXRMb2FkRXJyb3JUeXBlO1xuICAgIChmdW5jdGlvbiAoQXNzZXRMb2FkRXJyb3JUeXBlKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDmmI7npLrjgZXjgozjgabjgYTjgarjgYQo5Lul5LiL44Gu44GE44Ga44KM44GL44GL44KC44GX44KM44Gq44GE44GX44CB44Gd44GG44Gn44Gq44GE44GL44KC44GX44KM44Gq44GEKeOAglxuICAgICAgICAgKi9cbiAgICAgICAgQXNzZXRMb2FkRXJyb3JUeXBlW0Fzc2V0TG9hZEVycm9yVHlwZVtcIlVuc3BlY2lmaWVkXCJdID0gMF0gPSBcIlVuc3BlY2lmaWVkXCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgqjjg7Pjgrjjg7Pjga7lho3oqabooYzlm57mlbDkuIrpmZDoqK3lrprlgKTjgpLotoXjgYjjgZ/jgIJcbiAgICAgICAgICovXG4gICAgICAgIEFzc2V0TG9hZEVycm9yVHlwZVtBc3NldExvYWRFcnJvclR5cGVbXCJSZXRyeUxpbWl0RXhjZWVkZWRcIl0gPSAxXSA9IFwiUmV0cnlMaW1pdEV4Y2VlZGVkXCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjg43jg4Pjg4jjg6/jg7zjgq/jgqjjg6njg7zjgILjgr/jgqTjg6DjgqLjgqbjg4jjgarjganjgIJcbiAgICAgICAgICovXG4gICAgICAgIEFzc2V0TG9hZEVycm9yVHlwZVtBc3NldExvYWRFcnJvclR5cGVbXCJOZXR3b3JrRXJyb3JcIl0gPSAyXSA9IFwiTmV0d29ya0Vycm9yXCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjg6rjgq/jgqjjgrnjg4jjgavllY/poYzjgYzjgYLjgovjgqjjg6njg7zjgIJIVFRQIDRYWCDjgarjganjgIJcbiAgICAgICAgICovXG4gICAgICAgIEFzc2V0TG9hZEVycm9yVHlwZVtBc3NldExvYWRFcnJvclR5cGVbXCJDbGllbnRFcnJvclwiXSA9IDNdID0gXCJDbGllbnRFcnJvclwiO1xuICAgICAgICAvKipcbiAgICAgICAgICog44K144O844OQ5YG044Gu44Ko44Op44O844CCSFRUUCA1WFgg44Gq44Gp44CCXG4gICAgICAgICAqL1xuICAgICAgICBBc3NldExvYWRFcnJvclR5cGVbQXNzZXRMb2FkRXJyb3JUeXBlW1wiU2VydmVyRXJyb3JcIl0gPSA0XSA9IFwiU2VydmVyRXJyb3JcIjtcbiAgICB9KShBc3NldExvYWRFcnJvclR5cGUgPSBnLkFzc2V0TG9hZEVycm9yVHlwZSB8fCAoZy5Bc3NldExvYWRFcnJvclR5cGUgPSB7fSkpO1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIC8qKlxuICAgICAqIOS+i+WklueUn+aIkOODleOCoeOCr+ODiOODquOAglxuICAgICAqIOOCqOODs+OCuOODs+WGhemDqOOBp+OBruS+i+WklueUn+aIkOOBq+WIqeeUqOOBmeOCi+OCguOBruOBp+OAgeOCsuODvOODoOmWi+eZuuiAheOBr+mAmuW4uOacrOODouOCuOODpeODvOODq+OCkuWIqeeUqOOBmeOCi+W/heimgeOBr+OBquOBhOOAglxuICAgICAqL1xuICAgIHZhciBFeGNlcHRpb25GYWN0b3J5O1xuICAgIChmdW5jdGlvbiAoRXhjZXB0aW9uRmFjdG9yeSkge1xuICAgICAgICBmdW5jdGlvbiBjcmVhdGVBc3NlcnRpb25FcnJvcihtZXNzYWdlLCBjYXVzZSkge1xuICAgICAgICAgICAgdmFyIGUgPSBuZXcgRXJyb3IobWVzc2FnZSk7XG4gICAgICAgICAgICBlLm5hbWUgPSBcIkFzc2VydGlvbkVycm9yXCI7XG4gICAgICAgICAgICBlLmNhdXNlID0gY2F1c2U7XG4gICAgICAgICAgICByZXR1cm4gZTtcbiAgICAgICAgfVxuICAgICAgICBFeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yID0gY3JlYXRlQXNzZXJ0aW9uRXJyb3I7XG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVR5cGVNaXNtYXRjaEVycm9yKG1ldGhvZE5hbWUsIGV4cGVjdGVkLCBhY3R1YWwsIGNhdXNlKSB7XG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IFwiVHlwZSBtaXNtYXRjaCBvbiBcIiArIG1ldGhvZE5hbWUgKyBcIixcIlxuICAgICAgICAgICAgICAgICsgXCIgZXhwZWN0ZWQgdHlwZSBpcyBcIiArIGV4cGVjdGVkO1xuICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAyKSB7IC8vIGFjdHVhbCDmjIflrprmmYJcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYWN0dWFsU3RyaW5nO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0dWFsICYmIGFjdHVhbC5jb25zdHJ1Y3RvciAmJiBhY3R1YWwuY29uc3RydWN0b3IubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0dWFsU3RyaW5nID0gYWN0dWFsLmNvbnN0cnVjdG9yLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY3R1YWxTdHJpbmcgPSB0eXBlb2YgYWN0dWFsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgKz0gXCIsIGFjdHVhbCB0eXBlIGlzIFwiXG4gICAgICAgICAgICAgICAgICAgICAgICArIChhY3R1YWxTdHJpbmcubGVuZ3RoID4gNDAgPyBhY3R1YWxTdHJpbmcuc3Vic3RyKDAsIDQwKSA6IGFjdHVhbFN0cmluZyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChleCkge1xuICAgICAgICAgICAgICAgICAgICAvLyDjg6Hjg4Pjgrvjg7zjgrjlj5blvpfmmYLjgavkvovlpJbjgYznmbrnlJ/jgZfjgZ/jgolhY3R1YWzjga7lnovmg4XloLHlh7rlipvjga/jgYLjgY3jgonjgoHjgotcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtZXNzYWdlICs9IFwiLlwiO1xuICAgICAgICAgICAgdmFyIGUgPSBuZXcgRXJyb3IobWVzc2FnZSk7XG4gICAgICAgICAgICBlLm5hbWUgPSBcIlR5cGVNaXNtYXRjaEVycm9yXCI7XG4gICAgICAgICAgICBlLmNhdXNlID0gY2F1c2U7XG4gICAgICAgICAgICBlLmV4cGVjdGVkID0gZXhwZWN0ZWQ7XG4gICAgICAgICAgICBlLmFjdHVhbCA9IGFjdHVhbDtcbiAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICB9XG4gICAgICAgIEV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlVHlwZU1pc21hdGNoRXJyb3IgPSBjcmVhdGVUeXBlTWlzbWF0Y2hFcnJvcjtcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQXNzZXRMb2FkRXJyb3IobWVzc2FnZSwgcmV0cmlhYmxlLCB0eXBlLCBjYXVzZSkge1xuICAgICAgICAgICAgaWYgKHJldHJpYWJsZSA9PT0gdm9pZCAwKSB7IHJldHJpYWJsZSA9IHRydWU7IH1cbiAgICAgICAgICAgIGlmICh0eXBlID09PSB2b2lkIDApIHsgdHlwZSA9IGcuQXNzZXRMb2FkRXJyb3JUeXBlLlVuc3BlY2lmaWVkOyB9XG4gICAgICAgICAgICB2YXIgZSA9IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgICAgICAgICAgIGUubmFtZSA9IFwiQXNzZXRMb2FkRXJyb3JcIjtcbiAgICAgICAgICAgIGUuY2F1c2UgPSBjYXVzZTtcbiAgICAgICAgICAgIGUucmV0cmlhYmxlID0gcmV0cmlhYmxlO1xuICAgICAgICAgICAgZS50eXBlID0gdHlwZTtcbiAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICB9XG4gICAgICAgIEV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXRMb2FkRXJyb3IgPSBjcmVhdGVBc3NldExvYWRFcnJvcjtcbiAgICB9KShFeGNlcHRpb25GYWN0b3J5ID0gZy5FeGNlcHRpb25GYWN0b3J5IHx8IChnLkV4Y2VwdGlvbkZhY3RvcnkgPSB7fSkpO1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIC8qKlxuICAgICAqIOODquOCveODvOOCueOBrueUn+aIkOOCkuihjOOBhuOCr+ODqeOCueOAglxuICAgICAqXG4gICAgICog44GT44Gu44Kv44Op44K5ICjjga7lrp/oo4Xjgq/jg6njgrkpIOOBruOCpOODs+OCueOCv+ODs+OCueOBr+OCqOODs+OCuOODs+OBq+OCiOOBo+OBpueUn+aIkOOBleOCjOOCi+OAguOCsuODvOODoOmWi+eZuuiAheOBjOeUn+aIkOOBmeOCi+W/heimgeOBr+OBquOBhOOAglxuICAgICAqIOOBvuOBn+OBk+OBruOCr+ODqeOCueOBruWQhOeoruOCouOCu+ODg+ODiOeUn+aIkOODoeOCveODg+ODieOBr+OAgeOCqOODs+OCuOODs+OBq+OCiOOBo+OBpuaal+m7meOBq+WRvOOBs+WHuuOBleOCjOOCi+OCguOBruOBp+OBguOCi+OAglxuICAgICAqIOmAmuW4uOOCsuODvOODoOmWi+eZuuiAheOBjOWRvOOBs+WHuuOBmeW/heimgeOBr+OBquOBhOOAglxuICAgICAqL1xuICAgIHZhciBSZXNvdXJjZUZhY3RvcnkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIFJlc291cmNlRmFjdG9yeSgpIHtcbiAgICAgICAgfVxuICAgICAgICBSZXNvdXJjZUZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZVN1cmZhY2VBdGxhcyA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IGcuU3VyZmFjZUF0bGFzKHRoaXMuY3JlYXRlU3VyZmFjZSh3aWR0aCwgaGVpZ2h0KSk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDmjIflrppTdXJmYWNl44GL44KJ5oyH5a6a56+E5Zuy44KS5YiH44KK5Y+W44Gj44GfU3VyZmFjZeOCkui/lOOBmeOAglxuICAgICAgICAgKiDnr4Tlm7LjgpLmjIflrprjgZfjgarjgYTloLTlkIjjga/jgIHmjIflrppTdXJmYWNl44KS44Kz44OU44O844GX44GfU3VyZmFjZeOCkui/lOOBmeOAglxuICAgICAgICAgKi9cbiAgICAgICAgUmVzb3VyY2VGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGVUcmltbWVkU3VyZmFjZSA9IGZ1bmN0aW9uICh0YXJnZXRTdXJmYWNlLCB0YXJnZXRBcmVhKSB7XG4gICAgICAgICAgICB2YXIgYXJlYSA9IHRhcmdldEFyZWEgfHwgeyB4OiAwLCB5OiAwLCB3aWR0aDogdGFyZ2V0U3VyZmFjZS53aWR0aCwgaGVpZ2h0OiB0YXJnZXRTdXJmYWNlLmhlaWdodCB9O1xuICAgICAgICAgICAgdmFyIHN1cmZhY2UgPSB0aGlzLmNyZWF0ZVN1cmZhY2UoYXJlYS53aWR0aCwgYXJlYS5oZWlnaHQpO1xuICAgICAgICAgICAgdmFyIHJlbmRlcmVyID0gc3VyZmFjZS5yZW5kZXJlcigpO1xuICAgICAgICAgICAgcmVuZGVyZXIuYmVnaW4oKTtcbiAgICAgICAgICAgIHJlbmRlcmVyLmRyYXdJbWFnZSh0YXJnZXRTdXJmYWNlLCBhcmVhLngsIGFyZWEueSwgYXJlYS53aWR0aCwgYXJlYS5oZWlnaHQsIDAsIDApO1xuICAgICAgICAgICAgcmVuZGVyZXIuZW5kKCk7XG4gICAgICAgICAgICByZXR1cm4gc3VyZmFjZTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIFJlc291cmNlRmFjdG9yeTtcbiAgICB9KCkpO1xuICAgIGcuUmVzb3VyY2VGYWN0b3J5ID0gUmVzb3VyY2VGYWN0b3J5O1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIHZhciBSZXF1aXJlQ2FjaGVkVmFsdWUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIFJlcXVpcmVDYWNoZWRWYWx1ZSh2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5fdmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIFJlcXVpcmVDYWNoZWRWYWx1ZS5wcm90b3R5cGUuX2NhY2hlZFZhbHVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gUmVxdWlyZUNhY2hlZFZhbHVlO1xuICAgIH0oKSk7XG4gICAgZy5SZXF1aXJlQ2FjaGVkVmFsdWUgPSBSZXF1aXJlQ2FjaGVkVmFsdWU7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog5Lmx5pWw55Sf5oiQ5Zmo44CCXG4gICAgICogYFJhbmRvbUdlbmVyYXRvciNnZXQoKWAg44Gr44KI44Gj44Gm44CB5paw44GX44GE5Lmx5pWw44KS55Sf5oiQ44GZ44KL44GT44Go44GM44Gn44GN44KL44CCXG4gICAgICovXG4gICAgdmFyIFJhbmRvbUdlbmVyYXRvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gUmFuZG9tR2VuZXJhdG9yKHNlZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VlZCA9IHNlZWQ7XG4gICAgICAgICAgICB0aGlzWzBdID0gdGhpcztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUmFuZG9tR2VuZXJhdG9yO1xuICAgIH0oKSk7XG4gICAgZy5SYW5kb21HZW5lcmF0b3IgPSBSYW5kb21HZW5lcmF0b3I7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog5ZCE56iu44Oq44K944O844K544KS6KGo44GZ44Kv44Op44K544CCXG4gICAgICog5pys44Kv44Op44K544Gu44Kk44Oz44K544K/44Oz44K544KS44Ky44O844Og6ZaL55m66ICF44GM55u05o6l55Sf5oiQ44GZ44KL44GT44Go44Gv44Gq44GE44CCXG4gICAgICogZ2FtZS5qc29u44Gr44KI44Gj44Gm5a6a576p44GV44KM44Gf5YaF5a6544KS44KC44Go44Gr5pqX6buZ55qE44Gr55Sf5oiQ44GV44KM44Gf44Kk44Oz44K544K/44Oz44K544KS44CBXG4gICAgICogU2NlbmUjYXNzZXRz44CB44G+44Gf44GvR2FtZSNhc3NldHPjgavjgojjgaPjgablj5blvpfjgZfjgabliKnnlKjjgZnjgovjgIJcbiAgICAgKi9cbiAgICB2YXIgQXNzZXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIEFzc2V0KGlkLCBwYXRoKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLm9yaWdpbmFsUGF0aCA9IHBhdGg7XG4gICAgICAgICAgICB0aGlzLnBhdGggPSB0aGlzLl9hc3NldFBhdGhGaWx0ZXIocGF0aCk7XG4gICAgICAgICAgICB0aGlzLm9uRGVzdHJveWVkID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICB9XG4gICAgICAgIEFzc2V0LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5vbkRlc3Ryb3llZC5maXJlKHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5pZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxQYXRoID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5wYXRoID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5vbkRlc3Ryb3llZC5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLm9uRGVzdHJveWVkID0gdW5kZWZpbmVkO1xuICAgICAgICB9O1xuICAgICAgICBBc3NldC5wcm90b3R5cGUuZGVzdHJveWVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWQgPT09IHVuZGVmaW5lZDtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOePvuWcqOWIqeeUqOS4reOBp+ino+aUvuWHuuadpeOBquOBhCBgQXNzZXRgIOOBi+OBqeOBhuOBi+OCkui/lOOBmeOAglxuICAgICAgICAgKiDmiLvjgorlgKTjga/jgIHliKnnlKjkuK3jgafjgYLjgovloLTlkIjnnJ/jgIHjgafjgarjgZHjgozjgbDlgb3jgafjgYLjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog5pys44Oh44K944OD44OJ44Gv6YCa5bi4IGBmYWxzZWAg44GM6L+U44KL44G544GN44Gn44GC44KL44CCXG4gICAgICAgICAqIOS+i+OBiOOBsCBgU3ByaXRlYCDjga7lhYPnlLvlg4/jgajjgZfjgabkvb/jgo/jgozjgabjgYTjgovjgrHjg7zjgrnnrYnjgafjga/jgIHjgZ3jga4gYFNwcml0ZWAg44Gr44KI44Gj44GmIGBBc3NldGAg44GvIGBTdXJmYWNlYCDjgavlpInmj5vjgZXjgozjgabjgYTjgovjgbnjgY3jgafjgIFcbiAgICAgICAgICogYEFzc2V0YCDjgYzliKnnlKjkuK3jgafop6PmlL7lh7rmnaXjgarjgYTnirbmhYvjgavjgarjgaPjgabjgYTjgarjgYTkuovjgpLlkITjg5fjg6njg4Pjg4jjg5Xjgqnjg7zjg6Djgafkv53pmpzjgZnjgovlv4XopoHjgYzjgYLjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog5ZSv5LiA44CB5L6L5aSW55qE44Gr5pys44Oh44K944OD44OJ44GMIGB0cnVlYCDjgpLov5TjgZnjgZPjgajjgYzjgYLjgovjga7jga/pn7Pmpb3jgpLooajjgZkgYEFzc2V0YCDjgafjgYLjgovjgIJcbiAgICAgICAgICogQkdN562J44Gv44K344O844Oz44KS44G+44Gf44GE44Gn5ryU5aWP44GZ44KL44GT44Go44KC44GC44KK44GI44KL5LiK44CBXG4gICAgICAgICAqIOa8lOWlj+S4reOBruODquOCveODvOOCueOBruOCs+ODlOODvOOCkuW4uOOBq+WQhOODl+ODqeODg+ODiOODleOCqeODvOODoOOBq+W8t+WItuOBmeOCi+OBq+OBr+OCs+OCueODiOOBjOOBi+OBi+OCiuOBmeOBjuOCi+OBn+OCgeOAgVxuICAgICAgICAgKiDmnKzjg6Hjgr3jg4Pjg4njga8gYHRydWVgIOOCkui/lOOBl+OAgemBqeWIh+OBquOCv+OCpOODn+ODs+OCsOOBpyBgQXNzZXRgIOOBjOino+aUvuOBleOCjOOCi+OCiOOBhuWItuW+oeOBmeOCi+W/heimgeOBjOOBguOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgQXNzZXQucHJvdG90eXBlLmluVXNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIEFzc2V0LnByb3RvdHlwZS5fYXNzZXRQYXRoRmlsdGVyID0gZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgICAgIC8vIOaLoeW8teWtkOOBruijnOWujOODu+iqreOBv+abv+OBiOOBjOW/heimgeOBqmFzc2V044Gv44GT44KM44KS44Kq44O844OQ44O844Op44Kk44OJ44GZ44KM44Gw44KI44GE44CCKOWvvuW/nOW9ouW8j+OBjOmZkOWumuOBleOCjOOCi2F1ZGlv44Gq44Gp44Gu5aC05ZCIKVxuICAgICAgICAgICAgcmV0dXJuIHBhdGg7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBBc3NldDtcbiAgICB9KCkpO1xuICAgIGcuQXNzZXQgPSBBc3NldDtcbiAgICAvKipcbiAgICAgKiDnlLvlg4/jg6rjgr3jg7zjgrnjgpLooajjgZnjgq/jg6njgrnjgIJcbiAgICAgKiDmnKzjgq/jg6njgrnjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLjgrLjg7zjg6DplovnmbrogIXjgYznm7TmjqXnlJ/miJDjgZnjgovjgZPjgajjga/jgarjgYTjgIJcbiAgICAgKiBnYW1lLmpzb27jgavjgojjgaPjgablrprnvqnjgZXjgozjgZ/lhoXlrrnjgpLjgoLjgajjgavmmpfpu5nnmoTjgavnlJ/miJDjgZXjgozjgZ/jgqTjg7Pjgrnjgr/jg7PjgrnjgpLjgIFcbiAgICAgKiBTY2VuZSNhc3NldHPjgIHjgb7jgZ/jga9HYW1lI2Fzc2V0c+OBq+OCiOOBo+OBpuWPluW+l+OBl+OBpuWIqeeUqOOBmeOCi+OAglxuICAgICAqXG4gICAgICogd2lkdGgsIGhlaWdodOOBp+ODoeOCv+ODh+ODvOOCv+OBqOOBl+OBpueUu+WDj+OBruWkp+OBjeOBleOCkuOBqOOCi+OBk+OBqOOBr+WHuuadpeOCi+OBjOOAgVxuICAgICAqIOOCsuODvOODoOmWi+eZuuiAheOBr+OBneOCjOS7peWkluOBruaDheWgseOCkuacrOOCr+ODqeOCueOBi+OCieebtOaOpeOBr+WPluW+l+OBm+OBmuOAgVNwcml0ZeetieOBq+acrOODquOCveODvOOCueOCkuaMh+WumuOBl+OBpuWIqeeUqOOBmeOCi+OAglxuICAgICAqL1xuICAgIHZhciBJbWFnZUFzc2V0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoSW1hZ2VBc3NldCwgX3N1cGVyKTtcbiAgICAgICAgZnVuY3Rpb24gSW1hZ2VBc3NldChpZCwgYXNzZXRQYXRoLCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBpZCwgYXNzZXRQYXRoKSB8fCB0aGlzO1xuICAgICAgICAgICAgX3RoaXMud2lkdGggPSB3aWR0aDtcbiAgICAgICAgICAgIF90aGlzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcztcbiAgICAgICAgfVxuICAgICAgICBJbWFnZUFzc2V0LnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKGhpbnQpIHtcbiAgICAgICAgICAgIHRoaXMuaGludCA9IGhpbnQ7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBJbWFnZUFzc2V0O1xuICAgIH0oQXNzZXQpKTtcbiAgICBnLkltYWdlQXNzZXQgPSBJbWFnZUFzc2V0O1xuICAgIC8qKlxuICAgICAqIOWLleeUu+ODquOCveODvOOCueOCkuihqOOBmeOCr+ODqeOCueOAglxuICAgICAqIOacrOOCr+ODqeOCueOBruOCpOODs+OCueOCv+ODs+OCueOCkuOCsuODvOODoOmWi+eZuuiAheOBjOebtOaOpeeUn+aIkOOBmeOCi+OBk+OBqOOBr+OBquOBhOOAglxuICAgICAqIGdhbWUuanNvbuOBq+OCiOOBo+OBpuWumue+qeOBleOCjOOBn+WGheWuueOCkuOCguOBqOOBq+aal+m7meeahOOBq+eUn+aIkOOBleOCjOOBn+OCpOODs+OCueOCv+ODs+OCueOCkuOAgVxuICAgICAqIFNjZW5lI2Fzc2V0c+OAgeOBvuOBn+OBr0dhbWUjYXNzZXRz44Gr44KI44Gj44Gm5Y+W5b6X44GX44Gm5Yip55So44GZ44KL44CCXG4gICAgICovXG4gICAgdmFyIFZpZGVvQXNzZXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhWaWRlb0Fzc2V0LCBfc3VwZXIpO1xuICAgICAgICBmdW5jdGlvbiBWaWRlb0Fzc2V0KGlkLCBhc3NldFBhdGgsIHdpZHRoLCBoZWlnaHQsIHN5c3RlbSwgbG9vcCwgdXNlUmVhbFNpemUpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIGlkLCBhc3NldFBhdGgsIHdpZHRoLCBoZWlnaHQpIHx8IHRoaXM7XG4gICAgICAgICAgICBfdGhpcy5yZWFsV2lkdGggPSAwO1xuICAgICAgICAgICAgX3RoaXMucmVhbEhlaWdodCA9IDA7XG4gICAgICAgICAgICBfdGhpcy5fc3lzdGVtID0gc3lzdGVtO1xuICAgICAgICAgICAgX3RoaXMuX2xvb3AgPSBsb29wO1xuICAgICAgICAgICAgX3RoaXMuX3VzZVJlYWxTaXplID0gdXNlUmVhbFNpemU7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgICAgIH1cbiAgICAgICAgVmlkZW9Bc3NldC5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uIChsb29wKSB7XG4gICAgICAgICAgICB0aGlzLmdldFBsYXllcigpLnBsYXkodGhpcyk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRQbGF5ZXIoKTtcbiAgICAgICAgfTtcbiAgICAgICAgVmlkZW9Bc3NldC5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0UGxheWVyKCkuc3RvcCgpO1xuICAgICAgICB9O1xuICAgICAgICBWaWRlb0Fzc2V0LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5fc3lzdGVtID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcyk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBWaWRlb0Fzc2V0O1xuICAgIH0oSW1hZ2VBc3NldCkpO1xuICAgIGcuVmlkZW9Bc3NldCA9IFZpZGVvQXNzZXQ7XG4gICAgLyoqXG4gICAgICog6Z+z44Oq44K944O844K544KS6KGo44GZ44Kv44Op44K544CCXG4gICAgICog5pys44Kv44Op44K544Gu44Kk44Oz44K544K/44Oz44K544KS44Ky44O844Og6ZaL55m66ICF44GM55u05o6l55Sf5oiQ44GZ44KL44GT44Go44Gv44Gq44GE44CCXG4gICAgICogZ2FtZS5qc29u44Gr44KI44Gj44Gm5a6a576p44GV44KM44Gf5YaF5a6544KS44KC44Go44Gr5pqX6buZ55qE44Gr55Sf5oiQ44GV44KM44Gf44Kk44Oz44K544K/44Oz44K544KS44CBXG4gICAgICogU2NlbmUjYXNzZXRz44CB44G+44Gf44GvR2FtZSNhc3NldHPjgavjgojjgaPjgablj5blvpfjgZfjgabliKnnlKjjgZnjgovjgIJcbiAgICAgKlxuICAgICAqIEF1ZGlvQXNzZXQjcGxheeOCkuWRvOOBs+WHuuOBmeS6i+OBp+OAgeOBneOBrumfs+OCkuWGjeeUn+OBmeOCi+OBk+OBqOOBjOWHuuadpeOCi+OAglxuICAgICAqL1xuICAgIHZhciBBdWRpb0Fzc2V0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoQXVkaW9Bc3NldCwgX3N1cGVyKTtcbiAgICAgICAgZnVuY3Rpb24gQXVkaW9Bc3NldChpZCwgYXNzZXRQYXRoLCBkdXJhdGlvbiwgc3lzdGVtLCBsb29wLCBoaW50KSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBpZCwgYXNzZXRQYXRoKSB8fCB0aGlzO1xuICAgICAgICAgICAgX3RoaXMuZHVyYXRpb24gPSBkdXJhdGlvbjtcbiAgICAgICAgICAgIF90aGlzLmxvb3AgPSBsb29wO1xuICAgICAgICAgICAgX3RoaXMuaGludCA9IGhpbnQ7XG4gICAgICAgICAgICBfdGhpcy5fc3lzdGVtID0gc3lzdGVtO1xuICAgICAgICAgICAgX3RoaXMuZGF0YSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcztcbiAgICAgICAgfVxuICAgICAgICBBdWRpb0Fzc2V0LnByb3RvdHlwZS5wbGF5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHBsYXllciA9IHRoaXMuX3N5c3RlbS5jcmVhdGVQbGF5ZXIoKTtcbiAgICAgICAgICAgIHBsYXllci5wbGF5KHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5fbGFzdFBsYXllZFBsYXllciA9IHBsYXllcjtcbiAgICAgICAgICAgIHJldHVybiBwbGF5ZXI7XG4gICAgICAgIH07XG4gICAgICAgIEF1ZGlvQXNzZXQucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcGxheWVycyA9IHRoaXMuX3N5c3RlbS5maW5kUGxheWVycyh0aGlzKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGxheWVycy5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICBwbGF5ZXJzW2ldLnN0b3AoKTtcbiAgICAgICAgfTtcbiAgICAgICAgQXVkaW9Bc3NldC5wcm90b3R5cGUuaW5Vc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc3lzdGVtLmZpbmRQbGF5ZXJzKHRoaXMpLmxlbmd0aCA+IDA7XG4gICAgICAgIH07XG4gICAgICAgIEF1ZGlvQXNzZXQucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fc3lzdGVtKVxuICAgICAgICAgICAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgICAgICAgdGhpcy5kYXRhID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fc3lzdGVtID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fbGFzdFBsYXllZFBsYXllciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIF9zdXBlci5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gQXVkaW9Bc3NldDtcbiAgICB9KEFzc2V0KSk7XG4gICAgZy5BdWRpb0Fzc2V0ID0gQXVkaW9Bc3NldDtcbiAgICAvKipcbiAgICAgKiDmloflrZfliJfjg6rjgr3jg7zjgrnjgpLooajjgZnjgq/jg6njgrnjgIJcbiAgICAgKiDmnKzjgq/jg6njgrnjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLjgrLjg7zjg6DplovnmbrogIXjgYznm7TmjqXnlJ/miJDjgZnjgovjgZPjgajjga/jgarjgYTjgIJcbiAgICAgKiBnYW1lLmpzb27jgavjgojjgaPjgablrprnvqnjgZXjgozjgZ/lhoXlrrnjgpLjgoLjgajjgavmmpfpu5nnmoTjgavnlJ/miJDjgZXjgozjgZ/jgqTjg7Pjgrnjgr/jg7PjgrnjgpLjgIFcbiAgICAgKiBTY2VuZSNhc3NldHPjgIHjgb7jgZ/jga9HYW1lI2Fzc2V0c+OBq+OCiOOBo+OBpuWPluW+l+OBl+OBpuWIqeeUqOOBmeOCi+OAglxuICAgICAqXG4gICAgICogVGV4dEFzc2V0I2RhdGHjgavjgojjgaPjgabjgIHmnKzjg6rjgr3jg7zjgrnjgYzkv53mjIHjgZnjgovmloflrZfliJfjgpLlj5blvpfjgZnjgovjgZPjgajjgYzlh7rmnaXjgovjgIJcbiAgICAgKi9cbiAgICB2YXIgVGV4dEFzc2V0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoVGV4dEFzc2V0LCBfc3VwZXIpO1xuICAgICAgICBmdW5jdGlvbiBUZXh0QXNzZXQoaWQsIGFzc2V0UGF0aCkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgaWQsIGFzc2V0UGF0aCkgfHwgdGhpcztcbiAgICAgICAgICAgIF90aGlzLmRhdGEgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgICAgIH1cbiAgICAgICAgVGV4dEFzc2V0LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5kYXRhID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcyk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBUZXh0QXNzZXQ7XG4gICAgfShBc3NldCkpO1xuICAgIGcuVGV4dEFzc2V0ID0gVGV4dEFzc2V0O1xuICAgIC8qKlxuICAgICAqIOOCueOCr+ODquODl+ODiOODquOCveODvOOCueOCkuihqOOBmeOCr+ODqeOCueOAglxuICAgICAqIOacrOOCr+ODqeOCueOBruOCpOODs+OCueOCv+ODs+OCueOCkuOCsuODvOODoOmWi+eZuuiAheOBjOebtOaOpeeUn+aIkOOBmeOCi+OBk+OBqOOBr+OBquOBhOOAglxuICAgICAqIGdhbWUuanNvbuOBq+OCiOOBo+OBpuWumue+qeOBleOCjOOBn+WGheWuueOCkuOCguOBqOOBq+aal+m7meeahOOBq+eUn+aIkOOBleOCjOOBn+OCpOODs+OCueOCv+ODs+OCueOCkuOAgVxuICAgICAqIFNjZW5lI2Fzc2V0c+OAgeOBvuOBn+OBr0dhbWUjYXNzZXRz44Gr44KI44Gj44Gm5Y+W5b6X44GX44Gm5Yip55So44GZ44KL44CCXG4gICAgICpcbiAgICAgKiBTY3JpcHRBc3NldCNleGVjdXRl44Gr44KI44Gj44Gm44CB5pys44Oq44K944O844K544GM6KGo44GZ44K544Kv44Oq44OX44OI44KS5a6f6KGM44GX44CB44Gd44Gu57WQ5p6c44KS5Y+X44GR5Y+W44KL5LqL44GM5Ye65p2l44KL44CCXG4gICAgICogcmVxdWlyZeOBq+OCiOOCi+WPgueFp+OBqOOBr+eVsOOBquOCiuOAgWV4ZWN1dGXjga/jgq3jg6Pjg4Pjgrfjg6XjgZXjgozjgarjgYTjgZ/jgoHjgIHkvZXluqbjgafjgoLlkbzjgbPlh7rjgZfpgZXjgYbntZDmnpzjgpLlj5fjgZHlj5bjgovjgZPjgajjgYzlh7rmnaXjgovjgIJcbiAgICAgKi9cbiAgICB2YXIgU2NyaXB0QXNzZXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhTY3JpcHRBc3NldCwgX3N1cGVyKTtcbiAgICAgICAgZnVuY3Rpb24gU2NyaXB0QXNzZXQoKSB7XG4gICAgICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgU2NyaXB0QXNzZXQucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLnNjcmlwdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIF9zdXBlci5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gU2NyaXB0QXNzZXQ7XG4gICAgfShBc3NldCkpO1xuICAgIGcuU2NyaXB0QXNzZXQgPSBTY3JpcHRBc3NldDtcbn0pKGcgfHwgKGcgPSB7fSkpO1xudmFyIGc7XG4oZnVuY3Rpb24gKGcpIHtcbiAgICB2YXIgQXNzZXRMb2FkaW5nSW5mbyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gQXNzZXRMb2FkaW5nSW5mbyhhc3NldCwgaGFuZGxlcikge1xuICAgICAgICAgICAgdGhpcy5hc3NldCA9IGFzc2V0O1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVycyA9IFtoYW5kbGVyXTtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JDb3VudCA9IDA7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQXNzZXRMb2FkaW5nSW5mbztcbiAgICB9KCkpO1xuICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZUF1ZGlvU3lzdGVtQ29uZk1hcChjb25mTWFwKSB7XG4gICAgICAgIGNvbmZNYXAgPSBjb25mTWFwIHx8IHt9O1xuICAgICAgICB2YXIgc3lzdGVtRGVmYXVsdHMgPSB7XG4gICAgICAgICAgICBtdXNpYzoge1xuICAgICAgICAgICAgICAgIGxvb3A6IHRydWUsXG4gICAgICAgICAgICAgICAgaGludDogeyBzdHJlYW1pbmc6IHRydWUgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNvdW5kOiB7XG4gICAgICAgICAgICAgICAgbG9vcDogZmFsc2UsXG4gICAgICAgICAgICAgICAgaGludDogeyBzdHJlYW1pbmc6IGZhbHNlIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHN5c3RlbURlZmF1bHRzKSB7XG4gICAgICAgICAgICBpZiAoIShrZXkgaW4gY29uZk1hcCkpIHtcbiAgICAgICAgICAgICAgICBjb25mTWFwW2tleV0gPSBzeXN0ZW1EZWZhdWx0c1trZXldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb25mTWFwO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBgQXNzZXRgIOOCkueuoeeQhuOBmeOCi+OCr+ODqeOCueOAglxuICAgICAqXG4gICAgICog44GT44Gu44Kv44Op44K544Gu44Kk44Oz44K544K/44Oz44K544GvIGBHYW1lYCDjgavkuIDjgaTjg4fjg5Xjgqnjg6vjg4jjgaflrZjlnKjjgZnjgoso44OH44OV44Kp44Or44OI44Ki44K744OD44OI44Oe44ON44O844K444OjKeOAglxuICAgICAqIOODh+ODleOCqeODq+ODiOOCouOCu+ODg+ODiOODnuODjeODvOOCuOODo+OBr+OAgWdhbWUuanNvbiDjgavoqJjov7DjgZXjgozjgZ/pgJrluLjjga7jgqLjgrvjg4Pjg4jjgpLoqq3jgb/ovrzjgoDjgZ/jgoHjgavliKnnlKjjgZXjgozjgovjgIJcbiAgICAgKlxuICAgICAqIOOCsuODvOODoOmWi+eZuuiAheOBr+OAgWdhbWUuanNvbiDjgavoqJjov7Djga7jgarjgYTjg6rjgr3jg7zjgrnjgpLlj5blvpfjgZnjgovjgZ/jgoHjgavjgIHjgZPjga7jgq/jg6njgrnjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLni6zoh6rjgavnlJ/miJDjgZfjgabjgojjgYTjgIJcbiAgICAgKi9cbiAgICB2YXIgQXNzZXRNYW5hZ2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogYEFzc2V0TWFuYWdlcmAg44Gu44Kk44Oz44K544K/44Oz44K544KS55Sf5oiQ44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBnYW1lIOOBk+OBruOCpOODs+OCueOCv+ODs+OCueOBjOWxnuOBmeOCi+OCsuODvOODoFxuICAgICAgICAgKiBAcGFyYW0gY29uZiDjgZPjga7jgqLjgrvjg4Pjg4jjg57jg43jg7zjgrjjg6PjgavkuI7jgYjjgovjgqLjgrvjg4Pjg4jlrprnvqnjgIJnYW1lLmpzb24g44GuIGBcImFzc2V0c1wiYCDjgavnm7jlvZPjgIJcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIEFzc2V0TWFuYWdlcihnYW1lLCBjb25mLCBhdWRpb1N5c3RlbUNvbmZNYXAsIG1vZHVsZU1haW5TY3JpcHRzKSB7XG4gICAgICAgICAgICB0aGlzLmdhbWUgPSBnYW1lO1xuICAgICAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uID0gdGhpcy5fbm9ybWFsaXplKGNvbmYgfHwge30sIG5vcm1hbGl6ZUF1ZGlvU3lzdGVtQ29uZk1hcChhdWRpb1N5c3RlbUNvbmZNYXApKTtcbiAgICAgICAgICAgIHRoaXMuX2Fzc2V0cyA9IHt9O1xuICAgICAgICAgICAgdGhpcy5fbGl2ZUFzc2V0VmlydHVhbFBhdGhUYWJsZSA9IHt9O1xuICAgICAgICAgICAgdGhpcy5fbGl2ZUFic29sdXRlUGF0aFRhYmxlID0ge307XG4gICAgICAgICAgICB0aGlzLl9tb2R1bGVNYWluU2NyaXB0cyA9IG1vZHVsZU1haW5TY3JpcHRzID8gbW9kdWxlTWFpblNjcmlwdHMgOiB7fTtcbiAgICAgICAgICAgIHRoaXMuX3JlZkNvdW50cyA9IHt9O1xuICAgICAgICAgICAgdGhpcy5fbG9hZGluZ3MgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICog44GT44Gu44Kk44Oz44K544K/44Oz44K544KS56C05qOE44GZ44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBBc3NldE1hbmFnZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgYXNzZXRJZHMgPSBPYmplY3Qua2V5cyh0aGlzLl9yZWZDb3VudHMpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhc3NldElkcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3JlbGVhc2VBc3NldChhc3NldElkc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmdhbWUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl9hc3NldHMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl9saXZlQXNzZXRWaXJ0dWFsUGF0aFRhYmxlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fbGl2ZUFic29sdXRlUGF0aFRhYmxlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fcmVmQ291bnRzID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fbG9hZGluZ3MgPSB1bmRlZmluZWQ7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgYznoLTmo4TmuIjjgb/jgafjgYLjgovjgYvjganjgYbjgYvjgpLov5TjgZnjgIJcbiAgICAgICAgICovXG4gICAgICAgIEFzc2V0TWFuYWdlci5wcm90b3R5cGUuZGVzdHJveWVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2FtZSA9PT0gdW5kZWZpbmVkO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogYEFzc2V0YCDjga7oqq3jgb/ovrzjgb/jgpLlho3oqabooYzjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog5byV5pWwIGBhc3NldGAg44Gv6Kqt44G/6L6844G/44Gu5aSx5pWX44GMIChgU2NlbmUjYXNzZXRMb2FkRmFpbGAg44GnKSDpgJrnn6XjgZXjgozjgZ/jgqLjgrvjg4Pjg4jjgafjgarjgZHjgozjgbDjgarjgonjgarjgYTjgIJcbiAgICAgICAgICogQHBhcmFtIGFzc2V0IOiqreOBv+i+vOOBv+OCkuWGjeippuihjOOBmeOCi+OCouOCu+ODg+ODiFxuICAgICAgICAgKi9cbiAgICAgICAgQXNzZXRNYW5hZ2VyLnByb3RvdHlwZS5yZXRyeUxvYWQgPSBmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5fbG9hZGluZ3MuaGFzT3duUHJvcGVydHkoYXNzZXQuaWQpKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkFzc2V0TWFuYWdlciNyZXRyeUxvYWQ6IGludmFsaWQgYXJndW1lbnQuXCIpO1xuICAgICAgICAgICAgdmFyIGxvYWRpbmdJbmZvID0gdGhpcy5fbG9hZGluZ3NbYXNzZXQuaWRdO1xuICAgICAgICAgICAgaWYgKGxvYWRpbmdJbmZvLmVycm9yQ291bnQgPiBBc3NldE1hbmFnZXIuTUFYX0VSUk9SX0NPVU5UKSB7XG4gICAgICAgICAgICAgICAgLy8gRHluYW1pY0Fzc2V0IOOBr+OCqOODqeODvOOBjOimj+WumuWbnuaVsOi2heOBiOOBn+WgtOWQiOOBr+S+i+WkluOBq+OBm+OBmuirpuOCgeOCi+OAglxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5jb25maWd1cmF0aW9uW2Fzc2V0LmlkXSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkFzc2V0TWFuYWdlciNyZXRyeUxvYWQ6IHRvbyBtYW55IHJldHJ5aW5nLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghbG9hZGluZ0luZm8ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIGxvYWRpbmdJbmZvLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGFzc2V0Ll9sb2FkKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44GT44Gu44Kk44Oz44K544K/44Oz44K544Gr5LiO44GI44KJ44KM44GfIGBBc3NldENvbmZpZ3VyYXRpb25NYXBgIOOBruOBhuOBoeOAgeOCsOODreODvOODkOODq+OCouOCu+ODg+ODiOOBrklE44KS44GZ44G544Gm6L+U44GZ44CCXG4gICAgICAgICAqL1xuICAgICAgICBBc3NldE1hbmFnZXIucHJvdG90eXBlLmdsb2JhbEFzc2V0SWRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHJldCA9IFtdO1xuICAgICAgICAgICAgdmFyIGNvbmYgPSB0aGlzLmNvbmZpZ3VyYXRpb247XG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIGNvbmYpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWNvbmYuaGFzT3duUHJvcGVydHkocCkpXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGlmIChjb25mW3BdLmdsb2JhbClcbiAgICAgICAgICAgICAgICAgICAgcmV0LnB1c2gocCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44Ki44K744OD44OI44Gu5Y+W5b6X44KS6KaB5rGC44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOimgeaxguOBl+OBn+OCouOCu+ODg+ODiOOBjOiqreOBv+i+vOOBv+a4iOOBv+OBp+OBquOBhOWgtOWQiOOAgeiqreOBv+i+vOOBv+OBjOihjOOCj+OCjOOCi+OAglxuICAgICAgICAgKiDlj5blvpfjgZfjgZ/ntZDmnpzjga8gYGhhbmRsZXJgIOOCkumAmuOBl+OBpumAmuefpeOBleOCjOOCi+OAglxuICAgICAgICAgKiDjgrLjg7zjg6DplovnmbrogIXjga/jgZPjga7jg6Hjgr3jg4Pjg4njgpLlkbzjgbPlh7rjgZfjgabjgqLjgrvjg4Pjg4jjgpLlj5blvpfjgZfjgZ/loLTlkIjjgIFcbiAgICAgICAgICog5ZCM44GY44Ki44K744OD44OISUQo44G+44Gf44Gv5Y+W5b6X44GX44Gf44Ki44K744OD44OIKeOBpyBgdW5yZWZBc3NldCgpYCDjgpLlkbzjgbPlh7rjgZXjgarjgZHjgozjgbDjgarjgonjgarjgYTjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIGFzc2V0SWRPckNvbmYg6KaB5rGC44GZ44KL44Ki44K744OD44OI44GuSUTjgb7jgZ/jga/oqK3lrppcbiAgICAgICAgICogQHBhcmFtIGhhbmRsZXIg6KaB5rGC57WQ5p6c44KS5Y+X44GR5Y+W44KL44OP44Oz44OJ44OpXG4gICAgICAgICAqL1xuICAgICAgICBBc3NldE1hbmFnZXIucHJvdG90eXBlLnJlcXVlc3RBc3NldCA9IGZ1bmN0aW9uIChhc3NldElkT3JDb25mLCBoYW5kbGVyKSB7XG4gICAgICAgICAgICB2YXIgYXNzZXRJZCA9ICh0eXBlb2YgYXNzZXRJZE9yQ29uZiA9PT0gXCJzdHJpbmdcIikgPyBhc3NldElkT3JDb25mIDogYXNzZXRJZE9yQ29uZi5pZDtcbiAgICAgICAgICAgIHZhciB3YWl0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgbG9hZGluZ0luZm87XG4gICAgICAgICAgICBpZiAodGhpcy5fYXNzZXRzLmhhc093blByb3BlcnR5KGFzc2V0SWQpKSB7XG4gICAgICAgICAgICAgICAgKyt0aGlzLl9yZWZDb3VudHNbYXNzZXRJZF07XG4gICAgICAgICAgICAgICAgaGFuZGxlci5fb25Bc3NldExvYWQodGhpcy5fYXNzZXRzW2Fzc2V0SWRdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuX2xvYWRpbmdzLmhhc093blByb3BlcnR5KGFzc2V0SWQpKSB7XG4gICAgICAgICAgICAgICAgbG9hZGluZ0luZm8gPSB0aGlzLl9sb2FkaW5nc1thc3NldElkXTtcbiAgICAgICAgICAgICAgICBsb2FkaW5nSW5mby5oYW5kbGVycy5wdXNoKGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgICsrdGhpcy5fcmVmQ291bnRzW2Fzc2V0SWRdO1xuICAgICAgICAgICAgICAgIHdhaXRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl9jcmVhdGVBc3NldEZvcihhc3NldElkT3JDb25mKTtcbiAgICAgICAgICAgICAgICBsb2FkaW5nSW5mbyA9IG5ldyBBc3NldExvYWRpbmdJbmZvKGEsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2xvYWRpbmdzW2Fzc2V0SWRdID0gbG9hZGluZ0luZm87XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVmQ291bnRzW2Fzc2V0SWRdID0gMTtcbiAgICAgICAgICAgICAgICB3YWl0aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBsb2FkaW5nSW5mby5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBhLl9sb2FkKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHdhaXRpbmc7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgqLjgrvjg4Pjg4jjga7lj4Lnhafjgqvjgqbjg7Pjg4jjgpLmuJvjgonjgZnjgIJcbiAgICAgICAgICog5byV5pWw44Gu5ZCE6KaB57Sg44GnIGB1bnJlZkFzc2V0KClgIOOCkuWRvOOBs+WHuuOBmeOAglxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gYXNzZXRPcklkIOWPgueFp+OCq+OCpuODs+ODiOOCkua4m+OCieOBmeOCouOCu+ODg+ODiOOBvuOBn+OBr+OCouOCu+ODg+ODiElEXG4gICAgICAgICAqL1xuICAgICAgICBBc3NldE1hbmFnZXIucHJvdG90eXBlLnVucmVmQXNzZXQgPSBmdW5jdGlvbiAoYXNzZXRPcklkKSB7XG4gICAgICAgICAgICB2YXIgYXNzZXRJZCA9ICh0eXBlb2YgYXNzZXRPcklkID09PSBcInN0cmluZ1wiKSA/IGFzc2V0T3JJZCA6IGFzc2V0T3JJZC5pZDtcbiAgICAgICAgICAgIGlmICgtLXRoaXMuX3JlZkNvdW50c1thc3NldElkXSA+IDApXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5fcmVsZWFzZUFzc2V0KGFzc2V0SWQpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog6KSH5pWw44Gu44Ki44K744OD44OI44Gu5Y+W5b6X44KS6KaB5rGC44GZ44KL44CCXG4gICAgICAgICAqIOW8leaVsOOBruWQhOimgee0oOOBpyBgcmVxdWVzdEFzc2V0KClgIOOCkuWRvOOBs+WHuuOBmeOAglxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gYXNzZXRJZE9yQ29uZnMg5Y+W5b6X44GZ44KL44Ki44K744OD44OI44GuSUTjgb7jgZ/jga/jgqLjgrvjg4Pjg4jlrprnvqlcbiAgICAgICAgICogQHBhcmFtIGhhbmRsZXIg5Y+W5b6X44Gu57WQ5p6c44KS5Y+X44GR5Y+W44KL44OP44Oz44OJ44OpXG4gICAgICAgICAqL1xuICAgICAgICBBc3NldE1hbmFnZXIucHJvdG90eXBlLnJlcXVlc3RBc3NldHMgPSBmdW5jdGlvbiAoYXNzZXRJZE9yQ29uZnMsIGhhbmRsZXIpIHtcbiAgICAgICAgICAgIHZhciB3YWl0aW5nQ291bnQgPSAwO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFzc2V0SWRPckNvbmZzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmVxdWVzdEFzc2V0KGFzc2V0SWRPckNvbmZzW2ldLCBoYW5kbGVyKSkge1xuICAgICAgICAgICAgICAgICAgICArK3dhaXRpbmdDb3VudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gd2FpdGluZ0NvdW50O1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog6KSH5pWw44Gu44Ki44K744OD44OI44KS6Kej5pS+44GZ44KL44CCXG4gICAgICAgICAqIOW8leaVsOOBruWQhOimgee0oOOBpyBgdW5yZWZBc3NldCgpYCDjgpLlkbzjgbPlh7rjgZnjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIGFzc2V0T3JJZHMg5Y+C54Wn44Kr44Km44Oz44OI44KS5rib44KJ44GZ44Ki44K744OD44OI44G+44Gf44Gv44Ki44K744OD44OISURcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIEFzc2V0TWFuYWdlci5wcm90b3R5cGUudW5yZWZBc3NldHMgPSBmdW5jdGlvbiAoYXNzZXRPcklkcykge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFzc2V0T3JJZHMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVucmVmQXNzZXQoYXNzZXRPcklkc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIEFzc2V0TWFuYWdlci5wcm90b3R5cGUuX25vcm1hbGl6ZSA9IGZ1bmN0aW9uIChjb25maWd1cmF0aW9uLCBhdWRpb1N5c3RlbUNvbmZNYXApIHtcbiAgICAgICAgICAgIHZhciByZXQgPSB7fTtcbiAgICAgICAgICAgIGlmICghKGNvbmZpZ3VyYXRpb24gaW5zdGFuY2VvZiBPYmplY3QpKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkFzc2V0TWFuYWdlciNfbm9ybWFsaXplOiBpbnZhbGlkIGFyZ3VtZW50cy5cIik7XG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIGNvbmZpZ3VyYXRpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAoIWNvbmZpZ3VyYXRpb24uaGFzT3duUHJvcGVydHkocCkpXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIHZhciBjb25mID0gT2JqZWN0LmNyZWF0ZShjb25maWd1cmF0aW9uW3BdKTtcbiAgICAgICAgICAgICAgICBpZiAoIWNvbmYucGF0aCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJBc3NldE1hbmFnZXIjX25vcm1hbGl6ZTogTm8gcGF0aCBnaXZlbiBmb3I6IFwiICsgcCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghY29uZi52aXJ0dWFsUGF0aCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJBc3NldE1hbmFnZXIjX25vcm1hbGl6ZTogTm8gdmlydHVhbFBhdGggZ2l2ZW4gZm9yOiBcIiArIHApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWNvbmYudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJBc3NldE1hbmFnZXIjX25vcm1hbGl6ZTogTm8gdHlwZSBnaXZlbiBmb3I6IFwiICsgcCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjb25mLnR5cGUgPT09IFwiaW1hZ2VcIikge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbmYud2lkdGggIT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJBc3NldE1hbmFnZXIjX25vcm1hbGl6ZTogd3Jvbmcgd2lkdGggZ2l2ZW4gZm9yIHRoZSBpbWFnZSBhc3NldDogXCIgKyBwKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25mLmhlaWdodCAhPT0gXCJudW1iZXJcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkFzc2V0TWFuYWdlciNfbm9ybWFsaXplOiB3cm9uZyBoZWlnaHQgZ2l2ZW4gZm9yIHRoZSBpbWFnZSBhc3NldDogXCIgKyBwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNvbmYudHlwZSA9PT0gXCJhdWRpb1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGR1cmF0aW9u44Go44GE44GG44Oh44Oz44OQ44Gv5b6M44GL44KJ6L+95Yqg44GX44Gf44Gf44KB44CB5Y+k44GEZ2FtZS5qc29u44Gn44GvdW5kZWZpbmVk44Gr44Gq44KL5aC05ZCI44GM44GC44KLXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25mLmR1cmF0aW9uID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25mLmR1cmF0aW9uID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGF1ZGlvU3lzdGVtQ29uZiA9IGF1ZGlvU3lzdGVtQ29uZk1hcFtjb25mLnN5c3RlbUlkXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmYubG9vcCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25mLmxvb3AgPSAhIWF1ZGlvU3lzdGVtQ29uZiAmJiAhIWF1ZGlvU3lzdGVtQ29uZi5sb29wO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25mLmhpbnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uZi5oaW50ID0gYXVkaW9TeXN0ZW1Db25mID8gYXVkaW9TeXN0ZW1Db25mLmhpbnQgOiB7fTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY29uZi50eXBlID09PSBcInZpZGVvXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb25mLnVzZVJlYWxTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbmYud2lkdGggIT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiQXNzZXRNYW5hZ2VyI19ub3JtYWxpemU6IHdyb25nIHdpZHRoIGdpdmVuIGZvciB0aGUgdmlkZW8gYXNzZXQ6IFwiICsgcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbmYuaGVpZ2h0ICE9PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkFzc2V0TWFuYWdlciNfbm9ybWFsaXplOiB3cm9uZyBoZWlnaHQgZ2l2ZW4gZm9yIHRoZSB2aWRlbyBhc3NldDogXCIgKyBwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmYudXNlUmVhbFNpemUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWNvbmYuZ2xvYmFsKVxuICAgICAgICAgICAgICAgICAgICBjb25mLmdsb2JhbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJldFtwXSA9IGNvbmY7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIEFzc2V0TWFuYWdlci5wcm90b3R5cGUuX2NyZWF0ZUFzc2V0Rm9yID0gZnVuY3Rpb24gKGlkT3JDb25mKSB7XG4gICAgICAgICAgICB2YXIgaWQ7XG4gICAgICAgICAgICB2YXIgdXJpO1xuICAgICAgICAgICAgdmFyIGNvbmY7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGlkT3JDb25mID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgaWQgPSBpZE9yQ29uZjtcbiAgICAgICAgICAgICAgICBjb25mID0gdGhpcy5jb25maWd1cmF0aW9uW2lkXTtcbiAgICAgICAgICAgICAgICB1cmkgPSB0aGlzLmNvbmZpZ3VyYXRpb25baWRdLnBhdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgZHluQ29uZiA9IGlkT3JDb25mO1xuICAgICAgICAgICAgICAgIGlkID0gZHluQ29uZi5pZDtcbiAgICAgICAgICAgICAgICBjb25mID0gZHluQ29uZjtcbiAgICAgICAgICAgICAgICB1cmkgPSBkeW5Db25mLnVyaTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZXNvdXJjZUZhY3RvcnkgPSB0aGlzLmdhbWUucmVzb3VyY2VGYWN0b3J5O1xuICAgICAgICAgICAgaWYgKCFjb25mKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkFzc2V0TWFuYWdlciNfY3JlYXRlQXNzZXRGb3I6IHVua25vd24gYXNzZXQgSUQ6IFwiICsgaWQpO1xuICAgICAgICAgICAgc3dpdGNoIChjb25mLnR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiaW1hZ2VcIjpcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFzc2V0ID0gcmVzb3VyY2VGYWN0b3J5LmNyZWF0ZUltYWdlQXNzZXQoaWQsIHVyaSwgY29uZi53aWR0aCwgY29uZi5oZWlnaHQpO1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5pbml0aWFsaXplKGNvbmYuaGludCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhc3NldDtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYXVkaW9cIjpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN5c3RlbSA9IGNvbmYuc3lzdGVtSWQgPyB0aGlzLmdhbWUuYXVkaW9bY29uZi5zeXN0ZW1JZF0gOiB0aGlzLmdhbWUuYXVkaW9bdGhpcy5nYW1lLmRlZmF1bHRBdWRpb1N5c3RlbUlkXTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc291cmNlRmFjdG9yeS5jcmVhdGVBdWRpb0Fzc2V0KGlkLCB1cmksIGNvbmYuZHVyYXRpb24sIHN5c3RlbSwgY29uZi5sb29wLCBjb25mLmhpbnQpO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJ0ZXh0XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNvdXJjZUZhY3RvcnkuY3JlYXRlVGV4dEFzc2V0KGlkLCB1cmkpO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzY3JpcHRcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc291cmNlRmFjdG9yeS5jcmVhdGVTY3JpcHRBc3NldChpZCwgdXJpKTtcbiAgICAgICAgICAgICAgICBjYXNlIFwidmlkZW9cIjpcbiAgICAgICAgICAgICAgICAgICAgLy8gVmlkZW9TeXN0ZW3jga/jgb7jgaDkuK3ouqvjgYzlrprnvqnjgZXjgozjgabjgYTjgarjgYzjgIHlsIbmnaXjga7jgZ/jgoHjgatWaWRlb0Fzc2V044GrVmlkZW9TeXN0ZW3jgpLmuKHjgZnjgajjgYTjgYbkvZPoo4HjgaDjgZHjgYzmlbTjgYjjgonjgozjgabjgYTjgovjgIJcbiAgICAgICAgICAgICAgICAgICAgLy8g5Lul5LiK44KS6LiP44G+44GI44CB44GT44GT44Gn44Gv57Ch5Y2Y44Gu44Gf44KB44Gr6YO95bqm5paw44Gf44GqVmlkZW9TeXN0ZW3jgqTjg7Pjgrnjgr/jg7PjgrnjgpLnlJ/miJDjgZfjgabjgYTjgovjgIJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc291cmNlRmFjdG9yeS5jcmVhdGVWaWRlb0Fzc2V0KGlkLCB1cmksIGNvbmYud2lkdGgsIGNvbmYuaGVpZ2h0LCBuZXcgZy5WaWRlb1N5c3RlbSgpLCBjb25mLmxvb3AsIGNvbmYudXNlUmVhbFNpemUpO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkFzc2VydGlvbkVycm9yI19jcmVhdGVBc3NldEZvcjogdW5rbm93biBhc3NldCB0eXBlIFwiICsgY29uZi50eXBlICsgXCIgZm9yIGFzc2V0IElEOiBcIiArIGlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgQXNzZXRNYW5hZ2VyLnByb3RvdHlwZS5fcmVsZWFzZUFzc2V0ID0gZnVuY3Rpb24gKGFzc2V0SWQpIHtcbiAgICAgICAgICAgIHZhciBhc3NldCA9IHRoaXMuX2Fzc2V0c1thc3NldElkXSB8fCAodGhpcy5fbG9hZGluZ3NbYXNzZXRJZF0gJiYgdGhpcy5fbG9hZGluZ3NbYXNzZXRJZF0uYXNzZXQpO1xuICAgICAgICAgICAgdmFyIHBhdGg7XG4gICAgICAgICAgICBpZiAoYXNzZXQpIHtcbiAgICAgICAgICAgICAgICBwYXRoID0gYXNzZXQucGF0aDtcbiAgICAgICAgICAgICAgICBpZiAoYXNzZXQuaW5Vc2UoKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXNzZXQgaW5zdGFuY2VvZiBnLkF1ZGlvQXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0Ll9zeXN0ZW0ucmVxdWVzdERlc3Ryb3koYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFzc2V0IGluc3RhbmNlb2YgZy5WaWRlb0Fzc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBOT1RFOiDkuIDml6blho3nlJ/lrozkuobjgpLlvoXjgZ/jgZrjgavnoLTmo4TjgZnjgovjgZPjgajjgavjgZnjgotcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IOWGjeeUn+S4reOBruWLleeUu+OCkuegtOajhOOBmeOCi+OCv+OCpOODn+ODs+OCsOOCkuOBqeOBruOCiOOBhuOBq+aJseOBhuOBi+aknOiojuOBl+Wun+ijhVxuICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXQuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiQXNzZXRNYW5hZ2VyI3VucmVmQXNzZXRzOiBVbnN1cHBvcnRlZCBpbi11c2UgXCIgKyBhc3NldC5pZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fcmVmQ291bnRzW2Fzc2V0SWRdO1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2xvYWRpbmdzW2Fzc2V0SWRdO1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2Fzc2V0c1thc3NldElkXTtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb25bYXNzZXRJZF0pIHtcbiAgICAgICAgICAgICAgICB2YXIgdmlydHVhbFBhdGggPSB0aGlzLmNvbmZpZ3VyYXRpb25bYXNzZXRJZF0udmlydHVhbFBhdGg7XG4gICAgICAgICAgICAgICAgaWYgKHZpcnR1YWxQYXRoICYmIHRoaXMuX2xpdmVBc3NldFZpcnR1YWxQYXRoVGFibGUuaGFzT3duUHJvcGVydHkodmlydHVhbFBhdGgpKVxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fbGl2ZUFzc2V0VmlydHVhbFBhdGhUYWJsZVt2aXJ0dWFsUGF0aF07XG4gICAgICAgICAgICAgICAgaWYgKHBhdGggJiYgdGhpcy5fbGl2ZUFic29sdXRlUGF0aFRhYmxlLmhhc093blByb3BlcnR5KHBhdGgpKVxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fbGl2ZUFic29sdXRlUGF0aFRhYmxlW3BhdGhdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog54++5Zyo44Ot44O844OJ5Lit44Gu44Ki44K744OD44OI44Gu5pWw44CCKOODh+ODkOODg+OCsOeUqDsg55u05o6l44Gu55So6YCU44Gv44Gq44GEKVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgQXNzZXRNYW5hZ2VyLnByb3RvdHlwZS5fY291bnRMb2FkaW5nQXNzZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5fbG9hZGluZ3MpLmxlbmd0aDtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBBc3NldE1hbmFnZXIucHJvdG90eXBlLl9vbkFzc2V0RXJyb3IgPSBmdW5jdGlvbiAoYXNzZXQsIGVycm9yKSB7XG4gICAgICAgICAgICAvLyDjg63jg7zjg4nkuK3jgasgU2NlbmUg44GM56C05qOE44GV44KM44Gm44GE44Gf5aC05ZCI44Gq44Gp44Gn44CBYXNzZXQg44GM56C05qOE5riI44G/44Gr44Gq44KL44GT44Go44GM44GC44KLXG4gICAgICAgICAgICBpZiAodGhpcy5kZXN0cm95ZWQoKSB8fCBhc3NldC5kZXN0cm95ZWQoKSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB2YXIgbG9hZGluZ0luZm8gPSB0aGlzLl9sb2FkaW5nc1thc3NldC5pZF07XG4gICAgICAgICAgICB2YXIgaHMgPSBsb2FkaW5nSW5mby5oYW5kbGVycztcbiAgICAgICAgICAgIGxvYWRpbmdJbmZvLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICsrbG9hZGluZ0luZm8uZXJyb3JDb3VudDtcbiAgICAgICAgICAgIGlmIChsb2FkaW5nSW5mby5lcnJvckNvdW50ID4gQXNzZXRNYW5hZ2VyLk1BWF9FUlJPUl9DT1VOVCAmJiBlcnJvci5yZXRyaWFibGUpIHtcbiAgICAgICAgICAgICAgICBlcnJvciA9IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NldExvYWRFcnJvcihcIlJldHJ5IGxpbWl0IGV4Y2VlZGVkXCIsIGZhbHNlLCBnLkFzc2V0TG9hZEVycm9yVHlwZS5SZXRyeUxpbWl0RXhjZWVkZWQsIGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghZXJyb3IucmV0cmlhYmxlKVxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9sb2FkaW5nc1thc3NldC5pZF07XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhzLmxlbmd0aDsgKytpKVxuICAgICAgICAgICAgICAgIGhzW2ldLl9vbkFzc2V0RXJyb3IoYXNzZXQsIGVycm9yLCB0aGlzKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBBc3NldE1hbmFnZXIucHJvdG90eXBlLl9vbkFzc2V0TG9hZCA9IGZ1bmN0aW9uIChhc3NldCkge1xuICAgICAgICAgICAgLy8g44Ot44O844OJ5Lit44GrIFNjZW5lIOOBjOegtOajhOOBleOCjOOBpuOBhOOBn+WgtOWQiOOBquOBqeOBp+OAgWFzc2V0IOOBjOegtOajhOa4iOOBv+OBq+OBquOCi+OBk+OBqOOBjOOBguOCi1xuICAgICAgICAgICAgaWYgKHRoaXMuZGVzdHJveWVkKCkgfHwgYXNzZXQuZGVzdHJveWVkKCkpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgdmFyIGxvYWRpbmdJbmZvID0gdGhpcy5fbG9hZGluZ3NbYXNzZXQuaWRdO1xuICAgICAgICAgICAgbG9hZGluZ0luZm8ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2xvYWRpbmdzW2Fzc2V0LmlkXTtcbiAgICAgICAgICAgIHRoaXMuX2Fzc2V0c1thc3NldC5pZF0gPSBhc3NldDtcbiAgICAgICAgICAgIC8vIER5bmFtaWNBc3NldCDjga7loLTlkIjjga8gY29uZmlndXJhdGlvbiDjgavmm7jjgYvjgozjgabjgYTjgarjgYTjga7jgafku6XkuIvjga7liKTlrprjgYzlgb3jgavjgarjgotcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb25bYXNzZXQuaWRdKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZpcnR1YWxQYXRoID0gdGhpcy5jb25maWd1cmF0aW9uW2Fzc2V0LmlkXS52aXJ0dWFsUGF0aDtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2xpdmVBc3NldFZpcnR1YWxQYXRoVGFibGUuaGFzT3duUHJvcGVydHkodmlydHVhbFBhdGgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2xpdmVBc3NldFZpcnR1YWxQYXRoVGFibGVbdmlydHVhbFBhdGhdID0gYXNzZXQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fbGl2ZUFzc2V0VmlydHVhbFBhdGhUYWJsZVt2aXJ0dWFsUGF0aF0ucGF0aCAhPT0gYXNzZXQucGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkFzc2V0TWFuYWdlciNfb25Bc3NldExvYWQoKTogZHVwbGljYXRlZCBhc3NldCBwYXRoXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2xpdmVBYnNvbHV0ZVBhdGhUYWJsZS5oYXNPd25Qcm9wZXJ0eShhc3NldC5wYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGl2ZUFic29sdXRlUGF0aFRhYmxlW2Fzc2V0LnBhdGhdID0gdmlydHVhbFBhdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgaHMgPSBsb2FkaW5nSW5mby5oYW5kbGVycztcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaHMubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgaHNbaV0uX29uQXNzZXRMb2FkKGFzc2V0KTtcbiAgICAgICAgfTtcbiAgICAgICAgQXNzZXRNYW5hZ2VyLk1BWF9FUlJPUl9DT1VOVCA9IDM7XG4gICAgICAgIHJldHVybiBBc3NldE1hbmFnZXI7XG4gICAgfSgpKTtcbiAgICBnLkFzc2V0TWFuYWdlciA9IEFzc2V0TWFuYWdlcjtcbn0pKGcgfHwgKGcgPSB7fSkpO1xudmFyIGc7XG4oZnVuY3Rpb24gKGcpIHtcbiAgICAvKipcbiAgICAgKiBub2RlLmpzIOOBriByZXF1aXJlKCkg44Op44Kk44Kv44Gq6Kqt44G/6L6844G/5Yem55CG44KS6KGM44GE44CB44Gd44Gu57WQ5p6c44KS6L+U44GZ44CCXG4gICAgICpcbiAgICAgKiBub2RlLmpz44GucmVxdWlyZeOBq+mZkOOCiuOBquOBj+i/keOBhOODouODh+ODq+OBp3JlcXVpcmXjgZnjgovjgIJcbiAgICAgKiDjgZ/jgaDjgZfjgqLjgrvjg4Pjg4hJROOBp+ipsuW9k+OBmeOCjOOBsOOBneOBoeOCieOCkuWEquWFiOOBmeOCi+OAguOBvuOBnyBub2RlLmpzIOOBruOCs+OCouODouOCuOODpeODvOODq+OBq+OBr+WvvuW/nOOBl+OBpuOBhOOBquOBhOOAglxuICAgICAqIOmAmuW4uOOAgeOCsuODvOODoOmWi+eZuuiAheOBjOWIqeeUqOOBmeOCi+OBruOBryBgTW9kdWxlI3JlcXVpcmUoKWAg44Gn44GC44KK44CB44GT44Gu44Oh44K944OD44OJ44Gv44Gd44Gu5YaF6YOo5a6f6KOF44KS5o+Q5L6b44GZ44KL44CCXG4gICAgICogQHBhcmFtIGdhbWUgcmVxdWlyZeOCkuWun+ihjOOBmeOCi+OCs+ODs+ODhuOCreOCueODiOOCkuihqOOBmUdhbWXjgqTjg7Pjgrnjgr/jg7PjgrlcbiAgICAgKiBAcGFyYW0gcGF0aCByZXF1aXJl44Gu44OR44K544CC55u45a++44OR44K544Go44CBQXNzZXTorZjliKXlkI3jgpLliKnnlKjjgZnjgovjgZPjgajjgYzlh7rmnaXjgovjgIJcbiAgICAgKiAgICAgICAgICAgICAg44Gq44GK44CBLi94eHguanNvbiDjga7jgojjgYbjgatqc29u44KS5oyH5a6a44GZ44KL5aC05ZCI44CB44Gd44GuQXNzZXTjga9UZXh0QXNzZXTjgafjgYLjgovlv4XopoHjgYzjgYLjgovjgIJcbiAgICAgKiAgICAgICAgICAgICAg44Gd44Gu5LuW44Gu5b2i5byP44Gn44GC44KL5aC05ZCI44CB44Gd44GuQXNzZXTjga9TY3JpcHRBc3NldOOBp+OBguOCi+W/heimgeOBjOOBguOCi+OAglxuICAgICAqIEBwYXJhbSBjdXJyZW50TW9kdWxlIOOBk+OBrnJlcXVpcmXjgpLlrp/ooYzjgZfjgZ8gTW9kdWxlXG4gICAgICogQHJldHVybnMge2FueX0g44K544Kv44Oq44OX44OI5a6f6KGM57WQ5p6c44CC6YCa5bi444GvU2NyaXB0QXNzZXQjZXhlY3V0ZeOBrue1kOaenOOAglxuICAgICAqICAgICAgICAgICAgICAgICDkvovlpJbnmoTjgavjgIFqc29u44Gn44GC44KM44GwVGV4dEFzc2V0I2RhdGHjgpJKU09OLnBhcnNl44GX44Gf57WQ5p6c44GM6L+U44KLXG4gICAgICovXG4gICAgZnVuY3Rpb24gX3JlcXVpcmUoZ2FtZSwgcGF0aCwgY3VycmVudE1vZHVsZSkge1xuICAgICAgICAvLyBOb2RlLmpzIOOBriByZXF1aXJlIOOBruaMmeWLleOBq+OBpOOBhOOBpuOBryBodHRwOi8vbm9kZWpzLmpwL25vZGVqcy5vcmdfamEvYXBpL21vZHVsZXMuaHRtbCDjgoLlj4LnhafjgIJcbiAgICAgICAgdmFyIHRhcmdldFNjcmlwdEFzc2V0O1xuICAgICAgICB2YXIgcmVzb2x2ZWRQYXRoO1xuICAgICAgICB2YXIgbGl2ZUFzc2V0VmlydHVhbFBhdGhUYWJsZSA9IGdhbWUuX2Fzc2V0TWFuYWdlci5fbGl2ZUFzc2V0VmlydHVhbFBhdGhUYWJsZTtcbiAgICAgICAgdmFyIG1vZHVsZU1haW5TY3JpcHRzID0gZ2FtZS5fYXNzZXRNYW5hZ2VyLl9tb2R1bGVNYWluU2NyaXB0cztcbiAgICAgICAgLy8gMC4g44Ki44K744OD44OISUTjgonjgZfjgYTloLTlkIjjga/jgb7jgZrlvZPoqbLjgqLjgrvjg4Pjg4jjgpLmjqLjgZlcbiAgICAgICAgaWYgKHBhdGguaW5kZXhPZihcIi9cIikgPT09IC0xKSB7XG4gICAgICAgICAgICBpZiAoZ2FtZS5fYXNzZXRNYW5hZ2VyLl9hc3NldHMuaGFzT3duUHJvcGVydHkocGF0aCkpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRTY3JpcHRBc3NldCA9IGdhbWUuX2Fzc2V0TWFuYWdlci5fYXNzZXRzW3BhdGhdO1xuICAgICAgICAgICAgICAgIHJlc29sdmVkUGF0aCA9IGdhbWUuX2Fzc2V0TWFuYWdlci5fbGl2ZUFic29sdXRlUGF0aFRhYmxlW3RhcmdldFNjcmlwdEFzc2V0LnBhdGhdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIDEuIElmIFggaXMgYSBjb3JlIG1vZHVsZSxcbiAgICAgICAgLy8gKOS9leOCguOBl+OBquOBhOOAguOCs+OCouODouOCuOODpeODvOODq+OBq+OBr+WvvuW/nOOBl+OBpuOBhOOBquOBhOOAguOCsuODvOODoOmWi+eZuuiAheOBr+iHquWIhuOBp+OCs+OCouODouOCuOODpeODvOODq+OBuOOBruS+neWtmOOCkuino+axuuOBmeOCi+W/heimgeOBjOOBguOCiylcbiAgICAgICAgaWYgKC9eXFwuXFwvfF5cXC5cXC5cXC98XlxcLy8udGVzdChwYXRoKSkge1xuICAgICAgICAgICAgLy8gMi4gSWYgWCBiZWdpbnMgd2l0aCAnLi8nIG9yICcvJyBvciAnLi4vJ1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRNb2R1bGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRNb2R1bGUuX3ZpcnR1YWxEaXJuYW1lKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJnLl9yZXF1aXJlOiByZXF1aXJlIGZyb20gRHluYW1pY0Fzc2V0IGlzIG5vdCBzdXBwb3J0ZWRcIik7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZWRQYXRoID0gZy5QYXRoVXRpbC5yZXNvbHZlUGF0aChjdXJyZW50TW9kdWxlLl92aXJ0dWFsRGlybmFtZSwgcGF0aCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoISgvXlxcLlxcLy8udGVzdChwYXRoKSkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcImcuX3JlcXVpcmU6IGVudHJ5IHBvaW50IHBhdGggbXVzdCBzdGFydCB3aXRoICcuLydcIik7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZWRQYXRoID0gcGF0aC5zdWJzdHJpbmcoMik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ2FtZS5fc2NyaXB0Q2FjaGVzLmhhc093blByb3BlcnR5KHJlc29sdmVkUGF0aCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2FtZS5fc2NyaXB0Q2FjaGVzW3Jlc29sdmVkUGF0aF0uX2NhY2hlZFZhbHVlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChnYW1lLl9zY3JpcHRDYWNoZXMuaGFzT3duUHJvcGVydHkocmVzb2x2ZWRQYXRoICsgXCIuanNcIikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2FtZS5fc2NyaXB0Q2FjaGVzW3Jlc29sdmVkUGF0aCArIFwiLmpzXCJdLl9jYWNoZWRWYWx1ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gMi5hLiBMT0FEX0FTX0ZJTEUoWSArIFgpXG4gICAgICAgICAgICBpZiAoIXRhcmdldFNjcmlwdEFzc2V0KVxuICAgICAgICAgICAgICAgIHRhcmdldFNjcmlwdEFzc2V0ID0gZy5VdGlsLmZpbmRBc3NldEJ5UGF0aEFzRmlsZShyZXNvbHZlZFBhdGgsIGxpdmVBc3NldFZpcnR1YWxQYXRoVGFibGUpO1xuICAgICAgICAgICAgLy8gMi5iLiBMT0FEX0FTX0RJUkVDVE9SWShZICsgWClcbiAgICAgICAgICAgIGlmICghdGFyZ2V0U2NyaXB0QXNzZXQpXG4gICAgICAgICAgICAgICAgdGFyZ2V0U2NyaXB0QXNzZXQgPSBnLlV0aWwuZmluZEFzc2V0QnlQYXRoQXNEaXJlY3RvcnkocmVzb2x2ZWRQYXRoLCBsaXZlQXNzZXRWaXJ0dWFsUGF0aFRhYmxlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIDMuIExPQURfTk9ERV9NT0RVTEVTKFgsIGRpcm5hbWUoWSkpXG4gICAgICAgICAgICAvLyBgcGF0aGAg44GvIG5vZGUgbW9kdWxlIOOBruWQjeWJjeOBp+OBguOCi+OBqOS7ruWumuOBl+OBpuaOouOBmVxuICAgICAgICAgICAgLy8gYWthc2hpYy1lbmdpbmXni6zoh6rku5Xmp5g6IOWvvuixoeOBriBgcGF0aGAg44GMIGBtb2R1bGVNYWluU2NyaXB0c2Ag44Gr5oyH5a6a44GV44KM44Gm44GE44Gf44KJ44Gd44Gh44KJ44KS5Y+C54Wn44GZ44KLXG4gICAgICAgICAgICBpZiAobW9kdWxlTWFpblNjcmlwdHNbcGF0aF0pIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlZFBhdGggPSBtb2R1bGVNYWluU2NyaXB0c1twYXRoXTtcbiAgICAgICAgICAgICAgICB0YXJnZXRTY3JpcHRBc3NldCA9IGdhbWUuX2Fzc2V0TWFuYWdlci5fbGl2ZUFzc2V0VmlydHVhbFBhdGhUYWJsZVtyZXNvbHZlZFBhdGhdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0YXJnZXRTY3JpcHRBc3NldCkge1xuICAgICAgICAgICAgICAgIHZhciBkaXJzID0gY3VycmVudE1vZHVsZSA/IGN1cnJlbnRNb2R1bGUucGF0aHMgOiBbXTtcbiAgICAgICAgICAgICAgICBkaXJzLnB1c2goXCJub2RlX21vZHVsZXNcIik7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkaXJzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkaXIgPSBkaXJzW2ldO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlZFBhdGggPSBnLlBhdGhVdGlsLnJlc29sdmVQYXRoKGRpciwgcGF0aCk7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldFNjcmlwdEFzc2V0ID0gZy5VdGlsLmZpbmRBc3NldEJ5UGF0aEFzRmlsZShyZXNvbHZlZFBhdGgsIGxpdmVBc3NldFZpcnR1YWxQYXRoVGFibGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0U2NyaXB0QXNzZXQpXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0U2NyaXB0QXNzZXQgPSBnLlV0aWwuZmluZEFzc2V0QnlQYXRoQXNEaXJlY3RvcnkocmVzb2x2ZWRQYXRoLCBsaXZlQXNzZXRWaXJ0dWFsUGF0aFRhYmxlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldFNjcmlwdEFzc2V0KVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0YXJnZXRTY3JpcHRBc3NldCkge1xuICAgICAgICAgICAgaWYgKGdhbWUuX3NjcmlwdENhY2hlcy5oYXNPd25Qcm9wZXJ0eShyZXNvbHZlZFBhdGgpKVxuICAgICAgICAgICAgICAgIHJldHVybiBnYW1lLl9zY3JpcHRDYWNoZXNbcmVzb2x2ZWRQYXRoXS5fY2FjaGVkVmFsdWUoKTtcbiAgICAgICAgICAgIGlmICh0YXJnZXRTY3JpcHRBc3NldCBpbnN0YW5jZW9mIGcuU2NyaXB0QXNzZXQpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29udGV4dCA9IG5ldyBnLlNjcmlwdEFzc2V0Q29udGV4dChnYW1lLCB0YXJnZXRTY3JpcHRBc3NldCk7XG4gICAgICAgICAgICAgICAgZ2FtZS5fc2NyaXB0Q2FjaGVzW3Jlc29sdmVkUGF0aF0gPSBjb250ZXh0O1xuICAgICAgICAgICAgICAgIHJldHVybiBjb250ZXh0Ll9leGVjdXRlU2NyaXB0KGN1cnJlbnRNb2R1bGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGFyZ2V0U2NyaXB0QXNzZXQgaW5zdGFuY2VvZiBnLlRleHRBc3NldCkge1xuICAgICAgICAgICAgICAgIC8vIEpTT07jga7loLTlkIjjga7nibnmrormjJnli5XjgpLjg4jjg6zjg7zjgrnjgZnjgovjgZ/jgoHjga7jgrPjg7zjg4njgIJub2RlLmpz44Gu5LuV5qeY44Gr5rqW44Ga44KLXG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldFNjcmlwdEFzc2V0ICYmIGcuUGF0aFV0aWwucmVzb2x2ZUV4dG5hbWUocGF0aCkgPT09IFwiLmpzb25cIikge1xuICAgICAgICAgICAgICAgICAgICAvLyBOb3RlOiBub2RlLmpz44Gn44Gv44GT44GT44GnQk9N44Gu5o6S6Zmk44KS44GX44Gm44GE44KL44GM44CB44GE44Gj44Gf44KTYWthc2hpY+OBp+OBr+aOkumZpOOBl+OBquOBhOOBp+Wun+ijhVxuICAgICAgICAgICAgICAgICAgICB2YXIgY2FjaGUgPSBnYW1lLl9zY3JpcHRDYWNoZXNbcmVzb2x2ZWRQYXRoXSA9IG5ldyBnLlJlcXVpcmVDYWNoZWRWYWx1ZShKU09OLnBhcnNlKHRhcmdldFNjcmlwdEFzc2V0LmRhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhY2hlLl9jYWNoZWRWYWx1ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJnLl9yZXF1aXJlOiBjYW4gbm90IGZpbmQgbW9kdWxlOiBcIiArIHBhdGgpO1xuICAgIH1cbiAgICBnLl9yZXF1aXJlID0gX3JlcXVpcmU7XG4gICAgLyoqXG4gICAgICogTm9kZS5qcyDjgYzmj5DkvpvjgZnjgosgbW9kdWxlIOOBruS6kuaPm+OCr+ODqeOCueOAglxuICAgICAqL1xuICAgIHZhciBNb2R1bGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIE1vZHVsZShnYW1lLCBpZCwgcGF0aCkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIHZhciBkaXJuYW1lID0gZy5QYXRoVXRpbC5yZXNvbHZlRGlybmFtZShwYXRoKTtcbiAgICAgICAgICAgIC8vIGB2aXJ0dWFsUGF0aGAg44GoIGB2aXJ0dWFsRGlybmFtZWAg44Gv44CAYER5bmFtaWNBc3NldGAg44Gu5aC05ZCI44GvIGB1bmRlZmluZWRgIOOBq+OBquOCi+OAglxuICAgICAgICAgICAgdmFyIHZpcnR1YWxQYXRoID0gZ2FtZS5fYXNzZXRNYW5hZ2VyLl9saXZlQWJzb2x1dGVQYXRoVGFibGVbcGF0aF07XG4gICAgICAgICAgICB2YXIgdmlydHVhbERpcm5hbWUgPSB2aXJ0dWFsUGF0aCA/IGcuUGF0aFV0aWwucmVzb2x2ZURpcm5hbWUodmlydHVhbFBhdGgpIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgdmFyIF9nID0gT2JqZWN0LmNyZWF0ZShnLCB7XG4gICAgICAgICAgICAgICAgZ2FtZToge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZ2FtZSxcbiAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZmlsZW5hbWU6IHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBhdGgsXG4gICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRpcm5hbWU6IHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGRpcm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG1vZHVsZToge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcyxcbiAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5maWxlbmFtZSA9IHBhdGg7XG4gICAgICAgICAgICB0aGlzLmV4cG9ydHMgPSB7fTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50ID0gbnVsbDsgLy8gTm9kZS5qcyDjgajkupLmj5tcbiAgICAgICAgICAgIHRoaXMubG9hZGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuID0gW107XG4gICAgICAgICAgICB0aGlzLnBhdGhzID0gdmlydHVhbERpcm5hbWUgPyBnLlBhdGhVdGlsLm1ha2VOb2RlTW9kdWxlUGF0aHModmlydHVhbERpcm5hbWUpIDogW107XG4gICAgICAgICAgICB0aGlzLl9kaXJuYW1lID0gZGlybmFtZTtcbiAgICAgICAgICAgIHRoaXMuX3ZpcnR1YWxEaXJuYW1lID0gdmlydHVhbERpcm5hbWU7XG4gICAgICAgICAgICB0aGlzLl9nID0gX2c7XG4gICAgICAgICAgICAvLyDjg6Hjgr3jg4Pjg4njgajjgZfjgabjgafjga/jgarjgY/ljZjkvZPjgaflkbzjgbDjgozjgovjga7jgafjg6Hjgr3jg4Pjg4njgavjgZvjgZrjgZPjgZPjgaflrp/kvZPjgpLku6PlhaXjgZnjgotcbiAgICAgICAgICAgIHRoaXMucmVxdWlyZSA9IGZ1bmN0aW9uIChwYXRoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChwYXRoID09PSBcImdcIikgPyBfZyA6IGcuX3JlcXVpcmUoZ2FtZSwgcGF0aCwgX3RoaXMpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTW9kdWxlO1xuICAgIH0oKSk7XG4gICAgZy5Nb2R1bGUgPSBNb2R1bGU7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICogYFNjcmlwdEFzc2V0YCDjga7lrp/ooYzjgrPjg7Pjg4bjgq3jgrnjg4jjgIJcbiAgICAgKiDpgJrluLjjgrnjgq/jg6rjg5fjg4jjgqLjgrvjg4Pjg4jjgpLlrp/ooYzjgZnjgovjgZ/jgoHjgavjga/jgZPjga7jgq/jg6njgrnjgpLntYznlLHjgZnjgovjgIJcbiAgICAgKlxuICAgICAqIOOCsuODvOODoOmWi+eZuuiAheOBjOOBk+OBruOCr+ODqeOCueOCkuWIqeeUqOOBmeOCi+W/heimgeOBr+OBquOBhOOAglxuICAgICAqIOOCueOCr+ODquODl+ODiOOCouOCu+ODg+ODiOOCkuWun+ihjOOBmeOCi+WgtOWQiOOBr+OAgeaal+m7meOBq+OBk+OBruOCr+ODqeOCueOCkuWIqeeUqOOBmeOCiyBgcmVxdWlyZSgpYCDjgpLnlKjjgYTjgovjgZPjgajjgIJcbiAgICAgKi9cbiAgICB2YXIgU2NyaXB0QXNzZXRDb250ZXh0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgICAgICBmdW5jdGlvbiBTY3JpcHRBc3NldENvbnRleHQoZ2FtZSwgYXNzZXQpIHtcbiAgICAgICAgICAgIHRoaXMuX2dhbWUgPSBnYW1lO1xuICAgICAgICAgICAgdGhpcy5fYXNzZXQgPSBhc3NldDtcbiAgICAgICAgICAgIHRoaXMuX21vZHVsZSA9IG5ldyBnLk1vZHVsZShnYW1lLCBhc3NldC5wYXRoLCBhc3NldC5wYXRoKTtcbiAgICAgICAgICAgIHRoaXMuX2cgPSB0aGlzLl9tb2R1bGUuX2c7XG4gICAgICAgICAgICB0aGlzLl9zdGFydGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBTY3JpcHRBc3NldENvbnRleHQucHJvdG90eXBlLl9jYWNoZWRWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5fc3RhcnRlZClcbiAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJTY3JpcHRBc3NldENvbnRleHQjX2NhY2hlZFZhbHVlOiBub3QgZXhlY3V0ZWQgeWV0LlwiKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tb2R1bGUuZXhwb3J0cztcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBTY3JpcHRBc3NldENvbnRleHQucHJvdG90eXBlLl9leGVjdXRlU2NyaXB0ID0gZnVuY3Rpb24gKGN1cnJlbnRNb2R1bGUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9zdGFydGVkKVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tb2R1bGUuZXhwb3J0cztcbiAgICAgICAgICAgIGlmIChjdXJyZW50TW9kdWxlKSB7XG4gICAgICAgICAgICAgICAgLy8gTm9kZS5qcyDkupLmj5vmjJnli5U6IE1vZHVsZSNwYXJlbnQg44Gv5LiA55Wq5pyA5Yid44GrIHJlcXVpcmUoKSDjgZfjgZ8gbW9kdWxlIOOBq+OBquOCi1xuICAgICAgICAgICAgICAgIHRoaXMuX21vZHVsZS5wYXJlbnQgPSBjdXJyZW50TW9kdWxlO1xuICAgICAgICAgICAgICAgIC8vIE5vZGUuanMg5LqS5o+b5oyZ5YuVOiDopqogbW9kdWxlIOOBriBjaGlsZHJlbiDjgavjga/oh6rouqvjgYzlrp/ooYzkuK3jga7mrrXpmo7jgafml6Ljgavov73liqDjgZXjgozjgabjgYTjgotcbiAgICAgICAgICAgICAgICBjdXJyZW50TW9kdWxlLmNoaWxkcmVuLnB1c2godGhpcy5fbW9kdWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3N0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fYXNzZXQuZXhlY3V0ZSh0aGlzLl9nKTtcbiAgICAgICAgICAgIHRoaXMuX21vZHVsZS5sb2FkZWQgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21vZHVsZS5leHBvcnRzO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gU2NyaXB0QXNzZXRDb250ZXh0O1xuICAgIH0oKSk7XG4gICAgZy5TY3JpcHRBc3NldENvbnRleHQgPSBTY3JpcHRBc3NldENvbnRleHQ7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog5aSJ5o+b6KGM5YiX44KS5LiA6Iis55qE44GqSmF2YVNjcmlwdOOBruOBv+OBp+ihqOOBl+OBn+OCr+ODqeOCueOAglxuICAgICAqIOmAmuW4uOOCsuODvOODoOmWi+eZuuiAheOBjOacrOOCr+ODqeOCueOCkuebtOaOpeWIqeeUqOOBmeOCi+S6i+OBr+OBquOBhOOAglxuICAgICAqIOWQhOODleOCo+ODvOODq+ODieOAgeODoeOCveODg+ODieOBruips+e0sOOBryBgTWF0cml4YCDjgqTjg7Pjgr/jg7zjg5Xjgqfjg7zjgrnjga7oqqzmmI7jgpLlj4LnhafjgIJcbiAgICAgKi9cbiAgICB2YXIgUGxhaW5NYXRyaXggPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIFBsYWluTWF0cml4KHdpZHRoT3JTcmMsIGhlaWdodCwgc2NhbGVYLCBzY2FsZVksIGFuZ2xlLCBhbmNob3JYLCBhbmNob3JZKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiAoR0FNRURFVi04NDUpIEZsb2F0MzJBcnJheeOBruaWueOBjOmAn+OBhOOCieOBl+OBhOOBruOBp+OAgXBvbHlmaWxs44GX44Gm5L2/44GG44GL44Gp44GG44GL5qSc6KiOXG4gICAgICAgICAgICBpZiAod2lkdGhPclNyYyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbW9kaWZpZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLl9tYXRyaXggPSBbMSwgMCwgMCwgMSwgMCwgMF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2Ygd2lkdGhPclNyYyA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuX21vZGlmaWVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWF0cml4ID0gbmV3IEFycmF5KDYpO1xuICAgICAgICAgICAgICAgIGlmIChhbmNob3JYICE9IG51bGwgJiYgYW5jaG9yWSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlV2l0aEFuY2hvcih3aWR0aE9yU3JjLCBoZWlnaHQsIHNjYWxlWCwgc2NhbGVZLCBhbmdsZSwgMCwgMCwgYW5jaG9yWCwgYW5jaG9yWSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZSh3aWR0aE9yU3JjLCBoZWlnaHQsIHNjYWxlWCwgc2NhbGVZLCBhbmdsZSwgMCwgMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbW9kaWZpZWQgPSB3aWR0aE9yU3JjLl9tb2RpZmllZDtcbiAgICAgICAgICAgICAgICB0aGlzLl9tYXRyaXggPSBbXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoT3JTcmMuX21hdHJpeFswXSxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGhPclNyYy5fbWF0cml4WzFdLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aE9yU3JjLl9tYXRyaXhbMl0sXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoT3JTcmMuX21hdHJpeFszXSxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGhPclNyYy5fbWF0cml4WzRdLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aE9yU3JjLl9tYXRyaXhbNV1cbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFBsYWluTWF0cml4LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgc2NhbGVYLCBzY2FsZVksIGFuZ2xlLCB4LCB5KSB7XG4gICAgICAgICAgICAvLyDjgZPjgZPjgafmsYLjgoHjgovlpInmj5vooYzliJdN44Gv44CB5byV5pWw44Gn5oyH5a6a44GV44KM44Gf5aSJ5b2i44KS44CB5ouh5aSn44O75Zue6Lui44O75bmz6KGM56e75YuV44Gu6aCG44Gr6YGp55So44GZ44KL44KC44Gu44Gn44GC44KL44CCXG4gICAgICAgICAgICAvLyDlpInlvaLjga7ljp/ngrnjga/lvJXmlbDjgafmjIflrprjgZXjgozjgZ/nn6nlvaLjga7kuK3lv4PjgIHjgZnjgarjgo/jgaEgKHdpZHRoLzIsIGhlaWdodC8yKSDjga7kvY3nva7jgafjgYLjgovjgILlvpPjgaPjgaZcbiAgICAgICAgICAgIC8vICAgIE0gPSBBXi0xIFQgUiBTIEFcbiAgICAgICAgICAgIC8vIOOBp+OBguOCi+OAguOBn+OBoOOBl+OBk+OBk+OBp0EsIFMsIFIsIFTjga/jgIHjgZ3jgozjgZ7jgozku6XkuIvjgpLooajjgZnlpInmj5vooYzliJfjgafjgYLjgos6XG4gICAgICAgICAgICAvLyAgICBBOiDnn6nlvaLjga7kuK3lv4PjgpLljp/ngrnjgavnp7vjgZko5bmz6KGM56e75YuV44GZ44KLKeWkieaPm1xuICAgICAgICAgICAgLy8gICAgUzogWOi7uOaWueWQkeOBq3NjYWxlWOWAjeOAgVnou7jmlrnlkJHjgatzY2FsZVnlgI3jgZnjgovlpInmj5tcbiAgICAgICAgICAgIC8vICAgIFI6IGFuZ2xl5bqm44Gg44GR5Zue6Lui44GZ44KL5aSJ5o+bXG4gICAgICAgICAgICAvLyAgICBUOiB4LCB544Gu5YCk44Gg44GR5bmz6KGM56e75YuV44GZ44KL5aSJ5o+bXG4gICAgICAgICAgICAvLyDjgZ3jgozjgonjga/mrKHjga7jgojjgYbjgavooajjgZvjgos6XG4gICAgICAgICAgICAvLyAgICAgICAgICAgMSAgICAwICAgLXcgICAgICAgICAgIHN4ICAgIDAgICAgMCAgICAgICAgICAgIGMgICAtcyAgICAwICAgICAgICAgICAgMSAgICAwICAgIHhcbiAgICAgICAgICAgIC8vICAgIEEgPSBbICAwICAgIDEgICAtaF0gICAgUyA9IFsgIDAgICBzeSAgICAwXSAgICBSID0gWyAgcyAgICBjICAgIDBdICAgIFQgPSBbICAwICAgIDEgICAgeV1cbiAgICAgICAgICAgIC8vICAgICAgICAgICAwICAgIDAgICAgMSAgICAgICAgICAgIDAgICAgMCAgICAxICAgICAgICAgICAgMCAgICAwICAgIDEgICAgICAgICAgICAwICAgIDAgICAgMVxuICAgICAgICAgICAgLy8g44GT44GT44GnIHN4LCBzeSDjga8gc2NhbGVYLCBzY2FsZVkg44Gn44GC44KK44CBYywgcyDjga8gY29zKHRoZXRhKSwgc2luKHRoZXRhKVxuICAgICAgICAgICAgLy8gKOOBn+OBoOOBlyB0aGV0YSA9IGFuZ2xlICogUEkgLyAxODAp44CBdyA9ICh3aWR0aCAvIDIpLCBoID0gKGhlaWdodCAvIDIpIOOBp+OBguOCi+OAglxuICAgICAgICAgICAgLy8g5Lul5LiL44Gu5a6f6KOF44Gv44CBTSDjga7lkITopoHntKDjgpLjgZ3jgozjgZ7jgozoqIjnrpfjgZfjgabnm7TmjqXmsYLjgoHjgabjgYTjgovjgIJcbiAgICAgICAgICAgIHZhciByID0gYW5nbGUgKiBNYXRoLlBJIC8gMTgwO1xuICAgICAgICAgICAgdmFyIF9jb3MgPSBNYXRoLmNvcyhyKTtcbiAgICAgICAgICAgIHZhciBfc2luID0gTWF0aC5zaW4ocik7XG4gICAgICAgICAgICB2YXIgYSA9IF9jb3MgKiBzY2FsZVg7XG4gICAgICAgICAgICB2YXIgYiA9IF9zaW4gKiBzY2FsZVg7XG4gICAgICAgICAgICB2YXIgYyA9IF9zaW4gKiBzY2FsZVk7XG4gICAgICAgICAgICB2YXIgZCA9IF9jb3MgKiBzY2FsZVk7XG4gICAgICAgICAgICB2YXIgdyA9IHdpZHRoIC8gMjtcbiAgICAgICAgICAgIHZhciBoID0gaGVpZ2h0IC8gMjtcbiAgICAgICAgICAgIHRoaXMuX21hdHJpeFswXSA9IGE7XG4gICAgICAgICAgICB0aGlzLl9tYXRyaXhbMV0gPSBiO1xuICAgICAgICAgICAgdGhpcy5fbWF0cml4WzJdID0gLWM7XG4gICAgICAgICAgICB0aGlzLl9tYXRyaXhbM10gPSBkO1xuICAgICAgICAgICAgdGhpcy5fbWF0cml4WzRdID0gLWEgKiB3ICsgYyAqIGggKyB3ICsgeDtcbiAgICAgICAgICAgIHRoaXMuX21hdHJpeFs1XSA9IC1iICogdyAtIGQgKiBoICsgaCArIHk7XG4gICAgICAgIH07XG4gICAgICAgIFBsYWluTWF0cml4LnByb3RvdHlwZS51cGRhdGVXaXRoQW5jaG9yID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQsIHNjYWxlWCwgc2NhbGVZLCBhbmdsZSwgeCwgeSwgYW5jaG9yWCwgYW5jaG9yWSkge1xuICAgICAgICAgICAgLy8g44GT44GT44Gn5rGC44KB44KL5aSJ5o+b6KGM5YiXTeOBr+OAgeW8leaVsOOBp+aMh+WumuOBleOCjOOBn+WkieW9ouOCkuOAgeaLoeWkp+ODu+Wbnui7ouODu+W5s+ihjOenu+WLleOBrumghuOBq+mBqeeUqOOBmeOCi+OCguOBruOBp+OBguOCi+OAglxuICAgICAgICAgICAgLy8g5aSJ5b2i44Gu5Y6f54K544Gv5byV5pWw44Gn5oyH5a6a44GV44KM44Gf5L2N572u44Gu5Y6f5a+45aSn44CB44GZ44Gq44KP44GhIChhbmNob3JYICogd2lkdGgsIGFuY2hvclkgKiBoZWlnaHQpIOOBruS9jee9ruOBp+OBguOCi+OAguW+k+OBo+OBplxuICAgICAgICAgICAgLy8gICAgTSA9IEFeLTEgVCBSIFMgQVxuICAgICAgICAgICAgLy8g44Gn44GC44KL44CC44Gf44Gg44GX44GT44GT44GnQSwgUywgUiwgVOOBr+OAgeOBneOCjOOBnuOCjOS7peS4i+OCkuihqOOBmeWkieaPm+ihjOWIl+OBp+OBguOCizpcbiAgICAgICAgICAgIC8vICAgIEE6IOOCouODs+OCq+ODvOOCkuWOn+eCueOBq+enu+OBmSjlubPooYznp7vli5XjgZnjgosp5aSJ5o+bXG4gICAgICAgICAgICAvLyAgICBTOiBY6Lu45pa55ZCR44Grc2NhbGVY5YCN44CBWei7uOaWueWQkeOBq3NjYWxlWeWAjeOBmeOCi+WkieaPm1xuICAgICAgICAgICAgLy8gICAgUjogYW5nbGXluqbjgaDjgZHlm57ou6LjgZnjgovlpInmj5tcbiAgICAgICAgICAgIC8vICAgIFQ6IHgsIHnjga7lgKTjgaDjgZHlubPooYznp7vli5XjgZnjgovlpInmj5tcbiAgICAgICAgICAgIC8vIOOBneOCjOOCieOBr+asoeOBruOCiOOBhuOBq+ihqOOBm+OCizpcbiAgICAgICAgICAgIC8vICAgICAgICAgICAxICAgIDAgICAtdyAgICAgICAgICAgc3ggICAgMCAgICAwICAgICAgICAgICAgYyAgIC1zICAgIDAgICAgICAgICAgICAxICAgIDAgICAgeC13XG4gICAgICAgICAgICAvLyAgICBBID0gWyAgMCAgICAxICAgLWhdICAgIFMgPSBbICAwICAgc3kgICAgMF0gICAgUiA9IFsgIHMgICAgYyAgICAwXSAgICBUID0gWyAgMCAgICAxICAgIHktaF1cbiAgICAgICAgICAgIC8vICAgICAgICAgICAwICAgIDAgICAgMSAgICAgICAgICAgIDAgICAgMCAgICAxICAgICAgICAgICAgMCAgICAwICAgIDEgICAgICAgICAgICAwICAgIDAgICAgMVxuICAgICAgICAgICAgLy8g44GT44GT44GnIHN4LCBzeSDjga8gc2NhbGVYLCBzY2FsZVkg44Gn44GC44KK44CBYywgcyDjga8gY29zKHRoZXRhKSwgc2luKHRoZXRhKVxuICAgICAgICAgICAgLy8gKOOBn+OBoOOBlyB0aGV0YSA9IGFuZ2xlICogUEkgLyAxODAp44CBdyA9IGFuY2hvclggKiB3aWR0aCwgaCA9IGFuY2hvclkgKiBoZWlnaHQg44Gn44GC44KL44CCXG4gICAgICAgICAgICAvLyDku6XkuIvjga7lrp/oo4Xjga/jgIFNIOOBruWQhOimgee0oOOCkuOBneOCjOOBnuOCjOioiOeul+OBl+OBpuebtOaOpeaxguOCgeOBpuOBhOOCi+OAglxuICAgICAgICAgICAgdmFyIHIgPSBhbmdsZSAqIE1hdGguUEkgLyAxODA7XG4gICAgICAgICAgICB2YXIgX2NvcyA9IE1hdGguY29zKHIpO1xuICAgICAgICAgICAgdmFyIF9zaW4gPSBNYXRoLnNpbihyKTtcbiAgICAgICAgICAgIHZhciBhID0gX2NvcyAqIHNjYWxlWDtcbiAgICAgICAgICAgIHZhciBiID0gX3NpbiAqIHNjYWxlWDtcbiAgICAgICAgICAgIHZhciBjID0gX3NpbiAqIHNjYWxlWTtcbiAgICAgICAgICAgIHZhciBkID0gX2NvcyAqIHNjYWxlWTtcbiAgICAgICAgICAgIHZhciB3ID0gYW5jaG9yWCAqIHdpZHRoO1xuICAgICAgICAgICAgdmFyIGggPSBhbmNob3JZICogaGVpZ2h0O1xuICAgICAgICAgICAgdGhpcy5fbWF0cml4WzBdID0gYTtcbiAgICAgICAgICAgIHRoaXMuX21hdHJpeFsxXSA9IGI7XG4gICAgICAgICAgICB0aGlzLl9tYXRyaXhbMl0gPSAtYztcbiAgICAgICAgICAgIHRoaXMuX21hdHJpeFszXSA9IGQ7XG4gICAgICAgICAgICB0aGlzLl9tYXRyaXhbNF0gPSAtYSAqIHcgKyBjICogaCArIHg7XG4gICAgICAgICAgICB0aGlzLl9tYXRyaXhbNV0gPSAtYiAqIHcgLSBkICogaCArIHk7XG4gICAgICAgIH07XG4gICAgICAgIFBsYWluTWF0cml4LnByb3RvdHlwZS51cGRhdGVCeUludmVyc2UgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgc2NhbGVYLCBzY2FsZVksIGFuZ2xlLCB4LCB5KSB7XG4gICAgICAgICAgICAvLyDjgZPjgZPjgafmsYLjgoHjgovlpInmj5vooYzliJfjga/jgIF1cGRhdGUoKSDjga7msYLjgoHjgovooYzliJdN44Gu6YCG6KGM5YiX44CBTV4tMeOBp+OBguOCi+OAgnVwZGF0ZSgpIOOBruOCs+ODoeODs+ODiOOBq+iomOi/sOOBruOBqOOBiuOCiuOAgVxuICAgICAgICAgICAgLy8gICAgTSA9IEFeLTEgVCBSIFMgQVxuICAgICAgICAgICAgLy8g44Gn44GC44KL44GL44KJ44CBXG4gICAgICAgICAgICAvLyAgICBNXi0xID0gQV4tMSBTXi0xIFJeLTEgVF4tMSBBXG4gICAgICAgICAgICAvLyDjgZ3jgozjgZ7jgozjga/mrKHjga7jgojjgYbjgavooajjgZvjgos6XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgMSAgICAwICAgIHcgICAgICAgICAgICAgMS9zeCAgICAgMCAgICAwICAgICAgICAgICAgICAgYyAgICBzICAgIDAgICAgICAgICAgICAgICAxICAgIDAgICAteFxuICAgICAgICAgICAgLy8gICAgQV4tMSA9IFsgIDAgICAgMSAgICBoXSAgICBTXi0xID0gWyAgIDAgIDEvc3kgICAgMF0gICAgUl4tMSA9IFsgLXMgICAgYyAgICAwXSAgICBUXi0xID0gWyAgMCAgICAxICAgLXldXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgMCAgICAwICAgIDEgICAgICAgICAgICAgICAgMCAgICAgMCAgICAxICAgICAgICAgICAgICAgMCAgICAwICAgIDEgICAgICAgICAgICAgICAwICAgIDAgICAgMVxuICAgICAgICAgICAgLy8g44GT44GT44Gn5ZCE5aSJ5pWw44GvIHVwZGF0ZSgpIOOBruOCs+ODoeODs+ODiOOBruOCguOBruOBqOWQjOanmOOBp+OBguOCi+OAglxuICAgICAgICAgICAgLy8g5Lul5LiL44Gu5a6f6KOF44Gv44CBTV4tMSDjga7lkITopoHntKDjgpLjgZ3jgozjgZ7jgozoqIjnrpfjgZfjgabnm7TmjqXmsYLjgoHjgabjgYTjgovjgIJcbiAgICAgICAgICAgIHZhciByID0gYW5nbGUgKiBNYXRoLlBJIC8gMTgwO1xuICAgICAgICAgICAgdmFyIF9jb3MgPSBNYXRoLmNvcyhyKTtcbiAgICAgICAgICAgIHZhciBfc2luID0gTWF0aC5zaW4ocik7XG4gICAgICAgICAgICB2YXIgYSA9IF9jb3MgLyBzY2FsZVg7XG4gICAgICAgICAgICB2YXIgYiA9IF9zaW4gLyBzY2FsZVk7XG4gICAgICAgICAgICB2YXIgYyA9IF9zaW4gLyBzY2FsZVg7XG4gICAgICAgICAgICB2YXIgZCA9IF9jb3MgLyBzY2FsZVk7XG4gICAgICAgICAgICB2YXIgdyA9IHdpZHRoIC8gMjtcbiAgICAgICAgICAgIHZhciBoID0gaGVpZ2h0IC8gMjtcbiAgICAgICAgICAgIHRoaXMuX21hdHJpeFswXSA9IGE7XG4gICAgICAgICAgICB0aGlzLl9tYXRyaXhbMV0gPSAtYjtcbiAgICAgICAgICAgIHRoaXMuX21hdHJpeFsyXSA9IGM7XG4gICAgICAgICAgICB0aGlzLl9tYXRyaXhbM10gPSBkO1xuICAgICAgICAgICAgdGhpcy5fbWF0cml4WzRdID0gLWEgKiAodyArIHgpIC0gYyAqIChoICsgeSkgKyB3O1xuICAgICAgICAgICAgdGhpcy5fbWF0cml4WzVdID0gYiAqICh3ICsgeCkgLSBkICogKGggKyB5KSArIGg7XG4gICAgICAgIH07XG4gICAgICAgIFBsYWluTWF0cml4LnByb3RvdHlwZS51cGRhdGVCeUludmVyc2VXaXRoQW5jaG9yID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQsIHNjYWxlWCwgc2NhbGVZLCBhbmdsZSwgeCwgeSwgYW5jaG9yWCwgYW5jaG9yWSkge1xuICAgICAgICAgICAgLy8g44GT44GT44Gn5rGC44KB44KL5aSJ5o+b6KGM5YiX44Gv44CBdXBkYXRlV2l0aEFuY2hvcigpIOOBruaxguOCgeOCi+ihjOWIl03jga7pgIbooYzliJfjgIFNXi0x44Gn44GC44KL44CCdXBkYXRlV2l0aEFuY2hvcigpIOOBruOCs+ODoeODs+ODiOOBq+iomOi/sOOBruOBqOOBiuOCiuOAgVxuICAgICAgICAgICAgLy8gICAgTSA9IEFeLTEgVCBSIFMgQVxuICAgICAgICAgICAgLy8g44Gn44GC44KL44GL44KJ44CBXG4gICAgICAgICAgICAvLyAgICBNXi0xID0gQV4tMSBTXi0xIFJeLTEgVF4tMSBBXG4gICAgICAgICAgICAvLyDjgZ3jgozjgZ7jgozjga/mrKHjga7jgojjgYbjgavooajjgZvjgos6XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgMSAgICAwICAgIHcgICAgICAgICAgICAgMS9zeCAgICAgMCAgICAwICAgICAgICAgICAgICAgYyAgICBzICAgIDAgICAgICAgICAgICAgICAxICAgIDAgICAteCt3XG4gICAgICAgICAgICAvLyAgICBBXi0xID0gWyAgMCAgICAxICAgIGhdICAgIFNeLTEgPSBbICAgMCAgMS9zeSAgICAwXSAgICBSXi0xID0gWyAtcyAgICBjICAgIDBdICAgIFReLTEgPSBbICAwICAgIDEgICAteStoXVxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgIDAgICAgMCAgICAxICAgICAgICAgICAgICAgIDAgICAgIDAgICAgMSAgICAgICAgICAgICAgIDAgICAgMCAgICAxICAgICAgICAgICAgICAgMCAgICAwICAgIDFcbiAgICAgICAgICAgIC8vIOOBk+OBk+OBp+WQhOWkieaVsOOBryB1cGRhdGVXaXRoQW5jaG9yKCkg44Gu44Kz44Oh44Oz44OI44Gu44KC44Gu44Go5ZCM5qeY44Gn44GC44KL44CCXG4gICAgICAgICAgICAvLyDku6XkuIvjga7lrp/oo4Xjga/jgIFNXi0xIOOBruWQhOimgee0oOOCkuOBneOCjOOBnuOCjOioiOeul+OBl+OBpuebtOaOpeaxguOCgeOBpuOBhOOCi+OAglxuICAgICAgICAgICAgdmFyIHIgPSBhbmdsZSAqIE1hdGguUEkgLyAxODA7XG4gICAgICAgICAgICB2YXIgX2NvcyA9IE1hdGguY29zKHIpO1xuICAgICAgICAgICAgdmFyIF9zaW4gPSBNYXRoLnNpbihyKTtcbiAgICAgICAgICAgIHZhciBhID0gX2NvcyAvIHNjYWxlWDtcbiAgICAgICAgICAgIHZhciBiID0gX3NpbiAvIHNjYWxlWTtcbiAgICAgICAgICAgIHZhciBjID0gX3NpbiAvIHNjYWxlWDtcbiAgICAgICAgICAgIHZhciBkID0gX2NvcyAvIHNjYWxlWTtcbiAgICAgICAgICAgIHZhciB3ID0gYW5jaG9yWCAqIHdpZHRoO1xuICAgICAgICAgICAgdmFyIGggPSBhbmNob3JZICogaGVpZ2h0O1xuICAgICAgICAgICAgdGhpcy5fbWF0cml4WzBdID0gYTtcbiAgICAgICAgICAgIHRoaXMuX21hdHJpeFsxXSA9IC1iO1xuICAgICAgICAgICAgdGhpcy5fbWF0cml4WzJdID0gYztcbiAgICAgICAgICAgIHRoaXMuX21hdHJpeFszXSA9IGQ7XG4gICAgICAgICAgICB0aGlzLl9tYXRyaXhbNF0gPSAtYSAqIHggLSBjICogeSArIHc7XG4gICAgICAgICAgICB0aGlzLl9tYXRyaXhbNV0gPSBiICogeCAtIGQgKiB5ICsgaDtcbiAgICAgICAgfTtcbiAgICAgICAgUGxhaW5NYXRyaXgucHJvdG90eXBlLm11bHRpcGx5ID0gZnVuY3Rpb24gKG1hdHJpeCkge1xuICAgICAgICAgICAgdmFyIG0xID0gdGhpcy5fbWF0cml4O1xuICAgICAgICAgICAgdmFyIG0yID0gbWF0cml4Ll9tYXRyaXg7XG4gICAgICAgICAgICB2YXIgbTEwID0gbTFbMF07XG4gICAgICAgICAgICB2YXIgbTExID0gbTFbMV07XG4gICAgICAgICAgICB2YXIgbTEyID0gbTFbMl07XG4gICAgICAgICAgICB2YXIgbTEzID0gbTFbM107XG4gICAgICAgICAgICBtMVswXSA9IG0xMCAqIG0yWzBdICsgbTEyICogbTJbMV07XG4gICAgICAgICAgICBtMVsxXSA9IG0xMSAqIG0yWzBdICsgbTEzICogbTJbMV07XG4gICAgICAgICAgICBtMVsyXSA9IG0xMCAqIG0yWzJdICsgbTEyICogbTJbM107XG4gICAgICAgICAgICBtMVszXSA9IG0xMSAqIG0yWzJdICsgbTEzICogbTJbM107XG4gICAgICAgICAgICBtMVs0XSA9IG0xMCAqIG0yWzRdICsgbTEyICogbTJbNV0gKyBtMVs0XTtcbiAgICAgICAgICAgIG0xWzVdID0gbTExICogbTJbNF0gKyBtMTMgKiBtMls1XSArIG0xWzVdO1xuICAgICAgICB9O1xuICAgICAgICBQbGFpbk1hdHJpeC5wcm90b3R5cGUubXVsdGlwbHlOZXcgPSBmdW5jdGlvbiAobWF0cml4KSB7XG4gICAgICAgICAgICB2YXIgcmV0ID0gdGhpcy5jbG9uZSgpO1xuICAgICAgICAgICAgcmV0Lm11bHRpcGx5KG1hdHJpeCk7XG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICB9O1xuICAgICAgICBQbGFpbk1hdHJpeC5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICAgICAgdGhpcy5fbWF0cml4WzBdID0gMTtcbiAgICAgICAgICAgIHRoaXMuX21hdHJpeFsxXSA9IDA7XG4gICAgICAgICAgICB0aGlzLl9tYXRyaXhbMl0gPSAwO1xuICAgICAgICAgICAgdGhpcy5fbWF0cml4WzNdID0gMTtcbiAgICAgICAgICAgIHRoaXMuX21hdHJpeFs0XSA9IHggfHwgMDtcbiAgICAgICAgICAgIHRoaXMuX21hdHJpeFs1XSA9IHkgfHwgMDtcbiAgICAgICAgfTtcbiAgICAgICAgUGxhaW5NYXRyaXgucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQbGFpbk1hdHJpeCh0aGlzKTtcbiAgICAgICAgfTtcbiAgICAgICAgUGxhaW5NYXRyaXgucHJvdG90eXBlLm11bHRpcGx5SW52ZXJzZUZvclBvaW50ID0gZnVuY3Rpb24gKHBvaW50KSB7XG4gICAgICAgICAgICB2YXIgbSA9IHRoaXMuX21hdHJpeDtcbiAgICAgICAgICAgIC8vIGlkID0gaW52ZXJzZSBvZiB0aGUgZGV0ZXJtaW5hbnRcbiAgICAgICAgICAgIHZhciBfaWQgPSAxIC8gKG1bMF0gKiBtWzNdICsgbVsyXSAqIC1tWzFdKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgeDogbVszXSAqIF9pZCAqIHBvaW50LnggKyAtbVsyXSAqIF9pZCAqIHBvaW50LnkgKyAobVs1XSAqIG1bMl0gLSBtWzRdICogbVszXSkgKiBfaWQsXG4gICAgICAgICAgICAgICAgeTogbVswXSAqIF9pZCAqIHBvaW50LnkgKyAtbVsxXSAqIF9pZCAqIHBvaW50LnggKyAoLW1bNV0gKiBtWzBdICsgbVs0XSAqIG1bMV0pICogX2lkXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICBQbGFpbk1hdHJpeC5wcm90b3R5cGUuc2NhbGUgPSBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICAgICAgdmFyIG0gPSB0aGlzLl9tYXRyaXg7XG4gICAgICAgICAgICBtWzBdICo9IHg7XG4gICAgICAgICAgICBtWzFdICo9IHk7XG4gICAgICAgICAgICBtWzJdICo9IHg7XG4gICAgICAgICAgICBtWzNdICo9IHk7XG4gICAgICAgICAgICBtWzRdICo9IHg7XG4gICAgICAgICAgICBtWzVdICo9IHk7XG4gICAgICAgIH07XG4gICAgICAgIFBsYWluTWF0cml4LnByb3RvdHlwZS5tdWx0aXBseVBvaW50ID0gZnVuY3Rpb24gKHBvaW50KSB7XG4gICAgICAgICAgICB2YXIgbSA9IHRoaXMuX21hdHJpeDtcbiAgICAgICAgICAgIHZhciB4ID0gbVswXSAqIHBvaW50LnggKyBtWzJdICogcG9pbnQueSArIG1bNF07XG4gICAgICAgICAgICB2YXIgeSA9IG1bMV0gKiBwb2ludC54ICsgbVszXSAqIHBvaW50LnkgKyBtWzVdO1xuICAgICAgICAgICAgcmV0dXJuIHsgeDogeCwgeTogeSB9O1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gUGxhaW5NYXRyaXg7XG4gICAgfSgpKTtcbiAgICBnLlBsYWluTWF0cml4ID0gUGxhaW5NYXRyaXg7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog44Om44O844OG44Kj44Oq44OG44Kj44CCXG4gICAgICovXG4gICAgdmFyIFV0aWw7XG4gICAgKGZ1bmN0aW9uIChVdGlsKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiAy54K56ZaTKFAxLi5QMinjga7ot53pm6IocGl4ZWwp44KS6L+U44GZ44CCXG4gICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBwMXggUDEtWFxuICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gcDF5IFAxLVlcbiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHAyeCBQMi1YXG4gICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBwMnkgUDItWVxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gZGlzdGFuY2UocDF4LCBwMXksIHAyeCwgcDJ5KSB7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KE1hdGgucG93KHAxeCAtIHAyeCwgMikgKyBNYXRoLnBvdyhwMXkgLSBwMnksIDIpKTtcbiAgICAgICAgfVxuICAgICAgICBVdGlsLmRpc3RhbmNlID0gZGlzdGFuY2U7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiAy54K56ZaTKFAxLi5QMinjga7ot53pm6IocGl4ZWwp44KS6L+U44GZ44CCXG4gICAgICAgICAqIEBwYXJhbSB7Q29tbW9uT2Zmc2V0fSBwMSDluqfmqJkxXG4gICAgICAgICAqIEBwYXJhbSB7Q29tbW9uT2Zmc2V0fSBwMiDluqfmqJkyXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBkaXN0YW5jZUJldHdlZW5PZmZzZXRzKHAxLCBwMikge1xuICAgICAgICAgICAgcmV0dXJuIFV0aWwuZGlzdGFuY2UocDEueCwgcDEueSwgcDIueCwgcDIueSk7XG4gICAgICAgIH1cbiAgICAgICAgVXRpbC5kaXN0YW5jZUJldHdlZW5PZmZzZXRzID0gZGlzdGFuY2VCZXR3ZWVuT2Zmc2V0cztcbiAgICAgICAgLyoqXG4gICAgICAgICAqIDLjgaTjga7nn6nlvaLjga7kuK3lv4PluqfmqJkoUDEuLlAyKemWk+OBrui3nemboihwaXhlbCnjgpLov5TjgZnjgIJcbiAgICAgICAgICogQHBhcmFtIHtDb21tb25BcmVhfSBwMSDnn6nlvaIxXG4gICAgICAgICAqIEBwYXJhbSB7Q29tbW9uQXJlYX0gcDIg55+p5b2iMlxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gZGlzdGFuY2VCZXR3ZWVuQXJlYXMocDEsIHAyKSB7XG4gICAgICAgICAgICByZXR1cm4gVXRpbC5kaXN0YW5jZShwMS54ICsgcDEud2lkdGggLyAyLCBwMS55ICsgcDEuaGVpZ2h0IC8gMiwgcDIueCArIHAyLndpZHRoIC8gMiwgcDIueSArIHAyLmhlaWdodCAvIDIpO1xuICAgICAgICB9XG4gICAgICAgIFV0aWwuZGlzdGFuY2VCZXR3ZWVuQXJlYXMgPSBkaXN0YW5jZUJldHdlZW5BcmVhcztcbiAgICAgICAgLy8gTm90ZTog44Kq44O844OQ44O844Ot44O844OJ44GV44KM44Gm44GE44KL44Gu44GnanNkb2PnnIHnlaVcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlTWF0cml4KHdpZHRoLCBoZWlnaHQsIHNjYWxlWCwgc2NhbGVZLCBhbmdsZSwgYW5jaG9yWCwgYW5jaG9yWSkge1xuICAgICAgICAgICAgLy8gTm90ZTogYXNtLmpz5a++5b+c55Kw5aKD44Gn44GvYXNtLmpz5a++5b+c44GuTWF0cml444KS55Sf5oiQ44GZ44KL44Gq44Gp44GX44Gf44GE44Gf44KB44CB44Kq44O844OQ44O844OY44OD44OJ44KS6Kix5a6544GZ44KLXG4gICAgICAgICAgICBpZiAod2lkdGggPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGcuUGxhaW5NYXRyaXgoKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgZy5QbGFpbk1hdHJpeCh3aWR0aCwgaGVpZ2h0LCBzY2FsZVgsIHNjYWxlWSwgYW5nbGUsIGFuY2hvclgsIGFuY2hvclkpO1xuICAgICAgICB9XG4gICAgICAgIFV0aWwuY3JlYXRlTWF0cml4ID0gY3JlYXRlTWF0cml4O1xuICAgICAgICAvKipcbiAgICAgICAgICogZSDjga7mj4/nlLvlhoXlrrnjgpLmjIHjgaQgU3ByaXRlIOOCkueUn+aIkOOBmeOCi+OAglxuICAgICAgICAgKiBAcGFyYW0gc2NlbmUg5L2c5oiQ44GX44GfU3ByaXRl44KS55m76Yyy44GZ44KLU2NlbmVcbiAgICAgICAgICogQHBhcmFtIGUgU3ByaXRl5YyW44GX44Gf44GERVxuICAgICAgICAgKiBAcGFyYW0gY2FtZXJhIOS9v+eUqOOCq+ODoeODqVxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlU3ByaXRlRnJvbUUoc2NlbmUsIGUsIGNhbWVyYSkge1xuICAgICAgICAgICAgdmFyIG9sZFggPSBlLng7XG4gICAgICAgICAgICB2YXIgb2xkWSA9IGUueTtcbiAgICAgICAgICAgIHZhciB4ID0gMDtcbiAgICAgICAgICAgIHZhciB5ID0gMDtcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IGUud2lkdGg7XG4gICAgICAgICAgICB2YXIgaGVpZ2h0ID0gZS5oZWlnaHQ7XG4gICAgICAgICAgICB2YXIgYm91bmRpbmdSZWN0ID0gZS5jYWxjdWxhdGVCb3VuZGluZ1JlY3QoY2FtZXJhKTtcbiAgICAgICAgICAgIGlmICghYm91bmRpbmdSZWN0KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiVXRpbCNjcmVhdGVTcHJpdGVGcm9tRTogY2FtZXJhIG11c3QgbG9vayBlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2lkdGggPSBib3VuZGluZ1JlY3QucmlnaHQgLSBib3VuZGluZ1JlY3QubGVmdDtcbiAgICAgICAgICAgIGhlaWdodCA9IGJvdW5kaW5nUmVjdC5ib3R0b20gLSBib3VuZGluZ1JlY3QudG9wO1xuICAgICAgICAgICAgaWYgKGJvdW5kaW5nUmVjdC5sZWZ0IDwgZS54KVxuICAgICAgICAgICAgICAgIHggPSBlLnggLSBib3VuZGluZ1JlY3QubGVmdDtcbiAgICAgICAgICAgIGlmIChib3VuZGluZ1JlY3QudG9wIDwgZS55KVxuICAgICAgICAgICAgICAgIHkgPSBlLnkgLSBib3VuZGluZ1JlY3QudG9wO1xuICAgICAgICAgICAgZS5tb3ZlVG8oeCwgeSk7XG4gICAgICAgICAgICAvLyDlho3mj4/nlLvjg5Xjg6njgrDjgpLnq4vjgabjgZ/jgY/jgarjgYTjgZ/jgoHjgasgZS5fbWF0cml4IOOCkuebtOaOpeinpuOBo+OBpuOBhOOCi1xuICAgICAgICAgICAgaWYgKGUuX21hdHJpeClcbiAgICAgICAgICAgICAgICBlLl9tYXRyaXguX21vZGlmaWVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBzdXJmYWNlID0gc2NlbmUuZ2FtZS5yZXNvdXJjZUZhY3RvcnkuY3JlYXRlU3VyZmFjZShNYXRoLmNlaWwod2lkdGgpLCBNYXRoLmNlaWwoaGVpZ2h0KSk7XG4gICAgICAgICAgICB2YXIgcmVuZGVyZXIgPSBzdXJmYWNlLnJlbmRlcmVyKCk7XG4gICAgICAgICAgICByZW5kZXJlci5iZWdpbigpO1xuICAgICAgICAgICAgZS5yZW5kZXIocmVuZGVyZXIsIGNhbWVyYSk7XG4gICAgICAgICAgICByZW5kZXJlci5lbmQoKTtcbiAgICAgICAgICAgIHZhciBzID0gbmV3IGcuU3ByaXRlKHtcbiAgICAgICAgICAgICAgICBzY2VuZTogc2NlbmUsXG4gICAgICAgICAgICAgICAgc3JjOiBzdXJmYWNlLFxuICAgICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGhlaWdodFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzLm1vdmVUbyhib3VuZGluZ1JlY3QubGVmdCwgYm91bmRpbmdSZWN0LnRvcCk7XG4gICAgICAgICAgICBlLm1vdmVUbyhvbGRYLCBvbGRZKTtcbiAgICAgICAgICAgIGlmIChlLl9tYXRyaXgpXG4gICAgICAgICAgICAgICAgZS5fbWF0cml4Ll9tb2RpZmllZCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gcztcbiAgICAgICAgfVxuICAgICAgICBVdGlsLmNyZWF0ZVNwcml0ZUZyb21FID0gY3JlYXRlU3ByaXRlRnJvbUU7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBzY2VuZSDjga7mj4/nlLvlhoXlrrnjgpLmjIHjgaQgU3ByaXRlIOOCkueUn+aIkOOBmeOCi+OAglxuICAgICAgICAgKiBAcGFyYW0gdG9TY2VuZSDkvZzjgaPjgZ9TcHJpdGXjgpLnmbvpjLLjgZnjgotTY2VuZVxuICAgICAgICAgKiBAcGFyYW0gZnJvbVNjZW5lIFNwcml0ZeWMluOBl+OBn+OBhFNjZW5lXG4gICAgICAgICAqIEBwYXJhbSBjYW1lcmEg5L2/55So44Kr44Oh44OpXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBjcmVhdGVTcHJpdGVGcm9tU2NlbmUodG9TY2VuZSwgZnJvbVNjZW5lLCBjYW1lcmEpIHtcbiAgICAgICAgICAgIHZhciBzdXJmYWNlID0gdG9TY2VuZS5nYW1lLnJlc291cmNlRmFjdG9yeS5jcmVhdGVTdXJmYWNlKE1hdGguY2VpbChmcm9tU2NlbmUuZ2FtZS53aWR0aCksIE1hdGguY2VpbChmcm9tU2NlbmUuZ2FtZS5oZWlnaHQpKTtcbiAgICAgICAgICAgIHZhciByZW5kZXJlciA9IHN1cmZhY2UucmVuZGVyZXIoKTtcbiAgICAgICAgICAgIHJlbmRlcmVyLmJlZ2luKCk7XG4gICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBmcm9tU2NlbmUuY2hpbGRyZW47XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgKytpKVxuICAgICAgICAgICAgICAgIGNoaWxkcmVuW2ldLnJlbmRlcihyZW5kZXJlciwgY2FtZXJhKTtcbiAgICAgICAgICAgIHJlbmRlcmVyLmVuZCgpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBnLlNwcml0ZSh7XG4gICAgICAgICAgICAgICAgc2NlbmU6IHRvU2NlbmUsXG4gICAgICAgICAgICAgICAgc3JjOiBzdXJmYWNlLFxuICAgICAgICAgICAgICAgIHdpZHRoOiBmcm9tU2NlbmUuZ2FtZS53aWR0aCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGZyb21TY2VuZS5nYW1lLmhlaWdodFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgVXRpbC5jcmVhdGVTcHJpdGVGcm9tU2NlbmUgPSBjcmVhdGVTcHJpdGVGcm9tU2NlbmU7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlvJXmlbAgYHNyY2Ag44GMIGB1bmRlZmluZWRgIOOBvuOBn+OBryBgU3VyZmFjZWAg44Gn44Gd44Gu44G+44G+6L+U44GZ44CCXG4gICAgICAgICAqIOOBneOBhuOBp+OBquOBj+OBi+OBpCBgSW1hZ2VBc3NldGAg44Gn44GC44KM44GwIGBTdXJmYWNlYCDjgavlpInmj5vjgZfjgabov5TjgZnjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHNyY1xuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gYXNTdXJmYWNlKHNyYykge1xuICAgICAgICAgICAgLy8gTm90ZTogVHlwZVNjcmlwdOOBrnR5cGUgZ3VhcmTjgpLmtLvnlKjjgZnjgovjgZ/jgoHjgIHjgYLjgYjjgaYx44Gk44GuaWbjgacx44Gk44Gu5Z6L44GX44GL5Yik5a6a44GX44Gm44GE44Gq44GEXG4gICAgICAgICAgICBpZiAoIXNyYylcbiAgICAgICAgICAgICAgICByZXR1cm4gc3JjO1xuICAgICAgICAgICAgaWYgKHNyYyBpbnN0YW5jZW9mIGcuU3VyZmFjZSlcbiAgICAgICAgICAgICAgICByZXR1cm4gc3JjO1xuICAgICAgICAgICAgaWYgKHNyYyBpbnN0YW5jZW9mIGcuSW1hZ2VBc3NldClcbiAgICAgICAgICAgICAgICByZXR1cm4gc3JjLmFzU3VyZmFjZSgpO1xuICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZVR5cGVNaXNtYXRjaEVycm9yKFwiVXRpbCNhc1N1cmZhY2VcIiwgXCJJbWFnZUFzc2V0fFN1cmZhY2VcIiwgc3JjKTtcbiAgICAgICAgfVxuICAgICAgICBVdGlsLmFzU3VyZmFjZSA9IGFzU3VyZmFjZTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOS4juOBiOOCieOCjOOBn+ODkeOCueaWh+Wtl+WIl+OBjOODleOCoeOCpOODq+ODkeOCueOBp+OBguOCi+OBqOS7ruWumuOBl+OBpuOAgeWvvuW/nOOBmeOCi+OCouOCu+ODg+ODiOOCkuaOouOBmeOAglxuICAgICAgICAgKiDopovjgaTjgYvjgaPjgZ/loLTlkIjjgZ3jga7jgqLjgrvjg4Pjg4jjgpLjgIHjgZ3jgYbjgafjgarjgYTloLTlkIggYHVuZGVmaW5lZGAg44KS6L+U44GZ44CCXG4gICAgICAgICAqIOmAmuW4uOOAgeOCsuODvOODoOmWi+eZuuiAheOBjOODleOCoeOCpOODq+ODkeOCueOCkuaJseOBhuOBk+OBqOOBr+OBquOBj+OAgeOBk+OBruODoeOCveODg+ODieOCkuWRvOOBs+WHuuOBmeW/heimgeOBr+OBquOBhOOAglxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gcmVzb2x2ZWRQYXRoIOODkeOCueaWh+Wtl+WIl1xuICAgICAgICAgKiBAcGFyYW0gbGl2ZUFzc2V0UGF0aFRhYmxlIOODkeOCueaWh+Wtl+WIl+OBruODl+ODreODkeODhuOCo+OBq+WvvuW/nOOBmeOCi+OCouOCu+ODg+ODiOOCkuagvOe0jeOBl+OBn+OCquODluOCuOOCp+OCr+ODiFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gZmluZEFzc2V0QnlQYXRoQXNGaWxlKHJlc29sdmVkUGF0aCwgbGl2ZUFzc2V0UGF0aFRhYmxlKSB7XG4gICAgICAgICAgICBpZiAobGl2ZUFzc2V0UGF0aFRhYmxlLmhhc093blByb3BlcnR5KHJlc29sdmVkUGF0aCkpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxpdmVBc3NldFBhdGhUYWJsZVtyZXNvbHZlZFBhdGhdO1xuICAgICAgICAgICAgaWYgKGxpdmVBc3NldFBhdGhUYWJsZS5oYXNPd25Qcm9wZXJ0eShyZXNvbHZlZFBhdGggKyBcIi5qc1wiKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gbGl2ZUFzc2V0UGF0aFRhYmxlW3Jlc29sdmVkUGF0aCArIFwiLmpzXCJdO1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBVdGlsLmZpbmRBc3NldEJ5UGF0aEFzRmlsZSA9IGZpbmRBc3NldEJ5UGF0aEFzRmlsZTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOS4juOBiOOCieOCjOOBn+ODkeOCueaWh+Wtl+WIl+OBjOODh+OCo+ODrOOCr+ODiOODquODkeOCueOBp+OBguOCi+OBqOS7ruWumuOBl+OBpuOAgeWvvuW/nOOBmeOCi+OCouOCu+ODg+ODiOOCkuaOouOBmeOAglxuICAgICAgICAgKiDopovjgaTjgYvjgaPjgZ/loLTlkIjjgZ3jga7jgqLjgrvjg4Pjg4jjgpLjgIHjgZ3jgYbjgafjgarjgYTloLTlkIggYHVuZGVmaW5lZGAg44KS6L+U44GZ44CCXG4gICAgICAgICAqIOmAmuW4uOOAgeOCsuODvOODoOmWi+eZuuiAheOBjOODleOCoeOCpOODq+ODkeOCueOCkuaJseOBhuOBk+OBqOOBr+OBquOBj+OAgeOBk+OBruODoeOCveODg+ODieOCkuWRvOOBs+WHuuOBmeW/heimgeOBr+OBquOBhOOAglxuICAgICAgICAgKiDjg4fjgqPjg6zjgq/jg4jjg6rlhoXjgasgcGFja2FnZS5qc29uIOOBjOWtmOWcqOOBmeOCi+WgtOWQiOOAgXBhY2thZ2UuanNvbiDoh6rkvZPjgoLjgqLjgrvjg4Pjg4jjgajjgZfjgaZcbiAgICAgICAgICogYGxpdmVBc3NldFBhdGhUYWJsZWAg44GL44KJ5Y+C54Wn5Y+v6IO944Gn44Gq44GR44KM44Gw44Gq44KJ44Gq44GE44GT44Go44Gr5rOo5oSP44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSByZXNvbHZlZFBhdGgg44OR44K55paH5a2X5YiXXG4gICAgICAgICAqIEBwYXJhbSBsaXZlQXNzZXRQYXRoVGFibGUg44OR44K55paH5a2X5YiX44Gu44OX44Ot44OR44OG44Kj44Gr5a++5b+c44GZ44KL44Ki44K744OD44OI44KS5qC857SN44GX44Gf44Kq44OW44K444Kn44Kv44OIXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBmaW5kQXNzZXRCeVBhdGhBc0RpcmVjdG9yeShyZXNvbHZlZFBhdGgsIGxpdmVBc3NldFBhdGhUYWJsZSkge1xuICAgICAgICAgICAgdmFyIHBhdGg7XG4gICAgICAgICAgICBwYXRoID0gcmVzb2x2ZWRQYXRoICsgXCIvcGFja2FnZS5qc29uXCI7XG4gICAgICAgICAgICBpZiAobGl2ZUFzc2V0UGF0aFRhYmxlLmhhc093blByb3BlcnR5KHBhdGgpICYmIGxpdmVBc3NldFBhdGhUYWJsZVtwYXRoXSBpbnN0YW5jZW9mIGcuVGV4dEFzc2V0KSB7XG4gICAgICAgICAgICAgICAgdmFyIHBrZyA9IEpTT04ucGFyc2UobGl2ZUFzc2V0UGF0aFRhYmxlW3BhdGhdLmRhdGEpO1xuICAgICAgICAgICAgICAgIGlmIChwa2cgJiYgdHlwZW9mIHBrZy5tYWluID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhc3NldCA9IFV0aWwuZmluZEFzc2V0QnlQYXRoQXNGaWxlKGcuUGF0aFV0aWwucmVzb2x2ZVBhdGgocmVzb2x2ZWRQYXRoLCBwa2cubWFpbiksIGxpdmVBc3NldFBhdGhUYWJsZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NldClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhc3NldDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXRoID0gcmVzb2x2ZWRQYXRoICsgXCIvaW5kZXguanNcIjtcbiAgICAgICAgICAgIGlmIChsaXZlQXNzZXRQYXRoVGFibGUuaGFzT3duUHJvcGVydHkocGF0aCkpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxpdmVBc3NldFBhdGhUYWJsZVtwYXRoXTtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgVXRpbC5maW5kQXNzZXRCeVBhdGhBc0RpcmVjdG9yeSA9IGZpbmRBc3NldEJ5UGF0aEFzRGlyZWN0b3J5O1xuICAgICAgICAvKipcbiAgICAgICAgICogaWR45paH5a2X55uu44Gu5paH5a2X44GuY2hhciBjb2Rl44KS6L+U44GZ44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOOBk+OCjOOBr1N0cmluZyNjaGFyQ29kZUF0KCnjgajmrKHjga7ngrnjgafnlbDjgarjgovjgIJcbiAgICAgICAgICogLSBpZHjmloflrZfnm67jgYzkuIrkvY3jgrXjg63jgrLjg7zjg4jjga7mmYLjgZPjgozjgpIxNmJpdOW3puOCt+ODleODiOOBl+OAgWlkeCsx5paH5a2X55uu44Gu5LiL5L2N44K144Ot44Ky44O844OI44Go6KuW55CG5ZKM44KS44Go44Gj44Gf5YCk44KS6L+U44GZ44CCXG4gICAgICAgICAqIC0gaWR45paH5a2X55uu44GM5LiL5L2N44K144Ot44Ky44O844OI44Gu5pmCbnVsbOOCkui/lOOBmeOAglxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gc3RyIOaWh+Wtl+OCkuWPluOCiuWHuuOBleOCjOOCi+aWh+Wtl+WIl1xuICAgICAgICAgKiBAcGFyYW0gaWR4IOWPluOCiuWHuuOBleOCjOOCi+aWh+Wtl+OBruS9jee9rlxuICAgICAgICAgKi9cbiAgICAgICAgLy8gaGlnaGx5IGJhc2VkIG9uIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL1N0cmluZy9jaGFyQ29kZUF0XG4gICAgICAgIGZ1bmN0aW9uIGNoYXJDb2RlQXQoc3RyLCBpZHgpIHtcbiAgICAgICAgICAgIHZhciBjb2RlID0gc3RyLmNoYXJDb2RlQXQoaWR4KTtcbiAgICAgICAgICAgIGlmICgweEQ4MDAgPD0gY29kZSAmJiBjb2RlIDw9IDB4REJGRikge1xuICAgICAgICAgICAgICAgIHZhciBoaSA9IGNvZGU7XG4gICAgICAgICAgICAgICAgdmFyIGxvdyA9IHN0ci5jaGFyQ29kZUF0KGlkeCArIDEpO1xuICAgICAgICAgICAgICAgIHJldHVybiAoaGkgPDwgMTYpIHwgbG93O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKDB4REMwMCA8PSBjb2RlICYmIGNvZGUgPD0gMHhERkZGKSB7IC8vIExvdyBzdXJyb2dhdGVcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjb2RlO1xuICAgICAgICB9XG4gICAgICAgIFV0aWwuY2hhckNvZGVBdCA9IGNoYXJDb2RlQXQ7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgrXjg7zjg5Xjgqfjgrnjga7jgqLjg4vjg6Hjg7zjg4bjgqPjg7PjgrDjgqTjg5njg7Pjg4jjgbjjga7jg4/jg7Pjg4njg6nnmbvpjLLjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog44GT44KM44Gv44Ky44O844Og44Ko44Oz44K444Oz44GM5Yip55So44GZ44KL44KC44Gu44Gn44GC44KK44CB44Ky44O844Og6ZaL55m66ICF44GM5ZG844Gz5Ye644GZ5b+F6KaB44Gv44Gq44GE44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBhbmltYXRpbmdIYW5kbGVyIOOCouODi+ODoeODvOODhuOCo+ODs+OCsOODj+ODs+ODieODqVxuICAgICAgICAgKiBAcGFyYW0gc3VyZmFjZSDjgrXjg7zjg5XjgqfjgrlcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIHNldHVwQW5pbWF0aW5nSGFuZGxlcihhbmltYXRpbmdIYW5kbGVyLCBzdXJmYWNlKSB7XG4gICAgICAgICAgICBpZiAoc3VyZmFjZS5pc0R5bmFtaWMpIHtcbiAgICAgICAgICAgICAgICBzdXJmYWNlLmFuaW1hdGluZ1N0YXJ0ZWQuYWRkKGFuaW1hdGluZ0hhbmRsZXIuX29uQW5pbWF0aW5nU3RhcnRlZCwgYW5pbWF0aW5nSGFuZGxlcik7XG4gICAgICAgICAgICAgICAgc3VyZmFjZS5hbmltYXRpbmdTdG9wcGVkLmFkZChhbmltYXRpbmdIYW5kbGVyLl9vbkFuaW1hdGluZ1N0b3BwZWQsIGFuaW1hdGluZ0hhbmRsZXIpO1xuICAgICAgICAgICAgICAgIGlmIChzdXJmYWNlLmlzUGxheWluZygpKSB7XG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGluZ0hhbmRsZXIuX29uQW5pbWF0aW5nU3RhcnRlZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBVdGlsLnNldHVwQW5pbWF0aW5nSGFuZGxlciA9IHNldHVwQW5pbWF0aW5nSGFuZGxlcjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOCouODi+ODoeODvOODhuOCo+ODs+OCsOODj+ODs+ODieODqeOCkuWIpeOBruOCteODvOODleOCp+OCueOBuOenu+WLleOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgZPjgozjga/jgrLjg7zjg6Djgqjjg7Pjgrjjg7PjgYzliKnnlKjjgZnjgovjgoLjga7jgafjgYLjgorjgIHjgrLjg7zjg6DplovnmbrogIXjgYzlkbzjgbPlh7rjgZnlv4XopoHjga/jgarjgYTjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIGFuaW1hdGluZ0hhbmRsZXIg44Ki44OL44Oh44O844OG44Kj44Oz44Kw44OP44Oz44OJ44OpXG4gICAgICAgICAqIEBwYXJhbSBiZWZvcmVTdXJmYWNlIOODj+ODs+ODieODqeeZu+mMsuOCkuino+mZpOOBmeOCi+OCteODvOODleOCp+OCuVxuICAgICAgICAgKiBAcGFyYW0gYWZ0ZXJTdXJmYWNlIOODj+ODs+ODieODqeOCkueZu+mMsuOBmeOCi+OCteODvOODleOCp+OCuVxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gbWlncmF0ZUFuaW1hdGluZ0hhbmRsZXIoYW5pbWF0aW5nSGFuZGxlciwgYmVmb3JlU3VyZmFjZSwgYWZ0ZXJTdXJmYWNlKSB7XG4gICAgICAgICAgICBhbmltYXRpbmdIYW5kbGVyLl9vbkFuaW1hdGluZ1N0b3BwZWQoKTtcbiAgICAgICAgICAgIGlmICghYmVmb3JlU3VyZmFjZS5kZXN0cm95ZWQoKSAmJiBiZWZvcmVTdXJmYWNlLmlzRHluYW1pYykge1xuICAgICAgICAgICAgICAgIGJlZm9yZVN1cmZhY2UuYW5pbWF0aW5nU3RhcnRlZC5yZW1vdmUoYW5pbWF0aW5nSGFuZGxlci5fb25BbmltYXRpbmdTdGFydGVkLCBhbmltYXRpbmdIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBiZWZvcmVTdXJmYWNlLmFuaW1hdGluZ1N0b3BwZWQucmVtb3ZlKGFuaW1hdGluZ0hhbmRsZXIuX29uQW5pbWF0aW5nU3RvcHBlZCwgYW5pbWF0aW5nSGFuZGxlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYWZ0ZXJTdXJmYWNlLmlzRHluYW1pYykge1xuICAgICAgICAgICAgICAgIGFmdGVyU3VyZmFjZS5hbmltYXRpbmdTdGFydGVkLmFkZChhbmltYXRpbmdIYW5kbGVyLl9vbkFuaW1hdGluZ1N0YXJ0ZWQsIGFuaW1hdGluZ0hhbmRsZXIpO1xuICAgICAgICAgICAgICAgIGFmdGVyU3VyZmFjZS5hbmltYXRpbmdTdG9wcGVkLmFkZChhbmltYXRpbmdIYW5kbGVyLl9vbkFuaW1hdGluZ1N0b3BwZWQsIGFuaW1hdGluZ0hhbmRsZXIpO1xuICAgICAgICAgICAgICAgIGlmIChhZnRlclN1cmZhY2UuaXNQbGF5aW5nKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW5nSGFuZGxlci5fb25BbmltYXRpbmdTdGFydGVkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFV0aWwubWlncmF0ZUFuaW1hdGluZ0hhbmRsZXIgPSBtaWdyYXRlQW5pbWF0aW5nSGFuZGxlcjtcbiAgICB9KShVdGlsID0gZy5VdGlsIHx8IChnLlV0aWwgPSB7fSkpO1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIC8qKlxuICAgICAqIOOCquODluOCuOOCp+OCr+ODiOOBruihneeqgeOCkuihqOOBmeOAglxuICAgICAqIC0g55+p5b2i5Lqk5beu44Gr44KI44KL6KGd56qBXG4gICAgICogLSAy54K56ZaT44Gu6Led6Zui44Gr44KI44KL6KGd56qBXG4gICAgICovXG4gICAgdmFyIENvbGxpc2lvbjtcbiAgICAoZnVuY3Rpb24gKENvbGxpc2lvbikge1xuICAgICAgICAvKipcbiAgICAgICAgICog55+p5b2i5Lqk5beu44Gr44KI44KL6KGd56qB5Yik5a6a44KS6KGM44GE44CB44Gd44Gu57WQ5p6c44KS6L+U44GZ44CCXG4gICAgICAgICAqIOaIu+OCiuWApOOBr+OAgeefqeW9onQxLCB0MuOBjOS6pOW3ruOBl+OBpuOBhOOCi+OBqOOBjeecn+OAgeOBp+OBquOBkeOCjOOBsOWBveOAglxuICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0geDEgdDEtWFxuICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0geTEgdDEtWVxuICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gd2lkdGgxIHQx5bmFXG4gICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQxIHQx6auY44GVXG4gICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSB4MiB0Mi1YXG4gICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSB5MiB0Mi1ZXG4gICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aDIgdDLluYVcbiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodDIgdDLpq5jjgZVcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIGludGVyc2VjdCh4MSwgeTEsIHdpZHRoMSwgaGVpZ2h0MSwgeDIsIHkyLCB3aWR0aDIsIGhlaWdodDIpIHtcbiAgICAgICAgICAgIHJldHVybiAoeDEgPD0geDIgKyB3aWR0aDIpICYmICh4MiA8PSB4MSArIHdpZHRoMSlcbiAgICAgICAgICAgICAgICAmJiAoeTEgPD0geTIgKyBoZWlnaHQyKSAmJiAoeTIgPD0geTEgKyBoZWlnaHQxKTtcbiAgICAgICAgfVxuICAgICAgICBDb2xsaXNpb24uaW50ZXJzZWN0ID0gaW50ZXJzZWN0O1xuICAgICAgICAvKipcbiAgICAgICAgICog55+p5b2i5Lqk5beu44Gr44KI44KL6KGd56qB5Yik5a6a44KS6KGM44GE44CB44Gd44Gu57WQ5p6c44KS6L+U44GZ44CCXG4gICAgICAgICAqIOaIu+OCiuWApOOBr+OAgeefqeW9onQxLCB0MuOBjOS6pOW3ruOBl+OBpuOBhOOCi+OBqOOBjeecn+OAgeOBp+OBquOBkeOCjOOBsOWBveOAglxuICAgICAgICAgKiBAcGFyYW0ge0NvbW1vbkFyZWF9IHQxIOefqeW9ojFcbiAgICAgICAgICogQHBhcmFtIHtDb21tb25BcmVhfSB0MiDnn6nlvaIyXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBpbnRlcnNlY3RBcmVhcyh0MSwgdDIpIHtcbiAgICAgICAgICAgIHJldHVybiBDb2xsaXNpb24uaW50ZXJzZWN0KHQxLngsIHQxLnksIHQxLndpZHRoLCB0MS5oZWlnaHQsIHQyLngsIHQyLnksIHQyLndpZHRoLCB0Mi5oZWlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIENvbGxpc2lvbi5pbnRlcnNlY3RBcmVhcyA9IGludGVyc2VjdEFyZWFzO1xuICAgICAgICAvKipcbiAgICAgICAgICogMueCuemWk+OBrui3nembouOBq+OCiOOCi+ihneeqgeWIpOWumuOCkuihjOOBhOOAgeOBneOBrue1kOaenOOCkui/lOOBmeOAglxuICAgICAgICAgKiDmiLvjgorlgKTjga/jgIEy54K56ZaT44Gu6Led6Zui44GM6Za+5YCk5Lul5YaF44Gn44GC44KL44Go44GN55yf44CB44Gn44Gq44GR44KM44Gw5YG944CCXG4gICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSB0MXggdDEtWFxuICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gdDF5IHQxLVhcbiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHQyeCB0MS1YXG4gICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSB0MnkgdDEtWFxuICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gW2Rpc3RhbmNlPTFdIOihneeqgeWIpOWumumWvuWApCBbcGl4ZWxdXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiB3aXRoaW4odDF4LCB0MXksIHQyeCwgdDJ5LCBkaXN0YW5jZSkge1xuICAgICAgICAgICAgaWYgKGRpc3RhbmNlID09PSB2b2lkIDApIHsgZGlzdGFuY2UgPSAxOyB9XG4gICAgICAgICAgICByZXR1cm4gZGlzdGFuY2UgPj0gZy5VdGlsLmRpc3RhbmNlKHQxeCwgdDF5LCB0MngsIHQyeSk7XG4gICAgICAgIH1cbiAgICAgICAgQ29sbGlzaW9uLndpdGhpbiA9IHdpdGhpbjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIDLjgaTjga7nn6nlvaLjga7kuK3lv4PluqfmqJnplpPot53pm6LjgavjgojjgovooZ3nqoHliKTlrprjgpLooYzjgYTjgIHjgZ3jga7ntZDmnpzjgpLov5TjgZnjgIJcbiAgICAgICAgICog5oi744KK5YCk44Gv44CBMueCuemWk+OBrui3nembouOBjOmWvuWApOS7peWGheOBp+OBguOCi+OBqOOBjeecn+OAgeOBp+OBquOBkeOCjOOBsOWBveOAglxuICAgICAgICAgKiBAcGFyYW0ge0NvbW1vbkFyZWF9IHQxIOefqeW9ojFcbiAgICAgICAgICogQHBhcmFtIHtDb21tb25BcmVhfSB0MiDnn6nlvaIyXG4gICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbZGlzdGFuY2U9MV0g6KGd56qB5Yik5a6a6Za+5YCkIFtwaXhlbF1cbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIHdpdGhpbkFyZWFzKHQxLCB0MiwgZGlzdGFuY2UpIHtcbiAgICAgICAgICAgIGlmIChkaXN0YW5jZSA9PT0gdm9pZCAwKSB7IGRpc3RhbmNlID0gMTsgfVxuICAgICAgICAgICAgcmV0dXJuIGRpc3RhbmNlID49IGcuVXRpbC5kaXN0YW5jZUJldHdlZW5BcmVhcyh0MSwgdDIpO1xuICAgICAgICB9XG4gICAgICAgIENvbGxpc2lvbi53aXRoaW5BcmVhcyA9IHdpdGhpbkFyZWFzO1xuICAgIH0pKENvbGxpc2lvbiA9IGcuQ29sbGlzaW9uIHx8IChnLkNvbGxpc2lvbiA9IHt9KSk7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog44Kk44OZ44Oz44OI6YCa55+l5qmf5qeL44Kv44Op44K544CCXG4gICAgICovXG4gICAgdmFyIFRyaWdnZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIFRyaWdnZXIoKSB7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVycyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5sZW5ndGggPSAwO1xuICAgICAgICB9XG4gICAgICAgIFRyaWdnZXIucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChwYXJhbXNPckZ1bmMsIG93bmVyKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBhcmFtc09yRnVuYyA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGZ1bmM6IHBhcmFtc09yRnVuYyxcbiAgICAgICAgICAgICAgICAgICAgb3duZXI6IG93bmVyLFxuICAgICAgICAgICAgICAgICAgICBvbmNlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gcGFyYW1zT3JGdW5jO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcGFyYW1zLmluZGV4ID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXJzLnNwbGljZShwYXJhbXMuaW5kZXgsIDAsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmM6IHBhcmFtcy5mdW5jLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3duZXI6IHBhcmFtcy5vd25lcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uY2U6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcGFyYW1zLm5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVycy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmM6IHBhcmFtcy5mdW5jLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3duZXI6IHBhcmFtcy5vd25lcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uY2U6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcGFyYW1zLm5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLl9oYW5kbGVycy5sZW5ndGg7XG4gICAgICAgIH07XG4gICAgICAgIFRyaWdnZXIucHJvdG90eXBlLmFkZE9uY2UgPSBmdW5jdGlvbiAocGFyYW1zT3JGdW5jLCBvd25lcikge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJhbXNPckZ1bmMgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXJzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBmdW5jOiBwYXJhbXNPckZ1bmMsXG4gICAgICAgICAgICAgICAgICAgIG93bmVyOiBvd25lcixcbiAgICAgICAgICAgICAgICAgICAgb25jZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gcGFyYW1zT3JGdW5jO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcGFyYW1zLmluZGV4ID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXJzLnNwbGljZShwYXJhbXMuaW5kZXgsIDAsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmM6IHBhcmFtcy5mdW5jLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3duZXI6IHBhcmFtcy5vd25lcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uY2U6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwYXJhbXMubmFtZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXJzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgZnVuYzogcGFyYW1zLmZ1bmMsXG4gICAgICAgICAgICAgICAgICAgICAgICBvd25lcjogcGFyYW1zLm93bmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgb25jZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHBhcmFtcy5uYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy5faGFuZGxlcnMubGVuZ3RoO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44GT44GuVHJpZ2dlcuOBq+ODj+ODs+ODieODqeOCkui/veWKoOOBmeOCi+OAglxuICAgICAgICAgKiBAZGVwcmVjYXRlZCDkupLmj5vmgKfjga7jgZ/jgoHjgavmrovjgZXjgozjgabjgYTjgovjgILku6Pjgo/jgorjgasgYGFkZCgpYCDjgpLliKnnlKjjgZnjgbnjgY3jgafjgYLjgovjgILlrp/oo4Xjga7lpInljJbjga7jgZ/jgoHjgIEgYGZ1bmNgIOOBjCBgYm9vbGVhbmAg44KS6L+U44GX44Gf5pmC44Gu5YuV5L2c44Gv44K144Od44O844OI44GV44KM44Gm44GE44Gq44GE44CCXG4gICAgICAgICAqL1xuICAgICAgICBUcmlnZ2VyLnByb3RvdHlwZS5oYW5kbGUgPSBmdW5jdGlvbiAob3duZXIsIGZ1bmMsIG5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkKGZ1bmMgPyB7IG93bmVyOiBvd25lciwgZnVuYzogZnVuYywgbmFtZTogbmFtZSB9IDogeyBmdW5jOiBvd25lciB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBrlRyaWdnZXLjgpLnmbrngavjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog55m76Yyy44GV44KM44Gf5YWo44OP44Oz44OJ44Op44Gu6Zai5pWw44KS44CB5byV5pWwIGBhcmdgIOOCkuS4juOBiOOBpuWRvOOBs+WHuuOBmeOAglxuICAgICAgICAgKiDlkbzjgbPlh7rjgZflvozjgIHmrKHjga7jgYTjgZrjgozjgYvjga7mnaHku7bjgpLmuoDjgZ/jgZnlhajjg4/jg7Pjg4njg6njga7nmbvpjLLjga/op6PpmaTjgZXjgozjgovjgIJcbiAgICAgICAgICogKiDjg4/jg7Pjg4njg6njgYwgYGFkZE9uY2UoKWAg44Gn55m76Yyy44GV44KM44Gm44GE44Gf5aC05ZCIXG4gICAgICAgICAqICog44OP44Oz44OJ44Op44GMIGBhZGQoKWAg44Gn55m76Yyy44GV44KM44KL6Zqb44GrIGBvbmNlOiB0cnVlYCDjgqrjg5fjgrfjg6fjg7PjgYzkuI7jgYjjgonjgozjgabjgYTjgZ/loLTlkIhcbiAgICAgICAgICogKiDplqLmlbDjgYx0cnV0aHnjgarlgKTjgpLov5TjgZfjgZ/loLTlkIhcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIGFyZyDjg4/jg7Pjg4njg6njgavkuI7jgYjjgonjgozjgovlvJXmlbBcbiAgICAgICAgICovXG4gICAgICAgIFRyaWdnZXIucHJvdG90eXBlLmZpcmUgPSBmdW5jdGlvbiAoYXJnKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2hhbmRsZXJzIHx8ICF0aGlzLl9oYW5kbGVycy5sZW5ndGgpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgdmFyIGhhbmRsZXJzID0gdGhpcy5faGFuZGxlcnMuY29uY2F0KCk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhhbmRsZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGhhbmRsZXIgPSBoYW5kbGVyc1tpXTtcbiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlci5mdW5jLmNhbGwoaGFuZGxlci5vd25lciwgYXJnKSB8fCBoYW5kbGVyLm9uY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5faGFuZGxlcnMuaW5kZXhPZihoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXJzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuX2hhbmRsZXJzKSAvLyBUT0RPIOadoeS7tuaWh+OBr+aaq+WumuWvvuW/nFxuICAgICAgICAgICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy5faGFuZGxlcnMubGVuZ3RoO1xuICAgICAgICB9O1xuICAgICAgICBUcmlnZ2VyLnByb3RvdHlwZS5jb250YWlucyA9IGZ1bmN0aW9uIChwYXJhbXNPckZ1bmMsIG93bmVyKSB7XG4gICAgICAgICAgICB2YXIgY29uZGl0aW9uID0gdHlwZW9mIHBhcmFtc09yRnVuYyA9PT0gXCJmdW5jdGlvblwiID8geyBmdW5jOiBwYXJhbXNPckZ1bmMsIG93bmVyOiBvd25lciB9IDogcGFyYW1zT3JGdW5jO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9oYW5kbGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jb21wYXJlUGFydGlhbChjb25kaXRpb24sIHRoaXMuX2hhbmRsZXJzW2ldKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH07XG4gICAgICAgIFRyaWdnZXIucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uIChwYXJhbXNPckZ1bmMsIG93bmVyKSB7XG4gICAgICAgICAgICB2YXIgY29uZGl0aW9uID0gdHlwZW9mIHBhcmFtc09yRnVuYyA9PT0gXCJmdW5jdGlvblwiID8geyBmdW5jOiBwYXJhbXNPckZ1bmMsIG93bmVyOiBvd25lciB9IDogcGFyYW1zT3JGdW5jO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9oYW5kbGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBoYW5kbGVyID0gdGhpcy5faGFuZGxlcnNbaV07XG4gICAgICAgICAgICAgICAgaWYgKGNvbmRpdGlvbi5mdW5jID09PSBoYW5kbGVyLmZ1bmMgJiYgY29uZGl0aW9uLm93bmVyID09PSBoYW5kbGVyLm93bmVyICYmIGNvbmRpdGlvbi5uYW1lID09PSBoYW5kbGVyLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlcnMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgICAgICAtLXRoaXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog5oyH5a6a44GX44Gf5p2h5Lu244Gr6YOo5YiG5LiA6Ie044GZ44KL44Kk44OZ44Oz44OI44OP44Oz44OJ44Op44KS5YmK6Zmk44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOacrOODoeOCveODg+ODieOBr+W8leaVsOOBq+S4juOBiOOBn+adoeS7tuOBq+S4gOiHtOOBl+OBn+OCpOODmeODs+ODiOODj+ODs+ODieODqeOCkuWFqOOBpuWJiumZpOOBmeOCi+OAglxuICAgICAgICAgKiDlvJXmlbDjga7mnaHku7bjgpLkuIDpg6jnnIHnlaXjgZfjgZ/loLTlkIjjgIHjgZ3jga7lgKTjga7lhoXlrrnjgYznmbvpjLLmmYLjgajnlbDjgarjgaPjgabjgYTjgabjgoLlr77osaHjga7jgqTjg5njg7Pjg4jjg4/jg7Pjg4njg6njga/liYrpmaTjgZXjgozjgovjgIJcbiAgICAgICAgICog5byV5pWw44Gr5LiO44GI44Gf5p2h5Lu244Go5a6M5YWo44Gr5LiA6Ie044GX44Gf44Kk44OZ44Oz44OI44OP44Oz44OJ44Op44Gu44G/44KS5YmK6Zmk44GX44Gf44GE5aC05ZCI44GvIGB0aGlzLnJlbW92ZSgpYCDjgpLnlKjjgYTjgovjgIJcbiAgICAgICAgICog5byV5pWw44KS55yB55Wl44GX44Gf5aC05ZCI44Gv5YWo44Gm44Gu44Kk44OZ44Oz44OI44OP44Oz44OJ44Op44KS5YmK6Zmk44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBwYXJhbXMg5YmK6Zmk44GZ44KL44Kk44OZ44Oz44OI44OP44Oz44OJ44Op44Gu5p2h5Lu2XG4gICAgICAgICAqL1xuICAgICAgICBUcmlnZ2VyLnByb3RvdHlwZS5yZW1vdmVBbGwgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICB2YXIgaGFuZGxlcnMgPSBbXTtcbiAgICAgICAgICAgIGlmIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX2hhbmRsZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBoYW5kbGVyID0gdGhpcy5faGFuZGxlcnNbaV07XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fY29tcGFyZVBhcnRpYWwocGFyYW1zLCBoYW5kbGVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlcnMucHVzaChoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZXJzID0gaGFuZGxlcnM7XG4gICAgICAgICAgICB0aGlzLmxlbmd0aCA9IHRoaXMuX2hhbmRsZXJzLmxlbmd0aDtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBrlRyaWdnZXLjgpLnoLTmo4TjgZnjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIFRyaWdnZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVycyA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmxlbmd0aCA9IG51bGw7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga5UcmlnZ2Vy44GM56C05qOE44GV44KM44Gm44GE44KL44GL44KS6L+U44GZ44CCXG4gICAgICAgICAqL1xuICAgICAgICBUcmlnZ2VyLnByb3RvdHlwZS5kZXN0cm95ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5faGFuZGxlcnMgPT09IG51bGw7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgVHJpZ2dlci5wcm90b3R5cGUuX2NvbXBhcmVQYXJ0aWFsID0gZnVuY3Rpb24gKHRhcmdldCwgY29tcGFyZSkge1xuICAgICAgICAgICAgaWYgKHRhcmdldC5mdW5jICE9PSB1bmRlZmluZWQgJiYgdGFyZ2V0LmZ1bmMgIT09IGNvbXBhcmUuZnVuYylcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGFyZ2V0Lm93bmVyICE9PSB1bmRlZmluZWQgJiYgdGFyZ2V0Lm93bmVyICE9PSBjb21wYXJlLm93bmVyKVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIGlmICh0YXJnZXQubmFtZSAhPT0gdW5kZWZpbmVkICYmIHRhcmdldC5uYW1lICE9PSBjb21wYXJlLm5hbWUpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBUcmlnZ2VyO1xuICAgIH0oKSk7XG4gICAgZy5UcmlnZ2VyID0gVHJpZ2dlcjtcbiAgICAvKipcbiAgICAgKiDku5bjga5UcmlnZ2Vy44Gr5Y+N5b+c44GX44Gm55m654Gr44GZ44KL44Kk44OZ44Oz44OI6YCa55+l5qmf5qeL44CCXG4gICAgICovXG4gICAgdmFyIENoYWluVHJpZ2dlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICAgICAgX19leHRlbmRzKENoYWluVHJpZ2dlciwgX3N1cGVyKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGBDaGFpblRyaWdnZXJgIOOBruOCpOODs+OCueOCv+ODs+OCueOCkueUn+aIkOOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgZPjga7jgqTjg7Pjgrnjgr/jg7Pjgrnjga/jgIEgYGNoYWluYCDjgYxmaXJl44GV44KM44Gf44Go44GN44GrIGBmaWx0ZXJgIOOCkuWun+ihjOOBl+OAgeecn+OCkui/lOOBl+OBn+WgtOWQiOOBq+iHqui6q+OCkmZpcmXjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIGNoYWluIOOBk+OBruOCpOODs+OCueOCv+ODs+OCueOBjGZpcmXjgZnjgovjgY3jgaPjgYvjgZHjgajjgarjgosgVHJpZ2dlclxuICAgICAgICAgKiBAcGFyYW0gZmlsdGVyIGBjaGFpbmAg44GMZmlyZeOBleOCjOOBn+OBqOOBjeOBq+Wun+ihjOOBleOCjOOCi+mWouaVsOOAguecgeeVpeOBleOCjOOBn+WgtOWQiOOAgeOBvuOBn+OBr+acrOmWouaVsOOBruaIu+OCiuWApOOBjOecn+OBruWgtOWQiOOAgeOBk+OBruOCpOODs+OCueOCv+ODs+OCueOCkmZpcmXjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIGZpbHRlck93bmVyIGBmaWx0ZXJgIOWRvOOBs+WHuuOBl+aZguOBq+S9v+OCj+OCjOOCiyBgdGhpc2Ag44Gu5YCk44CCXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBDaGFpblRyaWdnZXIoY2hhaW4sIGZpbHRlciwgZmlsdGVyT3duZXIpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XG4gICAgICAgICAgICBfdGhpcy5jaGFpbiA9IGNoYWluO1xuICAgICAgICAgICAgX3RoaXMuZmlsdGVyID0gZmlsdGVyO1xuICAgICAgICAgICAgX3RoaXMuZmlsdGVyT3duZXIgPSBmaWx0ZXJPd25lcjtcbiAgICAgICAgICAgIF90aGlzLl9pc0FjdGl2YXRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgICAgICB9XG4gICAgICAgIENoYWluVHJpZ2dlci5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKHBhcmFtc09ySGFuZGxlciwgb3duZXIpIHtcbiAgICAgICAgICAgIF9zdXBlci5wcm90b3R5cGUuYWRkLmNhbGwodGhpcywgcGFyYW1zT3JIYW5kbGVyLCBvd25lcik7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2lzQWN0aXZhdGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFpbi5hZGQodGhpcy5fb25DaGFpblRyaWdnZXJGaXJlZCwgdGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5faXNBY3RpdmF0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBDaGFpblRyaWdnZXIucHJvdG90eXBlLmFkZE9uY2UgPSBmdW5jdGlvbiAocGFyYW1zT3JIYW5kbGVyLCBvd25lcikge1xuICAgICAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5hZGRPbmNlLmNhbGwodGhpcywgcGFyYW1zT3JIYW5kbGVyLCBvd25lcik7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2lzQWN0aXZhdGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFpbi5hZGQodGhpcy5fb25DaGFpblRyaWdnZXJGaXJlZCwgdGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5faXNBY3RpdmF0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBDaGFpblRyaWdnZXIucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uIChwYXJhbXNPckZ1bmMsIG93bmVyKSB7XG4gICAgICAgICAgICBfc3VwZXIucHJvdG90eXBlLnJlbW92ZS5jYWxsKHRoaXMsIHBhcmFtc09yRnVuYywgb3duZXIpO1xuICAgICAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAwICYmIHRoaXMuX2lzQWN0aXZhdGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFpbi5yZW1vdmUodGhpcy5fb25DaGFpblRyaWdnZXJGaXJlZCwgdGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5faXNBY3RpdmF0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgQ2hhaW5UcmlnZ2VyLnByb3RvdHlwZS5yZW1vdmVBbGwgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICBfc3VwZXIucHJvdG90eXBlLnJlbW92ZUFsbC5jYWxsKHRoaXMsIHBhcmFtcyk7XG4gICAgICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDAgJiYgdGhpcy5faXNBY3RpdmF0ZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYWluLnJlbW92ZSh0aGlzLl9vbkNoYWluVHJpZ2dlckZpcmVkLCB0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9pc0FjdGl2YXRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBDaGFpblRyaWdnZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfc3VwZXIucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuY2hhaW4ucmVtb3ZlKHRoaXMuX29uQ2hhaW5UcmlnZ2VyRmlyZWQsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5maWx0ZXIgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJPd25lciA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLl9pc0FjdGl2YXRlZCA9IGZhbHNlO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIENoYWluVHJpZ2dlci5wcm90b3R5cGUuX29uQ2hhaW5UcmlnZ2VyRmlyZWQgPSBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmZpbHRlciB8fCB0aGlzLmZpbHRlci5jYWxsKHRoaXMuZmlsdGVyT3duZXIsIGFyZ3MpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maXJlKGFyZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gQ2hhaW5UcmlnZ2VyO1xuICAgIH0oVHJpZ2dlcikpO1xuICAgIGcuQ2hhaW5UcmlnZ2VyID0gQ2hhaW5UcmlnZ2VyO1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIC8qKlxuICAgICAqIOS4gOWumuaZgumWk+OBp+e5sOOCiui/lOOBleOCjOOCi+WHpueQhuOCkuihqOOBmeOCv+OCpOODnuODvOOAglxuICAgICAqXG4gICAgICog44Ky44O844Og6ZaL55m66ICF44GM5pys44Kv44Op44K544Gu44Kk44Oz44K544K/44Oz44K544KS55u05o6l55Sf5oiQ44GZ44KL44GT44Go44Gv44Gq44GP44CBXG4gICAgICog6YCa5bi444GvU2NlbmUjc2V0VGltZW91dOOAgVNjZW5lI3NldEludGVydmFs44Gr44KI44Gj44Gm6ZaT5o6l55qE44Gr5Yip55So44GZ44KL44CCXG4gICAgICovXG4gICAgdmFyIFRpbWVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgICAgICBmdW5jdGlvbiBUaW1lcihpbnRlcnZhbCwgZnBzKSB7XG4gICAgICAgICAgICB0aGlzLmludGVydmFsID0gaW50ZXJ2YWw7XG4gICAgICAgICAgICAvLyBOT1RFOiBpbnRlcnZhbOOBjOa1ruWLleWwj+aVsOOBruWgtOWQiOOBjOOBguOCi+OBn+OCgeW/teOBruOBn+OCgeWbm+aNqOS6lOWFpeOBmeOCi1xuICAgICAgICAgICAgdGhpcy5fc2NhbGVkSW50ZXJ2YWwgPSBNYXRoLnJvdW5kKGludGVydmFsICogZnBzKTtcbiAgICAgICAgICAgIHRoaXMuZWxhcHNlZCA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgICAgIHRoaXMuX3NjYWxlZEVsYXBzZWQgPSAwO1xuICAgICAgICB9XG4gICAgICAgIFRpbWVyLnByb3RvdHlwZS50aWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gTk9URTogMTAwMCAvIGZwcyAqIGZwcyA9IDEwMDBcbiAgICAgICAgICAgIHRoaXMuX3NjYWxlZEVsYXBzZWQgKz0gMTAwMDtcbiAgICAgICAgICAgIHdoaWxlICh0aGlzLl9zY2FsZWRFbGFwc2VkID49IHRoaXMuX3NjYWxlZEludGVydmFsKSB7XG4gICAgICAgICAgICAgICAgLy8gTk9URTogdGhpcy5lbGFwc2VkLmZpcmUoKeWGheOBp2Rlc3Ryb3koKeOBleOCjOOCi+WPr+iDveaAp+OBjOOBguOCi+OBn+OCgeOAgWRlc3Ryb3llZCgp44KS5Yik5a6a44GZ44KLXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmVsYXBzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZWxhcHNlZC5maXJlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2NhbGVkRWxhcHNlZCAtPSB0aGlzLl9zY2FsZWRJbnRlcnZhbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgVGltZXIucHJvdG90eXBlLmNhbkRlbGV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAhdGhpcy5lbGFwc2VkIHx8IHRoaXMuZWxhcHNlZC5sZW5ndGggPT09IDA7XG4gICAgICAgIH07XG4gICAgICAgIFRpbWVyLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5pbnRlcnZhbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuZWxhcHNlZC5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLmVsYXBzZWQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl9zY2FsZWRJbnRlcnZhbCA9IDA7XG4gICAgICAgICAgICB0aGlzLl9zY2FsZWRFbGFwc2VkID0gMDtcbiAgICAgICAgfTtcbiAgICAgICAgVGltZXIucHJvdG90eXBlLmRlc3Ryb3llZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVsYXBzZWQgPT09IHVuZGVmaW5lZDtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIFRpbWVyO1xuICAgIH0oKSk7XG4gICAgZy5UaW1lciA9IFRpbWVyO1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIC8qKlxuICAgICAqIGBTY2VuZSNzZXRUaW1lb3V0YCDjgoQgYFNjZW5lI3NldEludGVydmFsYCDjga7lrp/ooYzljZjkvY3jgpLooajjgZnjgIJcbiAgICAgKiDjgrLjg7zjg6DplovnmbrogIXjgYzmnKzjgq/jg6njgrnjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLnm7TmjqXnlJ/miJDjgZnjgovjgZPjgajjga/jgarjgY/jgIFcbiAgICAgKiDmnKzjgq/jg6njgrnjga7mqZ/og73jgpLnm7TmjqXliKnnlKjjgZnjgovjgZPjgajjga/jgarjgYTjgIJcbiAgICAgKi9cbiAgICB2YXIgVGltZXJJZGVudGlmaWVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgICAgICBmdW5jdGlvbiBUaW1lcklkZW50aWZpZXIodGltZXIsIGhhbmRsZXIsIGhhbmRsZXJPd25lciwgZmlyZWQsIGZpcmVkT3duZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX3RpbWVyID0gdGltZXI7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVyID0gaGFuZGxlcjtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZXJPd25lciA9IGhhbmRsZXJPd25lcjtcbiAgICAgICAgICAgIHRoaXMuX2ZpcmVkID0gZmlyZWQ7XG4gICAgICAgICAgICB0aGlzLl9maXJlZE93bmVyID0gZmlyZWRPd25lcjtcbiAgICAgICAgICAgIHRoaXMuX3RpbWVyLmVsYXBzZWQuYWRkKHRoaXMuX2ZpcmUsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIFRpbWVySWRlbnRpZmllci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuX3RpbWVyLmVsYXBzZWQucmVtb3ZlKHRoaXMuX2ZpcmUsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5fdGltZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlck93bmVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fZmlyZWQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl9maXJlZE93bmVyID0gdW5kZWZpbmVkO1xuICAgICAgICB9O1xuICAgICAgICBUaW1lcklkZW50aWZpZXIucHJvdG90eXBlLmRlc3Ryb3llZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW1lciA9PT0gdW5kZWZpbmVkO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIFRpbWVySWRlbnRpZmllci5wcm90b3R5cGUuX2ZpcmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVyLmNhbGwodGhpcy5faGFuZGxlck93bmVyKTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9maXJlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZpcmVkLmNhbGwodGhpcy5fZmlyZWRPd25lciwgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBUaW1lcklkZW50aWZpZXI7XG4gICAgfSgpKTtcbiAgICBnLlRpbWVySWRlbnRpZmllciA9IFRpbWVySWRlbnRpZmllcjtcbiAgICAvKipcbiAgICAgKiBUaW1lcuOCkueuoeeQhuOBmeOCi+apn+ani+OCkuaPkOS+m+OBmeOCi+OAglxuICAgICAqIOOCsuODvOODoOmWi+eZuuiAheOBjOacrOOCr+ODqeOCueOCkuWIqeeUqOOBmeOCi+S6i+OBr+OBquOBhOOAglxuICAgICAqL1xuICAgIHZhciBUaW1lck1hbmFnZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIFRpbWVyTWFuYWdlcih0cmlnZ2VyLCBmcHMpIHtcbiAgICAgICAgICAgIHRoaXMuX3RpbWVycyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fdHJpZ2dlciA9IHRyaWdnZXI7XG4gICAgICAgICAgICB0aGlzLl9pZGVudGlmaWVycyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fZnBzID0gZnBzO1xuICAgICAgICAgICAgdGhpcy5fcmVnaXN0ZXJlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIFRpbWVyTWFuYWdlci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5faWRlbnRpZmllcnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pZGVudGlmaWVyc1tpXS5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3RpbWVycy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RpbWVyc1tpXS5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl90aW1lcnMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl90cmlnZ2VyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5faWRlbnRpZmllcnMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl9mcHMgPSB1bmRlZmluZWQ7XG4gICAgICAgIH07XG4gICAgICAgIFRpbWVyTWFuYWdlci5wcm90b3R5cGUuZGVzdHJveWVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVycyA9PT0gdW5kZWZpbmVkO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog5a6a5pyf6ZaT6ZqU44Gn5Yem55CG44KS5a6f6KGM44GZ44KLVGltZXLjgpLkvZzmiJDjgZnjgovjgIJcbiAgICAgICAgICog5pysVGltZXLjga/jg5Xjg6zjg7zjg6DntYzpgY7jgavjgojjgaPjgabli5XkvZzjgZnjgovnlpHkvLzjgr/jgqTjg57jg7zjgafjgYLjgovjgZ/jgoHjgIHlrp/mmYLplpPjga7lvbHpn7/jga/lj5fjgZHjgarjgYRcbiAgICAgICAgICogQHBhcmFtIGludGVydmFsIFRpbWVy44Gu5a6f6KGM6ZaT6ZqU77yI44Of44Oq56eS77yJXG4gICAgICAgICAqIEByZXR1cm5zIOS9nOaIkOOBl+OBn1RpbWVyXG4gICAgICAgICAqL1xuICAgICAgICBUaW1lck1hbmFnZXIucHJvdG90eXBlLmNyZWF0ZVRpbWVyID0gZnVuY3Rpb24gKGludGVydmFsKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX3JlZ2lzdGVyZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyLmFkZCh0aGlzLl90aWNrLCB0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZWdpc3RlcmVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpbnRlcnZhbCA8IDApXG4gICAgICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiVGltZXJNYW5hZ2VyI2NyZWF0ZVRpbWVyOiBpbnZhbGlkIGludGVydmFsXCIpO1xuICAgICAgICAgICAgLy8gTk9ERTogaW50ZXJ2YWzjgYww44Gu5aC05ZCI44Gr44CBVGltZXIjdGljaygp44Gn54Sh6ZmQ44Or44O844OX44Go44Gq44KL44Gf44KBaW50ZXJ2YWzjga7mnIDlsI/lgKTjgpIx44Go44GZ44KL44CCXG4gICAgICAgICAgICBpZiAoaW50ZXJ2YWwgPCAxKVxuICAgICAgICAgICAgICAgIGludGVydmFsID0gMTtcbiAgICAgICAgICAgIC8vIE5PVEU6IFRpbWVy44GuX3NjYWxlZEVsYXBzZWTjgajmr5TovIPjgZnjgovjgZ/jgoHjgIF0aGlzLmZwc+WAjeOBl+OBn+WApOOCkueUqOOBhOOCi1xuICAgICAgICAgICAgLy8gTWF0aC5taW4oMTAwMCAvIHRoaXMuX2ZwcyAqIHRoaXMuZnBzLCBpbnRlcnZhbCAqIHRoaXMuX2Zwcyk7XG4gICAgICAgICAgICB2YXIgYWNjZXB0YWJsZU1hcmdpbiA9IE1hdGgubWluKDEwMDAsIGludGVydmFsICogdGhpcy5fZnBzKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fdGltZXJzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RpbWVyc1tpXS5pbnRlcnZhbCA9PT0gaW50ZXJ2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RpbWVyc1tpXS5fc2NhbGVkRWxhcHNlZCA8IGFjY2VwdGFibGVNYXJnaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW1lcnNbaV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdGltZXIgPSBuZXcgZy5UaW1lcihpbnRlcnZhbCwgdGhpcy5fZnBzKTtcbiAgICAgICAgICAgIHRoaXMuX3RpbWVycy5wdXNoKHRpbWVyKTtcbiAgICAgICAgICAgIHJldHVybiB0aW1lcjtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRpbWVy44KS5YmK6Zmk44GZ44KL44CCXG4gICAgICAgICAqIEBwYXJhbSB0aW1lciDliYrpmaTjgZnjgotUaW1lclxuICAgICAgICAgKi9cbiAgICAgICAgVGltZXJNYW5hZ2VyLnByb3RvdHlwZS5kZWxldGVUaW1lciA9IGZ1bmN0aW9uICh0aW1lcikge1xuICAgICAgICAgICAgaWYgKCF0aW1lci5jYW5EZWxldGUoKSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB2YXIgaW5kZXggPSB0aGlzLl90aW1lcnMuaW5kZXhPZih0aW1lcik7XG4gICAgICAgICAgICBpZiAoaW5kZXggPCAwKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIlRpbWVyTWFuYWdlciNkZWxldGVUaW1lcjogY2FuIG5vdCBmaW5kIHRpbWVyXCIpO1xuICAgICAgICAgICAgdGhpcy5fdGltZXJzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICB0aW1lci5kZXN0cm95KCk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX3RpbWVycy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3JlZ2lzdGVyZWQpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIlRpbWVyTWFuYWdlciNkZWxldGVUaW1lcjogaGFuZGxlciBpcyBub3QgaGFuZGxlZFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyLnJlbW92ZSh0aGlzLl90aWNrLCB0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZWdpc3RlcmVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIFRpbWVyTWFuYWdlci5wcm90b3R5cGUuc2V0VGltZW91dCA9IGZ1bmN0aW9uIChoYW5kbGVyLCBtaWxsaXNlY29uZHMsIG93bmVyKSB7XG4gICAgICAgICAgICB2YXIgdGltZXIgPSB0aGlzLmNyZWF0ZVRpbWVyKG1pbGxpc2Vjb25kcyk7XG4gICAgICAgICAgICB2YXIgaWRlbnRpZmllciA9IG5ldyBUaW1lcklkZW50aWZpZXIodGltZXIsIGhhbmRsZXIsIG93bmVyLCB0aGlzLl9vblRpbWVvdXRGaXJlZCwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLl9pZGVudGlmaWVycy5wdXNoKGlkZW50aWZpZXIpO1xuICAgICAgICAgICAgcmV0dXJuIGlkZW50aWZpZXI7XG4gICAgICAgIH07XG4gICAgICAgIFRpbWVyTWFuYWdlci5wcm90b3R5cGUuY2xlYXJUaW1lb3V0ID0gZnVuY3Rpb24gKGlkZW50aWZpZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyKGlkZW50aWZpZXIpO1xuICAgICAgICB9O1xuICAgICAgICBUaW1lck1hbmFnZXIucHJvdG90eXBlLnNldEludGVydmFsID0gZnVuY3Rpb24gKGhhbmRsZXIsIGludGVydmFsLCBvd25lcikge1xuICAgICAgICAgICAgdmFyIHRpbWVyID0gdGhpcy5jcmVhdGVUaW1lcihpbnRlcnZhbCk7XG4gICAgICAgICAgICB2YXIgaWRlbnRpZmllciA9IG5ldyBUaW1lcklkZW50aWZpZXIodGltZXIsIGhhbmRsZXIsIG93bmVyKTtcbiAgICAgICAgICAgIHRoaXMuX2lkZW50aWZpZXJzLnB1c2goaWRlbnRpZmllcik7XG4gICAgICAgICAgICByZXR1cm4gaWRlbnRpZmllcjtcbiAgICAgICAgfTtcbiAgICAgICAgVGltZXJNYW5hZ2VyLnByb3RvdHlwZS5jbGVhckludGVydmFsID0gZnVuY3Rpb24gKGlkZW50aWZpZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyKGlkZW50aWZpZXIpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44GZ44G544Gm44GuVGltZXLjgpLmmYLplpPntYzpgY7jgZXjgZvjgovjgIJcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIFRpbWVyTWFuYWdlci5wcm90b3R5cGUuX3RpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdGltZXJzID0gdGhpcy5fdGltZXJzLmNvbmNhdCgpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aW1lcnMubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgdGltZXJzW2ldLnRpY2soKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBUaW1lck1hbmFnZXIucHJvdG90eXBlLl9vblRpbWVvdXRGaXJlZCA9IGZ1bmN0aW9uIChpZGVudGlmaWVyKSB7XG4gICAgICAgICAgICB2YXIgaW5kZXggPSB0aGlzLl9pZGVudGlmaWVycy5pbmRleE9mKGlkZW50aWZpZXIpO1xuICAgICAgICAgICAgaWYgKGluZGV4IDwgMClcbiAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJUaW1lck1hbmFnZXIjX29uVGltZW91dEZpcmVkOiBjYW4gbm90IGZpbmQgaWRlbnRpZmllclwiKTtcbiAgICAgICAgICAgIHRoaXMuX2lkZW50aWZpZXJzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICB2YXIgdGltZXIgPSBpZGVudGlmaWVyLl90aW1lcjtcbiAgICAgICAgICAgIGlkZW50aWZpZXIuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5kZWxldGVUaW1lcih0aW1lcik7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgVGltZXJNYW5hZ2VyLnByb3RvdHlwZS5fY2xlYXIgPSBmdW5jdGlvbiAoaWRlbnRpZmllcikge1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5faWRlbnRpZmllcnMuaW5kZXhPZihpZGVudGlmaWVyKTtcbiAgICAgICAgICAgIGlmIChpbmRleCA8IDApXG4gICAgICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiVGltZXJNYW5hZ2VyI19jbGVhcjogY2FuIG5vdCBmaW5kIGlkZW50aWZpZXJcIik7XG4gICAgICAgICAgICBpZiAoaWRlbnRpZmllci5kZXN0cm95ZWQoKSlcbiAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJUaW1lck1hbmFnZXIjX2NsZWFyOiBpbnZhbGlkIGlkZW50aWZpZXJcIik7XG4gICAgICAgICAgICB0aGlzLl9pZGVudGlmaWVycy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgdmFyIHRpbWVyID0gaWRlbnRpZmllci5fdGltZXI7XG4gICAgICAgICAgICBpZGVudGlmaWVyLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMuZGVsZXRlVGltZXIodGltZXIpO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gVGltZXJNYW5hZ2VyO1xuICAgIH0oKSk7XG4gICAgZy5UaW1lck1hbmFnZXIgPSBUaW1lck1hbmFnZXI7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog44K144Km44Oz44OJ5YaN55Sf44KS6KGM44GG44Kv44Op44K544CCXG4gICAgICpcbiAgICAgKiDmnKzjgq/jg6njgrnjga7jgqTjg7Pjgrnjgr/jg7Pjgrnjga/jgIEgYEF1ZGlvU3lzdGVtI2NyZWF0ZVBsYXllcigpYCDjgavjgojjgaPjgabmmI7npLrnmoTjgavjgIFcbiAgICAgKiDjgb7jgZ/jga8gYEF1ZGlvQXNzZXQjcGxheSgpYCDjgavjgojjgaPjgabmmpfpu5nnmoTjgavnlJ/miJDjgZXjgozjgovjgIJcbiAgICAgKiDjgrLjg7zjg6DplovnmbrogIXjga/mnKzjgq/jg6njgrnjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLnm7TmjqXnlJ/miJDjgZnjgbnjgY3jgafjga/jgarjgYTjgIJcbiAgICAgKi9cbiAgICB2YXIgQXVkaW9QbGF5ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBgQXVkaW9QbGF5ZXJgIOOBruOCpOODs+OCueOCv+ODs+OCueOCkueUn+aIkOOBmeOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gQXVkaW9QbGF5ZXIoc3lzdGVtKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllZCA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgICAgIHRoaXMuc3RvcHBlZCA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEF1ZGlvID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy52b2x1bWUgPSBzeXN0ZW0udm9sdW1lO1xuICAgICAgICAgICAgdGhpcy5fbXV0ZWQgPSBzeXN0ZW0uX211dGVkO1xuICAgICAgICAgICAgdGhpcy5fcGxheWJhY2tSYXRlID0gc3lzdGVtLl9wbGF5YmFja1JhdGU7XG4gICAgICAgICAgICB0aGlzLl9zeXN0ZW0gPSBzeXN0ZW07XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGBBdWRpb0Fzc2V0YCDjgpLlho3nlJ/jgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog5YaN55Sf5b6M44CBIGB0aGlzLnBsYXllZGAg44GMZmlyZeOBleOCjOOCi+OAglxuICAgICAgICAgKiBAcGFyYW0gYXVkaW8g5YaN55Sf44GZ44KL44Kq44O844OH44Kj44Kq44Ki44K744OD44OIXG4gICAgICAgICAqL1xuICAgICAgICBBdWRpb1BsYXllci5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uIChhdWRpbykge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50QXVkaW8gPSBhdWRpbztcbiAgICAgICAgICAgIHRoaXMucGxheWVkLmZpcmUoe1xuICAgICAgICAgICAgICAgIHBsYXllcjogdGhpcyxcbiAgICAgICAgICAgICAgICBhdWRpbzogYXVkaW9cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog5YaN55Sf44KS5YGc5q2i44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOWBnOatouW+jOOAgSBgdGhpcy5zdG9wcGVkYCDjgYxmaXJl44GV44KM44KL44CCXG4gICAgICAgICAqIOWGjeeUn+S4reOBp+OBquOBhOWgtOWQiOOAgeS9leOCguOBl+OBquOBhChgc3RvcHBlZGAg44KCZmlyZeOBleOCjOOBquOBhCnjgIJcbiAgICAgICAgICovXG4gICAgICAgIEF1ZGlvUGxheWVyLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGF1ZGlvID0gdGhpcy5jdXJyZW50QXVkaW87XG4gICAgICAgICAgICBpZiAoIWF1ZGlvKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEF1ZGlvID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5zdG9wcGVkLmZpcmUoe1xuICAgICAgICAgICAgICAgIHBsYXllcjogdGhpcyxcbiAgICAgICAgICAgICAgICBhdWRpbzogYXVkaW9cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog6Z+z5aOw44Gu57WC5LqG44KS5qSc55+l44Gn44GN44KL44GL5ZCm44GL44CCXG4gICAgICAgICAqIOmAmuW4uOOAgeOCsuODvOODoOmWi+eZuuiAheOBjOOBk+OBruODoeOCveODg+ODieOCkuWIqeeUqOOBmeOCi+W/heimgeOBr+OBquOBhOOAglxuICAgICAgICAgKi9cbiAgICAgICAgQXVkaW9QbGF5ZXIucHJvdG90eXBlLmNhbkhhbmRsZVN0b3BwZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOmfs+mHj+OCkuWkieabtOOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gdm9sdW1lIOmfs+mHj+OAgjDku6XkuIoxLjDku6XkuIvjgafjgarjgZHjgozjgbDjgarjgonjgarjgYRcbiAgICAgICAgICovXG4gICAgICAgIC8vIOOCqOODs+OCuOODs+ODpuODvOOCtuOBjCBgQXVkaW9QbGF5ZXJgIOOBrua0vueUn+OCr+ODqeOCueOCkuWun+ijheOBmeOCi+WgtOWQiOOBr+OAgVxuICAgICAgICAvLyBgX2NoYW5nZU11dGVkKClgIOOBquOBqeOBqOWQjOanmOOAgeOBk+OBruODoeOCveODg+ODieOCkuOCquODvOODkOODvOODqeOCpOODieOBl+OBpuWun+mam+OBq+mfs+mHj+OCkuWkieabtOOBmeOCi+WHpueQhuOCkuihjOOBhuOBk+OBqOOAglxuICAgICAgICAvLyDjgqrjg7zjg5Djg7zjg6njgqTjg4nlhYjjga7jg6Hjgr3jg4Pjg4njga/jgZPjga7jg6Hjgr3jg4Pjg4njgpLlkbzjgbPjgaDjgZXjgarjgZHjgozjgbDjgarjgonjgarjgYTjgIJcbiAgICAgICAgQXVkaW9QbGF5ZXIucHJvdG90eXBlLmNoYW5nZVZvbHVtZSA9IGZ1bmN0aW9uICh2b2x1bWUpIHtcbiAgICAgICAgICAgIHRoaXMudm9sdW1lID0gdm9sdW1lO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44Of44Ol44O844OI54q25oWL44KS5aSJ5pu044GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOOCqOODs+OCuOODs+ODpuODvOOCtuOBjCBgQXVkaW9QbGF5ZXJgIOOBrua0vueUn+OCr+ODqeOCueOCkuWun+ijheOBmeOCi+WgtOWQiOOBr+OAgVxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njgpLjgqrjg7zjg5Djg7zjg6njgqTjg4njgZfjgablrp/pmpvjgavjg5/jg6Xjg7zjg4jnirbmhYvjgpLlpInmm7TjgZnjgovlh6bnkIbjgpLooYzjgYbjgZPjgajjgIJcbiAgICAgICAgICog44Kq44O844OQ44O844Op44Kk44OJ5YWI44Gu44Oh44K944OD44OJ44Gv44GT44Gu44Oh44K944OD44OJ44KS5ZG844Gz44Gg44GV44Gq44GR44KM44Gw44Gq44KJ44Gq44GE44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBtdXRlZCDjg5/jg6Xjg7zjg4jnirbmhYvjgavjgZnjgovjgYvlkKbjgYtcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIEF1ZGlvUGxheWVyLnByb3RvdHlwZS5fY2hhbmdlTXV0ZWQgPSBmdW5jdGlvbiAobXV0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX211dGVkID0gbXV0ZWQ7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlho3nlJ/pgJ/luqbjgpLlpInmm7TjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog44Ko44Oz44K444Oz44Om44O844K244GMIGBBdWRpb1BsYXllcmAg44Gu5rS+55Sf44Kv44Op44K544KS5a6f6KOF44GX44CBXG4gICAgICAgICAqIOOBi+OBpCBgdGhpcy5fc3VwcG9ydHNQbGF5YmFja1JhdGUoKWAg44KS44Kq44O844OQ44Op44Kk44OJ44GX44Gm55yf44KS6L+U44GZ44KI44GG44Gr44GZ44KL44Gq44KJ44Gw44CBXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOCguOCquODvOODkOODvOODqeOCpOODieOBl+OBpuWun+mam+OBq+WGjeeUn+mAn+W6puOCkuWkieabtOOBmeOCi+WHpueQhuOCkuihjOOBhuOBk+OBqOOAglxuICAgICAgICAgKiDjgqrjg7zjg5Djg7zjg6njgqTjg4nlhYjjga7jg6Hjgr3jg4Pjg4njga/jgZPjga7jg6Hjgr3jg4Pjg4njgpLlkbzjgbPjgaDjgZXjgarjgZHjgozjgbDjgarjgonjgarjgYTjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHJhdGUg5YaN55Sf6YCf5bqm44Gu5YCN546H44CCMOS7peS4iuOBp+OBquOBkeOCjOOBsOOBquOCieOBquOBhOOAgjEuMOOBp+etieWAjeOBp+OBguOCi+OAglxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgQXVkaW9QbGF5ZXIucHJvdG90eXBlLl9jaGFuZ2VQbGF5YmFja1JhdGUgPSBmdW5jdGlvbiAocmF0ZSkge1xuICAgICAgICAgICAgdGhpcy5fcGxheWJhY2tSYXRlID0gcmF0ZTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOWGjeeUn+mAn+W6puOBruWkieabtOOBq+WvvuW/nOOBmeOCi+OBi+WQpuOBi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgqjjg7Pjgrjjg7Pjg6bjg7zjgrbjgYwgYEF1ZGlvUGxheWVyYCDjga7mtL7nlJ/jgq/jg6njgrnjgpLlrp/oo4XjgZfjgIFcbiAgICAgICAgICog5YaN55Sf6YCf5bqm44Gu5aSJ5pu044Gr5a++5b+c44GZ44KL5aC05ZCI44CB44GT44Gu44Oh44K944OD44OJ44KS44Kq44O844OQ44O844Op44Kk44OJ44GX44Gm55yf44KS6L+U44GV44Gt44Gw44Gq44KJ44Gq44GE44CCXG4gICAgICAgICAqIOOBneOBruWgtOWQiCBgX2NoYW5nZVBsYXliYWNrUmF0ZSgpYCDjgoLjgqrjg7zjg5Djg7zjg6njgqTjg4njgZfjgIHlrp/pmpvjga7lho3nlJ/pgJ/luqblpInmm7Tlh6bnkIbjgpLlrp/oo4XjgZfjgarjgZHjgozjgbDjgarjgonjgarjgYTjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog44Gq44GK44GT44GT44Gn44CM5YaN55Sf6YCf5bqm44Gu5aSJ5pu044Gr5a++5b+c44GZ44KL44CN44Gv44CB5Lu75oSP44Gu6YCf5bqm44Gn5a6f6Zqb44Gr5YaN55Sf44Gn44GN44KL44GT44Go44KS5oSP5ZGz44GX44Gq44GE44CCXG4gICAgICAgICAqIOWun+ijheOBr+etieWAjemAnyAo5YaN55Sf6YCf5bqmMS4wKSDjgaflrp/pmpvjgavlho3nlJ/jgafjgY3jgarjgZHjgozjgbDjgarjgonjgarjgYTjgIJcbiAgICAgICAgICog44GX44GL44GX44Gd44KM5Lul5aSW44Gu5YaN55Sf6YCf5bqm44GM5oyH5a6a44GV44KM44Gf5aC05ZCI44CB5a6f6KOF44Gv44G+44KL44Gn6Z+z6YeP44GM44K844Ot44Gn44GC44KL44GL44Gu44KI44GG44Gr5oyv6Iie44Gj44Gm44KC44KI44GE44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBjOWBveOCkui/lOOBmeWgtOWQiOOAgeOCqOODs+OCuOODs+OBr+mfs+WjsOOBrumdnuetieWAjemAn+W6puWGjeeUn+OBq+WvvuOBmeOCi+ODh+ODleOCqeODq+ODiOOBruWHpueQhuOCkuWun+ihjOOBmeOCi+OAglxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgQXVkaW9QbGF5ZXIucHJvdG90eXBlLl9zdXBwb3J0c1BsYXliYWNrUmF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOmfs+mHj+OBruWkieabtOOCkumAmuefpeOBmeOCi+OAglxuICAgICAgICAgKiBAZGVwcmVjYXRlZCDjgZPjga7jg6Hjgr3jg4Pjg4njga/lrp/pqJPnmoTjgavlsI7lhaXjgZXjgozjgZ/jgYzjgIHliKnnlKjjgZXjgozjgabjgYTjgarjgYTjgILlsIbmnaXnmoTjgavliYrpmaTjgZXjgozjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIEF1ZGlvUGxheWVyLnByb3RvdHlwZS5fb25Wb2x1bWVDaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gbm90aGluZyB0byBkb1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gQXVkaW9QbGF5ZXI7XG4gICAgfSgpKTtcbiAgICBnLkF1ZGlvUGxheWVyID0gQXVkaW9QbGF5ZXI7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgdmFyIEF1ZGlvU3lzdGVtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgICAgICBmdW5jdGlvbiBBdWRpb1N5c3RlbShpZCwgZ2FtZSkge1xuICAgICAgICAgICAgdmFyIGF1ZGlvU3lzdGVtTWFuYWdlciA9IGdhbWUuX2F1ZGlvU3lzdGVtTWFuYWdlcjtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG4gICAgICAgICAgICB0aGlzLl92b2x1bWUgPSAxO1xuICAgICAgICAgICAgdGhpcy5fZGVzdHJveVJlcXVlc3RlZEFzc2V0cyA9IHt9O1xuICAgICAgICAgICAgdGhpcy5fbXV0ZWQgPSBhdWRpb1N5c3RlbU1hbmFnZXIuX211dGVkO1xuICAgICAgICAgICAgdGhpcy5fcGxheWJhY2tSYXRlID0gYXVkaW9TeXN0ZW1NYW5hZ2VyLl9wbGF5YmFja1JhdGU7XG4gICAgICAgIH1cbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEF1ZGlvU3lzdGVtLnByb3RvdHlwZSwgXCJ2b2x1bWVcIiwge1xuICAgICAgICAgICAgLy8gdm9sdW1l44Gu5aSJ5pu05pmC44Gr44Gv6YCa55+l44GM5b+F6KaB44Gq44Gu44Gn44Ki44Kv44K744K144KS5L2/44GG44CCXG4gICAgICAgICAgICAvLyDlkbzjgbPlh7rjgZfpoLvluqbjgYzlsJHjgarjgYTjgZ/jgoHoqLHlrrnjgIJcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl92b2x1bWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPCAwIHx8IHZhbHVlID4gMSB8fCBpc05hTih2YWx1ZSkgfHwgdHlwZW9mIHZhbHVlICE9PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJBdWRpb1N5c3RlbSN2b2x1bWU6IGV4cGVjdGVkOiAwLjAtMS4wLCBhY3R1YWw6IFwiICsgdmFsdWUpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3ZvbHVtZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIHRoaXMuX29uVm9sdW1lQ2hhbmdlZCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIEF1ZGlvU3lzdGVtLnByb3RvdHlwZS5yZXF1ZXN0RGVzdHJveSA9IGZ1bmN0aW9uIChhc3NldCkge1xuICAgICAgICAgICAgdGhpcy5fZGVzdHJveVJlcXVlc3RlZEFzc2V0c1thc3NldC5pZF0gPSBhc3NldDtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBBdWRpb1N5c3RlbS5wcm90b3R5cGUuX3Jlc2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5zdG9wQWxsKCk7XG4gICAgICAgICAgICB0aGlzLl92b2x1bWUgPSAxO1xuICAgICAgICAgICAgdGhpcy5fZGVzdHJveVJlcXVlc3RlZEFzc2V0cyA9IHt9O1xuICAgICAgICAgICAgdGhpcy5fbXV0ZWQgPSB0aGlzLmdhbWUuX2F1ZGlvU3lzdGVtTWFuYWdlci5fbXV0ZWQ7XG4gICAgICAgICAgICB0aGlzLl9wbGF5YmFja1JhdGUgPSB0aGlzLmdhbWUuX2F1ZGlvU3lzdGVtTWFuYWdlci5fcGxheWJhY2tSYXRlO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIEF1ZGlvU3lzdGVtLnByb3RvdHlwZS5fc2V0TXV0ZWQgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIHZhciBiZWZvcmUgPSB0aGlzLl9tdXRlZDtcbiAgICAgICAgICAgIHRoaXMuX211dGVkID0gISF2YWx1ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9tdXRlZCAhPT0gYmVmb3JlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb25NdXRlZENoYW5nZWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBBdWRpb1N5c3RlbS5wcm90b3R5cGUuX3NldFBsYXliYWNrUmF0ZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlIDwgMCB8fCBpc05hTih2YWx1ZSkgfHwgdHlwZW9mIHZhbHVlICE9PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkF1ZGlvU3lzdGVtI3BsYXliYWNrUmF0ZTogZXhwZWN0ZWQ6IGdyZWF0ZXIgb3IgZXF1YWwgdG8gMC4wLCBhY3R1YWw6IFwiICsgdmFsdWUpO1xuICAgICAgICAgICAgdmFyIGJlZm9yZSA9IHRoaXMuX3BsYXliYWNrUmF0ZTtcbiAgICAgICAgICAgIHRoaXMuX3BsYXliYWNrUmF0ZSA9IHZhbHVlO1xuICAgICAgICAgICAgaWYgKHRoaXMuX3BsYXliYWNrUmF0ZSAhPT0gYmVmb3JlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb25QbGF5YmFja1JhdGVDaGFuZ2VkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBBdWRpb1N5c3RlbTtcbiAgICB9KCkpO1xuICAgIGcuQXVkaW9TeXN0ZW0gPSBBdWRpb1N5c3RlbTtcbiAgICB2YXIgTXVzaWNBdWRpb1N5c3RlbSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICAgICAgX19leHRlbmRzKE11c2ljQXVkaW9TeXN0ZW0sIF9zdXBlcik7XG4gICAgICAgIGZ1bmN0aW9uIE11c2ljQXVkaW9TeXN0ZW0oaWQsIGdhbWUpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIGlkLCBnYW1lKSB8fCB0aGlzO1xuICAgICAgICAgICAgX3RoaXMuX3BsYXllciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIF90aGlzLl9zdXBwcmVzc2luZ0F1ZGlvID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgICAgICB9XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNdXNpY0F1ZGlvU3lzdGVtLnByb3RvdHlwZSwgXCJwbGF5ZXJcIiwge1xuICAgICAgICAgICAgLy8gTm90ZTog6Z+z5qW944Gu44Gq44GE44Ky44O844Og44Gu5aC05ZCI44Gr54Sh6aeE44Gq44Kk44Oz44K544K/44Oz44K544KS5L2c44KL44Gu44KS6YG/44GR44KL44Gf44KB44CB44Ki44Kv44K744K144KS5L2/44GGXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3BsYXllcikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wbGF5ZXIgPSB0aGlzLmdhbWUucmVzb3VyY2VGYWN0b3J5LmNyZWF0ZUF1ZGlvUGxheWVyKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wbGF5ZXIucGxheWVkLmhhbmRsZSh0aGlzLCB0aGlzLl9vblBsYXllclBsYXllZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3BsYXllci5zdG9wcGVkLmhhbmRsZSh0aGlzLCB0aGlzLl9vblBsYXllclN0b3BwZWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGxheWVyO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wbGF5ZXIgPSB2O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIE11c2ljQXVkaW9TeXN0ZW0ucHJvdG90eXBlLmZpbmRQbGF5ZXJzID0gZnVuY3Rpb24gKGFzc2V0KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wbGF5ZXIuY3VycmVudEF1ZGlvICYmIHRoaXMucGxheWVyLmN1cnJlbnRBdWRpby5pZCA9PT0gYXNzZXQuaWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuIFt0aGlzLnBsYXllcl07XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH07XG4gICAgICAgIE11c2ljQXVkaW9TeXN0ZW0ucHJvdG90eXBlLmNyZWF0ZVBsYXllciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBsYXllcjtcbiAgICAgICAgfTtcbiAgICAgICAgTXVzaWNBdWRpb1N5c3RlbS5wcm90b3R5cGUuc3RvcEFsbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5fcGxheWVyKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHRoaXMuX3BsYXllci5zdG9wKCk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgTXVzaWNBdWRpb1N5c3RlbS5wcm90b3R5cGUuX3Jlc2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5fcmVzZXQuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9wbGF5ZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wbGF5ZXIucGxheWVkLnJlbW92ZSh7IG93bmVyOiB0aGlzLCBmdW5jOiB0aGlzLl9vblBsYXllclBsYXllZCB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wbGF5ZXIuc3RvcHBlZC5yZW1vdmUoeyBvd25lcjogdGhpcywgZnVuYzogdGhpcy5fb25QbGF5ZXJTdG9wcGVkIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fcGxheWVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fc3VwcHJlc3NpbmdBdWRpbyA9IHVuZGVmaW5lZDtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBNdXNpY0F1ZGlvU3lzdGVtLnByb3RvdHlwZS5fb25Wb2x1bWVDaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuY2hhbmdlVm9sdW1lKHRoaXMuX3ZvbHVtZSk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgTXVzaWNBdWRpb1N5c3RlbS5wcm90b3R5cGUuX29uTXV0ZWRDaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuX2NoYW5nZU11dGVkKHRoaXMuX211dGVkKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBNdXNpY0F1ZGlvU3lzdGVtLnByb3RvdHlwZS5fb25QbGF5YmFja1JhdGVDaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHBsYXllciA9IHRoaXMucGxheWVyO1xuICAgICAgICAgICAgcGxheWVyLl9jaGFuZ2VQbGF5YmFja1JhdGUodGhpcy5fcGxheWJhY2tSYXRlKTtcbiAgICAgICAgICAgIGlmICghcGxheWVyLl9zdXBwb3J0c1BsYXliYWNrUmF0ZSgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb25VbnN1cHBvcnRlZFBsYXliYWNrUmF0ZUNoYW5nZWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBNdXNpY0F1ZGlvU3lzdGVtLnByb3RvdHlwZS5fb25VbnN1cHBvcnRlZFBsYXliYWNrUmF0ZUNoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyDlho3nlJ/pgJ/luqbpnZ7lr77lv5zjga7loLTlkIjjga7jg5Xjgqnjg7zjg6vjg5Djg4Pjgq86IOmztOOCieOBneOBhuOBqOOBl+OBpuODn+ODpeODvOODiOOBl+OBpuOBhOOBn+mfs+OBjOOBguOCjOOBsOmztOOCieOBl+ebtOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuX3BsYXliYWNrUmF0ZSA9PT0gMS4wKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3N1cHByZXNzaW5nQXVkaW8pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGF1ZGlvID0gdGhpcy5fc3VwcHJlc3NpbmdBdWRpbztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3VwcHJlc3NpbmdBdWRpbyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhdWRpby5kZXN0cm95ZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIuX2NoYW5nZU11dGVkKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBNdXNpY0F1ZGlvU3lzdGVtLnByb3RvdHlwZS5fb25QbGF5ZXJQbGF5ZWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgKGUucGxheWVyICE9PSB0aGlzLl9wbGF5ZXIpXG4gICAgICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiTXVzaWNBdWRpb1N5c3RlbSNfb25QbGF5ZXJQbGF5ZWQ6IHVuZXhwZWN0ZWQgYXVkaW8gcGxheWVyXCIpO1xuICAgICAgICAgICAgaWYgKGUucGxheWVyLl9zdXBwb3J0c1BsYXliYWNrUmF0ZSgpKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIC8vIOWGjeeUn+mAn+W6pumdnuWvvuW/nOOBruWgtOWQiOOBruODleOCqeODvOODq+ODkOODg+OCrzog6bO044KJ44GV44Ga5Y2z44Of44Ol44O844OI44Gr44GZ44KLXG4gICAgICAgICAgICBpZiAodGhpcy5fcGxheWJhY2tSYXRlICE9PSAxLjApIHtcbiAgICAgICAgICAgICAgICBlLnBsYXllci5fY2hhbmdlTXV0ZWQodHJ1ZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3VwcHJlc3NpbmdBdWRpbyA9IGUuYXVkaW87XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgTXVzaWNBdWRpb1N5c3RlbS5wcm90b3R5cGUuX29uUGxheWVyU3RvcHBlZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fc3VwcHJlc3NpbmdBdWRpbykge1xuICAgICAgICAgICAgICAgIHRoaXMuX3N1cHByZXNzaW5nQXVkaW8gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIuX2NoYW5nZU11dGVkKGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLl9kZXN0cm95UmVxdWVzdGVkQXNzZXRzW2UuYXVkaW8uaWRdKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2Rlc3Ryb3lSZXF1ZXN0ZWRBc3NldHNbZS5hdWRpby5pZF07XG4gICAgICAgICAgICAgICAgZS5hdWRpby5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBNdXNpY0F1ZGlvU3lzdGVtO1xuICAgIH0oQXVkaW9TeXN0ZW0pKTtcbiAgICBnLk11c2ljQXVkaW9TeXN0ZW0gPSBNdXNpY0F1ZGlvU3lzdGVtO1xuICAgIHZhciBTb3VuZEF1ZGlvU3lzdGVtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoU291bmRBdWRpb1N5c3RlbSwgX3N1cGVyKTtcbiAgICAgICAgZnVuY3Rpb24gU291bmRBdWRpb1N5c3RlbShpZCwgZ2FtZSkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgaWQsIGdhbWUpIHx8IHRoaXM7XG4gICAgICAgICAgICBfdGhpcy5wbGF5ZXJzID0gW107XG4gICAgICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgICAgIH1cbiAgICAgICAgU291bmRBdWRpb1N5c3RlbS5wcm90b3R5cGUuY3JlYXRlUGxheWVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHBsYXllciA9IHRoaXMuZ2FtZS5yZXNvdXJjZUZhY3RvcnkuY3JlYXRlQXVkaW9QbGF5ZXIodGhpcyk7XG4gICAgICAgICAgICBpZiAocGxheWVyLmNhbkhhbmRsZVN0b3BwZWQoKSlcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllcnMucHVzaChwbGF5ZXIpO1xuICAgICAgICAgICAgcGxheWVyLnBsYXllZC5oYW5kbGUodGhpcywgdGhpcy5fb25QbGF5ZXJQbGF5ZWQpO1xuICAgICAgICAgICAgcGxheWVyLnN0b3BwZWQuaGFuZGxlKHRoaXMsIHRoaXMuX29uUGxheWVyU3RvcHBlZCk7XG4gICAgICAgICAgICByZXR1cm4gcGxheWVyO1xuICAgICAgICB9O1xuICAgICAgICBTb3VuZEF1ZGlvU3lzdGVtLnByb3RvdHlwZS5maW5kUGxheWVycyA9IGZ1bmN0aW9uIChhc3NldCkge1xuICAgICAgICAgICAgdmFyIHJldCA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXllcnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wbGF5ZXJzW2ldLmN1cnJlbnRBdWRpbyAmJiB0aGlzLnBsYXllcnNbaV0uY3VycmVudEF1ZGlvLmlkID09PSBhc3NldC5pZClcbiAgICAgICAgICAgICAgICAgICAgcmV0LnB1c2godGhpcy5wbGF5ZXJzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgIH07XG4gICAgICAgIFNvdW5kQXVkaW9TeXN0ZW0ucHJvdG90eXBlLnN0b3BBbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcGxheWVycyA9IHRoaXMucGxheWVycy5jb25jYXQoKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGxheWVycy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIHBsYXllcnNbaV0uc3RvcCgpOyAvLyBhdXRvIHJlbW92ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIFNvdW5kQXVkaW9TeXN0ZW0ucHJvdG90eXBlLl9yZXNldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF9zdXBlci5wcm90b3R5cGUuX3Jlc2V0LmNhbGwodGhpcyk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWVycy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBsYXllcnNbaV07XG4gICAgICAgICAgICAgICAgcGxheWVyLnBsYXllZC5yZW1vdmUoeyBvd25lcjogdGhpcywgZnVuYzogdGhpcy5fb25QbGF5ZXJQbGF5ZWQgfSk7XG4gICAgICAgICAgICAgICAgcGxheWVyLnN0b3BwZWQucmVtb3ZlKHsgb3duZXI6IHRoaXMsIGZ1bmM6IHRoaXMuX29uUGxheWVyU3RvcHBlZCB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucGxheWVycyA9IFtdO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIFNvdW5kQXVkaW9TeXN0ZW0ucHJvdG90eXBlLl9vbk11dGVkQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBwbGF5ZXJzID0gdGhpcy5wbGF5ZXJzO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwbGF5ZXJzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgcGxheWVyc1tpXS5fY2hhbmdlTXV0ZWQodGhpcy5fbXV0ZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIFNvdW5kQXVkaW9TeXN0ZW0ucHJvdG90eXBlLl9vblBsYXliYWNrUmF0ZUNoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcGxheWVycyA9IHRoaXMucGxheWVycztcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGxheWVycy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIHBsYXllcnNbaV0uX2NoYW5nZVBsYXliYWNrUmF0ZSh0aGlzLl9wbGF5YmFja1JhdGUpO1xuICAgICAgICAgICAgICAgIC8vIOWGjeeUn+mAn+W6pumdnuWvvuW/nOOBruWgtOWQiOOBruODleOCqeODvOODq+ODkOODg+OCrzog5Y2z5q2i44KB44KLXG4gICAgICAgICAgICAgICAgaWYgKCFwbGF5ZXJzW2ldLl9zdXBwb3J0c1BsYXliYWNrUmF0ZSgpICYmIHRoaXMuX3BsYXliYWNrUmF0ZSAhPT0gMS4wKSB7XG4gICAgICAgICAgICAgICAgICAgIHBsYXllcnNbaV0uc3RvcCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBTb3VuZEF1ZGlvU3lzdGVtLnByb3RvdHlwZS5fb25QbGF5ZXJQbGF5ZWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgKGUucGxheWVyLl9zdXBwb3J0c1BsYXliYWNrUmF0ZSgpKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIC8vIOWGjeeUn+mAn+W6pumdnuWvvuW/nOOBruWgtOWQiOOBruODleOCqeODvOODq+ODkOODg+OCrzog6bO044KJ44GV44Ga5Y2z5q2i44KB44KLXG4gICAgICAgICAgICBpZiAodGhpcy5fcGxheWJhY2tSYXRlICE9PSAxLjApIHtcbiAgICAgICAgICAgICAgICBlLnBsYXllci5zdG9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgU291bmRBdWRpb1N5c3RlbS5wcm90b3R5cGUuX29uUGxheWVyU3RvcHBlZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICB2YXIgaW5kZXggPSB0aGlzLnBsYXllcnMuaW5kZXhPZihlLnBsYXllcik7XG4gICAgICAgICAgICBpZiAoaW5kZXggPCAwKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGUucGxheWVyLnN0b3BwZWQucmVtb3ZlKHsgb3duZXI6IHRoaXMsIGZ1bmM6IHRoaXMuX29uUGxheWVyU3RvcHBlZCB9KTtcbiAgICAgICAgICAgIHRoaXMucGxheWVycy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2Rlc3Ryb3lSZXF1ZXN0ZWRBc3NldHNbZS5hdWRpby5pZF0pIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fZGVzdHJveVJlcXVlc3RlZEFzc2V0c1tlLmF1ZGlvLmlkXTtcbiAgICAgICAgICAgICAgICBlLmF1ZGlvLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBTb3VuZEF1ZGlvU3lzdGVtLnByb3RvdHlwZS5fb25Wb2x1bWVDaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXllcnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllcnNbaV0uY2hhbmdlVm9sdW1lKHRoaXMuX3ZvbHVtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBTb3VuZEF1ZGlvU3lzdGVtO1xuICAgIH0oQXVkaW9TeXN0ZW0pKTtcbiAgICBnLlNvdW5kQXVkaW9TeXN0ZW0gPSBTb3VuZEF1ZGlvU3lzdGVtO1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIC8qKlxuICAgICAqIOODk+ODh+OCquWGjeeUn+OCkuihjOOBhuOCr+ODqeOCueOAglxuICAgICAqXG4gICAgICog44Ky44O844Og6ZaL55m66ICF44Gv5pys44Kv44Op44K544Gu44Kk44Oz44K544K/44Oz44K544KS55u05o6l55Sf5oiQ44GZ44G544GN44Gn44Gv44Gq44GE44CCXG4gICAgICovXG4gICAgdmFyIFZpZGVvUGxheWVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogYFZpZGVvUGxheWVyYCDjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLnlJ/miJDjgZnjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIFZpZGVvUGxheWVyKGxvb3ApIHtcbiAgICAgICAgICAgIHRoaXMuX2xvb3AgPSAhIWxvb3A7XG4gICAgICAgICAgICB0aGlzLnBsYXllZCA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgICAgIHRoaXMuc3RvcHBlZCA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFZpZGVvID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy52b2x1bWUgPSAxLjA7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGBWaWRlb0Fzc2V0YCDjgpLlho3nlJ/jgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog5YaN55Sf5b6M44CBIGB0aGlzLnBsYXllZGAg44GMZmlyZeOBleOCjOOCi+OAglxuICAgICAgICAgKiBAcGFyYW0gVmlkZW8g5YaN55Sf44GZ44KL44OT44OH44Kq44Ki44K744OD44OIXG4gICAgICAgICAqL1xuICAgICAgICBWaWRlb1BsYXllci5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uICh2aWRlb0Fzc2V0KSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRWaWRlbyA9IHZpZGVvQXNzZXQ7XG4gICAgICAgICAgICB0aGlzLnBsYXllZC5maXJlKHtcbiAgICAgICAgICAgICAgICBwbGF5ZXI6IHRoaXMsXG4gICAgICAgICAgICAgICAgdmlkZW86IHZpZGVvQXNzZXRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmlkZW9Bc3NldC5hc1N1cmZhY2UoKS5hbmltYXRpbmdTdGFydGVkLmZpcmUoKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOWGjeeUn+OCkuWBnOatouOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDlho3nlJ/kuK3jgafjgarjgYTloLTlkIjjgIHkvZXjgoLjgZfjgarjgYTjgIJcbiAgICAgICAgICog5YGc5q2i5b6M44CBIGB0aGlzLnN0b3BwZWRgIOOBjGZpcmXjgZXjgozjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIFZpZGVvUGxheWVyLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHZpZGVvQXNzZXQgPSB0aGlzLmN1cnJlbnRWaWRlbztcbiAgICAgICAgICAgIHRoaXMuc3RvcHBlZC5maXJlKHtcbiAgICAgICAgICAgICAgICBwbGF5ZXI6IHRoaXMsXG4gICAgICAgICAgICAgICAgdmlkZW86IHZpZGVvQXNzZXRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmlkZW9Bc3NldC5hc1N1cmZhY2UoKS5hbmltYXRpbmdTdG9wcGVkLmZpcmUoKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOmfs+mHj+OCkuWkieabtOOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgqjjg7Pjgrjjg7Pjg6bjg7zjgrbjgYwgYFZpZGVvUGxheWVyYCDjga7mtL7nlJ/jgq/jg6njgrnjgpLlrp/oo4XjgZnjgovloLTlkIjjga/jgIFcbiAgICAgICAgICogIOOBk+OBruODoeOCveODg+ODieOCkuOCquODvOODkOODvOODqeOCpOODieOBl+OBpuWun+mam+OBq+mfs+mHj+OCkuWkieabtOOBmeOCi+WHpueQhuOCkuihjOOBhuOBk+OBqOOAglxuICAgICAgICAgKiAg44Kq44O844OQ44O844Op44Kk44OJ5YWI44Gu44Oh44K944OD44OJ44Gv44GT44Gu44Oh44K944OD44OJ44KS5ZG844Gz44Gg44GV44Gq44GR44KM44Gw44Gq44KJ44Gq44GE44CCXG4gICAgICAgICAqIEBwYXJhbSB2b2x1bWUg6Z+z6YeP44CCMOS7peS4ijEuMOS7peS4i+OBp+OBquOBkeOCjOOBsOOBquOCieOBquOBhFxuICAgICAgICAgKi9cbiAgICAgICAgVmlkZW9QbGF5ZXIucHJvdG90eXBlLmNoYW5nZVZvbHVtZSA9IGZ1bmN0aW9uICh2b2x1bWUpIHtcbiAgICAgICAgICAgIHRoaXMudm9sdW1lID0gdm9sdW1lO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gVmlkZW9QbGF5ZXI7XG4gICAgfSgpKTtcbiAgICBnLlZpZGVvUGxheWVyID0gVmlkZW9QbGF5ZXI7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLy8g5bCG5p2lIFZpZGVvUGxheWVy44Kk44Oz44K544K/44Oz44K544Gu5LiA5YWD566h55CG77yI44Oc44Oq44Ol44O844Og6Kit5a6a44Gq44GpQXVkaW9TeXN0ZW3jgajkvLzjgZ/lvbnlibLvvIlcbiAgICAvLyDjgpLmi4XjgYbjgq/jg6njgrnjgIJWaWRlb0Fzc2V044GvVmlkZW9TeXN0ZW3jgpLmjIHjgaTjgajjgYTjgYbkvZPoo4HjgpLmlbTjgYjjgovjgZ/jgoHjgaso5Lit6Lqr44GM56m644Gn44GC44KL44GMKVxuICAgIC8vIOWumue+qeOBleOCjOOBpuOBhOOCi+OAglxuICAgIC8vIFRPRE86IOWun+ijhVxuICAgIHZhciBWaWRlb1N5c3RlbSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gVmlkZW9TeXN0ZW0oKSB7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFZpZGVvU3lzdGVtO1xuICAgIH0oKSk7XG4gICAgZy5WaWRlb1N5c3RlbSA9IFZpZGVvU3lzdGVtO1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIC8qKlxuICAgICAqIOS6jOasoeWFg+OBruW5vuS9leeahOOCquODluOCuOOCp+OCr+ODiOOAguS9jee9ruOBqOOCteOCpOOCuiAo44Gr5Yqg44GI44Gm5YK+44GN44KE6YCP5piO5bqm44KCKSDjgpLmjIHjgaTjgIJcbiAgICAgKiDjgrLjg7zjg6DplovnmbrogIXjga8gYEVgIOOCkuS9v+OBiOOBsOOCiOOBj+OAgemAmuW4uOOBk+OBruOCr+ODqeOCueOCkuaEj+itmOOBmeOCi+W/heimgeOBr+OBquOBhOOAglxuICAgICAqL1xuICAgIHZhciBPYmplY3QyRCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gT2JqZWN0MkQocGFyYW0pIHtcbiAgICAgICAgICAgIGlmICghcGFyYW0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnggPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMueSA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy53aWR0aCA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMub3BhY2l0eSA9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAxO1xuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVZID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLmFuZ2xlID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBvc2l0ZU9wZXJhdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB0aGlzLmFuY2hvclggPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5hbmNob3JZID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHRoaXMuX21hdHJpeCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMueCA9IHBhcmFtLnggfHwgMDtcbiAgICAgICAgICAgICAgICB0aGlzLnkgPSBwYXJhbS55IHx8IDA7XG4gICAgICAgICAgICAgICAgdGhpcy53aWR0aCA9IHBhcmFtLndpZHRoIHx8IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSBwYXJhbS5oZWlnaHQgfHwgMDtcbiAgICAgICAgICAgICAgICB0aGlzLm9wYWNpdHkgPSBcIm9wYWNpdHlcIiBpbiBwYXJhbSA/IHBhcmFtLm9wYWNpdHkgOiAxO1xuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gXCJzY2FsZVhcIiBpbiBwYXJhbSA/IHBhcmFtLnNjYWxlWCA6IDE7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FsZVkgPSBcInNjYWxlWVwiIGluIHBhcmFtID8gcGFyYW0uc2NhbGVZIDogMTtcbiAgICAgICAgICAgICAgICB0aGlzLmFuZ2xlID0gcGFyYW0uYW5nbGUgfHwgMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBvc2l0ZU9wZXJhdGlvbiA9IHBhcmFtLmNvbXBvc2l0ZU9wZXJhdGlvbjtcbiAgICAgICAgICAgICAgICB0aGlzLmFuY2hvclggPSBwYXJhbS5hbmNob3JYO1xuICAgICAgICAgICAgICAgIHRoaXMuYW5jaG9yWSA9IHBhcmFtLmFuY2hvclk7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWF0cml4ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIE9iamVjdDJELnByb3RvdHlwZS5tb3ZlVG8gPSBmdW5jdGlvbiAocG9zT3JYLCB5KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBvc09yWCA9PT0gXCJudW1iZXJcIiAmJiB0eXBlb2YgeSAhPT0gXCJudW1iZXJcIikge1xuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIk9iamVjdDJEI21vdmVUbzogYXJndW1lbnRzIG11c3QgYmUgQ29tbW9uT2Zmc2V0IG9yIHBhaXIgb2YgeCBhbmQgeSBhcyBhIG51bWJlci5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBvc09yWCA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICAgICAgICAgIHRoaXMueCA9IHBvc09yWDtcbiAgICAgICAgICAgICAgICB0aGlzLnkgPSB5O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy54ID0gcG9zT3JYLng7XG4gICAgICAgICAgICAgICAgdGhpcy55ID0gcG9zT3JYLnk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgqrjg5bjgrjjgqfjgq/jg4jjgpLnm7jlr77nmoTjgavnp7vli5XjgZnjgovjgIJcbiAgICAgICAgICog44GT44Gu44Oh44K944OD44OJ44GvIGB4YCDjgaggYHlgIOOCkuWQjOaZguOBq+WKoOeul+OBmeOCi+OBn+OCgeOBruODpuODvOODhuOCo+ODquODhuOCo+ODoeOCveODg+ODieOBp+OBguOCi+OAglxuICAgICAgICAgKiBgRWAg44KEIGBDYW1lcmEyRGAg44Gr44GK44GE44Gm44GT44Gu44Oh44K944OD44OJ44KS5ZG844Gz5Ye644GX44Gf5aC05ZCI44CBIGBtb2RpZmllZCgpYCDjgpLlkbzjgbPlh7rjgZnlv4XopoHjgYzjgYLjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHggWOW6p+aomeOBq+WKoOeul+OBmeOCi+WApFxuICAgICAgICAgKiBAcGFyYW0geSBZ5bqn5qiZ44Gr5Yqg566X44GZ44KL5YCkXG4gICAgICAgICAqL1xuICAgICAgICBPYmplY3QyRC5wcm90b3R5cGUubW92ZUJ5ID0gZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAgICAgICAgIHRoaXMueCArPSB4O1xuICAgICAgICAgICAgdGhpcy55ICs9IHk7XG4gICAgICAgIH07XG4gICAgICAgIE9iamVjdDJELnByb3RvdHlwZS5yZXNpemVUbyA9IGZ1bmN0aW9uIChzaXplT3JXaWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHNpemVPcldpZHRoID09PSBcIm51bWJlclwiICYmIHR5cGVvZiBoZWlnaHQgIT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJPYmplY3QyRCNyZXNpemVUbzogYXJndW1lbnRzIG11c3QgYmUgQ29tbW9uU2l6ZSBvciBwYWlyIG9mIHdpZHRoIGFuZCBoZWlnaHQgYXMgYSBudW1iZXIuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzaXplT3JXaWR0aCA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICAgICAgICAgIHRoaXMud2lkdGggPSBzaXplT3JXaWR0aDtcbiAgICAgICAgICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMud2lkdGggPSBzaXplT3JXaWR0aC53aWR0aDtcbiAgICAgICAgICAgICAgICB0aGlzLmhlaWdodCA9IHNpemVPcldpZHRoLmhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOCquODluOCuOOCp+OCr+ODiOOBruOCteOCpOOCuuOCkuebuOWvvueahOOBq+WkieabtOOBmeOCi+OAglxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga8gYHdpZHRoYCDjgaggYGhlaWdodGAg44KS5ZCM5pmC44Gr5Yqg566X44GZ44KL44Gf44KB44Gu44Om44O844OG44Kj44Oq44OG44Kj44Oh44K944OD44OJ44Gn44GC44KL44CCXG4gICAgICAgICAqIGBFYCDjgoQgYENhbWVyYTJEYCDjgavjgYrjgYTjgabjgZPjga7jg6Hjgr3jg4Pjg4njgpLlkbzjgbPlh7rjgZfjgZ/loLTlkIjjgIEgYG1vZGlmaWVkKClgIOOCkuWRvOOBs+WHuuOBmeW/heimgeOBjOOBguOCi+OAglxuICAgICAgICAgKiBAcGFyYW0gd2lkdGgg5Yqg566X44GZ44KL5bmFXG4gICAgICAgICAqIEBwYXJhbSBoZWlnaHQg5Yqg566X44GZ44KL6auY44GVXG4gICAgICAgICAqL1xuICAgICAgICBPYmplY3QyRC5wcm90b3R5cGUucmVzaXplQnkgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCkge1xuICAgICAgICAgICAgdGhpcy53aWR0aCArPSB3aWR0aDtcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0ICs9IGhlaWdodDtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOCquODluOCuOOCp+OCr+ODiOOBruaLoeWkp+eOh+OCkuioreWumuOBmeOCi+OAglxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga8gYHNjYWxlWGAg44GoIGBzY2FsZVlgIOOBq+WQjOOBmOWApOOCkuWQjOaZguOBq+ioreWumuOBmeOCi+OBn+OCgeOBruODpuODvOODhuOCo+ODquODhuOCo+ODoeOCveODg+ODieOBp+OBguOCi+OAglxuICAgICAgICAgKiBgRWAg44KEIGBDYW1lcmEyRGAg44Gr44GK44GE44Gm44GT44Gu44Oh44K944OD44OJ44KS5ZG844Gz5Ye644GX44Gf5aC05ZCI44CBIGBtb2RpZmllZCgpYCDjgpLlkbzjgbPlh7rjgZnlv4XopoHjgYzjgYLjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHNjYWxlIOaLoeWkp+eOh1xuICAgICAgICAgKi9cbiAgICAgICAgT2JqZWN0MkQucHJvdG90eXBlLnNjYWxlID0gZnVuY3Rpb24gKHNjYWxlKSB7XG4gICAgICAgICAgICB0aGlzLnNjYWxlWCA9IHNjYWxlO1xuICAgICAgICAgICAgdGhpcy5zY2FsZVkgPSBzY2FsZTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOCquODluOCuOOCp+OCr+ODiOOBruOCouODs+OCq+ODvOOBruS9jee9ruOCkuioreWumuOBmeOCi+OAglxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga8gYGFuY2hvclhgIOOBqCBgYW5jaG9yWWAg44KS5ZCM5pmC44Gr6Kit5a6a44GZ44KL44Gf44KB44Gu44Om44O844OG44Kj44Oq44OG44Kj44Oh44K944OD44OJ44Gn44GC44KL44CCXG4gICAgICAgICAqIGBFYCDjgoQgYENhbWVyYTJEYCDjgavjgYrjgYTjgabjgZPjga7jg6Hjgr3jg4Pjg4njgpLlkbzjgbPlh7rjgZfjgZ/loLTlkIjjgIEgYG1vZGlmaWVkKClgIOOCkuWRvOOBs+WHuuOBmeW/heimgeOBjOOBguOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgT2JqZWN0MkQucHJvdG90eXBlLmFuY2hvciA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgICAgICB0aGlzLmFuY2hvclggPSB4O1xuICAgICAgICAgICAgdGhpcy5hbmNob3JZID0geTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBruOCquODluOCuOOCp+OCr+ODiOOBruWkieaPm+ihjOWIl+OCkuW+l+OCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgT2JqZWN0MkQucHJvdG90eXBlLmdldE1hdHJpeCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5fbWF0cml4KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWF0cml4ID0gZy5VdGlsLmNyZWF0ZU1hdHJpeCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIXRoaXMuX21hdHJpeC5fbW9kaWZpZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWF0cml4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fdXBkYXRlTWF0cml4KCk7XG4gICAgICAgICAgICB0aGlzLl9tYXRyaXguX21vZGlmaWVkID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbWF0cml4O1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog5YWs6ZaL44Gu44OX44Ot44OR44OG44Kj44GL44KJ5YaF6YOo44Gu5aSJ5o+b6KGM5YiX44Kt44Oj44OD44K344Ol44KS5pu05paw44GZ44KL44CCXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBPYmplY3QyRC5wcm90b3R5cGUuX3VwZGF0ZU1hdHJpeCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmFuY2hvclggIT0gbnVsbCAmJiB0aGlzLmFuY2hvclkgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX21hdHJpeC51cGRhdGVXaXRoQW5jaG9yKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLnNjYWxlWCwgdGhpcy5zY2FsZVksIHRoaXMuYW5nbGUsIHRoaXMueCwgdGhpcy55LCB0aGlzLmFuY2hvclgsIHRoaXMuYW5jaG9yWSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmFuZ2xlIHx8IHRoaXMuc2NhbGVYICE9PSAxIHx8IHRoaXMuc2NhbGVZICE9PSAxKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWF0cml4LnVwZGF0ZSh0aGlzLndpZHRoLCB0aGlzLmhlaWdodCwgdGhpcy5zY2FsZVgsIHRoaXMuc2NhbGVZLCB0aGlzLmFuZ2xlLCB0aGlzLngsIHRoaXMueSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tYXRyaXgucmVzZXQodGhpcy54LCB0aGlzLnkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gT2JqZWN0MkQ7XG4gICAgfSgpKTtcbiAgICBnLk9iamVjdDJEID0gT2JqZWN0MkQ7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICogYWthc2hpYy1lbmdpbmXjgavmj4/nlLvjgZXjgozjgovlhajjgabjga7jgqjjg7Pjg4bjgqPjg4bjgqPjgpLooajjgZnln7rlupXjgq/jg6njgrnjgIJcbiAgICAgKiDmnKzjgq/jg6njgrnljZjkvZPjgavmj4/nlLvlh6bnkIbjgavjga/jgarjgY/jgIHnm7TmjqXliKnnlKjjgZnjgovloLTlkIjjga9jaGlsZHJlbuOCkuWIqeeUqOOBl+OBn+OCs+ODs+ODhuODiuOBqOOBl+OBpueoi+W6puOBp+WIqeeUqOOBleOCjOOCi+OAglxuICAgICAqL1xuICAgIHZhciBFID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoRSwgX3N1cGVyKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOWQhOeoruODkeODqeODoeODvOOCv+OCkuaMh+WumuOBl+OBpiBgRWAg44Gu44Kk44Oz44K544K/44Oz44K544KS55Sf5oiQ44GZ44KL44CCXG4gICAgICAgICAqIEBwYXJhbSBwYXJhbSDliJ3mnJ/ljJbjgavnlKjjgYTjgovjg5Hjg6njg6Hjg7zjgr/jga7jgqrjg5bjgrjjgqfjgq/jg4hcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIEUocGFyYW0pIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHBhcmFtKSB8fCB0aGlzO1xuICAgICAgICAgICAgX3RoaXMuY2hpbGRyZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBfdGhpcy5wYXJlbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBfdGhpcy5fdG91Y2hhYmxlID0gZmFsc2U7XG4gICAgICAgICAgICBfdGhpcy5zdGF0ZSA9IDAgLyogTm9uZSAqLztcbiAgICAgICAgICAgIF90aGlzLl9oYXNUb3VjaGFibGVDaGlsZHJlbiA9IGZhbHNlO1xuICAgICAgICAgICAgX3RoaXMuX3VwZGF0ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIF90aGlzLl9tZXNzYWdlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgX3RoaXMuX3BvaW50RG93biA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIF90aGlzLl9wb2ludE1vdmUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBfdGhpcy5fcG9pbnRVcCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIF90aGlzLl90YXJnZXRDYW1lcmFzID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgX3RoaXMudGFnID0gcGFyYW0udGFnO1xuICAgICAgICAgICAgX3RoaXMuc2hhZGVyUHJvZ3JhbSA9IHBhcmFtLnNoYWRlclByb2dyYW07XG4gICAgICAgICAgICAvLyBsb2NhbCDjga8gU2NlbmUjcmVnaXN0ZXIoKSDjgoQgdGhpcy5hcHBlbmQoKSDjga7lkbzjgbPlh7rjgZfjgojjgorjgoLlhYjjgavnq4vjgabjgarjgZHjgozjgbDjgarjgonjgarjgYRcbiAgICAgICAgICAgIC8vIOODreODvOOCq+ODq+OCt+ODvOODs+ODu+ODreODvOOCq+ODq+ODhuOCo+ODg+OCr+ijnOmWk+OCt+ODvOODs+OBruOCqOODs+ODhuOCo+ODhuOCo+OBr+W8t+WItueahOOBqyBsb2NhbCAo44Ot44O844Kr44Or44OG44Kj44OD44Kv44GM5p2l44Gm5LuW44OX44Os44Kk44Ok44O844Go44Ga44KM44KL5Y+v6IO95oCn44GM44GC44KLKVxuICAgICAgICAgICAgX3RoaXMubG9jYWwgPSAocGFyYW0uc2NlbmUubG9jYWwgIT09IGcuTG9jYWxUaWNrTW9kZS5Ob25Mb2NhbCkgfHwgISFwYXJhbS5sb2NhbDtcbiAgICAgICAgICAgIGlmIChwYXJhbS5jaGlsZHJlbikge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFyYW0uY2hpbGRyZW4ubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmFwcGVuZChwYXJhbS5jaGlsZHJlbltpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGFyYW0ucGFyZW50KSB7XG4gICAgICAgICAgICAgICAgcGFyYW0ucGFyZW50LmFwcGVuZChfdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGFyYW0udGFyZ2V0Q2FtZXJhcylcbiAgICAgICAgICAgICAgICBfdGhpcy50YXJnZXRDYW1lcmFzID0gcGFyYW0udGFyZ2V0Q2FtZXJhcztcbiAgICAgICAgICAgIGlmIChcInRvdWNoYWJsZVwiIGluIHBhcmFtKVxuICAgICAgICAgICAgICAgIF90aGlzLnRvdWNoYWJsZSA9IHBhcmFtLnRvdWNoYWJsZTtcbiAgICAgICAgICAgIGlmICghIXBhcmFtLmhpZGRlbilcbiAgICAgICAgICAgICAgICBfdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICAvLyBzZXQgaWQsIHNjZW5lXG4gICAgICAgICAgICBfdGhpcy5pZCA9IHBhcmFtLmlkO1xuICAgICAgICAgICAgcGFyYW0uc2NlbmUucmVnaXN0ZXIoX3RoaXMpO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgICAgICB9XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShFLnByb3RvdHlwZSwgXCJ1cGRhdGVcIiwge1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiDmmYLplpPntYzpgY7jgqTjg5njg7Pjg4jjgILmnKzjgqTjg5njg7Pjg4jjga7kuIDluqbjga5maXJl44Gr44Gk44GN44CB5bi444GrMeODleODrOODvOODoOWIhuOBruaZgumWk+e1jOmBjuOBjOi1t+OBk+OCi+OAglxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAvLyBF44Gu55Sf5oiQ44Kz44K544OI5L2O5rib44KS6ICD5oWu44GX44CB5Y+C54Wn44GV44KM44Gf5pmC44Gu44G/55Sf5oiQ5Ye65p2l44KL44KI44GG44Ki44Kv44K744K144KS5L2/44GGXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3VwZGF0ZSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlID0gbmV3IGcuQ2hhaW5UcmlnZ2VyKHRoaXMuc2NlbmUudXBkYXRlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShFLnByb3RvdHlwZSwgXCJtZXNzYWdlXCIsIHtcbiAgICAgICAgICAgIC8vIHVwZGF0ZeOBr+S7o+WFpeOBmeOCi+W/heimgeOBjOOBquOBhOOBruOBp3NldHRlcuOCkuWumue+qeOBl+OBquOBhFxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPjga5tZXNzYWdl44Kk44OZ44Oz44OI44CCXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIC8vIEXjga7nlJ/miJDjgrPjgrnjg4jkvY7muJvjgpLogIPmha7jgZfjgIHlj4LnhafjgZXjgozjgZ/mmYLjga7jgb/nlJ/miJDlh7rmnaXjgovjgojjgYbjgqLjgq/jgrvjgrXjgpLkvb/jgYZcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fbWVzc2FnZSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWVzc2FnZSA9IG5ldyBnLkNoYWluVHJpZ2dlcih0aGlzLnNjZW5lLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tZXNzYWdlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShFLnByb3RvdHlwZSwgXCJwb2ludERvd25cIiwge1xuICAgICAgICAgICAgLy8gbWVzc2FnZeOBr+S7o+WFpeOBmeOCi+W/heimgeOBjOOBquOBhOOBruOBp3NldHRlcuOCkuWumue+qeOBl+OBquOBhFxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPjga5wb2ludCBkb3du44Kk44OZ44Oz44OI44CCXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIC8vIEXjga7nlJ/miJDjgrPjgrnjg4jkvY7muJvjgpLogIPmha7jgZfjgIHlj4LnhafjgZXjgozjgZ/mmYLjga7jgb/nlJ/miJDlh7rmnaXjgovjgojjgYbjgqLjgq/jgrvjgrXjgpLkvb/jgYZcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fcG9pbnREb3duKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wb2ludERvd24gPSBuZXcgZy5DaGFpblRyaWdnZXIodGhpcy5zY2VuZS5wb2ludERvd25DYXB0dXJlLCB0aGlzLl9pc1RhcmdldE9wZXJhdGlvbiwgdGhpcyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BvaW50RG93bjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoRS5wcm90b3R5cGUsIFwicG9pbnRVcFwiLCB7XG4gICAgICAgICAgICAvLyBwb2ludERvd27jga/ku6PlhaXjgZnjgovlv4XopoHjgYzjgarjgYTjga7jgadzZXR0ZXLjgpLlrprnvqnjgZfjgarjgYRcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICog44GT44Gu44Ko44Oz44OG44Kj44OG44Kj44GucG9pbnQgdXDjgqTjg5njg7Pjg4jjgIJcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgLy8gReOBrueUn+aIkOOCs+OCueODiOS9jua4m+OCkuiAg+aFruOBl+OAgeWPgueFp+OBleOCjOOBn+aZguOBruOBv+eUn+aIkOWHuuadpeOCi+OCiOOBhuOCouOCr+OCu+OCteOCkuS9v+OBhlxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9wb2ludFVwKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wb2ludFVwID0gbmV3IGcuQ2hhaW5UcmlnZ2VyKHRoaXMuc2NlbmUucG9pbnRVcENhcHR1cmUsIHRoaXMuX2lzVGFyZ2V0T3BlcmF0aW9uLCB0aGlzKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcG9pbnRVcDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoRS5wcm90b3R5cGUsIFwicG9pbnRNb3ZlXCIsIHtcbiAgICAgICAgICAgIC8vIHBvaW50VXDjga/ku6PlhaXjgZnjgovlv4XopoHjgYzjgarjgYTjga7jgadzZXR0ZXLjgpLlrprnvqnjgZfjgarjgYRcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICog44GT44Gu44Ko44Oz44OG44Kj44OG44Kj44GucG9pbnQgbW92ZeOCpOODmeODs+ODiOOAglxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAvLyBF44Gu55Sf5oiQ44Kz44K544OI5L2O5rib44KS6ICD5oWu44GX44CB5Y+C54Wn44GV44KM44Gf5pmC44Gu44G/55Sf5oiQ5Ye65p2l44KL44KI44GG44Ki44Kv44K744K144KS5L2/44GGXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3BvaW50TW92ZSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcG9pbnRNb3ZlID0gbmV3IGcuQ2hhaW5UcmlnZ2VyKHRoaXMuc2NlbmUucG9pbnRNb3ZlQ2FwdHVyZSwgdGhpcy5faXNUYXJnZXRPcGVyYXRpb24sIHRoaXMpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9wb2ludE1vdmU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEUucHJvdG90eXBlLCBcInRhcmdldENhbWVyYXNcIiwge1xuICAgICAgICAgICAgLy8gcG9pbnRNb3Zl44Gv5Luj5YWl44GZ44KL5b+F6KaB44GM44Gq44GE44Gu44Gnc2V0dGVy44KS5a6a576p44GX44Gq44GEXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIOOBk+OBruOCqOODs+ODhuOCo+ODhuOCo+OCkuihqOekuuOBp+OBjeOCi+OCq+ODoeODqeOBrumFjeWIl+OAglxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIOWIneacn+WApOOBr+epuumFjeWIl+OBp+OBguOCi+OAglxuICAgICAgICAgICAgICog44GT44Gu5YCk44GMIGB1bmRlZmluZWRgIOOBvuOBn+OBr+epuumFjeWIl+OBp+OBguOCi+WgtOWQiOOAgeOBk+OBruOCqOODs+ODhuOCo+ODhuOCo+OBqOOBneOBruWtkOWtq+OBr+OCq+ODoeODqeOBq+OCiOOCieOBmuaPj+eUu+OBleOCjOOCi+OAglxuICAgICAgICAgICAgICog56m644Gn44Gq44GE6YWN5YiX44Gn44GC44KL5aC05ZCI44CB44GT44Gu44Ko44Oz44OG44Kj44OG44Kj44Go44Gd44Gu5a2Q5a2r44Gv44CB6YWN5YiX5YaF44Gr5ZCr44G+44KM44KL44Kr44Oh44Op44Gn44Gu5o+P55S744Gu6Zqb44Gr44Gu44G/6KGo56S644GV44KM44KL44CCXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICog44GT44Gu5YCk44KS5aSJ5pu044GX44Gf5aC05ZCI44CBIGB0aGlzLm1vZGlmaWVkKClgIOOCkuWRvOOBs+WHuuOBmeW/heimgeOBjOOBguOCi+OAglxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAvLyBF44Gu55Sf5oiQ44Kz44K544OI5L2O5rib44KS6ICD5oWu44GX44CB5Y+C54Wn44GV44KM44Gf5pmC44Gu44G/55Sf5oiQ5Ye65p2l44KL44KI44GG44Ki44Kv44K744K144KS5L2/44GGXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGFyZ2V0Q2FtZXJhcyB8fCAodGhpcy5fdGFyZ2V0Q2FtZXJhcyA9IFtdKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGFyZ2V0Q2FtZXJhcyA9IHY7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEUucHJvdG90eXBlLCBcInRvdWNoYWJsZVwiLCB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIOODl+ODrOOCpOODpOODvOOBq+OBqOOBo+OBpuinpuOCjOOCieOCjOOCi+OCquODluOCuOOCp+OCr+ODiOOBp+OBguOCi+OBi+OCkuihqOOBmeOAglxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIOOBk+OBruWApOOBjOWBveOBp+OBguOCi+WgtOWQiOOAgeODneOCpOODs+ODhuOCo+ODs+OCsOOCpOODmeODs+ODiOOBruWvvuixoeOBq+OBquOCieOBquOBhOOAglxuICAgICAgICAgICAgICog5Yid5pyf5YCk44GvIGBmYWxzZWAg44Gn44GC44KL44CCXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogYEVgIOOBruS7luOBruODl+ODreODkeODhuOCo+OBqOeVsOOBquOCiuOAgeOBk+OBruWApOOBruWkieabtOW+jOOBqyBgdGhpcy5tb2RpZmllZCgpYCDjgpLlkbzjgbPlh7rjgZnlv4XopoHjga/jgarjgYTjgIJcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RvdWNoYWJsZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RvdWNoYWJsZSA9PT0gdilcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RvdWNoYWJsZSA9IHY7XG4gICAgICAgICAgICAgICAgaWYgKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlVG91Y2hQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGlzYWJsZVRvdWNoUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOiHquWIhuiHqui6q+OBqOWtkOWtq+OBruWGheWuueOCkuaPj+eUu+OBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga/jgIEgYFJlbmRlcmVyI2RyYXcoKWAg44GL44KJ44Ko44Oz44OG44Kj44OG44Kj44Gu44OE44Oq44O85qeL6YCg44KS44OI44Op44OQ44O844K544GZ44KL6YGO56iL44Gn5pqX6buZ44Gr5ZG844Gz5Ye644GV44KM44KL44CCXG4gICAgICAgICAqIOmAmuW4uOOAgeOCsuODvOODoOmWi+eZuuiAheOBjOOBk+OBruODoeOCveODg+ODieOCkuWRvOOBs+WHuuOBmeW/heimgeOBr+OBquOBhOOAglxuICAgICAgICAgKiBAcGFyYW0gcmVuZGVyZXIg5o+P55S75YWI44Gr5a++44GZ44KLUmVuZGVyZXJcbiAgICAgICAgICogQHBhcmFtIGNhbWVyYSDlr77osaHjga7jgqvjg6Hjg6njgILnnIHnlaXjgZXjgozjgZ/loLTlkIjjgIF1bmRlZmluZWRcbiAgICAgICAgICovXG4gICAgICAgIEUucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIChyZW5kZXJlciwgY2FtZXJhKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlICY9IH40IC8qIE1vZGlmaWVkICovO1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgJiAxIC8qIEhpZGRlbiAqLylcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB2YXIgY2FtcyA9IHRoaXMuX3RhcmdldENhbWVyYXM7XG4gICAgICAgICAgICBpZiAoY2FtcyAmJiBjYW1zLmxlbmd0aCA+IDAgJiYgKCFjYW1lcmEgfHwgY2Ftcy5pbmRleE9mKGNhbWVyYSkgPT09IC0xKSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSAmIDggLyogQ29udGV4dExlc3MgKi8pIHtcbiAgICAgICAgICAgICAgICByZW5kZXJlci50cmFuc2xhdGUodGhpcy54LCB0aGlzLnkpO1xuICAgICAgICAgICAgICAgIHZhciBnb0Rvd24gPSB0aGlzLnJlbmRlclNlbGYocmVuZGVyZXIsIGNhbWVyYSk7XG4gICAgICAgICAgICAgICAgaWYgKGdvRG93biAmJiB0aGlzLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XG4gICAgICAgICAgICAgICAgICAgIHZhciBsZW4gPSBjaGlsZHJlbi5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbltpXS5yZW5kZXIocmVuZGVyZXIsIGNhbWVyYSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRyYW5zbGF0ZSgtdGhpcy54LCAtdGhpcy55KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZW5kZXJlci5zYXZlKCk7XG4gICAgICAgICAgICBpZiAodGhpcy5hbmdsZSB8fCB0aGlzLnNjYWxlWCAhPT0gMSB8fCB0aGlzLnNjYWxlWSAhPT0gMSB8fCB0aGlzLmFuY2hvclggIT0gbnVsbCB8fCB0aGlzLmFuY2hvclkgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIC8vIE5vdGU6IHRoaXMuc2NhbGVYL3NjYWxlWeOBjDDjga7loLTlkIjmj4/nlLvjgZfjgZ/ntZDmnpzkvZXjgoLooajnpLrjgZXjgozjgarjgYTkuovjgavjgarjgovjgYzjgIHnibnmrormibHjgYTjga/jgZfjgarjgYRcbiAgICAgICAgICAgICAgICByZW5kZXJlci50cmFuc2Zvcm0odGhpcy5nZXRNYXRyaXgoKS5fbWF0cml4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIE5vdGU6IOWkieW9ouOBquOBl+OBruOCquODluOCuOOCp+OCr+ODiOOBr+OCreODo+ODg+OCt+ODpeOCguOBqOOCieOBmnRyYW5zbGF0ZeOBruOBv+OBp+WHpueQhlxuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRyYW5zbGF0ZSh0aGlzLngsIHRoaXMueSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5vcGFjaXR5ICE9PSAxKVxuICAgICAgICAgICAgICAgIHJlbmRlcmVyLm9wYWNpdHkodGhpcy5vcGFjaXR5KTtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBvc2l0ZU9wZXJhdGlvbiAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnNldENvbXBvc2l0ZU9wZXJhdGlvbih0aGlzLmNvbXBvc2l0ZU9wZXJhdGlvbik7XG4gICAgICAgICAgICBpZiAodGhpcy5zaGFkZXJQcm9ncmFtICE9PSB1bmRlZmluZWQgJiYgcmVuZGVyZXIuaXNTdXBwb3J0ZWRTaGFkZXJQcm9ncmFtKCkpXG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuc2V0U2hhZGVyUHJvZ3JhbSh0aGlzLnNoYWRlclByb2dyYW0pO1xuICAgICAgICAgICAgdmFyIGdvRG93biA9IHRoaXMucmVuZGVyU2VsZihyZW5kZXJlciwgY2FtZXJhKTtcbiAgICAgICAgICAgIGlmIChnb0Rvd24gJiYgdGhpcy5jaGlsZHJlbikge1xuICAgICAgICAgICAgICAgIC8vIE5vdGU6IGNvbmNhdOOBl+OBpuOBhOOBquOBhOOBruOBp3Vuc2FmZeOBoOOBjOOAgXJlbmRlcuS4reOBq+mFjeWIl+OBruS4rei6q+OBjOWkieOCj+OCi+S6i+OBr+OBquOBhOWJjeaPkOOBqOOBmeOCi1xuICAgICAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW5baV0ucmVuZGVyKHJlbmRlcmVyLCBjYW1lcmEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVuZGVyZXIucmVzdG9yZSgpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog6Ieq5YiG6Ieq6Lqr44Gu5YaF5a6544KS5o+P55S744GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBr+OAgSBgUmVuZGVyZXIjZHJhdygpYCDjgYvjgonjgqjjg7Pjg4bjgqPjg4bjgqPjga7jg4Tjg6rjg7zmp4vpgKDjgpLjg4jjg6njg5Djg7zjgrnjgZnjgovpgY7nqIvjgafmmpfpu5njgavlkbzjgbPlh7rjgZXjgozjgovjgIJcbiAgICAgICAgICog6YCa5bi444CB44Ky44O844Og6ZaL55m66ICF44GM44GT44Gu44Oh44K944OD44OJ44KS5ZG844Gz5Ye644GZ5b+F6KaB44Gv44Gq44GE44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOaIu+OCiuWApOOBr+OAgeOBk+OBruOCqOODs+ODhuOCo+ODhuOCo+OBruWtkOWtq+OBruaPj+eUu+OCkuOCueOCreODg+ODl+OBmeOBueOBjeOBp+OBguOCjOOBsOWBveOAgeOBp+OBquOBkeOCjOOBsOecn+OBp+OBguOCi+OAglxuICAgICAgICAgKiAo44GT44Gu5YCk44Gv44CB5a2Q5a2r44Gu5o+P55S75pa55rOV44KS44Kr44K544K/44Oe44Kk44K644GZ44KL5LiA6YOo44Gu44K144OW44Kv44Op44K544Gr44GK44GE44Gm44CB6YCa5bi444Gu5o+P55S744OR44K544KS44K544Kt44OD44OX44GZ44KL44Gf44KB44Gr55So44GE44KJ44KM44KLKVxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gcmVuZGVyZXIg5o+P55S75YWI44Gr5a++44GZ44KLUmVuZGVyZXJcbiAgICAgICAgICogQHBhcmFtIGNhbWVyYSDlr77osaHjga7jgqvjg6Hjg6lcbiAgICAgICAgICovXG4gICAgICAgIEUucHJvdG90eXBlLnJlbmRlclNlbGYgPSBmdW5jdGlvbiAocmVuZGVyZXIsIGNhbWVyYSkge1xuICAgICAgICAgICAgLy8gbm90aGluZyB0byBkb1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPjgYzlsZ7jgZnjgosgYEdhbWVgIOOCkui/lOOBmeOAglxuICAgICAgICAgKi9cbiAgICAgICAgRS5wcm90b3R5cGUuZ2FtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNjZW5lLmdhbWU7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlrZDjgpLov73liqDjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIGUg5a2Q44Ko44Oz44OG44Kj44OG44Kj44Go44GX44Gm6L+95Yqg44GZ44KL44Ko44Oz44OG44Kj44OG44KjXG4gICAgICAgICAqL1xuICAgICAgICBFLnByb3RvdHlwZS5hcHBlbmQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgdGhpcy5pbnNlcnRCZWZvcmUoZSwgdW5kZWZpbmVkKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOWtkOOCkuaMv+WFpeOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiBgdGFyZ2V0YCDjgYxgdGhpc2Ag44Gu5a2Q44Gn44Gq44GE5aC05ZCI44CBYGFwcGVuZChlKWAg44Go5ZCM44GY5YuV5L2c44Go44Gq44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBlIOWtkOOCqOODs+ODhuOCo+ODhuOCo+OBqOOBl+OBpui/veWKoOOBmeOCi+OCqOODs+ODhuOCo+ODhuOCo1xuICAgICAgICAgKiBAcGFyYW0gdGFyZ2V0IOaMv+WFpeS9jee9ruOBq+OBguOCi+WtkOOCqOODs+ODhuOCo+ODhuOCo1xuICAgICAgICAgKi9cbiAgICAgICAgRS5wcm90b3R5cGUuaW5zZXJ0QmVmb3JlID0gZnVuY3Rpb24gKGUsIHRhcmdldCkge1xuICAgICAgICAgICAgaWYgKGUucGFyZW50KVxuICAgICAgICAgICAgICAgIGUucmVtb3ZlKCk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW4pXG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdO1xuICAgICAgICAgICAgZS5wYXJlbnQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gLTE7XG4gICAgICAgICAgICBpZiAodGFyZ2V0ICE9PSB1bmRlZmluZWQgJiYgKGluZGV4ID0gdGhpcy5jaGlsZHJlbi5pbmRleE9mKHRhcmdldCkpID4gLTEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpbmRleCwgMCwgZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZS5fdG91Y2hhYmxlIHx8IGUuX2hhc1RvdWNoYWJsZUNoaWxkcmVuKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faGFzVG91Y2hhYmxlQ2hpbGRyZW4gPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZVRvdWNoUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubW9kaWZpZWQodHJ1ZSk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlrZDjgpLliYrpmaTjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogYGVgIOOBjCBgdGhpc2Ag44Gu5a2Q44Gn44Gq44GE5aC05ZCI44CBIGBBc3NlcnRpb25FcnJvcmAg44GMdGhyb3fjgZXjgozjgovjgIJcbiAgICAgICAgICogYGUgPT09IHVuZGVmaW5lZGAg44Gn44GC44KK6Kaq44GM44Gq44GE5aC05ZCI44CBIGBBc3NlcnRpb25FcnJvcmAg44GMdGhyb3fjgZXjgozjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIGUg5YmK6Zmk44GZ44KL5a2Q44Ko44Oz44OG44Kj44OG44Kj44CC55yB55Wl44GV44KM44Gf5aC05ZCI44CB6Ieq6Lqr44KS6Kaq44GL44KJ5YmK6Zmk44GZ44KLXG4gICAgICAgICAqL1xuICAgICAgICBFLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgKGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50LnJlbW92ZSh0aGlzKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgaW5kZXggPSB0aGlzLmNoaWxkcmVuID8gdGhpcy5jaGlsZHJlbi5pbmRleE9mKGUpIDogLTE7XG4gICAgICAgICAgICBpZiAoaW5kZXggPCAwKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkUjcmVtb3ZlOiBpbnZhbGlkIGNoaWxkXCIpO1xuICAgICAgICAgICAgdGhpcy5jaGlsZHJlbltpbmRleF0ucGFyZW50ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgaWYgKGUuX3RvdWNoYWJsZSB8fCBlLl9oYXNUb3VjaGFibGVDaGlsZHJlbikge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fZmluZFRvdWNoYWJsZUNoaWxkcmVuKHRoaXMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhc1RvdWNoYWJsZUNoaWxkcmVuID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2Rpc2FibGVUb3VjaFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5tb2RpZmllZCh0cnVlKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBruOCqOODs+ODhuOCo+ODhuOCo+OCkuegtOajhOOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDopqrjgYzjgYLjgovloLTlkIjjgIHopqrjgYvjgonjga8gYHJlbW92ZSgpYCDjgZXjgozjgovjgIJcbiAgICAgICAgICog5a2Q5a2r44KS5oyB44Gj44Gm44GE44KL5aC05ZCI44CB5a2Q5a2r44KC56C05qOE44GV44KM44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBFLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50KVxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICBpZiAodGhpcy5jaGlsZHJlbikge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLmNoaWxkcmVuLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRyZW5baV0uZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGlsZHJlbi5sZW5ndGggIT09IDApXG4gICAgICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkUjZGVzdHJveTogY2FuIG5vdCBkZXN0cm95IGFsbCBjaGlsZHJlbiwgXCIgKyB0aGlzLmNoaWxkcmVuLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZHJlbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIOOBk+OBruino+aUvuOBr3N0cmluZ+OBqGZvcmVhY2jjgpLkvb/jgaPjgabmm7jjgY3jgZ/jgYTjgYzjgIFtaW5pZnnjgZnjgovmmYLjga8u44Ki44Kv44K744K544Gu5pa544GM44GE44GE44Gu44Gn44KE44KA44KS5b6X44Gq44GEXG4gICAgICAgICAgICBpZiAodGhpcy5fdXBkYXRlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5fbWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX21lc3NhZ2UuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX21lc3NhZ2UgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5fcG9pbnREb3duKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcG9pbnREb3duLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wb2ludERvd24gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5fcG9pbnRNb3ZlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcG9pbnRNb3ZlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wb2ludE1vdmUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5fcG9pbnRVcCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BvaW50VXAuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3BvaW50VXAgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNjZW5lLnVucmVnaXN0ZXIodGhpcyk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPjgYznoLTmo4TmuIjjgb/jgafjgYLjgovjgYvjgpLov5TjgZnjgIJcbiAgICAgICAgICovXG4gICAgICAgIEUucHJvdG90eXBlLmRlc3Ryb3llZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNjZW5lID09PSB1bmRlZmluZWQ7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPjgavlr77jgZnjgovlpInmm7TjgpLjgqjjg7Pjgrjjg7PjgavpgJrnn6XjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog44GT44Gu44Oh44K944OD44OJ44Gu5ZG844Gz5Ye644GX5b6M44CBIGB0aGlzYCDjgavlr77jgZnjgovlpInmm7TjgYzlkIQgYFJlbmRlcmVyYCDjga7mj4/nlLvjgavlj43mmKDjgZXjgozjgovjgIJcbiAgICAgICAgICog44Gf44Gg44GX6YCG44Gv55yf44Gn44Gv44Gq44GE44CC44GZ44Gq44KP44Gh44CB5YaN5o+P55S744Gv5LuW44Gu6KaB5Zug44Gr44KI44Gj44Gm6KGM44KP44KM44KL44GT44Go44KC44GC44KL44CCXG4gICAgICAgICAqIOOCsuODvOODoOmWi+eZuuiAheOBr+OAgeOBk+OBruODoeOCveODg+ODieOCkuWRvOOBs+WHuuOBl+OBpuOBhOOBquOBhOOBk+OBqOOCkuOCguOBo+OBpuWGjeaPj+eUu+OBjOihjOOCj+OCjOOBpuOBhOOBquOBhOOBk+OBqOOCkuS7ruWumuOBl+OBpuOBr+OBquOCieOBquOBhOOAglxuICAgICAgICAgKlxuICAgICAgICAgKiDmnKzjg6Hjgr3jg4Pjg4njga/jgIHjgZPjga7jgqrjg5bjgrjjgqfjgq/jg4jjga4gYE9iamVjdDJEYCDnlLHmnaXjga7jg5fjg63jg5Hjg4bjgqMgKGB4YCwgYHlgLCBgYW5nbGVgIOOBquOBqSkg44KS5aSJ5pu044GX44Gf5aC05ZCI44Gr44KC5ZG844Gz44Gg44GZ5b+F6KaB44GM44GC44KL44CCXG4gICAgICAgICAqIOacrOODoeOCveODg+ODieOBr+OAgeaPj+eUu+OCreODo+ODg+OCt+ODpeOBrueEoeWKueWMluWHpueQhuOCkuWQq+OBvuOBquOBhOOAguaPj+eUu+OCreODo+ODg+OCt+ODpeOCkuaMgeOBpOOCqOODs+ODhuOCo+ODhuOCo+OBr+OAgeOBk+OBruODoeOCveODg+ODieOBqOOBr+WIpeOBqyBgaW52YWxpZGF0ZSgpYCDjgpLmj5DkvpvjgZfjgabjgYTjgovjgIJcbiAgICAgICAgICog5o+P55S744Kt44Oj44OD44K344Ol44Gu54Sh5Yq55YyW44KC5b+F6KaB44Gq5aC05ZCI44Gv44CB44GT44Gu44Oh44K944OD44OJ44Gn44Gv44Gq44GP44Gd44Gh44KJ44KS5ZG844Gz5Ye644GZ5b+F6KaB44GM44GC44KL44CCXG4gICAgICAgICAqIEBwYXJhbSBpc0J1YmJsaW5nIOmAmuW4uOOCsuODvOODoOmWi+eZuuiAheOBjOaMh+WumuOBmeOCi+W/heimgeOBr+OBquOBhOOAguOBk+OBruWkieabtOmAmuefpeOBjOOAgSjjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPoh6rouqvjga7jgb/jgarjgonjgZop5a2Q5a2r44Gu5aSJ5pu044Gu6YCa55+l44KS5ZCr44KA5aC05ZCI44CB55yf44KS5rih44GV44Gq44GR44KM44Gw44Gq44KJ44Gq44GE44CC55yB55Wl44GV44KM44Gf5aC05ZCI44CB5YG944CCXG4gICAgICAgICAqL1xuICAgICAgICBFLnByb3RvdHlwZS5tb2RpZmllZCA9IGZ1bmN0aW9uIChpc0J1YmJsaW5nKSB7XG4gICAgICAgICAgICAvLyBfbWF0cml444Gu55So6YCU44Gv5o+P55S744Gr6ZmQ44KJ44Gq44GEKGUuZy4gRSNmaW5kUG9pbnRTb3VyY2VCeVBvaW50KeOBruOBp+OAgU1vZGlmaWVk44OV44Op44Kw44Go54Sh6Zai5L+C44Gr44Kv44Oq44Ki44GZ44KL5b+F6KaB44GM44GC44KLXG4gICAgICAgICAgICBpZiAodGhpcy5fbWF0cml4KVxuICAgICAgICAgICAgICAgIHRoaXMuX21hdHJpeC5fbW9kaWZpZWQgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKHRoaXMuYW5nbGUgfHwgdGhpcy5zY2FsZVggIT09IDEgfHwgdGhpcy5zY2FsZVkgIT09IDEgfHwgdGhpcy5hbmNob3JYICE9IG51bGwgfHwgdGhpcy5hbmNob3JZICE9IG51bGxcbiAgICAgICAgICAgICAgICB8fCB0aGlzLm9wYWNpdHkgIT09IDEgfHwgdGhpcy5jb21wb3NpdGVPcGVyYXRpb24gIT09IHVuZGVmaW5lZCB8fCB0aGlzLnNoYWRlclByb2dyYW0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUgJj0gfjggLyogQ29udGV4dExlc3MgKi87XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlIHw9IDggLyogQ29udGV4dExlc3MgKi87XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSAmIDQgLyogTW9kaWZpZWQgKi8pXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSB8PSA0IC8qIE1vZGlmaWVkICovO1xuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50KVxuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50Lm1vZGlmaWVkKHRydWUpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44GT44Gu44Oh44K944OD44OJ44Gv44CBIGBFI2ZpbmRQb2ludFNvdXJjZUJ5UG9pbnQoKWAg5YaF44Gn5a2Q5a2r44Gu5o6i57Si44KS44K544Kt44OD44OX44GZ44G544GN44GL5Yik5pat44GZ44KL44Gf44KB44Gr5ZG844Gw44KM44KL44CCXG4gICAgICAgICAqIOmAmuW4uOOAgeWtkOWtq+OBruaPj+eUu+aWueazleOCkuOCq+OCueOCv+ODnuOCpOOCuuOBmeOCi+S4gOmDqOOBruOCteODluOCr+ODqeOCueOBq+OBiuOBhOOBpuOAgeS4juOBiOOCieOCjOOBn+W6p+aomeOBq+WvvuOBmeOCi+WtkOWtq+OBruaOoue0ouOCkuWItuW+oeOBmeOCi+WgtOWQiOOBq+WIqeeUqOOBmeOCi+OAglxuICAgICAgICAgKiDjgrLjg7zjg6DplovnmbrogIXjgYzjgZPjga7jg6Hjgr3jg4Pjg4njgpLlkbzjgbPlh7rjgZnlv4XopoHjga/jgarjgYTjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog5oi744KK5YCk44Gv44CB5a2Q5a2r44Gu5o6i57Si44KS44K544Kt44OD44OX44GZ44G544GN44Gn44GC44KM44Gw5YG944CB44Gn44Gq44GR44KM44Gw55yf44Gn44GC44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBwb2ludCDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPvvIhgdGhpc2DvvInjga7kvY3nva7jgpLln7rmupbjgajjgZfjgZ/nm7jlr77luqfmqJlcbiAgICAgICAgICovXG4gICAgICAgIEUucHJvdG90eXBlLnNob3VsZEZpbmRDaGlsZHJlbkJ5UG9pbnQgPSBmdW5jdGlvbiAocG9pbnQpIHtcbiAgICAgICAgICAgIC8vIG5vdGhpbmcgdG8gZG9cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog6Ieq6Lqr44Go6Ieq6Lqr44Gu5a2Q5a2r44Gu5Lit44Gn44CB44Gd44Gu5bqn5qiZ44Gr5Y+N5b+c44GZ44KLIGBQb2ludFNvdXJjZWAg44KS6L+U44GZ44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOaIu+OCiuWApOOBr+OAgeWvvuixoeOBjOimi+OBpOOBi+OBo+OBn+WgtOWQiOOAgSBgdGFyZ2V0YCDjgavopovjgaTjgYvjgaPjgZ/jgqjjg7Pjg4bjgqPjg4bjgqPjgpLmjIHjgaQgYFBvaW50U291cmNlYCDjgafjgYLjgovjgIJcbiAgICAgICAgICog5a++6LGh44GM6KaL44Gk44GL44KJ44Gq44GL44Gj44Gf5aC05ZCI44CBIGB1bmRlZmluZWRgIOOBp+OBguOCi+OAguaIu+OCiuWApOOBjCBgdW5kZWZpbmVkYCDjgafjgarjgYTloLTlkIjjgIHjgZ3jga4gYHRhcmdldGAg44OX44Ot44OR44OG44Kj44Gv5qyh44KS5rqA44Gf44GZOlxuICAgICAgICAgKiAtIOOBk+OBruOCqOODs+ODhuOCo+ODhuOCoyhgdGhpc2ApIOOBvuOBn+OBr+OBneOBruWtkOWtq+OBp+OBguOCi1xuICAgICAgICAgKiAtIGBFI3RvdWNoYWJsZWAg44GM55yf44Gn44GC44KLXG4gICAgICAgICAqIC0g44Kr44Oh44OpIGBjYW1lcmFgIOOBi+OCieWPr+imluOBp+OBguOCi+S4reOBp+acgOOCguaJi+WJjeOBq+OBguOCi1xuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gcG9pbnQg5a++6LGh44Gu5bqn5qiZXG4gICAgICAgICAqIEBwYXJhbSBtIGB0aGlzYCDjgavpgannlKjjgZnjgovlpInmj5vooYzliJfjgILnnIHnlaXjgZXjgozjgZ/loLTlkIjjgIHljZjkvY3ooYzliJdcbiAgICAgICAgICogQHBhcmFtIGZvcmNlIHRvdWNoYWJsZeaMh+WumuOCkueEoeimluOBmeOCi+WgtOWQiOecn+OCkuaMh+WumuOBmeOCi+OAguecgeeVpeOBleOCjOOBn+WgtOWQiOOAgeWBvVxuICAgICAgICAgKiBAcGFyYW0gY2FtZXJhIOWvvuixoeOBruOCq+ODoeODqeOAguaMh+WumuOBleOCjOOBquOBi+OBo+OBn+WgtOWQiHVuZGVmaW5lZFxuICAgICAgICAgKi9cbiAgICAgICAgRS5wcm90b3R5cGUuZmluZFBvaW50U291cmNlQnlQb2ludCA9IGZ1bmN0aW9uIChwb2ludCwgbSwgZm9yY2UsIGNhbWVyYSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgJiAxIC8qIEhpZGRlbiAqLylcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdmFyIGNhbXMgPSB0aGlzLl90YXJnZXRDYW1lcmFzO1xuICAgICAgICAgICAgaWYgKGNhbXMgJiYgY2Ftcy5sZW5ndGggPiAwICYmICghY2FtZXJhIHx8IGNhbXMuaW5kZXhPZihjYW1lcmEpID09PSAtMSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIG0gPSBtID8gbS5tdWx0aXBseU5ldyh0aGlzLmdldE1hdHJpeCgpKSA6IHRoaXMuZ2V0TWF0cml4KCkuY2xvbmUoKTtcbiAgICAgICAgICAgIHZhciBwID0gbS5tdWx0aXBseUludmVyc2VGb3JQb2ludChwb2ludCk7XG4gICAgICAgICAgICBpZiAodGhpcy5faGFzVG91Y2hhYmxlQ2hpbGRyZW4gfHwgKGZvcmNlICYmIHRoaXMuY2hpbGRyZW4gJiYgdGhpcy5jaGlsZHJlbi5sZW5ndGgpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2hvdWxkRmluZENoaWxkcmVuQnlQb2ludChwKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkID0gdGhpcy5jaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3JjZSB8fCBjaGlsZC5fdG91Y2hhYmxlIHx8IGNoaWxkLl9oYXNUb3VjaGFibGVDaGlsZHJlbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSBjaGlsZC5maW5kUG9pbnRTb3VyY2VCeVBvaW50KHBvaW50LCBtLCBmb3JjZSwgY2FtZXJhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCEoZm9yY2UgfHwgdGhpcy5fdG91Y2hhYmxlKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgLy8g6YCG6KGM5YiX44KS44Od44Kk44Oz44OI44Gr44GL44GR44Gf57WQ5p6c44GMReOBq+ODkuODg+ODiOOBl+OBpuOBhOOCi+OBi+OCkuioiOeul1xuICAgICAgICAgICAgaWYgKDAgPD0gcC54ICYmIHRoaXMud2lkdGggPiBwLnggJiYgMCA8PSBwLnkgJiYgdGhpcy5oZWlnaHQgPiBwLnkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IHRoaXMsXG4gICAgICAgICAgICAgICAgICAgIHBvaW50OiBwXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga5F44GM6KGo56S654q25oWL44Gn44GC44KL44GL44Gp44GG44GL44KS6L+U44GZ44CCXG4gICAgICAgICAqL1xuICAgICAgICBFLnByb3RvdHlwZS52aXNpYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICh0aGlzLnN0YXRlICYgMSAvKiBIaWRkZW4gKi8pICE9PSAxIC8qIEhpZGRlbiAqLztcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBrkXjgpLooajnpLrnirbmhYvjgavjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogYHRoaXMuaGlkZSgpYCDjgavjgojjgaPjgabpnZ7ooajnpLrnirbmhYvjgavjgZXjgozjgZ/jgqjjg7Pjg4bjgqPjg4bjgqPjgpLooajnpLrnirbmhYvjgavmiLvjgZnjgIJcbiAgICAgICAgICog55Sf5oiQ55u05b6M44Gu44Ko44Oz44OG44Kj44OG44Kj44Gv6KGo56S654q25oWL44Gn44GC44KK44CBIGBoaWRlKClgIOOCkuWRvOOBs+WHuuOBleOBquOBhOmZkOOCiuOBk+OBruODoeOCveODg+ODieOCkuWRvOOBs+WHuuOBmeW/heimgeOBr+OBquOBhOOAglxuICAgICAgICAgKi9cbiAgICAgICAgRS5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghKHRoaXMuc3RhdGUgJiAxIC8qIEhpZGRlbiAqLykpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSAmPSB+MSAvKiBIaWRkZW4gKi87XG4gICAgICAgICAgICBpZiAodGhpcy5wYXJlbnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudC5tb2RpZmllZCh0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBrkXjgpLpnZ7ooajnpLrnirbmhYvjgavjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogYHRoaXMuc2hvdygpYCDjgYzlkbzjgbDjgozjgovjgb7jgafjga7plpPjgIHjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPjga/lkIQgYFJlbmRlcmVyYCDjgavjgojjgaPjgabmj4/nlLvjgZXjgozjgarjgYTjgIJcbiAgICAgICAgICog44G+44GfIGBHYW1lI2ZpbmRQb2ludFNvdXJjZSgpYCDjgafov5TjgZXjgozjgovjgZPjgajjgoLjgarjgY/jgarjgovjgIJcbiAgICAgICAgICogYHRoaXMjcG9pbnREb3duYCwgYHBvaW50TW92ZWAsIGBwb2ludFVwYCDjgarjganjgoLpgJrluLjjga7mlrnms5Xjgafjga9maXJl44GV44KM44Gq44GP44Gq44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBFLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgJiAxIC8qIEhpZGRlbiAqLylcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB0aGlzLnN0YXRlIHw9IDEgLyogSGlkZGVuICovO1xuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnQubW9kaWZpZWQodHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga5F44Gu5YyF5ZCr55+p5b2i44KS6KiI566X44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBjIOS9v+eUqOOCq+ODoeODqeOAglxuICAgICAgICAgKi9cbiAgICAgICAgRS5wcm90b3R5cGUuY2FsY3VsYXRlQm91bmRpbmdSZWN0ID0gZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYWxjdWxhdGVCb3VuZGluZ1JlY3QodW5kZWZpbmVkLCBjKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBFLnByb3RvdHlwZS5fY2FsY3VsYXRlQm91bmRpbmdSZWN0ID0gZnVuY3Rpb24gKG0sIGMpIHtcbiAgICAgICAgICAgIHZhciBtYXRyaXggPSB0aGlzLmdldE1hdHJpeCgpO1xuICAgICAgICAgICAgaWYgKG0pIHtcbiAgICAgICAgICAgICAgICBtYXRyaXggPSBtLm11bHRpcGx5TmV3KG1hdHJpeCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMudmlzaWJsZSgpIHx8IChjICYmICghdGhpcy5fdGFyZ2V0Q2FtZXJhcyB8fCB0aGlzLl90YXJnZXRDYW1lcmFzLmluZGV4T2YoYykgPT09IC0xKSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHRoaXNCb3VuZGluZ1JlY3QgPSB7IGxlZnQ6IDAsIHJpZ2h0OiB0aGlzLndpZHRoLCB0b3A6IDAsIGJvdHRvbTogdGhpcy5oZWlnaHQgfTtcbiAgICAgICAgICAgIHZhciB0YXJnZXRDb29yZGluYXRlcyA9IFtcbiAgICAgICAgICAgICAgICB7IHg6IHRoaXNCb3VuZGluZ1JlY3QubGVmdCwgeTogdGhpc0JvdW5kaW5nUmVjdC50b3AgfSxcbiAgICAgICAgICAgICAgICB7IHg6IHRoaXNCb3VuZGluZ1JlY3QubGVmdCwgeTogdGhpc0JvdW5kaW5nUmVjdC5ib3R0b20gfSxcbiAgICAgICAgICAgICAgICB7IHg6IHRoaXNCb3VuZGluZ1JlY3QucmlnaHQsIHk6IHRoaXNCb3VuZGluZ1JlY3QudG9wIH0sXG4gICAgICAgICAgICAgICAgeyB4OiB0aGlzQm91bmRpbmdSZWN0LnJpZ2h0LCB5OiB0aGlzQm91bmRpbmdSZWN0LmJvdHRvbSB9XG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgdmFyIGNvbnZlcnRlZFBvaW50ID0gbWF0cml4Lm11bHRpcGx5UG9pbnQodGFyZ2V0Q29vcmRpbmF0ZXNbMF0pO1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHsgbGVmdDogY29udmVydGVkUG9pbnQueCwgcmlnaHQ6IGNvbnZlcnRlZFBvaW50LngsIHRvcDogY29udmVydGVkUG9pbnQueSwgYm90dG9tOiBjb252ZXJ0ZWRQb2ludC55IH07XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHRhcmdldENvb3JkaW5hdGVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgY29udmVydGVkUG9pbnQgPSBtYXRyaXgubXVsdGlwbHlQb2ludCh0YXJnZXRDb29yZGluYXRlc1tpXSk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5sZWZ0ID4gY29udmVydGVkUG9pbnQueClcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmxlZnQgPSBjb252ZXJ0ZWRQb2ludC54O1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQucmlnaHQgPCBjb252ZXJ0ZWRQb2ludC54KVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQucmlnaHQgPSBjb252ZXJ0ZWRQb2ludC54O1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudG9wID4gY29udmVydGVkUG9pbnQueSlcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnRvcCA9IGNvbnZlcnRlZFBvaW50Lnk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5ib3R0b20gPCBjb252ZXJ0ZWRQb2ludC55KVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQuYm90dG9tID0gY29udmVydGVkUG9pbnQueTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmNoaWxkcmVuICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5vd1Jlc3VsdCA9IHRoaXMuY2hpbGRyZW5baV0uX2NhbGN1bGF0ZUJvdW5kaW5nUmVjdChtYXRyaXgsIGMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobm93UmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmxlZnQgPiBub3dSZXN1bHQubGVmdClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQubGVmdCA9IG5vd1Jlc3VsdC5sZWZ0O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5yaWdodCA8IG5vd1Jlc3VsdC5yaWdodClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucmlnaHQgPSBub3dSZXN1bHQucmlnaHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnRvcCA+IG5vd1Jlc3VsdC50b3ApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnRvcCA9IG5vd1Jlc3VsdC50b3A7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmJvdHRvbSA8IG5vd1Jlc3VsdC5ib3R0b20pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmJvdHRvbSA9IG5vd1Jlc3VsdC5ib3R0b207XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIEUucHJvdG90eXBlLl9lbmFibGVUb3VjaFByb3BhZ2F0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHAgPSB0aGlzLnBhcmVudDtcbiAgICAgICAgICAgIHdoaWxlIChwIGluc3RhbmNlb2YgRSAmJiAhcC5faGFzVG91Y2hhYmxlQ2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICBwLl9oYXNUb3VjaGFibGVDaGlsZHJlbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgcCA9IHAucGFyZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIEUucHJvdG90eXBlLl9kaXNhYmxlVG91Y2hQcm9wYWdhdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBwID0gdGhpcy5wYXJlbnQ7XG4gICAgICAgICAgICB3aGlsZSAocCBpbnN0YW5jZW9mIEUgJiYgcC5faGFzVG91Y2hhYmxlQ2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZmluZFRvdWNoYWJsZUNoaWxkcmVuKHApKVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBwLl9oYXNUb3VjaGFibGVDaGlsZHJlbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHAgPSBwLnBhcmVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBFLnByb3RvdHlwZS5faXNUYXJnZXRPcGVyYXRpb24gPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgJiAxIC8qIEhpZGRlbiAqLylcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIGcuUG9pbnRFdmVudClcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdG91Y2hhYmxlICYmIGUudGFyZ2V0ID09PSB0aGlzO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9O1xuICAgICAgICBFLnByb3RvdHlwZS5fZmluZFRvdWNoYWJsZUNoaWxkcmVuID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGlmIChlLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlLmNoaWxkcmVuLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLmNoaWxkcmVuW2ldLnRvdWNoYWJsZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlLmNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gdGhpcy5fZmluZFRvdWNoYWJsZUNoaWxkcmVuKGUuY2hpbGRyZW5baV0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodG1wKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRtcDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gRTtcbiAgICB9KGcuT2JqZWN0MkQpKTtcbiAgICBnLkUgPSBFO1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIC8qKlxuICAgICAqIOWGhemDqOaPj+eUu+OCreODo+ODg+OCt+ODpeOCkuaMgeOBpCBgRWAg44CCXG4gICAgICovXG4gICAgdmFyIENhY2hlYWJsZUUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhDYWNoZWFibGVFLCBfc3VwZXIpO1xuICAgICAgICAvKipcbiAgICAgICAgICog5ZCE56iu44OR44Op44Oh44O844K/44KS5oyH5a6a44GX44GmIGBDYWNoZWFibGVFYCDjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLnlJ/miJDjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHBhcmFtIOOBk+OBruOCqOODs+ODhuOCo+ODhuOCo+OBq+WvvuOBmeOCi+ODkeODqeODoeODvOOCv1xuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gQ2FjaGVhYmxlRShwYXJhbSkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcGFyYW0pIHx8IHRoaXM7XG4gICAgICAgICAgICBfdGhpcy5fc2hvdWxkUmVuZGVyQ2hpbGRyZW4gPSB0cnVlO1xuICAgICAgICAgICAgX3RoaXMuX2NhY2hlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgX3RoaXMuX3JlbmRlcmVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgX3RoaXMuX3JlbmRlcmVkQ2FtZXJhID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPjga7mj4/nlLvjgq3jg6Pjg4Pjgrfjg6XnhKHlirnljJbjgpLjgqjjg7Pjgrjjg7PjgavpgJrnn6XjgZnjgovjgIJcbiAgICAgICAgICog44GT44Gu44Oh44K944OD44OJ44KS5ZG844Gz5Ye644GX5b6M44CB5o+P55S744Kt44Oj44OD44K344Ol44Gu5YaN5qeL56+J44GM6KGM44KP44KM44CB5ZCEIGBSZW5kZXJlcmAg44Gr5o+P55S75YaF5a6544Gu5aSJ5pu044GM5Y+N5pig44GV44KM44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBDYWNoZWFibGVFLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSAmPSB+MiAvKiBDYWNoZWQgKi87XG4gICAgICAgICAgICB0aGlzLm1vZGlmaWVkKCk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPoh6rouqvjga7mj4/nlLvjgpLooYzjgYbjgIJcbiAgICAgICAgICog44GT44Gu44Oh44K944OD44OJ44Gv44Ko44Oz44K444Oz44GL44KJ5pqX6buZ44Gr5ZG844Gz5Ye644GV44KM44CB44Ky44O844Og6ZaL55m66ICF44GM5ZG844Gz5Ye644GZ5b+F6KaB44Gv44Gq44GE44CCXG4gICAgICAgICAqL1xuICAgICAgICBDYWNoZWFibGVFLnByb3RvdHlwZS5yZW5kZXJTZWxmID0gZnVuY3Rpb24gKHJlbmRlcmVyLCBjYW1lcmEpIHtcbiAgICAgICAgICAgIHZhciBwYWRkaW5nID0gQ2FjaGVhYmxlRS5QQURESU5HO1xuICAgICAgICAgICAgaWYgKHRoaXMuX3JlbmRlcmVkQ2FtZXJhICE9PSBjYW1lcmEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlICY9IH4yIC8qIENhY2hlZCAqLztcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXJlZENhbWVyYSA9IGNhbWVyYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghKHRoaXMuc3RhdGUgJiAyIC8qIENhY2hlZCAqLykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jYWNoZVNpemUgPSB0aGlzLmNhbGN1bGF0ZUNhY2hlU2l6ZSgpO1xuICAgICAgICAgICAgICAgIHZhciB3ID0gTWF0aC5jZWlsKHRoaXMuX2NhY2hlU2l6ZS53aWR0aCkgKyBwYWRkaW5nICogMjtcbiAgICAgICAgICAgICAgICB2YXIgaCA9IE1hdGguY2VpbCh0aGlzLl9jYWNoZVNpemUuaGVpZ2h0KSArIHBhZGRpbmcgKiAyO1xuICAgICAgICAgICAgICAgIHZhciBpc05ldyA9ICF0aGlzLl9jYWNoZSB8fCAodGhpcy5fY2FjaGUud2lkdGggPCB3KSB8fCAodGhpcy5fY2FjaGUuaGVpZ2h0IDwgaCk7XG4gICAgICAgICAgICAgICAgaWYgKGlzTmV3KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jYWNoZSAmJiAhdGhpcy5fY2FjaGUuZGVzdHJveWVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhY2hlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYWNoZSA9IHRoaXMuc2NlbmUuZ2FtZS5yZXNvdXJjZUZhY3RvcnkuY3JlYXRlU3VyZmFjZSh3LCBoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSB0aGlzLl9jYWNoZS5yZW5kZXJlcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgY2FjaGVSZW5kZXJlciA9IHRoaXMuX3JlbmRlcmVyO1xuICAgICAgICAgICAgICAgIGNhY2hlUmVuZGVyZXIuYmVnaW4oKTtcbiAgICAgICAgICAgICAgICBpZiAoIWlzTmV3KSB7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlUmVuZGVyZXIuY2xlYXIoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FjaGVSZW5kZXJlci5zYXZlKCk7XG4gICAgICAgICAgICAgICAgY2FjaGVSZW5kZXJlci50cmFuc2xhdGUocGFkZGluZywgcGFkZGluZyk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJDYWNoZShjYWNoZVJlbmRlcmVyLCBjYW1lcmEpO1xuICAgICAgICAgICAgICAgIGNhY2hlUmVuZGVyZXIucmVzdG9yZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUgfD0gMiAvKiBDYWNoZWQgKi87XG4gICAgICAgICAgICAgICAgY2FjaGVSZW5kZXJlci5lbmQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLl9jYWNoZSAmJiB0aGlzLl9jYWNoZVNpemUud2lkdGggPiAwICYmIHRoaXMuX2NhY2hlU2l6ZS5oZWlnaHQgPiAwKSB7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIudHJhbnNsYXRlKC1wYWRkaW5nLCAtcGFkZGluZyk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJTZWxmRnJvbUNhY2hlKHJlbmRlcmVyKTtcbiAgICAgICAgICAgICAgICByZW5kZXJlci50cmFuc2xhdGUocGFkZGluZywgcGFkZGluZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc2hvdWxkUmVuZGVyQ2hpbGRyZW47XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlhoXpg6jjgq3jg6Pjg4Pjgrfjg6XjgYvjgonoh6rouqvjga7mj4/nlLvjgpLooYzjgYbjgIJcbiAgICAgICAgICog44GT44Gu44Oh44K944OD44OJ44Gv44Ko44Oz44K444Oz44GL44KJ5pqX6buZ44Gr5ZG844Gz5Ye644GV44KM44CB44Ky44O844Og6ZaL55m66ICF44GM5ZG844Gz5Ye644GZ5b+F6KaB44Gv44Gq44GE44CCXG4gICAgICAgICAqL1xuICAgICAgICBDYWNoZWFibGVFLnByb3RvdHlwZS5yZW5kZXJTZWxmRnJvbUNhY2hlID0gZnVuY3Rpb24gKHJlbmRlcmVyKSB7XG4gICAgICAgICAgICByZW5kZXJlci5kcmF3SW1hZ2UodGhpcy5fY2FjaGUsIDAsIDAsIHRoaXMuX2NhY2hlU2l6ZS53aWR0aCArIENhY2hlYWJsZUUuUEFERElORywgdGhpcy5fY2FjaGVTaXplLmhlaWdodCArIENhY2hlYWJsZUUuUEFERElORywgMCwgMCk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDliKnnlKjjgZfjgabjgYTjgosgYFN1cmZhY2VgIOOCkuegtOajhOOBl+OBn+S4iuOBp+OAgeOBk+OBruOCqOODs+ODhuOCo+ODhuOCo+OCkuegtOajhOOBmeOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgQ2FjaGVhYmxlRS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9jYWNoZSAmJiAhdGhpcy5fY2FjaGUuZGVzdHJveWVkKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jYWNoZS5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9jYWNoZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIF9zdXBlci5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44Kt44Oj44OD44K344Ol44Gu44K144Kk44K644KS5Y+W5b6X44GZ44KL44CCXG4gICAgICAgICAqIOacrOOCr+ODqeOCueOCkue2meaJv+OBl+OBn+OCr+ODqeOCueOBp+OCqOODs+ODhuOCo+ODhuOCo+OBruOCteOCpOOCuuOBqOeVsOOBquOCi+OCteOCpOOCuuOCkuWIqeeUqOOBmeOCi+WgtOWQiOOAgeOBk+OBruODoeOCveODg+ODieOCkuOCquODvOODkOODvOODqeOCpOODieOBmeOCi+OAglxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga/jgqjjg7Pjgrjjg7PjgYvjgonmmpfpu5njgavlkbzjgbPlh7rjgZXjgozjgIHjgrLjg7zjg6DplovnmbrogIXjgYzlkbzjgbPlh7rjgZnlv4XopoHjga/jgarjgYTjgIJcbiAgICAgICAgICog44GT44Gu44Oh44K944OD44OJ44GL44KJ5b6X44KJ44KM44KL5YCk44KS5aSJ5pu044GX44Gf5aC05ZCI44CBIGB0aGlzLmludmFsaWRhdGUoKWAg44KS5ZG844Gz5Ye644GZ5b+F6KaB44GM44GC44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBDYWNoZWFibGVFLnByb3RvdHlwZS5jYWxjdWxhdGVDYWNoZVNpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBfY2FjaGUg44Gu44OR44OH44Kj44Oz44Kw44K144Kk44K644CCXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBDYWNoZWFibGVFLlBBRERJTkcgPSAxO1xuICAgICAgICByZXR1cm4gQ2FjaGVhYmxlRTtcbiAgICB9KGcuRSkpO1xuICAgIGcuQ2FjaGVhYmxlRSA9IENhY2hlYWJsZUU7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLy8gVE9ETzogKEdBTUVERVYtMTU0OSkg44Kz44Oh44Oz44OI5pW055CGXG4gICAgLyoqXG4gICAgICog5pON5L2c5a++6LGh44Go44GZ44KL44K544OI44Os44O844K444Gu44Oq44O844K444On44Oz44KS6KGo44GZ44CCXG4gICAgICovXG4gICAgLy8g44K144O844OQ5LuV5qeY44Gr5YmH44GX44CB5YCk44KS5oyH5a6a44GX44Gm44GE44KL44CCXG4gICAgdmFyIFN0b3JhZ2VSZWdpb247XG4gICAgKGZ1bmN0aW9uIChTdG9yYWdlUmVnaW9uKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBzbG90c+OCkuihqOOBmeOAglxuICAgICAgICAgKi9cbiAgICAgICAgU3RvcmFnZVJlZ2lvbltTdG9yYWdlUmVnaW9uW1wiU2xvdHNcIl0gPSAxXSA9IFwiU2xvdHNcIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHNjb3Jlc+OCkuihqOOBmeOAglxuICAgICAgICAgKi9cbiAgICAgICAgU3RvcmFnZVJlZ2lvbltTdG9yYWdlUmVnaW9uW1wiU2NvcmVzXCJdID0gMl0gPSBcIlNjb3Jlc1wiO1xuICAgICAgICAvKipcbiAgICAgICAgICogY291bnRz44KS6KGo44GZ44CCXG4gICAgICAgICAqL1xuICAgICAgICBTdG9yYWdlUmVnaW9uW1N0b3JhZ2VSZWdpb25bXCJDb3VudHNcIl0gPSAzXSA9IFwiQ291bnRzXCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiB2YWx1ZXPjgpLooajjgZnjgIJcbiAgICAgICAgICovXG4gICAgICAgIFN0b3JhZ2VSZWdpb25bU3RvcmFnZVJlZ2lvbltcIlZhbHVlc1wiXSA9IDRdID0gXCJWYWx1ZXNcIjtcbiAgICB9KShTdG9yYWdlUmVnaW9uID0gZy5TdG9yYWdlUmVnaW9uIHx8IChnLlN0b3JhZ2VSZWdpb24gPSB7fSkpO1xuICAgIC8qKlxuICAgICAqIOS4gOaLrOWPluW+l+OCkuihjOOBhuWgtOWQiOOBruOCveODvOODiOmghuOAglxuICAgICAqL1xuICAgIHZhciBTdG9yYWdlT3JkZXI7XG4gICAgKGZ1bmN0aW9uIChTdG9yYWdlT3JkZXIpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOaYh+mghuOAglxuICAgICAgICAgKi9cbiAgICAgICAgU3RvcmFnZU9yZGVyW1N0b3JhZ2VPcmRlcltcIkFzY1wiXSA9IDBdID0gXCJBc2NcIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOmZjemghuOAglxuICAgICAgICAgKi9cbiAgICAgICAgU3RvcmFnZU9yZGVyW1N0b3JhZ2VPcmRlcltcIkRlc2NcIl0gPSAxXSA9IFwiRGVzY1wiO1xuICAgIH0pKFN0b3JhZ2VPcmRlciA9IGcuU3RvcmFnZU9yZGVyIHx8IChnLlN0b3JhZ2VPcmRlciA9IHt9KSk7XG4gICAgLyoqXG4gICAgICog5p2h5Lu244KS6KGo44GZ44CCXG4gICAgICovXG4gICAgLy8g44K144O844OQ5LuV5qeY44Gr5YmH44GX44CB5YCk44KS5oyH5a6a44GX44Gm44GE44KL44CCXG4gICAgdmFyIFN0b3JhZ2VDb25kaXRpb247XG4gICAgKGZ1bmN0aW9uIChTdG9yYWdlQ29uZGl0aW9uKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDnrYnkvqHjgpLooajjgZnvvIg9Pe+8ieOAglxuICAgICAgICAgKi9cbiAgICAgICAgU3RvcmFnZUNvbmRpdGlvbltTdG9yYWdlQ29uZGl0aW9uW1wiRXF1YWxcIl0gPSAxXSA9IFwiRXF1YWxcIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOAjOOCiOOCiuWkp+OBjeOBhOOAjeOCkuihqOOBme+8iD7vvInjgIJcbiAgICAgICAgICovXG4gICAgICAgIFN0b3JhZ2VDb25kaXRpb25bU3RvcmFnZUNvbmRpdGlvbltcIkdyZWF0ZXJUaGFuXCJdID0gMl0gPSBcIkdyZWF0ZXJUaGFuXCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgIzjgojjgorlsI/jgZXjgYTjgI3jgpLooajjgZnvvIg877yJ44CCXG4gICAgICAgICAqL1xuICAgICAgICBTdG9yYWdlQ29uZGl0aW9uW1N0b3JhZ2VDb25kaXRpb25bXCJMZXNzVGhhblwiXSA9IDNdID0gXCJMZXNzVGhhblwiO1xuICAgIH0pKFN0b3JhZ2VDb25kaXRpb24gPSBnLlN0b3JhZ2VDb25kaXRpb24gfHwgKGcuU3RvcmFnZUNvbmRpdGlvbiA9IHt9KSk7XG4gICAgLyoqXG4gICAgICogQ291bnRz44Oq44O844K444On44Oz44G444Gu5pu444GN6L6844G/5pON5L2c56iu5Yil44KS6KGo44GZ44CCXG4gICAgICovXG4gICAgLy8g44K144O844OQ5LuV5qeY44Gr5YmH44GX44CB5YCk44KS5oyH5a6a44GX44Gm44GE44KL44CCXG4gICAgdmFyIFN0b3JhZ2VDb3VudHNPcGVyYXRpb247XG4gICAgKGZ1bmN0aW9uIChTdG9yYWdlQ291bnRzT3BlcmF0aW9uKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgqTjg7Pjgq/jg6rjg6Hjg7Pjg4jmk43kvZzjgpLlrp/ooYzjgZnjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIFN0b3JhZ2VDb3VudHNPcGVyYXRpb25bU3RvcmFnZUNvdW50c09wZXJhdGlvbltcIkluY3JcIl0gPSAxXSA9IFwiSW5jclwiO1xuICAgICAgICAvKipcbiAgICAgICAgICog44OH44Kv44Oq44Oh44Oz44OI5pON5L2c44KS5a6f6KGM44GZ44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBTdG9yYWdlQ291bnRzT3BlcmF0aW9uW1N0b3JhZ2VDb3VudHNPcGVyYXRpb25bXCJEZWNyXCJdID0gMl0gPSBcIkRlY3JcIjtcbiAgICB9KShTdG9yYWdlQ291bnRzT3BlcmF0aW9uID0gZy5TdG9yYWdlQ291bnRzT3BlcmF0aW9uIHx8IChnLlN0b3JhZ2VDb3VudHNPcGVyYXRpb24gPSB7fSkpO1xuICAgIC8qKlxuICAgICAqIOOCueODiOODrOODvOOCuOOBruWApOOCkuS/neaMgeOBmeOCi+OCr+ODqeOCueOAglxuICAgICAqIOOCsuODvOODoOmWi+eZuuiAheOBjOOBk+OBruOCr+ODqeOCueOBruOCpOODs+OCueOCv+ODs+OCueOCkuebtOaOpeeUn+aIkOOBmeOCi+OBk+OBqOOBr+OBquOBhOOAglxuICAgICAqL1xuICAgIHZhciBTdG9yYWdlVmFsdWVTdG9yZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gU3RvcmFnZVZhbHVlU3RvcmUoa2V5cywgdmFsdWVzKSB7XG4gICAgICAgICAgICB0aGlzLl9rZXlzID0ga2V5cztcbiAgICAgICAgICAgIHRoaXMuX3ZhbHVlcyA9IHZhbHVlcztcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICog5YCk44Gu6YWN5YiX44KSIGBTdG9yYWdlS2V5YCDjgb7jgZ/jga/jgqTjg7Pjg4fjg4Pjgq/jgrnjgYvjgonlj5blvpfjgZnjgovjgIJcbiAgICAgICAgICog6YCa5bi444CB44Kk44Oz44OH44OD44Kv44K544GvIGBTY2VuZWAg44Gu44Kz44Oz44K544OI44Op44Kv44K/44Gr5oyH5a6a44GX44GfIGBzdG9yYWdlS2V5c2Ag44Gu44Kk44Oz44OH44OD44Kv44K544Gr5a++5b+c44GZ44KL44CCXG4gICAgICAgICAqIEBwYXJhbSBrZXlPckluZGV4IGBTdG9yYWdlS2V5YCDlj4jjga/jgqTjg7Pjg4fjg4Pjgq/jgrlcbiAgICAgICAgICovXG4gICAgICAgIFN0b3JhZ2VWYWx1ZVN0b3JlLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoa2V5T3JJbmRleCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX3ZhbHVlcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBrZXlPckluZGV4ID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlc1trZXlPckluZGV4XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IHRoaXMuX2tleXMuaW5kZXhPZihrZXlPckluZGV4KTtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZXNbaW5kZXhdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX2tleXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IHRoaXMuX2tleXNbaV07XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQucmVnaW9uID09PSBrZXlPckluZGV4LnJlZ2lvblxuICAgICAgICAgICAgICAgICAgICAgICAgJiYgdGFyZ2V0LnJlZ2lvbktleSA9PT0ga2V5T3JJbmRleC5yZWdpb25LZXlcbiAgICAgICAgICAgICAgICAgICAgICAgICYmIHRhcmdldC51c2VySWQgPT09IGtleU9ySW5kZXgudXNlcklkXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiB0YXJnZXQuZ2FtZUlkID09PSBrZXlPckluZGV4LmdhbWVJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOWApOOCkiBgU3RvcmFnZUtleWAg44G+44Gf44Gv44Kk44Oz44OH44OD44Kv44K544GL44KJ5Y+W5b6X44GZ44KL44CCXG4gICAgICAgICAqIOWvvuW/nOOBmeOCi+WApOOBjOikh+aVsOOBguOCi+WgtOWQiOOBr+OAgeWFiOmgreOBruWApOOCkuWPluW+l+OBmeOCi+OAglxuICAgICAgICAgKiDpgJrluLjjgIHjgqTjg7Pjg4fjg4Pjgq/jgrnjga8gYFNjZW5lYCDjga7jgrPjg7Pjgrnjg4jjg6njgq/jgr/jgavmjIflrprjgZfjgZ8gYHN0b3JhZ2VLZXlzYCDjga7jgqTjg7Pjg4fjg4Pjgq/jgrnjgavlr77lv5zjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIGtleU9ySW5kZXggYFN0b3JhZ2VLZXlgIOWPiOOBr+OCpOODs+ODh+ODg+OCr+OCuVxuICAgICAgICAgKi9cbiAgICAgICAgU3RvcmFnZVZhbHVlU3RvcmUucHJvdG90eXBlLmdldE9uZSA9IGZ1bmN0aW9uIChrZXlPckluZGV4KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWVzID0gdGhpcy5nZXQoa2V5T3JJbmRleCk7XG4gICAgICAgICAgICBpZiAoIXZhbHVlcylcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlc1swXTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIFN0b3JhZ2VWYWx1ZVN0b3JlO1xuICAgIH0oKSk7XG4gICAgZy5TdG9yYWdlVmFsdWVTdG9yZSA9IFN0b3JhZ2VWYWx1ZVN0b3JlO1xuICAgIC8qKlxuICAgICAqIOOCueODiOODrOODvOOCuOOBruWApOOCkuODreODvOODieOBmeOCi+OCr+ODqeOCueOAglxuICAgICAqIOOCsuODvOODoOmWi+eZuuiAheOBjOOBk+OBruOCr+ODqeOCueOBruOCpOODs+OCueOCv+ODs+OCueOCkuebtOaOpeeUn+aIkOOBmeOCi+OBk+OBqOOBr+OBquOBj+OAgVxuICAgICAqIOacrOOCr+ODqeOCueOBruapn+iDveOCkuWIqeeUqOOBmeOCi+OBk+OBqOOCguOBquOBhOOAglxuICAgICAqL1xuICAgIHZhciBTdG9yYWdlTG9hZGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgICAgICBmdW5jdGlvbiBTdG9yYWdlTG9hZGVyKHN0b3JhZ2UsIGtleXMsIHNlcmlhbGl6YXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMuX2xvYWRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5fc3RvcmFnZSA9IHN0b3JhZ2U7XG4gICAgICAgICAgICB0aGlzLl92YWx1ZVN0b3JlID0gbmV3IFN0b3JhZ2VWYWx1ZVN0b3JlKGtleXMpO1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuX3ZhbHVlU3RvcmVTZXJpYWxpemF0aW9uID0gc2VyaWFsaXphdGlvbjtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIFN0b3JhZ2VMb2FkZXIucHJvdG90eXBlLl9sb2FkID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZXIgPSBoYW5kbGVyO1xuICAgICAgICAgICAgaWYgKHRoaXMuX3N0b3JhZ2UuX2xvYWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdG9yYWdlLl9sb2FkLmNhbGwodGhpcy5fc3RvcmFnZSwgdGhpcy5fdmFsdWVTdG9yZS5fa2V5cywgdGhpcywgdGhpcy5fdmFsdWVTdG9yZVNlcmlhbGl6YXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIC8vIOWApOOBruWPluW+l+OBjOWujOS6huOBl+OBn+OCv+OCpOODn+ODs+OCsOOBp+WRvOOBs+WHuuOBleOCjOOCi+OAglxuICAgICAgICAvLyBgdmFsdWVzYCDjga8gYHRoaXMuX3ZhbHVlU3RvcmUuX2tleXNgIOOBq+WvvuW/nOOBmeOCi+WApOOCkuihqOOBmSBgU3RvcmFnZVZhbHVlYCDjga7phY3liJfjgIJcbiAgICAgICAgLy8g6aCG55Wq44GvIGB0aGlzLl92YWx1ZVN0b3JlLl9rZXlzYCDjgajlkIzjgZjjgafjgarjgZHjgozjgbDjgarjgonjgarjgYTjgIJcbiAgICAgICAgU3RvcmFnZUxvYWRlci5wcm90b3R5cGUuX29uTG9hZGVkID0gZnVuY3Rpb24gKHZhbHVlcywgc2VyaWFsaXphdGlvbikge1xuICAgICAgICAgICAgdGhpcy5fdmFsdWVTdG9yZS5fdmFsdWVzID0gdmFsdWVzO1xuICAgICAgICAgICAgdGhpcy5fbG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmIChzZXJpYWxpemF0aW9uKVxuICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlU3RvcmVTZXJpYWxpemF0aW9uID0gc2VyaWFsaXphdGlvbjtcbiAgICAgICAgICAgIGlmICh0aGlzLl9oYW5kbGVyKVxuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXIuX29uU3RvcmFnZUxvYWRlZCgpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIFN0b3JhZ2VMb2FkZXIucHJvdG90eXBlLl9vbkVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5faGFuZGxlcilcbiAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVyLl9vblN0b3JhZ2VMb2FkRXJyb3IoZXJyb3IpO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gU3RvcmFnZUxvYWRlcjtcbiAgICB9KCkpO1xuICAgIGcuU3RvcmFnZUxvYWRlciA9IFN0b3JhZ2VMb2FkZXI7XG4gICAgLyoqXG4gICAgICog44K544OI44Os44O844K444CCXG4gICAgICog44Ky44O844Og6ZaL55m66ICF44GM44GT44Gu44Kv44Op44K544Gu44Kk44Oz44K544K/44Oz44K544KS55u05o6l55Sf5oiQ44GZ44KL44GT44Go44Gv44Gq44GE44CCXG4gICAgICovXG4gICAgdmFyIFN0b3JhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIFN0b3JhZ2UoZ2FtZSkge1xuICAgICAgICAgICAgdGhpcy5fZ2FtZSA9IGdhbWU7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOCueODiOODrOODvOOCuOOBq+WApOOCkuabuOOBjei+vOOCgOOAglxuICAgICAgICAgKiBAcGFyYW0ga2V5IOOCueODiOODrOODvOOCuOOCreODvOOCkuihqOOBmSBgU3RvcmFnZUtleWBcbiAgICAgICAgICogQHBhcmFtIHZhbHVlIOWApOOCkuihqOOBmSBgU3RvcmFnZVZhbHVlYFxuICAgICAgICAgKiBAcGFyYW0gb3B0aW9uIOabuOOBjei+vOOBv+OCquODl+OCt+ODp+ODs1xuICAgICAgICAgKi9cbiAgICAgICAgU3RvcmFnZS5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSwgb3B0aW9uKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fd3JpdGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl93cml0ZShrZXksIHZhbHVlLCBvcHRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog5Y+C5Yqg44GX44Gm44GP44KL44OX44Os44Kk44Ok44O844Gu5YCk44KS44K544OI44Os44O844K444GL44KJ5Y+W5b6X44GZ44KL44GT44Go44KS6KaB5rGC44GZ44KL44CCXG4gICAgICAgICAqIOWPluW+l+OBl+OBn+WApOOBryBgSm9pbkV2ZW50I3N0b3JhZ2VWYWx1ZXNgIOOBq+agvOe0jeOBleOCjOOCi+OAglxuICAgICAgICAgKiBAcGFyYW0ga2V5cyDjgrnjg4jjg6zjg7zjgrjjgq3jg7zjgpLooajjgZkgYFN0b3JhZ2VSZWFkS2V5YCDjga7phY3liJfjgIJgU3RvcmFnZVJlYWRLZXkjdXNlcklkYCDjga/nhKHoppbjgZXjgozjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIFN0b3JhZ2UucHJvdG90eXBlLnJlcXVlc3RWYWx1ZXNGb3JKb2luUGxheWVyID0gZnVuY3Rpb24gKGtleXMpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RlZEtleXNGb3JKb2luUGxheWVyID0ga2V5cztcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBTdG9yYWdlLnByb3RvdHlwZS5fY3JlYXRlTG9hZGVyID0gZnVuY3Rpb24gKGtleXMsIHNlcmlhbGl6YXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgU3RvcmFnZUxvYWRlcih0aGlzLCBrZXlzLCBzZXJpYWxpemF0aW9uKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICAvLyDjgrnjg4jjg6zjg7zjgrjjgavlgKTjga7mm7jjgY3ovrzjgoDjgpLooYzjgYbplqLmlbDjgpLnmbvpjLLjgZnjgovjgIJcbiAgICAgICAgLy8g55m76Yyy44GX44Gf6Zai5pWw5YaF44GuIGB0aGlzYCDjga8gYFN0b3JhZ2VgIOOCkuaMh+OBmeOAglxuICAgICAgICBTdG9yYWdlLnByb3RvdHlwZS5fcmVnaXN0ZXJXcml0ZSA9IGZ1bmN0aW9uICh3cml0ZSkge1xuICAgICAgICAgICAgdGhpcy5fd3JpdGUgPSB3cml0ZTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICAvLyDjgrnjg4jjg6zjg7zjgrjjgYvjgonlgKTjga7oqq3jgb/ovrzjgb/jgpLooYzjgYbplqLmlbDjgpLnmbvpjLLjgZnjgovjgIJcbiAgICAgICAgLy8g55m76Yyy44GX44Gf6Zai5pWw5YaF44GuIGB0aGlzYCDjga8gYFN0b3JhZ2VgIOOCkuaMh+OBmeOAglxuICAgICAgICAvLyDoqq3jgb/ovrzjgb/lrozkuobjgZfjgZ/loLTlkIjjga/jgIHnmbvpjLLjgZfjgZ/plqLmlbDlhoXjgacgYGxvYWRlci5fb25Mb2FkZWQodmFsdWVzKWAg44KS5ZG844Gw44Gq44GR44KM44Gw44Gq44KJ44Gq44GE44CCXG4gICAgICAgIC8vIOOCqOODqeODvOOBjOeZuueUn+OBl+OBn+WgtOWQiOOBr+OAgeeZu+mMsuOBl+OBn+mWouaVsOWGheOBpyBgbG9hZGVyLl9vbkVycm9yKGVycm9yKWAg44KS5ZG844Gw44Gq44GR44KM44Gw44Gq44KJ44Gq44GE44CCXG4gICAgICAgIFN0b3JhZ2UucHJvdG90eXBlLl9yZWdpc3RlckxvYWQgPSBmdW5jdGlvbiAobG9hZCkge1xuICAgICAgICAgICAgdGhpcy5fbG9hZCA9IGxvYWQ7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBTdG9yYWdlO1xuICAgIH0oKSk7XG4gICAgZy5TdG9yYWdlID0gU3RvcmFnZTtcbn0pKGcgfHwgKGcgPSB7fSkpO1xudmFyIGc7XG4oZnVuY3Rpb24gKGcpIHtcbiAgICAvKipcbiAgICAgKiDjgrfjg7zjg7Pjga7jgqLjgrvjg4Pjg4jjga7oqq3jgb/ovrzjgb/jgajnoLTmo4TjgpLnrqHnkIbjgZnjgovjgq/jg6njgrnjgIJcbiAgICAgKiDmnKzjgq/jg6njgrnjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLjgrLjg7zjg6DplovnmbrogIXjgYznm7TmjqXnlJ/miJDjgZnjgovjgZPjgajjga/jgarjgY/jgIHjgrLjg7zjg6DplovnmbrogIXjgYzliKnnlKjjgZnjgovlv4XopoHjgoLjgarjgYTjgIJcbiAgICAgKi9cbiAgICB2YXIgU2NlbmVBc3NldEhvbGRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gU2NlbmVBc3NldEhvbGRlcihwYXJhbSkge1xuICAgICAgICAgICAgdGhpcy53YWl0aW5nQXNzZXRzQ291bnQgPSBwYXJhbS5hc3NldElkcy5sZW5ndGg7XG4gICAgICAgICAgICB0aGlzLl9zY2VuZSA9IHBhcmFtLnNjZW5lO1xuICAgICAgICAgICAgdGhpcy5fYXNzZXRNYW5hZ2VyID0gcGFyYW0uYXNzZXRNYW5hZ2VyO1xuICAgICAgICAgICAgdGhpcy5fYXNzZXRJZHMgPSBwYXJhbS5hc3NldElkcztcbiAgICAgICAgICAgIHRoaXMuX2Fzc2V0cyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlciA9IHBhcmFtLmhhbmRsZXI7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVyT3duZXIgPSBwYXJhbS5oYW5kbGVyT3duZXIgfHwgbnVsbDtcbiAgICAgICAgICAgIHRoaXMuX2RpcmVjdCA9ICEhcGFyYW0uZGlyZWN0O1xuICAgICAgICAgICAgdGhpcy5fcmVxdWVzdGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgU2NlbmVBc3NldEhvbGRlci5wcm90b3R5cGUucmVxdWVzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLndhaXRpbmdBc3NldHNDb3VudCA9PT0gMClcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy5fcmVxdWVzdGVkKVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fcmVxdWVzdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuX2Fzc2V0TWFuYWdlci5yZXF1ZXN0QXNzZXRzKHRoaXMuX2Fzc2V0SWRzLCB0aGlzKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICBTY2VuZUFzc2V0SG9sZGVyLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX3JlcXVlc3RlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2Fzc2V0TWFuYWdlci51bnJlZkFzc2V0cyh0aGlzLl9hc3NldHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy53YWl0aW5nQXNzZXRzQ291bnQgPSAwO1xuICAgICAgICAgICAgdGhpcy5fc2NlbmUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl9hc3NldElkcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl9yZXF1ZXN0ZWQgPSBmYWxzZTtcbiAgICAgICAgfTtcbiAgICAgICAgU2NlbmVBc3NldEhvbGRlci5wcm90b3R5cGUuZGVzdHJveWVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICF0aGlzLl9zY2VuZTtcbiAgICAgICAgfTtcbiAgICAgICAgU2NlbmVBc3NldEhvbGRlci5wcm90b3R5cGUuY2FsbEhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVyLmNhbGwodGhpcy5faGFuZGxlck93bmVyKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBTY2VuZUFzc2V0SG9sZGVyLnByb3RvdHlwZS5fb25Bc3NldEVycm9yID0gZnVuY3Rpb24gKGFzc2V0LCBlcnJvciwgYXNzZXRNYW5hZ2VyKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kZXN0cm95ZWQoKSB8fCB0aGlzLl9zY2VuZS5kZXN0cm95ZWQoKSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB2YXIgZmFpbHVyZUluZm8gPSB7XG4gICAgICAgICAgICAgICAgYXNzZXQ6IGFzc2V0LFxuICAgICAgICAgICAgICAgIGVycm9yOiBlcnJvcixcbiAgICAgICAgICAgICAgICBjYW5jZWxSZXRyeTogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLl9zY2VuZS5hc3NldExvYWRGYWlsZWQuZmlyZShmYWlsdXJlSW5mbyk7XG4gICAgICAgICAgICBpZiAoZXJyb3IucmV0cmlhYmxlICYmICFmYWlsdXJlSW5mby5jYW5jZWxSZXRyeSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2Fzc2V0TWFuYWdlci5yZXRyeUxvYWQoYXNzZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gZ2FtZS5qc29uIOOBq+Wumue+qeOBleOCjOOBpuOBhOOCjOOBsOOCsuODvOODoOOCkuatouOCgeOCi+OAguOBneOCjOS7peWkliAoRHluYW1pY0Fzc2V0KSDjgafjga/ntprooYzjgIJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYXNzZXRNYW5hZ2VyLmNvbmZpZ3VyYXRpb25bYXNzZXQuaWRdKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NjZW5lLmdhbWUudGVybWluYXRlR2FtZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zY2VuZS5nYW1lLl9hYm9ydEdhbWUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9zY2VuZS5hc3NldExvYWRDb21wbGV0ZWQuZmlyZShhc3NldCk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgU2NlbmVBc3NldEhvbGRlci5wcm90b3R5cGUuX29uQXNzZXRMb2FkID0gZnVuY3Rpb24gKGFzc2V0KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kZXN0cm95ZWQoKSB8fCB0aGlzLl9zY2VuZS5kZXN0cm95ZWQoKSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB0aGlzLl9zY2VuZS5hc3NldHNbYXNzZXQuaWRdID0gYXNzZXQ7XG4gICAgICAgICAgICB0aGlzLl9zY2VuZS5hc3NldExvYWRlZC5maXJlKGFzc2V0KTtcbiAgICAgICAgICAgIHRoaXMuX3NjZW5lLmFzc2V0TG9hZENvbXBsZXRlZC5maXJlKGFzc2V0KTtcbiAgICAgICAgICAgIHRoaXMuX2Fzc2V0cy5wdXNoKGFzc2V0KTtcbiAgICAgICAgICAgIC0tdGhpcy53YWl0aW5nQXNzZXRzQ291bnQ7XG4gICAgICAgICAgICBpZiAodGhpcy53YWl0aW5nQXNzZXRzQ291bnQgPCAwKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIlNjZW5lQXNzZXRIb2xkZXIjX29uQXNzZXRMb2FkOiBicm9rZW4gd2FpdGluZ0Fzc2V0c0NvdW50XCIpO1xuICAgICAgICAgICAgaWYgKHRoaXMud2FpdGluZ0Fzc2V0c0NvdW50ID4gMClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBpZiAodGhpcy5fZGlyZWN0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYWxsSGFuZGxlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2NlbmUuZ2FtZS5fY2FsbFNjZW5lQXNzZXRIb2xkZXJIYW5kbGVyKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gU2NlbmVBc3NldEhvbGRlcjtcbiAgICB9KCkpO1xuICAgIGcuU2NlbmVBc3NldEhvbGRlciA9IFNjZW5lQXNzZXRIb2xkZXI7XG4gICAgLyoqXG4gICAgICog44Gd44GuU2NlbmXjga7nirbmhYvjgpLooajjgZnliJfmjJnlrZDjgIJcbiAgICAgKlxuICAgICAqIC0gRGVzdHJveWVkOiDjgZnjgafjgavnoLTmo4TjgZXjgozjgabjgYTjgovjgrfjg7zjg7PjgafjgIHlho3liKnnlKjjgYzkuI3lj6/og73jgavjgarjgaPjgabjgYTjgovnirbmhYvjgpLooajjgZlcbiAgICAgKiAtIFN0YW5kYnk6IOWIneacn+WMluOBleOCjOOBn+eKtuaFi+OBruOCt+ODvOODs+OBp+OAgeOCt+ODvOODs+OCueOCv+ODg+OCr+OBuOi/veWKoOOBleOCjOOCi+OBk+OBqOOCkuW+heOBo+OBpuOBhOOCi+eKtuaFi+OCkuihqOOBmVxuICAgICAqIC0gQWN0aXZlOiDjgrfjg7zjg7Pjgrnjgr/jg4Pjgq/jga7kuIDnlarkuIrjgavjgYTjgovjgrfjg7zjg7PjgafjgIHjgrLjg7zjg6Djga7jgqvjg6zjg7Pjg4jjgrfjg7zjg7PjgajjgZfjgabmtLvmgKfljJbjgZXjgozjgabjgYTjgovnirbmhYvjgpLooajjgZlcbiAgICAgKiAtIERlYWN0aXZlOiDjgrfjg7zjg7Pjgrnjgr/jg4Pjgq/jgavjgYTjgovjgYzkuIDnlarkuIrjgafjga/jgarjgYTjgrfjg7zjg7PjgafjgIHoo4/lgbTjgafpnZ7mtLvmgKfnirbmhYvjgavjgarjgaPjgabjgYTjgovjgZPjgajjgpLooajjgZlcbiAgICAgKiAtIEJlZm9yZURlc3Ryb3llZDog44GT44KM44GL44KJ56C05qOE44GV44KM44KL44K344O844Oz44Gn44CB5YaN5Yip55So44GM5LiN5Y+v6IO944Gr44Gq44Gj44Gm44GE44KL54q25oWL44KS6KGo44GZXG4gICAgICovXG4gICAgdmFyIFNjZW5lU3RhdGU7XG4gICAgKGZ1bmN0aW9uIChTY2VuZVN0YXRlKSB7XG4gICAgICAgIFNjZW5lU3RhdGVbU2NlbmVTdGF0ZVtcIkRlc3Ryb3llZFwiXSA9IDBdID0gXCJEZXN0cm95ZWRcIjtcbiAgICAgICAgU2NlbmVTdGF0ZVtTY2VuZVN0YXRlW1wiU3RhbmRieVwiXSA9IDFdID0gXCJTdGFuZGJ5XCI7XG4gICAgICAgIFNjZW5lU3RhdGVbU2NlbmVTdGF0ZVtcIkFjdGl2ZVwiXSA9IDJdID0gXCJBY3RpdmVcIjtcbiAgICAgICAgU2NlbmVTdGF0ZVtTY2VuZVN0YXRlW1wiRGVhY3RpdmVcIl0gPSAzXSA9IFwiRGVhY3RpdmVcIjtcbiAgICAgICAgU2NlbmVTdGF0ZVtTY2VuZVN0YXRlW1wiQmVmb3JlRGVzdHJveWVkXCJdID0gNF0gPSBcIkJlZm9yZURlc3Ryb3llZFwiO1xuICAgIH0pKFNjZW5lU3RhdGUgPSBnLlNjZW5lU3RhdGUgfHwgKGcuU2NlbmVTdGF0ZSA9IHt9KSk7XG4gICAgdmFyIFNjZW5lTG9hZFN0YXRlO1xuICAgIChmdW5jdGlvbiAoU2NlbmVMb2FkU3RhdGUpIHtcbiAgICAgICAgU2NlbmVMb2FkU3RhdGVbU2NlbmVMb2FkU3RhdGVbXCJJbml0aWFsXCJdID0gMF0gPSBcIkluaXRpYWxcIjtcbiAgICAgICAgU2NlbmVMb2FkU3RhdGVbU2NlbmVMb2FkU3RhdGVbXCJSZWFkeVwiXSA9IDFdID0gXCJSZWFkeVwiO1xuICAgICAgICBTY2VuZUxvYWRTdGF0ZVtTY2VuZUxvYWRTdGF0ZVtcIlJlYWR5RmlyZWRcIl0gPSAyXSA9IFwiUmVhZHlGaXJlZFwiO1xuICAgICAgICBTY2VuZUxvYWRTdGF0ZVtTY2VuZUxvYWRTdGF0ZVtcIkxvYWRlZEZpcmVkXCJdID0gM10gPSBcIkxvYWRlZEZpcmVkXCI7XG4gICAgfSkoU2NlbmVMb2FkU3RhdGUgPSBnLlNjZW5lTG9hZFN0YXRlIHx8IChnLlNjZW5lTG9hZFN0YXRlID0ge30pKTtcbiAgICAvKipcbiAgICAgKiDjgrfjg7zjg7PjgpLooajjgZnjgq/jg6njgrnjgIJcbiAgICAgKi9cbiAgICB2YXIgU2NlbmUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlkITnqK7jg5Hjg6njg6Hjg7zjgr/jgpLmjIflrprjgZfjgaYgYFNjZW5lYCDjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLnlJ/miJDjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHBhcmFtIOWIneacn+WMluOBq+eUqOOBhOOCi+ODkeODqeODoeODvOOCv+OBruOCquODluOCuOOCp+OCr+ODiFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gU2NlbmUocGFyYW0pIHtcbiAgICAgICAgICAgIHZhciBnYW1lO1xuICAgICAgICAgICAgdmFyIGxvY2FsO1xuICAgICAgICAgICAgdmFyIHRpY2tHZW5lcmF0aW9uTW9kZTtcbiAgICAgICAgICAgIHZhciBhc3NldElkcztcbiAgICAgICAgICAgIGdhbWUgPSBwYXJhbS5nYW1lO1xuICAgICAgICAgICAgYXNzZXRJZHMgPSBwYXJhbS5hc3NldElkcztcbiAgICAgICAgICAgIGlmICghcGFyYW0uc3RvcmFnZUtleXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdG9yYWdlTG9hZGVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcmFnZVZhbHVlcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX3N0b3JhZ2VMb2FkZXIgPSBnYW1lLnN0b3JhZ2UuX2NyZWF0ZUxvYWRlcihwYXJhbS5zdG9yYWdlS2V5cywgcGFyYW0uc3RvcmFnZVZhbHVlc1NlcmlhbGl6YXRpb24pO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcmFnZVZhbHVlcyA9IHRoaXMuX3N0b3JhZ2VMb2FkZXIuX3ZhbHVlU3RvcmU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsb2NhbCA9IChwYXJhbS5sb2NhbCA9PT0gdW5kZWZpbmVkKSA/IGcuTG9jYWxUaWNrTW9kZS5Ob25Mb2NhbFxuICAgICAgICAgICAgICAgIDogKHBhcmFtLmxvY2FsID09PSBmYWxzZSkgPyBnLkxvY2FsVGlja01vZGUuTm9uTG9jYWxcbiAgICAgICAgICAgICAgICAgICAgOiAocGFyYW0ubG9jYWwgPT09IHRydWUpID8gZy5Mb2NhbFRpY2tNb2RlLkZ1bGxMb2NhbFxuICAgICAgICAgICAgICAgICAgICAgICAgOiBwYXJhbS5sb2NhbDtcbiAgICAgICAgICAgIHRpY2tHZW5lcmF0aW9uTW9kZSA9IChwYXJhbS50aWNrR2VuZXJhdGlvbk1vZGUgIT09IHVuZGVmaW5lZCkgPyBwYXJhbS50aWNrR2VuZXJhdGlvbk1vZGUgOiBnLlRpY2tHZW5lcmF0aW9uTW9kZS5CeUNsb2NrO1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gcGFyYW0ubmFtZTtcbiAgICAgICAgICAgIGlmICghYXNzZXRJZHMpXG4gICAgICAgICAgICAgICAgYXNzZXRJZHMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG4gICAgICAgICAgICB0aGlzLmxvY2FsID0gbG9jYWw7XG4gICAgICAgICAgICB0aGlzLnRpY2tHZW5lcmF0aW9uTW9kZSA9IHRpY2tHZW5lcmF0aW9uTW9kZTtcbiAgICAgICAgICAgIHRoaXMubG9hZGVkID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICAgICAgdGhpcy5fcmVhZHkgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgICAgICB0aGlzLmFzc2V0cyA9IHt9O1xuICAgICAgICAgICAgdGhpcy5fbG9hZGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLl9wcmVmZXRjaFJlcXVlc3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5fbG9hZGluZ1N0YXRlID0gU2NlbmVMb2FkU3RhdGUuSW5pdGlhbDtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICAgICAgdGhpcy5fdGltZXIgPSBuZXcgZy5UaW1lck1hbmFnZXIodGhpcy51cGRhdGUsIHRoaXMuZ2FtZS5mcHMpO1xuICAgICAgICAgICAgdGhpcy5hc3NldExvYWRlZCA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgICAgIHRoaXMuYXNzZXRMb2FkRmFpbGVkID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICAgICAgdGhpcy5hc3NldExvYWRDb21wbGV0ZWQgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgICAgICB0aGlzLnBvaW50RG93bkNhcHR1cmUgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgICAgICB0aGlzLnBvaW50TW92ZUNhcHR1cmUgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgICAgICB0aGlzLnBvaW50VXBDYXB0dXJlID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICAgICAgdGhpcy5vcGVyYXRpb24gPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuID0gW107XG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gU2NlbmVTdGF0ZS5TdGFuZGJ5O1xuICAgICAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZWQgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgICAgICB0aGlzLl9hc3NldEhvbGRlcnMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuX3NjZW5lQXNzZXRIb2xkZXIgPSBuZXcgU2NlbmVBc3NldEhvbGRlcih7XG4gICAgICAgICAgICAgICAgc2NlbmU6IHRoaXMsXG4gICAgICAgICAgICAgICAgYXNzZXRNYW5hZ2VyOiB0aGlzLmdhbWUuX2Fzc2V0TWFuYWdlcixcbiAgICAgICAgICAgICAgICBhc3NldElkczogYXNzZXRJZHMsXG4gICAgICAgICAgICAgICAgaGFuZGxlcjogdGhpcy5fb25TY2VuZUFzc2V0c0xvYWQsXG4gICAgICAgICAgICAgICAgaGFuZGxlck93bmVyOiB0aGlzLFxuICAgICAgICAgICAgICAgIGRpcmVjdDogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBruOCt+ODvOODs+OBjOWkieabtOOBleOCjOOBn+OBk+OBqOOCkuOCqOODs+OCuOODs+OBq+mAmuefpeOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga/jgIHjgZPjga7jgrfjg7zjg7PjgavntJDjgaXjgYTjgabjgYTjgosgYEVgIOOBriBgbW9kaWZpZWQoKWAg44KS5ZG844Gz5Ye644GZ44GT44Go44Gn5pqX6buZ44Gr5ZG844Gz5Ye644GV44KM44KL44CCXG4gICAgICAgICAqIOmAmuW4uOOAgeOCsuODvOODoOmWi+eZuuiAheOBjOOBk+OBruODoeOCveODg+ODieOCkuWRvOOBs+WHuuOBmeW/heimgeOBr+OBquOBhOOAglxuICAgICAgICAgKiBAcGFyYW0gaXNCdWJibGluZyDjgZPjga7plqLmlbDjgpLjgZPjga7jgrfjg7zjg7Pjga7lrZDjga4gYG1vZGlmaWVkKClgIOOBi+OCieWRvOOBs+WHuuOBmeWgtOWQiOOAgeecn+OCkua4oeOBleOBquOBj+OBpuOBr+OBquOCieOBquOBhOOAguecgeeVpeOBleOCjOOBn+WgtOWQiOOAgeWBveOAglxuICAgICAgICAgKi9cbiAgICAgICAgU2NlbmUucHJvdG90eXBlLm1vZGlmaWVkID0gZnVuY3Rpb24gKGlzQnViYmxpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuZ2FtZS5tb2RpZmllZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga7jgrfjg7zjg7PjgpLnoLTmo4TjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog56C05qOE5Yem55CG44Gu6ZaL5aeL5pmC44Gr44CB44GT44Gu44K344O844Oz44GuIGBzdGF0ZUNoYW5nZWRgIOOBjOW8leaVsCBgQmVmb3JlRGVzdHJveWVkYCDjgadmaXJl44GV44KM44KL44CCXG4gICAgICAgICAqIOegtOajhOWHpueQhuOBrue1guS6huaZguOBq+OAgeOBk+OBruOCt+ODvOODs+OBriBgc3RhdGVDaGFuZ2VkYCDjgYzlvJXmlbAgYERlc3Ryb3llZGAg44GnZmlyZeOBleOCjOOCi+OAglxuICAgICAgICAgKiDjgZPjga7jgrfjg7zjg7PjgavntJDjgaXjgYTjgabjgYTjgovlhajjgabjga4gYEVgIOOBqOWFqOOBpuOBrlRpbWVy44Gv56C05qOE44GV44KM44KL44CCXG4gICAgICAgICAqIGBTY2VuZSNzZXRJbnRlcnZhbCgpYCwgYFNjZW5lI3NldFRpbWVvdXQoKWAg44Gr5rih44GV44KM44Gf6Zai5pWw44Gv5ZG844Gz5Ye644GV44KM44Gq44GP44Gq44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBryBgU2NlbmUjZW5kYCDjgoQgYEdhbWUjcG9wU2NlbmVgIOOBquOBqeOBq+OCiOOBo+OBpuimgeaxguOBleOCjOOBn+OCt+ODvOODs+OBrumBt+enu+aZguOBq+aal+m7meOBq+WRvOOBs+WHuuOBleOCjOOCi+OAglxuICAgICAgICAgKiDpgJrluLjjgIHjgrLjg7zjg6DplovnmbrogIXjgYzjgZPjga7jg6Hjgr3jg4Pjg4njgpLlkbzjgbPlh7rjgZnlv4XopoHjga/jgarjgYTjgIJcbiAgICAgICAgICovXG4gICAgICAgIFNjZW5lLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IFNjZW5lU3RhdGUuQmVmb3JlRGVzdHJveWVkO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZWQuZmlyZSh0aGlzLnN0YXRlKTtcbiAgICAgICAgICAgIC8vIFRPRE86IChHQU1FREVWLTQ4MykgU2NlbmXjgrnjgr/jg4Pjgq/jgYzjgZ3jgozjgarjgorjga7ph4/jgavjgarjgovjgajph43jgY/jgarjgovjga7jgadTY2VuZSNkYuOBjOW/heimgeOBi+OCguOBl+OCjOOBquOBhFxuICAgICAgICAgICAgdmFyIGdhbWVEYiA9IHRoaXMuZ2FtZS5kYjtcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gZ2FtZURiKSB7XG4gICAgICAgICAgICAgICAgaWYgKGdhbWVEYi5oYXNPd25Qcm9wZXJ0eShwKSAmJiBnYW1lRGJbcF0uc2NlbmUgPT09IHRoaXMpXG4gICAgICAgICAgICAgICAgICAgIGdhbWVEYltwXS5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZ2FtZURiID0gdGhpcy5nYW1lLl9sb2NhbERiO1xuICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBnYW1lRGIpIHtcbiAgICAgICAgICAgICAgICBpZiAoZ2FtZURiLmhhc093blByb3BlcnR5KHApICYmIGdhbWVEYltwXS5zY2VuZSA9PT0gdGhpcylcbiAgICAgICAgICAgICAgICAgICAgZ2FtZURiW3BdLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3RpbWVyLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZS5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLnBvaW50RG93bkNhcHR1cmUuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5wb2ludE1vdmVDYXB0dXJlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMucG9pbnRVcENhcHR1cmUuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5vcGVyYXRpb24uZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5sb2FkZWQuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5hc3NldExvYWRlZC5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLmFzc2V0TG9hZEZhaWxlZC5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLmFzc2V0TG9hZENvbXBsZXRlZC5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLmFzc2V0cyA9IHt9O1xuICAgICAgICAgICAgLy8g44Ki44K744OD44OI44KS5Y+C54Wn44GX44Gm44GE44KLReOCiOOCiuWFiOOBq+ino+aUvuOBl+OBquOBhOOCiOOBhuacgOW+jOOBq+ino+aUvuOBmeOCi1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9hc3NldEhvbGRlcnMubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgdGhpcy5fYXNzZXRIb2xkZXJzW2ldLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMuX3NjZW5lQXNzZXRIb2xkZXIuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5fc3RvcmFnZUxvYWRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuZ2FtZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBTY2VuZVN0YXRlLkRlc3Ryb3llZDtcbiAgICAgICAgICAgIHRoaXMuc3RhdGVDaGFuZ2VkLmZpcmUodGhpcy5zdGF0ZSk7XG4gICAgICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlZC5kZXN0cm95KCk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDnoLTmo4TmuIjjgb/jgafjgYLjgovjgYvjgpLov5TjgZnjgIJcbiAgICAgICAgICovXG4gICAgICAgIFNjZW5lLnByb3RvdHlwZS5kZXN0cm95ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nYW1lID09PSB1bmRlZmluZWQ7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDkuIDlrprplpPpmpTjgaflrprmnJ/nmoTjgavlh6bnkIbjgpLlrp/ooYzjgZnjgotUaW1lcuOCkuS9nOaIkOOBl+OBpui/lOOBmeOAglxuICAgICAgICAgKlxuICAgICAgICAgKiDmiLvjgorlgKTjga/kvZzmiJDjgZXjgozjgZ9UaW1lcuOBp+OBguOCi+OAglxuICAgICAgICAgKiDpgJrluLjjga8gYFNjZW5lI3NldEludGVydmFsYCDjgpLliKnnlKjjgZnjgozjgbDjgojjgY/jgIHjgrLjg7zjg6DplovnmbrogIXjgYzjgZPjga7jg6Hjgr3jg4Pjg4njgpLlkbzjgbPlh7rjgZnlv4XopoHjga/jgarjgYTjgIJcbiAgICAgICAgICogYFRpbWVyYCDjga/jg5Xjg6zjg7zjg6DntYzpgY7lh6bnkIYoYFNjZW5lI3VwZGF0ZWAp44Gn5a6f54++44GV44KM44KL55aR5Ly855qE44Gq44K/44Kk44Oe44O844Gn44GC44KL44CC5a6f5pmC6ZaT44Gu5b2x6Z+/44Gv5Y+X44GR44Gq44GE44CCXG4gICAgICAgICAqIEBwYXJhbSBpbnRlcnZhbCBUaW1lcuOBruWun+ihjOmWk+malO+8iOODn+ODquenku+8iVxuICAgICAgICAgKi9cbiAgICAgICAgU2NlbmUucHJvdG90eXBlLmNyZWF0ZVRpbWVyID0gZnVuY3Rpb24gKGludGVydmFsKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdGltZXIuY3JlYXRlVGltZXIoaW50ZXJ2YWwpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogVGltZXLjgpLliYrpmaTjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHRpbWVyIOWJiumZpOOBmeOCi1RpbWVyXG4gICAgICAgICAqL1xuICAgICAgICBTY2VuZS5wcm90b3R5cGUuZGVsZXRlVGltZXIgPSBmdW5jdGlvbiAodGltZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX3RpbWVyLmRlbGV0ZVRpbWVyKHRpbWVyKTtcbiAgICAgICAgfTtcbiAgICAgICAgU2NlbmUucHJvdG90eXBlLnNldEludGVydmFsID0gZnVuY3Rpb24gKGhhbmRsZXIsIGludGVydmFsLCBvd25lcikge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLl90aW1lcjtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgaGFuZGxlciA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5sb2dnZXIud2FybihcIltkZXByZWNhdGVkXSBTY2VuZSNzZXRJbnRlcnZhbCgpOiB0aGlzIGFyZ3VtZW50cyBvcmRlcmluZyBpcyBub3cgZGVwcmVjYXRlZC4gU3BlY2lmeSB0aGUgZnVuY3Rpb24gZmlyc3QuXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiAob3duZXIgIT0gbnVsbCkgPyB0LnNldEludGVydmFsKG93bmVyIC8qIDIgKi8sIGhhbmRsZXIgLyogMCAqLywgaW50ZXJ2YWwgLyogMSAqLylcbiAgICAgICAgICAgICAgICAgICAgOiB0LnNldEludGVydmFsKGludGVydmFsIC8qIDEgKi8sIGhhbmRsZXIgLyogMCAqLywgbnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdC5zZXRJbnRlcnZhbChoYW5kbGVyLCBpbnRlcnZhbCwgb3duZXIpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogc2V0SW50ZXJ2YWzjgafkvZzmiJDjgZfjgZ/lrprmnJ/lh6bnkIbjgpLop6PpmaTjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIGlkZW50aWZpZXIg6Kej6Zmk5a++6LGhXG4gICAgICAgICAqL1xuICAgICAgICBTY2VuZS5wcm90b3R5cGUuY2xlYXJJbnRlcnZhbCA9IGZ1bmN0aW9uIChpZGVudGlmaWVyKSB7XG4gICAgICAgICAgICB0aGlzLl90aW1lci5jbGVhckludGVydmFsKGlkZW50aWZpZXIpO1xuICAgICAgICB9O1xuICAgICAgICBTY2VuZS5wcm90b3R5cGUuc2V0VGltZW91dCA9IGZ1bmN0aW9uIChoYW5kbGVyLCBtaWxsaXNlY29uZHMsIG93bmVyKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMuX3RpbWVyO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBoYW5kbGVyID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lLmxvZ2dlci53YXJuKFwiW2RlcHJlY2F0ZWRdIFNjZW5lI3NldFRpbWVvdXQoKTogdGhpcyBhcmd1bWVudHMgb3JkZXJpbmcgaXMgbm93IGRlcHJlY2F0ZWQuIFNwZWNpZnkgdGhlIGZ1bmN0aW9uIGZpcnN0LlwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gKG93bmVyICE9IG51bGwpID8gdC5zZXRUaW1lb3V0KG93bmVyIC8qIDIgKi8sIGhhbmRsZXIgLyogMCAqLywgbWlsbGlzZWNvbmRzIC8qIDEgKi8pXG4gICAgICAgICAgICAgICAgICAgIDogdC5zZXRUaW1lb3V0KG1pbGxpc2Vjb25kcyAvKiAxICovLCBoYW5kbGVyIC8qIDAgKi8sIG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHQuc2V0VGltZW91dChoYW5kbGVyLCBtaWxsaXNlY29uZHMsIG93bmVyKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHNldFRpbWVvdXTjgafkvZzmiJDjgZfjgZ/lh6bnkIbjgpLliYrpmaTjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIGlkZW50aWZpZXIg6Kej6Zmk5a++6LGhXG4gICAgICAgICAqL1xuICAgICAgICBTY2VuZS5wcm90b3R5cGUuY2xlYXJUaW1lb3V0ID0gZnVuY3Rpb24gKGlkZW50aWZpZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX3RpbWVyLmNsZWFyVGltZW91dChpZGVudGlmaWVyKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBruOCt+ODvOODs+OBjOePvuWcqOOBruOCt+ODvOODs+OBp+OBguOCi+OBi+OBqeOBhuOBi+OCkui/lOOBmeOAglxuICAgICAgICAgKi9cbiAgICAgICAgU2NlbmUucHJvdG90eXBlLmlzQ3VycmVudFNjZW5lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2FtZS5zY2VuZSgpID09PSB0aGlzO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog5qyh44Gu44K344O844Oz44G444Gu6YG356e744KS6KaB5rGC44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBr+OAgSBgdG9QdXNoYCDjgYznnJ/jgarjgonjgbAgYEdhbWUjcHVzaFNjZW5lKClgIOOBruOAgeOBp+OBquOBkeOCjOOBsCBgR2FtZSNyZXBsYWNlU2NlbmVgIOOBruOCqOOCpOODquOCouOCueOBp+OBguOCi+OAglxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga/opoHmsYLjgpLooYzjgYbjgaDjgZHjgafjgYLjgovjgILlkbzjgbPlh7rjgZfnm7Tlvozjgavjga/jgrfjg7zjg7Ppgbfnp7vjga/ooYzjgo/jgozjgabjgYTjgarjgYTjgZPjgajjgavms6jmhI/jgIJcbiAgICAgICAgICog44GT44Gu44K344O844Oz44GM54++5Zyo44Gu44K344O844Oz44Gn44Gq44GE5aC05ZCI44CBIGBBc3NlcnRpb25FcnJvcmAg44GMdGhyb3fjgZXjgozjgovjgIJcbiAgICAgICAgICogQHBhcmFtIG5leHQg6YG356e75b6M44Gu44K344O844OzXG4gICAgICAgICAqIEBwYXJhbSB0b1B1c2gg54++5Zyo44Gu44K344O844Oz44KS5q6L44GX44Gf44G+44G+44Gr44GZ44KL44Gq44KJ55yf44CB5YmK6Zmk44GX44Gm6YG356e744GZ44KL44Gq44KJ5YG944KS5oyH5a6a44GZ44KL44CC55yB55Wl44GV44KM44Gf5aC05ZCI5YG9XG4gICAgICAgICAqL1xuICAgICAgICBTY2VuZS5wcm90b3R5cGUuZ290b1NjZW5lID0gZnVuY3Rpb24gKG5leHQsIHRvUHVzaCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzQ3VycmVudFNjZW5lKCkpXG4gICAgICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiU2NlbmUjZ290b1NjZW5lOiB0aGlzIHNjZW5lIGlzIG5vdCB0aGUgY3VycmVudCBzY2VuZVwiKTtcbiAgICAgICAgICAgIGlmICh0b1B1c2gpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdhbWUucHVzaFNjZW5lKG5leHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lLnJlcGxhY2VTY2VuZShuZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBruOCt+ODvOODs+OBruWJiumZpOOBqOOAgeS4gOOBpOWJjeOBruOCt+ODvOODs+OBuOOBrumBt+enu+OCkuimgeaxguOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga8gYEdhbWUjcG9wU2NlbmUoKWAg44Gu44Ko44Kk44Oq44Ki44K544Gn44GC44KL44CCXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBr+imgeaxguOCkuihjOOBhuOBoOOBkeOBp+OBguOCi+OAguWRvOOBs+WHuuOBl+ebtOW+jOOBq+OBr+OCt+ODvOODs+mBt+enu+OBr+ihjOOCj+OCjOOBpuOBhOOBquOBhOOBk+OBqOOBq+azqOaEj+OAglxuICAgICAgICAgKiDjgZPjga7jgrfjg7zjg7PjgYznj77lnKjjga7jgrfjg7zjg7PjgafjgarjgYTloLTlkIjjgIEgYEFzc2VydGlvbkVycm9yYCDjgYx0aHJvd+OBleOCjOOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgU2NlbmUucHJvdG90eXBlLmVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0N1cnJlbnRTY2VuZSgpKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIlNjZW5lI2VuZDogdGhpcyBzY2VuZSBpcyBub3QgdGhlIGN1cnJlbnQgc2NlbmVcIik7XG4gICAgICAgICAgICB0aGlzLmdhbWUucG9wU2NlbmUoKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBrlNjZW5l44Gr44Ko44Oz44OG44Kj44OG44Kj44KS55m76Yyy44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBr+WQhOOCqOODs+ODhuOCo+ODhuOCo+OBq+WvvuOBl+OBpuaal+m7meOBq+WRvOOBs+WHuuOBleOCjOOCi+OAguOCsuODvOODoOmWi+eZuuiAheOBjOOBk+OBruODoeOCveODg+ODieOCkuaYjuekuueahOOBq+WRvOOBs+WHuuOBmeW/heimgeOBr+OBquOBhOOAglxuICAgICAgICAgKiBAcGFyYW0gZSDnmbvpjLLjgZnjgovjgqjjg7Pjg4bjgqPjg4bjgqNcbiAgICAgICAgICovXG4gICAgICAgIFNjZW5lLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICB0aGlzLmdhbWUucmVnaXN0ZXIoZSk7XG4gICAgICAgICAgICBlLnNjZW5lID0gdGhpcztcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBrlNjZW5l44GL44KJ44Ko44Oz44OG44Kj44OG44Kj44Gu55m76Yyy44KS5YmK6Zmk44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBr+WQhOOCqOODs+ODhuOCo+ODhuOCo+OBq+WvvuOBl+OBpuaal+m7meOBq+WRvOOBs+WHuuOBleOCjOOCi+OAguOCsuODvOODoOmWi+eZuuiAheOBjOOBk+OBruODoeOCveODg+ODieOCkuaYjuekuueahOOBq+WRvOOBs+WHuuOBmeW/heimgeOBr+OBquOBhOOAglxuICAgICAgICAgKiBAcGFyYW0gZSDnmbvpjLLjgpLliYrpmaTjgZnjgovjgqjjg7Pjg4bjgqPjg4bjgqNcbiAgICAgICAgICovXG4gICAgICAgIFNjZW5lLnByb3RvdHlwZS51bnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUuc2NlbmUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLmdhbWUudW5yZWdpc3RlcihlKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOWtkOOCqOODs+ODhuOCo+ODhuOCo+OCkui/veWKoOOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiBgdGhpcy5jaGlsZHJlbmAg44Gu5pyr5bC+44GrIGBlYCDjgpLov73liqDjgZnjgosoYGVgIOOBr+OBneOCjOOBvuOBp+OBq+i/veWKoOOBleOCjOOBn+OBmeOBueOBpuOBruWtkOOCqOODs+ODhuOCo+ODhuOCo+OCiOOCiuaJi+WJjeOBq+ihqOekuuOBleOCjOOCiynjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIGUg5a2Q44Ko44Oz44OG44Kj44OG44Kj44Go44GX44Gm6L+95Yqg44GZ44KL44Ko44Oz44OG44Kj44OG44KjXG4gICAgICAgICAqL1xuICAgICAgICBTY2VuZS5wcm90b3R5cGUuYXBwZW5kID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0QmVmb3JlKGUsIHVuZGVmaW5lZCk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlrZDjgqjjg7Pjg4bjgqPjg4bjgqPjgpLmjL/lhaXjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogYHRoaXMuY2hpbGRyZW5gIOOBrmB0YXJnZXRg44Gu5L2N572u44GrIGBlYCDjgpLmjL/lhaXjgZnjgovjgIJcbiAgICAgICAgICogYHRhcmdldGAg44GMYHRoaXNgIOOBruWtkOOBp+OBquOBhOWgtOWQiOOAgWBhcHBlbmQoZSlg44Go5ZCM44GY5YuV5L2c44Go44Gq44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBlIOWtkOOCqOODs+ODhuOCo+ODhuOCo+OBqOOBl+OBpui/veWKoOOBmeOCi+OCqOODs+ODhuOCo+ODhuOCo1xuICAgICAgICAgKiBAcGFyYW0gdGFyZ2V0IOaMv+WFpeS9jee9ruOBq+OBguOCi+WtkOOCqOODs+ODhuOCo+ODhuOCo1xuICAgICAgICAgKi9cbiAgICAgICAgU2NlbmUucHJvdG90eXBlLmluc2VydEJlZm9yZSA9IGZ1bmN0aW9uIChlLCB0YXJnZXQpIHtcbiAgICAgICAgICAgIGlmIChlLnBhcmVudClcbiAgICAgICAgICAgICAgICBlLnJlbW92ZSgpO1xuICAgICAgICAgICAgZS5wYXJlbnQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gLTE7XG4gICAgICAgICAgICBpZiAodGFyZ2V0ICE9PSB1bmRlZmluZWQgJiYgKGluZGV4ID0gdGhpcy5jaGlsZHJlbi5pbmRleE9mKHRhcmdldCkpID4gLTEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpbmRleCwgMCwgZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm1vZGlmaWVkKHRydWUpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog5a2Q44Ko44Oz44OG44Kj44OG44Kj44KS5YmK6Zmk44GZ44KL44CCXG4gICAgICAgICAqIGB0aGlzYCDjga7lrZDjgYvjgokgYGVgIOOCkuWJiumZpOOBmeOCi+OAgiBgZWAg44GMIGB0aGlzYCDjga7lrZDjgafjgarjgYTloLTlkIjjgIHkvZXjgoLjgZfjgarjgYTjgIJcbiAgICAgICAgICogQHBhcmFtIGUg5YmK6Zmk44GZ44KL5a2Q44Ko44Oz44OG44Kj44OG44KjXG4gICAgICAgICAqL1xuICAgICAgICBTY2VuZS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHZhciBpbmRleCA9IHRoaXMuY2hpbGRyZW4uaW5kZXhPZihlKTtcbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5jaGlsZHJlbltpbmRleF0ucGFyZW50ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgdGhpcy5tb2RpZmllZCh0cnVlKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOCt+ODvOODs+WGheOBp+OBneOBruW6p+aomeOBq+WPjeW/nOOBmeOCiyBgUG9pbnRTb3VyY2VgIOOCkui/lOOBmeOAglxuICAgICAgICAgKiBAcGFyYW0gcG9pbnQg5a++6LGh44Gu5bqn5qiZXG4gICAgICAgICAqIEBwYXJhbSBmb3JjZSB0b3VjaGFibGXmjIflrprjgpLnhKHoppbjgZnjgovloLTlkIjnnJ/jgpLmjIflrprjgZnjgovjgILmjIflrprjgZXjgozjgarjgYvjgaPjgZ/loLTlkIjlgb1cbiAgICAgICAgICogQHBhcmFtIGNhbWVyYSDlr77osaHjga7jgqvjg6Hjg6njgILmjIflrprjgZXjgozjgarjgYvjgaPjgZ/loLTlkIh1bmRlZmluZWRcbiAgICAgICAgICovXG4gICAgICAgIFNjZW5lLnByb3RvdHlwZS5maW5kUG9pbnRTb3VyY2VCeVBvaW50ID0gZnVuY3Rpb24gKHBvaW50LCBmb3JjZSwgY2FtZXJhKSB7XG4gICAgICAgICAgICB2YXIgbWF5Q29uc3VtZUxvY2FsVGljayA9ICh0aGlzLmxvY2FsICE9PSBnLkxvY2FsVGlja01vZGUuTm9uTG9jYWwpO1xuICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcbiAgICAgICAgICAgIHZhciBtID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgaWYgKGNhbWVyYSAmJiBjYW1lcmEgaW5zdGFuY2VvZiBnLkNhbWVyYTJEKVxuICAgICAgICAgICAgICAgIG0gPSBjYW1lcmEuZ2V0TWF0cml4KCk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gY2hpbGRyZW4ubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0ID0gY2hpbGRyZW5baV0uZmluZFBvaW50U291cmNlQnlQb2ludChwb2ludCwgbSwgZm9yY2UsIGNhbWVyYSk7XG4gICAgICAgICAgICAgICAgaWYgKHJldCkge1xuICAgICAgICAgICAgICAgICAgICByZXQubG9jYWwgPSByZXQudGFyZ2V0LmxvY2FsIHx8IG1heUNvbnN1bWVMb2NhbFRpY2s7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHsgdGFyZ2V0OiB1bmRlZmluZWQsIHBvaW50OiB1bmRlZmluZWQsIGxvY2FsOiBtYXlDb25zdW1lTG9jYWxUaWNrIH07XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgqLjgrvjg4Pjg4jjga7lhYjoqq3jgb/jgpLopoHmsYLjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogYFNjZW5lYCDjgavlv4XopoHjgarjgqLjgrvjg4Pjg4jjga/jgIHpgJrluLjjgIFgR2FtZSNwdXNoU2NlbmUoKWAg44Gq44Gp44Gr44KI44KL44K344O844Oz6YG356e744Gr44Go44KC44Gq44Gj44Gm5pqX6buZ44Gr6Kqt44G/6L6844G/44GM6ZaL5aeL44GV44KM44KL44CCXG4gICAgICAgICAqIOOCsuODvOODoOmWi+eZuuiAheOBr+OBk+OBruODoeOCveODg+ODieOCkuWRvOOBs+WHuuOBmeOBk+OBqOOBp+OAgeOCt+ODvOODs+mBt+enu+WJjeOBq+OCouOCu+ODg+ODiOiqreOBv+i+vOOBv+OCkumWi+Wni+OBmeOCiyjlhYjoqq3jgb/jgZnjgosp44GT44Go44GM44Gn44GN44KL44CCXG4gICAgICAgICAqIOWFiOiqreOBv+mWi+Wni+W+jOOAgeOCt+ODvOODs+mBt+enu+aZguOBvuOBp+OBq+iqreOBv+i+vOOBv+OBjOWujOS6huOBl+OBpuOBhOOBquOBhOWgtOWQiOOAgemAmuW4uOOBruiqreOBv+i+vOOBv+WHpueQhuWQjOanmOOBq+ODreODvOODh+OCo+ODs+OCsOOCt+ODvOODs+OBjOihqOekuuOBleOCjOOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga8gYFN0b3JhZ2VMb2FkZXJgIOOBq+OBpOOBhOOBpuOBruWFiOiqreOBv+WHpueQhuOCkuihjOOCj+OBquOBhOeCueOBq+azqOaEj+OAglxuICAgICAgICAgKiDjgrnjg4jjg6zjg7zjgrjjga7loLTlkIjjgIHmm7jjgY3ovrzjgb/jgYzooYzjgo/jgozjgovlj6/og73mgKfjgYzjgYLjgovjgZ/jgoHjgIHpoIbluo/jgpLnhKHoppbjgZfjgablhYjoqq3jgb/jgZnjgovjgZPjgajjga/jgafjgY3jgarjgYTjgIJcbiAgICAgICAgICovXG4gICAgICAgIFNjZW5lLnByb3RvdHlwZS5wcmVmZXRjaCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9sb2FkZWQpIHtcbiAgICAgICAgICAgICAgICAvLyBfbG9hZCgpIOWRvOOBs+WHuuOBl+W+jOOBqyBwcmVmZXRjaCgpIOOBmeOCi+aEj+WRs+OBr+OBquOBhCjlhYjoqq3jgb/jgafjga/jgarjgYQp44CCXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuX3ByZWZldGNoUmVxdWVzdGVkKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHRoaXMuX3ByZWZldGNoUmVxdWVzdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuX3NjZW5lQXNzZXRIb2xkZXIucmVxdWVzdCgpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44K344O844Oz44GM6Kqt44G/6L6844KT44Gg44K544OI44Os44O844K444Gu5YCk44KS44K344Oq44Ki44Op44Kk44K644GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIGBTY2VuZSNzdG9yYWdlVmFsdWVzYCDjga7lhoXlrrnjgpLjgrfjg6rjgqLjg6njgqTjgrrjgZnjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIFNjZW5lLnByb3RvdHlwZS5zZXJpYWxpemVTdG9yYWdlVmFsdWVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9zdG9yYWdlTG9hZGVyKVxuICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RvcmFnZUxvYWRlci5fdmFsdWVTdG9yZVNlcmlhbGl6YXRpb247XG4gICAgICAgIH07XG4gICAgICAgIFNjZW5lLnByb3RvdHlwZS5yZXF1ZXN0QXNzZXRzID0gZnVuY3Rpb24gKGFzc2V0SWRzLCBoYW5kbGVyKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fbG9hZGluZ1N0YXRlIDwgU2NlbmVMb2FkU3RhdGUuUmVhZHlGaXJlZCkge1xuICAgICAgICAgICAgICAgIC8vIOOBk+OBruODoeOCveODg+ODieOBr+iqreOBv+i+vOOBv+WujOS6huWJjeOBq+OBr+WRvOOBs+WHuuOBm+OBquOBhOOAguOBk+OCjOOBr+Wun+ijheS4iuOBruWItumZkOOBp+OBguOCi+OAglxuICAgICAgICAgICAgICAgIC8vIOOChOOCjeOBhuOBqOaAneOBiOOBsCBfbG9hZCgpIOOBp+iqreOBv+i+vOOCgOWvvuixoeOBqOOBl+OBpuWKoOOBiOOCi+OBk+OBqOOBjOOBp+OBjeOCi+OAguOBjOOAgeOBneOBruWgtOWQiCBgaGFuZGxlcmAg44KS5ZG844Gz5Ye644GZ5pa55rOV44GM5Y2Y57SU44Gn44Gq44GE44Gu44Gn5a++5b+c44KS6KaL6YCB44KL44CCXG4gICAgICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiU2NlbmUjcmVxdWVzdEFzc2V0KCk6IGNhbiBiZSBjYWxsZWQgYWZ0ZXIgbG9hZGVkLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBob2xkZXIgPSBuZXcgU2NlbmVBc3NldEhvbGRlcih7XG4gICAgICAgICAgICAgICAgc2NlbmU6IHRoaXMsXG4gICAgICAgICAgICAgICAgYXNzZXRNYW5hZ2VyOiB0aGlzLmdhbWUuX2Fzc2V0TWFuYWdlcixcbiAgICAgICAgICAgICAgICBhc3NldElkczogYXNzZXRJZHMsXG4gICAgICAgICAgICAgICAgaGFuZGxlcjogaGFuZGxlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLl9hc3NldEhvbGRlcnMucHVzaChob2xkZXIpO1xuICAgICAgICAgICAgaG9sZGVyLnJlcXVlc3QoKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBTY2VuZS5wcm90b3R5cGUuX2FjdGl2YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IFNjZW5lU3RhdGUuQWN0aXZlO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZWQuZmlyZSh0aGlzLnN0YXRlKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBTY2VuZS5wcm90b3R5cGUuX2RlYWN0aXZhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gU2NlbmVTdGF0ZS5EZWFjdGl2ZTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGVDaGFuZ2VkLmZpcmUodGhpcy5zdGF0ZSk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgU2NlbmUucHJvdG90eXBlLl9uZWVkc0xvYWRpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc2NlbmVBc3NldEhvbGRlci53YWl0aW5nQXNzZXRzQ291bnQgPiAwIHx8ICh0aGlzLl9zdG9yYWdlTG9hZGVyICYmICF0aGlzLl9zdG9yYWdlTG9hZGVyLl9sb2FkZWQpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIFNjZW5lLnByb3RvdHlwZS5fbG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9sb2FkZWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5fbG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBuZWVkc1dhaXQgPSB0aGlzLl9zY2VuZUFzc2V0SG9sZGVyLnJlcXVlc3QoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9zdG9yYWdlTG9hZGVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3RvcmFnZUxvYWRlci5fbG9hZCh0aGlzKTtcbiAgICAgICAgICAgICAgICBuZWVkc1dhaXQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFuZWVkc1dhaXQpXG4gICAgICAgICAgICAgICAgdGhpcy5fbm90aWZ5U2NlbmVSZWFkeSgpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIFNjZW5lLnByb3RvdHlwZS5fb25TY2VuZUFzc2V0c0xvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2xvYWRlZCkge1xuICAgICAgICAgICAgICAgIC8vIHByZWZldGNoKCkg44Gn6ZaL5aeL44GV44KM44Gf44Ki44K744OD44OI6Kqt44G/6L6844G/44KS5a6M5LqG44GX44Gf44GM44CBX2xvYWQoKSDjgYzjgb7jgaDlkbzjgbDjgozjgabjgYTjgarjgYTjgIJcbiAgICAgICAgICAgICAgICAvLyBfbm90aWZ5U2NlbmVSZWFkeSgpIOOBryBfbG9hZCgpIOWRvOOBs+WHuuOBl+W+jOOBvuOBp+mBheW7tuOBmeOCi+OAglxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLl9zdG9yYWdlTG9hZGVyICYmICF0aGlzLl9zdG9yYWdlTG9hZGVyLl9sb2FkZWQpIHtcbiAgICAgICAgICAgICAgICAvLyDjgqLjgrvjg4Pjg4joqq3jgb/ovrzjgb/jgpLlrozkuobjgZfjgZ/jgYzjgIHjgrnjg4jjg6zjg7zjgrjjga7oqq3jgb/ovrzjgb/jgYzntYLjgo/jgaPjgabjgYTjgarjgYTjgIJcbiAgICAgICAgICAgICAgICAvLyBfbm90aWZ5U2NlbmVSZWFkeSgpIOOBryAgX29uU3RvcmFnZUxvYWRlZCgpIOWRvOOBs+WHuuOBl+W+jOOBvuOBp+mBheW7tuOBmeOCi+OAglxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX25vdGlmeVNjZW5lUmVhZHkoKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBTY2VuZS5wcm90b3R5cGUuX29uU3RvcmFnZUxvYWRFcnJvciA9IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgdGhpcy5nYW1lLnRlcm1pbmF0ZUdhbWUoKTtcbiAgICAgICAgICAgIHRoaXMuZ2FtZS5fYWJvcnRHYW1lKCk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgU2NlbmUucHJvdG90eXBlLl9vblN0b3JhZ2VMb2FkZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fc2NlbmVBc3NldEhvbGRlci53YWl0aW5nQXNzZXRzQ291bnQgPT09IDApXG4gICAgICAgICAgICAgICAgdGhpcy5fbm90aWZ5U2NlbmVSZWFkeSgpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIFNjZW5lLnByb3RvdHlwZS5fbm90aWZ5U2NlbmVSZWFkeSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIOWNs+W6p+OBqyBgX3JlYWR5YCDjgpJmaXJl44GZ44KL44GT44Go44Gv44GX44Gq44GE44CCdGljaygp44Gu44K/44Kk44Of44Oz44Kw44Gn6KGM44GG44Gf44KB44CB44Oq44Kv44Ko44K544OI44KSZ2FtZeOBq+aKleOBkuOBpuOBiuOBj+OAglxuICAgICAgICAgICAgdGhpcy5fbG9hZGluZ1N0YXRlID0gU2NlbmVMb2FkU3RhdGUuUmVhZHk7XG4gICAgICAgICAgICB0aGlzLmdhbWUuX2ZpcmVTY2VuZVJlYWR5KHRoaXMpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIFNjZW5lLnByb3RvdHlwZS5fZmlyZVJlYWR5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5fcmVhZHkuZmlyZSh0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuX2xvYWRpbmdTdGF0ZSA9IFNjZW5lTG9hZFN0YXRlLlJlYWR5RmlyZWQ7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgU2NlbmUucHJvdG90eXBlLl9maXJlTG9hZGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5sb2FkZWQuZmlyZSh0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuX2xvYWRpbmdTdGF0ZSA9IFNjZW5lTG9hZFN0YXRlLkxvYWRlZEZpcmVkO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gU2NlbmU7XG4gICAgfSgpKTtcbiAgICBnLlNjZW5lID0gU2NlbmU7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICogQXNzZXTjga7oqq3jgb/ovrzjgb/kuK3jgavooajnpLrjgZXjgozjgovjgrfjg7zjg7PjgIJcbiAgICAgKlxuICAgICAqIOacrOOCt+ODvOODs+OBr+mAmuW4uOOBruOCt+ODvOODs+OBqOeVsOOBquOCiuOAgeOCsuODvOODoOWGheaZgumWkyhgR2FtZSNhZ2VgKeOBqOeLrOeri+OBq+Wun+ihjOOBleOCjOOCi+OAglxuICAgICAqIOOCouOCu+ODg+ODiOOChOOCueODiOODrOODvOOCuOODh+ODvOOCv+OCkuiqreOBv+i+vOOCk+OBp+OBhOOCi+mWk+OAgeOCsuODvOODoOWGheaZgumWk+OBjOmAsuOCk+OBp+OBhOOBquOBhOeKtuaFi+OBp+OCguOAgVxuICAgICAqIGBMb2FkaW5nU2NlbmVgIOOBr+eUu+mdouOBq+WkieWMluOCkuS4juOBiOOCi+OBk+OBqOOBjOOBp+OBjeOCiyhgdXBkYXRlYCDjgYxmaXJl44GV44KM44KLKeOAglxuICAgICAqXG4gICAgICog44Ky44O844Og6ZaL55m66ICF44Gv44CB44Ot44O844OH44Kj44Oz44Kw5Lit44Gu5ryU5Ye644KS5a6f6KOF44GX44Gf54us6Ieq44GuIGBMb2FkaW5nU2NlbmVgIOOCklxuICAgICAqIGBHYW1lI2xvYWRpbmdTY2VuZWAg44Gr5Luj5YWl44GZ44KL44GT44Go44Gn44Ko44Oz44K444Oz44Gr5Yip55So44GV44Gb44KL44GT44Go44GM44Gn44GN44KL44CCXG4gICAgICpcbiAgICAgKiDjgrLjg7zjg6DlhoXmmYLplpPjgajni6znq4vjgavlh6bnkIbjgZXjgozjgosgYExvYWRpbmdTY2VuZWAg44Gn44Gu5Yem55CG44Gr44Gv5YaN54++5oCn44GM44Gq44GEKOS7luODl+ODrOOCpOODpOODvOOBqOeKtuaFi+OBjOWFseacieOBleOCjOOBquOBhCnjgIJcbiAgICAgKiDjgZ3jga7jgZ/jgoEgYEdhbWVgIOOBq+WvvuOBl+OBpuWJr+S9nOeUqOOBruOBguOCi+aTjeS9nOOCkuihjOOBo+OBpuOBr+OBquOCieOBquOBhOeCueOBq+azqOaEj+OBmeOCi+OBk+OBqOOAglxuICAgICAqL1xuICAgIHZhciBMb2FkaW5nU2NlbmUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhMb2FkaW5nU2NlbmUsIF9zdXBlcik7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBgTG9hZGluZ1NjZW5lYCDjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLnlJ/miJDjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHBhcmFtIOWIneacn+WMluOBq+eUqOOBhOOCi+ODkeODqeODoeODvOOCv+OBruOCquODluOCuOOCp+OCr+ODiFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gTG9hZGluZ1NjZW5lKHBhcmFtKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgcGFyYW0ubG9jYWwgPSB0cnVlOyAvLyBMb2FkaW5nU2NlbmUg44Gv5by35Yi255qE44Gr44Ot44O844Kr44Or44Gr44GZ44KLXG4gICAgICAgICAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHBhcmFtKSB8fCB0aGlzO1xuICAgICAgICAgICAgX3RoaXMudGFyZ2V0UmVzZXQgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgICAgICBfdGhpcy50YXJnZXRSZWFkeSA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgICAgIF90aGlzLnRhcmdldEFzc2V0TG9hZGVkID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICAgICAgX3RoaXMuX2V4cGxpY2l0RW5kID0gISFwYXJhbS5leHBsaWNpdEVuZDtcbiAgICAgICAgICAgIF90aGlzLl90YXJnZXRTY2VuZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcztcbiAgICAgICAgfVxuICAgICAgICBMb2FkaW5nU2NlbmUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLl9jbGVhclRhcmdldFNjZW5lKCk7XG4gICAgICAgICAgICBfc3VwZXIucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOCouOCu+ODg+ODiOODreODvOODieW+heOBoeWvvuixoeOCt+ODvOODs+OCkuWkieabtOOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga/jgIHmlrDjgZ/jgavjgrfjg7zjg7Pjga7jg63jg7zjg4nlvoXjgaHjgYzlv4XopoHjgavjgarjgaPjgZ/loLTlkIjjgavjgqjjg7Pjgrjjg7PjgavjgojjgaPjgablkbzjgbPlh7rjgZXjgozjgovjgIJcbiAgICAgICAgICogKOa0vueUn+OCr+ODqeOCueOBr+OBk+OBruWHpueQhuOCkuOCquODvOODkOODvOODqeOCpOODieOBl+OBpuOCguOCiOOBhOOBjOOAgeOBneOBruWgtOWQiOOBneOBruS4reOBp1xuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4noh6rouqsgKGBnLkxvYWRpbmdTY2VuZS5wcm90b3R5cGUucmVzZXRgKSDjgpLlkbzjgbPlh7rjgZkgKGBjYWxsKClgIOOBmeOCiykg5b+F6KaB44GM44GC44KL44CCKVxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gdGFyZ2V0U2NlbmUg44Ki44K744OD44OI44Ot44O844OJ5b6F44Gh44GM5b+F6KaB44Gq44K344O844OzXG4gICAgICAgICAqL1xuICAgICAgICBMb2FkaW5nU2NlbmUucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKHRhcmdldFNjZW5lKSB7XG4gICAgICAgICAgICB0aGlzLl9jbGVhclRhcmdldFNjZW5lKCk7XG4gICAgICAgICAgICB0aGlzLl90YXJnZXRTY2VuZSA9IHRhcmdldFNjZW5lO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2xvYWRpbmdTdGF0ZSA8IGcuU2NlbmVMb2FkU3RhdGUuTG9hZGVkRmlyZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRlZC5hZGRPbmNlKHRoaXMuX2RvUmVzZXQsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZG9SZXNldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44Ki44K744OD44OI44Ot44O844OJ5b6F44Gh5a++6LGh44K344O844Oz44Gu5q6L44KK44Gu44Ot44O844OJ5b6F44Gh44Ki44K744OD44OI5pWw44KS5Y+W5b6X44GZ44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBMb2FkaW5nU2NlbmUucHJvdG90eXBlLmdldFRhcmdldFdhaXRpbmdBc3NldHNDb3VudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl90YXJnZXRTY2VuZSA/IHRoaXMuX3RhcmdldFNjZW5lLl9zY2VuZUFzc2V0SG9sZGVyLndhaXRpbmdBc3NldHNDb3VudCA6IDA7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjg63jg7zjg4fjgqPjg7PjgrDjgrfjg7zjg7PjgpLntYLkuobjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogYFNjZW5lI2VuZCgpYCDjgajnlbDjgarjgorjgIHjgZPjga7jg6Hjgr3jg4Pjg4njga7lkbzjgbPlh7rjgZfjga/jgZPjga7jgrfjg7zjg7PjgpLnoLTmo4TjgZfjgarjgYTjgIIo44Ot44O844OH44Kj44Oz44Kw44K344O844Oz44Gv5YaN5Yip55So44GV44KM44KL44CCKVxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njgYzlkbzjgbPlh7rjgZXjgozjgovmmYLjgIEgYHRhcmdldFJlYWR5YCDjgYxmaXJl44GV44KM44Gf5b6M44Gn44Gq44GR44KM44Gw44Gq44KJ44Gq44GE44CCXG4gICAgICAgICAqL1xuICAgICAgICBMb2FkaW5nU2NlbmUucHJvdG90eXBlLmVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5fdGFyZ2V0U2NlbmUgfHwgdGhpcy5fdGFyZ2V0U2NlbmUuX2xvYWRpbmdTdGF0ZSA8IGcuU2NlbmVMb2FkU3RhdGUuUmVhZHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdGUgPSB0aGlzLl90YXJnZXRTY2VuZSA/IGcuU2NlbmVMb2FkU3RhdGVbdGhpcy5fdGFyZ2V0U2NlbmUuX2xvYWRpbmdTdGF0ZV0gOiBcIihubyBzY2VuZSlcIjtcbiAgICAgICAgICAgICAgICB2YXIgbXNnID0gXCJMb2FkaW5nU2NlbmUjZW5kKCk6IHRoZSB0YXJnZXQgc2NlbmUgaXMgaW4gaW52YWxpZCBzdGF0ZTogXCIgKyBzdGF0ZTtcbiAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IobXNnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZ2FtZS5wb3BTY2VuZSh0cnVlKTtcbiAgICAgICAgICAgIHRoaXMuZ2FtZS5fZmlyZVNjZW5lTG9hZGVkKHRoaXMuX3RhcmdldFNjZW5lKTtcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyVGFyZ2V0U2NlbmUoKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBMb2FkaW5nU2NlbmUucHJvdG90eXBlLl9jbGVhclRhcmdldFNjZW5lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLl90YXJnZXRTY2VuZSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB0aGlzLl90YXJnZXRTY2VuZS5fcmVhZHkucmVtb3ZlQWxsKHsgb3duZXI6IHRoaXMgfSk7XG4gICAgICAgICAgICB0aGlzLl90YXJnZXRTY2VuZS5hc3NldExvYWRlZC5yZW1vdmVBbGwoeyBvd25lcjogdGhpcyB9KTtcbiAgICAgICAgICAgIHRoaXMuX3RhcmdldFNjZW5lID0gdW5kZWZpbmVkO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIExvYWRpbmdTY2VuZS5wcm90b3R5cGUuX2RvUmVzZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLnRhcmdldFJlc2V0LmZpcmUodGhpcy5fdGFyZ2V0U2NlbmUpO1xuICAgICAgICAgICAgaWYgKHRoaXMuX3RhcmdldFNjZW5lLl9sb2FkaW5nU3RhdGUgPCBnLlNjZW5lTG9hZFN0YXRlLlJlYWR5RmlyZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90YXJnZXRTY2VuZS5fcmVhZHkuYWRkKHRoaXMuX2ZpcmVUcmlnZ2VyT25UYXJnZXRSZWFkeSwgdGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGFyZ2V0U2NlbmUuYXNzZXRMb2FkZWQuYWRkKHRoaXMuX2ZpcmVUcmlnZ2VyT25UYXJnZXRBc3NldExvYWQsIHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RhcmdldFNjZW5lLl9sb2FkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9maXJlVHJpZ2dlck9uVGFyZ2V0UmVhZHkodGhpcy5fdGFyZ2V0U2NlbmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIExvYWRpbmdTY2VuZS5wcm90b3R5cGUuX2ZpcmVUcmlnZ2VyT25UYXJnZXRBc3NldExvYWQgPSBmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0QXNzZXRMb2FkZWQuZmlyZShhc3NldCk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgTG9hZGluZ1NjZW5lLnByb3RvdHlwZS5fZmlyZVRyaWdnZXJPblRhcmdldFJlYWR5ID0gZnVuY3Rpb24gKHNjZW5lKSB7XG4gICAgICAgICAgICB0aGlzLnRhcmdldFJlYWR5LmZpcmUoc2NlbmUpO1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9leHBsaWNpdEVuZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBMb2FkaW5nU2NlbmU7XG4gICAgfShnLlNjZW5lKSk7XG4gICAgZy5Mb2FkaW5nU2NlbmUgPSBMb2FkaW5nU2NlbmU7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog44Kr44Oh44Op44GudHJhbnNmb3Jt44KS5oi744GZ44Ko44Oz44OG44Kj44OG44Kj44CCXG4gICAgICogTG9hZGluZ1NjZW5l44Gu44Kk44Oz44K444Kx44O844K/44GM44Kr44Oh44Op44Gu5b2x6Z+/44KS5Y+X44GR44Gq44GE44KI44GG44Gr44GZ44KL44Gf44KB44Gu5YaF6YOo44Ko44Oz44OG44Kj44OG44Kj44CCXG4gICAgICovXG4gICAgdmFyIENhbWVyYUNhbmNlbGxpbmdFID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoQ2FtZXJhQ2FuY2VsbGluZ0UsIF9zdXBlcik7XG4gICAgICAgIGZ1bmN0aW9uIENhbWVyYUNhbmNlbGxpbmdFKHBhcmFtKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwYXJhbSkgfHwgdGhpcztcbiAgICAgICAgICAgIF90aGlzLl9jYW5jZWxsZXIgPSBuZXcgZy5PYmplY3QyRCgpO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgICAgICB9XG4gICAgICAgIENhbWVyYUNhbmNlbGxpbmdFLnByb3RvdHlwZS5yZW5kZXJTZWxmID0gZnVuY3Rpb24gKHJlbmRlcmVyLCBjYW1lcmEpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5jaGlsZHJlbilcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICBpZiAoY2FtZXJhKSB7XG4gICAgICAgICAgICAgICAgdmFyIGMgPSBjYW1lcmE7XG4gICAgICAgICAgICAgICAgdmFyIGNhbmNlbGxlciA9IHRoaXMuX2NhbmNlbGxlcjtcbiAgICAgICAgICAgICAgICBpZiAoYy54ICE9PSBjYW5jZWxsZXIueCB8fCBjLnkgIT09IGNhbmNlbGxlci55IHx8IGMuYW5nbGUgIT09IGNhbmNlbGxlci5hbmdsZSB8fFxuICAgICAgICAgICAgICAgICAgICBjLnNjYWxlWCAhPT0gY2FuY2VsbGVyLnNjYWxlWCB8fCBjLnNjYWxlWSAhPT0gY2FuY2VsbGVyLnNjYWxlWSkge1xuICAgICAgICAgICAgICAgICAgICBjYW5jZWxsZXIueCA9IGMueDtcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsbGVyLnkgPSBjLnk7XG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbGxlci5hbmdsZSA9IGMuYW5nbGU7XG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbGxlci5zY2FsZVggPSBjLnNjYWxlWDtcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsbGVyLnNjYWxlWSA9IGMuc2NhbGVZO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2FuY2VsbGVyLl9tYXRyaXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbGxlci5fbWF0cml4Ll9tb2RpZmllZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuc2F2ZSgpO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRyYW5zZm9ybShjYW5jZWxsZXIuZ2V0TWF0cml4KCkuX21hdHJpeCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBOb3RlOiBjb25jYXTjgZfjgabjgYTjgarjgYTjga7jgad1bnNhZmXjgaDjgYzjgIFyZW5kZXLkuK3jgavphY3liJfjga7kuK3ouqvjgYzlpInjgo/jgovkuovjga/jgarjgYTliY3mj5DjgajjgZnjgotcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgKytpKVxuICAgICAgICAgICAgICAgIGNoaWxkcmVuW2ldLnJlbmRlcihyZW5kZXJlciwgY2FtZXJhKTtcbiAgICAgICAgICAgIGlmIChjYW1lcmEpIHtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5yZXN0b3JlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBDYW1lcmFDYW5jZWxsaW5nRTtcbiAgICB9KGcuRSkpO1xuICAgIC8qKlxuICAgICAqIOODh+ODleOCqeODq+ODiOODreODvOODh+OCo+ODs+OCsOOCt+ODvOODs+OAglxuICAgICAqXG4gICAgICogYEdhbWUjX2RlZmF1bHRMb2FkaW5nU2NlbmVgIOOBruWIneacn+WApOOBqOOBl+OBpuWIqeeUqOOBleOCjOOCi+OAglxuICAgICAqIOOBk+OBruOCt+ODvOODs+OBr+OBhOOBi+OBquOCi+OCouOCu+ODg+ODiOOCgueUqOOBhOOBpuOBr+OBquOCieOBquOBhOOAglxuICAgICAqL1xuICAgIHZhciBEZWZhdWx0TG9hZGluZ1NjZW5lID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoRGVmYXVsdExvYWRpbmdTY2VuZSwgX3N1cGVyKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGBEZWFmdWx0TG9hZGluZ1NjZW5lYCDjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLnlJ/miJDjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHBhcmFtIOWIneacn+WMluOBq+eUqOOBhOOCi+ODkeODqeODoeODvOOCv+OBruOCquODluOCuOOCp+OCr+ODiFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gRGVmYXVsdExvYWRpbmdTY2VuZShwYXJhbSkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgeyBnYW1lOiBwYXJhbS5nYW1lLCBuYW1lOiBcImFrYXNoaWM6ZGVmYXVsdC1sb2FkaW5nLXNjZW5lXCIgfSkgfHwgdGhpcztcbiAgICAgICAgICAgIF90aGlzLl9iYXJXaWR0aCA9IE1hdGgubWluKHBhcmFtLmdhbWUud2lkdGgsIE1hdGgubWF4KDEwMCwgcGFyYW0uZ2FtZS53aWR0aCAvIDIpKTtcbiAgICAgICAgICAgIF90aGlzLl9iYXJIZWlnaHQgPSA1O1xuICAgICAgICAgICAgX3RoaXMuX2dhdWdlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgX3RoaXMuX2dhdWdlVXBkYXRlQ291bnQgPSAwO1xuICAgICAgICAgICAgX3RoaXMuX3RvdGFsV2FpdGluZ0Fzc2V0Q291bnQgPSAwO1xuICAgICAgICAgICAgX3RoaXMubG9hZGVkLmhhbmRsZShfdGhpcywgX3RoaXMuX29uTG9hZGVkKTtcbiAgICAgICAgICAgIF90aGlzLnRhcmdldFJlc2V0LmhhbmRsZShfdGhpcywgX3RoaXMuX29uVGFyZ2V0UmVzZXQpO1xuICAgICAgICAgICAgX3RoaXMudGFyZ2V0QXNzZXRMb2FkZWQuaGFuZGxlKF90aGlzLCBfdGhpcy5fb25UYXJnZXRBc3NldExvYWRlZCk7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBEZWZhdWx0TG9hZGluZ1NjZW5lLnByb3RvdHlwZS5fb25Mb2FkZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZ2F1Z2U7XG4gICAgICAgICAgICB0aGlzLmFwcGVuZChuZXcgQ2FtZXJhQ2FuY2VsbGluZ0Uoe1xuICAgICAgICAgICAgICAgIHNjZW5lOiB0aGlzLFxuICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBnLkZpbGxlZFJlY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NlbmU6IHRoaXMsXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy5nYW1lLndpZHRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmdhbWUuaGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICAgICAgY3NzQ29sb3I6IFwicmdiYSgwLCAwLCAwLCAwLjgpXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBnLkZpbGxlZFJlY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2VuZTogdGhpcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeDogKHRoaXMuZ2FtZS53aWR0aCAtIHRoaXMuX2JhcldpZHRoKSAvIDIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6ICh0aGlzLmdhbWUuaGVpZ2h0IC0gdGhpcy5fYmFySGVpZ2h0KSAvIDIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLl9iYXJXaWR0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLl9iYXJIZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzc0NvbG9yOiBcImdyYXlcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhdWdlID0gbmV3IGcuRmlsbGVkUmVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NlbmU6IHRoaXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLl9iYXJIZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzQ29sb3I6IFwid2hpdGVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgZ2F1Z2UudXBkYXRlLmhhbmRsZSh0aGlzLCB0aGlzLl9vblVwZGF0ZUd1YWdlKTtcbiAgICAgICAgICAgIHRoaXMuX2dhdWdlID0gZ2F1Z2U7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gVHJpZ2dlciDnmbvpjLLjgpLop6PpmaTjgZnjgotcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBEZWZhdWx0TG9hZGluZ1NjZW5lLnByb3RvdHlwZS5fb25VcGRhdGVHdWFnZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBCTElOS19SQU5HRSA9IDUwO1xuICAgICAgICAgICAgdmFyIEJMSU5LX1BFUl9TRUMgPSAyIC8gMztcbiAgICAgICAgICAgICsrdGhpcy5fZ2F1Z2VVcGRhdGVDb3VudDtcbiAgICAgICAgICAgIC8vIOeZveOCkuS4iumZkOOBqyBzaW4g5rOi44Gn5piO5ruF44GV44Gb44KLICh1cGRhdGXjgZfjgabjgYTjgovjgZPjgajjga7norroqo0pXG4gICAgICAgICAgICB2YXIgYyA9IE1hdGgucm91bmQoKDI1NSAtIEJMSU5LX1JBTkdFKVxuICAgICAgICAgICAgICAgICsgTWF0aC5zaW4oKHRoaXMuX2dhdWdlVXBkYXRlQ291bnQgLyB0aGlzLmdhbWUuZnBzICogQkxJTktfUEVSX1NFQykgKiAoMiAqIE1hdGguUEkpKSAqIEJMSU5LX1JBTkdFKTtcbiAgICAgICAgICAgIHRoaXMuX2dhdWdlLmNzc0NvbG9yID0gXCJyZ2IoXCIgKyBjICsgXCIsXCIgKyBjICsgXCIsXCIgKyBjICsgXCIpXCI7XG4gICAgICAgICAgICB0aGlzLl9nYXVnZS5tb2RpZmllZCgpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIERlZmF1bHRMb2FkaW5nU2NlbmUucHJvdG90eXBlLl9vblRhcmdldFJlc2V0ID0gZnVuY3Rpb24gKHRhcmdldFNjZW5lKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fZ2F1Z2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9nYXVnZS53aWR0aCA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5fZ2F1Z2UubW9kaWZpZWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3RvdGFsV2FpdGluZ0Fzc2V0Q291bnQgPSB0YXJnZXRTY2VuZS5fc2NlbmVBc3NldEhvbGRlci53YWl0aW5nQXNzZXRzQ291bnQ7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgRGVmYXVsdExvYWRpbmdTY2VuZS5wcm90b3R5cGUuX29uVGFyZ2V0QXNzZXRMb2FkZWQgPSBmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgICAgICAgIHZhciB3YWl0aW5nQXNzZXRzQ291bnQgPSB0aGlzLl90YXJnZXRTY2VuZS5fc2NlbmVBc3NldEhvbGRlci53YWl0aW5nQXNzZXRzQ291bnQ7XG4gICAgICAgICAgICB0aGlzLl9nYXVnZS53aWR0aCA9IE1hdGguY2VpbCgoMSAtIHdhaXRpbmdBc3NldHNDb3VudCAvIHRoaXMuX3RvdGFsV2FpdGluZ0Fzc2V0Q291bnQpICogdGhpcy5fYmFyV2lkdGgpO1xuICAgICAgICAgICAgdGhpcy5fZ2F1Z2UubW9kaWZpZWQoKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIERlZmF1bHRMb2FkaW5nU2NlbmU7XG4gICAgfShnLkxvYWRpbmdTY2VuZSkpO1xuICAgIGcuRGVmYXVsdExvYWRpbmdTY2VuZSA9IERlZmF1bHRMb2FkaW5nU2NlbmU7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog55S75YOP44KS5o+P55S744GZ44KL44Ko44Oz44OG44Kj44OG44Kj44CCXG4gICAgICovXG4gICAgdmFyIFNwcml0ZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICAgICAgX19leHRlbmRzKFNwcml0ZSwgX3N1cGVyKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOWQhOeoruODkeODqeODoeODvOOCv+OCkuaMh+WumuOBl+OBpiBgU3ByaXRlYCDjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLnlJ/miJDjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHBhcmFtIGBTcHJpdGVgIOOBq+ioreWumuOBmeOCi+ODkeODqeODoeODvOOCv1xuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gU3ByaXRlKHBhcmFtKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwYXJhbSkgfHwgdGhpcztcbiAgICAgICAgICAgIF90aGlzLnN1cmZhY2UgPSBnLlV0aWwuYXNTdXJmYWNlKHBhcmFtLnNyYyk7XG4gICAgICAgICAgICBpZiAoIShcIndpZHRoXCIgaW4gcGFyYW0pKVxuICAgICAgICAgICAgICAgIF90aGlzLndpZHRoID0gX3RoaXMuc3VyZmFjZS53aWR0aDtcbiAgICAgICAgICAgIGlmICghKFwiaGVpZ2h0XCIgaW4gcGFyYW0pKVxuICAgICAgICAgICAgICAgIF90aGlzLmhlaWdodCA9IF90aGlzLnN1cmZhY2UuaGVpZ2h0O1xuICAgICAgICAgICAgX3RoaXMuc3JjV2lkdGggPSBcInNyY1dpZHRoXCIgaW4gcGFyYW0gPyBwYXJhbS5zcmNXaWR0aCA6IF90aGlzLndpZHRoO1xuICAgICAgICAgICAgX3RoaXMuc3JjSGVpZ2h0ID0gXCJzcmNIZWlnaHRcIiBpbiBwYXJhbSA/IHBhcmFtLnNyY0hlaWdodCA6IF90aGlzLmhlaWdodDtcbiAgICAgICAgICAgIF90aGlzLnNyY1ggPSBwYXJhbS5zcmNYIHx8IDA7XG4gICAgICAgICAgICBfdGhpcy5zcmNZID0gcGFyYW0uc3JjWSB8fCAwO1xuICAgICAgICAgICAgX3RoaXMuX3N0cmV0Y2hNYXRyaXggPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBfdGhpcy5fYmVmb3JlU3VyZmFjZSA9IF90aGlzLnN1cmZhY2U7XG4gICAgICAgICAgICBnLlV0aWwuc2V0dXBBbmltYXRpbmdIYW5kbGVyKF90aGlzLCBfdGhpcy5zdXJmYWNlKTtcbiAgICAgICAgICAgIF90aGlzLl9pbnZhbGlkYXRlU2VsZigpO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgU3ByaXRlLnByb3RvdHlwZS5fb25VcGRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLm1vZGlmaWVkKCk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgU3ByaXRlLnByb3RvdHlwZS5fb25BbmltYXRpbmdTdGFydGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnVwZGF0ZS5jb250YWlucyh0aGlzLl9vblVwZGF0ZSwgdGhpcykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZS5hZGQodGhpcy5fb25VcGRhdGUsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIFNwcml0ZS5wcm90b3R5cGUuX29uQW5pbWF0aW5nU3RvcHBlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5kZXN0cm95ZWQoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlLnJlbW92ZSh0aGlzLl9vblVwZGF0ZSwgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPoh6rouqvjga7mj4/nlLvjgpLooYzjgYbjgIJcbiAgICAgICAgICog44GT44Gu44Oh44K944OD44OJ44Gv44Ko44Oz44K444Oz44GL44KJ5pqX6buZ44Gr5ZG844Gz5Ye644GV44KM44CB44Ky44O844Og6ZaL55m66ICF44GM5ZG844Gz5Ye644GZ5b+F6KaB44Gv44Gq44GE44CCXG4gICAgICAgICAqL1xuICAgICAgICBTcHJpdGUucHJvdG90eXBlLnJlbmRlclNlbGYgPSBmdW5jdGlvbiAocmVuZGVyZXIsIGNhbWVyYSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3JjV2lkdGggPD0gMCB8fCB0aGlzLnNyY0hlaWdodCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5fc3RyZXRjaE1hdHJpeCkge1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnNhdmUoKTtcbiAgICAgICAgICAgICAgICByZW5kZXJlci50cmFuc2Zvcm0odGhpcy5fc3RyZXRjaE1hdHJpeC5fbWF0cml4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlbmRlcmVyLmRyYXdJbWFnZSh0aGlzLnN1cmZhY2UsIHRoaXMuc3JjWCwgdGhpcy5zcmNZLCB0aGlzLnNyY1dpZHRoLCB0aGlzLnNyY0hlaWdodCwgMCwgMCk7XG4gICAgICAgICAgICBpZiAodGhpcy5fc3RyZXRjaE1hdHJpeClcbiAgICAgICAgICAgICAgICByZW5kZXJlci5yZXN0b3JlKCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBruOCqOODs+ODhuOCo+ODhuOCo+OBruaPj+eUu+OCreODo+ODg+OCt+ODpeeEoeWKueWMluOCkuOCqOODs+OCuOODs+OBq+mAmuefpeOBmeOCi+OAglxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njgpLlkbzjgbPlh7rjgZflvozjgIHmj4/nlLvjgq3jg6Pjg4Pjgrfjg6Xjga7lho3mp4vnr4njgYzooYzjgo/jgozjgIHlkIQgYFJlbmRlcmVyYCDjgavmj4/nlLvlhoXlrrnjga7lpInmm7TjgYzlj43mmKDjgZXjgozjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIFNwcml0ZS5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuX2ludmFsaWRhdGVTZWxmKCk7XG4gICAgICAgICAgICB0aGlzLm1vZGlmaWVkKCk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPjgpLnoLTmo4TjgZnjgovjgIJcbiAgICAgICAgICog44OH44OV44Kp44Or44OI44Gn44Gv5Yip55So44GX44Gm44GE44KLIGBTdXJmYWNlYCDjga7noLTmo4Tjga/ooYzjgo/jgarjgYTngrnjgavms6jmhI/jgIJcbiAgICAgICAgICogQHBhcmFtIGRlc3Ryb3lTdXJmYWNlIHRydWXjgpLmjIflrprjgZfjgZ/loLTlkIjjgIHjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPjgYzmirHjgYjjgosgYFN1cmZhY2VgIOOCguWQiOOCj+OBm+OBpuegtOajhOOBmeOCi1xuICAgICAgICAgKi9cbiAgICAgICAgU3ByaXRlLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKGRlc3Ryb3lTdXJmYWNlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zdXJmYWNlICYmICF0aGlzLnN1cmZhY2UuZGVzdHJveWVkKCkpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGVzdHJveVN1cmZhY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdXJmYWNlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5zdXJmYWNlLmlzRHluYW1pYykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN1cmZhY2UuYW5pbWF0aW5nU3RhcnRlZC5yZW1vdmUodGhpcy5fb25BbmltYXRpbmdTdGFydGVkLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdXJmYWNlLmFuaW1hdGluZ1N0b3BwZWQucmVtb3ZlKHRoaXMuX29uQW5pbWF0aW5nU3RvcHBlZCwgdGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zdXJmYWNlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcyk7XG4gICAgICAgIH07XG4gICAgICAgIFNwcml0ZS5wcm90b3R5cGUuX2ludmFsaWRhdGVTZWxmID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMud2lkdGggPT09IHRoaXMuc3JjV2lkdGggJiYgdGhpcy5oZWlnaHQgPT09IHRoaXMuc3JjSGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3RyZXRjaE1hdHJpeCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX3N0cmV0Y2hNYXRyaXggPSBnLlV0aWwuY3JlYXRlTWF0cml4KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3RyZXRjaE1hdHJpeC5zY2FsZSh0aGlzLndpZHRoIC8gdGhpcy5zcmNXaWR0aCwgdGhpcy5oZWlnaHQgLyB0aGlzLnNyY0hlaWdodCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5zdXJmYWNlICE9PSB0aGlzLl9iZWZvcmVTdXJmYWNlKSB7XG4gICAgICAgICAgICAgICAgZy5VdGlsLm1pZ3JhdGVBbmltYXRpbmdIYW5kbGVyKHRoaXMsIHRoaXMuX2JlZm9yZVN1cmZhY2UsIHRoaXMuc3VyZmFjZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fYmVmb3JlU3VyZmFjZSA9IHRoaXMuc3VyZmFjZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIFNwcml0ZTtcbiAgICB9KGcuRSkpO1xuICAgIGcuU3ByaXRlID0gU3ByaXRlO1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIC8qKlxuICAgICAqIOODleODrOODvOODoOOBqOOCv+OCpOODnuODvOOBq+OCiOOCi+OCouODi+ODoeODvOOCt+ODp+ODs+apn+ani+OCkuaMgeOBpCBgU3ByaXRlYCDjgIJcbiAgICAgKlxuICAgICAqIOOBk+OBruOCr+ODqeOCueOBr+OAgeOCs+ODs+OCueODiOODqeOCr+OCv+OBp+a4oeOBleOCjOOBn+eUu+WDj+OCkuOAgVxuICAgICAqIOW5hSBgc3JjV2lkdGhgLCDpq5jjgZUgYHNyY0hlaWdodGAg5Y2Y5L2N44Gn5Yy65YiH44KJ44KM44Gf5bCP44GV44Gq55S75YOPKOS7peS4i+OAgeeUu+WDj+eJhynjga7pm4bjgb7jgorjgafjgYLjgovjgajop6Pph4jjgZnjgovjgIJcbiAgICAgKiDlkITnlLvlg4/niYfjga/jgIHlt6bkuIrjgYvjgonpoIbjgasgMCDjgYvjgonlp4vjgb7jgovjgqTjg7Pjg4fjg4Pjgq/jgrnjgaflj4LnhafjgZXjgozjgovjgIJcbiAgICAgKlxuICAgICAqIOOCsuODvOODoOmWi+eZuuiAheOBr+OAgeOBk+OBruOCpOODs+ODh+ODg+OCr+OCueOBi+OCieOBquOCi+mFjeWIl+OCkiBgRnJhbWVTcHJpdGUjZnJhbWVzYCDjgavoqK3lrprjgZnjgovjgIJcbiAgICAgKiBgRnJhbWVTcHJpdGVgIOOBr+OAgSBgZnJhbWVzYCDjgavmjIflrprjgZXjgozjgZ/jgqTjg7Pjg4fjg4Pjgq/jgrko44GM6KGo44GZ55S75YOP54mHKeOCkumghueVquOBq+aPj+eUu+OBmeOCi+OBk+OBqOOBp+OCouODi+ODoeODvOOCt+ODp+ODs+OCkuWun+ePvuOBmeOCi+OAglxuICAgICAqIOOCouODi+ODoeODvOOCt+ODp+ODs+OBryBgaW50ZXJ2YWxgIOODn+ODquenkuOBlOOBqOOBq+mAsuOBv+OAgSBgZnJhbWVzYCDjga7lhoXlrrnjgpLjg6vjg7zjg5fjgZnjgovjgIJcbiAgICAgKlxuICAgICAqIOOBk+OBruOCr+ODqeOCueOBq+OBiuOBkeOCiyBgc3JjV2lkdGhgLCBgc3JjSGVpZ2h0YCDjga7mibHjgYTjga/jgIHopqrjgq/jg6njgrnjgafjgYLjgosgYFNwcml0ZWAg44Go44Gv55Ww44Gq44Gj44Gm44GE44KL44GT44Go44Gr5rOo5oSP44CCXG4gICAgICovXG4gICAgdmFyIEZyYW1lU3ByaXRlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoRnJhbWVTcHJpdGUsIF9zdXBlcik7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlkITnqK7jg5Hjg6njg6Hjg7zjgr/jgpLmjIflrprjgZfjgaYgYEZyYW1lU3ByaXRlYCDjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLnlJ/miJDjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHBhcmFtIGBGcmFtZVNwcml0ZWAg44Gr6Kit5a6a44GZ44KL44OR44Op44Oh44O844K/XG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBGcmFtZVNwcml0ZShwYXJhbSkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcGFyYW0pIHx8IHRoaXM7XG4gICAgICAgICAgICBfdGhpcy5fbGFzdFVzZWRJbmRleCA9IDA7XG4gICAgICAgICAgICBfdGhpcy5mcmFtZU51bWJlciA9IHBhcmFtLmZyYW1lTnVtYmVyIHx8IDA7XG4gICAgICAgICAgICBfdGhpcy5mcmFtZXMgPSBcImZyYW1lc1wiIGluIHBhcmFtID8gcGFyYW0uZnJhbWVzIDogWzBdO1xuICAgICAgICAgICAgX3RoaXMuaW50ZXJ2YWwgPSBwYXJhbS5pbnRlcnZhbDtcbiAgICAgICAgICAgIF90aGlzLl90aW1lciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIF90aGlzLmxvb3AgPSBwYXJhbS5sb29wICE9IG51bGwgPyBwYXJhbS5sb29wIDogdHJ1ZTtcbiAgICAgICAgICAgIF90aGlzLmZpbmlzaGVkID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICAgICAgX3RoaXMuX21vZGlmaWVkU2VsZigpO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBgU3ByaXRlYCDjgYvjgokgYEZyYW1lU3ByaXRlYCDjgpLkvZzmiJDjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHNwcml0ZSDnlLvlg4/jgajjgZfjgabkvb/jgYZgU3ByaXRlYFxuICAgICAgICAgKiBAcGFyYW0gd2lkdGgg5L2c5oiQ44GV44KM44KL44Ko44Oz44OG44Kj44OG44Kj44Gu6auY44GV44CC55yB55Wl44GV44KM44Gf5aC05ZCI44CBIGBzcHJpdGUud2lkdGhgXG4gICAgICAgICAqIEBwYXJhbSBoZWdpdGgg5L2c5oiQ44GV44KM44KL44Ko44Oz44OG44Kj44OG44Kj44Gu6auY44GV44CC55yB55Wl44GV44KM44Gf5aC05ZCI44CBIGBzcHJpdGUuaGVpZ2h0YFxuICAgICAgICAgKi9cbiAgICAgICAgRnJhbWVTcHJpdGUuY3JlYXRlQnlTcHJpdGUgPSBmdW5jdGlvbiAoc3ByaXRlLCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgICAgICB2YXIgZnJhbWVTcHJpdGUgPSBuZXcgRnJhbWVTcHJpdGUoe1xuICAgICAgICAgICAgICAgIHNjZW5lOiBzcHJpdGUuc2NlbmUsXG4gICAgICAgICAgICAgICAgc3JjOiBzcHJpdGUuc3VyZmFjZSxcbiAgICAgICAgICAgICAgICB3aWR0aDogd2lkdGggPT09IHVuZGVmaW5lZCA/IHNwcml0ZS53aWR0aCA6IHdpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0ID09PSB1bmRlZmluZWQgPyBzcHJpdGUuaGVpZ2h0IDogaGVpZ2h0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGZyYW1lU3ByaXRlLnNyY0hlaWdodCA9IGhlaWdodCA9PT0gdW5kZWZpbmVkID8gc3ByaXRlLnNyY0hlaWdodCA6IGhlaWdodDtcbiAgICAgICAgICAgIGZyYW1lU3ByaXRlLnNyY1dpZHRoID0gd2lkdGggPT09IHVuZGVmaW5lZCA/IHNwcml0ZS5zcmNXaWR0aCA6IHdpZHRoO1xuICAgICAgICAgICAgcmV0dXJuIGZyYW1lU3ByaXRlO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44Ki44OL44Oh44O844K344On44Oz44KS6ZaL5aeL44GZ44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBGcmFtZVNwcml0ZS5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pbnRlcnZhbCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWwgPSAxMDAwIC8gdGhpcy5nYW1lKCkuZnBzO1xuICAgICAgICAgICAgaWYgKHRoaXMuX3RpbWVyKVxuICAgICAgICAgICAgICAgIHRoaXMuX2ZyZWUoKTtcbiAgICAgICAgICAgIHRoaXMuX3RpbWVyID0gdGhpcy5zY2VuZS5jcmVhdGVUaW1lcih0aGlzLmludGVydmFsKTtcbiAgICAgICAgICAgIHRoaXMuX3RpbWVyLmVsYXBzZWQuYWRkKHRoaXMuX29uRWxhcHNlZCwgdGhpcyk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPjgpLnoLTmo4TjgZnjgovjgIJcbiAgICAgICAgICog44OH44OV44Kp44Or44OI44Gn44Gv5Yip55So44GX44Gm44GE44KLIGBTdXJmYWNlYCDjga7noLTmo4Tjga/ooYzjgo/jgarjgYTngrnjgavms6jmhI/jgIJcbiAgICAgICAgICogQHBhcmFtIGRlc3Ryb3lTdXJmYWNlIHRydWXjgpLmjIflrprjgZfjgZ/loLTlkIjjgIHjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPjgYzmirHjgYjjgosgYFN1cmZhY2VgIOOCguWQiOOCj+OBm+OBpuegtOajhOOBmeOCi1xuICAgICAgICAgKi9cbiAgICAgICAgRnJhbWVTcHJpdGUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoZGVzdHJveVN1cmZhY2UpIHtcbiAgICAgICAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcywgZGVzdHJveVN1cmZhY2UpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44Ki44OL44Oh44O844K344On44Oz44KS5YGc5q2i44GZ44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBGcmFtZVNwcml0ZS5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl90aW1lcilcbiAgICAgICAgICAgICAgICB0aGlzLl9mcmVlKCk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPjgavlr77jgZnjgovlpInmm7TjgpLjgqjjg7Pjgrjjg7PjgavpgJrnn6XjgZnjgovjgILoqbPntLDjga8gYEUjbW9kaWZpZWQoKWAg44Gu44OJ44Kt44Ol44Oh44Oz44OI44KS5Y+C54Wn44CCXG4gICAgICAgICAqL1xuICAgICAgICBGcmFtZVNwcml0ZS5wcm90b3R5cGUubW9kaWZpZWQgPSBmdW5jdGlvbiAoaXNCdWJibGluZykge1xuICAgICAgICAgICAgdGhpcy5fbW9kaWZpZWRTZWxmKGlzQnViYmxpbmcpO1xuICAgICAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5tb2RpZmllZC5jYWxsKHRoaXMsIGlzQnViYmxpbmcpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIEZyYW1lU3ByaXRlLnByb3RvdHlwZS5fb25FbGFwc2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZnJhbWVOdW1iZXIgPT09IHRoaXMuZnJhbWVzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5sb29wKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZnJhbWVOdW1iZXIgPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmluaXNoZWQuZmlyZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWVOdW1iZXIrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubW9kaWZpZWQoKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBGcmFtZVNwcml0ZS5wcm90b3R5cGUuX2ZyZWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX3RpbWVyKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHRoaXMuX3RpbWVyLmVsYXBzZWQucmVtb3ZlKHRoaXMuX29uRWxhcHNlZCwgdGhpcyk7XG4gICAgICAgICAgICBpZiAodGhpcy5fdGltZXIuY2FuRGVsZXRlKCkpXG4gICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5kZWxldGVUaW1lcih0aGlzLl90aW1lcik7XG4gICAgICAgICAgICB0aGlzLl90aW1lciA9IHVuZGVmaW5lZDtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBGcmFtZVNwcml0ZS5wcm90b3R5cGUuX2NoYW5nZUZyYW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGZyYW1lID0gdGhpcy5mcmFtZXNbdGhpcy5mcmFtZU51bWJlcl07XG4gICAgICAgICAgICB2YXIgc2VwID0gTWF0aC5mbG9vcih0aGlzLnN1cmZhY2Uud2lkdGggLyB0aGlzLnNyY1dpZHRoKTtcbiAgICAgICAgICAgIHRoaXMuc3JjWCA9IChmcmFtZSAlIHNlcCkgKiB0aGlzLnNyY1dpZHRoO1xuICAgICAgICAgICAgdGhpcy5zcmNZID0gTWF0aC5mbG9vcihmcmFtZSAvIHNlcCkgKiB0aGlzLnNyY0hlaWdodDtcbiAgICAgICAgICAgIHRoaXMuX2xhc3RVc2VkSW5kZXggPSBmcmFtZTtcbiAgICAgICAgfTtcbiAgICAgICAgRnJhbWVTcHJpdGUucHJvdG90eXBlLl9tb2RpZmllZFNlbGYgPSBmdW5jdGlvbiAoaXNCdWJibGluZykge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2xhc3RVc2VkSW5kZXggIT09IHRoaXMuZnJhbWVzW3RoaXMuZnJhbWVOdW1iZXJdKVxuICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZUZyYW1lKCk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBGcmFtZVNwcml0ZTtcbiAgICB9KGcuU3ByaXRlKSk7XG4gICAgZy5GcmFtZVNwcml0ZSA9IEZyYW1lU3ByaXRlO1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIC8qKlxuICAgICAqIOOCpOODmeODs+ODiOOBrueoruWIpeOAglxuICAgICAqL1xuICAgIHZhciBFdmVudFR5cGU7XG4gICAgKGZ1bmN0aW9uIChFdmVudFR5cGUpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOS4jeaYjuOBquOCpOODmeODs+ODiOOAglxuICAgICAgICAgKiDjgrLjg7zjg6DplovnmbrogIXjga/jgZPjga7lgKTjgpLliKnnlKjjgZfjgabjga/jgarjgonjgarjgYTjgIJcbiAgICAgICAgICovXG4gICAgICAgIEV2ZW50VHlwZVtFdmVudFR5cGVbXCJVbmtub3duXCJdID0gMF0gPSBcIlVua25vd25cIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOODl+ODrOOCpOODpOODvOOBruWPguWKoOOCkuihqOOBmeOCpOODmeODs+ODiOOAglxuICAgICAgICAgKi9cbiAgICAgICAgRXZlbnRUeXBlW0V2ZW50VHlwZVtcIkpvaW5cIl0gPSAxXSA9IFwiSm9pblwiO1xuICAgICAgICAvKipcbiAgICAgICAgICog44OX44Os44Kk44Ok44O844Gu6Zui6ISx44KS6KGo44GZ44Kk44OZ44Oz44OI44CCXG4gICAgICAgICAqL1xuICAgICAgICBFdmVudFR5cGVbRXZlbnRUeXBlW1wiTGVhdmVcIl0gPSAyXSA9IFwiTGVhdmVcIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOCv+OCpOODoOOCueOCv+ODs+ODl+OCkuihqOOBmeOCpOODmeODs+ODiOOAglxuICAgICAgICAgKi9cbiAgICAgICAgRXZlbnRUeXBlW0V2ZW50VHlwZVtcIlRpbWVzdGFtcFwiXSA9IDNdID0gXCJUaW1lc3RhbXBcIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOS5seaVsOeUn+aIkOWZqOOBrueUn+aIkOOCkuihqOOBmeOCpOODmeODs+ODiOOAglxuICAgICAgICAgKiDjgZPjga7lgKTjga/liKnnlKjjgZXjgozjgabjgYTjgarjgYTjgIJcbiAgICAgICAgICovXG4gICAgICAgIEV2ZW50VHlwZVtFdmVudFR5cGVbXCJTZWVkXCJdID0gNF0gPSBcIlNlZWRcIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOODneOCpOODs+ODiOODgOOCpuODs+OCpOODmeODs+ODiOOAglxuICAgICAgICAgKi9cbiAgICAgICAgRXZlbnRUeXBlW0V2ZW50VHlwZVtcIlBvaW50RG93blwiXSA9IDVdID0gXCJQb2ludERvd25cIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOODneOCpOODs+ODiOODoOODvOODluOCpOODmeODs+ODiOOAglxuICAgICAgICAgKi9cbiAgICAgICAgRXZlbnRUeXBlW0V2ZW50VHlwZVtcIlBvaW50TW92ZVwiXSA9IDZdID0gXCJQb2ludE1vdmVcIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOODneOCpOODs+ODiOOCouODg+ODl+OCpOODmeODs+ODiOOAglxuICAgICAgICAgKi9cbiAgICAgICAgRXZlbnRUeXBlW0V2ZW50VHlwZVtcIlBvaW50VXBcIl0gPSA3XSA9IFwiUG9pbnRVcFwiO1xuICAgICAgICAvKipcbiAgICAgICAgICog5rGO55So55qE44Gq44Oh44OD44K744O844K444KS6KGo44GZ44Kk44OZ44Oz44OI44CCXG4gICAgICAgICAqL1xuICAgICAgICBFdmVudFR5cGVbRXZlbnRUeXBlW1wiTWVzc2FnZVwiXSA9IDhdID0gXCJNZXNzYWdlXCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDmk43kvZzjg5fjg6njgrDjgqTjg7PjgYzpgJrnn6XjgZnjgovmk43kvZzjgpLooajjgZnjgqTjg5njg7Pjg4jjgIJcbiAgICAgICAgICovXG4gICAgICAgIEV2ZW50VHlwZVtFdmVudFR5cGVbXCJPcGVyYXRpb25cIl0gPSA5XSA9IFwiT3BlcmF0aW9uXCI7XG4gICAgfSkoRXZlbnRUeXBlID0gZy5FdmVudFR5cGUgfHwgKGcuRXZlbnRUeXBlID0ge30pKTtcbiAgICAvKipcbiAgICAgKiDjg53jgqTjg7Pjg4bjgqPjg7PjgrDmk43kvZzjgpLooajjgZnjgqTjg5njg7Pjg4jjgIJcbiAgICAgKiBQb2ludEV2ZW50I3RhcmdldOOBp+OBneOBruODneOCpOODs+ODhuOCo+ODs+OCsOaTjeS9nOOBruWvvuixoeOBqOOBquOBo+OBn+OCqOODs+ODhuOCo+ODhuOCo+OBjOOAgVxuICAgICAqIFBvaW50RXZlbnQjcG9pbnTjgafjgZ3jga7jgqjjg7Pjg4bjgqPjg4bjgqPjgYvjgonopovjgabjga7nm7jlr77luqfmqJnjgYzlj5blvpfjgafjgY3jgovjgIJcbiAgICAgKlxuICAgICAqIOacrOOCpOODmeODs+ODiOOBr+ODnuODq+ODgeOCv+ODg+ODgeOBq+WvvuW/nOOBl+OBpuOBiuOCiuOAgVBvaW50RXZlbnQjcG9pbnRlcklk44KS5Y+C54Wn44GZ44KL44GT44Go44Gn6K2Y5Yil44GZ44KL44GT44Go44GM5Ye65p2l44KL44CCXG4gICAgICpcbiAgICAgKiBhYnN0cmFjdFxuICAgICAqL1xuICAgIHZhciBQb2ludEV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgICAgICBmdW5jdGlvbiBQb2ludEV2ZW50KHBvaW50ZXJJZCwgdGFyZ2V0LCBwb2ludCwgcGxheWVyLCBsb2NhbCwgcHJpb3JpdHkpIHtcbiAgICAgICAgICAgIHRoaXMucHJpb3JpdHkgPSBwcmlvcml0eTtcbiAgICAgICAgICAgIHRoaXMubG9jYWwgPSBsb2NhbDtcbiAgICAgICAgICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xuICAgICAgICAgICAgdGhpcy5wb2ludGVySWQgPSBwb2ludGVySWQ7XG4gICAgICAgICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICAgICAgICAgIHRoaXMucG9pbnQgPSBwb2ludDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUG9pbnRFdmVudDtcbiAgICB9KCkpO1xuICAgIGcuUG9pbnRFdmVudCA9IFBvaW50RXZlbnQ7XG4gICAgLyoqXG4gICAgICog44Od44Kk44Oz44OG44Kj44Oz44Kw5pON5L2c44Gu6ZaL5aeL44KS6KGo44GZ44Kk44OZ44Oz44OI44CCXG4gICAgICovXG4gICAgdmFyIFBvaW50RG93bkV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoUG9pbnREb3duRXZlbnQsIF9zdXBlcik7XG4gICAgICAgIGZ1bmN0aW9uIFBvaW50RG93bkV2ZW50KHBvaW50ZXJJZCwgdGFyZ2V0LCBwb2ludCwgcGxheWVyLCBsb2NhbCwgcHJpb3JpdHkpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHBvaW50ZXJJZCwgdGFyZ2V0LCBwb2ludCwgcGxheWVyLCBsb2NhbCwgcHJpb3JpdHkpIHx8IHRoaXM7XG4gICAgICAgICAgICBfdGhpcy50eXBlID0gRXZlbnRUeXBlLlBvaW50RG93bjtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUG9pbnREb3duRXZlbnQ7XG4gICAgfShQb2ludEV2ZW50KSk7XG4gICAgZy5Qb2ludERvd25FdmVudCA9IFBvaW50RG93bkV2ZW50O1xuICAgIC8qKlxuICAgICAqIOODneOCpOODs+ODhuOCo+ODs+OCsOaTjeS9nOOBrue1guS6huOCkuihqOOBmeOCpOODmeODs+ODiOOAglxuICAgICAqIFBvaW50RG93bkV2ZW505b6M44Gr44Gu44G/55m655Sf44GZ44KL44CCXG4gICAgICpcbiAgICAgKiBQb2ludFVwRXZlbnQjc3RhcnREZWx0YeOBq+OCiOOBo+OBplBvaW50RG93bkV2ZW505pmC44GL44KJ44Gu56e75YuV6YeP44GM44CBXG4gICAgICogUG9pbnRVcEV2ZW50I3ByZXZEZWx0YeOBq+OCiOOBo+OBpuebtOi/keOBrlBvaW50TW92ZUV2ZW5044GL44KJ44Gu56e75YuV6YeP44GM5Y+W5b6X5Ye65p2l44KL44CCXG4gICAgICogUG9pbnRVcEV2ZW50I3BvaW5044Gr44GvUG9pbnREb3duRXZlbnQjcG9pbnTjgajlkIzjgZjlgKTjgYzmoLzntI3jgZXjgozjgovjgIJcbiAgICAgKi9cbiAgICB2YXIgUG9pbnRVcEV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoUG9pbnRVcEV2ZW50LCBfc3VwZXIpO1xuICAgICAgICBmdW5jdGlvbiBQb2ludFVwRXZlbnQocG9pbnRlcklkLCB0YXJnZXQsIHBvaW50LCBwcmV2RGVsdGEsIHN0YXJ0RGVsdGEsIHBsYXllciwgbG9jYWwsIHByaW9yaXR5KSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwb2ludGVySWQsIHRhcmdldCwgcG9pbnQsIHBsYXllciwgbG9jYWwsIHByaW9yaXR5KSB8fCB0aGlzO1xuICAgICAgICAgICAgX3RoaXMudHlwZSA9IEV2ZW50VHlwZS5Qb2ludFVwO1xuICAgICAgICAgICAgX3RoaXMucHJldkRlbHRhID0gcHJldkRlbHRhO1xuICAgICAgICAgICAgX3RoaXMuc3RhcnREZWx0YSA9IHN0YXJ0RGVsdGE7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFBvaW50VXBFdmVudDtcbiAgICB9KFBvaW50RXZlbnQpKTtcbiAgICBnLlBvaW50VXBFdmVudCA9IFBvaW50VXBFdmVudDtcbiAgICAvKipcbiAgICAgKiDjg53jgqTjg7Pjg4bjgqPjg7PjgrDmk43kvZzjga7np7vli5XjgpLooajjgZnjgqTjg5njg7Pjg4jjgIJcbiAgICAgKiBQb2ludERvd25FdmVudOW+jOOBq+OBruOBv+eZuueUn+OBmeOCi+OBn+OCgeOAgU1vdXNlTW92ZeebuOW9k+OBruOCguOBruOBjOacrOOCpOODmeODs+ODiOOBqOOBl+OBpueZuueUn+OBmeOCi+OBk+OBqOOBr+OBquOBhOOAglxuICAgICAqXG4gICAgICogUG9pbnRNb3ZlRXZlbnQjc3RhcnREZWx0YeOBq+OCiOOBo+OBplBvaW50RG93bkV2ZW505pmC44GL44KJ44Gu56e75YuV6YeP44GM44CBXG4gICAgICogUG9pbnRNb3ZlRXZlbnQjcHJldkRlbHRh44Gr44KI44Gj44Gm55u06L+R44GuUG9pbnRNb3ZlRXZlbnTjgYvjgonjga7np7vli5Xph4/jgYzlj5blvpflh7rmnaXjgovjgIJcbiAgICAgKiBQb2ludE1vdmVFdmVudCNwb2ludOOBq+OBr1BvaW50TW92ZUV2ZW50I3BvaW5044Go5ZCM44GY5YCk44GM5qC857SN44GV44KM44KL44CCXG4gICAgICpcbiAgICAgKiDmnKzjgqTjg5njg7Pjg4jjga/jgIHjg5fjg6zjgqTjg6Tjg7zjgYzjg53jgqTjg7Pjg4bjgqPjg7PjgrDjg4fjg5DjgqTjgrnjgpLnp7vli5XjgZfjgabjgYTjgarjgY/jgabjgoLjgIFcbiAgICAgKiDjgqvjg6Hjg6njga7np7vli5XnrYnoppbopprnmoTjgavjg53jgqTjg7Pjg4jjgYzlpInljJbjgZfjgabjgYTjgovloLTlkIjjgavjgoLnmbrnlJ/jgZnjgovjgIJcbiAgICAgKi9cbiAgICB2YXIgUG9pbnRNb3ZlRXZlbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhQb2ludE1vdmVFdmVudCwgX3N1cGVyKTtcbiAgICAgICAgZnVuY3Rpb24gUG9pbnRNb3ZlRXZlbnQocG9pbnRlcklkLCB0YXJnZXQsIHBvaW50LCBwcmV2RGVsdGEsIHN0YXJ0RGVsdGEsIHBsYXllciwgbG9jYWwsIHByaW9yaXR5KSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwb2ludGVySWQsIHRhcmdldCwgcG9pbnQsIHBsYXllciwgbG9jYWwsIHByaW9yaXR5KSB8fCB0aGlzO1xuICAgICAgICAgICAgX3RoaXMudHlwZSA9IEV2ZW50VHlwZS5Qb2ludE1vdmU7XG4gICAgICAgICAgICBfdGhpcy5wcmV2RGVsdGEgPSBwcmV2RGVsdGE7XG4gICAgICAgICAgICBfdGhpcy5zdGFydERlbHRhID0gc3RhcnREZWx0YTtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUG9pbnRNb3ZlRXZlbnQ7XG4gICAgfShQb2ludEV2ZW50KSk7XG4gICAgZy5Qb2ludE1vdmVFdmVudCA9IFBvaW50TW92ZUV2ZW50O1xuICAgIC8qKlxuICAgICAqIOaxjueUqOeahOOBquODoeODg+OCu+ODvOOCuOOCkuihqOOBmeOCpOODmeODs+ODiOOAglxuICAgICAqIE1lc3NhZ2VFdmVudCNkYXRh44Gr44KI44Gj44Gm44Oh44OD44K744O844K45YaF5a6544KS5Y+W5b6X5Ye65p2l44KL44CCXG4gICAgICovXG4gICAgdmFyIE1lc3NhZ2VFdmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gTWVzc2FnZUV2ZW50KGRhdGEsIHBsYXllciwgbG9jYWwsIHByaW9yaXR5KSB7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSBFdmVudFR5cGUuTWVzc2FnZTtcbiAgICAgICAgICAgIHRoaXMucHJpb3JpdHkgPSBwcmlvcml0eTtcbiAgICAgICAgICAgIHRoaXMubG9jYWwgPSBsb2NhbDtcbiAgICAgICAgICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xuICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTWVzc2FnZUV2ZW50O1xuICAgIH0oKSk7XG4gICAgZy5NZXNzYWdlRXZlbnQgPSBNZXNzYWdlRXZlbnQ7XG4gICAgLyoqXG4gICAgICog5pON5L2c44OX44Op44Kw44Kk44Oz44GM6YCa55+l44GZ44KL5pON5L2c44KS6KGo44GZ44Kk44OZ44Oz44OI44CCXG4gICAgICog44OX44Op44Kw44Kk44Oz44KS6K2Y5Yil44GZ44KLIGBPcGVyYXRpb25FdmVudCNjb2RlYCDjgajjgIHjg5fjg6njgrDjgqTjg7PjgZTjgajjga7lhoXlrrkgYE9wZXJhdGlvbkV2ZW50I2RhdGFgIOOCkuaMgeOBpOOAglxuICAgICAqL1xuICAgIHZhciBPcGVyYXRpb25FdmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gT3BlcmF0aW9uRXZlbnQoY29kZSwgZGF0YSwgcGxheWVyLCBsb2NhbCwgcHJpb3JpdHkpIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IEV2ZW50VHlwZS5PcGVyYXRpb247XG4gICAgICAgICAgICB0aGlzLnByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgICAgICB0aGlzLmxvY2FsID0gbG9jYWw7XG4gICAgICAgICAgICB0aGlzLnBsYXllciA9IHBsYXllcjtcbiAgICAgICAgICAgIHRoaXMuY29kZSA9IGNvZGU7XG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBPcGVyYXRpb25FdmVudDtcbiAgICB9KCkpO1xuICAgIGcuT3BlcmF0aW9uRXZlbnQgPSBPcGVyYXRpb25FdmVudDtcbiAgICAvKipcbiAgICAgKiDjg5fjg6zjgqTjg6Tjg7zjga7lj4LliqDjgpLooajjgZnjgqTjg5njg7Pjg4jjgIJcbiAgICAgKiBKb2luRXZlbnQjcGxheWVy44Gr44KI44Gj44Gm44CB5Y+C5Yqg44GX44Gf44OX44Os44Kk44Ok44O844KS5Y+W5b6X5Ye65p2l44KL44CCXG4gICAgICovXG4gICAgdmFyIEpvaW5FdmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gSm9pbkV2ZW50KHBsYXllciwgc3RvcmFnZVZhbHVlcywgcHJpb3JpdHkpIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IEV2ZW50VHlwZS5Kb2luO1xuICAgICAgICAgICAgdGhpcy5wcmlvcml0eSA9IHByaW9yaXR5O1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIgPSBwbGF5ZXI7XG4gICAgICAgICAgICB0aGlzLnN0b3JhZ2VWYWx1ZXMgPSBzdG9yYWdlVmFsdWVzO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBKb2luRXZlbnQ7XG4gICAgfSgpKTtcbiAgICBnLkpvaW5FdmVudCA9IEpvaW5FdmVudDtcbiAgICAvKipcbiAgICAgKiDjg5fjg6zjgqTjg6Tjg7zjga7pm6LohLHjgpLooajjgZnjgqTjg5njg7Pjg4jjgIJcbiAgICAgKiBMZWF2ZUV2ZW50I3BsYXllcuOBq+OCiOOBo+OBpuOAgembouiEseOBl+OBn+ODl+ODrOOCpOODpOODvOOCkuWPluW+l+WHuuadpeOCi+OAglxuICAgICAqL1xuICAgIHZhciBMZWF2ZUV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgICAgICBmdW5jdGlvbiBMZWF2ZUV2ZW50KHBsYXllciwgcHJpb3JpdHkpIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IEV2ZW50VHlwZS5MZWF2ZTtcbiAgICAgICAgICAgIHRoaXMucHJpb3JpdHkgPSBwcmlvcml0eTtcbiAgICAgICAgICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBMZWF2ZUV2ZW50O1xuICAgIH0oKSk7XG4gICAgZy5MZWF2ZUV2ZW50ID0gTGVhdmVFdmVudDtcbiAgICAvKipcbiAgICAgKiDjgr/jgqTjg6Djgrnjgr/jg7Pjg5fjgpLooajjgZnjgqTjg5njg7Pjg4jjgIJcbiAgICAgKi9cbiAgICB2YXIgVGltZXN0YW1wRXZlbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIFRpbWVzdGFtcEV2ZW50KHRpbWVzdGFtcCwgcGxheWVyLCBwcmlvcml0eSkge1xuICAgICAgICAgICAgdGhpcy50eXBlID0gRXZlbnRUeXBlLlRpbWVzdGFtcDtcbiAgICAgICAgICAgIHRoaXMucHJpb3JpdHkgPSBwcmlvcml0eTtcbiAgICAgICAgICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xuICAgICAgICAgICAgdGhpcy50aW1lc3RhbXAgPSB0aW1lc3RhbXA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFRpbWVzdGFtcEV2ZW50O1xuICAgIH0oKSk7XG4gICAgZy5UaW1lc3RhbXBFdmVudCA9IFRpbWVzdGFtcEV2ZW50O1xuICAgIC8qKlxuICAgICAqIOaWsOOBl+OBhOS5seaVsOOBrueZuueUn+OCkuihqOOBmeOCpOODmeODs+ODiOOAglxuICAgICAqIFNlZWRFdmVudCNnZW5lcmF0b3LjgavjgojjgaPjgabjgIHmnKzjgqTjg5njg7Pjg4jjgafnmbrnlJ/jgZfjgZ9SYW5kb21HZW5lcmF0b3LjgpLlj5blvpflh7rmnaXjgovjgIJcbiAgICAgKi9cbiAgICB2YXIgU2VlZEV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgICAgICBmdW5jdGlvbiBTZWVkRXZlbnQoZ2VuZXJhdG9yLCBwcmlvcml0eSkge1xuICAgICAgICAgICAgdGhpcy50eXBlID0gRXZlbnRUeXBlLlNlZWQ7XG4gICAgICAgICAgICB0aGlzLnByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgICAgICB0aGlzLmdlbmVyYXRvciA9IGdlbmVyYXRvcjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gU2VlZEV2ZW50O1xuICAgIH0oKSk7XG4gICAgZy5TZWVkRXZlbnQgPSBTZWVkRXZlbnQ7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog44Ot44Kw44Os44OZ44Or44CCXG4gICAgICpcbiAgICAgKiAtIEVycm9yOiDjgrXjg7zjg5DlgbTjgafjgoLlj47pm4bjgZXjgozjgovjgIHjgrLjg7zjg6DntprooYzkuI3lj6/og73jgarjgq/jg6rjg4bjgqPjgqvjg6vjgarjgqjjg6njg7zjg63jgrBcbiAgICAgKiAtIFdhcm46IOOCteODvOODkOWBtOOBp+OCguWPjumbhuOBleOCjOOCi+OAgeOCsuODvOODoOe2muihjOWPr+iDveOBoOOBjOWNsemZuuOBqueKtuaFi+OBp+OBguOCi+OBk+OBqOOCkuekuuOBmeitpuWRiuODreOCsFxuICAgICAqIC0gSW5mbzog44Kv44Op44Kk44Ki44Oz44OI44Gn44Gu44G/5Y+O6ZuG44GV44KM44KL5oOF5aCx44Ot44KwXG4gICAgICogLSBEZWJ1Zzog44K144Oz44OJ44Oc44OD44Kv44K555Kw5aKD44Gn44Gu44G/5Y+O6ZuG44GV44KM44KL6ZaL55m65pmC6ZmQ5a6a44Gu44Ot44Kw44CC44Oq44Oq44O844K55pmC44Gr44Gv5pys5Yem55CG44KS44GZ44G544Gm5raI44GX44Gm44Oq44Oq44O844K544GZ44KL44GT44Go44GM5pyb44G+44GX44GEXG4gICAgICovXG4gICAgdmFyIExvZ0xldmVsO1xuICAgIChmdW5jdGlvbiAoTG9nTGV2ZWwpIHtcbiAgICAgICAgTG9nTGV2ZWxbTG9nTGV2ZWxbXCJFcnJvclwiXSA9IDBdID0gXCJFcnJvclwiO1xuICAgICAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIldhcm5cIl0gPSAxXSA9IFwiV2FyblwiO1xuICAgICAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIkluZm9cIl0gPSAyXSA9IFwiSW5mb1wiO1xuICAgICAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIkRlYnVnXCJdID0gM10gPSBcIkRlYnVnXCI7XG4gICAgfSkoTG9nTGV2ZWwgPSBnLkxvZ0xldmVsIHx8IChnLkxvZ0xldmVsID0ge30pKTtcbiAgICAvKipcbiAgICAgKiDjg4fjg5Djg4PjgrAv44Ko44Op44O855So44Gu44Ot44Kw5Ye65Yqb5qmf5qeL44CCXG4gICAgICovXG4gICAgdmFyIExvZ2dlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGBMb2dnZXJgIOOBruOCpOODs+OCueOCv+ODs+OCueOCkueUn+aIkOOBmeOCi+OAglxuICAgICAgICAgKiBAcGFyYW0gZ2FtZSDjgZPjga4gYExvZ2dlcmAg44Gr57SQ44Gl44GPIGBHYW1lYCDjgIJcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIExvZ2dlcihnYW1lKSB7XG4gICAgICAgICAgICB0aGlzLmdhbWUgPSBnYW1lO1xuICAgICAgICAgICAgdGhpcy5sb2dnaW5nID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICB9XG4gICAgICAgIExvZ2dlci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuZ2FtZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMubG9nZ2luZy5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLmxvZ2dpbmcgPSB1bmRlZmluZWQ7XG4gICAgICAgIH07XG4gICAgICAgIExvZ2dlci5wcm90b3R5cGUuZGVzdHJveWVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICF0aGlzLmdhbWU7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBgTG9nTGV2ZWwuRXJyb3JgIOOBruODreOCsOOCkuWHuuWKm+OBmeOCi+OAglxuICAgICAgICAgKiBAcGFyYW0gbWVzc2FnZSDjg63jgrDjg6Hjg4Pjgrvjg7zjgrhcbiAgICAgICAgICogQHBhcmFtIGNhdXNlIOi/veWKoOOBruijnOWKqeaDheWgseOAguecgeeVpeOBleOCjOOBn+WgtOWQiOOAgSBgdW5kZWZpbmVkYFxuICAgICAgICAgKiBAZGVwcmVjYXRlZCDjgZPjga7jg6Hjgr3jg4Pjg4njga/pnZ7mjqjlpajjgafjgYLjgovjgILjgrLjg7zjg6DplovnmbrogIXjga/jgZPjga7jg6Hjgr3jg4Pjg4njgafjga/jgarjgY/ljZjjgasgYGNvbnNvbGUuZXJyb3IoKWAg44KEIGBjb25zb2xlLmxvZygpYCDjgpLliKnnlKjjgZnjgbnjgY3jgafjgYLjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIExvZ2dlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAobWVzc2FnZSwgY2F1c2UpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2luZy5maXJlKHtcbiAgICAgICAgICAgICAgICBnYW1lOiB0aGlzLmdhbWUsXG4gICAgICAgICAgICAgICAgbGV2ZWw6IExvZ0xldmVsLkVycm9yLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgY2F1c2U6IGNhdXNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGBMb2dMZXZlbC5XYXJuYCDjga7jg63jgrDjgpLlh7rlipvjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIG1lc3NhZ2Ug44Ot44Kw44Oh44OD44K744O844K4XG4gICAgICAgICAqIEBwYXJhbSBjYXVzZSDov73liqDjga7oo5zliqnmg4XloLHjgILnnIHnlaXjgZXjgozjgZ/loLTlkIjjgIEgYHVuZGVmaW5lZGBcbiAgICAgICAgICogQGRlcHJlY2F0ZWQg44GT44Gu44Oh44K944OD44OJ44Gv6Z2e5o6o5aWo44Gn44GC44KL44CC44Ky44O844Og6ZaL55m66ICF44Gv44GT44Gu44Oh44K944OD44OJ44Gn44Gv44Gq44GP5Y2Y44GrIGBjb25zb2xlLndhcm4oKWAg44KEIGBjb25zb2xlLmxvZygpYCDjgpLliKnnlKjjgZnjgbnjgY3jgafjgYLjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIExvZ2dlci5wcm90b3R5cGUud2FybiA9IGZ1bmN0aW9uIChtZXNzYWdlLCBjYXVzZSkge1xuICAgICAgICAgICAgdGhpcy5sb2dnaW5nLmZpcmUoe1xuICAgICAgICAgICAgICAgIGdhbWU6IHRoaXMuZ2FtZSxcbiAgICAgICAgICAgICAgICBsZXZlbDogTG9nTGV2ZWwuV2FybixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLFxuICAgICAgICAgICAgICAgIGNhdXNlOiBjYXVzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBgTG9nTGV2ZWwuSW5mb2Ag44Gu44Ot44Kw44KS5Ye65Yqb44GZ44KL44CCXG4gICAgICAgICAqIEBwYXJhbSBtZXNzYWdlIOODreOCsOODoeODg+OCu+ODvOOCuFxuICAgICAgICAgKiBAcGFyYW0gY2F1c2Ug6L+95Yqg44Gu6KOc5Yqp5oOF5aCx44CC55yB55Wl44GV44KM44Gf5aC05ZCI44CBIGB1bmRlZmluZWRgXG4gICAgICAgICAqIEBkZXByZWNhdGVkIOOBk+OBruODoeOCveODg+ODieOBr+mdnuaOqOWlqOOBp+OBguOCi+OAguOCsuODvOODoOmWi+eZuuiAheOBr+OBk+OBruODoeOCveODg+ODieOBp+OBr+OBquOBj+WNmOOBqyBgY29uc29sZS5pbmZvKClgIOOChCBgY29uc29sZS5sb2coKWAg44KS5Yip55So44GZ44G544GN44Gn44GC44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBMb2dnZXIucHJvdG90eXBlLmluZm8gPSBmdW5jdGlvbiAobWVzc2FnZSwgY2F1c2UpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2luZy5maXJlKHtcbiAgICAgICAgICAgICAgICBnYW1lOiB0aGlzLmdhbWUsXG4gICAgICAgICAgICAgICAgbGV2ZWw6IExvZ0xldmVsLkluZm8sXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcbiAgICAgICAgICAgICAgICBjYXVzZTogY2F1c2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogYExvZ0xldmVsLkRlYnVnYCDjga7jg63jgrDjgpLlh7rlipvjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIG1lc3NhZ2Ug44Ot44Kw44Oh44OD44K744O844K4XG4gICAgICAgICAqIEBwYXJhbSBjYXVzZSDov73liqDjga7oo5zliqnmg4XloLHjgILnnIHnlaXjgZXjgozjgZ/loLTlkIjjgIEgYHVuZGVmaW5lZGBcbiAgICAgICAgICogQGRlcHJlY2F0ZWQg44GT44Gu44Oh44K944OD44OJ44Gv6Z2e5o6o5aWo44Gn44GC44KL44CC44Ky44O844Og6ZaL55m66ICF44Gv44GT44Gu44Oh44K944OD44OJ44Gn44Gv44Gq44GP5Y2Y44GrIGBjb25zb2xlLmRlYnVnKClgIOOChCBgY29uc29sZS5sb2coKWAg44KS5Yip55So44GZ44G544GN44Gn44GC44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBMb2dnZXIucHJvdG90eXBlLmRlYnVnID0gZnVuY3Rpb24gKG1lc3NhZ2UsIGNhdXNlKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dpbmcuZmlyZSh7XG4gICAgICAgICAgICAgICAgZ2FtZTogdGhpcy5nYW1lLFxuICAgICAgICAgICAgICAgIGxldmVsOiBMb2dMZXZlbC5EZWJ1ZyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLFxuICAgICAgICAgICAgICAgIGNhdXNlOiBjYXVzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBMb2dnZXI7XG4gICAgfSgpKTtcbiAgICBnLkxvZ2dlciA9IExvZ2dlcjtcbn0pKGcgfHwgKGcgPSB7fSkpO1xudmFyIGc7XG4oZnVuY3Rpb24gKGcpIHtcbiAgICAvKipcbiAgICAgKiDjgrPjg7Pjg4bjg7Pjg4TjgZ3jga7jgoLjga7jgpLooajjgZnjgq/jg6njgrnjgIJcbiAgICAgKlxuICAgICAqIOacrOOCr+ODqeOCueOBruOCpOODs+OCueOCv+ODs+OCueOBr+aal+m7meOBq+eUn+aIkOOBleOCjOOAgeOCsuODvOODoOmWi+eZuuiAheOBjOeUn+aIkOOBmeOCi+OBk+OBqOOBr+OBquOBhOOAglxuICAgICAqIOOCsuODvOODoOmWi+eZuuiAheOBr2cuZ2FtZeOBq+OCiOOBo+OBpuacrOOCr+ODqeOCueOBruOCpOODs+OCueOCv+ODs+OCueOCkuWPgueFp+OBp+OBjeOCi+OAglxuICAgICAqXG4gICAgICog5aSa44GP44Gu5qmf6IO944KS5oyB44Gk44GM44CB5pys44Kv44Op44K544KS44Ky44O844Og6ZaL55m66ICF44GM5Yip55So44GZ44KL44Gu44Gv5Lul5LiL44Gu44KI44GG44Gq44Kx44O844K544Gn44GC44KL44CCXG4gICAgICogMS4gU2NlbmXjga7nlJ/miJDmmYLjgIHjgrPjg7Pjgrnjg4jjg6njgq/jgr/jgavlvJXmlbDjgajjgZfjgabmuKHjgZlcbiAgICAgKiAyLiBTY2VuZeOBq+e0kOS7mOOBi+OBquOBhOOCpOODmeODs+ODiCBHYW1lI2pvaW4sIEdhbWUjbGVhdmUsIEdhbWUjc2VlZCDjgpLlh6bnkIbjgZnjgotcbiAgICAgKiAzLiDkubHmlbDjgpLnmbrnlJ/jgZXjgZvjgovjgZ/jgoHjgIFHYW1lI3JhbmRvbeOBq+OCouOCr+OCu+OCueOBl1JhbmRvbUdlbmVyYXRvcuOCkuWPluW+l+OBmeOCi1xuICAgICAqIDQuIOODreOCsOOCkuWHuuWKm+OBmeOCi+OBn+OCgeOAgUdhbWUjbG9nZ2Vy44Gn44Kz44Oz44OG44Oz44OE44Gr57SQ5LuY44GPTG9nZ2Vy44KS5Y+W5b6X44GZ44KLXG4gICAgICogNS4g44Ky44O844Og44Gu44Oh44K/5oOF5aCx44KS56K66KqN44GZ44KL44Gf44KB44CBR2FtZSN3aWR0aCwgR2FtZSNoZWlnaHQsIEdhbWUjZnBz44Gr44Ki44Kv44K744K544GZ44KLXG4gICAgICogNi4g44Kw44Ot44O844OQ44Or44Ki44K744OD44OI44KS5Y+W5b6X44GZ44KL44Gf44KB44CBR2FtZSNhc3NldHPjgavjgqLjgq/jgrvjgrnjgZnjgotcbiAgICAgKiA3LiBMb2FkaW5nU2NlbmXjgpLlpInmm7TjgZnjgovjgZ/jgoHjgIFHYW1lI2xvYWRpbmdTY2VuZeOBq+OCsuODvOODoOmWi+eZuuiAheOBruWumue+qeOBl+OBn0xvYWRpbmdTY2VuZeOCkuaMh+WumuOBmeOCi1xuICAgICAqIDguIOOCueODiuODg+ODl+OCt+ODp+ODg+ODiOapn+iDveOCkuS9nOOCi+OBn+OCgeOAgUdhbWUjc25hcHNob3RSZXF1ZXN044Gr44Ki44Kv44K744K544GZ44KLXG4gICAgICogOS4g54++5Zyo44OV44Kp44O844Kr44K544GV44KM44Gm44GE44KLQ2FtZXJh5oOF5aCx44KS5b6X44KL44Gf44KB44CBR2FtZSNmb2N1c2luZ0NhbWVyYeOBq+OCouOCr+OCu+OCueOBmeOCi1xuICAgICAqIDEwLkF1ZGlvU3lzdGVt44KS55u05o6l5Yi25b6h44GZ44KL44Gf44KB44CBR2FtZSNhdWRpb+OBq+OCouOCr+OCu+OCueOBmeOCi1xuICAgICAqIDExLlNjZW5l44Gu44K544K/44OD44Kv5oOF5aCx44KS6Kq/44G544KL44Gf44KB44CBR2FtZSNzY2VuZXPjgavjgqLjgq/jgrvjgrnjgZnjgotcbiAgICAgKi9cbiAgICB2YXIgR2FtZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGBHYW1lYCDjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLnlJ/miJDjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIGdhbWVDb25maWd1cmF0aW9uIOOBk+OBriBgR2FtZWAg44Gu6Kit5a6a44CC5YW45Z6L55qE44Gr44GvIGdhbWUuanNvbiDjga7lhoXlrrnjgpLjg5Hjg7zjgrnjgZfjgZ/jgoLjga7jgpLmnJ/lvoXjgZnjgotcbiAgICAgICAgICogQHBhcmFtIHJlc291cmNlRmFjdG9yeSDjgZPjga4gYEdhbWVgIOOBjOeUqOOBhOOCi+OAgeODquOCveODvOOCueOBruODleOCoeOCr+ODiOODqlxuICAgICAgICAgKiBAcGFyYW0gYXNzZXRCYXNlIOOCouOCu+ODg+ODiOOBruODkeOCueOBruWfuua6luOBqOOBquOCi+ODh+OCo+ODrOOCr+ODiOODquOAguecgeeVpeOBleOCjOOBn+WgtOWQiOOAgeepuuaWh+Wtl+WIl1xuICAgICAgICAgKiBAcGFyYW0gc2VsZklkIOOBk+OBruOCsuODvOODoOOCkuWun+ihjOOBmeOCi+ODpuODvOOCtuOBrklE44CC55yB55Wl44GV44KM44Gf5aC05ZCI44CBYHVuZGVmaW5lZGBcbiAgICAgICAgICogQHBhcmFtIG9wZXJhdGlvblBsdWdpblZpZXdJbmZvIOOBk+OBruOCsuODvOODoOOBruaTjeS9nOODl+ODqeOCsOOCpOODs+OBq+S4juOBiOOCi3ZpZXfjga7mg4XloLFcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIEdhbWUoZ2FtZUNvbmZpZ3VyYXRpb24sIHJlc291cmNlRmFjdG9yeSwgYXNzZXRCYXNlLCBzZWxmSWQsIG9wZXJhdGlvblBsdWdpblZpZXdJbmZvKSB7XG4gICAgICAgICAgICBnYW1lQ29uZmlndXJhdGlvbiA9IHRoaXMuX25vcm1hbGl6ZUNvbmZpZ3VyYXRpb24oZ2FtZUNvbmZpZ3VyYXRpb24pO1xuICAgICAgICAgICAgdGhpcy5mcHMgPSBnYW1lQ29uZmlndXJhdGlvbi5mcHM7XG4gICAgICAgICAgICB0aGlzLndpZHRoID0gZ2FtZUNvbmZpZ3VyYXRpb24ud2lkdGg7XG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9IGdhbWVDb25maWd1cmF0aW9uLmhlaWdodDtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXJzID0gW107XG4gICAgICAgICAgICB0aGlzLnNjZW5lcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5yYW5kb20gPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5hZ2UgPSAwO1xuICAgICAgICAgICAgdGhpcy5hc3NldEJhc2UgPSBhc3NldEJhc2UgfHwgXCJcIjtcbiAgICAgICAgICAgIHRoaXMucmVzb3VyY2VGYWN0b3J5ID0gcmVzb3VyY2VGYWN0b3J5O1xuICAgICAgICAgICAgdGhpcy5zZWxmSWQgPSBzZWxmSWQgfHwgdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5wbGF5SWQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLmlzU2tpcHBpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuam9pbmVkUGxheWVySWRzID0gW107XG4gICAgICAgICAgICB0aGlzLl9hdWRpb1N5c3RlbU1hbmFnZXIgPSBuZXcgZy5BdWRpb1N5c3RlbU1hbmFnZXIodGhpcyk7XG4gICAgICAgICAgICB0aGlzLmF1ZGlvID0ge1xuICAgICAgICAgICAgICAgIG11c2ljOiBuZXcgZy5NdXNpY0F1ZGlvU3lzdGVtKFwibXVzaWNcIiwgdGhpcyksXG4gICAgICAgICAgICAgICAgc291bmQ6IG5ldyBnLlNvdW5kQXVkaW9TeXN0ZW0oXCJzb3VuZFwiLCB0aGlzKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdEF1ZGlvU3lzdGVtSWQgPSBcInNvdW5kXCI7XG4gICAgICAgICAgICB0aGlzLnN0b3JhZ2UgPSBuZXcgZy5TdG9yYWdlKHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5hc3NldHMgPSB7fTtcbiAgICAgICAgICAgIHRoaXMuc3VyZmFjZUF0bGFzU2V0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgLy8gVE9ETzogKEdBTUVERVYtNjY2KSDjgZPjga7kuInjgaTjga7jgqTjg5njg7Pjg4jjga9HYW1l6Ieq6Lqr44GM44OH44OV44Kp44Or44OI44Gu44Kk44OZ44Oz44OI44OP44Oz44OJ44Op44KS5oyB44Gj44Gm5Yem55CG44GZ44KL5b+F6KaB44GM44GC44KL44GL44KCXG4gICAgICAgICAgICB0aGlzLmpvaW4gPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgICAgICB0aGlzLmxlYXZlID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICAgICAgdGhpcy5zZWVkID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICAgICAgdGhpcy5fZXZlbnRUcmlnZ2VyTWFwID0ge307XG4gICAgICAgICAgICB0aGlzLl9ldmVudFRyaWdnZXJNYXBbZy5FdmVudFR5cGUuSm9pbl0gPSB0aGlzLmpvaW47XG4gICAgICAgICAgICB0aGlzLl9ldmVudFRyaWdnZXJNYXBbZy5FdmVudFR5cGUuTGVhdmVdID0gdGhpcy5sZWF2ZTtcbiAgICAgICAgICAgIHRoaXMuX2V2ZW50VHJpZ2dlck1hcFtnLkV2ZW50VHlwZS5TZWVkXSA9IHRoaXMuc2VlZDtcbiAgICAgICAgICAgIHRoaXMuX2V2ZW50VHJpZ2dlck1hcFtnLkV2ZW50VHlwZS5NZXNzYWdlXSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuX2V2ZW50VHJpZ2dlck1hcFtnLkV2ZW50VHlwZS5Qb2ludERvd25dID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fZXZlbnRUcmlnZ2VyTWFwW2cuRXZlbnRUeXBlLlBvaW50TW92ZV0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl9ldmVudFRyaWdnZXJNYXBbZy5FdmVudFR5cGUuUG9pbnRVcF0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl9ldmVudFRyaWdnZXJNYXBbZy5FdmVudFR5cGUuT3BlcmF0aW9uXSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMucmVzaXplZCA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgICAgIHRoaXMuc2tpcHBpbmdDaGFuZ2VkID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICAgICAgdGhpcy5pc0xhc3RUaWNrTG9jYWwgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5sYXN0T21pdHRlZExvY2FsVGlja0NvdW50ID0gMDtcbiAgICAgICAgICAgIHRoaXMuX2xvYWRlZCA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgICAgIHRoaXMuX3N0YXJ0ZWQgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgICAgICB0aGlzLmlzTG9hZGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnNuYXBzaG90UmVxdWVzdCA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgICAgIHRoaXMuZXh0ZXJuYWwgPSB7fTtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyID0gbmV3IGcuTG9nZ2VyKHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5fbWFpbiA9IGdhbWVDb25maWd1cmF0aW9uLm1haW47XG4gICAgICAgICAgICB0aGlzLl9tYWluUGFyYW1ldGVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fY29uZmlndXJhdGlvbiA9IGdhbWVDb25maWd1cmF0aW9uO1xuICAgICAgICAgICAgdGhpcy5fYXNzZXRNYW5hZ2VyID0gbmV3IGcuQXNzZXRNYW5hZ2VyKHRoaXMsIGdhbWVDb25maWd1cmF0aW9uLmFzc2V0cywgZ2FtZUNvbmZpZ3VyYXRpb24uYXVkaW8sIGdhbWVDb25maWd1cmF0aW9uLm1vZHVsZU1haW5TY3JpcHRzKTtcbiAgICAgICAgICAgIHZhciBvcGVyYXRpb25QbHVnaW5zRmllbGQgPSAoZ2FtZUNvbmZpZ3VyYXRpb24ub3BlcmF0aW9uUGx1Z2lucyB8fCBbXSk7XG4gICAgICAgICAgICB0aGlzLl9vcGVyYXRpb25QbHVnaW5NYW5hZ2VyID0gbmV3IGcuT3BlcmF0aW9uUGx1Z2luTWFuYWdlcih0aGlzLCBvcGVyYXRpb25QbHVnaW5WaWV3SW5mbywgb3BlcmF0aW9uUGx1Z2luc0ZpZWxkKTtcbiAgICAgICAgICAgIHRoaXMuX29wZXJhdGlvblBsdWdpbk9wZXJhdGVkID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICAgICAgdGhpcy5fb3BlcmF0aW9uUGx1Z2luTWFuYWdlci5vcGVyYXRlZC5hZGQodGhpcy5fb3BlcmF0aW9uUGx1Z2luT3BlcmF0ZWQuZmlyZSwgdGhpcy5fb3BlcmF0aW9uUGx1Z2luT3BlcmF0ZWQpO1xuICAgICAgICAgICAgdGhpcy5fc2NlbmVDaGFuZ2VkID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICAgICAgdGhpcy5fc2NlbmVDaGFuZ2VkLmFkZCh0aGlzLl91cGRhdGVFdmVudFRyaWdnZXJzLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuX2luaXRpYWxTY2VuZSA9IG5ldyBnLlNjZW5lKHtcbiAgICAgICAgICAgICAgICBnYW1lOiB0aGlzLFxuICAgICAgICAgICAgICAgIGFzc2V0SWRzOiB0aGlzLl9hc3NldE1hbmFnZXIuZ2xvYmFsQXNzZXRJZHMoKSxcbiAgICAgICAgICAgICAgICBsb2NhbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBuYW1lOiBcImFrYXNoaWM6aW5pdGlhbC1zY2VuZVwiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuX2luaXRpYWxTY2VuZS5sb2FkZWQuYWRkKHRoaXMuX29uSW5pdGlhbFNjZW5lTG9hZGVkLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuX3Jlc2V0KHsgYWdlOiAwIH0pO1xuICAgICAgICB9XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShHYW1lLnByb3RvdHlwZSwgXCJmb2N1c2luZ0NhbWVyYVwiLCB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIOS9v+eUqOS4reOBruOCq+ODoeODqeOAglxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIGBHYW1lI2RyYXcoKWAsIGBHYW1lI2ZpbmRQb2ludFNvdXJjZSgpYCDjga7jg4fjg5Xjgqnjg6vjg4jlgKTjgajjgZfjgabkvb/nlKjjgZXjgozjgovjgIJcbiAgICAgICAgICAgICAqIOOBk+OBruWApOOCkuWkieabtOOBl+OBn+WgtOWQiOOAgeWkieabtOOCkuaPj+eUu+OBq+WPjeaYoOOBmeOCi+OBn+OCgeOBq+OBryBgR2FtZSNtb2RpZmllZGAg44Gr55yf44KS5Luj5YWl44GX44Gq44GR44KM44Gw44Gq44KJ44Gq44GE44CCXG4gICAgICAgICAgICAgKiAo44Gf44Gg44GX44GT44Gu5YCk44GM6Z2eIGB1bmRlZmluZWRgIOOBruaZguOAgWBHYW1lI2ZvY3VzaW5nQ2FtZXJhLm1vZGlmaWVkKClgIOOCkuWRvOOBs+WHuuOBmeWgtOWQiOOBr1xuICAgICAgICAgICAgICogYEdhbWUjbW9kaWZpZWRgIOOBruaTjeS9nOOBr+ecgeeVpeOBp+OBjeOCi+OAgilcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgLy8gZm9jdXNpbmdDYW1lcmHjgYzlpInmm7TjgZXjgozjgabjgoLlj6TjgYTjgqvjg6Hjg6njgpJ0YXJnZXRDYW1lcmFz44Gr5oyB44Gk44Ko44Oz44OG44Kj44OG44Kj44GuRW50aXR5U3RhdGVGbGFncy5Nb2RpZmllZOOCkuWPluOCiuOBk+OBvOOBmeOBk+OBqOOBjOeEoeOBhOOCiOOBhuOBq+OAgeWkieabtOaZguOBq+OBr3JlbmRlcuOCkuWRvOOBueOCi+OCiOOBhuOCouOCr+OCu+OCteOCkuS9v+OBhlxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZvY3VzaW5nQ2FtZXJhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgICAgICBpZiAoYyA9PT0gdGhpcy5fZm9jdXNpbmdDYW1lcmEpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RpZmllZClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIodGhpcy5fZm9jdXNpbmdDYW1lcmEpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZvY3VzaW5nQ2FtZXJhID0gYztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICAvKipcbiAgICAgICAgICog44K344O844Oz44K544K/44OD44Kv44G444Gu44K344O844Oz44Gu6L+95Yqg44Go44CB44Gd44Gu44K344O844Oz44G444Gu6YG356e744KS6KaB5rGC44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBr+imgeaxguOCkuihjOOBhuOBoOOBkeOBp+OBguOCi+OAguWRvOOBs+WHuuOBl+ebtOW+jOOBq+OBr+OCt+ODvOODs+mBt+enu+OBr+ihjOOCj+OCjOOBpuOBhOOBquOBhOOBk+OBqOOBq+azqOaEj+OAglxuICAgICAgICAgKiDlrp/pmpvjga7jgrfjg7zjg7Ppgbfnp7vjga/mrKHjga7jg5Xjg6zjg7zjg6Djgb7jgafjgaso5qyh44GudXBkYXRl44GuZmlyZeOBvuOBp+OBqynooYzjgo/jgozjgovjgIJcbiAgICAgICAgICog44GT44Gu44Oh44K944OD44OJ44Gu5ZG844Gz5Ye644GX44Gr44KI44KK44CB54++5Zyo44Gu44K344O844Oz44GuIGBzdGF0ZUNoYW5nZWRgIOOBjOW8leaVsCBgU2NlbmVTdGF0ZS5EZWFjdGl2ZWAg44GnZmlyZeOBleOCjOOCi+OAglxuICAgICAgICAgKiDjgZ3jga7lvowgYHNjZW5lLnN0YXRlQ2hhbmdlZGAg44GM5byV5pWwIGBTY2VuZVN0YXRlLkFjdGl2ZWAg44GnZmlyZeOBleOCjOOCi+OAglxuICAgICAgICAgKiBAcGFyYW0gc2NlbmUg6YG356e75b6M44Gu44K344O844OzXG4gICAgICAgICAqL1xuICAgICAgICBHYW1lLnByb3RvdHlwZS5wdXNoU2NlbmUgPSBmdW5jdGlvbiAoc2NlbmUpIHtcbiAgICAgICAgICAgIHRoaXMuX3NjZW5lQ2hhbmdlUmVxdWVzdHMucHVzaCh7IHR5cGU6IDAgLyogUHVzaCAqLywgc2NlbmU6IHNjZW5lIH0pO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog54++5Zyo44Gu44K344O844Oz44Gu572u44GN5o+b44GI44KS6KaB5rGC44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOePvuWcqOOBruOCt+ODvOODs+OCkuOCt+ODvOODs+OCueOCv+ODg+OCr+OBi+OCieWPluOCiumZpOOBjeOAgeaMh+WumuOBruOCt+ODvOODs+OCkui/veWKoOOBmeOCi+OBk+OBqOOCkuimgeaxguOBmeOCi+OAglxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga/opoHmsYLjgpLooYzjgYbjgaDjgZHjgafjgYLjgovjgILlkbzjgbPlh7rjgZfnm7Tlvozjgavjga/jgrfjg7zjg7Ppgbfnp7vjga/ooYzjgo/jgozjgabjgYTjgarjgYTjgZPjgajjgavms6jmhI/jgIJcbiAgICAgICAgICog5a6f6Zqb44Gu44K344O844Oz6YG356e744Gv5qyh44Gu44OV44Os44O844Og44G+44Gn44GrKOasoeOBrnVwZGF0ZeOBrmZpcmXjgb7jgafjgasp6KGM44KP44KM44KL44CCXG4gICAgICAgICAqIOW8leaVsCBgcHJlc2VydmVDdXJyZW50YCDjgYzlgb3jga7loLTlkIjjgIHjgZPjga7jg6Hjgr3jg4Pjg4njga7lkbzjgbPlh7rjgZfjgavjgojjgornj77lnKjjga7jgrfjg7zjg7Pjga/noLTmo4TjgZXjgozjgovjgIJcbiAgICAgICAgICog44G+44Gf44Gd44Gu5pmCIGBzdGF0ZUNoYW5nZWRgIOOBjOW8leaVsCBgU2NlbmVTdGF0ZS5EZXN0cm95ZWRgIOOBp2ZpcmXjgZXjgozjgovjgIJcbiAgICAgICAgICog44Gd44Gu5b6MIGBzY2VuZS5zdGF0ZUNoYW5nZWRgIOOBjOW8leaVsCBgU2NlbmVTdGF0ZS5BY3RpdmVgIOOBp2ZpcmXjgZXjgozjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHNjZW5lIOmBt+enu+W+jOOBruOCt+ODvOODs1xuICAgICAgICAgKiBAcGFyYW0gcHJlc2VydmVDdXJyZW50IOecn+OBruWgtOWQiOOAgeePvuWcqOOBruOCt+ODvOODs+OCkuegtOajhOOBl+OBquOBhCjjgrLjg7zjg6DplovnmbrogIXjgYzmmI7npLrnmoTjgavnoLTmo4TjgZvjga3jgbDjgarjgonjgarjgYQp44CC55yB55Wl44GV44KM44Gf5aC05ZCI44CB5YG9XG4gICAgICAgICAqL1xuICAgICAgICBHYW1lLnByb3RvdHlwZS5yZXBsYWNlU2NlbmUgPSBmdW5jdGlvbiAoc2NlbmUsIHByZXNlcnZlQ3VycmVudCkge1xuICAgICAgICAgICAgdGhpcy5fc2NlbmVDaGFuZ2VSZXF1ZXN0cy5wdXNoKHsgdHlwZTogMSAvKiBSZXBsYWNlICovLCBzY2VuZTogc2NlbmUsIHByZXNlcnZlQ3VycmVudDogcHJlc2VydmVDdXJyZW50IH0pO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog5LiA44Gk5YmN44Gu44K344O844Oz44Gr5oi744KL44GT44Go44KS6KaB5rGC44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBr+imgeaxguOCkuihjOOBhuOBoOOBkeOBp+OBguOCi+OAguWRvOOBs+WHuuOBl+ebtOW+jOOBq+OBr+OCt+ODvOODs+mBt+enu+OBr+ihjOOCj+OCjOOBpuOBhOOBquOBhOOBk+OBqOOBq+azqOaEj+OAglxuICAgICAgICAgKiDlrp/pmpvjga7jgrfjg7zjg7Ppgbfnp7vjga/mrKHjga7jg5Xjg6zjg7zjg6Djgb7jgafjgaso5qyh44GudXBkYXRl44GuZmlyZeOBvuOBp+OBqynooYzjgo/jgozjgovjgIJcbiAgICAgICAgICog5byV5pWwIGBwcmVzZXJ2ZUN1cnJlbnRgIOOBjOWBveOBruWgtOWQiOOAgeOBk+OBruODoeOCveODg+ODieOBruWRvOOBs+WHuuOBl+OBq+OCiOOCiuePvuWcqOOBruOCt+ODvOODs+OBr+egtOajhOOBleOCjOOCi+OAglxuICAgICAgICAgKiDjgb7jgZ/jgZ3jga7mmYIgYHN0YXRlQ2hhbmdlZGAg44GM5byV5pWwIGBTY2VuZVN0YXRlLkRlc3Ryb3llZGAg44GnZmlyZeOBleOCjOOCi+OAglxuICAgICAgICAgKiDjgZ3jga7lvozkuIDjgaTliY3jga7jgrfjg7zjg7Pjga4gYHN0YXRlQ2hhbmdlZGAg44GM5byV5pWwIGBTY2VuZVN0YXRlLkFjdGl2ZWAg44GnZmlyZeOBleOCjOOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gcHJlc2VydmVDdXJyZW50IOecn+OBruWgtOWQiOOAgeePvuWcqOOBruOCt+ODvOODs+OCkuegtOajhOOBl+OBquOBhCjjgrLjg7zjg6DplovnmbrogIXjgYzmmI7npLrnmoTjgavnoLTmo4TjgZvjga3jgbDjgarjgonjgarjgYQp44CC55yB55Wl44GV44KM44Gf5aC05ZCI44CB5YG9XG4gICAgICAgICAqL1xuICAgICAgICBHYW1lLnByb3RvdHlwZS5wb3BTY2VuZSA9IGZ1bmN0aW9uIChwcmVzZXJ2ZUN1cnJlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuX3NjZW5lQ2hhbmdlUmVxdWVzdHMucHVzaCh7IHR5cGU6IDIgLyogUG9wICovLCBwcmVzZXJ2ZUN1cnJlbnQ6IHByZXNlcnZlQ3VycmVudCB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOePvuWcqOOBruOCt+ODvOODs+OCkui/lOOBmeOAglxuICAgICAgICAgKiDjgarjgYTloLTlkIjjgIEgYHVuZGVmaW5lZGAg44KS6L+U44GZ44CCXG4gICAgICAgICAqL1xuICAgICAgICBHYW1lLnByb3RvdHlwZS5zY2VuZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5zY2VuZXMubGVuZ3RoKVxuICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zY2VuZXNbdGhpcy5zY2VuZXMubGVuZ3RoIC0gMV07XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga4gYEdhbWVgIOOBruaZgumWk+e1jOmBjuOBqOOBneOCjOOBq+S8tOOBhuWHpueQhuOCkuihjOOBhuOAglxuICAgICAgICAgKlxuICAgICAgICAgKiDnj77lnKjjga4gYFNjZW5lYCDjgavlr77jgZfjgaYgYFNjZW5lI3VwZGF0ZWAg44KSZmlyZeOBl+OAgSBgdGhpcy5ldmVudHNgIOOBq+ioreWumuOBleOCjOOBn+OCpOODmeODs+ODiOOCkuWHpueQhuOBmeOCi+OAglxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga7lkbzjgbPlh7rjgZflvozjgIEgYHRoaXMuZXZlbnRzLmxlbmd0aGAg44GvMOOBp+OBguOCi+OAglxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga/mmpfpu5njgavlkbzjgbPlh7rjgZXjgozjgovjgILjgrLjg7zjg6DplovnmbrogIXjgYzjgZPjga7jg6Hjgr3jg4Pjg4njgpLliKnnlKjjgZnjgovlv4XopoHjga/jgarjgYTjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog5oi744KK5YCk44Gv5ZG844Gz5Ye644GX5YmN5b6M44Gn44K344O844Oz44GM5aSJ44KP44Gj44GfKOWIpeOBruOCt+ODvOODs+OBq+mBt+enu+OBl+OBnynloLTlkIjjgIHnnJ/jgILjgafjgarjgZHjgozjgbDlgb3jgIJcbiAgICAgICAgICogQHBhcmFtIGFkdmFuY2VBZ2Ug5YG944KS5LiO44GI44Gf5aC05ZCI44CBYHRoaXMuYWdlYCDjgpLpgLLjgoHjgarjgYTjgIJcbiAgICAgICAgICogQHBhcmFtIG9taXR0ZWRUaWNrQ291bnQg44K/44Kk44Og44K544K/44Oz44OX5b6F44Gh44KS55yB55Wl44GZ44KL5YuV5L2c44Gq44Gp44Gr44KI44KK44CBKOWJjeWbnuOBruWRvOOBs+WHuuOBl+S7pemZjeOBqynnnIHjgYvjgozjgZ/jg63jg7zjgqvjg6vjg4bjgqPjg4Pjgq/jga7mlbDjgILnnIHnlaXjgZXjgozjgZ/loLTlkIjjgIEgYDBgIOOAglxuICAgICAgICAgKi9cbiAgICAgICAgR2FtZS5wcm90b3R5cGUudGljayA9IGZ1bmN0aW9uIChhZHZhbmNlQWdlLCBvbWl0dGVkVGlja0NvdW50KSB7XG4gICAgICAgICAgICB2YXIgc2NlbmUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBpZiAodGhpcy5faXNUZXJtaW5hdGVkKVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXNMYXN0VGlja0xvY2FsID0gIWFkdmFuY2VBZ2U7XG4gICAgICAgICAgICB0aGlzLmxhc3RPbWl0dGVkTG9jYWxUaWNrQ291bnQgPSBvbWl0dGVkVGlja0NvdW50IHx8IDA7XG4gICAgICAgICAgICBpZiAodGhpcy5zY2VuZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgc2NlbmUgPSB0aGlzLnNjZW5lc1t0aGlzLnNjZW5lcy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ldmVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBldmVudHMgPSB0aGlzLmV2ZW50cztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ldmVudHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0cmlnZ2VyID0gdGhpcy5fZXZlbnRUcmlnZ2VyTWFwW2V2ZW50c1tpXS50eXBlXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmlnZ2VyKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXIuZmlyZShldmVudHNbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNjZW5lLnVwZGF0ZS5maXJlKCk7XG4gICAgICAgICAgICAgICAgaWYgKGFkdmFuY2VBZ2UpXG4gICAgICAgICAgICAgICAgICAgICsrdGhpcy5hZ2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5fc2NlbmVDaGFuZ2VSZXF1ZXN0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9mbHVzaFNjZW5lQ2hhbmdlUmVxdWVzdHMoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2NlbmUgIT09IHRoaXMuc2NlbmVzW3RoaXMuc2NlbmVzLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44GT44GuR2FtZeOCkuaPj+eUu+OBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgZPjga7jgrLjg7zjg6DjgavntJDjgaXjgZHjgonjgozjgZ8gYFJlbmRlcmVyYCAoYHRoaXMucmVuZGVyZXJzYCDjgavlkKvjgb7jgozjgovjgZnjgbnjgabjga4gYFJlbmRlcmVyYCDjgafjgIHjgZPjga4gYEdhbWVgIOOBruaPj+eUu+OCkuihjOOBhuOAglxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga/mmpfpu5njgavlkbzjgbPlh7rjgZXjgozjgovjgILjgrLjg7zjg6DplovnmbrogIXjgYzjgZPjga7jg6Hjgr3jg4Pjg4njgpLliKnnlKjjgZnjgovlv4XopoHjga/jgarjgYTjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIGNhbWVyYSDlr77osaHjga7jgqvjg6Hjg6njgILnnIHnlaXjgZXjgozjgZ/loLTlkIggYEdhbWUuZm9jdXNpbmdDYW1lcmFgXG4gICAgICAgICAqL1xuICAgICAgICBHYW1lLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoY2FtZXJhKSB7XG4gICAgICAgICAgICBpZiAoIWNhbWVyYSlcbiAgICAgICAgICAgICAgICBjYW1lcmEgPSB0aGlzLmZvY3VzaW5nQ2FtZXJhO1xuICAgICAgICAgICAgdmFyIHJlbmRlcmVycyA9IHRoaXMucmVuZGVyZXJzOyAvLyB1bnNhZmVcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVuZGVyZXJzLmxlbmd0aDsgKytpKVxuICAgICAgICAgICAgICAgIHJlbmRlcmVyc1tpXS5kcmF3KHRoaXMsIGNhbWVyYSk7XG4gICAgICAgICAgICB0aGlzLm1vZGlmaWVkID0gZmFsc2U7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZ3jga7luqfmqJnjgavlj43lv5zjgZnjgosgYFBvaW50U291cmNlYCDjgpLov5TjgZnjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog5oi744KK5YCk44Gv44CB5a++6LGh44GM6KaL44Gk44GL44Gj44Gf5aC05ZCI44CBIGB0YXJnZXRgIOOBq+imi+OBpOOBi+OBo+OBnyBgRWAg44KS5oyB44GkIGBQb2ludFNvdXJjZWAg44Gn44GC44KL44CCXG4gICAgICAgICAqIOWvvuixoeOBjOimi+OBpOOBi+OCieOBquOBi+OBo+OBn+WgtOWQiOOAgSBgdW5kZWZpbmVkYCDjgafjgYLjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog5oi744KK5YCk44GMIGB1bmRlZmluZWRgIOOBp+OBquOBhOWgtOWQiOOAgeOBneOBriBgdGFyZ2V0YCDjg5fjg63jg5Hjg4bjgqPjga/mrKHjgpLmuoDjgZ/jgZk6XG4gICAgICAgICAqIC0gYEUjdG91Y2hhYmxlYCDjgYznnJ/jgafjgYLjgotcbiAgICAgICAgICogLSDjgqvjg6Hjg6kgYGNhbWVyYWAg44GL44KJ5Y+v6KaW44Gn44GC44KL5Lit44Gn5pyA44KC5omL5YmN44Gr44GC44KLXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBwb2ludCDlr77osaHjga7luqfmqJlcbiAgICAgICAgICogQHBhcmFtIGNhbWVyYSDlr77osaHjga7jgqvjg6Hjg6njgILmjIflrprjgZfjgarjgZHjgozjgbAgYEdhbWUuZm9jdXNpbmdDYW1lcmFgIOOBjOS9v+OCj+OCjOOCi1xuICAgICAgICAgKi9cbiAgICAgICAgR2FtZS5wcm90b3R5cGUuZmluZFBvaW50U291cmNlID0gZnVuY3Rpb24gKHBvaW50LCBjYW1lcmEpIHtcbiAgICAgICAgICAgIGlmICghY2FtZXJhKVxuICAgICAgICAgICAgICAgIGNhbWVyYSA9IHRoaXMuZm9jdXNpbmdDYW1lcmE7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zY2VuZSgpLmZpbmRQb2ludFNvdXJjZUJ5UG9pbnQocG9pbnQsIGZhbHNlLCBjYW1lcmEpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44GT44GuR2FtZeOBq+OCqOODs+ODhuOCo+ODhuOCo+OCkueZu+mMsuOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga/lkITjgqjjg7Pjg4bjgqPjg4bjgqPjgavlr77jgZfjgabmmpfpu5njgavlkbzjgbPlh7rjgZXjgozjgovjgILjgrLjg7zjg6DplovnmbrogIXjgYzjgZPjga7jg6Hjgr3jg4Pjg4njgpLmmI7npLrnmoTjgavliKnnlKjjgZnjgovlv4XopoHjga/jgarjgYTjgIJcbiAgICAgICAgICogYGUuaWRgIOOBjCBgdW5kZWZpbmVkYCDjgafjgYLjgovloLTlkIjjgIHjgZPjga7jg6Hjgr3jg4Pjg4njga7lkbzjgbPlh7rjgZflvozjgIEgYGUuaWRgIOOBq+OBryBgdGhpc2Ag44Gr5LiA5oSP44Gu5YCk44GM6Kit5a6a44GV44KM44KL44CCXG4gICAgICAgICAqIGBlLmxvY2FsYCDjgYzlgb3jgafjgYLjgovloLTlkIjjgIHjgZPjga7jg6Hjgr3jg4Pjg4njga7lkbzjgbPlh7rjgZflvozjgIEgYHRoaXMuZGJbZS5pZF0gPT09IGVgIOOBjOaIkOeri+OBmeOCi+OAglxuICAgICAgICAgKiBgZS5sb2NhbGAg44GM55yf44Gn44GC44KL5aC05ZCI44CBIGBlLmlkYCDjga7lgKTjga/kuI3lrprjgafjgYLjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIGUg55m76Yyy44GZ44KL44Ko44Oz44OG44Kj44OG44KjXG4gICAgICAgICAqL1xuICAgICAgICBHYW1lLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZS5sb2NhbCkge1xuICAgICAgICAgICAgICAgIGlmIChlLmlkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5pZCA9IC0tdGhpcy5fbG9jYWxJZHg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyByZWdpc3RlcuWJjeOBq2lk44GM44GC44KLOiDjgrnjg4rjg4Pjg5fjgrfjg6fjg4Pjg4jjgYvjgonjga7lvqnlhYPnlKjjg5HjgrlcbiAgICAgICAgICAgICAgICAgICAgLy8g44K544OK44OD44OX44K344On44OD44OI44Gv44Ot44O844Kr44Or44Ko44Oz44OG44Kj44OG44Kj44KS5q6L44GV44Gq44GE44Gv44Ga44Gg44GM44CB5a6f6KOF5LiK44Gv44Gn44GN44KL44KI44GG44Gr44GX44Gm44GK44GP44CCXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLmlkID4gMClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkdhbWUjcmVnaXN0ZXI6IGludmFsaWQgbG9jYWwgaWQ6IFwiICsgZS5pZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9sb2NhbERiLmhhc093blByb3BlcnR5KFN0cmluZyhlLmlkKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJHYW1lI3JlZ2lzdGVyOiBjb25mbGljdGVkIGlkOiBcIiArIGUuaWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fbG9jYWxJZHggPiBlLmlkKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbG9jYWxJZHggPSBlLmlkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9sb2NhbERiW2UuaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChlLmlkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5pZCA9ICsrdGhpcy5faWR4O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVnaXN0ZXLliY3jgatpZOOBjOOBguOCizog44K544OK44OD44OX44K344On44OD44OI44GL44KJ44Gu5b6p5YWD55So44OR44K5XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLmlkIDwgMClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkdhbWUjcmVnaXN0ZXI6IGludmFsaWQgbm9uLWxvY2FsIGlkOiBcIiArIGUuaWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kYi5oYXNPd25Qcm9wZXJ0eShTdHJpbmcoZS5pZCkpKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiR2FtZSNyZWdpc3RlcjogY29uZmxpY3RlZCBpZDogXCIgKyBlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gX2lkeOOBjOODpuODi+ODvOOCr+OBquWApOOCkuS9nOOCjOOCi+OCiOOBhuabtOaWsOOBl+OBpuOBiuOBj1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5faWR4IDwgZS5pZClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lkeCA9IGUuaWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZGJbZS5pZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44GT44GuR2FtZeOBi+OCieOCqOODs+ODhuOCo+ODhuOCo+OBrueZu+mMsuOCkuWJiumZpOOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga/lkITjgqjjg7Pjg4bjgqPjg4bjgqPjgavlr77jgZfjgabmmpfpu5njgavlkbzjgbPlh7rjgZXjgozjgovjgILjgrLjg7zjg6DplovnmbrogIXjgYzjgZPjga7jg6Hjgr3jg4Pjg4njgpLmmI7npLrnmoTjgavliKnnlKjjgZnjgovlv4XopoHjga/jgarjgYTjgIJcbiAgICAgICAgICog44GT44Gu44Oh44K944OD44OJ44Gu5ZG844Gz5Ye644GX5b6M44CBIGB0aGlzLmRiW2UuaWRdYCDjga/mnKrlrprnvqnjgafjgYLjgovjgIJcbiAgICAgICAgICogQHBhcmFtIGUg55m76Yyy44KS5YmK6Zmk44GZ44KL44Ko44Oz44OG44Kj44OG44KjXG4gICAgICAgICAqL1xuICAgICAgICBHYW1lLnByb3RvdHlwZS51bnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGlmIChlLmxvY2FsKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2xvY2FsRGJbZS5pZF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5kYltlLmlkXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBkZXByZWNhdGVkIOePvuWcqOOBk+OBruODoeOCveODg+ODieOBr+WRvOOBs+WHuuOBl+OBpuOCguS9leOCguihjOOCj+OBquOBhOOAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgZPjga7jgrLjg7zjg6DjgpLpm6LohLHjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog5aSa5Lq65pWw44OX44Os44Kk44Gu5aC05ZCI44CB5LuW44Gu44Kv44Op44Kk44Ki44Oz44OI44Gn44GvIGBHYW1lI2xlYXZlYCDjgqTjg5njg7Pjg4jjgYxmaXJl44GV44KM44KL44CCXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBruWRvOOBs+WHuuOBl+W+jOOAgeOBk+OBruOCr+ODqeOCpOOCouODs+ODiOOBruaTjeS9nOimgeaxguOBr+mAgeS/oeOBleOCjOOBquOBhOOAglxuICAgICAgICAgKi9cbiAgICAgICAgR2FtZS5wcm90b3R5cGUubGVhdmVHYW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5fbGVhdmVHYW1lKCk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga7jgrLjg7zjg6DjgpLntYLkuobjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog44Ko44Oz44K444Oz44Gr5a++44GX44Gm57aa6KGM44Gu5pat5b+144KS6YCa55+l44GZ44KL44CCXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBruWRvOOBs+WHuuOBl+W+jOOAgeOBk+OBruOCr+ODqeOCpOOCouODs+ODiOOBruaTjeS9nOimgeaxguOBr+mAgeS/oeOBleOCjOOBquOBhOOAglxuICAgICAgICAgKiDjgb7jgZ/jgZPjga7jgq/jg6njgqTjgqLjg7Pjg4jjga7jgrLjg7zjg6Dlrp/ooYzjga/ooYzjgo/jgozjgarjgYQodXBkYXRl44KS5ZCr44KA44Kk44OZ44Oz44OI44GuZmlyZeOBr+OBiuOBjeOBquOBhCnjgIJcbiAgICAgICAgICovXG4gICAgICAgIEdhbWUucHJvdG90eXBlLnRlcm1pbmF0ZUdhbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLl9sZWF2ZUdhbWUoKTtcbiAgICAgICAgICAgIHRoaXMuX2lzVGVybWluYXRlZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgR2FtZS5wcm90b3R5cGUuX2ZpcmVTY2VuZVJlYWR5ID0gZnVuY3Rpb24gKHNjZW5lKSB7XG4gICAgICAgICAgICB0aGlzLl9zY2VuZUNoYW5nZVJlcXVlc3RzLnB1c2goeyB0eXBlOiAzIC8qIEZpcmVSZWFkeSAqLywgc2NlbmU6IHNjZW5lIH0pO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIEdhbWUucHJvdG90eXBlLl9maXJlU2NlbmVMb2FkZWQgPSBmdW5jdGlvbiAoc2NlbmUpIHtcbiAgICAgICAgICAgIGlmIChzY2VuZS5fbG9hZGluZ1N0YXRlIDwgZy5TY2VuZUxvYWRTdGF0ZS5Mb2FkZWRGaXJlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3NjZW5lQ2hhbmdlUmVxdWVzdHMucHVzaCh7IHR5cGU6IDQgLyogRmlyZUxvYWRlZCAqLywgc2NlbmU6IHNjZW5lIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIEdhbWUucHJvdG90eXBlLl9jYWxsU2NlbmVBc3NldEhvbGRlckhhbmRsZXIgPSBmdW5jdGlvbiAoYXNzZXRIb2xkZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX3NjZW5lQ2hhbmdlUmVxdWVzdHMucHVzaCh7IHR5cGU6IDUgLyogQ2FsbEFzc2V0SG9sZGVySGFuZGxlciAqLywgYXNzZXRIb2xkZXI6IGFzc2V0SG9sZGVyIH0pO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIEdhbWUucHJvdG90eXBlLl9ub3JtYWxpemVDb25maWd1cmF0aW9uID0gZnVuY3Rpb24gKGdhbWVDb25maWd1cmF0aW9uKSB7XG4gICAgICAgICAgICBpZiAoIWdhbWVDb25maWd1cmF0aW9uKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkdhbWUjX25vcm1hbGl6ZUNvbmZpZ3VyYXRpb246IGludmFsaWQgYXJndW1lbnRzXCIpO1xuICAgICAgICAgICAgaWYgKCEoXCJhc3NldHNcIiBpbiBnYW1lQ29uZmlndXJhdGlvbikpXG4gICAgICAgICAgICAgICAgZ2FtZUNvbmZpZ3VyYXRpb24uYXNzZXRzID0ge307XG4gICAgICAgICAgICBpZiAoIShcImZwc1wiIGluIGdhbWVDb25maWd1cmF0aW9uKSlcbiAgICAgICAgICAgICAgICBnYW1lQ29uZmlndXJhdGlvbi5mcHMgPSAzMDtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZ2FtZUNvbmZpZ3VyYXRpb24uZnBzICE9PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkdhbWUjX25vcm1hbGl6ZUNvbmZpZ3VyYXRpb246IGZwcyBtdXN0IGJlIGdpdmVuIGFzIGEgbnVtYmVyXCIpO1xuICAgICAgICAgICAgaWYgKCEoMCA8PSBnYW1lQ29uZmlndXJhdGlvbi5mcHMgJiYgZ2FtZUNvbmZpZ3VyYXRpb24uZnBzIDw9IDYwKSlcbiAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJHYW1lI19ub3JtYWxpemVDb25maWd1cmF0aW9uOiBmcHMgbXVzdCBiZSBhIG51bWJlciBpbiAoMCwgNjBdLlwiKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZ2FtZUNvbmZpZ3VyYXRpb24ud2lkdGggIT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiR2FtZSNfbm9ybWFsaXplQ29uZmlndXJhdGlvbjogd2lkdGggbXVzdCBiZSBnaXZlbiBhcyBhIG51bWJlclwiKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZ2FtZUNvbmZpZ3VyYXRpb24uaGVpZ2h0ICE9PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkdhbWUjX25vcm1hbGl6ZUNvbmZpZ3VyYXRpb246IGhlaWdodCBtdXN0IGJlIGdpdmVuIGFzIGEgbnVtYmVyXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGdhbWVDb25maWd1cmF0aW9uO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIEdhbWUucHJvdG90eXBlLl9zZXRBdWRpb1BsYXliYWNrUmF0ZSA9IGZ1bmN0aW9uIChwbGF5YmFja1JhdGUpIHtcbiAgICAgICAgICAgIHRoaXMuX2F1ZGlvU3lzdGVtTWFuYWdlci5fc2V0UGxheWJhY2tSYXRlKHBsYXliYWNrUmF0ZSk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgR2FtZS5wcm90b3R5cGUuX3NldE11dGVkID0gZnVuY3Rpb24gKG11dGVkKSB7XG4gICAgICAgICAgICB0aGlzLl9hdWRpb1N5c3RlbU1hbmFnZXIuX3NldE11dGVkKG11dGVkKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGcuT3BlcmF0aW9uRXZlbnTjga7jg4fjg7zjgr/jgpLjg4fjgrPjg7zjg4njgZnjgovjgIJcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIEdhbWUucHJvdG90eXBlLl9kZWNvZGVPcGVyYXRpb25QbHVnaW5PcGVyYXRpb24gPSBmdW5jdGlvbiAoY29kZSwgb3ApIHtcbiAgICAgICAgICAgIHZhciBwbHVnaW5zID0gdGhpcy5fb3BlcmF0aW9uUGx1Z2luTWFuYWdlci5wbHVnaW5zO1xuICAgICAgICAgICAgaWYgKCFwbHVnaW5zW2NvZGVdIHx8ICFwbHVnaW5zW2NvZGVdLmRlY29kZSlcbiAgICAgICAgICAgICAgICByZXR1cm4gb3A7XG4gICAgICAgICAgICByZXR1cm4gcGx1Z2luc1tjb2RlXS5kZWNvZGUob3ApO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44Ky44O844Og54q25oWL44Gu44Oq44K744OD44OI44CCXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBHYW1lLnByb3RvdHlwZS5fcmVzZXQgPSBmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgICAgIHRoaXMuX29wZXJhdGlvblBsdWdpbk1hbmFnZXIuc3RvcEFsbCgpO1xuICAgICAgICAgICAgaWYgKHRoaXMuc2NlbmUoKSkge1xuICAgICAgICAgICAgICAgIHdoaWxlICh0aGlzLnNjZW5lKCkgIT09IHRoaXMuX2luaXRpYWxTY2VuZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcFNjZW5lKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZsdXNoU2NlbmVDaGFuZ2VSZXF1ZXN0cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNMb2FkZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gX2luaXRpYWxTY2VuZeOBruiqreOBv+i+vOOBv+OBjOe1guOCj+OBo+OBpuOBhOOBquOBhDogX2luaXRpYWxTY2VuZeiHquS9k+OBr+S9v+OBhOWbnuOBmeOBruOBp+WNmOOBq3BvcOOBmeOCi+OAglxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjZW5lcy5wb3AoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGFyYW0pIHtcbiAgICAgICAgICAgICAgICBpZiAocGFyYW0uYWdlICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWdlID0gcGFyYW0uYWdlO1xuICAgICAgICAgICAgICAgIGlmIChwYXJhbS5yYW5kR2VuICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmFuZG9tID0gcGFyYW0ucmFuZEdlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2F1ZGlvU3lzdGVtTWFuYWdlci5fcmVzZXQoKTtcbiAgICAgICAgICAgIHRoaXMuX2xvYWRlZC5yZW1vdmVBbGwoeyBmdW5jOiB0aGlzLl9zdGFydCwgb3duZXI6IHRoaXMgfSk7XG4gICAgICAgICAgICB0aGlzLmpvaW4ucmVtb3ZlQWxsKCk7XG4gICAgICAgICAgICB0aGlzLmxlYXZlLnJlbW92ZUFsbCgpO1xuICAgICAgICAgICAgdGhpcy5zZWVkLnJlbW92ZUFsbCgpO1xuICAgICAgICAgICAgdGhpcy5yZXNpemVkLnJlbW92ZUFsbCgpO1xuICAgICAgICAgICAgdGhpcy5za2lwcGluZ0NoYW5nZWQucmVtb3ZlQWxsKCk7XG4gICAgICAgICAgICB0aGlzLmlzU2tpcHBpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuc2tpcHBpbmdDaGFuZ2VkLmFkZCh0aGlzLl9oYW5kbGVTa2lwcGluZ0NoYW5nZWQsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5qb2luZWRQbGF5ZXJJZHMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuam9pbi5hZGQodGhpcy5faGFuZGxlSm9pbkV2ZW50LCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMubGVhdmUuYWRkKHRoaXMuX2hhbmRsZUxlYXZlRXZlbnQsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5faWR4ID0gMDtcbiAgICAgICAgICAgIHRoaXMuX2xvY2FsSWR4ID0gMDtcbiAgICAgICAgICAgIHRoaXMuX2NhbWVyYUlkeCA9IDA7XG4gICAgICAgICAgICB0aGlzLmRiID0ge307XG4gICAgICAgICAgICB0aGlzLl9sb2NhbERiID0ge307XG4gICAgICAgICAgICB0aGlzLmV2ZW50cyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5tb2RpZmllZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmdTY2VuZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuX2ZvY3VzaW5nQ2FtZXJhID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fc2NyaXB0Q2FjaGVzID0ge307XG4gICAgICAgICAgICB0aGlzLnNuYXBzaG90UmVxdWVzdC5yZW1vdmVBbGwoKTtcbiAgICAgICAgICAgIHRoaXMuX3NjZW5lQ2hhbmdlUmVxdWVzdHMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuX2lzVGVybWluYXRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy52YXJzID0ge307XG4gICAgICAgICAgICBpZiAodGhpcy5zdXJmYWNlQXRsYXNTZXQpXG4gICAgICAgICAgICAgICAgdGhpcy5zdXJmYWNlQXRsYXNTZXQuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5zdXJmYWNlQXRsYXNTZXQgPSBuZXcgZy5TdXJmYWNlQXRsYXNTZXQoeyBnYW1lOiB0aGlzIH0pO1xuICAgICAgICAgICAgc3dpdGNoICh0aGlzLl9jb25maWd1cmF0aW9uLmRlZmF1bHRMb2FkaW5nU2NlbmUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwibm9uZVwiOlxuICAgICAgICAgICAgICAgICAgICAvLyBOb3RlOiDkvZXjgoLmj4/nlLvjgZfjgarjgYTlrp/oo4XjgajjgZfjgabliKnnlKjjgZfjgabjgYTjgotcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVmYXVsdExvYWRpbmdTY2VuZSA9IG5ldyBnLkxvYWRpbmdTY2VuZSh7IGdhbWU6IHRoaXMgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRMb2FkaW5nU2NlbmUgPSBuZXcgZy5EZWZhdWx0TG9hZGluZ1NjZW5lKHsgZ2FtZTogdGhpcyB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgrLjg7zjg6DjgpLnoLTmo4TjgZnjgovjgIJcbiAgICAgICAgICog44Ko44Oz44K444Oz44Om44O844K244Go44Kz44Oz44OG44Oz44OE44Gr6ZaL5pS+44GV44KM44Gf5LiA6YOo44OX44Ot44OR44OG44KjKGV4dGVybmFsLCB2YXJzKeOBr+e2reaMgeOBmeOCi+eCueOBq+azqOaEj+OAglxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgR2FtZS5wcm90b3R5cGUuX2Rlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyDjg6bjg7zjgrbjgrPjg7zjg4njgpLmibHjgYbmk43kvZzjg5fjg6njgrDjgqTjg7PjgpLnnJ/jgaPlhYjjgavnoLTmo4RcbiAgICAgICAgICAgIHRoaXMuX29wZXJhdGlvblBsdWdpbk1hbmFnZXIuZGVzdHJveSgpO1xuICAgICAgICAgICAgLy8g5Yiw6YGU44Gn44GN44KL44K344O844Oz44KS5YWo44Gm56C05qOEXG4gICAgICAgICAgICBpZiAodGhpcy5zY2VuZSgpKSB7XG4gICAgICAgICAgICAgICAgd2hpbGUgKHRoaXMuc2NlbmUoKSAhPT0gdGhpcy5faW5pdGlhbFNjZW5lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9wU2NlbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmx1c2hTY2VuZUNoYW5nZVJlcXVlc3RzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5faW5pdGlhbFNjZW5lLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmxvYWRpbmdTY2VuZSAmJiAhdGhpcy5sb2FkaW5nU2NlbmUuZGVzdHJveWVkKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmdTY2VuZS5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2RlZmF1bHRMb2FkaW5nU2NlbmUuZGVzdHJveWVkKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9kZWZhdWx0TG9hZGluZ1NjZW5lLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIE5PVEU6IGZwcywgd2lkdGgsIGhlaWdodCwgZXh0ZXJuYWwsIHZhcnMg44Gv44Gd44Gu44G+44G+5L+d5oyB44GX44Gm44GK44GPXG4gICAgICAgICAgICB0aGlzLmRiID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlcnMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLnNjZW5lcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMucmFuZG9tID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5ldmVudHMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLmpvaW4uZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5qb2luID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5sZWF2ZS5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLmxlYXZlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5zZWVkLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMuc2VlZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMubW9kaWZpZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuYWdlID0gMDtcbiAgICAgICAgICAgIHRoaXMuYXNzZXRzID0gdW5kZWZpbmVkOyAvLyB0aGlzLl9pbml0aWFsU2NlbmUuYXNzZXRzIOOBruOCqOOCpOODquOCouOCueOBquOBruOBp+OAgeeJueOBq+egtOajhOWHpueQhuOBr+OBl+OBquOBhOOAglxuICAgICAgICAgICAgdGhpcy5pc0xvYWRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nU2NlbmUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLmFzc2V0QmFzZSA9IFwiXCI7XG4gICAgICAgICAgICB0aGlzLnNlbGZJZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHZhciBhdWRpb1N5c3RlbUlkcyA9IE9iamVjdC5rZXlzKHRoaXMuYXVkaW8pO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhdWRpb1N5c3RlbUlkcy5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvW2F1ZGlvU3lzdGVtSWRzW2ldXS5zdG9wQWxsKCk7XG4gICAgICAgICAgICB0aGlzLmF1ZGlvID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5kZWZhdWx0QXVkaW9TeXN0ZW1JZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5zbmFwc2hvdFJlcXVlc3QuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5zbmFwc2hvdFJlcXVlc3QgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAvLyBUT0RPIOOCiOOCiuiDveWLleeahOOBq2Rlc3Ryb3nlh6bnkIbjgpLlhaXjgozjgovjgbnjgY3jgYvjgoLjgZfjgozjgarjgYRcbiAgICAgICAgICAgIHRoaXMucmVzb3VyY2VGYWN0b3J5ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5zdG9yYWdlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5wbGF5SWQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLm9wZXJhdGlvblBsdWdpbnMgPSB1bmRlZmluZWQ7IC8vIHRoaXMuX29wZXJhdGlvblBsdWdpbk1hbmFnZXIucGx1Z2luc+OBruOCqOOCpOODquOCouOCueOBquOBruOBp+OAgeeJueOBq+egtOajhOWHpueQhuOBr+OBl+OBquOBhOOAglxuICAgICAgICAgICAgdGhpcy5yZXNpemVkLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMucmVzaXplZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuc2tpcHBpbmdDaGFuZ2VkLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMuc2tpcHBpbmdDaGFuZ2VkID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fZXZlbnRUcmlnZ2VyTWFwID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5faW5pdGlhbFNjZW5lID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fZGVmYXVsdExvYWRpbmdTY2VuZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuX3NjZW5lQ2hhbmdlZC5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLl9zY2VuZUNoYW5nZWQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl9zY3JpcHRDYWNoZXMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl9sb2FkZWQuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5fbG9hZGVkID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fc3RhcnRlZC5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLl9zdGFydGVkID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fbWFpbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuX21haW5QYXJhbWV0ZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl9hc3NldE1hbmFnZXIuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5fYXNzZXRNYW5hZ2VyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fYXVkaW9TeXN0ZW1NYW5hZ2VyLl9nYW1lID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fYXVkaW9TeXN0ZW1NYW5hZ2VyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fb3BlcmF0aW9uUGx1Z2luTWFuYWdlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuX29wZXJhdGlvblBsdWdpbk9wZXJhdGVkLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMuX29wZXJhdGlvblBsdWdpbk9wZXJhdGVkID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5faWR4ID0gMDtcbiAgICAgICAgICAgIHRoaXMuX2xvY2FsRGIgPSB7fTtcbiAgICAgICAgICAgIHRoaXMuX2xvY2FsSWR4ID0gMDtcbiAgICAgICAgICAgIHRoaXMuX2NhbWVyYUlkeCA9IDA7XG4gICAgICAgICAgICB0aGlzLl9pc1Rlcm1pbmF0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fZm9jdXNpbmdDYW1lcmEgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl9jb25maWd1cmF0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fc2NlbmVDaGFuZ2VSZXF1ZXN0cyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5zdXJmYWNlQXRsYXNTZXQuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5zdXJmYWNlQXRsYXNTZXQgPSB1bmRlZmluZWQ7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgrLjg7zjg6DjgpLplovlp4vjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog5a2Y5Zyo44GZ44KL44K344O844Oz44KS44GZ44G544GmKF9pbml0aWFsU2NlbmXku6XlpJY7IOOBguOCi+OBquOCiSnnoLTmo4TjgZfjgIHjgrDjg63jg7zjg5Djg6vjgqLjgrvjg4Pjg4jjgpLoqq3jgb/ovrzjgb/jgIHlrozkuoblvozjgrLjg7zjg6DplovnmbrogIXjga7lrp/oo4XjgrPjg7zjg4njga7lrp/ooYzjgpLplovlp4vjgZnjgovjgIJcbiAgICAgICAgICog44GT44Gu44Oh44K944OD44OJ44Gu5LqM5bqm55uu5Lul6ZmN44Gu5ZG844Gz5Ye644GX44Gu5YmN44Gr44Gv44CBIGB0aGlzLl9yZXNldCgpYCDjgpLlkbzjgbPlh7rjgZnlv4XopoHjgYzjgYLjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHBhcmFtIOOCsuODvOODoOOBruOCqOODs+ODiOODquODneOCpOODs+ODiOOBq+a4oeOBmeWApFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgR2FtZS5wcm90b3R5cGUuX2xvYWRBbmRTdGFydCA9IGZ1bmN0aW9uIChwYXJhbSkge1xuICAgICAgICAgICAgdGhpcy5fbWFpblBhcmFtZXRlciA9IHBhcmFtIHx8IHt9O1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzTG9hZGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbG9hZGVkLmFkZCh0aGlzLl9zdGFydCwgdGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5wdXNoU2NlbmUodGhpcy5faW5pdGlhbFNjZW5lKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9mbHVzaFNjZW5lQ2hhbmdlUmVxdWVzdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXJ0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgrDjg63jg7zjg5Djg6vjgqLjgrvjg4Pjg4jjga7oqq3jgb/ovrzjgb/jgpLplovlp4vjgZnjgovjgIJcbiAgICAgICAgICog5Y2Y5L2T44OG44K544OI55SoIChtYWluU2NlbmXjgarjgannibnlrprjgqLjgrvjg4Pjg4jjga7lrZjlnKjjgpLliY3mj5DjgavjgZnjgotfbG9hZEFuZFN0YXJ0KCnjga/jg4bjgrnjg4jjgavkvb/jgYTjgavjgY/jgYQpIOOBquOBruOBp+OAgemAmuW4uOOCsuODvOODoOmWi+eZuuiAheOBjOWIqeeUqOOBmeOCi+OBk+OBqOOBr+OBquOBhFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgR2FtZS5wcm90b3R5cGUuX3N0YXJ0TG9hZGluZ0dsb2JhbEFzc2V0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzTG9hZGVkKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkdhbWUjX3N0YXJ0TG9hZGluZ0dsb2JhbEFzc2V0czogYWxyZWFkeSBsb2FkZWQuXCIpO1xuICAgICAgICAgICAgdGhpcy5wdXNoU2NlbmUodGhpcy5faW5pdGlhbFNjZW5lKTtcbiAgICAgICAgICAgIHRoaXMuX2ZsdXNoU2NlbmVDaGFuZ2VSZXF1ZXN0cygpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIEdhbWUucHJvdG90eXBlLl91cGRhdGVFdmVudFRyaWdnZXJzID0gZnVuY3Rpb24gKHNjZW5lKSB7XG4gICAgICAgICAgICB0aGlzLm1vZGlmaWVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmICghc2NlbmUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9ldmVudFRyaWdnZXJNYXBbZy5FdmVudFR5cGUuTWVzc2FnZV0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5fZXZlbnRUcmlnZ2VyTWFwW2cuRXZlbnRUeXBlLlBvaW50RG93bl0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5fZXZlbnRUcmlnZ2VyTWFwW2cuRXZlbnRUeXBlLlBvaW50TW92ZV0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5fZXZlbnRUcmlnZ2VyTWFwW2cuRXZlbnRUeXBlLlBvaW50VXBdID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHRoaXMuX2V2ZW50VHJpZ2dlck1hcFtnLkV2ZW50VHlwZS5PcGVyYXRpb25dID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2V2ZW50VHJpZ2dlck1hcFtnLkV2ZW50VHlwZS5NZXNzYWdlXSA9IHNjZW5lLm1lc3NhZ2U7XG4gICAgICAgICAgICB0aGlzLl9ldmVudFRyaWdnZXJNYXBbZy5FdmVudFR5cGUuUG9pbnREb3duXSA9IHNjZW5lLnBvaW50RG93bkNhcHR1cmU7XG4gICAgICAgICAgICB0aGlzLl9ldmVudFRyaWdnZXJNYXBbZy5FdmVudFR5cGUuUG9pbnRNb3ZlXSA9IHNjZW5lLnBvaW50TW92ZUNhcHR1cmU7XG4gICAgICAgICAgICB0aGlzLl9ldmVudFRyaWdnZXJNYXBbZy5FdmVudFR5cGUuUG9pbnRVcF0gPSBzY2VuZS5wb2ludFVwQ2FwdHVyZTtcbiAgICAgICAgICAgIHRoaXMuX2V2ZW50VHJpZ2dlck1hcFtnLkV2ZW50VHlwZS5PcGVyYXRpb25dID0gc2NlbmUub3BlcmF0aW9uO1xuICAgICAgICAgICAgc2NlbmUuX2FjdGl2YXRlKCk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgR2FtZS5wcm90b3R5cGUuX29uSW5pdGlhbFNjZW5lTG9hZGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5faW5pdGlhbFNjZW5lLmxvYWRlZC5yZW1vdmUodGhpcy5fb25Jbml0aWFsU2NlbmVMb2FkZWQsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5hc3NldHMgPSB0aGlzLl9pbml0aWFsU2NlbmUuYXNzZXRzO1xuICAgICAgICAgICAgdGhpcy5pc0xvYWRlZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLl9sb2FkZWQuZmlyZSgpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICog44Ko44Op44O844KS5Ye644GX44Gm44Ky44O844Og44KS6YCU5Lit57WC5LqG44GV44Gb44KL44Oh44K944OD44OJ44CCXG4gICAgICAgICAqL1xuICAgICAgICBHYW1lLnByb3RvdHlwZS5fYWJvcnRHYW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gZG8gbm90aGluZy5cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOimgeaxguOBleOCjOOBn+OCt+ODvOODs+mBt+enu+OCkuWun+ihjOOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiBgcHVzaFNjZW5lKClgIOOAgSBgcmVwbGFjZVNjZW5lKClgIOOChCBgcG9wU2NlbmUoKWAg44Gr44KI44Gj44Gm6KaB5rGC44GV44KM44Gf44K344O844Oz6YG356e744KS5a6f6KGM44GZ44KL44CCXG4gICAgICAgICAqIOmAmuW4uOOBk+OBruODoeOCveODg+ODieOBr+OAgeavjuODleODrOODvOODoOS4gOW6puOAgeODleODrOODvOODoOOBruacgOW+jOOBq+WRvOOBs+WHuuOBleOCjOOCi+OBk+OBqOOCkuacn+W+heOBmeOCiyAoYEdhbWUjdGljaygpYCDjgYzjgZPjga7lkbzjgbPlh7rjgZfjgpLooYzjgYYp44CCXG4gICAgICAgICAqIOOBn+OBoOOBl+OCsuODvOODoOmWi+Wni+aZgiAo44Kw44Ot44O844OQ44Or44Ki44K744OD44OI6Kqt44G/6L6844G/44O744K544OK44OD44OX44K344On44OD44OI44Ot44O844OA6LW35YuV5b6M44G+44Gf44GvbWFpblNjZW5l5a6f6KGM6ZaL5aeL5pmCKSDjgavplqLjgZfjgabjga/jgIFcbiAgICAgICAgICog44K344O844Oz6L+95Yqg44GM44Ky44O844Og6ZaL55m66ICF44Gu6KiY6L+w44Gr44KI44KJ44Gq44GEIChgdGljaygpYCDjga7lpJblgbTjgafjgYLjgospIOOBn+OCgeOAgeOBneOCjOOBnuOCjOOBrueuh+aJgOOBp+aYjuekuueahOOBq+OBk+OBruODoeOCveODg+ODieOCkuWRvOOBs+WHuuOBmeOAglxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgR2FtZS5wcm90b3R5cGUuX2ZsdXNoU2NlbmVDaGFuZ2VSZXF1ZXN0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVxcyA9IHRoaXMuX3NjZW5lQ2hhbmdlUmVxdWVzdHM7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2NlbmVDaGFuZ2VSZXF1ZXN0cyA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVxcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVxID0gcmVxc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChyZXEudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwIC8qIFB1c2ggKi86XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9sZFNjZW5lID0gdGhpcy5zY2VuZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvbGRTY2VuZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRTY2VuZS5fZGVhY3RpdmF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9kb1B1c2hTY2VuZShyZXEuc2NlbmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxIC8qIFJlcGxhY2UgKi86XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm90ZTogcmVwbGFjZVNjZW5l44Gu5aC05ZCI44CBcG9w5pmC54K544Gn44GvX3NjZW5lQ2hhbmdlZOOCkmZpcmXjgZfjgarjgYTjgIJfZG9QdXNoU2NlbmUoKSDjgafkuIDluqbjgaDjgZFmaXJl44GZ44KL44CCXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZG9Qb3BTY2VuZShyZXEucHJlc2VydmVDdXJyZW50LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZG9QdXNoU2NlbmUocmVxLnNjZW5lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMiAvKiBQb3AgKi86XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZG9Qb3BTY2VuZShyZXEucHJlc2VydmVDdXJyZW50LCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMyAvKiBGaXJlUmVhZHkgKi86XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXEuc2NlbmUuZGVzdHJveWVkKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5zY2VuZS5fZmlyZVJlYWR5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQgLyogRmlyZUxvYWRlZCAqLzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlcS5zY2VuZS5kZXN0cm95ZWQoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLnNjZW5lLl9maXJlTG9hZGVkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDUgLyogQ2FsbEFzc2V0SG9sZGVySGFuZGxlciAqLzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlcS5hc3NldEhvbGRlci5kZXN0cm95ZWQoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFzc2V0SG9sZGVyLmNhbGxIYW5kbGVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkdhbWUjX2ZsdXNoU2NlbmVDaGFuZ2VSZXF1ZXN0czogdW5rbm93biBzY2VuZSBjaGFuZ2UgcmVxdWVzdC5cIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IHdoaWxlICh0aGlzLl9zY2VuZUNoYW5nZVJlcXVlc3RzLmxlbmd0aCA+IDApOyAvLyBmbHVzaOS4reOBq+i/veWKoOOBleOCjOOCi+mZkOOCimZsdXNo44KS57aa6KGM44GZ44KLXG4gICAgICAgIH07XG4gICAgICAgIEdhbWUucHJvdG90eXBlLl9oYW5kbGVTa2lwcGluZ0NoYW5nZWQgPSBmdW5jdGlvbiAoaXNTa2lwcGluZykge1xuICAgICAgICAgICAgdGhpcy5pc1NraXBwaW5nID0gaXNTa2lwcGluZztcbiAgICAgICAgfTtcbiAgICAgICAgR2FtZS5wcm90b3R5cGUuX2hhbmRsZUpvaW5FdmVudCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuam9pbmVkUGxheWVySWRzLmluZGV4T2YoZXZlbnQucGxheWVyLmlkKSAhPT0gLTEpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5qb2luZWRQbGF5ZXJJZHMucHVzaChldmVudC5wbGF5ZXIuaWQpO1xuICAgICAgICB9O1xuICAgICAgICBHYW1lLnByb3RvdHlwZS5faGFuZGxlTGVhdmVFdmVudCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgdGhpcy5qb2luZWRQbGF5ZXJJZHMgPSB0aGlzLmpvaW5lZFBsYXllcklkcy5maWx0ZXIoZnVuY3Rpb24gKGlkKSB7IHJldHVybiBpZCAhPT0gZXZlbnQucGxheWVyLmlkOyB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgR2FtZS5wcm90b3R5cGUuX2RvUG9wU2NlbmUgPSBmdW5jdGlvbiAocHJlc2VydmVDdXJyZW50LCBmaXJlU2NlbmVDaGFuZ2VkKSB7XG4gICAgICAgICAgICB2YXIgc2NlbmUgPSB0aGlzLnNjZW5lcy5wb3AoKTtcbiAgICAgICAgICAgIGlmIChzY2VuZSA9PT0gdGhpcy5faW5pdGlhbFNjZW5lKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkdhbWUjX2RvUG9wU2NlbmU6IGludmFsaWQgY2FsbDsgYXR0ZW1wdGluZyB0byBwb3AgdGhlIGluaXRpYWwgc2NlbmVcIik7XG4gICAgICAgICAgICBpZiAoIXByZXNlcnZlQ3VycmVudClcbiAgICAgICAgICAgICAgICBzY2VuZS5kZXN0cm95KCk7XG4gICAgICAgICAgICBpZiAoZmlyZVNjZW5lQ2hhbmdlZClcbiAgICAgICAgICAgICAgICB0aGlzLl9zY2VuZUNoYW5nZWQuZmlyZSh0aGlzLnNjZW5lKCkpO1xuICAgICAgICB9O1xuICAgICAgICBHYW1lLnByb3RvdHlwZS5fc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLl9vcGVyYXRpb25QbHVnaW5NYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICAgICAgICAgIHRoaXMub3BlcmF0aW9uUGx1Z2lucyA9IHRoaXMuX29wZXJhdGlvblBsdWdpbk1hbmFnZXIucGx1Z2lucztcbiAgICAgICAgICAgIC8vIGRlcHJlY2F0ZWQg44Gu5oyZ5YuVOiDjgqjjg7Pjg4jjg6rjg53jgqTjg7Pjg4jjga7mjIflrprjgYzjgarjgYTloLTlkIhcbiAgICAgICAgICAgIGlmICghdGhpcy5fbWFpbikge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fbWFpblBhcmFtZXRlci5zbmFwc2hvdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuYXNzZXRzLm1haW5TY2VuZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkdhbWUjX3N0YXJ0OiBnbG9iYWwgYXNzZXQgJ21haW5TY2VuZScgbm90IGZvdW5kLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1haW5TY2VuZSA9IGcuX3JlcXVpcmUodGhpcywgXCJtYWluU2NlbmVcIikoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXNoU2NlbmUobWFpblNjZW5lKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmx1c2hTY2VuZUNoYW5nZVJlcXVlc3RzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuYXNzZXRzLnNuYXBzaG90TG9hZGVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiR2FtZSNfc3RhcnQ6IGdsb2JhbCBhc3NldCAnc25hcHNob3RMb2FkZXInIG5vdCBmb3VuZC5cIik7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsb2FkZXIgPSBnLl9yZXF1aXJlKHRoaXMsIFwic25hcHNob3RMb2FkZXJcIik7XG4gICAgICAgICAgICAgICAgICAgIGxvYWRlcih0aGlzLl9tYWluUGFyYW1ldGVyLnNuYXBzaG90KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmx1c2hTY2VuZUNoYW5nZVJlcXVlc3RzKCk7IC8vIOOCueODiuODg+ODl+OCt+ODp+ODg+ODiOODreODvOODgOOCguOCt+ODvOODs+mBt+enu+OCkuimgeaxguOBmeOCi+WPr+iDveaAp+OBjOOBguOCiyjjgajjgYTjgYbjgYvjgb7jgZrjgZnjgospXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXJ0ZWQuZmlyZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBtYWluRnVuID0gZy5fcmVxdWlyZSh0aGlzLCB0aGlzLl9tYWluKTtcbiAgICAgICAgICAgIGlmICghbWFpbkZ1biB8fCB0eXBlb2YgbWFpbkZ1biAhPT0gXCJmdW5jdGlvblwiKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkdhbWUjX3N0YXJ0OiBFbnRyeSBwb2ludCAnXCIgKyB0aGlzLl9tYWluICsgXCInIG5vdCBmb3VuZC5cIik7XG4gICAgICAgICAgICBtYWluRnVuKHRoaXMuX21haW5QYXJhbWV0ZXIpO1xuICAgICAgICAgICAgdGhpcy5fZmx1c2hTY2VuZUNoYW5nZVJlcXVlc3RzKCk7IC8vIOOCt+ODvOODs+mBt+enu+OCkuimgeaxguOBmeOCi+WPr+iDveaAp+OBjOOBguOCiyjjgajjgYTjgYbjgYvjgb7jgZrjgZnjgospXG4gICAgICAgICAgICB0aGlzLl9zdGFydGVkLmZpcmUoKTtcbiAgICAgICAgfTtcbiAgICAgICAgR2FtZS5wcm90b3R5cGUuX2RvUHVzaFNjZW5lID0gZnVuY3Rpb24gKHNjZW5lLCBsb2FkaW5nU2NlbmUpIHtcbiAgICAgICAgICAgIGlmICghbG9hZGluZ1NjZW5lKVxuICAgICAgICAgICAgICAgIGxvYWRpbmdTY2VuZSA9IHRoaXMubG9hZGluZ1NjZW5lIHx8IHRoaXMuX2RlZmF1bHRMb2FkaW5nU2NlbmU7XG4gICAgICAgICAgICB0aGlzLnNjZW5lcy5wdXNoKHNjZW5lKTtcbiAgICAgICAgICAgIGlmIChzY2VuZS5fbmVlZHNMb2FkaW5nKCkgJiYgc2NlbmUuX2xvYWRpbmdTdGF0ZSA8IGcuU2NlbmVMb2FkU3RhdGUuTG9hZGVkRmlyZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZGVmYXVsdExvYWRpbmdTY2VuZS5fbmVlZHNMb2FkaW5nKCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIkdhbWUjX2RvUHVzaFNjZW5lOiBfZGVmYXVsdExvYWRpbmdTY2VuZSBtdXN0IG5vdCBkZXBlbmQgb24gYW55IGFzc2V0cy9zdG9yYWdlcy5cIik7XG4gICAgICAgICAgICAgICAgdGhpcy5fZG9QdXNoU2NlbmUobG9hZGluZ1NjZW5lLCB0aGlzLl9kZWZhdWx0TG9hZGluZ1NjZW5lKTtcbiAgICAgICAgICAgICAgICBsb2FkaW5nU2NlbmUucmVzZXQoc2NlbmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8g6Kqt44G/6L6844G/5b6F44Gh44Gu44Ki44K744OD44OI44GM44Gq44GR44KM44Gw44Gd44Gu5aC044GnKGxvYWRpbmdTY2VuZeOBq+S7u+OBm+OBminjg63jg7zjg4njgIFTY2VuZVJlYWR544KS55m655Sf44GV44Gb44Gm44GL44KJTG9hZGluZ1NjZW5lRW5k44KS6LW344GT44GZ44CCXG4gICAgICAgICAgICAgICAgdGhpcy5fc2NlbmVDaGFuZ2VkLmZpcmUoc2NlbmUpO1xuICAgICAgICAgICAgICAgIGlmICghc2NlbmUuX2xvYWRlZCkge1xuICAgICAgICAgICAgICAgICAgICBzY2VuZS5fbG9hZCgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9maXJlU2NlbmVMb2FkZWQoc2NlbmUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubW9kaWZpZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gR2FtZTtcbiAgICB9KCkpO1xuICAgIGcuR2FtZSA9IEdhbWU7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICogMkTkuJbnlYzjgavjgYrjgZHjgovjgqvjg6Hjg6njgIJcbiAgICAgKi9cbiAgICB2YXIgQ2FtZXJhMkQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhDYW1lcmEyRCwgX3N1cGVyKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOaMh+WumuOBleOCjOOBn+ODkeODqeODoeODvOOCv+OBpyBgQ2FtZXJhMkRgIOOBruOCpOODs+OCueOCv+ODs+OCueOCkueUn+aIkOOBmeOCi+OAglxuICAgICAgICAgKiBAcGFyYW0gcGFyYW0g5Yid5pyf5YyW44Gr55So44GE44KL44OR44Op44Oh44O844K/44Gu44Kq44OW44K444Kn44Kv44OIXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBDYW1lcmEyRChwYXJhbSkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcGFyYW0pIHx8IHRoaXM7XG4gICAgICAgICAgICBfdGhpcy5nYW1lID0gcGFyYW0uZ2FtZTtcbiAgICAgICAgICAgIF90aGlzLmxvY2FsID0gISFwYXJhbS5sb2NhbDtcbiAgICAgICAgICAgIF90aGlzLm5hbWUgPSBwYXJhbS5uYW1lO1xuICAgICAgICAgICAgX3RoaXMuX21vZGlmaWVkQ291bnQgPSAwO1xuICAgICAgICAgICAgLy8gcGFyYW0g44GuIHdpZHRoIOOBqCBoZWlnaHQg44Gv54Sh6KaW44GZ44KLXG4gICAgICAgICAgICBfdGhpcy53aWR0aCA9IHBhcmFtLmdhbWUud2lkdGg7XG4gICAgICAgICAgICBfdGhpcy5oZWlnaHQgPSBwYXJhbS5nYW1lLmhlaWdodDtcbiAgICAgICAgICAgIF90aGlzLmlkID0gX3RoaXMubG9jYWwgPyB1bmRlZmluZWQgOiBfdGhpcy5nYW1lLl9jYW1lcmFJZHgrKztcbiAgICAgICAgICAgIHJldHVybiBfdGhpcztcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICog5LiO44GI44KJ44KM44Gf44K344Oq44Ki44Oq44K844O844K344On44Oz44Gn44Kr44Oh44Op44KS5b6p5YWD44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBzZXIgYENhbWVyYTJEI3NlcmlhbGl6ZSgpYCDjga7miLvjgorlgKRcbiAgICAgICAgICogQHBhcmFtIGdhbWUg5b6p5YWD44GV44KM44Gf44Kr44Oh44Op44Gu5bGe44GZ44KLIEdhbWVcbiAgICAgICAgICovXG4gICAgICAgIENhbWVyYTJELmRlc2VyaWFsaXplID0gZnVuY3Rpb24gKHNlciwgZ2FtZSkge1xuICAgICAgICAgICAgdmFyIHMgPSBzZXI7XG4gICAgICAgICAgICBzLnBhcmFtLmdhbWUgPSBnYW1lO1xuICAgICAgICAgICAgdmFyIHJldCA9IG5ldyBDYW1lcmEyRChzLnBhcmFtKTtcbiAgICAgICAgICAgIHJldC5pZCA9IHMuaWQ7XG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44Kr44Oh44Op54q25oWL44Gu5aSJ5pu044KS44Ko44Oz44K444Oz44Gr6YCa55+l44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBruWRvOOBs+WHuuOBl+W+jOOAgeOBk+OBruOCq+ODoeODqeOBruODl+ODreODkeODhuOCo+OBq+WvvuOBmeOCi+WkieabtOOBjOWQhCBgUmVuZGVyZXJgIOOBruaPj+eUu+OBq+WPjeaYoOOBleOCjOOCi+OAglxuICAgICAgICAgKiDjgZ/jgaDjgZfpgIbjga/nnJ/jgafjga/jgarjgYTjgILjgZnjgarjgo/jgaHjgIHlho3mj4/nlLvjga/ku5bjga7opoHlm6DjgavjgojjgaPjgabooYzjgo/jgozjgovjgZPjgajjgoLjgYLjgovjgIJcbiAgICAgICAgICog44Ky44O844Og6ZaL55m66ICF44Gv44CB44GT44Gu44Oh44K944OD44OJ44KS5ZG844Gz5Ye644GX44Gm44GE44Gq44GE44GT44Go44KS44KC44Gj44Gm5YaN5o+P55S744GM6KGM44KP44KM44Gm44GE44Gq44GE44GT44Go44KS5Luu5a6a44GX44Gm44Gv44Gq44KJ44Gq44GE44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOacrOODoeOCveODg+ODieOBr+OAgeOBk+OBruOCquODluOCuOOCp+OCr+ODiOOBriBgT2JqZWN0MkRgIOeUseadpeOBruODl+ODreODkeODhuOCoyAoYHhgLCBgeWAsIGBhbmdsZWAg44Gq44GpKSDjgpLlpInmm7TjgZfjgZ/loLTlkIjjgavjgoLlkbzjgbPjgaDjgZnlv4XopoHjgYzjgYLjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIENhbWVyYTJELnByb3RvdHlwZS5tb2RpZmllZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuX21vZGlmaWVkQ291bnQgPSAodGhpcy5fbW9kaWZpZWRDb3VudCArIDEpICUgMzI3Njg7XG4gICAgICAgICAgICBpZiAodGhpcy5fbWF0cml4KVxuICAgICAgICAgICAgICAgIHRoaXMuX21hdHJpeC5fbW9kaWZpZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5nYW1lLm1vZGlmaWVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBruOCq+ODoeODqeOCkuOCt+ODquOCouODqeOCpOOCuuOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga7miLvjgorlgKTjgpIgYENhbWVyYTJEI2Rlc2VyaWFsaXplKClgIOOBq+a4oeOBmeOBk+OBqOOBp+WQjOOBmOWApOOCkuaMgeOBpOOCq+ODoeODqeOCkuW+qeWFg+OBmeOCi+OBk+OBqOOBjOOBp+OBjeOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgQ2FtZXJhMkQucHJvdG90eXBlLnNlcmlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzZXIgPSB7XG4gICAgICAgICAgICAgICAgaWQ6IHRoaXMuaWQsXG4gICAgICAgICAgICAgICAgcGFyYW06IHtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbDogdGhpcy5sb2NhbCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICB4OiB0aGlzLngsXG4gICAgICAgICAgICAgICAgICAgIHk6IHRoaXMueSxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMud2lkdGgsXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IHRoaXMub3BhY2l0eSxcbiAgICAgICAgICAgICAgICAgICAgc2NhbGVYOiB0aGlzLnNjYWxlWCxcbiAgICAgICAgICAgICAgICAgICAgc2NhbGVZOiB0aGlzLnNjYWxlWSxcbiAgICAgICAgICAgICAgICAgICAgYW5nbGU6IHRoaXMuYW5nbGUsXG4gICAgICAgICAgICAgICAgICAgIGNvbXBvc2l0ZU9wZXJhdGlvbjogdGhpcy5jb21wb3NpdGVPcGVyYXRpb25cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHNlcjtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBDYW1lcmEyRC5wcm90b3R5cGUuX2FwcGx5VHJhbnNmb3JtVG9SZW5kZXJlciA9IGZ1bmN0aW9uIChyZW5kZXJlcikge1xuICAgICAgICAgICAgaWYgKHRoaXMuYW5nbGUgfHwgdGhpcy5zY2FsZVggIT09IDEgfHwgdGhpcy5zY2FsZVkgIT09IDEgfHwgdGhpcy5hbmNob3JYICE9IG51bGwgfHwgdGhpcy5hbmNob3JZICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAvLyBOb3RlOiB0aGlzLnNjYWxlWC9zY2FsZVnjgYww44Gu5aC05ZCI5o+P55S744GX44Gf57WQ5p6c5L2V44KC6KGo56S644GV44KM44Gq44GE5LqL44Gr44Gq44KL44GM44CB54m55q6K5omx44GE44Gv44GX44Gq44GEXG4gICAgICAgICAgICAgICAgcmVuZGVyZXIudHJhbnNmb3JtKHRoaXMuZ2V0TWF0cml4KCkuX21hdHJpeCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZW5kZXJlci50cmFuc2xhdGUoLXRoaXMueCwgLXRoaXMueSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5vcGFjaXR5ICE9PSAxKVxuICAgICAgICAgICAgICAgIHJlbmRlcmVyLm9wYWNpdHkodGhpcy5vcGFjaXR5KTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBDYW1lcmEyRC5wcm90b3R5cGUuX3VwZGF0ZU1hdHJpeCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIOOCq+ODoeODqeOBriBhbmdsZSwgeCwgeSDjga/jgqjjg7Pjg4bjgqPjg4bjgqPjgajpgIbmlrnlkJHjgavkvZznlKjjgZnjgovjgZPjgajjgavms6jmhI/jgIJcbiAgICAgICAgICAgIGlmICh0aGlzLmFuY2hvclggIT0gbnVsbCAmJiB0aGlzLmFuY2hvclkgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX21hdHJpeC51cGRhdGVCeUludmVyc2VXaXRoQW5jaG9yKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLnNjYWxlWCwgdGhpcy5zY2FsZVksIHRoaXMuYW5nbGUsIHRoaXMueCwgdGhpcy55LCB0aGlzLmFuY2hvclgsIHRoaXMuYW5jaG9yWSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmFuZ2xlIHx8IHRoaXMuc2NhbGVYICE9PSAxIHx8IHRoaXMuc2NhbGVZICE9PSAxKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWF0cml4LnVwZGF0ZUJ5SW52ZXJzZSh0aGlzLndpZHRoLCB0aGlzLmhlaWdodCwgdGhpcy5zY2FsZVgsIHRoaXMuc2NhbGVZLCB0aGlzLmFuZ2xlLCB0aGlzLngsIHRoaXMueSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tYXRyaXgucmVzZXQoLXRoaXMueCwgLXRoaXMueSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBDYW1lcmEyRDtcbiAgICB9KGcuT2JqZWN0MkQpKTtcbiAgICBnLkNhbWVyYTJEID0gQ2FtZXJhMkQ7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog44Ky44O844Og44Gu5o+P55S744KS6KGM44GG44Kv44Op44K544CCXG4gICAgICpcbiAgICAgKiDmj4/nlLvjga/lkITjgqjjg7Pjg4bjgqPjg4bjgqPjgavjgojjgaPjgabooYzjgo/jgozjgovjgILpgJrluLjjgIHjgrLjg7zjg6DplovnmbrogIXjgYzmnKzjgq/jg6njgrnjgpLliKnnlKjjgZnjgovlv4XopoHjga/jgarjgYTjgIJcbiAgICAgKi9cbiAgICB2YXIgUmVuZGVyZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIFJlbmRlcmVyKCkge1xuICAgICAgICB9XG4gICAgICAgIFJlbmRlcmVyLnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24gKGdhbWUsIGNhbWVyYSkge1xuICAgICAgICAgICAgdmFyIHNjZW5lID0gZ2FtZS5zY2VuZSgpO1xuICAgICAgICAgICAgaWYgKCFzY2VuZSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB0aGlzLmJlZ2luKCk7XG4gICAgICAgICAgICB0aGlzLnNhdmUoKTtcbiAgICAgICAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICAgICAgICAgIGlmIChjYW1lcmEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNhdmUoKTtcbiAgICAgICAgICAgICAgICBjYW1lcmEuX2FwcGx5VHJhbnNmb3JtVG9SZW5kZXJlcih0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IHNjZW5lLmNoaWxkcmVuO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICBjaGlsZHJlbltpXS5yZW5kZXIodGhpcywgY2FtZXJhKTtcbiAgICAgICAgICAgIGlmIChjYW1lcmEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc3RvcmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVzdG9yZSgpO1xuICAgICAgICAgICAgdGhpcy5lbmQoKTtcbiAgICAgICAgfTtcbiAgICAgICAgUmVuZGVyZXIucHJvdG90eXBlLmJlZ2luID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gbm90aGluZyB0byBkb1xuICAgICAgICB9O1xuICAgICAgICBSZW5kZXJlci5wcm90b3R5cGUuZW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gbm90aGluZyB0byBkb1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gUmVuZGVyZXI7XG4gICAgfSgpKTtcbiAgICBnLlJlbmRlcmVyID0gUmVuZGVyZXI7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog5o+P55S76aCY5Z+f44KS6KGo44GZ44Kv44Op44K544CCXG4gICAgICpcbiAgICAgKiDjgZPjga7jgq/jg6njgrnjga7jgqTjg7Pjgrnjgr/jg7Pjgrnjga/jgIHjgqjjg7Pjgrjjg7PjgavjgojjgaPjgabmmpfpu5njgavnlJ/miJDjgZXjgozjgovjgIJcbiAgICAgKiDjgrLjg7zjg6DplovnmbrogIXjga/jgZPjga7jgq/jg6njgrnjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLmmI7npLrnmoTjgavnlJ/miJDjgZnjgovlv4XopoHjga/jgarjgY/jgIHjgb7jgZ/jgafjgY3jgarjgYTjgIJcbiAgICAgKi9cbiAgICB2YXIgU3VyZmFjZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGBTdXJmYWNlYCDjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLnlJ/miJDjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHdpZHRoIOaPj+eUu+mgmOWfn+OBruW5he+8iOaVtOaVsOWApOOBp+OBquOBkeOCjOOBsOOBquOCieOBquOBhO+8iVxuICAgICAgICAgKiBAcGFyYW0gaGVpZ2h0IOaPj+eUu+mgmOWfn+OBrumrmOOBle+8iOaVtOaVsOWApOOBp+OBquOBkeOCjOOBsOOBquOCieOBquOBhO+8iVxuICAgICAgICAgKiBAcGFyYW0gZHJhd2FibGUg5o+P55S75Y+v6IO944Gq5a6f5L2T44CC55yB55Wl44GV44KM44Gf5aC05ZCI44CBIGB1bmRlZmluZWRgXG4gICAgICAgICAqIEBwYXJhbSBpc0R5bmFtaWMgZHJhd2FibGXjgYzli5XnlLvjgafjgYLjgovjgZPjgajjgpLnpLrjgZnlgKTjgILli5XnlLvjgafjgYLjgovmmYLjgIHnnJ/jgpLmuKHjgZXjgarjgY/jgabjga/jgarjgonjgarjgYTjgILnnIHnlaXjgZXjgozjgZ/loLTlkIjjgIHlgb3jgIJcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIFN1cmZhY2Uod2lkdGgsIGhlaWdodCwgZHJhd2FibGUsIGlzRHluYW1pYykge1xuICAgICAgICAgICAgaWYgKGlzRHluYW1pYyA9PT0gdm9pZCAwKSB7IGlzRHluYW1pYyA9IGZhbHNlOyB9XG4gICAgICAgICAgICBpZiAod2lkdGggJSAxICE9PSAwIHx8IGhlaWdodCAlIDEgIT09IDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJTdXJmYWNlI2NvbnN0cnVjdG9yOiB3aWR0aCBhbmQgaGVpZ2h0IG11c3QgYmUgaW50ZWdlcnNcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7XG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgICAgIGlmIChkcmF3YWJsZSlcbiAgICAgICAgICAgICAgICB0aGlzLl9kcmF3YWJsZSA9IGRyYXdhYmxlO1xuICAgICAgICAgICAgLy8gdGhpcy5fZGVzdHJveWVk44Gv56C05qOE5pmC44Gr5LiA5bqm44Gg44GR5Luj5YWl44GZ44KL54m55q6K44Gq44OV44Kj44O844Or44OJ44Gq44Gf44KB44CB44Kz44Oz44K544OI44Op44Kv44K/44Gn5Yid5pyf5YCk44KS5Luj5YWl44GX44Gq44GEXG4gICAgICAgICAgICB0aGlzLmlzRHluYW1pYyA9IGlzRHluYW1pYztcbiAgICAgICAgICAgIGlmICh0aGlzLmlzRHluYW1pYykge1xuICAgICAgICAgICAgICAgIHRoaXMuYW5pbWF0aW5nU3RhcnRlZCA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGluZ1N0b3BwZWQgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGluZ1N0YXJ0ZWQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5hbmltYXRpbmdTdG9wcGVkID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga5TdXJmYWNl44Gu56C05qOE44KS6KGM44GG44CCXG4gICAgICAgICAqIOS7peW+jOOAgeOBk+OBrlN1cmZhY2XjgpLliKnnlKjjgZnjgovjgZPjgajjga/lh7rmnaXjgarjgY/jgarjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIFN1cmZhY2UucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5hbmltYXRpbmdTdGFydGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbmltYXRpbmdTdGFydGVkLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmFuaW1hdGluZ1N0b3BwZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGluZ1N0b3BwZWQuZGVzdHJveSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fZGVzdHJveWVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBrlN1cmZhY2XjgYznoLTmo4TmuIjjgafjgYLjgovjgYvjganjgYbjgYvjgpLliKTlrprjgZnjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIFN1cmZhY2UucHJvdG90eXBlLmRlc3Ryb3llZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIF9kZXN0cm95ZWTjga91bmRlZmluZWTjgYt0cnVl44Gq44Gf44KB44CB5bi444GrYm9vbGVhbuOBjOi/lOOBmeOCiOOBhuOBqyEh5ryU566X5a2Q44KS55So44GE44KLXG4gICAgICAgICAgICByZXR1cm4gISF0aGlzLl9kZXN0cm95ZWQ7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBTdXJmYWNlO1xuICAgIH0oKSk7XG4gICAgZy5TdXJmYWNlID0gU3VyZmFjZTtcbn0pKGcgfHwgKGcgPSB7fSkpO1xudmFyIGc7XG4oZnVuY3Rpb24gKGcpIHtcbiAgICAvKipcbiAgICAgKiDljZjkuIDooYzjga7jg4bjgq3jgrnjg4jjgpLmj4/nlLvjgZnjgovjgqjjg7Pjg4bjgqPjg4bjgqPjgIJcbiAgICAgKiDmnKzjgq/jg6njgrnjga7liKnnlKjjgavjga8gYEJpdG1hcEZvbnRgIOOBvuOBn+OBryBgRHluYW1pY0ZvbnRgIOOBjOW/heimgeOBqOOBquOCi+OAglxuICAgICAqL1xuICAgIHZhciBMYWJlbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICAgICAgX19leHRlbmRzKExhYmVsLCBfc3VwZXIpO1xuICAgICAgICAvKipcbiAgICAgICAgICog5ZCE56iu44OR44Op44Oh44O844K/44KS5oyH5a6a44GX44GmIGBMYWJlbGAg44Gu44Kk44Oz44K544K/44Oz44K544KS55Sf5oiQ44GZ44KL44CCXG4gICAgICAgICAqIEBwYXJhbSBwYXJhbSDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPjgavmjIflrprjgZnjgovjg5Hjg6njg6Hjg7zjgr9cbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIExhYmVsKHBhcmFtKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwYXJhbSkgfHwgdGhpcztcbiAgICAgICAgICAgIF90aGlzLnRleHQgPSBwYXJhbS50ZXh0O1xuICAgICAgICAgICAgX3RoaXMuZm9udCA9IHBhcmFtLmZvbnQ7XG4gICAgICAgICAgICBfdGhpcy50ZXh0QWxpZ24gPSAoXCJ0ZXh0QWxpZ25cIiBpbiBwYXJhbSkgPyBwYXJhbS50ZXh0QWxpZ24gOiBnLlRleHRBbGlnbi5MZWZ0O1xuICAgICAgICAgICAgX3RoaXMuZ2x5cGhzID0gbmV3IEFycmF5KHBhcmFtLnRleHQubGVuZ3RoKTtcbiAgICAgICAgICAgIF90aGlzLmZvbnRTaXplID0gcGFyYW0uZm9udFNpemU7XG4gICAgICAgICAgICBfdGhpcy5tYXhXaWR0aCA9IHBhcmFtLm1heFdpZHRoO1xuICAgICAgICAgICAgX3RoaXMud2lkdGhBdXRvQWRqdXN0ID0gKFwid2lkdGhBdXRvQWRqdXN0XCIgaW4gcGFyYW0pID8gcGFyYW0ud2lkdGhBdXRvQWRqdXN0IDogdHJ1ZTtcbiAgICAgICAgICAgIF90aGlzLnRleHRDb2xvciA9IHBhcmFtLnRleHRDb2xvcjtcbiAgICAgICAgICAgIF90aGlzLl90ZXh0V2lkdGggPSAwO1xuICAgICAgICAgICAgX3RoaXMuX2dhbWUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBfdGhpcy5fb3ZlcmhhbmdMZWZ0ID0gMDtcbiAgICAgICAgICAgIF90aGlzLl9vdmVyaGFuZ1JpZ2h0ID0gMDtcbiAgICAgICAgICAgIF90aGlzLl9pbnZhbGlkYXRlU2VsZigpO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBgd2lkdGhgIOOBqCBgdGV4dEFsaWduYCDjgpLoqK3lrprjgZfjgIEgYHdpZHRoQXV0b0FkanVzdGAg44KSIGBmYWxzZWAg44Gr6Kit5a6a44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBryBgdGhpcy50ZXh0QWxpZ25gIOOCkuioreWumuOBmeOCi+OBn+OCgeOBruODpuODvOODhuOCo+ODquODhuOCo+OBp+OBguOCi+OAglxuICAgICAgICAgKiBgdGV4dEFsaWduYCDjgpIgYFRleHRBbGlnbi5MZWZ0YCDku6XlpJbjgavoqK3lrprjgZnjgovloLTlkIjjgavjga/jgIHpgJrluLggYHdpZHRoYCDjgoQgYHdpZHRoQXV0b0FkanVzdGAg44KC6Kit5a6a44GZ44KL5b+F6KaB44GM44GC44KL44Gf44KB44CB44Gd44KM44KJ44KS44G+44Go44KB44Gm6KGM44GG44CCXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBruWRvOOBs+WHuuOBl+W+jOOAgSBgdGhpcy5pbnZhbGlkYXRlKClgIOOCkuWRvOOBs+WHuuOBmeW/heimgeOBjOOBguOCi+OAglxuICAgICAgICAgKiBAcGFyYW0gd2lkdGgg5bmFXG4gICAgICAgICAqIEBwYXJhbSB0ZXh0QWxpZ24g44OG44Kt44K544OI44Gu5o+P55S75L2N572uXG4gICAgICAgICAqL1xuICAgICAgICBMYWJlbC5wcm90b3R5cGUuYWxpZ25pbmcgPSBmdW5jdGlvbiAod2lkdGgsIHRleHRBbGlnbikge1xuICAgICAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICAgICAgdGhpcy53aWR0aEF1dG9BZGp1c3QgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMudGV4dEFsaWduID0gdGV4dEFsaWduO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44GT44Gu44Ko44Oz44OG44Kj44OG44Kj44Gu5o+P55S744Kt44Oj44OD44K344Ol54Sh5Yq55YyW44KS44Ko44Oz44K444Oz44Gr6YCa55+l44GZ44KL44CCXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOCkuWRvOOBs+WHuuOBl+W+jOOAgeaPj+eUu+OCreODo+ODg+OCt+ODpeOBruWGjeani+evieOBjOihjOOCj+OCjOOAgeWQhCBgUmVuZGVyZXJgIOOBq+aPj+eUu+WGheWuueOBruWkieabtOOBjOWPjeaYoOOBleOCjOOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgTGFiZWwucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLl9pbnZhbGlkYXRlU2VsZigpO1xuICAgICAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5pbnZhbGlkYXRlLmNhbGwodGhpcyk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMYWJlbOiHqui6q+OBruaPj+eUu+OCkuihjOOBhuOAglxuICAgICAgICAgKi9cbiAgICAgICAgTGFiZWwucHJvdG90eXBlLnJlbmRlclNlbGZGcm9tQ2FjaGUgPSBmdW5jdGlvbiAocmVuZGVyZXIpIHtcbiAgICAgICAgICAgIC8vIGdseXBo44Gu44Gv44G/5Ye644GX6YeP44Gr5b+c44GY44Gm44CB5o+P55S75YWI44GuWOW6p+aomeOCkuiqv+aVtOOBmeOCi+OAglxuICAgICAgICAgICAgdmFyIGRlc3RPZmZzZXRYO1xuICAgICAgICAgICAgc3dpdGNoICh0aGlzLnRleHRBbGlnbikge1xuICAgICAgICAgICAgICAgIGNhc2UgZy5UZXh0QWxpZ24uQ2VudGVyOlxuICAgICAgICAgICAgICAgICAgICBkZXN0T2Zmc2V0WCA9IHRoaXMud2lkdGhBdXRvQWRqdXN0ID8gdGhpcy5fb3ZlcmhhbmdMZWZ0IDogMDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBnLlRleHRBbGlnbi5SaWdodDpcbiAgICAgICAgICAgICAgICAgICAgZGVzdE9mZnNldFggPSB0aGlzLndpZHRoQXV0b0FkanVzdCA/IHRoaXMuX292ZXJoYW5nTGVmdCA6IHRoaXMuX292ZXJoYW5nUmlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGRlc3RPZmZzZXRYID0gdGhpcy5fb3ZlcmhhbmdMZWZ0O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlbmRlcmVyLmRyYXdJbWFnZSh0aGlzLl9jYWNoZSwgMCwgMCwgdGhpcy5fY2FjaGVTaXplLndpZHRoICsgZy5DYWNoZWFibGVFLlBBRERJTkcsIHRoaXMuX2NhY2hlU2l6ZS5oZWlnaHQgKyBnLkNhY2hlYWJsZUUuUEFERElORywgZGVzdE9mZnNldFgsIDApO1xuICAgICAgICB9O1xuICAgICAgICBMYWJlbC5wcm90b3R5cGUucmVuZGVyQ2FjaGUgPSBmdW5jdGlvbiAocmVuZGVyZXIpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5mb250U2l6ZSB8fCB0aGlzLmhlaWdodCA8PSAwIHx8IHRoaXMuX3RleHRXaWR0aCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHNjYWxlID0gKHRoaXMubWF4V2lkdGggPiAwICYmIHRoaXMubWF4V2lkdGggPCB0aGlzLl90ZXh0V2lkdGgpID8gdGhpcy5tYXhXaWR0aCAvIHRoaXMuX3RleHRXaWR0aCA6IDE7XG4gICAgICAgICAgICB2YXIgb2Zmc2V0WCA9IDA7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMudGV4dEFsaWduKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBnLlRleHRBbGlnbi5DZW50ZXI6XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldFggPSB0aGlzLndpZHRoIC8gMiAtICh0aGlzLl90ZXh0V2lkdGggKyB0aGlzLl9vdmVyaGFuZ0xlZnQpIC8gMiAqIHNjYWxlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIGcuVGV4dEFsaWduLlJpZ2h0OlxuICAgICAgICAgICAgICAgICAgICBvZmZzZXRYID0gdGhpcy53aWR0aCAtICh0aGlzLl90ZXh0V2lkdGggKyB0aGlzLl9vdmVyaGFuZ0xlZnQpICogc2NhbGU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldFggLT0gdGhpcy5fb3ZlcmhhbmdMZWZ0ICogc2NhbGU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVuZGVyZXIudHJhbnNsYXRlKG9mZnNldFgsIDApO1xuICAgICAgICAgICAgaWYgKHNjYWxlICE9PSAxKSB7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIudHJhbnNmb3JtKFtzY2FsZSwgMCwgMCwgMSwgMCwgMF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVuZGVyZXIuc2F2ZSgpO1xuICAgICAgICAgICAgdmFyIGdseXBoU2NhbGUgPSB0aGlzLmZvbnRTaXplIC8gdGhpcy5mb250LnNpemU7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZ2x5cGhzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGdseXBoID0gdGhpcy5nbHlwaHNbaV07XG4gICAgICAgICAgICAgICAgdmFyIGdseXBoV2lkdGggPSBnbHlwaC5hZHZhbmNlV2lkdGggKiBnbHlwaFNjYWxlO1xuICAgICAgICAgICAgICAgIHZhciBjb2RlID0gZ2x5cGguY29kZTtcbiAgICAgICAgICAgICAgICBpZiAoIWdseXBoLmlzU3VyZmFjZVZhbGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIGdseXBoID0gdGhpcy5mb250LmdseXBoRm9yQ2hhcmFjdGVyKGNvZGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWdseXBoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vdXRwdXRPZldhcm5Mb2dXaXRoTm9HbHlwaChjb2RlLCBcInJlbmRlckNhY2hlKClcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZ2x5cGguc3VyZmFjZSkgeyAvLyDpnZ7nqbrnmb3mloflrZdcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci50cmFuc2Zvcm0oW2dseXBoU2NhbGUsIDAsIDAsIGdseXBoU2NhbGUsIDAsIDBdKTtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuZHJhd0ltYWdlKGdseXBoLnN1cmZhY2UsIGdseXBoLngsIGdseXBoLnksIGdseXBoLndpZHRoLCBnbHlwaC5oZWlnaHQsIGdseXBoLm9mZnNldFgsIGdseXBoLm9mZnNldFkpO1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5yZXN0b3JlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRyYW5zbGF0ZShnbHlwaFdpZHRoLCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlbmRlcmVyLnJlc3RvcmUoKTtcbiAgICAgICAgICAgIHJlbmRlcmVyLnNhdmUoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnRleHRDb2xvcikge1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnNldENvbXBvc2l0ZU9wZXJhdGlvbihnLkNvbXBvc2l0ZU9wZXJhdGlvbi5Tb3VyY2VBdG9wKTtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5maWxsUmVjdCgwLCAwLCB0aGlzLl90ZXh0V2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLnRleHRDb2xvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZW5kZXJlci5yZXN0b3JlKCk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPjgpLnoLTmo4TjgZnjgovjgIJcbiAgICAgICAgICog5Yip55So44GX44Gm44GE44KLIGBCaXRtYXBGb250YCDjga7noLTmo4Tjga/ooYzjgo/jgarjgYTjgZ/jgoHjgIEgYEJpdG1hcEZvbnRgIOOBruegtOajhOOBr+OCs+ODs+ODhuODs+ODhOijveS9nOiAheOBjOaYjuekuueahOOBq+ihjOOBhuW/heimgeOBjOOBguOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgTGFiZWwucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfc3VwZXIucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKTtcbiAgICAgICAgfTtcbiAgICAgICAgTGFiZWwucHJvdG90eXBlLl9pbnZhbGlkYXRlU2VsZiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuZ2x5cGhzLmxlbmd0aCA9IDA7XG4gICAgICAgICAgICB0aGlzLl90ZXh0V2lkdGggPSAwO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmZvbnRTaXplKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSAwO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBlZmZlY3RpdmVUZXh0TGFzdEluZGV4ID0gdGhpcy50ZXh0Lmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAvLyDlj7Pjga7jga/jgb/jgaDjgZfph4/jgpLmsYLjgoHjgovjgZ/jgoHjgIF0ZXh05YaF44Gn44Gu5pyJ5Yq544Gq5pyA5b6M44GuIGdseXBoIOOBrmluZGV444KS6Kej5rG644GZ44KL44CCXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy50ZXh0Lmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvZGUgPSBnLlV0aWwuY2hhckNvZGVBdCh0aGlzLnRleHQsIGkpO1xuICAgICAgICAgICAgICAgIGlmICghY29kZSkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGdseXBoID0gdGhpcy5mb250LmdseXBoRm9yQ2hhcmFjdGVyKGNvZGUpO1xuICAgICAgICAgICAgICAgIGlmIChnbHlwaCAmJiBnbHlwaC53aWR0aCAhPT0gMCAmJiBnbHlwaC5hZHZhbmNlV2lkdGggIT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZWZmZWN0aXZlVGV4dExhc3RJbmRleCA9IGk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBtYXhIZWlnaHQgPSAwO1xuICAgICAgICAgICAgdmFyIGdseXBoU2NhbGUgPSB0aGlzLmZvbnQuc2l6ZSA+IDAgPyB0aGlzLmZvbnRTaXplIC8gdGhpcy5mb250LnNpemUgOiAwO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gZWZmZWN0aXZlVGV4dExhc3RJbmRleDsgKytpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvZGVfMSA9IGcuVXRpbC5jaGFyQ29kZUF0KHRoaXMudGV4dCwgaSk7XG4gICAgICAgICAgICAgICAgaWYgKCFjb2RlXzEpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBnbHlwaCA9IHRoaXMuZm9udC5nbHlwaEZvckNoYXJhY3Rlcihjb2RlXzEpO1xuICAgICAgICAgICAgICAgIGlmICghZ2x5cGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb3V0cHV0T2ZXYXJuTG9nV2l0aE5vR2x5cGgoY29kZV8xLCBcIl9pbnZhbGlkYXRlU2VsZigpXCIpO1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGdseXBoLndpZHRoIDwgMCB8fCBnbHlwaC5oZWlnaHQgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZ2x5cGgueCA8IDAgfHwgZ2x5cGgueSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZ2x5cGhzLnB1c2goZ2x5cGgpO1xuICAgICAgICAgICAgICAgIC8vIEZvbnQg44GrIFN0cm9rZVdpZHRoIOOBjOioreWumuOBleOCjOOBpuOBhOOCi+WgtOWQiOOAgeaWh+Wtl+OBruaPj+eUu+WGheWuueOBr+OAgeaPj+eUu+OBruWfuua6lueCueOCiOOCiuOCguW3puOBq+OBr+OBv+WHuuOCi+WgtOWQiOOChOOAgWdseXBoLmFkdmFuY2VXaWR0aCDjgojjgorlj7Pjgavjga/jgb/lh7rjgovloLTlkIjjgYzjgYLjgovjgIJcbiAgICAgICAgICAgICAgICAvLyDjgq3jg6Pjg4Pjgrfjg6XjgrXjg7zjg5Xjgqfjgrnjga7luYXjga/jgIHmnIDliJ3jga7mloflrZfjgajmnIDlvozjga7mloflrZfjga7jga/jgb/lh7rjgZfpg6jliIbjgpLogIPmha7jgZfjgabmsYLjgoHjgovlv4XopoHjgYzjgYLjgovjgIJcbiAgICAgICAgICAgICAgICB2YXIgb3ZlcmhhbmcgPSAwO1xuICAgICAgICAgICAgICAgIGlmIChpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX292ZXJoYW5nTGVmdCA9IE1hdGgubWluKGdseXBoLm9mZnNldFgsIDApO1xuICAgICAgICAgICAgICAgICAgICBvdmVyaGFuZyA9IC10aGlzLl9vdmVyaGFuZ0xlZnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpID09PSBlZmZlY3RpdmVUZXh0TGFzdEluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX292ZXJoYW5nUmlnaHQgPSBNYXRoLm1heCgoZ2x5cGgud2lkdGggKyBnbHlwaC5vZmZzZXRYKSAtIGdseXBoLmFkdmFuY2VXaWR0aCwgMCk7XG4gICAgICAgICAgICAgICAgICAgIG92ZXJoYW5nICs9IHRoaXMuX292ZXJoYW5nUmlnaHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX3RleHRXaWR0aCArPSAoZ2x5cGguYWR2YW5jZVdpZHRoICsgb3ZlcmhhbmcpICogZ2x5cGhTY2FsZTtcbiAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gZ2x5cGgub2Zmc2V0WSArIGdseXBoLmhlaWdodDtcbiAgICAgICAgICAgICAgICBpZiAobWF4SGVpZ2h0IDwgaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgIG1heEhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy53aWR0aEF1dG9BZGp1c3QpIHtcbiAgICAgICAgICAgICAgICB0aGlzLndpZHRoID0gdGhpcy5fdGV4dFdpZHRoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSBtYXhIZWlnaHQgKiBnbHlwaFNjYWxlO1xuICAgICAgICB9O1xuICAgICAgICBMYWJlbC5wcm90b3R5cGUuX291dHB1dE9mV2FybkxvZ1dpdGhOb0dseXBoID0gZnVuY3Rpb24gKGNvZGUsIGZ1bmN0aW9uTmFtZSkge1xuICAgICAgICAgICAgdmFyIHN0ciA9IChjb2RlICYgMHhGRkZGMDAwMCkgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKChjb2RlICYgMHhGRkZGMDAwMCkgPj4+IDE2LCBjb2RlICYgMHhGRkZGKSA6IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSk7XG4gICAgICAgICAgICB0aGlzLmdhbWUoKS5sb2dnZXIud2FybihcIkxhYmVsI1wiICsgZnVuY3Rpb25OYW1lICsgXCI6IGZhaWxlZCB0byBnZXQgYSBnbHlwaCBmb3IgJ1wiICsgc3RyICsgXCInIFwiICtcbiAgICAgICAgICAgICAgICBcIihCaXRtYXBGb250IG1pZ2h0IG5vdCBoYXZlIHRoZSBnbHlwaCBvciBEeW5hbWljRm9udCBtaWdodCBjcmVhdGUgYSBnbHlwaCBsYXJnZXIgdGhhbiBpdHMgYXRsYXMpLlwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIExhYmVsO1xuICAgIH0oZy5DYWNoZWFibGVFKSk7XG4gICAgZy5MYWJlbCA9IExhYmVsO1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIC8qKlxuICAgICAqIOOCsOODquODleOAglxuICAgICAqL1xuICAgIHZhciBHbHlwaCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGBHbHlwaGAg44Gu44Kk44Oz44K544K/44Oz44K544KS55Sf5oiQ44GZ44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBHbHlwaChjb2RlLCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBvZmZzZXRYLCBvZmZzZXRZLCBhZHZhbmNlV2lkdGgsIHN1cmZhY2UsIGlzU3VyZmFjZVZhbGlkKSB7XG4gICAgICAgICAgICBpZiAob2Zmc2V0WCA9PT0gdm9pZCAwKSB7IG9mZnNldFggPSAwOyB9XG4gICAgICAgICAgICBpZiAob2Zmc2V0WSA9PT0gdm9pZCAwKSB7IG9mZnNldFkgPSAwOyB9XG4gICAgICAgICAgICBpZiAoYWR2YW5jZVdpZHRoID09PSB2b2lkIDApIHsgYWR2YW5jZVdpZHRoID0gd2lkdGg7IH1cbiAgICAgICAgICAgIGlmIChpc1N1cmZhY2VWYWxpZCA9PT0gdm9pZCAwKSB7IGlzU3VyZmFjZVZhbGlkID0gISFzdXJmYWNlOyB9XG4gICAgICAgICAgICB0aGlzLmNvZGUgPSBjb2RlO1xuICAgICAgICAgICAgdGhpcy54ID0geDtcbiAgICAgICAgICAgIHRoaXMueSA9IHk7XG4gICAgICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7XG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgICAgIHRoaXMub2Zmc2V0WCA9IG9mZnNldFg7XG4gICAgICAgICAgICB0aGlzLm9mZnNldFkgPSBvZmZzZXRZO1xuICAgICAgICAgICAgdGhpcy5hZHZhbmNlV2lkdGggPSBhZHZhbmNlV2lkdGg7XG4gICAgICAgICAgICB0aGlzLnN1cmZhY2UgPSBzdXJmYWNlO1xuICAgICAgICAgICAgdGhpcy5pc1N1cmZhY2VWYWxpZCA9IGlzU3VyZmFjZVZhbGlkO1xuICAgICAgICAgICAgdGhpcy5fYXRsYXMgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgrDjg6rjg5Xjga7mj4/nlLvkuIrjga7luYXjgpLmsYLjgoHjgovjgIJcbiAgICAgICAgICog6YCa5bi444CB44Ky44O844Og6ZaL55m66ICF44GM44GT44Gu44Oh44K944OD44OJ44KS5ZG844Gz5Ye644GZ5b+F6KaB44Gv44Gq44GE44CCXG4gICAgICAgICAqIEBwYXJhbSBmb250U2l6ZSDjg5Xjgqnjg7Pjg4jjgrXjgqTjgrpcbiAgICAgICAgICovXG4gICAgICAgIEdseXBoLnByb3RvdHlwZS5yZW5kZXJpbmdXaWR0aCA9IGZ1bmN0aW9uIChmb250U2l6ZSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLndpZHRoIHx8ICF0aGlzLmhlaWdodCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZvbnRTaXplIC8gdGhpcy5oZWlnaHQgKiB0aGlzLndpZHRoO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gR2x5cGg7XG4gICAgfSgpKTtcbiAgICBnLkdseXBoID0gR2x5cGg7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog5aGX44KK44Gk44G244GV44KM44Gf55+p5b2i44KS6KGo44GZ44Ko44Oz44OG44Kj44OG44Kj44CCXG4gICAgICovXG4gICAgdmFyIEZpbGxlZFJlY3QgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhGaWxsZWRSZWN0LCBfc3VwZXIpO1xuICAgICAgICAvKipcbiAgICAgICAgICog5ZCE56iu44OR44Op44Oh44O844K/44KS5oyH5a6a44GX44GmIGBGaWxsZWRSZWN0YCDjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLnlJ/miJDjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHBhcmFtIOOBk+OBruOCqOODs+ODhuOCo+ODhuOCo+OBq+WvvuOBmeOCi+ODkeODqeODoeODvOOCv1xuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gRmlsbGVkUmVjdChwYXJhbSkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcGFyYW0pIHx8IHRoaXM7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBhcmFtLmNzc0NvbG9yICE9PSBcInN0cmluZ1wiKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVUeXBlTWlzbWF0Y2hFcnJvcihcIkNvbG9yQm94I2NvbnN0cnVjdG9yKGNzc0NvbG9yKVwiLCBcInN0cmluZ1wiLCBwYXJhbS5jc3NDb2xvcik7XG4gICAgICAgICAgICBfdGhpcy5jc3NDb2xvciA9IHBhcmFtLmNzc0NvbG9yO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPoh6rouqvjga7mj4/nlLvjgpLooYzjgYbjgIJcbiAgICAgICAgICog44GT44Gu44Oh44K944OD44OJ44Gv44Ko44Oz44K444Oz44GL44KJ5pqX6buZ44Gr5ZG844Gz5Ye644GV44KM44CB44Ky44O844Og6ZaL55m66ICF44GM5ZG844Gz5Ye644GZ5b+F6KaB44Gv44Gq44GE44CCXG4gICAgICAgICAqL1xuICAgICAgICBGaWxsZWRSZWN0LnByb3RvdHlwZS5yZW5kZXJTZWxmID0gZnVuY3Rpb24gKHJlbmRlcmVyKSB7XG4gICAgICAgICAgICByZW5kZXJlci5maWxsUmVjdCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCwgdGhpcy5jc3NDb2xvcik7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIEZpbGxlZFJlY3Q7XG4gICAgfShnLkUpKTtcbiAgICBnLkZpbGxlZFJlY3QgPSBGaWxsZWRSZWN0O1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIC8qKlxuICAgICAqIOaeoOOCkuihqOOBmeOCqOODs+ODhuOCo+ODhuOCo+OAglxuICAgICAqIOOCr+ODquODg+ODlOODs+OCsOOChOODkeODh+OCo+ODs+OCsOOAgeODkOODg+OCr+OCsOODqeOCpuODs+ODieOCpOODoeODvOOCuOOBrua8lOWHuuetieOBruapn+iDveOCkuaMgeOBpOOBn+OCgeOAgVxuICAgICAqIOODoeODi+ODpeODvOOChOODoeODg+OCu+ODvOOCuOOAgeOCueODhuODvOOCv+OCueOBruOCpuOCo+ODs+ODieOCpuetieOBq+WIqeeUqOOBleOCjOOCi+OBk+OBqOOBjOacn+W+heOBleOCjOOCi+OAglxuICAgICAqIOOBk+OBruOCqOODs+ODhuOCo+ODhuOCo+OBruWtkOimgee0oOOBr+OAgeOBk+OBruOCqOODs+ODhuOCo+ODhuOCo+OBruaMgeOBpCBgU3VyZmFjZWAg44Gr5o+P55S744GV44KM44KL44CCXG4gICAgICovXG4gICAgdmFyIFBhbmUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhQYW5lLCBfc3VwZXIpO1xuICAgICAgICAvKipcbiAgICAgICAgICog5ZCE56iu44OR44Op44Oh44O844K/44KS5oyH5a6a44GX44GmIGBQYW5lYCDjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLnlJ/miJDjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHBhcmFtIOOBk+OBruOCqOODs+ODhuOCo+ODhuOCo+OBq+aMh+WumuOBmeOCi+ODkeODqeODoeODvOOCv1xuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gUGFuZShwYXJhbSkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcGFyYW0pIHx8IHRoaXM7XG4gICAgICAgICAgICBfdGhpcy5fb2xkV2lkdGggPSBwYXJhbS53aWR0aDtcbiAgICAgICAgICAgIF90aGlzLl9vbGRIZWlnaHQgPSBwYXJhbS5oZWlnaHQ7XG4gICAgICAgICAgICBfdGhpcy5iYWNrZ3JvdW5kSW1hZ2UgPSBnLlV0aWwuYXNTdXJmYWNlKHBhcmFtLmJhY2tncm91bmRJbWFnZSk7XG4gICAgICAgICAgICBfdGhpcy5iYWNrZ3JvdW5kRWZmZWN0b3IgPSBwYXJhbS5iYWNrZ3JvdW5kRWZmZWN0b3I7XG4gICAgICAgICAgICBfdGhpcy5fc2hvdWxkUmVuZGVyQ2hpbGRyZW4gPSBmYWxzZTtcbiAgICAgICAgICAgIF90aGlzLl9wYWRkaW5nID0gcGFyYW0ucGFkZGluZztcbiAgICAgICAgICAgIF90aGlzLl9pbml0aWFsaXplKCk7XG4gICAgICAgICAgICBfdGhpcy5fcGFkZGluZ0NoYW5nZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIF90aGlzLl9iZ1N1cmZhY2UgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBfdGhpcy5fYmdSZW5kZXJlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcztcbiAgICAgICAgfVxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUGFuZS5wcm90b3R5cGUsIFwicGFkZGluZ1wiLCB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFkZGluZztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIOODkeODh+OCo+ODs+OCsOOAglxuICAgICAgICAgICAgICog44GT44Gu44Ko44Oz44OG44Kj44OG44Kj44Gu5a2Q5a2r44Gv44CB44OR44OH44Kj44Oz44Kw44Gr5oyH5a6a44GV44KM44Gf5YiG44Gg44GR5Y+z44O75LiL44Gr44Ga44KM44Gf5aC05omA44Gr5o+P55S744GV44KM44CB44G+44Gf44OR44OH44Kj44Oz44Kw44Gu55+p5b2i44K144Kk44K644Gn44Kv44Oq44OD44OU44Oz44Kw44GV44KM44KL44CCXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIC8vIE5PVEU6IHBhZGRpbmfjga7lpInmm7Tjga/poLvnuYHjgavooYzjgo/jgozjgovjgoLjga7jgafjga/nhKHjgYTjgajmgJ3jgo/jgozjgovjga7jgafjgIHjg5Xjg6njgrDjgpLnq4vjgabjgovjgZ/jgoHjgavjgqLjgq/jgrvjgrXjgpLkvb/jgYZcbiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKHBhZGRpbmcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYWRkaW5nID0gcGFkZGluZztcbiAgICAgICAgICAgICAgICB0aGlzLl9wYWRkaW5nQ2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBruOCqOODs+ODhuOCo+ODhuOCo+OBq+WvvuOBmeOCi+WkieabtOOCkuOCqOODs+OCuOODs+OBq+mAmuefpeOBmeOCi+OAglxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga7lkbzjgbPlh7rjgZflvozjgIEgYHRoaXNgIOOBq+WvvuOBmeOCi+WkieabtOOBjOWQhCBgUmVuZGVyZXJgIOOBruaPj+eUu+OBq+WPjeaYoOOBleOCjOOCi+OAglxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga/mj4/nlLvjgq3jg6Pjg4Pjgrfjg6Xjga7nhKHlirnljJbjgpLkv53oqLzjgZfjgarjgYTjgILmj4/nlLvjgq3jg6Pjg4Pjgrfjg6Xjga7nhKHlirnljJbjgoLlv4XopoHjgarloLTlkIjjgIEgYGludmFsaWRhdGUoKWDjgpLlkbzjgbPlh7rjgZXjgarjgZHjgozjgbDjgarjgonjgarjgYTjgIJcbiAgICAgICAgICog6Kmz57Sw44GvIGBFI21vZGlmaWVkKClgIOOBruODieOCreODpeODoeODs+ODiOOCkuWPgueFp+OAglxuICAgICAgICAgKi9cbiAgICAgICAgUGFuZS5wcm90b3R5cGUubW9kaWZpZWQgPSBmdW5jdGlvbiAoaXNCdWJibGluZykge1xuICAgICAgICAgICAgaWYgKGlzQnViYmxpbmcpXG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSAmPSB+MiAvKiBDYWNoZWQgKi87XG4gICAgICAgICAgICBfc3VwZXIucHJvdG90eXBlLm1vZGlmaWVkLmNhbGwodGhpcyk7XG4gICAgICAgIH07XG4gICAgICAgIFBhbmUucHJvdG90eXBlLnNob3VsZEZpbmRDaGlsZHJlbkJ5UG9pbnQgPSBmdW5jdGlvbiAocG9pbnQpIHtcbiAgICAgICAgICAgIHZhciBwID0gdGhpcy5fbm9ybWFsaXplZFBhZGRpbmc7XG4gICAgICAgICAgICBpZiAocC5sZWZ0IDwgcG9pbnQueCAmJiB0aGlzLndpZHRoIC0gcC5yaWdodCA+IHBvaW50LnggJiYgcC50b3AgPCBwb2ludC55ICYmIHRoaXMuaGVpZ2h0IC0gcC5ib3R0b20gPiBwb2ludC55KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH07XG4gICAgICAgIFBhbmUucHJvdG90eXBlLnJlbmRlckNhY2hlID0gZnVuY3Rpb24gKHJlbmRlcmVyLCBjYW1lcmEpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLndpZHRoIDw9IDAgfHwgdGhpcy5oZWlnaHQgPD0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3JlbmRlckJhY2tncm91bmQoKTtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlckNoaWxkcmVuKGNhbWVyYSk7XG4gICAgICAgICAgICBpZiAodGhpcy5fYmdTdXJmYWNlKSB7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuZHJhd0ltYWdlKHRoaXMuX2JnU3VyZmFjZSwgMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsIDAsIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5iYWNrZ3JvdW5kSW1hZ2UpIHtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5kcmF3SW1hZ2UodGhpcy5iYWNrZ3JvdW5kSW1hZ2UsIDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCAwLCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLl9jaGlsZHJlbkFyZWEud2lkdGggPD0gMCB8fCB0aGlzLl9jaGlsZHJlbkFyZWEuaGVpZ2h0IDw9IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZW5kZXJlci5zYXZlKCk7XG4gICAgICAgICAgICBpZiAodGhpcy5fY2hpbGRyZW5BcmVhLnggIT09IDAgfHwgdGhpcy5fY2hpbGRyZW5BcmVhLnkgIT09IDApIHtcbiAgICAgICAgICAgICAgICByZW5kZXJlci50cmFuc2xhdGUodGhpcy5fY2hpbGRyZW5BcmVhLngsIHRoaXMuX2NoaWxkcmVuQXJlYS55KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlbmRlcmVyLmRyYXdJbWFnZSh0aGlzLl9jaGlsZHJlblN1cmZhY2UsIDAsIDAsIHRoaXMuX2NoaWxkcmVuQXJlYS53aWR0aCwgdGhpcy5fY2hpbGRyZW5BcmVhLmhlaWdodCwgMCwgMCk7XG4gICAgICAgICAgICByZW5kZXJlci5yZXN0b3JlKCk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga7jgqjjg7Pjg4bjgqPjg4bjgqPjgpLnoLTmo4TjgZnjgovjgILjgb7jgZ/jgIHjg5Djg4Pjgq/jg5Djg4Pjg5XjgqHjgafliKnnlKjjgZfjgabjgYTjgosgYFN1cmZhY2VgIOOCguWQiOOCj+OBm+OBpuegtOajhOOBleOCjOOCi+OAglxuICAgICAgICAgKiDjgZ/jgaDjgZfjgIEgYGJhY2tncm91bmRJbWFnZWAg44Gr5Yip55So44GX44Gm44GE44KLIGBTdXJmYWNlYCDjga7noLTmo4Tjga/ooYzjgo/jgarjgYTjgIJcbiAgICAgICAgICogQHBhcmFtIGRlc3Ryb3lTdXJmYWNlIHRydWXjgpLmjIflrprjgZfjgZ/loLTlkIjjgIEgYGJhY2tncm91bmRJbWFnZWAg44Gr5Yip55So44GX44Gm44GE44KLIGBTdXJmYWNlYCDjgoLlkIjjgo/jgZvjgabnoLTmo4TjgZnjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIFBhbmUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoZGVzdHJveVN1cmZhY2UpIHtcbiAgICAgICAgICAgIGlmIChkZXN0cm95U3VyZmFjZSAmJiB0aGlzLmJhY2tncm91bmRJbWFnZSAmJiAhdGhpcy5iYWNrZ3JvdW5kSW1hZ2UuZGVzdHJveWVkKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJhY2tncm91bmRJbWFnZS5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5fYmdTdXJmYWNlICYmICF0aGlzLl9iZ1N1cmZhY2UuZGVzdHJveWVkKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9iZ1N1cmZhY2UuZGVzdHJveSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuX2NoaWxkcmVuU3VyZmFjZSAmJiAhdGhpcy5fY2hpbGRyZW5TdXJmYWNlLmRlc3Ryb3llZCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY2hpbGRyZW5TdXJmYWNlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fYmdTdXJmYWNlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fY2hpbGRyZW5TdXJmYWNlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcyk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgUGFuZS5wcm90b3R5cGUuX3JlbmRlckJhY2tncm91bmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5iYWNrZ3JvdW5kSW1hZ2UgJiYgdGhpcy5iYWNrZ3JvdW5kRWZmZWN0b3IpIHtcbiAgICAgICAgICAgICAgICB2YXIgYmdTdXJmYWNlID0gdGhpcy5iYWNrZ3JvdW5kRWZmZWN0b3IucmVuZGVyKHRoaXMuYmFja2dyb3VuZEltYWdlLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2JnU3VyZmFjZSAhPT0gYmdTdXJmYWNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9iZ1N1cmZhY2UgJiYgIXRoaXMuX2JnU3VyZmFjZS5kZXN0cm95ZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYmdTdXJmYWNlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9iZ1N1cmZhY2UgPSBiZ1N1cmZhY2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYmdTdXJmYWNlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIFBhbmUucHJvdG90eXBlLl9yZW5kZXJDaGlsZHJlbiA9IGZ1bmN0aW9uIChjYW1lcmEpIHtcbiAgICAgICAgICAgIHZhciBpc05ldyA9IHRoaXMuX29sZFdpZHRoICE9PSB0aGlzLndpZHRoIHx8IHRoaXMuX29sZEhlaWdodCAhPT0gdGhpcy5oZWlnaHQgfHwgdGhpcy5fcGFkZGluZ0NoYW5nZWQ7XG4gICAgICAgICAgICBpZiAoaXNOZXcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pbml0aWFsaXplKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFkZGluZ0NoYW5nZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLl9vbGRXaWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICAgICAgICAgICAgdGhpcy5fb2xkSGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9jaGlsZHJlblJlbmRlcmVyLmJlZ2luKCk7XG4gICAgICAgICAgICBpZiAoIWlzTmV3KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY2hpbGRyZW5SZW5kZXJlci5jbGVhcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuY2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICAvLyBOb3RlOiBjb25jYXTjgZfjgabjgYTjgarjgYTjga7jgad1bnNhZmXjgaDjgYzjgIFyZW5kZXLkuK3jgavphY3liJfjga7kuK3ouqvjgYzlpInjgo/jgovkuovjga/jgarjgYTliY3mj5DjgajjgZnjgotcbiAgICAgICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW5baV0ucmVuZGVyKHRoaXMuX2NoaWxkcmVuUmVuZGVyZXIsIGNhbWVyYSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fY2hpbGRyZW5SZW5kZXJlci5lbmQoKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBQYW5lLnByb3RvdHlwZS5faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBwID0gdGhpcy5fcGFkZGluZyA9PT0gdW5kZWZpbmVkID8gMCA6IHRoaXMuX3BhZGRpbmc7XG4gICAgICAgICAgICB2YXIgcjtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcCA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICAgICAgICAgIHIgPSB7IHRvcDogcCwgYm90dG9tOiBwLCBsZWZ0OiBwLCByaWdodDogcCB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgciA9IHRoaXMuX3BhZGRpbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9jaGlsZHJlbkFyZWEgPSB7XG4gICAgICAgICAgICAgICAgeDogci5sZWZ0LFxuICAgICAgICAgICAgICAgIHk6IHIudG9wLFxuICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLndpZHRoIC0gci5sZWZ0IC0gci5yaWdodCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0IC0gci50b3AgLSByLmJvdHRvbVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciByZXNvdXJjZUZhY3RvcnkgPSB0aGlzLnNjZW5lLmdhbWUucmVzb3VyY2VGYWN0b3J5O1xuICAgICAgICAgICAgaWYgKHRoaXMuX2NoaWxkcmVuU3VyZmFjZSAmJiAhdGhpcy5fY2hpbGRyZW5TdXJmYWNlLmRlc3Ryb3llZCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY2hpbGRyZW5TdXJmYWNlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2NoaWxkcmVuU3VyZmFjZSA9XG4gICAgICAgICAgICAgICAgcmVzb3VyY2VGYWN0b3J5LmNyZWF0ZVN1cmZhY2UoTWF0aC5jZWlsKHRoaXMuX2NoaWxkcmVuQXJlYS53aWR0aCksIE1hdGguY2VpbCh0aGlzLl9jaGlsZHJlbkFyZWEuaGVpZ2h0KSk7XG4gICAgICAgICAgICB0aGlzLl9jaGlsZHJlblJlbmRlcmVyID0gdGhpcy5fY2hpbGRyZW5TdXJmYWNlLnJlbmRlcmVyKCk7XG4gICAgICAgICAgICB0aGlzLl9ub3JtYWxpemVkUGFkZGluZyA9IHI7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgZPjga5QYW5l44Gu5YyF5ZCr55+p5b2i44KS6KiI566X44GZ44KL44CCXG4gICAgICAgICAqIEXjgpLntpnmib/jgZnjgovku5bjga7jgq/jg6njgrnjgajnlbDjgarjgorjgIFQYW5l44Gv5a2Q6KaB57Sg44Gu5L2N572u44KS5YyF5ous55+p5b2i44Gr5ZCr44G+44Gq44GE44CCXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBQYW5lLnByb3RvdHlwZS5fY2FsY3VsYXRlQm91bmRpbmdSZWN0ID0gZnVuY3Rpb24gKG0sIGMpIHtcbiAgICAgICAgICAgIHZhciBtYXRyaXggPSB0aGlzLmdldE1hdHJpeCgpO1xuICAgICAgICAgICAgaWYgKG0pIHtcbiAgICAgICAgICAgICAgICBtYXRyaXggPSBtLm11bHRpcGx5TmV3KG1hdHJpeCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMudmlzaWJsZSgpIHx8IChjICYmICghdGhpcy5fdGFyZ2V0Q2FtZXJhcyB8fCB0aGlzLl90YXJnZXRDYW1lcmFzLmluZGV4T2YoYykgPT09IC0xKSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHRoaXNCb3VuZGluZ1JlY3QgPSB7IGxlZnQ6IDAsIHJpZ2h0OiB0aGlzLndpZHRoLCB0b3A6IDAsIGJvdHRvbTogdGhpcy5oZWlnaHQgfTtcbiAgICAgICAgICAgIHZhciB0YXJnZXRDb29yZGluYXRlcyA9IFtcbiAgICAgICAgICAgICAgICB7IHg6IHRoaXNCb3VuZGluZ1JlY3QubGVmdCwgeTogdGhpc0JvdW5kaW5nUmVjdC50b3AgfSxcbiAgICAgICAgICAgICAgICB7IHg6IHRoaXNCb3VuZGluZ1JlY3QubGVmdCwgeTogdGhpc0JvdW5kaW5nUmVjdC5ib3R0b20gfSxcbiAgICAgICAgICAgICAgICB7IHg6IHRoaXNCb3VuZGluZ1JlY3QucmlnaHQsIHk6IHRoaXNCb3VuZGluZ1JlY3QudG9wIH0sXG4gICAgICAgICAgICAgICAgeyB4OiB0aGlzQm91bmRpbmdSZWN0LnJpZ2h0LCB5OiB0aGlzQm91bmRpbmdSZWN0LmJvdHRvbSB9XG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgdmFyIGNvbnZlcnRlZFBvaW50ID0gbWF0cml4Lm11bHRpcGx5UG9pbnQodGFyZ2V0Q29vcmRpbmF0ZXNbMF0pO1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHsgbGVmdDogY29udmVydGVkUG9pbnQueCwgcmlnaHQ6IGNvbnZlcnRlZFBvaW50LngsIHRvcDogY29udmVydGVkUG9pbnQueSwgYm90dG9tOiBjb252ZXJ0ZWRQb2ludC55IH07XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHRhcmdldENvb3JkaW5hdGVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgY29udmVydGVkUG9pbnQgPSBtYXRyaXgubXVsdGlwbHlQb2ludCh0YXJnZXRDb29yZGluYXRlc1tpXSk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5sZWZ0ID4gY29udmVydGVkUG9pbnQueClcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmxlZnQgPSBjb252ZXJ0ZWRQb2ludC54O1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQucmlnaHQgPCBjb252ZXJ0ZWRQb2ludC54KVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQucmlnaHQgPSBjb252ZXJ0ZWRQb2ludC54O1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudG9wID4gY29udmVydGVkUG9pbnQueSlcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnRvcCA9IGNvbnZlcnRlZFBvaW50Lnk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5ib3R0b20gPCBjb252ZXJ0ZWRQb2ludC55KVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQuYm90dG9tID0gY29udmVydGVkUG9pbnQueTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBQYW5lO1xuICAgIH0oZy5DYWNoZWFibGVFKSk7XG4gICAgZy5QYW5lID0gUGFuZTtcbn0pKGcgfHwgKGcgPSB7fSkpO1xudmFyIGc7XG4oZnVuY3Rpb24gKGcpIHtcbiAgICAvKipcbiAgICAgKiDmk43kvZzjg5fjg6njgrDjgqTjg7PjgYvjgonjga7pgJrnn6XjgpLjg4/jg7Pjg4njg6vjgZnjgovjgq/jg6njgrnjgIJcbiAgICAgKiDmnKzjgq/jg6njgrnjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLjgrLjg7zjg6DplovnmbrogIXjgYznm7TmjqXnlJ/miJDjgZnjgovjgZPjgajjga/jgarjgY/jgIHjgrLjg7zjg6DplovnmbrogIXjgYzliKnnlKjjgZnjgovlv4XopoHjgoLjgarjgYTjgIJcbiAgICAgKi9cbiAgICB2YXIgT3BlcmF0aW9uSGFuZGxlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gT3BlcmF0aW9uSGFuZGxlcihjb2RlLCBvd25lciwgaGFuZGxlcikge1xuICAgICAgICAgICAgdGhpcy5fY29kZSA9IGNvZGU7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVyID0gaGFuZGxlcjtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZXJPd25lciA9IG93bmVyO1xuICAgICAgICB9XG4gICAgICAgIE9wZXJhdGlvbkhhbmRsZXIucHJvdG90eXBlLm9uT3BlcmF0aW9uID0gZnVuY3Rpb24gKG9wKSB7XG4gICAgICAgICAgICB2YXIgaW9wO1xuICAgICAgICAgICAgaWYgKG9wIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgICAgICBpb3AgPSB7IF9jb2RlOiB0aGlzLl9jb2RlLCBkYXRhOiBvcCB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaW9wID0gb3A7XG4gICAgICAgICAgICAgICAgaW9wLl9jb2RlID0gdGhpcy5fY29kZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZXIuY2FsbCh0aGlzLl9oYW5kbGVyT3duZXIsIGlvcCk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBPcGVyYXRpb25IYW5kbGVyO1xuICAgIH0oKSk7XG4gICAgLyoqXG4gICAgICog5pON5L2c44OX44Op44Kw44Kk44Oz44KS566h55CG44GZ44KL44Kv44Op44K544CCXG4gICAgICog5pys44Kv44Op44K544Gu44Kk44Oz44K544K/44Oz44K544KS44Ky44O844Og6ZaL55m66ICF44GM55u05o6l55Sf5oiQ44GZ44KL44GT44Go44Gv44Gq44GP44CB44Ky44O844Og6ZaL55m66ICF44GM5Yip55So44GZ44KL5b+F6KaB44KC44Gq44GE44CCXG4gICAgICovXG4gICAgdmFyIE9wZXJhdGlvblBsdWdpbk1hbmFnZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIE9wZXJhdGlvblBsdWdpbk1hbmFnZXIoZ2FtZSwgdmlld0luZm8sIGluZm9zKSB7XG4gICAgICAgICAgICB0aGlzLm9wZXJhdGVkID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICAgICAgdGhpcy5wbHVnaW5zID0ge307XG4gICAgICAgICAgICB0aGlzLl9nYW1lID0gZ2FtZTtcbiAgICAgICAgICAgIHRoaXMuX3ZpZXdJbmZvID0gdmlld0luZm87XG4gICAgICAgICAgICB0aGlzLl9pbmZvcyA9IGluZm9zO1xuICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICog5Yid5pyf5YyW44GZ44KL44CCXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBruWRvOOBs+WHuuOBl+OBr+OAgWB0aGlzLmdhbWUuX2xvYWRlZGAg44GuZmlyZeW+jOOBp+OBquOBkeOCjOOBsOOBquOCieOBquOBhOOAglxuICAgICAgICAgKi9cbiAgICAgICAgT3BlcmF0aW9uUGx1Z2luTWFuYWdlci5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5faW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pbml0aWFsaXplZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5fbG9hZE9wZXJhdGlvblBsdWdpbnMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2RvQXV0b1N0YXJ0KCk7XG4gICAgICAgIH07XG4gICAgICAgIE9wZXJhdGlvblBsdWdpbk1hbmFnZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3BBbGwoKTtcbiAgICAgICAgICAgIHRoaXMub3BlcmF0ZWQuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5vcGVyYXRlZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMucGx1Z2lucyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuX2dhbWUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLl92aWV3SW5mbyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuX2luZm9zID0gdW5kZWZpbmVkO1xuICAgICAgICB9O1xuICAgICAgICBPcGVyYXRpb25QbHVnaW5NYW5hZ2VyLnByb3RvdHlwZS5zdG9wQWxsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9pbml0aWFsaXplZClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX2luZm9zLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGluZm8gPSB0aGlzLl9pbmZvc1tpXTtcbiAgICAgICAgICAgICAgICBpZiAoaW5mby5fcGx1Z2luKVxuICAgICAgICAgICAgICAgICAgICBpbmZvLl9wbHVnaW4uc3RvcCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBPcGVyYXRpb25QbHVnaW5NYW5hZ2VyLnByb3RvdHlwZS5fZG9BdXRvU3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX2luZm9zLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGluZm8gPSB0aGlzLl9pbmZvc1tpXTtcbiAgICAgICAgICAgICAgICBpZiAoIWluZm8ubWFudWFsU3RhcnQgJiYgaW5mby5fcGx1Z2luKVxuICAgICAgICAgICAgICAgICAgICBpbmZvLl9wbHVnaW4uc3RhcnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgT3BlcmF0aW9uUGx1Z2luTWFuYWdlci5wcm90b3R5cGUuX2xvYWRPcGVyYXRpb25QbHVnaW5zID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9pbmZvcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIHZhciBpbmZvID0gdGhpcy5faW5mb3NbaV07XG4gICAgICAgICAgICAgICAgaWYgKCFpbmZvLnNjcmlwdClcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgdmFyIHBsdWdpbkNsYXNzID0gZy5fcmVxdWlyZSh0aGlzLl9nYW1lLCBpbmZvLnNjcmlwdCk7XG4gICAgICAgICAgICAgICAgaWYgKCFwbHVnaW5DbGFzcy5pc1N1cHBvcnRlZCgpKVxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB2YXIgcGx1Z2luID0gbmV3IHBsdWdpbkNsYXNzKHRoaXMuX2dhbWUsIHRoaXMuX3ZpZXdJbmZvLCBpbmZvLm9wdGlvbik7XG4gICAgICAgICAgICAgICAgdmFyIGNvZGUgPSBpbmZvLmNvZGU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGx1Z2luc1tjb2RlXSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQbHVnaW4jY29kZSBjb25mbGljdGVkIGZvciBjb2RlOiBcIiArIGNvZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbnNbY29kZV0gPSBwbHVnaW47XG4gICAgICAgICAgICAgICAgaW5mby5fcGx1Z2luID0gcGx1Z2luO1xuICAgICAgICAgICAgICAgIHZhciBoYW5kbGVyID0gbmV3IE9wZXJhdGlvbkhhbmRsZXIoY29kZSwgdGhpcy5vcGVyYXRlZCwgdGhpcy5vcGVyYXRlZC5maXJlKTtcbiAgICAgICAgICAgICAgICBwbHVnaW4ub3BlcmF0aW9uVHJpZ2dlci5oYW5kbGUoaGFuZGxlciwgaGFuZGxlci5vbk9wZXJhdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBPcGVyYXRpb25QbHVnaW5NYW5hZ2VyO1xuICAgIH0oKSk7XG4gICAgZy5PcGVyYXRpb25QbHVnaW5NYW5hZ2VyID0gT3BlcmF0aW9uUGx1Z2luTWFuYWdlcjtcbn0pKGcgfHwgKGcgPSB7fSkpO1xudmFyIGc7XG4oZnVuY3Rpb24gKGcpIHtcbn0pKGcgfHwgKGcgPSB7fSkpO1xudmFyIGc7XG4oZnVuY3Rpb24gKGcpIHtcbiAgICAvKipcbiAgICAgKiDjg5Xjgqnjg7Pjg4jjgIJcbiAgICAgKi9cbiAgICB2YXIgRm9udCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gRm9udCgpIHtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICog5a++6LGh44Gu5paH5a2X5YiX44KS5LiA6KGM44Gn5o+P55S744GX44Gf6Zqb44Gu6KiI5ris5oOF5aCx44KS6L+U44GZ44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB0ZXh0IOaWh+Wtl+WIl1xuICAgICAgICAgKi9cbiAgICAgICAgRm9udC5wcm90b3R5cGUubWVhc3VyZVRleHQgPSBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgICAgICAgdmFyIHdpZHRoID0gMDtcbiAgICAgICAgICAgIHZhciBhY3R1YWxCb3VuZGluZ0JveExlZnQgPSAwO1xuICAgICAgICAgICAgdmFyIGFjdHVhbEJvdW5kaW5nQm94UmlnaHQgPSAwO1xuICAgICAgICAgICAgdmFyIGxhc3RHbHlwaDtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGV4dC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBjb2RlID0gZy5VdGlsLmNoYXJDb2RlQXQodGV4dCwgaSk7XG4gICAgICAgICAgICAgICAgaWYgKCFjb2RlKVxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB2YXIgZ2x5cGggPSB0aGlzLmdseXBoRm9yQ2hhcmFjdGVyKGNvZGUpO1xuICAgICAgICAgICAgICAgIGlmICghZ2x5cGggfHwgZ2x5cGgueCA8IDAgfHwgZ2x5cGgueSA8IDAgfHwgZ2x5cGgud2lkdGggPCAwIHx8IGdseXBoLmhlaWdodCA8IDApXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGlmIChpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGFjdHVhbEJvdW5kaW5nQm94TGVmdCA9IC1nbHlwaC5vZmZzZXRYO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsYXN0R2x5cGggPSBnbHlwaDtcbiAgICAgICAgICAgICAgICB3aWR0aCArPSBnbHlwaC5hZHZhbmNlV2lkdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobGFzdEdseXBoKSB7XG4gICAgICAgICAgICAgICAgYWN0dWFsQm91bmRpbmdCb3hSaWdodCA9IHdpZHRoICsgbGFzdEdseXBoLm9mZnNldFggKyBsYXN0R2x5cGgud2lkdGggLSBsYXN0R2x5cGguYWR2YW5jZVdpZHRoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgICAgICAgICAgYWN0dWFsQm91bmRpbmdCb3hMZWZ0OiBhY3R1YWxCb3VuZGluZ0JveExlZnQsXG4gICAgICAgICAgICAgICAgYWN0dWFsQm91bmRpbmdCb3hSaWdodDogYWN0dWFsQm91bmRpbmdCb3hSaWdodFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIEZvbnQ7XG4gICAgfSgpKTtcbiAgICBnLkZvbnQgPSBGb250O1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIC8qKlxuICAgICAqIOaWh+Wtl+WIl+aPj+eUu+OBruODleOCqeODs+ODiOOCpuOCp+OCpOODiOOAglxuICAgICAqL1xuICAgIHZhciBGb250V2VpZ2h0O1xuICAgIChmdW5jdGlvbiAoRm9udFdlaWdodCkge1xuICAgICAgICAvKipcbiAgICAgICAgICog6YCa5bi444Gu44OV44Kp44Oz44OI44Km44Kn44Kk44OI44CCXG4gICAgICAgICAqL1xuICAgICAgICBGb250V2VpZ2h0W0ZvbnRXZWlnaHRbXCJOb3JtYWxcIl0gPSAwXSA9IFwiTm9ybWFsXCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlpKrlrZfjga7jg5Xjgqnjg7Pjg4jjgqbjgqfjgqTjg4jjgIJcbiAgICAgICAgICovXG4gICAgICAgIEZvbnRXZWlnaHRbRm9udFdlaWdodFtcIkJvbGRcIl0gPSAxXSA9IFwiQm9sZFwiO1xuICAgIH0pKEZvbnRXZWlnaHQgPSBnLkZvbnRXZWlnaHQgfHwgKGcuRm9udFdlaWdodCA9IHt9KSk7XG4gICAgLyoqXG4gICAgICog44OT44OD44OI44Oe44OD44OX44OV44Kp44Oz44OI44KS6YCQ5qyh55Sf5oiQ44GZ44KL44OV44Kp44Oz44OI44CCXG4gICAgICovXG4gICAgdmFyIER5bmFtaWNGb250ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoRHluYW1pY0ZvbnQsIF9zdXBlcik7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlkITnqK7jg5Hjg6njg6Hjg7zjgr/jgpLmjIflrprjgZfjgaYgYER5bmFtaWNGb250YCDjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLnlJ/miJDjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHBhcmFtIGBEeW5hbWljRm9udGAg44Gr6Kit5a6a44GZ44KL44OR44Op44Oh44O844K/XG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBEeW5hbWljRm9udChwYXJhbSkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgICAgIF90aGlzLmZvbnRGYW1pbHkgPSBwYXJhbS5mb250RmFtaWx5O1xuICAgICAgICAgICAgX3RoaXMuc2l6ZSA9IHBhcmFtLnNpemU7XG4gICAgICAgICAgICBfdGhpcy5oaW50ID0gKFwiaGludFwiIGluIHBhcmFtKSA/IHBhcmFtLmhpbnQgOiB7fTtcbiAgICAgICAgICAgIF90aGlzLmZvbnRDb2xvciA9IChcImZvbnRDb2xvclwiIGluIHBhcmFtKSA/IHBhcmFtLmZvbnRDb2xvciA6IFwiYmxhY2tcIjtcbiAgICAgICAgICAgIF90aGlzLmZvbnRXZWlnaHQgPSAoXCJmb250V2VpZ2h0XCIgaW4gcGFyYW0pID8gcGFyYW0uZm9udFdlaWdodCA6IEZvbnRXZWlnaHQuTm9ybWFsO1xuICAgICAgICAgICAgX3RoaXMuc3Ryb2tlV2lkdGggPSAoXCJzdHJva2VXaWR0aFwiIGluIHBhcmFtKSA/IHBhcmFtLnN0cm9rZVdpZHRoIDogMDtcbiAgICAgICAgICAgIF90aGlzLnN0cm9rZUNvbG9yID0gKFwic3Ryb2tlQ29sb3JcIiBpbiBwYXJhbSkgPyBwYXJhbS5zdHJva2VDb2xvciA6IFwiYmxhY2tcIjtcbiAgICAgICAgICAgIF90aGlzLnN0cm9rZU9ubHkgPSAoXCJzdHJva2VPbmx5XCIgaW4gcGFyYW0pID8gcGFyYW0uc3Ryb2tlT25seSA6IGZhbHNlO1xuICAgICAgICAgICAgX3RoaXMuX3Jlc291cmNlRmFjdG9yeSA9IHBhcmFtLmdhbWUucmVzb3VyY2VGYWN0b3J5O1xuICAgICAgICAgICAgX3RoaXMuX2dseXBoRmFjdG9yeSA9XG4gICAgICAgICAgICAgICAgX3RoaXMuX3Jlc291cmNlRmFjdG9yeS5jcmVhdGVHbHlwaEZhY3RvcnkoX3RoaXMuZm9udEZhbWlseSwgX3RoaXMuc2l6ZSwgX3RoaXMuaGludC5iYXNlbGluZUhlaWdodCwgX3RoaXMuZm9udENvbG9yLCBfdGhpcy5zdHJva2VXaWR0aCwgX3RoaXMuc3Ryb2tlQ29sb3IsIF90aGlzLnN0cm9rZU9ubHksIF90aGlzLmZvbnRXZWlnaHQpO1xuICAgICAgICAgICAgX3RoaXMuX2dseXBocyA9IHt9O1xuICAgICAgICAgICAgX3RoaXMuX2Rlc3Ryb3llZCA9IGZhbHNlO1xuICAgICAgICAgICAgX3RoaXMuX2lzU3VyZmFjZUF0bGFzU2V0T3duZXIgPSBmYWxzZTtcbiAgICAgICAgICAgIC8vIE5PVEU6IGhpbnQg44Gu54m55a6a44OX44Ot44OR44OG44KjKGJhc2VsaW5lSGVpZ2h0KeOCkuWIhuWykOOBruadoeS7tuOBq+OBl+OBn+WgtOWQiOOAgeW+jOOBp+ODl+ODreODkeODhuOCo+OCkui/veWKoOOBl+OBn+aZguOBq1xuICAgICAgICAgICAgLy8g44GT44GT44Gn6L+95b6T5ryP44KM44Gu5oe45b+144GM44GC44KL44Gf44KB44CB5byV5pWw44GuIGhpbnQg44GM55yB55Wl44GV44KM44Gm44GE44KL44GL44Gn5YiG5bKQ44GV44Gb44Gm44GE44KL44CCXG4gICAgICAgICAgICBpZiAocGFyYW0uc3VyZmFjZUF0bGFzU2V0KSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX2F0bGFzU2V0ID0gcGFyYW0uc3VyZmFjZUF0bGFzU2V0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoISFwYXJhbS5oaW50KSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX2lzU3VyZmFjZUF0bGFzU2V0T3duZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgIF90aGlzLl9hdGxhc1NldCA9IG5ldyBnLlN1cmZhY2VBdGxhc1NldCh7XG4gICAgICAgICAgICAgICAgICAgIGdhbWU6IHBhcmFtLmdhbWUsXG4gICAgICAgICAgICAgICAgICAgIGhpbnQ6IF90aGlzLmhpbnRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIF90aGlzLl9hdGxhc1NldCA9IHBhcmFtLmdhbWUuc3VyZmFjZUF0bGFzU2V0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMuX2F0bGFzU2V0LmFkZEF0bGFzKCk7XG4gICAgICAgICAgICBpZiAoX3RoaXMuaGludC5wcmVzZXRDaGFycykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBfdGhpcy5oaW50LnByZXNldENoYXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2RlID0gZy5VdGlsLmNoYXJDb2RlQXQoX3RoaXMuaGludC5wcmVzZXRDaGFycywgaSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY29kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuZ2x5cGhGb3JDaGFyYWN0ZXIoY29kZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgrDjg6rjg5Xjga7lj5blvpfjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog5Y+W5b6X44Gr5aSx5pWX44GZ44KL44GobnVsbOOBjOi/lOOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDlj5blvpfjgavlpLHmlZfjgZfjgZ/mmYLjgIHmrKHjga7jgojjgYbjgavjgZnjgovjgZPjgajjgafmiJDlip/jgZnjgovjgYvjgoLjgZfjgozjgarjgYTjgIJcbiAgICAgICAgICogLSBEeW5hbWljRm9udOeUn+aIkOaZguOBq+aMh+WumuOBmeOCi+aWh+Wtl+OCteOCpOOCuuOCkuWwj+OBleOBj+OBmeOCi1xuICAgICAgICAgKiAtIOOCouODiOODqeOCueOBruWIneacn+OCteOCpOOCuuODu+acgOWkp+OCteOCpOOCuuOCkuWkp+OBjeOBj+OBmeOCi1xuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gY29kZSDmloflrZfjgrPjg7zjg4lcbiAgICAgICAgICovXG4gICAgICAgIER5bmFtaWNGb250LnByb3RvdHlwZS5nbHlwaEZvckNoYXJhY3RlciA9IGZ1bmN0aW9uIChjb2RlKSB7XG4gICAgICAgICAgICB2YXIgZ2x5cGggPSB0aGlzLl9nbHlwaHNbY29kZV07XG4gICAgICAgICAgICBpZiAoIShnbHlwaCAmJiBnbHlwaC5pc1N1cmZhY2VWYWxpZCkpIHtcbiAgICAgICAgICAgICAgICBnbHlwaCA9IHRoaXMuX2dseXBoRmFjdG9yeS5jcmVhdGUoY29kZSk7XG4gICAgICAgICAgICAgICAgaWYgKGdseXBoLnN1cmZhY2UpIHsgLy8g56m655m95paH5a2X44Gn44Gq44GR44KM44Gw44Ki44OI44Op44K55YyW44GZ44KLXG4gICAgICAgICAgICAgICAgICAgIHZhciBhdGxhc18xID0gdGhpcy5fYXRsYXNTZXQuYWRkR2x5cGgoZ2x5cGgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWF0bGFzXzEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGdseXBoLl9hdGxhcyA9IGF0bGFzXzE7XG4gICAgICAgICAgICAgICAgICAgIGdseXBoLl9hdGxhcy5fYWNjZXNzU2NvcmUgKz0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fZ2x5cGhzW2NvZGVdID0gZ2x5cGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDjgrnjgrPjgqLmm7TmlrBcbiAgICAgICAgICAgIC8vIE5PVEU6IExSVeOCkuaNqOOBpuOCi+aWueW8j+OBquOCieWNmOe0lOOBquOCv+OCpOODoOOCueOCv+ODs+ODl+OBruOBu+OBhuOBjOOCj+OBi+OCiuOChOOBmeOBhOOBi+OCguOBl+OCjOOBquOBhFxuICAgICAgICAgICAgLy8gTk9URTog5q2j56K644Gq5pmC5Yi744Gv5b+F6KaB44Gq44GE44Gv44Ga44Gn44CB44Kk44Oz44Kv44Oq44Oh44Oz44K/44Or44Gq44Kr44Km44Oz44K/44Gn5Luj55So44GZ44KM44GwRGF0ZSgp55Sf5oiQ44Kz44K544OI44Gv55yB55Wl44Gn44GN44KLXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX2F0bGFzU2V0LmdldEF0bGFzTnVtKCk7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBhdGxhcyA9IHRoaXMuX2F0bGFzU2V0LmdldEF0bGFzKGkpO1xuICAgICAgICAgICAgICAgIGF0bGFzLl9hY2Nlc3NTY29yZSAvPSAyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGdseXBoO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQnRpbWFwRm9udOOBrueUn+aIkOOAglxuICAgICAgICAgKlxuICAgICAgICAgKiDlrp/oo4XkuIrjga7liLbpmZDjgYvjgonjgIHjgZPjga7jg6Hjgr3jg4Pjg4njgpLlkbzjgbPlh7rjgZnloLTlkIjjgIFtYXhBdGxhc051bSDjgYwgMSDjgb7jgZ/jga8gdW5kZWZpbmVkL251bGwoMeOBqOOBl+OBpuaJseOCj+OCjOOCiykg44Gn44GC44KL5b+F6KaB44GM44GC44KL44CCXG4gICAgICAgICAqIOOBneOBhuOBp+OBquOBhOWgtOWQiOOAgeWkseaVl+OBmeOCi+WPr+iDveaAp+OBjOOBguOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gbWlzc2luZ0dseXBoIGBCaXRtYXBGb250I21hcGAg44Gr5a2Y5Zyo44GX44Gq44GE44Kz44O844OJ44Od44Kk44Oz44OI44Gu5Luj44KP44KK44Gr6KGo56S644GZ44KL44G544GN5paH5a2X44CC5pyA5Yid44Gu5LiA5paH5a2X44GM55So44GE44KJ44KM44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBEeW5hbWljRm9udC5wcm90b3R5cGUuYXNCaXRtYXBGb250ID0gZnVuY3Rpb24gKG1pc3NpbmdHbHlwaENoYXIpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICBpZiAodGhpcy5fYXRsYXNTZXQuZ2V0QXRsYXNOdW0oKSAhPT0gMSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIG1pc3NpbmdHbHlwaENoYXJDb2RlUG9pbnQ7XG4gICAgICAgICAgICBpZiAobWlzc2luZ0dseXBoQ2hhcikge1xuICAgICAgICAgICAgICAgIG1pc3NpbmdHbHlwaENoYXJDb2RlUG9pbnQgPSBnLlV0aWwuY2hhckNvZGVBdChtaXNzaW5nR2x5cGhDaGFyLCAwKTtcbiAgICAgICAgICAgICAgICB0aGlzLmdseXBoRm9yQ2hhcmFjdGVyKG1pc3NpbmdHbHlwaENoYXJDb2RlUG9pbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGdseXBoQXJlYU1hcCA9IHt9O1xuICAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy5fZ2x5cGhzKS5mb3JFYWNoKGZ1bmN0aW9uIChfa2V5KSB7XG4gICAgICAgICAgICAgICAgdmFyIGtleSA9IE51bWJlcihfa2V5KTtcbiAgICAgICAgICAgICAgICB2YXIgZ2x5cGggPSBfdGhpcy5fZ2x5cGhzW2tleV07XG4gICAgICAgICAgICAgICAgdmFyIGdseXBoQXJlYSA9IHtcbiAgICAgICAgICAgICAgICAgICAgeDogZ2x5cGgueCxcbiAgICAgICAgICAgICAgICAgICAgeTogZ2x5cGgueSxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGdseXBoLndpZHRoLFxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGdseXBoLmhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0WDogZ2x5cGgub2Zmc2V0WCxcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0WTogZ2x5cGgub2Zmc2V0WSxcbiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZVdpZHRoOiBnbHlwaC5hZHZhbmNlV2lkdGhcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGdseXBoQXJlYU1hcFtrZXldID0gZ2x5cGhBcmVhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBOT1RFOiAoZGVmYXVsdEdseXBoV2lkdGgsIGRlZmF1bHRHbHlwaEhlaWdodCk9ICgwLCB0aGlzLnNpemUpIOOBqOOBmeOCi1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIOOBneOCjOOBnuOCjOOBruW9ueWJsuOBr+esrOS4gOOBqyBgR2x5cGhBcmVhI3dpZHRoYCwgYEdseXBoQXJlYSNoZWlnaHRgIOOBjOS4juOBiOOCieOCjOOBquOBhOOBqOOBjeOBrlxuICAgICAgICAgICAgLy8g44OH44OV44Kp44Or44OI5YCk44Gn44GC44KL44CC44GT44GT44Gn44Gv5b+F44Ga5LiO44GI44Gm44GE44KL44Gu44Gn44OH44OV44Kp44Or44OI5YCk44Go44GX44Gm44Gv5Yip55So44GV44KM44Gq44GE44CCXG4gICAgICAgICAgICAvLyDjgZfjgYvjgZcgZGVmYXVsdEdseXBoSGVpZ2h0IOOBryBCaXRtYXBGb250I3NpemUg44Gr44KC55So44GE44KJ44KM44KL44CCXG4gICAgICAgICAgICAvLyDjgZ3jga7jgZ/jgoHjgasgdGhpcy5zaXplIOOCkuOCs+ODs+OCueODiOODqeOCr+OCv+OBruesrO+8lOW8leaVsOOBq+S4juOBiOOCi+OBk+OBqOOBq+OBmeOCi+OAglxuICAgICAgICAgICAgdmFyIG1pc3NpbmdHbHlwaCA9IGdseXBoQXJlYU1hcFttaXNzaW5nR2x5cGhDaGFyQ29kZVBvaW50XTtcbiAgICAgICAgICAgIHZhciBzdXJmYWNlID0gdGhpcy5fYXRsYXNTZXQuZ2V0QXRsYXMoMCkuZHVwbGljYXRlU3VyZmFjZSh0aGlzLl9yZXNvdXJjZUZhY3RvcnkpO1xuICAgICAgICAgICAgdmFyIGJpdG1hcEZvbnQgPSBuZXcgZy5CaXRtYXBGb250KHtcbiAgICAgICAgICAgICAgICBzcmM6IHN1cmZhY2UsXG4gICAgICAgICAgICAgICAgbWFwOiBnbHlwaEFyZWFNYXAsXG4gICAgICAgICAgICAgICAgZGVmYXVsdEdseXBoV2lkdGg6IDAsXG4gICAgICAgICAgICAgICAgZGVmYXVsdEdseXBoSGVpZ2h0OiB0aGlzLnNpemUsXG4gICAgICAgICAgICAgICAgbWlzc2luZ0dseXBoOiBtaXNzaW5nR2x5cGhcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGJpdG1hcEZvbnQ7XG4gICAgICAgIH07XG4gICAgICAgIER5bmFtaWNGb250LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2lzU3VyZmFjZUF0bGFzU2V0T3duZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9hdGxhc1NldC5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9nbHlwaHMgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5fZ2x5cGhGYWN0b3J5ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuX2Rlc3Ryb3llZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIER5bmFtaWNGb250LnByb3RvdHlwZS5kZXN0cm95ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZGVzdHJveWVkO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gRHluYW1pY0ZvbnQ7XG4gICAgfShnLkZvbnQpKTtcbiAgICBnLkR5bmFtaWNGb250ID0gRHluYW1pY0ZvbnQ7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnXzEpIHtcbiAgICAvKipcbiAgICAgKiDjg6njgrnjgr/nlLvlg4/jgavjgojjgovjg5Xjgqnjg7Pjg4jjgIJcbiAgICAgKi9cbiAgICB2YXIgQml0bWFwRm9udCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICAgICAgX19leHRlbmRzKEJpdG1hcEZvbnQsIF9zdXBlcik7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlkITnqK7jg5Hjg6njg6Hjg7zjgr/jgpLmjIflrprjgZfjgaYgYEJpdG1hcEZvbnRgIOOBruOCpOODs+OCueOCv+ODs+OCueOCkueUn+aIkOOBmeOCi+OAglxuICAgICAgICAgKiBAcGFyYW0gcGFyYW0gYEJpdG1hcEZvbnRgIOOBq+ioreWumuOBmeOCi+ODkeODqeODoeODvOOCv1xuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gQml0bWFwRm9udChwYXJhbSkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgICAgIF90aGlzLnN1cmZhY2UgPSBnXzEuVXRpbC5hc1N1cmZhY2UocGFyYW0uc3JjKTtcbiAgICAgICAgICAgIF90aGlzLm1hcCA9IHBhcmFtLm1hcDtcbiAgICAgICAgICAgIF90aGlzLmRlZmF1bHRHbHlwaFdpZHRoID0gcGFyYW0uZGVmYXVsdEdseXBoV2lkdGg7XG4gICAgICAgICAgICBfdGhpcy5kZWZhdWx0R2x5cGhIZWlnaHQgPSBwYXJhbS5kZWZhdWx0R2x5cGhIZWlnaHQ7XG4gICAgICAgICAgICBfdGhpcy5taXNzaW5nR2x5cGggPSBwYXJhbS5taXNzaW5nR2x5cGg7XG4gICAgICAgICAgICBfdGhpcy5zaXplID0gcGFyYW0uZGVmYXVsdEdseXBoSGVpZ2h0O1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgrPjg7zjg4njg53jgqTjg7Pjg4jjgavlr77lv5zjgZnjgovjgrDjg6rjg5XjgpLov5TjgZnjgIJcbiAgICAgICAgICogQHBhcmFtIGNvZGUg44Kz44O844OJ44Od44Kk44Oz44OIXG4gICAgICAgICAqL1xuICAgICAgICBCaXRtYXBGb250LnByb3RvdHlwZS5nbHlwaEZvckNoYXJhY3RlciA9IGZ1bmN0aW9uIChjb2RlKSB7XG4gICAgICAgICAgICB2YXIgZyA9IHRoaXMubWFwW2NvZGVdIHx8IHRoaXMubWlzc2luZ0dseXBoO1xuICAgICAgICAgICAgaWYgKCFnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdyA9IGcud2lkdGggPT09IHVuZGVmaW5lZCA/IHRoaXMuZGVmYXVsdEdseXBoV2lkdGggOiBnLndpZHRoO1xuICAgICAgICAgICAgdmFyIGggPSBnLmhlaWdodCA9PT0gdW5kZWZpbmVkID8gdGhpcy5kZWZhdWx0R2x5cGhIZWlnaHQgOiBnLmhlaWdodDtcbiAgICAgICAgICAgIHZhciBvZmZzZXRYID0gZy5vZmZzZXRYIHx8IDA7XG4gICAgICAgICAgICB2YXIgb2Zmc2V0WSA9IGcub2Zmc2V0WSB8fCAwO1xuICAgICAgICAgICAgdmFyIGFkdmFuY2VXaWR0aCA9IGcuYWR2YW5jZVdpZHRoID09PSB1bmRlZmluZWQgPyB3IDogZy5hZHZhbmNlV2lkdGg7XG4gICAgICAgICAgICB2YXIgc3VyZmFjZSA9ICh3ID09PSAwIHx8IGggPT09IDApID8gdW5kZWZpbmVkIDogdGhpcy5zdXJmYWNlO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBnXzEuR2x5cGgoY29kZSwgZy54LCBnLnksIHcsIGgsIG9mZnNldFgsIG9mZnNldFksIGFkdmFuY2VXaWR0aCwgc3VyZmFjZSwgdHJ1ZSk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDliKnnlKjjgZfjgabjgYTjgosgYFN1cmZhY2VgIOOCkuegtOajhOOBl+OBn+S4iuOBp+OAgeOBk+OBruODleOCqeODs+ODiOOCkuegtOajhOOBmeOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgQml0bWFwRm9udC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN1cmZhY2UgJiYgIXRoaXMuc3VyZmFjZS5kZXN0cm95ZWQoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3VyZmFjZS5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm1hcCA9IHVuZGVmaW5lZDtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOegtOajhOOBleOCjOOBn+OCquODluOCuOOCp+OCr+ODiOOBi+OBqeOBhuOBi+OCkuWIpOWumuOBmeOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgQml0bWFwRm9udC5wcm90b3R5cGUuZGVzdHJveWVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gbWFw44KSZmFsc3nlgKTjgafkvZzmiJDjgZXjgozjgZ/loLTlkIjmnIDliJ3jgYvjgonnoLTmo4TmibHjgYTjgavjgarjgovjgYzjgIHku5Xmp5jjgajjgZnjgotcbiAgICAgICAgICAgIHJldHVybiAhdGhpcy5tYXA7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBCaXRtYXBGb250O1xuICAgIH0oZ18xLkZvbnQpKTtcbiAgICBnXzEuQml0bWFwRm9udCA9IEJpdG1hcEZvbnQ7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICogU3VyZmFjZUF0bGFz44Gu56m644GN6aCY5Z+f566h55CG44Kv44Op44K544CCXG4gICAgICpcbiAgICAgKiDmnKzjgq/jg6njgrnjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLjgrLjg7zjg6DplovnmbrogIXjgYznm7TmjqXnlJ/miJDjgZnjgovjgZPjgajjga/jgarjgY/jgIHjgrLjg7zjg6DplovnmbrogIXjgYzliKnnlKjjgZnjgovlv4XopoHjgoLjgarjgYTjgIJcbiAgICAgKi9cbiAgICB2YXIgU3VyZmFjZUF0bGFzU2xvdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gU3VyZmFjZUF0bGFzU2xvdCh4LCB5LCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgICAgICB0aGlzLnggPSB4O1xuICAgICAgICAgICAgdGhpcy55ID0geTtcbiAgICAgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDtcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICAgICAgdGhpcy5wcmV2ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMubmV4dCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFN1cmZhY2VBdGxhc1Nsb3Q7XG4gICAgfSgpKTtcbiAgICBnLlN1cmZhY2VBdGxhc1Nsb3QgPSBTdXJmYWNlQXRsYXNTbG90O1xuICAgIGZ1bmN0aW9uIGdldFN1cmZhY2VBdGxhc1Nsb3Qoc2xvdCwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICB3aGlsZSAoc2xvdCkge1xuICAgICAgICAgICAgaWYgKHNsb3Qud2lkdGggPj0gd2lkdGggJiYgc2xvdC5oZWlnaHQgPj0gaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNsb3Q7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzbG90ID0gc2xvdC5uZXh0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBmdW5jdGlvbiBjYWxjQXRsYXNTaXplKGhpbnQpIHtcbiAgICAgICAgdmFyIHdpZHRoID0gTWF0aC5jZWlsKE1hdGgubWluKGhpbnQuaW5pdGlhbEF0bGFzV2lkdGgsIGhpbnQubWF4QXRsYXNXaWR0aCkpO1xuICAgICAgICB2YXIgaGVpZ2h0ID0gTWF0aC5jZWlsKE1hdGgubWluKGhpbnQuaW5pdGlhbEF0bGFzSGVpZ2h0LCBoaW50Lm1heEF0bGFzSGVpZ2h0KSk7XG4gICAgICAgIHJldHVybiB7IHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICog44K144O844OV44Kn44K544Ki44OI44Op44K544CCXG4gICAgICpcbiAgICAgKiDkuI7jgYjjgonjgozjgZ/jgrXjg7zjg5Xjgqfjgrnjga7mjIflrprjgZXjgozjgZ/poJjln5/jgpLjgrPjg5Tjg7zjgZfkuIDmnprjga7jgrXjg7zjg5Xjgqfjgrnjgavjgb7jgajjgoHjgovjgIJcbiAgICAgKlxuICAgICAqIOacrOOCr+ODqeOCueOBruOCpOODs+OCueOCv+ODs+OCueOCkuOCsuODvOODoOmWi+eZuuiAheOBjOebtOaOpeeUn+aIkOOBmeOCi+OBk+OBqOOBr+OBquOBj+OAgeOCsuODvOODoOmWi+eZuuiAheOBjOWIqeeUqOOBmeOCi+W/heimgeOCguOBquOBhOOAglxuICAgICAqL1xuICAgIHZhciBTdXJmYWNlQXRsYXMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIFN1cmZhY2VBdGxhcyhzdXJmYWNlKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXJmYWNlID0gc3VyZmFjZTtcbiAgICAgICAgICAgIHRoaXMuX2VtcHR5U3VyZmFjZUF0bGFzU2xvdEhlYWQgPSBuZXcgU3VyZmFjZUF0bGFzU2xvdCgwLCAwLCB0aGlzLl9zdXJmYWNlLndpZHRoLCB0aGlzLl9zdXJmYWNlLmhlaWdodCk7XG4gICAgICAgICAgICB0aGlzLl9hY2Nlc3NTY29yZSA9IDA7XG4gICAgICAgICAgICB0aGlzLl91c2VkUmVjdGFuZ2xlQXJlYVNpemUgPSB7IHdpZHRoOiAwLCBoZWlnaHQ6IDAgfTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIFN1cmZhY2VBdGxhcy5wcm90b3R5cGUuX2FjcXVpcmVTdXJmYWNlQXRsYXNTbG90ID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgICAgIC8vIFJlbmRlcmVyI2RyYXdJbWFnZSgp44Gn44K144O844OV44Kn44K55LiK44Gu5LiA6YOo44KS5o+P55S744GZ44KL44Go44GN44CBXG4gICAgICAgICAgICAvLyDmjIflrprjgZfjgZ/pg6jliIbjgavpmqPmjqXjgZnjgovnlLvntKDjgYzjgavjgZjjgb/lh7rjgovnj77osaHjgYznorroqo3jgZXjgozjgabjgYTjgovjgIJcbiAgICAgICAgICAgIC8vIOOBk+OBk+OCjOOBp+OBr+OBneOCjOOCkumBv+OBkeOCi+OBn+OCgTFwaXhlbOOBruS9meeZveOCkuS4juOBiOOBpuOBhOOCi+OAglxuICAgICAgICAgICAgd2lkdGggKz0gMTtcbiAgICAgICAgICAgIGhlaWdodCArPSAxO1xuICAgICAgICAgICAgdmFyIHNsb3QgPSBnZXRTdXJmYWNlQXRsYXNTbG90KHRoaXMuX2VtcHR5U3VyZmFjZUF0bGFzU2xvdEhlYWQsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICAgICAgaWYgKCFzbG90KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcmVtYWluV2lkdGggPSBzbG90LndpZHRoIC0gd2lkdGg7XG4gICAgICAgICAgICB2YXIgcmVtYWluSGVpZ2h0ID0gc2xvdC5oZWlnaHQgLSBoZWlnaHQ7XG4gICAgICAgICAgICB2YXIgbGVmdDtcbiAgICAgICAgICAgIHZhciByaWdodDtcbiAgICAgICAgICAgIGlmIChyZW1haW5XaWR0aCA8PSByZW1haW5IZWlnaHQpIHtcbiAgICAgICAgICAgICAgICBsZWZ0ID0gbmV3IFN1cmZhY2VBdGxhc1Nsb3Qoc2xvdC54ICsgd2lkdGgsIHNsb3QueSwgcmVtYWluV2lkdGgsIGhlaWdodCk7XG4gICAgICAgICAgICAgICAgcmlnaHQgPSBuZXcgU3VyZmFjZUF0bGFzU2xvdChzbG90LngsIHNsb3QueSArIGhlaWdodCwgc2xvdC53aWR0aCwgcmVtYWluSGVpZ2h0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxlZnQgPSBuZXcgU3VyZmFjZUF0bGFzU2xvdChzbG90LngsIHNsb3QueSArIGhlaWdodCwgd2lkdGgsIHJlbWFpbkhlaWdodCk7XG4gICAgICAgICAgICAgICAgcmlnaHQgPSBuZXcgU3VyZmFjZUF0bGFzU2xvdChzbG90LnggKyB3aWR0aCwgc2xvdC55LCByZW1haW5XaWR0aCwgc2xvdC5oZWlnaHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGVmdC5wcmV2ID0gc2xvdC5wcmV2O1xuICAgICAgICAgICAgbGVmdC5uZXh0ID0gcmlnaHQ7XG4gICAgICAgICAgICBpZiAobGVmdC5wcmV2ID09PSBudWxsKSB7IC8vIGxlZnQgaXMgaGVhZFxuICAgICAgICAgICAgICAgIHRoaXMuX2VtcHR5U3VyZmFjZUF0bGFzU2xvdEhlYWQgPSBsZWZ0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbGVmdC5wcmV2Lm5leHQgPSBsZWZ0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmlnaHQucHJldiA9IGxlZnQ7XG4gICAgICAgICAgICByaWdodC5uZXh0ID0gc2xvdC5uZXh0O1xuICAgICAgICAgICAgaWYgKHJpZ2h0Lm5leHQpIHtcbiAgICAgICAgICAgICAgICByaWdodC5uZXh0LnByZXYgPSByaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBhY3F1aXJlZFNsb3QgPSBuZXcgU3VyZmFjZUF0bGFzU2xvdChzbG90LngsIHNsb3QueSwgd2lkdGgsIGhlaWdodCk7XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVVc2VkUmVjdGFuZ2xlQXJlYVNpemUoYWNxdWlyZWRTbG90KTtcbiAgICAgICAgICAgIHJldHVybiBhY3F1aXJlZFNsb3Q7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgU3VyZmFjZUF0bGFzLnByb3RvdHlwZS5fdXBkYXRlVXNlZFJlY3RhbmdsZUFyZWFTaXplID0gZnVuY3Rpb24gKHNsb3QpIHtcbiAgICAgICAgICAgIHZhciBzbG90UmlnaHQgPSBzbG90LnggKyBzbG90LndpZHRoO1xuICAgICAgICAgICAgdmFyIHNsb3RCb3R0b20gPSBzbG90LnkgKyBzbG90LmhlaWdodDtcbiAgICAgICAgICAgIGlmIChzbG90UmlnaHQgPiB0aGlzLl91c2VkUmVjdGFuZ2xlQXJlYVNpemUud2lkdGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl91c2VkUmVjdGFuZ2xlQXJlYVNpemUud2lkdGggPSBzbG90UmlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2xvdEJvdHRvbSA+IHRoaXMuX3VzZWRSZWN0YW5nbGVBcmVhU2l6ZS5oZWlnaHQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl91c2VkUmVjdGFuZ2xlQXJlYVNpemUuaGVpZ2h0ID0gc2xvdEJvdHRvbTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOCteODvOODleOCp+OCueOBrui/veWKoOOAglxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gZ2x5cGgg44Kw44Oq44OV44Gu44K144O844OV44Kn44K544GM5oyB44Gk5oOF5aCx44KSU3VyZmFjZUF0bGFz44G46YWN572uXG4gICAgICAgICAqL1xuICAgICAgICBTdXJmYWNlQXRsYXMucHJvdG90eXBlLmFkZFN1cmZhY2UgPSBmdW5jdGlvbiAoZ2x5cGgpIHtcbiAgICAgICAgICAgIHZhciBzbG90ID0gdGhpcy5fYWNxdWlyZVN1cmZhY2VBdGxhc1Nsb3QoZ2x5cGgud2lkdGgsIGdseXBoLmhlaWdodCk7XG4gICAgICAgICAgICBpZiAoIXNsb3QpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZW5kZXJlciA9IHRoaXMuX3N1cmZhY2UucmVuZGVyZXIoKTtcbiAgICAgICAgICAgIHJlbmRlcmVyLmJlZ2luKCk7XG4gICAgICAgICAgICByZW5kZXJlci5kcmF3SW1hZ2UoZ2x5cGguc3VyZmFjZSwgZ2x5cGgueCwgZ2x5cGgueSwgZ2x5cGgud2lkdGgsIGdseXBoLmhlaWdodCwgc2xvdC54LCBzbG90LnkpO1xuICAgICAgICAgICAgcmVuZGVyZXIuZW5kKCk7XG4gICAgICAgICAgICByZXR1cm4gc2xvdDtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBrlN1cmZhY2VBdGxhc+OBruegtOajhOOCkuihjOOBhuOAglxuICAgICAgICAgKiDku6XlvozjgIHjgZPjga5TdXJmYWNl44KS5Yip55So44GZ44KL44GT44Go44Gv5Ye65p2l44Gq44GP44Gq44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBTdXJmYWNlQXRsYXMucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXJmYWNlLmRlc3Ryb3koKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBrlN1cmZhY2VBdGxhc+OBjOegtOajhOa4iOOBp+OBguOCi+OBi+OBqeOBhuOBi+OCkuWIpOWumuOBmeOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgU3VyZmFjZUF0bGFzLnByb3RvdHlwZS5kZXN0cm95ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc3VyZmFjZS5kZXN0cm95ZWQoKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIF9zdXJmYWNl44KS6KSH6KO944GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOikh+ijveOBleOCjOOBn1N1cmZhY2Xjga/mloflrZfjgpLmoLzntI3jgZnjgovjga7jgavlv4XopoHjgarmnIDkvY7pmZDjga7jgrXjgqTjgrrjgavjgarjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIFN1cmZhY2VBdGxhcy5wcm90b3R5cGUuZHVwbGljYXRlU3VyZmFjZSA9IGZ1bmN0aW9uIChyZXNvdXJjZUZhY3RvcnkpIHtcbiAgICAgICAgICAgIHZhciBzcmMgPSB0aGlzLl9zdXJmYWNlO1xuICAgICAgICAgICAgdmFyIGRzdCA9IHJlc291cmNlRmFjdG9yeS5jcmVhdGVTdXJmYWNlKHRoaXMuX3VzZWRSZWN0YW5nbGVBcmVhU2l6ZS53aWR0aCwgdGhpcy5fdXNlZFJlY3RhbmdsZUFyZWFTaXplLmhlaWdodCk7XG4gICAgICAgICAgICB2YXIgcmVuZGVyZXIgPSBkc3QucmVuZGVyZXIoKTtcbiAgICAgICAgICAgIHJlbmRlcmVyLmJlZ2luKCk7XG4gICAgICAgICAgICByZW5kZXJlci5kcmF3SW1hZ2Uoc3JjLCAwLCAwLCB0aGlzLl91c2VkUmVjdGFuZ2xlQXJlYVNpemUud2lkdGgsIHRoaXMuX3VzZWRSZWN0YW5nbGVBcmVhU2l6ZS5oZWlnaHQsIDAsIDApO1xuICAgICAgICAgICAgcmVuZGVyZXIuZW5kKCk7XG4gICAgICAgICAgICByZXR1cm4gZHN0O1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gU3VyZmFjZUF0bGFzO1xuICAgIH0oKSk7XG4gICAgZy5TdXJmYWNlQXRsYXMgPSBTdXJmYWNlQXRsYXM7XG4gICAgLyoqXG4gICAgICogRHluYW1pY0ZvbnTjgafkvb/nlKjjgZXjgozjgovjgIFTdXJmYWNlQXRsYXPjgpLnrqHnkIbjgZnjgovjgIJcbiAgICAgKi9cbiAgICB2YXIgU3VyZmFjZUF0bGFzU2V0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgICAgICBmdW5jdGlvbiBTdXJmYWNlQXRsYXNTZXQocGFyYW1zKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXJmYWNlQXRsYXNlcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fYXRsYXNHbHlwaHNUYWJsZSA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fcmVzb3VyY2VGYWN0b3J5ID0gcGFyYW1zLmdhbWUucmVzb3VyY2VGYWN0b3J5O1xuICAgICAgICAgICAgdGhpcy5fY3VycmVudEF0bGFzSW5kZXggPSAwO1xuICAgICAgICAgICAgdmFyIGhpbnQgPSBwYXJhbXMuaGludCA/IHBhcmFtcy5oaW50IDoge307XG4gICAgICAgICAgICB0aGlzLl9tYXhBdGxhc051bSA9IGhpbnQubWF4QXRsYXNOdW0gPyBoaW50Lm1heEF0bGFzTnVtIDogU3VyZmFjZUF0bGFzU2V0LklOSVRJQUxfTUFYX1NVUkZBQ0VBVExBU19OVU07XG4gICAgICAgICAgICAvLyDmjIflrprjgYzjgarjgYTjgajjgY3jgIHjgoTjgoTlj6TjgYTjg6Ljg5DjgqTjg6vjg4fjg5DjgqTjgrnjgafjgoLnorrkv53jgafjgY3jgovjgajoqIDjgo/jgozjgotcbiAgICAgICAgICAgIC8vIOe4puaoqjUxMnB444Gu44OG44Kv44K544OB44Oj5LiA5p6a44Gu44Ki44OI44Op44K544Gr44G+44Go44KB44KL5b2i44Gr44GZ44KLXG4gICAgICAgICAgICAvLyAyMDQ4eDIwNDjjgafnorrkv53jgZfjgabjgZfjgb7jgYbjgajjgIFFZGdlLCBDaHJvbWUg44Gr44Gm5Yem55CG44GM6Z2e5bi444Gr6YGF44GP44Gq44KL44GT44Go44GM44GC44KLXG4gICAgICAgICAgICBoaW50LmluaXRpYWxBdGxhc1dpZHRoID0gaGludC5pbml0aWFsQXRsYXNXaWR0aCA/IGhpbnQuaW5pdGlhbEF0bGFzV2lkdGggOiA1MTI7XG4gICAgICAgICAgICBoaW50LmluaXRpYWxBdGxhc0hlaWdodCA9IGhpbnQuaW5pdGlhbEF0bGFzSGVpZ2h0ID8gaGludC5pbml0aWFsQXRsYXNIZWlnaHQgOiA1MTI7XG4gICAgICAgICAgICBoaW50Lm1heEF0bGFzV2lkdGggPSBoaW50Lm1heEF0bGFzV2lkdGggPyBoaW50Lm1heEF0bGFzV2lkdGggOiA1MTI7XG4gICAgICAgICAgICBoaW50Lm1heEF0bGFzSGVpZ2h0ID0gaGludC5tYXhBdGxhc0hlaWdodCA/IGhpbnQubWF4QXRsYXNIZWlnaHQgOiA1MTI7XG4gICAgICAgICAgICB0aGlzLl9hdGxhc1NpemUgPSBjYWxjQXRsYXNTaXplKGhpbnQpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgU3VyZmFjZUF0bGFzU2V0LnByb3RvdHlwZS5fZGVsZXRlQXRsYXMgPSBmdW5jdGlvbiAoZGVsdGVOdW0pIHtcbiAgICAgICAgICAgIHZhciByZW1vdmVkT2JqZWN0ID0gdGhpcy5fcmVtb3ZlTGVhc3RGcmVxdWVudGx5VXNlZEF0bGFzKGRlbHRlTnVtKTtcbiAgICAgICAgICAgIHZhciByZW1vdmVkQXRsYXNlcyA9IHJlbW92ZWRPYmplY3Quc3VyZmFjZUF0bGFzZXM7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlbW92ZWRBdGxhc2VzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgcmVtb3ZlZEF0bGFzZXNbaV0uZGVzdHJveSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog5L2/55So5bqm44Gu5L2O44GE44K144O844OV44Kn44K544Ki44OI44Op44K544KS6YWN5YiX44GL44KJ5YmK6Zmk44GZ44KL44CCXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBTdXJmYWNlQXRsYXNTZXQucHJvdG90eXBlLl9yZW1vdmVMZWFzdEZyZXF1ZW50bHlVc2VkQXRsYXMgPSBmdW5jdGlvbiAocmVtb3ZlZE51bSkge1xuICAgICAgICAgICAgdmFyIHJlbW92ZWRBdGxhc2VzID0gW107XG4gICAgICAgICAgICB2YXIgcmVtb3ZlZEdseXBocyA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCByZW1vdmVkTnVtOyArK24pIHtcbiAgICAgICAgICAgICAgICB2YXIgbWluU2NvcmUgPSBOdW1iZXIuTUFYX1ZBTFVFO1xuICAgICAgICAgICAgICAgIHZhciBsb3dTY29yZUF0bGFzSW5kZXggPSAtMTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3N1cmZhY2VBdGxhc2VzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zdXJmYWNlQXRsYXNlc1tpXS5fYWNjZXNzU2NvcmUgPD0gbWluU2NvcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pblNjb3JlID0gdGhpcy5fc3VyZmFjZUF0bGFzZXNbaV0uX2FjY2Vzc1Njb3JlO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG93U2NvcmVBdGxhc0luZGV4ID0gaTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgcmVtb3ZlZEF0bGFzID0gdGhpcy5fc3VyZmFjZUF0bGFzZXMuc3BsaWNlKGxvd1Njb3JlQXRsYXNJbmRleCwgMSlbMF07XG4gICAgICAgICAgICAgICAgcmVtb3ZlZEF0bGFzZXMucHVzaChyZW1vdmVkQXRsYXMpO1xuICAgICAgICAgICAgICAgIHJlbW92ZWRHbHlwaHMucHVzaCh0aGlzLl9hdGxhc0dseXBoc1RhYmxlLnNwbGljZShsb3dTY29yZUF0bGFzSW5kZXgsIDEpWzBdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7IHN1cmZhY2VBdGxhc2VzOiByZW1vdmVkQXRsYXNlcywgZ2x5cGhzOiByZW1vdmVkR2x5cGhzIH07XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDnqbrjgY3poJjln5/jga7jgYLjgotTdXJmYWNlQXRsYXPjgpLmjqLntKLjgZnjgovjgIJcbiAgICAgICAgICogZ2x5cGjjgYzmjIHjgaTmg4XloLHjgpJTdXJmYWNlQXRsYXPjgbjnp7vli5XjgZfjgIHnp7vli5XjgZfjgZ9TdXJmYWNlQXRsYXPjga7mg4XloLHjgadnbHlwaOOCkue9ruOBjeaPm+OBiOOCi+OAglxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgU3VyZmFjZUF0bGFzU2V0LnByb3RvdHlwZS5fbW92ZUdseXBoU3VyZmFjZSA9IGZ1bmN0aW9uIChnbHlwaCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9zdXJmYWNlQXRsYXNlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9ICh0aGlzLl9jdXJyZW50QXRsYXNJbmRleCArIGkpICUgdGhpcy5fc3VyZmFjZUF0bGFzZXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZhciBhdGxhcyA9IHRoaXMuX3N1cmZhY2VBdGxhc2VzW2luZGV4XTtcbiAgICAgICAgICAgICAgICB2YXIgc2xvdCA9IGF0bGFzLmFkZFN1cmZhY2UoZ2x5cGgpO1xuICAgICAgICAgICAgICAgIGlmIChzbG90KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRBdGxhc0luZGV4ID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIGdseXBoLnN1cmZhY2UuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgICAgICBnbHlwaC5zdXJmYWNlID0gYXRsYXMuX3N1cmZhY2U7XG4gICAgICAgICAgICAgICAgICAgIGdseXBoLnggPSBzbG90Lng7XG4gICAgICAgICAgICAgICAgICAgIGdseXBoLnkgPSBzbG90Lnk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fYXRsYXNHbHlwaHNUYWJsZVtpbmRleF0pXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdGxhc0dseXBoc1RhYmxlW2luZGV4XSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdGxhc0dseXBoc1RhYmxlW2luZGV4XS5wdXNoKGdseXBoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF0bGFzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44K144O844OV44Kn44K544Ki44OI44Op44K544Gu5YaN5Ymy44KK5b2T44Gm44KS6KGM44GG44CCXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBTdXJmYWNlQXRsYXNTZXQucHJvdG90eXBlLl9yZWFsbG9jYXRlQXRsYXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fc3VyZmFjZUF0bGFzZXMubGVuZ3RoID49IHRoaXMuX21heEF0bGFzTnVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlbW92ZWRPYmplY3QgPSB0aGlzLl9yZW1vdmVMZWFzdEZyZXF1ZW50bHlVc2VkQXRsYXMoMSk7XG4gICAgICAgICAgICAgICAgdmFyIGF0bGFzID0gcmVtb3ZlZE9iamVjdC5zdXJmYWNlQXRsYXNlc1swXTtcbiAgICAgICAgICAgICAgICB2YXIgZ2x5cGhzID0gcmVtb3ZlZE9iamVjdC5nbHlwaHNbMF07XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBnbHlwaHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGdseXBoID0gZ2x5cGhzW2ldO1xuICAgICAgICAgICAgICAgICAgICBnbHlwaC5zdXJmYWNlID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgZ2x5cGguaXNTdXJmYWNlVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgZ2x5cGguX2F0bGFzID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXRsYXMuZGVzdHJveSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fc3VyZmFjZUF0bGFzZXMucHVzaCh0aGlzLl9yZXNvdXJjZUZhY3RvcnkuY3JlYXRlU3VyZmFjZUF0bGFzKHRoaXMuX2F0bGFzU2l6ZS53aWR0aCwgdGhpcy5fYXRsYXNTaXplLmhlaWdodCkpO1xuICAgICAgICAgICAgdGhpcy5fY3VycmVudEF0bGFzSW5kZXggPSB0aGlzLl9zdXJmYWNlQXRsYXNlcy5sZW5ndGggLSAxO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44K144O844OV44Kn44K544Ki44OI44Op44K544KS6L+95Yqg44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOS/neaMgeOBl+OBpuOBhOOCi19zdXJmYWNlQXRsYXNlc+OBruaVsOOBjOacgOWkp+WApOS7peS4iuOBruWgtOWQiOOAgeWJiumZpOOBl+OBpuOBi+OCiei/veWKoOOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga/jgIHjgZPjga5TdXJmYWNlQXRsYXNTZXTjgavntJDjgaXjgYTjgabjgYTjgosgYER5bmFtbmljRm9udGAg44GuIGBjb25zdHJ1Y3RvcmAg44GL44KJ5pqX6buZ44Gr5ZG844Gz5Ye644GV44KM44KL44CCXG4gICAgICAgICAqIOmAmuW4uOOAgeOCsuODvOODoOmWi+eZuuiAheOBjOOBk+OBruODoeOCveODg+ODieOCkuWRvOOBs+WHuuOBmeW/heimgeOBr+OBquOBhOOAglxuICAgICAgICAgKi9cbiAgICAgICAgU3VyZmFjZUF0bGFzU2V0LnByb3RvdHlwZS5hZGRBdGxhcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIHJlbW92ZUxlYXN0RnJlcXVlbnRseVVzZWRBdGxhcygp44Gn44Gv44CBU3VyZmFjZUF0bGFzI19hY2Nlc3NTY29yZeOBruS4gOeVquWwj+OBleOBhOWApOOCkuaMgeOBpFN1cmZhY2VBdGxhc+OCkuWJiumZpOOBmeOCi+OBn+OCgeOAgVxuICAgICAgICAgICAgLy8gU3VyZmFjZUF0bGFz5L2c5oiQ5pmC44GvX2FjY2Vzc1Njb3Jl44GvMOOBqOOBquOBo+OBpuOBhOOCi+OBn+OCgeOAgeWJiumZpOWIpOWumuW+jOOBq+S9nOaIkCzov73liqDlh6bnkIbjgpLooYzjgYbjgIJcbiAgICAgICAgICAgIGlmICh0aGlzLl9zdXJmYWNlQXRsYXNlcy5sZW5ndGggPj0gdGhpcy5fbWF4QXRsYXNOdW0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9kZWxldGVBdGxhcygxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3N1cmZhY2VBdGxhc2VzLnB1c2godGhpcy5fcmVzb3VyY2VGYWN0b3J5LmNyZWF0ZVN1cmZhY2VBdGxhcyh0aGlzLl9hdGxhc1NpemUud2lkdGgsIHRoaXMuX2F0bGFzU2l6ZS5oZWlnaHQpKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOW8leaVsOOBp+aMh+WumuOBleOCjOOBn2luZGV444Gu44K144O844OV44Kn44K544Ki44OI44Op44K544KS5Y+W5b6X44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBr+OAgeOBk+OBrlN1cmZhY2VBdGxhc1NldOOBq+e0kOOBpeOBhOOBpuOBhOOCiyBgRHluYW1uaWNGb250YCDjga4gYGdseXBoRm9yQ2hhcmFjdGVyKClgIOOBi+OCieaal+m7meOBq+WRvOOBs+WHuuOBleOCjOOCi+OAglxuICAgICAgICAgKiDpgJrluLjjgIHjgrLjg7zjg6DplovnmbrogIXjgYzjgZPjga7jg6Hjgr3jg4Pjg4njgpLlkbzjgbPlh7rjgZnlv4XopoHjga/jgarjgYTjgIJcbiAgICAgICAgICogQHBhcmFtIGluZGV4IOWPluW+l+WvvuixoeOBruOCpOODs+ODh+ODg+OCr+OCuVxuICAgICAgICAgKi9cbiAgICAgICAgU3VyZmFjZUF0bGFzU2V0LnByb3RvdHlwZS5nZXRBdGxhcyA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N1cmZhY2VBdGxhc2VzW2luZGV4XTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOCteODvOODleOCp+OCueOCouODiOODqeOCueOBruS/neaMgeaVsOOCkuWPluW+l+OBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga/jgIHjgZPjga5TdXJmYWNlQXRsYXNTZXTjgavntJDjgaXjgYTjgabjgYTjgosgYER5bmFtbmljRm9udGAg44GuIGBnbHlwaEZvckNoYXJhY3RlcigpYCDjgYvjgonmmpfpu5njgavlkbzjgbPlh7rjgZXjgozjgovjgIJcbiAgICAgICAgICog6YCa5bi444CB44Ky44O844Og6ZaL55m66ICF44GM44GT44Gu44Oh44K944OD44OJ44KS5ZG844Gz5Ye644GZ5b+F6KaB44Gv44Gq44GE44CCXG4gICAgICAgICAqL1xuICAgICAgICBTdXJmYWNlQXRsYXNTZXQucHJvdG90eXBlLmdldEF0bGFzTnVtID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N1cmZhY2VBdGxhc2VzLmxlbmd0aDtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOacgOWkp+OCteODvOODleOCp+OCueOCouODiOODqeOCueS/neaMgeaVsOWPluW+l+OBmeOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgU3VyZmFjZUF0bGFzU2V0LnByb3RvdHlwZS5nZXRNYXhBdGxhc051bSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYXhBdGxhc051bTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOacgOWkp+OCouODiOODqeOCueS/neaMgeaVsOioreWumuOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiDoqK3lrprjgZXjgozjgZ/lgKTjgYzjgIHnj77lnKjkv53mjIHjgZfjgabjgYTjgotfc3VyZmFjZUF0bGFzZXPjga7mlbDjgojjgorlpKfjgY3jgYTloLTlkIjjgIFcbiAgICAgICAgICogcmVtb3ZlTGVhc3RGcmVxdWVudGx5VXNlZEF0bGFzKCnjgafoqK3lrprlgKTjgb7jgafliYrpmaTjgZnjgovjgIJcbiAgICAgICAgICogQHBhcmFtIHZhbHVlIOioreWumuWApFxuICAgICAgICAgKi9cbiAgICAgICAgU3VyZmFjZUF0bGFzU2V0LnByb3RvdHlwZS5jaGFuZ2VNYXhBdGxhc051bSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5fbWF4QXRsYXNOdW0gPSB2YWx1ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9zdXJmYWNlQXRsYXNlcy5sZW5ndGggPiB0aGlzLl9tYXhBdGxhc051bSkge1xuICAgICAgICAgICAgICAgIHZhciBkaWZmID0gdGhpcy5fc3VyZmFjZUF0bGFzZXMubGVuZ3RoIC0gdGhpcy5fbWF4QXRsYXNOdW07XG4gICAgICAgICAgICAgICAgdGhpcy5fZGVsZXRlQXRsYXMoZGlmZik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjgrXjg7zjg5XjgqfjgrnjgqLjg4jjg6njgrnjga7jgrXjgqTjgrrjgpLlj5blvpfjgZnjgovjgIJcbiAgICAgICAgICpcbiAgICAgICAgICog44GT44Gu44Oh44K944OD44OJ44Gv44CB44GT44GuU3VyZmFjZUF0bGFzU2V044Gr57SQ44Gl44GE44Gm44GE44KLIGBEeW5hbW5pY0ZvbnRgIOOBriBgZ2x5cGhGb3JDaGFyYWN0ZXIoKWAg44GL44KJ5pqX6buZ44Gr5ZG844Gz5Ye644GV44KM44KL44CCXG4gICAgICAgICAqIOmAmuW4uOOAgeOCsuODvOODoOmWi+eZuuiAheOBjOOBk+OBruODoeOCveODg+ODieOCkuWRvOOBs+WHuuOBmeW/heimgeOBr+OBquOBhOOAglxuICAgICAgICAgKi9cbiAgICAgICAgU3VyZmFjZUF0bGFzU2V0LnByb3RvdHlwZS5nZXRBdGxhc1NpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fYXRsYXNTaXplO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog44K144O844OV44Kn44K544Ki44OI44Op44K544Gr44Kw44Oq44OV44KS6L+95Yqg44GZ44KL44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIOOBk+OBruODoeOCveODg+ODieOBr+OAgeOBk+OBrlN1cmZhY2VBdGxhc1NldOOBq+e0kOOBpeOBhOOBpuOBhOOCiyBgRHluYW1uaWNGb250YCDjga4gYGdseXBoRm9yQ2hhcmFjdGVyKClgIOOBi+OCieaal+m7meOBq+WRvOOBs+WHuuOBleOCjOOCi+OAglxuICAgICAgICAgKiDpgJrluLjjgIHjgrLjg7zjg6DplovnmbrogIXjgYzjgZPjga7jg6Hjgr3jg4Pjg4njgpLlkbzjgbPlh7rjgZnlv4XopoHjga/jgarjgYTjgIJcbiAgICAgICAgICogQHBhcmFtIGdseXBoIOOCsOODquODlVxuICAgICAgICAgKi9cbiAgICAgICAgU3VyZmFjZUF0bGFzU2V0LnByb3RvdHlwZS5hZGRHbHlwaCA9IGZ1bmN0aW9uIChnbHlwaCkge1xuICAgICAgICAgICAgLy8g44Kw44Oq44OV44GM44Ki44OI44Op44K544KI44KK5aSn44GN44GE44Go44GN44CBYF9hdGxhc1NldC5hZGRHbHlwaCgpYOOBr+WkseaVl+OBmeOCi+OAglxuICAgICAgICAgICAgLy8gYF9yZWFsbG9jYXRlQXRsYXMoKWDjgafjgqLjg4jjg6njgrnlopfjgoTjgZfjgabjgoLjgZPjgozjga/op6PmsbrjgafjgY3jgarjgYTjgIJcbiAgICAgICAgICAgIC8vIOeEoemnhOOBquepuuOBjemgmOWfn+aOoue0ouOBqOOCouODiOODqeOCueOBruWGjeeiuuS/neOCkumBv+OBkeOCi+OBn+OCgeOBq+OBk+OBk+OBp+ODquOCv+ODvOODs+OBmeOCi+OAglxuICAgICAgICAgICAgaWYgKGdseXBoLndpZHRoID4gdGhpcy5fYXRsYXNTaXplLndpZHRoIHx8IGdseXBoLmhlaWdodCA+IHRoaXMuX2F0bGFzU2l6ZS5oZWlnaHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBhdGxhcyA9IHRoaXMuX21vdmVHbHlwaFN1cmZhY2UoZ2x5cGgpO1xuICAgICAgICAgICAgaWYgKCFhdGxhcykge1xuICAgICAgICAgICAgICAgIC8vIHJldHJ5XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVhbGxvY2F0ZUF0bGFzKCk7XG4gICAgICAgICAgICAgICAgYXRsYXMgPSB0aGlzLl9tb3ZlR2x5cGhTdXJmYWNlKGdseXBoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhdGxhcztcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBruOCpOODs+OCueOCv+ODs+OCueOCkuegtOajhOOBmeOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgU3VyZmFjZUF0bGFzU2V0LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9zdXJmYWNlQXRsYXNlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3N1cmZhY2VBdGxhc2VzW2ldLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3N1cmZhY2VBdGxhc2VzID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fcmVzb3VyY2VGYWN0b3J5ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5fYXRsYXNHbHlwaHNUYWJsZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOBk+OBruOCpOODs+OCueOCv+ODs+OCueOBjOegtOajhOa4iOOBv+OBp+OBguOCi+OBi+OBqeOBhuOBi+OCkui/lOOBmeOAglxuICAgICAgICAgKi9cbiAgICAgICAgU3VyZmFjZUF0bGFzU2V0LnByb3RvdHlwZS5kZXN0cm95ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc3VyZmFjZUF0bGFzZXMgPT09IHVuZGVmaW5lZDtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN1cmZhY2VBdGxhc+acgOWkp+S/neaMgeaVsOWIneacn+WApFxuICAgICAgICAgKi9cbiAgICAgICAgU3VyZmFjZUF0bGFzU2V0LklOSVRJQUxfTUFYX1NVUkZBQ0VBVExBU19OVU0gPSAxMDtcbiAgICAgICAgcmV0dXJuIFN1cmZhY2VBdGxhc1NldDtcbiAgICB9KCkpO1xuICAgIGcuU3VyZmFjZUF0bGFzU2V0ID0gU3VyZmFjZUF0bGFzU2V0O1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIC8qKlxuICAgICAqIGBHYW1lI2F1ZGlvYCDjga7nrqHnkIbjgq/jg6njgrnjgIJcbiAgICAgKlxuICAgICAqIOikh+aVsOOBriBgQXVkaW9TeXN0ZW1gIOOBq+S4gOaLrOOBp+W/heimgeOBqueKtuaFi+ioreWumuOCkuihjOOBhuOAglxuICAgICAqIOacrOOCr+ODqeOCueOBruOCpOODs+OCueOCv+ODs+OCueOCkuOCsuODvOODoOmWi+eZuuiAheOBjOebtOaOpeeUn+aIkOOBmeOCi+OBk+OBqOOBr+OBquOBj+OAgeOCsuODvOODoOmWi+eZuuiAheOBjOWIqeeUqOOBmeOCi+W/heimgeOCguOBquOBhOOAglxuICAgICAqL1xuICAgIHZhciBBdWRpb1N5c3RlbU1hbmFnZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIEF1ZGlvU3lzdGVtTWFuYWdlcihnYW1lKSB7XG4gICAgICAgICAgICB0aGlzLl9nYW1lID0gZ2FtZTtcbiAgICAgICAgICAgIHRoaXMuX211dGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLl9wbGF5YmFja1JhdGUgPSAxLjA7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBBdWRpb1N5c3RlbU1hbmFnZXIucHJvdG90eXBlLl9yZXNldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuX211dGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLl9wbGF5YmFja1JhdGUgPSAxLjA7XG4gICAgICAgICAgICB2YXIgc3lzdGVtcyA9IHRoaXMuX2dhbWUuYXVkaW87XG4gICAgICAgICAgICBmb3IgKHZhciBpZCBpbiBzeXN0ZW1zKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFzeXN0ZW1zLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgc3lzdGVtc1tpZF0uX3Jlc2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgQXVkaW9TeXN0ZW1NYW5hZ2VyLnByb3RvdHlwZS5fc2V0TXV0ZWQgPSBmdW5jdGlvbiAobXV0ZWQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9tdXRlZCA9PT0gbXV0ZWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5fbXV0ZWQgPSBtdXRlZDtcbiAgICAgICAgICAgIHZhciBzeXN0ZW1zID0gdGhpcy5fZ2FtZS5hdWRpbztcbiAgICAgICAgICAgIGZvciAodmFyIGlkIGluIHN5c3RlbXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXN5c3RlbXMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBzeXN0ZW1zW2lkXS5fc2V0TXV0ZWQobXV0ZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIEF1ZGlvU3lzdGVtTWFuYWdlci5wcm90b3R5cGUuX3NldFBsYXliYWNrUmF0ZSA9IGZ1bmN0aW9uIChyYXRlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fcGxheWJhY2tSYXRlID09PSByYXRlKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHRoaXMuX3BsYXliYWNrUmF0ZSA9IHJhdGU7XG4gICAgICAgICAgICB2YXIgc3lzdGVtcyA9IHRoaXMuX2dhbWUuYXVkaW87XG4gICAgICAgICAgICBmb3IgKHZhciBpZCBpbiBzeXN0ZW1zKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFzeXN0ZW1zLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgc3lzdGVtc1tpZF0uX3NldFBsYXliYWNrUmF0ZShyYXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIEF1ZGlvU3lzdGVtTWFuYWdlcjtcbiAgICB9KCkpO1xuICAgIGcuQXVkaW9TeXN0ZW1NYW5hZ2VyID0gQXVkaW9TeXN0ZW1NYW5hZ2VyO1xufSkoZyB8fCAoZyA9IHt9KSk7XG52YXIgZztcbihmdW5jdGlvbiAoZykge1xuICAgIC8qKlxuICAgICAqIOaPj+eUu+aZguOBruWQiOaIkOaWueazleOAglxuICAgICAqL1xuICAgIHZhciBDb21wb3NpdGVPcGVyYXRpb247XG4gICAgKGZ1bmN0aW9uIChDb21wb3NpdGVPcGVyYXRpb24pIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOWFiOOBq+aPj+eUu+OBleOCjOOBn+mgmOWfn+OBruS4iuOBq+aPj+eUu+OBmeOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgQ29tcG9zaXRlT3BlcmF0aW9uW0NvbXBvc2l0ZU9wZXJhdGlvbltcIlNvdXJjZU92ZXJcIl0gPSAwXSA9IFwiU291cmNlT3ZlclwiO1xuICAgICAgICAvKipcbiAgICAgICAgICog5YWI44Gr5o+P55S744GV44KM44Gf6aCY5Z+f44Go6YeN44Gq44Gj44Gf6YOo5YiG44Gu44G/44KS5o+P55S744GZ44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBDb21wb3NpdGVPcGVyYXRpb25bQ29tcG9zaXRlT3BlcmF0aW9uW1wiU291cmNlQXRvcFwiXSA9IDFdID0gXCJTb3VyY2VBdG9wXCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlhYjjgavmj4/nlLvjgZXjgozjgZ/poJjln5/jgajph43jgarjgaPjgZ/pg6jliIbjga7oibLjgpLliqDnrpfjgZfjgabmj4/nlLvjgZnjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIENvbXBvc2l0ZU9wZXJhdGlvbltDb21wb3NpdGVPcGVyYXRpb25bXCJMaWdodGVyXCJdID0gMl0gPSBcIkxpZ2h0ZXJcIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOWFiOOBq+aPj+eUu+OBleOCjOOBn+mgmOWfn+OCkuWFqOOBpueEoeimluOBl+OBpuaPj+eUu+OBmeOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgQ29tcG9zaXRlT3BlcmF0aW9uW0NvbXBvc2l0ZU9wZXJhdGlvbltcIkNvcHlcIl0gPSAzXSA9IFwiQ29weVwiO1xuICAgICAgICAvKipcbiAgICAgICAgICog5YWI44Gr5o+P55S744GV44KM44Gf6aCY5Z+f44Go6YeN44Gq44Gj44Gf6YOo5YiG44Gr5o+P55S744KS6KGM44GE44CB44Gd44KM5Lul5aSW44Gu6YOo5YiG44KS6YCP5piO44Gr44GZ44KL44CCXG4gICAgICAgICAqIOeSsOWig+OBq+OCiOOCiuOAgeaPj+eUu+e1kOaenOOBjOWkp+OBjeOBj+eVsOOBquOCi+WPr+iDveaAp+OBjOOBguOCi+OBn+OCgeOAgeippumok+eahOWwjuWFpeOBp+OBguOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgQ29tcG9zaXRlT3BlcmF0aW9uW0NvbXBvc2l0ZU9wZXJhdGlvbltcIkV4cGVyaW1lbnRhbFNvdXJjZUluXCJdID0gNF0gPSBcIkV4cGVyaW1lbnRhbFNvdXJjZUluXCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlhYjjgavmj4/nlLvjgZXjgozjgZ/poJjln5/jgajph43jgarjgaPjgabjgYTjgarjgYTpg6jliIbjgavmj4/nlLvjgpLooYzjgYTjgIHjgZ3jgozku6XlpJbjga7pg6jliIbjgpLpgI/mmI7jgavjgZnjgovjgIJcbiAgICAgICAgICog55Kw5aKD44Gr44KI44KK44CB5o+P55S757WQ5p6c44GM5aSn44GN44GP55Ww44Gq44KL5Y+v6IO95oCn44GM44GC44KL44Gf44KB44CB6Kmm6aiT55qE5bCO5YWl44Gn44GC44KL44CCXG4gICAgICAgICAqL1xuICAgICAgICBDb21wb3NpdGVPcGVyYXRpb25bQ29tcG9zaXRlT3BlcmF0aW9uW1wiRXhwZXJpbWVudGFsU291cmNlT3V0XCJdID0gNV0gPSBcIkV4cGVyaW1lbnRhbFNvdXJjZU91dFwiO1xuICAgICAgICAvKipcbiAgICAgICAgICog5o+P55S744GZ44KL6aCY5Z+f44Gg44GR44KS6KGo56S644GX44CB5YWI44Gr5o+P55S744GV44KM44Gf6aCY5Z+f44Go6YeN44Gq44Gj44Gf6YOo5YiG44Gv5o+P55S75YWI44KS6KGo56S644GZ44KL44CCXG4gICAgICAgICAqIOeSsOWig+OBq+OCiOOCiuOAgeaPj+eUu+e1kOaenOOBjOWkp+OBjeOBj+eVsOOBquOCi+WPr+iDveaAp+OBjOOBguOCi+OBn+OCgeOAgeippumok+eahOWwjuWFpeOBp+OBguOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgQ29tcG9zaXRlT3BlcmF0aW9uW0NvbXBvc2l0ZU9wZXJhdGlvbltcIkV4cGVyaW1lbnRhbERlc3RpbmF0aW9uQXRvcFwiXSA9IDZdID0gXCJFeHBlcmltZW50YWxEZXN0aW5hdGlvbkF0b3BcIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOWFiOOBq+aPj+eUu+OBleOCjOOBn+mgmOWfn+OBqOmHjeOBquOBo+OBpuOBhOOBquOBhOmDqOWIhuOCkumAj+aYjuOBq+OBl+OAgemHjeOBquOBo+OBn+mDqOWIhuOBr+aPj+eUu+WFiOOCkuihqOekuuOBmeOCi+OAglxuICAgICAgICAgKiDnkrDlooPjgavjgojjgorjgIHmj4/nlLvntZDmnpzjgYzlpKfjgY3jgY/nlbDjgarjgovlj6/og73mgKfjgYzjgYLjgovjgZ/jgoHjgIHoqabpqJPnmoTlsI7lhaXjgafjgYLjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIENvbXBvc2l0ZU9wZXJhdGlvbltDb21wb3NpdGVPcGVyYXRpb25bXCJFeHBlcmltZW50YWxEZXN0aW5hdGlvbkluXCJdID0gN10gPSBcIkV4cGVyaW1lbnRhbERlc3RpbmF0aW9uSW5cIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOaPj+eUu+OBmeOCi+mgmOWfn+OCkumAj+aYjuOBq+OBmeOCi+OAglxuICAgICAgICAgKi9cbiAgICAgICAgQ29tcG9zaXRlT3BlcmF0aW9uW0NvbXBvc2l0ZU9wZXJhdGlvbltcIkRlc3RpbmF0aW9uT3V0XCJdID0gOF0gPSBcIkRlc3RpbmF0aW9uT3V0XCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlhYjjgavmj4/nlLvjgZXjgozjgZ/poJjln5/jga7kuIvjgavmj4/nlLvjgZnjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIENvbXBvc2l0ZU9wZXJhdGlvbltDb21wb3NpdGVPcGVyYXRpb25bXCJEZXN0aW5hdGlvbk92ZXJcIl0gPSA5XSA9IFwiRGVzdGluYXRpb25PdmVyXCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlhYjjgavmj4/nlLvjgZXjgozjgZ/poJjln5/jgajph43jgarjgaPjgZ/pg6jliIbjga7jgb/pgI/mmI7jgavjgZnjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIENvbXBvc2l0ZU9wZXJhdGlvbltDb21wb3NpdGVPcGVyYXRpb25bXCJYb3JcIl0gPSAxMF0gPSBcIlhvclwiO1xuICAgIH0pKENvbXBvc2l0ZU9wZXJhdGlvbiA9IGcuQ29tcG9zaXRlT3BlcmF0aW9uIHx8IChnLkNvbXBvc2l0ZU9wZXJhdGlvbiA9IHt9KSk7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog44Kw44Oq44OV44OV44Kh44Kv44OI44Oq44CCXG4gICAgICpcbiAgICAgKiBgRHluYW1pY0ZvbnRgIOOBr+OBk+OCjOOCkuWIqeeUqOOBl+OBpuOCsOODquODleOCkueUn+aIkOOBmeOCi+OAglxuICAgICAqXG4gICAgICog5pys44Kv44Op44K544Gu44Kk44Oz44K544K/44Oz44K544KS44Ky44O844Og6ZaL55m66ICF44GM55u05o6l55Sf5oiQ44GZ44KL44GT44Go44Gv44Gq44GP44CB44Ky44O844Og6ZaL55m66ICF44GM5Yip55So44GZ44KL5b+F6KaB44KC44Gq44GE44CCXG4gICAgICovXG4gICAgdmFyIEdseXBoRmFjdG9yeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGBHbHlwaEZhY3RvcnlgIOOCkueUn+aIkOOBmeOCi+OAglxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gZm9udEZhbWlseSDjg5Xjgqnjg7Pjg4jjg5XjgqHjg5/jg6rjgIJnLkZvbnRGYW1pbHnjga7lrprnvqnjgZnjgovlrprmlbDjgIHjg5Xjgqnjg7Pjg4jlkI3jgIHjgb7jgZ/jga/jgZ3jgozjgonjga7phY3liJdcbiAgICAgICAgICogQHBhcmFtIGZvbnRTaXplIOODleOCqeODs+ODiOOCteOCpOOCulxuICAgICAgICAgKiBAcGFyYW0gYmFzZWxpbmVIZWlnaHQg44OZ44O844K544Op44Kk44Oz44Gu6auY44GVXG4gICAgICAgICAqIEBwYXJhbSBzdHJva2VXaWR0aCDovKrpg63luYVcbiAgICAgICAgICogQHBhcmFtIHN0cm9rZUNvbG9yIOi8qumDreiJslxuICAgICAgICAgKiBAcGFyYW0gc3Ryb2tlT25seSDovKrpg63jgpLmj4/nlLvjgZnjgovjgYvlkKbjgYtcbiAgICAgICAgICogQHBhcmFtIGZvbnRXZWlnaHQg44OV44Kp44Oz44OI44Km44Kn44Kk44OIXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBHbHlwaEZhY3RvcnkoZm9udEZhbWlseSwgZm9udFNpemUsIGJhc2VsaW5lSGVpZ2h0LCBmb250Q29sb3IsIHN0cm9rZVdpZHRoLCBzdHJva2VDb2xvciwgc3Ryb2tlT25seSwgZm9udFdlaWdodCkge1xuICAgICAgICAgICAgaWYgKGJhc2VsaW5lSGVpZ2h0ID09PSB2b2lkIDApIHsgYmFzZWxpbmVIZWlnaHQgPSBmb250U2l6ZTsgfVxuICAgICAgICAgICAgaWYgKGZvbnRDb2xvciA9PT0gdm9pZCAwKSB7IGZvbnRDb2xvciA9IFwiYmxhY2tcIjsgfVxuICAgICAgICAgICAgaWYgKHN0cm9rZVdpZHRoID09PSB2b2lkIDApIHsgc3Ryb2tlV2lkdGggPSAwOyB9XG4gICAgICAgICAgICBpZiAoc3Ryb2tlQ29sb3IgPT09IHZvaWQgMCkgeyBzdHJva2VDb2xvciA9IFwiYmxhY2tcIjsgfVxuICAgICAgICAgICAgaWYgKHN0cm9rZU9ubHkgPT09IHZvaWQgMCkgeyBzdHJva2VPbmx5ID0gZmFsc2U7IH1cbiAgICAgICAgICAgIGlmIChmb250V2VpZ2h0ID09PSB2b2lkIDApIHsgZm9udFdlaWdodCA9IGcuRm9udFdlaWdodC5Ob3JtYWw7IH1cbiAgICAgICAgICAgIHRoaXMuZm9udEZhbWlseSA9IGZvbnRGYW1pbHk7XG4gICAgICAgICAgICB0aGlzLmZvbnRTaXplID0gZm9udFNpemU7XG4gICAgICAgICAgICB0aGlzLmZvbnRXZWlnaHQgPSBmb250V2VpZ2h0O1xuICAgICAgICAgICAgdGhpcy5iYXNlbGluZUhlaWdodCA9IGJhc2VsaW5lSGVpZ2h0O1xuICAgICAgICAgICAgdGhpcy5mb250Q29sb3IgPSBmb250Q29sb3I7XG4gICAgICAgICAgICB0aGlzLnN0cm9rZVdpZHRoID0gc3Ryb2tlV2lkdGg7XG4gICAgICAgICAgICB0aGlzLnN0cm9rZUNvbG9yID0gc3Ryb2tlQ29sb3I7XG4gICAgICAgICAgICB0aGlzLnN0cm9rZU9ubHkgPSBzdHJva2VPbmx5O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBHbHlwaEZhY3Rvcnk7XG4gICAgfSgpKTtcbiAgICBnLkdseXBoRmFjdG9yeSA9IEdseXBoRmFjdG9yeTtcbn0pKGcgfHwgKGcgPSB7fSkpO1xudmFyIGc7XG4oZnVuY3Rpb24gKGcpIHtcbiAgICAvKipcbiAgICAgKiDjgrfjg7zjg7PjgavkuI7jgYjjgovjg63jg7zjgqvjg6vjg4bjgqPjg4Pjgq/jga7nqK7poZ5cbiAgICAgKi9cbiAgICB2YXIgTG9jYWxUaWNrTW9kZTtcbiAgICAoZnVuY3Rpb24gKExvY2FsVGlja01vZGUpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOODreODvOOCq+ODq+ODhuOCo+ODg+OCr+OCkuWPl+OBkeWPluOCieOBquOBhOOAglxuICAgICAgICAgKiDpgJrluLjjga4o6Z2e44Ot44O844Kr44OrKeOCt+ODvOODs+OAglxuICAgICAgICAgKi9cbiAgICAgICAgTG9jYWxUaWNrTW9kZVtMb2NhbFRpY2tNb2RlW1wiTm9uTG9jYWxcIl0gPSAwXSA9IFwiTm9uTG9jYWxcIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOODreODvOOCq+ODq+ODhuOCo+ODg+OCr+OBruOBv+WPl+OBkeWPluOCi+OAglxuICAgICAgICAgKiDjg63jg7zjgqvjg6vjgrfjg7zjg7PjgIJcbiAgICAgICAgICovXG4gICAgICAgIExvY2FsVGlja01vZGVbTG9jYWxUaWNrTW9kZVtcIkZ1bGxMb2NhbFwiXSA9IDFdID0gXCJGdWxsTG9jYWxcIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOa2iOWMluOBmeOBueOBjeODhuOCo+ODg+OCr+OBjOOBquOBhOWgtOWQiOOBq+ODreODvOOCq+ODq+ODhuOCo+ODg+OCr+OCkuWPl+OBkeWPluOCi+OAglxuICAgICAgICAgKiDjg63jg7zjgqvjg6vjg4bjgqPjg4Pjgq/oo5zplpPjgrfjg7zjg7PjgIJcbiAgICAgICAgICovXG4gICAgICAgIExvY2FsVGlja01vZGVbTG9jYWxUaWNrTW9kZVtcIkludGVycG9sYXRlTG9jYWxcIl0gPSAyXSA9IFwiSW50ZXJwb2xhdGVMb2NhbFwiO1xuICAgIH0pKExvY2FsVGlja01vZGUgPSBnLkxvY2FsVGlja01vZGUgfHwgKGcuTG9jYWxUaWNrTW9kZSA9IHt9KSk7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog44OK44Kk44Oz44OR44OD44OB44Gr44KI44KL5o+P55S75Yem55CG44KS5o+Q5L6b44GZ44KLU3VyZmFjZUVmZmVjdG9y44CCXG4gICAgICpcbiAgICAgKiDjgZPjga5TdXJmYWNlRWZmZWN0b3Ljga/jgIHnlLvlg4/ntKDmnZDjga7mi6HlpKfjg7vnuK7lsI/jgavjgYrjgYTjgabjgIzmnqDjgI3jga7ooajnj77jgpLlrp/nj77jgZnjgovjgoLjga7jgafjgYLjgovjgIJcbiAgICAgKiDnlLvlg4/jga7kuIrkuIvlt6blj7Pjga7jgIzmnqDjgI3pg6jliIbjga7luYXjg7vpq5jjgZXjgpLmuKHjgZnjgZPjgajjgafjgIHkuIrkuIvjga7jgIzmnqDjgI3jgpLnuKbjgavlvJXjgY3lu7bjgbDjgZnjgZPjgajjgarjgY/jgIFcbiAgICAgKiDjgb7jgZ/lt6blj7Pjga7jgIzmnqDjgI3jgpLmqKrjgavlvJXjgY3lu7bjgbDjgZnjgZPjgajjgarjgY/nlLvlg4/jgpLku7vmhI/jgrXjgqTjgrrjgavmi6HlpKfjg7vnuK7lsI/jgafjgY3jgovjgIJcbiAgICAgKiDjgrLjg7zjg6DjgavjgYrjgZHjgovjg6Hjg4Pjgrvjg7zjgrjjgqbjgqPjg7Pjg4njgqbjgoTjg4DjgqTjgqLjg63jgrDjga7ooajnj77jgavliKnnlKjjgZnjgovjgZPjgajjgpLmg7PlrprjgZfjgabjgYTjgovjgIJcbiAgICAgKi9cbiAgICB2YXIgTmluZVBhdGNoU3VyZmFjZUVmZmVjdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogYE5pbmVQYXRjaFN1cmZhY2VFZmZlY3RvcmAg44Gu44Kk44Oz44K544K/44Oz44K544KS55Sf5oiQ44GZ44KL44CCXG4gICAgICAgICAqIEBwYXJhbSBnYW1lIOOBk+OBruOCpOODs+OCueOCv+ODs+OCueOBjOWxnuOBmeOCiyBgR2FtZWBcbiAgICAgICAgICogQHBhcmFtIGJvcmRlcldpZHRoIOS4iuS4i+W3puWPs+OBruOAjOaLoeWkp+OBl+OBquOBhOOAjemgmOWfn+OBruWkp+OBjeOBleOAguOBmeOBueOBpuWQjOOBmOWApOOBquOCieaVsOWApOS4gOOBpOOCkua4oeOBmeOBk+OBqOOBjOOBp+OBjeOCi+OAguecgeeVpeOBleOCjOOBn+WgtOWQiOOAgSBgNGBcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIE5pbmVQYXRjaFN1cmZhY2VFZmZlY3RvcihnYW1lLCBib3JkZXJXaWR0aCkge1xuICAgICAgICAgICAgaWYgKGJvcmRlcldpZHRoID09PSB2b2lkIDApIHsgYm9yZGVyV2lkdGggPSA0OyB9XG4gICAgICAgICAgICB0aGlzLmdhbWUgPSBnYW1lO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBib3JkZXJXaWR0aCA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuYm9yZGVyV2lkdGggPSB7IHRvcDogYm9yZGVyV2lkdGgsIGJvdHRvbTogYm9yZGVyV2lkdGgsIGxlZnQ6IGJvcmRlcldpZHRoLCByaWdodDogYm9yZGVyV2lkdGggfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuYm9yZGVyV2lkdGggPSBib3JkZXJXaWR0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICog5oyH5a6a44Gu5aSn44GN44GV44Gr5ouh5aSn44O757iu5bCP44GX44Gf5o+P55S757WQ5p6c44GuIGBTdXJmYWNlYCDjgpLnlJ/miJDjgZfjgabov5TjgZnjgILoqbPntLDjga8gYFN1cmZhY2VFZmZlY3RvciNyZW5kZXJgIOOBrumgheOCkuWPgueFp+OAglxuICAgICAgICAgKi9cbiAgICAgICAgTmluZVBhdGNoU3VyZmFjZUVmZmVjdG9yLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoc3JjU3VyZmFjZSwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICAgICAgdmFyIGlzQ3JlYXRlU3VyZmFjZSA9IHRydWU7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX3N1cmZhY2UgfHwgdGhpcy5fc3VyZmFjZS53aWR0aCAhPT0gd2lkdGggfHxcbiAgICAgICAgICAgICAgICB0aGlzLl9zdXJmYWNlLmhlaWdodCAhPT0gaGVpZ2h0IHx8IHRoaXMuX2JlZm9yZVNyY1N1cmZhY2UgIT09IHNyY1N1cmZhY2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdXJmYWNlID0gdGhpcy5nYW1lLnJlc291cmNlRmFjdG9yeS5jcmVhdGVTdXJmYWNlKE1hdGguY2VpbCh3aWR0aCksIE1hdGguY2VpbChoZWlnaHQpKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9iZWZvcmVTcmNTdXJmYWNlID0gc3JjU3VyZmFjZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlzQ3JlYXRlU3VyZmFjZSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlbmRlcmVyID0gdGhpcy5fc3VyZmFjZS5yZW5kZXJlcigpO1xuICAgICAgICAgICAgcmVuZGVyZXIuYmVnaW4oKTtcbiAgICAgICAgICAgIGlmICghaXNDcmVhdGVTdXJmYWNlKVxuICAgICAgICAgICAgICAgIHJlbmRlcmVyLmNsZWFyKCk7XG4gICAgICAgICAgICAvLyAgICB4MCAgeDEgICAgICAgICAgICAgICAgICAgICAgICAgIHgyXG4gICAgICAgICAgICAvLyB5MCArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rXG4gICAgICAgICAgICAvLyAgICB8IDEgfCAgICAgICAgICAgICA1ICAgICAgICAgICAgIHwgMiB8XG4gICAgICAgICAgICAvLyB5MSB8LS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLS18XG4gICAgICAgICAgICAvLyAgICB8ICAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICB8XG4gICAgICAgICAgICAvLyAgICB8IDcgfCAgICAgICAgICAgICA5ICAgICAgICAgICAgIHwgOCB8XG4gICAgICAgICAgICAvLyAgICB8ICAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICB8XG4gICAgICAgICAgICAvLyB5MiB8LS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLS18XG4gICAgICAgICAgICAvLyAgICB8IDMgfCAgICAgICAgICAgICA2ICAgICAgICAgICAgIHwgNCB8XG4gICAgICAgICAgICAvLyAgICArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gMS00OiDmi6HnuK7nhKHjgZdcbiAgICAgICAgICAgIC8vIDUtNjog5rC05bmz5pa55ZCR44G45ouh57iuXG4gICAgICAgICAgICAvLyA3LTg6IOWeguebtOaWueWQkeOBuOaLoee4rlxuICAgICAgICAgICAgLy8gOSAgOiDlhajmlrnlkJHjgbjmi6HnuK5cbiAgICAgICAgICAgIHZhciBzeDEgPSB0aGlzLmJvcmRlcldpZHRoLmxlZnQ7XG4gICAgICAgICAgICB2YXIgc3gyID0gc3JjU3VyZmFjZS53aWR0aCAtIHRoaXMuYm9yZGVyV2lkdGgucmlnaHQ7XG4gICAgICAgICAgICB2YXIgc3kxID0gdGhpcy5ib3JkZXJXaWR0aC50b3A7XG4gICAgICAgICAgICB2YXIgc3kyID0gc3JjU3VyZmFjZS5oZWlnaHQgLSB0aGlzLmJvcmRlcldpZHRoLmJvdHRvbTtcbiAgICAgICAgICAgIHZhciBkeDEgPSB0aGlzLmJvcmRlcldpZHRoLmxlZnQ7XG4gICAgICAgICAgICB2YXIgZHgyID0gd2lkdGggLSB0aGlzLmJvcmRlcldpZHRoLnJpZ2h0O1xuICAgICAgICAgICAgdmFyIGR5MSA9IHRoaXMuYm9yZGVyV2lkdGgudG9wO1xuICAgICAgICAgICAgdmFyIGR5MiA9IGhlaWdodCAtIHRoaXMuYm9yZGVyV2lkdGguYm90dG9tO1xuICAgICAgICAgICAgLy8gRHJhdyBjb3JuZXJzXG4gICAgICAgICAgICB2YXIgc3JjQ29ybmVycyA9IFtcbiAgICAgICAgICAgICAgICB7IHg6IDAsIHk6IDAsIHdpZHRoOiB0aGlzLmJvcmRlcldpZHRoLmxlZnQsIGhlaWdodDogdGhpcy5ib3JkZXJXaWR0aC50b3AgfSxcbiAgICAgICAgICAgICAgICB7IHg6IHN4MiwgeTogMCwgd2lkdGg6IHRoaXMuYm9yZGVyV2lkdGgucmlnaHQsIGhlaWdodDogdGhpcy5ib3JkZXJXaWR0aC50b3AgfSxcbiAgICAgICAgICAgICAgICB7IHg6IDAsIHk6IHN5Miwgd2lkdGg6IHRoaXMuYm9yZGVyV2lkdGgubGVmdCwgaGVpZ2h0OiB0aGlzLmJvcmRlcldpZHRoLmJvdHRvbSB9LFxuICAgICAgICAgICAgICAgIHsgeDogc3gyLCB5OiBzeTIsIHdpZHRoOiB0aGlzLmJvcmRlcldpZHRoLnJpZ2h0LCBoZWlnaHQ6IHRoaXMuYm9yZGVyV2lkdGguYm90dG9tIH1cbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICB2YXIgZGVzdENvcm5lcnMgPSBbXG4gICAgICAgICAgICAgICAgeyB4OiAwLCB5OiAwIH0sXG4gICAgICAgICAgICAgICAgeyB4OiBkeDIsIHk6IDAgfSxcbiAgICAgICAgICAgICAgICB7IHg6IDAsIHk6IGR5MiB9LFxuICAgICAgICAgICAgICAgIHsgeDogZHgyLCB5OiBkeTIgfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIHZhciBpID0gMDtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzcmNDb3JuZXJzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGMgPSBzcmNDb3JuZXJzW2ldO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnNhdmUoKTtcbiAgICAgICAgICAgICAgICByZW5kZXJlci50cmFuc2xhdGUoZGVzdENvcm5lcnNbaV0ueCwgZGVzdENvcm5lcnNbaV0ueSk7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuZHJhd0ltYWdlKHNyY1N1cmZhY2UsIGMueCwgYy55LCBjLndpZHRoLCBjLmhlaWdodCwgMCwgMCk7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIucmVzdG9yZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gRHJhdyBib3JkZXJzXG4gICAgICAgICAgICB2YXIgc3JjQm9yZGVycyA9IFtcbiAgICAgICAgICAgICAgICB7IHg6IHN4MSwgeTogMCwgd2lkdGg6IHN4MiAtIHN4MSwgaGVpZ2h0OiB0aGlzLmJvcmRlcldpZHRoLnRvcCB9LFxuICAgICAgICAgICAgICAgIHsgeDogMCwgeTogc3kxLCB3aWR0aDogdGhpcy5ib3JkZXJXaWR0aC5sZWZ0LCBoZWlnaHQ6IHN5MiAtIHN5MSB9LFxuICAgICAgICAgICAgICAgIHsgeDogc3gyLCB5OiBzeTEsIHdpZHRoOiB0aGlzLmJvcmRlcldpZHRoLnJpZ2h0LCBoZWlnaHQ6IHN5MiAtIHN5MSB9LFxuICAgICAgICAgICAgICAgIHsgeDogc3gxLCB5OiBzeTIsIHdpZHRoOiBzeDIgLSBzeDEsIGhlaWdodDogdGhpcy5ib3JkZXJXaWR0aC5ib3R0b20gfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIHZhciBkZXN0Qm9yZGVycyA9IFtcbiAgICAgICAgICAgICAgICB7IHg6IGR4MSwgeTogMCwgd2lkdGg6IGR4MiAtIGR4MSwgaGVpZ2h0OiB0aGlzLmJvcmRlcldpZHRoLnRvcCB9LFxuICAgICAgICAgICAgICAgIHsgeDogMCwgeTogZHkxLCB3aWR0aDogdGhpcy5ib3JkZXJXaWR0aC5sZWZ0LCBoZWlnaHQ6IGR5MiAtIGR5MSB9LFxuICAgICAgICAgICAgICAgIHsgeDogZHgyLCB5OiBkeTEsIHdpZHRoOiB0aGlzLmJvcmRlcldpZHRoLnJpZ2h0LCBoZWlnaHQ6IGR5MiAtIGR5MSB9LFxuICAgICAgICAgICAgICAgIHsgeDogZHgxLCB5OiBkeTIsIHdpZHRoOiBkeDIgLSBkeDEsIGhlaWdodDogdGhpcy5ib3JkZXJXaWR0aC5ib3R0b20gfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzcmNCb3JkZXJzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHMgPSBzcmNCb3JkZXJzW2ldO1xuICAgICAgICAgICAgICAgIHZhciBkID0gZGVzdEJvcmRlcnNbaV07XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuc2F2ZSgpO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRyYW5zbGF0ZShkLngsIGQueSk7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIudHJhbnNmb3JtKFtkLndpZHRoIC8gcy53aWR0aCwgMCwgMCwgZC5oZWlnaHQgLyBzLmhlaWdodCwgMCwgMF0pO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLmRyYXdJbWFnZShzcmNTdXJmYWNlLCBzLngsIHMueSwgcy53aWR0aCwgcy5oZWlnaHQsIDAsIDApO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnJlc3RvcmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIERyYXcgY2VudGVyXG4gICAgICAgICAgICB2YXIgc3cgPSBzeDIgLSBzeDE7XG4gICAgICAgICAgICB2YXIgc2ggPSBzeTIgLSBzeTE7XG4gICAgICAgICAgICB2YXIgZHcgPSBkeDIgLSBkeDE7XG4gICAgICAgICAgICB2YXIgZGggPSBkeTIgLSBkeTE7XG4gICAgICAgICAgICByZW5kZXJlci5zYXZlKCk7XG4gICAgICAgICAgICByZW5kZXJlci50cmFuc2xhdGUoZHgxLCBkeTEpO1xuICAgICAgICAgICAgcmVuZGVyZXIudHJhbnNmb3JtKFtkdyAvIHN3LCAwLCAwLCBkaCAvIHNoLCAwLCAwXSk7XG4gICAgICAgICAgICByZW5kZXJlci5kcmF3SW1hZ2Uoc3JjU3VyZmFjZSwgc3gxLCBzeTEsIHN3LCBzaCwgMCwgMCk7XG4gICAgICAgICAgICByZW5kZXJlci5yZXN0b3JlKCk7XG4gICAgICAgICAgICByZW5kZXJlci5lbmQoKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdXJmYWNlO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gTmluZVBhdGNoU3VyZmFjZUVmZmVjdG9yO1xuICAgIH0oKSk7XG4gICAgZy5OaW5lUGF0Y2hTdXJmYWNlRWZmZWN0b3IgPSBOaW5lUGF0Y2hTdXJmYWNlRWZmZWN0b3I7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog44OR44K544Om44O844OG44Kj44Oq44OG44Kj44CCXG4gICAgICog6YCa5bi444CB44Ky44O844Og6ZaL55m66ICF44GM44OV44Kh44Kk44Or44OR44K544KS5omx44GG44GT44Go44Gv44Gq44GP44CB44GT44Gu44Oi44K444Ol44O844Or44Gu44Oh44K944OD44OJ44KS5ZG844Gz5Ye644GZ5b+F6KaB44Gv44Gq44GE44CCXG4gICAgICovXG4gICAgdmFyIFBhdGhVdGlsO1xuICAgIChmdW5jdGlvbiAoUGF0aFV0aWwpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOS6jOOBpOOBruODkeOCueaWh+Wtl+WIl+OCkuOBpOOBquOBjuOAgeebuOWvvuODkeOCueihqOePviAoXCIuXCIsIFwiLi5cIikg44KS6Kej5rG644GX44Gm6L+U44GZ44CCXG4gICAgICAgICAqIEBwYXJhbSBiYXNlIOW3pui+uuODkeOCueaWh+Wtl+WIlyAo5YWI6aCt44GuIFwiLi9cIiDjgpLpmaTjgY3jgIFcIi5cIiwgXCIuLlwiIOOCkuWQq+OCk+OBp+OBr+OBquOCieOBquOBhClcbiAgICAgICAgICogQHBhcmFtIHBhdGgg5Y+z6L6644OR44K55paH5a2X5YiXXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiByZXNvbHZlUGF0aChiYXNlLCBwYXRoKSB7XG4gICAgICAgICAgICBmdW5jdGlvbiBzcGxpdChzdHIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0ID0gc3RyLnNwbGl0KFwiL1wiKTtcbiAgICAgICAgICAgICAgICBpZiAocmV0W3JldC5sZW5ndGggLSAxXSA9PT0gXCJcIilcbiAgICAgICAgICAgICAgICAgICAgcmV0LnBvcCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGF0aCA9PT0gXCJcIilcbiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTtcbiAgICAgICAgICAgIHZhciBiYXNlQ29tcG9uZW50cyA9IFBhdGhVdGlsLnNwbGl0UGF0aChiYXNlKTtcbiAgICAgICAgICAgIHZhciBwYXJ0cyA9IHNwbGl0KGJhc2VDb21wb25lbnRzLnBhdGgpLmNvbmNhdChzcGxpdChwYXRoKSk7XG4gICAgICAgICAgICB2YXIgcmVzb2x2ZWQgPSBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFydCA9IHBhcnRzW2ldO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAocGFydCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiLi5cIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb3BwZWQgPSByZXNvbHZlZC5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3BwZWQgPT09IHVuZGVmaW5lZCB8fCBwb3BwZWQgPT09IFwiXCIgfHwgcG9wcGVkID09PSBcIi5cIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJQYXRoVXRpbC5yZXNvbHZlUGF0aDogaW52YWxpZCBhcmd1bWVudHNcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIi5cIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNvbHZlZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlZC5wdXNoKFwiLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiXCI6IC8vIOe1tuWvvuODkeOCuVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZWQgPSBbXCJcIl07XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVkLnB1c2gocGFydCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGJhc2VDb21wb25lbnRzLmhvc3QgKyByZXNvbHZlZC5qb2luKFwiL1wiKTtcbiAgICAgICAgfVxuICAgICAgICBQYXRoVXRpbC5yZXNvbHZlUGF0aCA9IHJlc29sdmVQYXRoO1xuICAgICAgICAvKipcbiAgICAgICAgICog44OR44K55paH5a2X5YiX44GL44KJ44OH44Kj44Os44Kv44OI44Oq5ZCN6YOo5YiG44KS5YiH44KK5Ye644GX44Gm6L+U44GZ44CCXG4gICAgICAgICAqIEBwYXJhbSBwYXRoIOODkeOCueaWh+Wtl+WIl1xuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gcmVzb2x2ZURpcm5hbWUocGF0aCkge1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gcGF0aC5sYXN0SW5kZXhPZihcIi9cIik7XG4gICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKVxuICAgICAgICAgICAgICAgIHJldHVybiBwYXRoO1xuICAgICAgICAgICAgcmV0dXJuIHBhdGguc3Vic3RyKDAsIGluZGV4KTtcbiAgICAgICAgfVxuICAgICAgICBQYXRoVXRpbC5yZXNvbHZlRGlybmFtZSA9IHJlc29sdmVEaXJuYW1lO1xuICAgICAgICAvKipcbiAgICAgICAgICog44OR44K55paH5a2X5YiX44GL44KJ5ouh5by15a2Q6YOo5YiG44KS5YiH44KK5Ye644GX44Gm6L+U44GZ44CCXG4gICAgICAgICAqIEBwYXJhbSBwYXRoIOODkeOCueaWh+Wtl+WIl1xuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gcmVzb2x2ZUV4dG5hbWUocGF0aCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IHBhdGgubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgICAgICAgICB2YXIgYyA9IHBhdGguY2hhckF0KGkpO1xuICAgICAgICAgICAgICAgIGlmIChjID09PSBcIi5cIikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGF0aC5zdWJzdHIoaSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGMgPT09IFwiL1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICB9XG4gICAgICAgIFBhdGhVdGlsLnJlc29sdmVFeHRuYW1lID0gcmVzb2x2ZUV4dG5hbWU7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDjg5HjgrnmloflrZfliJfjgYvjgonjgIFub2RlLmpzIOOBq+OBiuOBhOOBpiByZXF1aXJlKCkg44Gu5o6i57Si56+E5Zuy44Gr44Gq44KL44OR44K544Gu6YWN5YiX44KS5L2c5oiQ44GX44Gm6L+U44GZ44CCXG4gICAgICAgICAqIEBwYXJhbSBwYXRoIOODh+OCo+ODrOOCr+ODiOODquOCkuihqOOBmeODkeOCueaWh+Wtl+WIl1xuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gbWFrZU5vZGVNb2R1bGVQYXRocyhwYXRoKSB7XG4gICAgICAgICAgICB2YXIgcGF0aENvbXBvbmVudHMgPSBQYXRoVXRpbC5zcGxpdFBhdGgocGF0aCk7XG4gICAgICAgICAgICB2YXIgaG9zdCA9IHBhdGhDb21wb25lbnRzLmhvc3Q7XG4gICAgICAgICAgICBwYXRoID0gcGF0aENvbXBvbmVudHMucGF0aDtcbiAgICAgICAgICAgIGlmIChwYXRoW3BhdGgubGVuZ3RoIC0gMV0gPT09IFwiL1wiKSB7XG4gICAgICAgICAgICAgICAgcGF0aCA9IHBhdGguc2xpY2UoMCwgcGF0aC5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBwYXJ0cyA9IHBhdGguc3BsaXQoXCIvXCIpO1xuICAgICAgICAgICAgdmFyIGZpcnN0RGlyID0gcGFydHMuaW5kZXhPZihcIm5vZGVfbW9kdWxlc1wiKTtcbiAgICAgICAgICAgIHZhciByb290ID0gKGZpcnN0RGlyID4gMCkgPyBmaXJzdERpciAtIDEgOiAwO1xuICAgICAgICAgICAgdmFyIGRpcnMgPSBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBwYXJ0cy5sZW5ndGggLSAxOyBpID49IHJvb3Q7IC0taSkge1xuICAgICAgICAgICAgICAgIGlmIChwYXJ0c1tpXSA9PT0gXCJub2RlX21vZHVsZXNcIilcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgdmFyIGRpclBhcnRzID0gcGFydHMuc2xpY2UoMCwgaSArIDEpO1xuICAgICAgICAgICAgICAgIGRpclBhcnRzLnB1c2goXCJub2RlX21vZHVsZXNcIik7XG4gICAgICAgICAgICAgICAgdmFyIGRpciA9IGRpclBhcnRzLmpvaW4oXCIvXCIpO1xuICAgICAgICAgICAgICAgIGRpcnMucHVzaChob3N0ICsgZGlyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkaXJzO1xuICAgICAgICB9XG4gICAgICAgIFBhdGhVdGlsLm1ha2VOb2RlTW9kdWxlUGF0aHMgPSBtYWtlTm9kZU1vZHVsZVBhdGhzO1xuICAgICAgICAvKipcbiAgICAgICAgICog5LiO44GI44KJ44KM44Gf44OR44K55paH5a2X5YiX44Gr5LiO44GI44KJ44KM44Gf5ouh5by15a2Q44KS6L+95Yqg44GZ44KL44CCXG4gICAgICAgICAqIEBwYXJhbSBwYXRoIOODkeOCueaWh+Wtl+WIl1xuICAgICAgICAgKiBAcGFyYW0gZXh0IOi/veWKoOOBmeOCi+aLoeW8teWtkFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gYWRkRXh0bmFtZShwYXRoLCBleHQpIHtcbiAgICAgICAgICAgIHZhciBpbmRleCA9IHBhdGguaW5kZXhPZihcIj9cIik7XG4gICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhdGggKyBcIi5cIiArIGV4dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGhvZ2U/cXVlcnkgPT4gaG9nZS5leHQ/cXVlcnlcbiAgICAgICAgICAgIHJldHVybiBwYXRoLnN1YnN0cmluZygwLCBpbmRleCkgKyBcIi5cIiArIGV4dCArIHBhdGguc3Vic3RyaW5nKGluZGV4LCBwYXRoLmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgUGF0aFV0aWwuYWRkRXh0bmFtZSA9IGFkZEV4dG5hbWU7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDkuI7jgYjjgonjgozjgZ/jg5HjgrnmloflrZfliJfjgYvjgonjg5vjgrnjg4jjgpLliIfjgorlh7rjgZnjgIJcbiAgICAgICAgICogQHBhcmFtIHBhdGgg44OR44K55paH5a2X5YiXXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBzcGxpdFBhdGgocGF0aCkge1xuICAgICAgICAgICAgdmFyIGhvc3QgPSBcIlwiO1xuICAgICAgICAgICAgdmFyIGRvdWJsZVNsYXNoSW5kZXggPSBwYXRoLmluZGV4T2YoXCIvL1wiKTtcbiAgICAgICAgICAgIGlmIChkb3VibGVTbGFzaEluZGV4ID49IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgaG9zdFNsYXNoSW5kZXggPSBwYXRoLmluZGV4T2YoXCIvXCIsIGRvdWJsZVNsYXNoSW5kZXggKyAyKTsgLy8gMiA9PT0gXCIvL1wiLmxlbmd0aFxuICAgICAgICAgICAgICAgIGlmIChob3N0U2xhc2hJbmRleCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGhvc3QgPSBwYXRoLnNsaWNlKDAsIGhvc3RTbGFzaEluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgcGF0aCA9IHBhdGguc2xpY2UoaG9zdFNsYXNoSW5kZXgpOyAvLyDlhYjpoK3jgasgXCIvXCIg44KS5q6L44GX44Gm57W25a++44OR44K55omx44GE44GV44Gb44KLXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBob3N0ID0gcGF0aDtcbiAgICAgICAgICAgICAgICAgICAgcGF0aCA9IFwiL1wiOyAvLyBwYXRo5YWo5L2T44GM44Ob44K544OI44Gg44Gj44Gf44Gu44Gn44CB57W25a++44OR44K55omx44GE44GV44Gb44KLXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaG9zdCA9IFwiXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4geyBob3N0OiBob3N0LCBwYXRoOiBwYXRoIH07XG4gICAgICAgIH1cbiAgICAgICAgUGF0aFV0aWwuc3BsaXRQYXRoID0gc3BsaXRQYXRoO1xuICAgIH0pKFBhdGhVdGlsID0gZy5QYXRoVXRpbCB8fCAoZy5QYXRoVXRpbCA9IHt9KSk7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog5paH5a2X5YiX5o+P55S744Gu44OV44Kp44Oz44OI44OV44Kh44Of44Oq44CCXG4gICAgICog54++44OQ44O844K444On44Oz44GuYWthc2hpYy1lbmdpbmXjga4gYFN5c3RlbUxhYmVsYCDlj4rjgbMgYER5bmFtaWNGb250YCDjgavjgYrjgYTjgabjgIHjgZPjga7lgKTjga7mjIflrprjga/lj4LogIPlgKTjgavpgY7jgY7jgarjgYTjgIJcbiAgICAgKiDjgZ3jga7jgZ/jgoHjgIEg44Gd44KM44KJ44Gr44GK44GE44GmICdmb250RmFtaWx5YCDjg5fjg63jg5Hjg4bjgqPjgpLmjIflrprjgZfjgZ/pmpvjgIHlrp/ooYznkrDlooPjgavjgojjgaPjgabjga/nhKHoppbjgZXjgozjgovkuovjgYzjgYLjgorjgYjjgovjgIJcbiAgICAgKi9cbiAgICB2YXIgRm9udEZhbWlseTtcbiAgICAoZnVuY3Rpb24gKEZvbnRGYW1pbHkpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOCteODs+OCu+ODquODleS9k+OAgu+8re+8syDvvLDjgrTjgrfjg4Pjgq/nrYlcbiAgICAgICAgICovXG4gICAgICAgIEZvbnRGYW1pbHlbRm9udEZhbWlseVtcIlNhbnNTZXJpZlwiXSA9IDBdID0gXCJTYW5zU2VyaWZcIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOOCu+ODquODleS9k+OAgu+8re+8syDmmI7mnJ3nrYlcbiAgICAgICAgICovXG4gICAgICAgIEZvbnRGYW1pbHlbRm9udEZhbWlseVtcIlNlcmlmXCJdID0gMV0gPSBcIlNlcmlmXCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDnrYnluYXjgILvvK3vvLMg44K044K344OD44Kv562JXG4gICAgICAgICAqL1xuICAgICAgICBGb250RmFtaWx5W0ZvbnRGYW1pbHlbXCJNb25vc3BhY2VcIl0gPSAyXSA9IFwiTW9ub3NwYWNlXCI7XG4gICAgfSkoRm9udEZhbWlseSA9IGcuRm9udEZhbWlseSB8fCAoZy5Gb250RmFtaWx5ID0ge30pKTtcbn0pKGcgfHwgKGcgPSB7fSkpO1xudmFyIGc7XG4oZnVuY3Rpb24gKGcpIHtcbiAgICAvKipcbiAgICAgKiDmloflrZfliJfmj4/nlLvjga7jg5njg7zjgrnjg6njgqTjg7PjgIJcbiAgICAgKi9cbiAgICB2YXIgVGV4dEJhc2VsaW5lO1xuICAgIChmdW5jdGlvbiAoVGV4dEJhc2VsaW5lKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBlbSBzcXVhcmXjga7kuIrjgIJcbiAgICAgICAgICovXG4gICAgICAgIFRleHRCYXNlbGluZVtUZXh0QmFzZWxpbmVbXCJUb3BcIl0gPSAwXSA9IFwiVG9wXCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBlbSBzcXVhcmXjga7kuK3lpK7jgIJcbiAgICAgICAgICovXG4gICAgICAgIFRleHRCYXNlbGluZVtUZXh0QmFzZWxpbmVbXCJNaWRkbGVcIl0gPSAxXSA9IFwiTWlkZGxlXCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDmqJnmupbnmoTjgajjgZXjgozjgovjg5njg7zjgrnjg6njgqTjg7PjgIJCb3R0b23jgojjgorjgoTjgoTkuIrmlrnjgIJcbiAgICAgICAgICovXG4gICAgICAgIFRleHRCYXNlbGluZVtUZXh0QmFzZWxpbmVbXCJBbHBoYWJldGljXCJdID0gMl0gPSBcIkFscGhhYmV0aWNcIjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGVtIHNxdWFyZeOBruS4i+OAglxuICAgICAgICAgKi9cbiAgICAgICAgVGV4dEJhc2VsaW5lW1RleHRCYXNlbGluZVtcIkJvdHRvbVwiXSA9IDNdID0gXCJCb3R0b21cIjtcbiAgICB9KShUZXh0QmFzZWxpbmUgPSBnLlRleHRCYXNlbGluZSB8fCAoZy5UZXh0QmFzZWxpbmUgPSB7fSkpO1xuICAgIC8qKlxuICAgICAqIOOCt+OCueODhuODoOODleOCqeODs+ODiOOBp+aWh+Wtl+WIl+OCkuaPj+eUu+OBmeOCi+OCqOODs+ODhuOCo+ODhuOCo+OAglxuICAgICAqXG4gICAgICog44GT44GT44Gn44GE44GG44K344K544OG44Og44OV44Kp44Oz44OI44Go44Gv44CBYWthc2hpYy1lbmdpbmXlrp/ooYznkrDlooPjgafjga7jg4fjg5Xjgqnjg6vjg4jjg5Xjgqnjg7Pjg4jjgafjgYLjgovjgIJcbiAgICAgKiDjgrfjgrnjg4bjg6Djg5Xjgqnjg7Pjg4jjga/lrp/ooYznkrDlooPjgavjgojjgaPjgabnlbDjgarjgovloLTlkIjjgYzjgYLjgovjgILjgZfjgZ/jgYzjgaPjgaYgYFN5c3RlbUxhYmVsYCDjgavjgojjgovmj4/nlLvntZDmnpzjgYzlkITlrp/ooYznkrDlooPjgaflkIzkuIDjgajjgarjgovjgZPjgajjga/kv53oqLzjgZXjgozjgarjgYTjgIJcbiAgICAgKiDjgZ3jga7ku6Pjgo/jgorjgasgYFN5c3RlbUxhYmVsYCDjga/jgIFBc3NldOOBruiqreOBv+i+vOOBv+OBquOBl+OBp+aWh+Wtl+WIl+OCkuaPj+eUu+OBmeOCi+apn+iDveOCkuaPkOS+m+OBmeOCi+OAglxuICAgICAqXG4gICAgICog57W15paH5a2X44Gq44Gp44KS5ZCr44KA44Om44OL44Kz44O844OJ5paH5a2X5YiX44KS44GZ44G544GmIGBCaXRtYXBGb250YCDjgafmj5DkvpvjgZnjgovkuovjga/pm6PjgZfjgYTjgZPjgajjgYvjgonjgIFcbiAgICAgKiDjgZPjga7jgq/jg6njgrnjga/jgIHkuovlrp/kuIpha2FzaGljLWVuZ2luZeOBq+OBiuOBhOOBpuODpuODvOOCtuWFpeWKm+aWh+Wtl+WIl+OCkuWPluOCiuaJseOBhuWUr+S4gOOBruaJi+auteOBp+OBguOCi+OAglxuICAgICAqXG4gICAgICogYFN5c3RlbUxhYmVsYCDjga/jg6bjg7zjgrbjgqTjg7Pjgr/jg6njgq/jgrfjg6fjg7Pjga7lr77osaHjgavlkKvjgoHjgovjgbnjgY3jgafjga/jgarjgYTjgIJcbiAgICAgKiDkuIrov7Djga7jgajjgYrjgorjgIHlkITlrp/ooYznkrDlooPjgafmj4/nlLvlhoXlrrnjga7lkIzkuIDmgKfjgYzkv53oqLzjgZXjgozjgarjgYTjgZ/jgoHjgafjgYLjgovjgIJcbiAgICAgKiDjg6bjg7zjgrblhaXlipvmloflrZfliJfjgpLlkKvjgoHjgIEgYFN5c3RlbUxhYmVsYCDjgavjgojjgaPjgabmj5DnpLrjgZXjgozjgovmg4XloLHjga/jgIHlj4LogIPnqIvluqbjgavooajnpLrjgZXjgozjgovjgarjganjgavnlZnjgoHjgovjgbnjgY3jgafjgYLjgovjgIJcbiAgICAgKiDlhbfkvZPnmoTjgavjga8gYFN5c3RlbUxhYmVsYCDjgpIgYHRvdWNoYWJsZWAg44Gr44GZ44KL44CBIGBVdGlsLmNyZWF0ZVNwcml0ZUZyb21FKClgIOOBruWvvuixoeOBq+WQq+OCgeOCi+OBquOBqeOCkuihjOOBhuOBueOBjeOBp+OBr+OBquOBhOOAglxuICAgICAqIOODnOOCv+ODs+OBruOCiOOBhuOBquOCqOODs+ODhuOCo+ODhuOCo+OBruOCreODo+ODl+OCt+ODp+ODs+mDqOWIhuOCguWHuuadpeOCi+mZkOOCiiBgTGFiZWxgIOOCkueUqOOBhOOCi+OBueOBjeOBp+OAgSBgU3lzdGVtTGFiZWxgIOOCkuWIqeeUqOOBmeOCi+OBueOBjeOBp+OBr+OBquOBhOOAglxuICAgICAqXG4gICAgICog44G+44Gf44CBYWthc2hpYy1lbmdpbmXjga8gYFN5c3RlbUxhYmVsYCDjga7mj4/nlLvpoIbjgpLkv53oqLzjgZfjgarjgYTjgIJcbiAgICAgKiDlrp/ooYznkrDlooPjgavjgojjgaPjgabjgIHmrKHjga7jganjgaHjgonjgYvjgYzmiJDnq4vjgZnjgos6XG4gICAgICogKiBgU3lzdGVtTGFiZWxgIOOBr+OAgeS7luOCqOODs+ODhuOCo+ODhuOCo+WQjOanmOOBqyBgU2NlbmUjY2hpbGRyZW5gIOOBruODhOODquODvOani+mAoOOBrnByZS1vcmRlcumghuOBp+aPj+OBi+OCjOOCi+OAglxuICAgICAqICogYFN5c3RlbUxhYmVsYCDjga/jgIHku5bjga7lhajjgqjjg7Pjg4bjgqPjg4bjgqPjgYzmj4/nlLvjgZXjgozjgZ/lvozjgaso55S76Z2i5pyA5YmN6Z2i44GrKeaPj+eUu+OBleOCjOOCi+OAglxuICAgICAqXG4gICAgICog5a6f6KGM55Kw5aKD44Gr5L6d5a2Y44GX44Gq44GE44Ky44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44Gr44Gv44CBYFN5c3RlbUxhYmVsYCDjga/jgZPjga7jgYTjgZrjgozjgafjgoLmraPjgZfjgY/li5XkvZzjgZnjgovjgojjgYbjgavliKnnlKjjgZXjgozjgovlv4XopoHjgYzjgYLjgovjgIJcbiAgICAgKi9cbiAgICB2YXIgU3lzdGVtTGFiZWwgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhTeXN0ZW1MYWJlbCwgX3N1cGVyKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOWQhOeoruODkeODqeODoeODvOOCv+OCkuaMh+WumuOBl+OBpiBgU3lzdGVtTGFiZWxgIOOBruOCpOODs+OCueOCv+ODs+OCueOCkueUn+aIkOOBmeOCi+OAglxuICAgICAgICAgKiBAcGFyYW0gcGFyYW0g44GT44Gu44Ko44Oz44OG44Kj44OG44Kj44Gr5oyH5a6a44GZ44KL44OR44Op44Oh44O844K/XG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBTeXN0ZW1MYWJlbChwYXJhbSkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcGFyYW0pIHx8IHRoaXM7XG4gICAgICAgICAgICBfdGhpcy50ZXh0ID0gcGFyYW0udGV4dDtcbiAgICAgICAgICAgIF90aGlzLmZvbnRTaXplID0gcGFyYW0uZm9udFNpemU7XG4gICAgICAgICAgICBfdGhpcy50ZXh0QWxpZ24gPSAoXCJ0ZXh0QWxpZ25cIiBpbiBwYXJhbSkgPyBwYXJhbS50ZXh0QWxpZ24gOiBnLlRleHRBbGlnbi5MZWZ0O1xuICAgICAgICAgICAgX3RoaXMudGV4dEJhc2VsaW5lID0gKFwidGV4dEJhc2VsaW5lXCIgaW4gcGFyYW0pID8gcGFyYW0udGV4dEJhc2VsaW5lIDogVGV4dEJhc2VsaW5lLkFscGhhYmV0aWM7XG4gICAgICAgICAgICBfdGhpcy5tYXhXaWR0aCA9IHBhcmFtLm1heFdpZHRoO1xuICAgICAgICAgICAgX3RoaXMudGV4dENvbG9yID0gKFwidGV4dENvbG9yXCIgaW4gcGFyYW0pID8gcGFyYW0udGV4dENvbG9yIDogXCJibGFja1wiO1xuICAgICAgICAgICAgX3RoaXMuZm9udEZhbWlseSA9IChcImZvbnRGYW1pbHlcIiBpbiBwYXJhbSkgPyBwYXJhbS5mb250RmFtaWx5IDogZy5Gb250RmFtaWx5LlNhbnNTZXJpZjtcbiAgICAgICAgICAgIF90aGlzLnN0cm9rZVdpZHRoID0gKFwic3Ryb2tlV2lkdGhcIiBpbiBwYXJhbSkgPyBwYXJhbS5zdHJva2VXaWR0aCA6IDA7XG4gICAgICAgICAgICBfdGhpcy5zdHJva2VDb2xvciA9IChcInN0cm9rZUNvbG9yXCIgaW4gcGFyYW0pID8gcGFyYW0uc3Ryb2tlQ29sb3IgOiBcImJsYWNrXCI7XG4gICAgICAgICAgICBfdGhpcy5zdHJva2VPbmx5ID0gKFwic3Ryb2tlT25seVwiIGluIHBhcmFtKSA/IHBhcmFtLnN0cm9rZU9ubHkgOiBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcztcbiAgICAgICAgfVxuICAgICAgICBTeXN0ZW1MYWJlbC5wcm90b3R5cGUucmVuZGVyU2VsZiA9IGZ1bmN0aW9uIChyZW5kZXJlciwgY2FtZXJhKSB7XG4gICAgICAgICAgICBpZiAodGhpcy50ZXh0KSB7XG4gICAgICAgICAgICAgICAgdmFyIG9mZnNldFg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLnRleHRBbGlnbikge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIGcuVGV4dEFsaWduLlJpZ2h0OlxuICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0WCA9IHRoaXMud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBnLlRleHRBbGlnbi5DZW50ZXI6XG4gICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXRYID0gdGhpcy53aWR0aCAvIDI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldFggPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZW5kZXJlci5kcmF3U3lzdGVtVGV4dCh0aGlzLnRleHQsIG9mZnNldFgsIDAsIHRoaXMubWF4V2lkdGgsIHRoaXMuZm9udFNpemUsIHRoaXMudGV4dEFsaWduLCB0aGlzLnRleHRCYXNlbGluZSwgdGhpcy50ZXh0Q29sb3IsIHRoaXMuZm9udEZhbWlseSwgdGhpcy5zdHJva2VXaWR0aCwgdGhpcy5zdHJva2VDb2xvciwgdGhpcy5zdHJva2VPbmx5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gU3lzdGVtTGFiZWw7XG4gICAgfShnLkUpKTtcbiAgICBnLlN5c3RlbUxhYmVsID0gU3lzdGVtTGFiZWw7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog44OG44Kt44K544OI44Gu5o+P55S75L2N572u44CCXG4gICAgICovXG4gICAgdmFyIFRleHRBbGlnbjtcbiAgICAoZnVuY3Rpb24gKFRleHRBbGlnbikge1xuICAgICAgICAvKipcbiAgICAgICAgICog5bem5a+E44Gb44CCXG4gICAgICAgICAqL1xuICAgICAgICBUZXh0QWxpZ25bVGV4dEFsaWduW1wiTGVmdFwiXSA9IDBdID0gXCJMZWZ0XCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDkuK3lpK7lr4TjgZvjgIJcbiAgICAgICAgICovXG4gICAgICAgIFRleHRBbGlnbltUZXh0QWxpZ25bXCJDZW50ZXJcIl0gPSAxXSA9IFwiQ2VudGVyXCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlj7Plr4TjgZvjgIJcbiAgICAgICAgICovXG4gICAgICAgIFRleHRBbGlnbltUZXh0QWxpZ25bXCJSaWdodFwiXSA9IDJdID0gXCJSaWdodFwiO1xuICAgIH0pKFRleHRBbGlnbiA9IGcuVGV4dEFsaWduIHx8IChnLlRleHRBbGlnbiA9IHt9KSk7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICog5pmC6ZaT57WM6YGO44Gu5aWR5qmfKOODhuOCo+ODg+OCrynjgpLjganjga7jgojjgYbjgavnlJ/miJDjgZnjgovjgYvjgIJcbiAgICAgKiDjgZ/jgaDjgZfjg63jg7zjgqvjg6vjg4bjgqPjg4Pjgq8o44Ot44O844Kr44Or44K344O844Oz44Gu6ZaT44Gq44Gp44Gu44CM5ZCE44OX44Os44Kk44Ok44O86ZaT44Gn54us56uL44Gq5pmC6ZaT57WM6YGO5Yem55CG44CNKeOBr+OBk+OBruODouODvOODieOBruW9semfv+OCkuWPl+OBkeOBquOBhOOAglxuICAgICAqL1xuICAgIHZhciBUaWNrR2VuZXJhdGlvbk1vZGU7XG4gICAgKGZ1bmN0aW9uIChUaWNrR2VuZXJhdGlvbk1vZGUpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIOWun+mam+OBruaZgumWk+e1jOmBjuOBq+W+k+OBhuOAglxuICAgICAgICAgKi9cbiAgICAgICAgVGlja0dlbmVyYXRpb25Nb2RlW1RpY2tHZW5lcmF0aW9uTW9kZVtcIkJ5Q2xvY2tcIl0gPSAwXSA9IFwiQnlDbG9ja1wiO1xuICAgICAgICAvKipcbiAgICAgICAgICog5pmC6ZaT57WM6YGO44Gv5piO56S655qE44Gr6KaB5rGC44GZ44KL44CCXG4gICAgICAgICAqIOOBk+OBruWApOOCkueUqOOBhOOCiyBgU2NlbmVgIOOBrumWk+OBr+OAgSBgR2FtZSNyYWlzZVRpY2soKWAg44KS5ZG844Gz5Ye644GV44Gq44GE6ZmQ44KK5pmC6ZaT57WM6YGO44GM6LW344GN44Gq44GE44CCXG4gICAgICAgICAqL1xuICAgICAgICBUaWNrR2VuZXJhdGlvbk1vZGVbVGlja0dlbmVyYXRpb25Nb2RlW1wiTWFudWFsXCJdID0gMV0gPSBcIk1hbnVhbFwiO1xuICAgIH0pKFRpY2tHZW5lcmF0aW9uTW9kZSA9IGcuVGlja0dlbmVyYXRpb25Nb2RlIHx8IChnLlRpY2tHZW5lcmF0aW9uTW9kZSA9IHt9KSk7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLy8gQ29weXJpZ2h0IChjKSAyMDE0IEFuZHJlYXMgTWFkc2VuICYgRW1pbCBCYXlcbiAgICAvLyBGcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9BbmRyZWFzTWFkc2VuL3hvcnNoaWZ0XG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL0FuZHJlYXNNYWRzZW4veG9yc2hpZnQvYmxvYi9tYXN0ZXIvTElDRU5TRS5tZFxuICAgIC8vIEFycmFuZ2VkIGJ5IERXQU5HTyBDby4sIEx0ZC5cbiAgICB2YXIgWG9yc2hpZnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIFhvcnNoaWZ0KHNlZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdFN0YXRlKHNlZWQpO1xuICAgICAgICB9XG4gICAgICAgIFhvcnNoaWZ0LmRlc2VyaWFsaXplID0gZnVuY3Rpb24gKHNlcikge1xuICAgICAgICAgICAgdmFyIHJldCA9IG5ldyBYb3JzaGlmdCgwKTtcbiAgICAgICAgICAgIHJldC5fc3RhdGUwVSA9IHNlci5fc3RhdGUwVTtcbiAgICAgICAgICAgIHJldC5fc3RhdGUwTCA9IHNlci5fc3RhdGUwTDtcbiAgICAgICAgICAgIHJldC5fc3RhdGUxVSA9IHNlci5fc3RhdGUxVTtcbiAgICAgICAgICAgIHJldC5fc3RhdGUxTCA9IHNlci5fc3RhdGUxTDtcbiAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgIH07XG4gICAgICAgIC8vIOOCt+ODvOODieWApOOBjDHjgaTjga7loLTlkIjjgavjganjga7jgojjgYbjgavjgZfjgabliJ3mnJ/nirbmhYvjgpLlrprnvqnjgZnjgovjgYvjga/nibnjgavlrprjgb7jgaPjgabjgYTjgarjgYRcbiAgICAgICAgLy8g44GT44Gu44Kz44O844OJ44Gv44Ot44K444OD44Kv55qE44Gq6KOP5LuY44GR44Gv54Sh44GE44GM5o6h55So5L6L44GM5aSa44GE44Gf44KB44Gr5o6h55So44GX44GfXG4gICAgICAgIC8vIOS7peS4i+aOoeeUqOS+i1xuICAgICAgICAvLyBodHRwOi8vbWVtZS5iaW9sb2d5LnRvaG9rdS5hYy5qcC9rbGFiby13aWtpL2luZGV4LnBocD9jbWQ9cmVhZCZwYWdlPSVCNyVENyVCQiVCQiVCNSVBMSUyRkMlMkIlMkIjeTkxOWE3ZTFcbiAgICAgICAgLy8gaHR0cDovL2hleGFkcml2ZS5zYmxvLmpwL2FydGljbGUvNjM2NjA3NzUuaHRtbFxuICAgICAgICAvLyBodHRwOi8vbWVtZS5iaW9sb2d5LnRvaG9rdS5hYy5qcC9zdHVkZW50cy9pd2FzYWtpL2N4eC9yYW5kb20uaHRtbCN4b3JzaGlmdFxuICAgICAgICBYb3JzaGlmdC5wcm90b3R5cGUuaW5pdFN0YXRlID0gZnVuY3Rpb24gKHNlZWQpIHtcbiAgICAgICAgICAgIHZhciBmYWN0b3IgPSAxODEyNDMzMjUzO1xuICAgICAgICAgICAgc2VlZCA9IGZhY3RvciAqIChzZWVkIF4gKHNlZWQgPj4gMzApKSArIDE7XG4gICAgICAgICAgICB0aGlzLl9zdGF0ZTBVID0gc2VlZDtcbiAgICAgICAgICAgIHNlZWQgPSBmYWN0b3IgKiAoc2VlZCBeIChzZWVkID4+IDMwKSkgKyAyO1xuICAgICAgICAgICAgdGhpcy5fc3RhdGUwTCA9IHNlZWQ7XG4gICAgICAgICAgICBzZWVkID0gZmFjdG9yICogKHNlZWQgXiAoc2VlZCA+PiAzMCkpICsgMztcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlMVUgPSBzZWVkO1xuICAgICAgICAgICAgc2VlZCA9IGZhY3RvciAqIChzZWVkIF4gKHNlZWQgPj4gMzApKSArIDQ7XG4gICAgICAgICAgICB0aGlzLl9zdGF0ZTFMID0gc2VlZDtcbiAgICAgICAgfTtcbiAgICAgICAgWG9yc2hpZnQucHJvdG90eXBlLnJhbmRvbUludCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzMVUgPSB0aGlzLl9zdGF0ZTBVO1xuICAgICAgICAgICAgdmFyIHMxTCA9IHRoaXMuX3N0YXRlMEw7XG4gICAgICAgICAgICB2YXIgczBVID0gdGhpcy5fc3RhdGUxVTtcbiAgICAgICAgICAgIHZhciBzMEwgPSB0aGlzLl9zdGF0ZTFMO1xuICAgICAgICAgICAgdGhpcy5fc3RhdGUwVSA9IHMwVTtcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlMEwgPSBzMEw7XG4gICAgICAgICAgICB2YXIgdDFVID0gMDtcbiAgICAgICAgICAgIHZhciB0MUwgPSAwO1xuICAgICAgICAgICAgdmFyIHQyVSA9IDA7XG4gICAgICAgICAgICB2YXIgdDJMID0gMDtcbiAgICAgICAgICAgIHZhciBhMSA9IDIzO1xuICAgICAgICAgICAgdmFyIG0xID0gMHhGRkZGRkZGRiA8PCAoMzIgLSBhMSk7XG4gICAgICAgICAgICB0MVUgPSAoczFVIDw8IGExKSB8ICgoczFMICYgbTEpID4+PiAoMzIgLSBhMSkpO1xuICAgICAgICAgICAgdDFMID0gczFMIDw8IGExO1xuICAgICAgICAgICAgczFVID0gczFVIF4gdDFVO1xuICAgICAgICAgICAgczFMID0gczFMIF4gdDFMO1xuICAgICAgICAgICAgdDFVID0gczFVIF4gczBVO1xuICAgICAgICAgICAgdDFMID0gczFMIF4gczBMO1xuICAgICAgICAgICAgdmFyIGEyID0gMTc7XG4gICAgICAgICAgICB2YXIgbTIgPSAweEZGRkZGRkZGID4+PiAoMzIgLSBhMik7XG4gICAgICAgICAgICB0MlUgPSBzMVUgPj4+IGEyO1xuICAgICAgICAgICAgdDJMID0gKHMxTCA+Pj4gYTIpIHwgKChzMVUgJiBtMikgPDwgKDMyIC0gYTIpKTtcbiAgICAgICAgICAgIHQxVSA9IHQxVSBeIHQyVTtcbiAgICAgICAgICAgIHQxTCA9IHQxTCBeIHQyTDtcbiAgICAgICAgICAgIHZhciBhMyA9IDI2O1xuICAgICAgICAgICAgdmFyIG0zID0gMHhGRkZGRkZGRiA+Pj4gKDMyIC0gYTMpO1xuICAgICAgICAgICAgdDJVID0gczBVID4+PiBhMztcbiAgICAgICAgICAgIHQyTCA9IChzMEwgPj4+IGEzKSB8ICgoczBVICYgbTMpIDw8ICgzMiAtIGEzKSk7XG4gICAgICAgICAgICB0MVUgPSB0MVUgXiB0MlU7XG4gICAgICAgICAgICB0MUwgPSB0MUwgXiB0Mkw7XG4gICAgICAgICAgICB0aGlzLl9zdGF0ZTFVID0gdDFVO1xuICAgICAgICAgICAgdGhpcy5fc3RhdGUxTCA9IHQxTDtcbiAgICAgICAgICAgIHZhciBzdW1MID0gKHQxTCA+Pj4gMCkgKyAoczBMID4+PiAwKTtcbiAgICAgICAgICAgIHQyVSA9ICh0MVUgKyBzMFUgKyAoc3VtTCAvIDIgPj4+IDMxKSkgPj4+IDA7XG4gICAgICAgICAgICB0MkwgPSBzdW1MID4+PiAwO1xuICAgICAgICAgICAgcmV0dXJuIFt0MlUsIHQyTF07XG4gICAgICAgIH07XG4gICAgICAgIFhvcnNoaWZ0LnByb3RvdHlwZS5yYW5kb20gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdDIgPSB0aGlzLnJhbmRvbUludCgpO1xuICAgICAgICAgICAgcmV0dXJuICh0MlswXSAqIDQyOTQ5NjcyOTYgKyB0MlsxXSkgLyAxODQ0Njc0NDA3MzcwOTU1MTYxNjtcbiAgICAgICAgfTtcbiAgICAgICAgWG9yc2hpZnQucHJvdG90eXBlLm5leHRJbnQgPSBmdW5jdGlvbiAobWluLCBzdXApIHtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKG1pbiArIHRoaXMucmFuZG9tKCkgKiAoc3VwIC0gbWluKSk7XG4gICAgICAgIH07XG4gICAgICAgIFhvcnNoaWZ0LnByb3RvdHlwZS5zZXJpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIF9zdGF0ZTBVOiB0aGlzLl9zdGF0ZTBVLFxuICAgICAgICAgICAgICAgIF9zdGF0ZTBMOiB0aGlzLl9zdGF0ZTBMLFxuICAgICAgICAgICAgICAgIF9zdGF0ZTFVOiB0aGlzLl9zdGF0ZTFVLFxuICAgICAgICAgICAgICAgIF9zdGF0ZTFMOiB0aGlzLl9zdGF0ZTFMXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gWG9yc2hpZnQ7XG4gICAgfSgpKTtcbiAgICBnLlhvcnNoaWZ0ID0gWG9yc2hpZnQ7XG59KShnIHx8IChnID0ge30pKTtcbnZhciBnO1xuKGZ1bmN0aW9uIChnKSB7XG4gICAgLyoqXG4gICAgICogWG9yc2hpZnTjgpLnlKjjgYTjgZ/kubHmlbDnlJ/miJDmnJ/jgIJcbiAgICAgKi9cbiAgICB2YXIgWG9yc2hpZnRSYW5kb21HZW5lcmF0b3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhYb3JzaGlmdFJhbmRvbUdlbmVyYXRvciwgX3N1cGVyKTtcbiAgICAgICAgZnVuY3Rpb24gWG9yc2hpZnRSYW5kb21HZW5lcmF0b3Ioc2VlZCwgeG9yc2hpZnQpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICBpZiAoc2VlZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiWG9yc2hpZnRSYW5kb21HZW5lcmF0b3IjY29uc3RydWN0b3I6IHNlZWQgaXMgdW5kZWZpbmVkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBzZWVkKSB8fCB0aGlzO1xuICAgICAgICAgICAgICAgIGlmICghIXhvcnNoaWZ0KSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl94b3JzaGlmdCA9IGcuWG9yc2hpZnQuZGVzZXJpYWxpemUoeG9yc2hpZnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX3hvcnNoaWZ0ID0gbmV3IGcuWG9yc2hpZnQoc2VlZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgICAgICB9XG4gICAgICAgIFhvcnNoaWZ0UmFuZG9tR2VuZXJhdG9yLmRlc2VyaWFsaXplID0gZnVuY3Rpb24gKHNlcikge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBYb3JzaGlmdFJhbmRvbUdlbmVyYXRvcihzZXIuX3NlZWQsIHNlci5feG9yc2hpZnQpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICog5oyH5a6a44GV44KM44Gf56+E5Zuy44Gu5pW05pWw44Gu55aR5Ly85Lmx5pWw44KS55Sf5oiQ44GZ44KL44CCXG4gICAgICAgICAqIOeUn+aIkOOBleOCjOOCi+WApOOBr+S4oeerr+OCkuWQq+OCgChpLmUuIFttaW4sIG1heF0p44GT44Go44Gr5rOo5oSP44CCXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBtaW4g55Sf5oiQ44GZ44KL55aR5Ly85Lmx5pWw44Gu5pyA5bCP5YCkXG4gICAgICAgICAqIEBwYXJhbSBtYXgg55Sf5oiQ44GZ44KL55aR5Ly85Lmx5pWw44Gu5pyA5aSn5YCkXG4gICAgICAgICAqL1xuICAgICAgICBYb3JzaGlmdFJhbmRvbUdlbmVyYXRvci5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKG1pbiwgbWF4KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5feG9yc2hpZnQubmV4dEludChtaW4sIG1heCArIDEpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogMCDku6XkuIogMSDmnKrmuoDjga7nlpHkvLzkubHmlbDjgpLnlJ/miJDjgZnjgovjgIJcbiAgICAgICAgICovXG4gICAgICAgIFhvcnNoaWZ0UmFuZG9tR2VuZXJhdG9yLnByb3RvdHlwZS5nZW5lcmF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl94b3JzaGlmdC5yYW5kb20oKTtcbiAgICAgICAgfTtcbiAgICAgICAgWG9yc2hpZnRSYW5kb21HZW5lcmF0b3IucHJvdG90eXBlLnNlcmlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgX3NlZWQ6IHRoaXMuc2VlZCxcbiAgICAgICAgICAgICAgICBfeG9yc2hpZnQ6IHRoaXMuX3hvcnNoaWZ0LnNlcmlhbGl6ZSgpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gWG9yc2hpZnRSYW5kb21HZW5lcmF0b3I7XG4gICAgfShnLlJhbmRvbUdlbmVyYXRvcikpO1xuICAgIGcuWG9yc2hpZnRSYW5kb21HZW5lcmF0b3IgPSBYb3JzaGlmdFJhbmRvbUdlbmVyYXRvcjtcbn0pKGcgfHwgKGcgPSB7fSkpO1xudmFyIGc7XG4oZnVuY3Rpb24gKGcpIHtcbiAgICAvKipcbiAgICAgKiBha2FzaGljLWVuZ2luZeOBq+OBiuOBkeOCi+OCt+OCp+ODvOODgOapn+iDveOCkuaPkOS+m+OBmeOCi+OCr+ODqeOCueOAglxuICAgICAqIOePvuODkOODvOOCuOODp+ODs+OBrmFrYXNoaWMtZW5naW5l44Gn44Gv44OV44Op44Kw44Oh44Oz44OI44K344Kn44O844OA44Gu44G/44KS44K144Od44O844OI44GZ44KL44CCXG4gICAgICovXG4gICAgdmFyIFNoYWRlclByb2dyYW0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlkITnqK7jg5Hjg6njg6Hjg7zjgr/jgpLmjIflrprjgZfjgaYgYFNoYWRlclByb2dyYW1gIOOBruOCpOODs+OCueOCv+ODs+OCueOCkueUn+aIkOOBmeOCi+OAglxuICAgICAgICAgKiBAcGFyYW0gcGFyYW0gYFNoYWRlclByb2dyYW1gIOOBq+ioreWumuOBmeOCi+ODkeODqeODoeODvOOCv1xuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gU2hhZGVyUHJvZ3JhbShwYXJhbSkge1xuICAgICAgICAgICAgdGhpcy5mcmFnbWVudFNoYWRlciA9IHBhcmFtLmZyYWdtZW50U2hhZGVyO1xuICAgICAgICAgICAgdGhpcy51bmlmb3JtcyA9IHBhcmFtLnVuaWZvcm1zO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBTaGFkZXJQcm9ncmFtO1xuICAgIH0oKSk7XG4gICAgZy5TaGFkZXJQcm9ncmFtID0gU2hhZGVyUHJvZ3JhbTtcbn0pKGcgfHwgKGcgPSB7fSkpO1xuLy8gb3JkZXJlZCBmaWxlc1xuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkFzc2V0TG9hZEVycm9yVHlwZS50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiZXJyb3JzLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJSZXNvdXJjZUZhY3RvcnkudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cImNvbW1vbnMudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlJlcXVpcmVDYWNoZWFibGUudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlJlcXVpcmVDYWNoZWRWYWx1ZS50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiRGVzdHJveWFibGUudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlJlZ2lzdHJhYmxlLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJSYW5kb21HZW5lcmF0b3IudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkVudGl0eVN0YXRlRmxhZ3MudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkFzc2V0TG9hZEhhbmRsZXIudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkFzc2V0LnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJBc3NldE1hbmFnZXJMb2FkSGFuZGxlci50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiQXNzZXRMb2FkRmFpbHVyZUluZm8udHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkFzc2V0TWFuYWdlci50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiTW9kdWxlLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJTY3JpcHRBc3NldEV4ZWN1dGVFbnZpcm9ubWVudC50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiU2NyaXB0QXNzZXRDb250ZXh0LnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJNYXRyaXgudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlV0aWwudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkNvbGxpc2lvbi50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiVHJpZ2dlci50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiVGltZXIudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlRpbWVyTWFuYWdlci50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiQXVkaW9QbGF5ZXIudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkF1ZGlvU3lzdGVtLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJWaWRlb1BsYXllci50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiVmlkZW9TeXN0ZW0udHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIk9iamVjdDJELnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJFLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJDYWNoZWFibGVFLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJTdG9yYWdlLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJTY2VuZS50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiTG9hZGluZ1NjZW5lLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJEZWZhdWx0TG9hZGluZ1NjZW5lLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJTcHJpdGUudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkZyYW1lU3ByaXRlLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJQbGF5ZXIudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkV2ZW50LnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJMb2dnZXIudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkdhbWVDb25maWd1cmF0aW9uLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJHYW1lLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJDYW1lcmEudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkltYWdlRGF0YS50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiUmVuZGVyZXIudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlN1cmZhY2UudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkxhYmVsLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJHbHlwaC50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiRmlsbGVkUmVjdC50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiUGFuZS50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiU3VyZmFjZUVmZmVjdG9yLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJPcGVyYXRpb25QbHVnaW5PcGVyYXRpb24udHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIk9wZXJhdGlvblBsdWdpbi50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiT3BlcmF0aW9uUGx1Z2luU3RhdGljLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJPcGVyYXRpb25QbHVnaW5JbmZvLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJPcGVyYXRpb25QbHVnaW5WaWV3LnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJPcGVyYXRpb25QbHVnaW5WaWV3SW5mby50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiT3BlcmF0aW9uUGx1Z2luTWFuYWdlci50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiZXhlY3V0ZUVudmlyb25tZW50VmFyaWFibGVzLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJUZXh0TWV0cml4LnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJGb250LnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJEeW5hbWljRm9udC50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiQml0bWFwRm9udC50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiU3VyZmFjZUF0bGFzU2V0LnRzXCIgLz5cbi8vIG5vbi1vcmRlcmVkIGZpbGVzXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiQXVkaW9TeXN0ZW1NYW5hZ2VyLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJDb21wb3NpdGVPcGVyYXRpb24udHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkV2ZW50RmlsdGVyLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJHbHlwaEZhY3RvcnkudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkdhbWVNYWluUGFyYW1ldGVyT2JqZWN0LnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJMb2NhbFRpY2tNb2RlLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJOaW5lUGF0Y2hTdXJmYWNlRWZmZWN0b3IudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlBhdGhVdGlsLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJGb250RmFtaWx5LnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJTeXN0ZW1MYWJlbC50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiVGV4dEFsaWduLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJUaWNrR2VuZXJhdGlvbk1vZGUudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlhvcnNoaWZ0LnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJYb3JzaGlmdFJhbmRvbUdlbmVyYXRvci50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiU2hhZGVyLnRzXCIgLz5cblxubW9kdWxlLmV4cG9ydHMgPSBnO1xufSkuY2FsbCh0aGlzKTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuIiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwiLi9saWIvaW5kZXhcIik7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ2xvY2sgPSB2b2lkIDA7XG52YXIgZyA9IHJlcXVpcmUoXCJAYWthc2hpYy9ha2FzaGljLWVuZ2luZVwiKTtcbi8qKlxuICogRlBT566h55CG55So44Gu44Kv44Ot44OD44Kv44CCXG4gKlxuICogYHBkaS5Mb29wZXJgIOOBruWumuacn+OBvuOBn+OBr+S4jeWumuacn+OBruWRvOOBs+WHuuOBl+OCkuWPl+OBkeS7mOOBkeOAgeaMh+WumuOBleOCjOOBn0ZQU+OBi+OCieaxguOCgeOBn1xuICogMeODleODrOODvOODoOWIhuOBruaZgumWkygx44OV44Os44O844Og5pmC6ZaTKeOBjOe1jOmBjuOBmeOCi+OBn+OBs+OBqyBgZnJhbWVUcmlnZ2VyYCDjgpJmaXJl44GZ44KL44CCXG4gKi9cbnZhciBDbG9jayA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDbG9jayhwYXJhbSkge1xuICAgICAgICB0aGlzLmZwcyA9IHBhcmFtLmZwcztcbiAgICAgICAgdGhpcy5zY2FsZUZhY3RvciA9IHBhcmFtLnNjYWxlRmFjdG9yIHx8IDE7XG4gICAgICAgIHRoaXMuZnJhbWVUcmlnZ2VyID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICB0aGlzLnJhd0ZyYW1lVHJpZ2dlciA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgdGhpcy5fcGxhdGZvcm0gPSBwYXJhbS5wbGF0Zm9ybTtcbiAgICAgICAgdGhpcy5fbWF4RnJhbWVQZXJPbmNlID0gcGFyYW0ubWF4RnJhbWVQZXJPbmNlO1xuICAgICAgICB0aGlzLl9kZWx0YVRpbWVCcm9rZW5UaHJlc2hvbGQgPSBwYXJhbS5kZWx0YVRpbWVCcm9rZW5UaHJlc2hvbGQgfHwgQ2xvY2suREVGQVVMVF9ERUxUQV9USU1FX0JST0tFTl9USFJFU0hPTEQ7XG4gICAgICAgIGlmIChwYXJhbS5mcmFtZUhhbmRsZXIpIHtcbiAgICAgICAgICAgIHRoaXMuZnJhbWVUcmlnZ2VyLmFkZChwYXJhbS5mcmFtZUhhbmRsZXIsIHBhcmFtLmZyYW1lSGFuZGxlck93bmVyKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fdG90YWxEZWx0YVRpbWUgPSAwO1xuICAgICAgICB0aGlzLl9vbkxvb3BlckNhbGxfYm91bmQgPSB0aGlzLl9vbkxvb3BlckNhbGwuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5fbG9vcGVyID0gdGhpcy5fcGxhdGZvcm0uY3JlYXRlTG9vcGVyKHRoaXMuX29uTG9vcGVyQ2FsbF9ib3VuZCk7XG4gICAgICAgIHRoaXMuX3dhaXRUaW1lID0gMDtcbiAgICAgICAgdGhpcy5fd2FpdFRpbWVEb3VibGVkID0gMDtcbiAgICAgICAgdGhpcy5fd2FpdFRpbWVNYXggPSAwO1xuICAgICAgICB0aGlzLl9za2lwRnJhbWVXYWl0VGltZSA9IDA7XG4gICAgICAgIHRoaXMuX3JlYWxNYXhGcmFtZVBlck9uY2UgPSAwO1xuICAgIH1cbiAgICBDbG9jay5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLnJ1bm5pbmcpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuX3RvdGFsRGVsdGFUaW1lID0gMDtcbiAgICAgICAgdGhpcy5fdXBkYXRlV2FpdFRpbWVzKHRoaXMuZnBzLCB0aGlzLnNjYWxlRmFjdG9yKTtcbiAgICAgICAgdGhpcy5fbG9vcGVyLnN0YXJ0KCk7XG4gICAgICAgIHRoaXMucnVubmluZyA9IHRydWU7XG4gICAgfTtcbiAgICBDbG9jay5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLnJ1bm5pbmcpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuX2xvb3Blci5zdG9wKCk7XG4gICAgICAgIHRoaXMucnVubmluZyA9IGZhbHNlO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogYHNjYWxlRmFjdG9yYCDjgpLlpInmm7TjgZnjgovjgIJcbiAgICAgKiBzdGFydCgp44GX44Gf5b6M44Gr44KC5ZG844Gz5Ye644Gb44KL44GM44CBMeODleODrOODvOODoOS7peS4i+OBrue1jOmBjuaZgumWk+aDheWgseOBr+ODquOCu+ODg+ODiOOBleOCjOOCi+eCueOBq+azqOaEj+OAglxuICAgICAqL1xuICAgIENsb2NrLnByb3RvdHlwZS5jaGFuZ2VTY2FsZUZhY3RvciA9IGZ1bmN0aW9uIChzY2FsZUZhY3Rvcikge1xuICAgICAgICBpZiAodGhpcy5ydW5uaW5nKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgICAgIHRoaXMuc2NhbGVGYWN0b3IgPSBzY2FsZUZhY3RvcjtcbiAgICAgICAgICAgIHRoaXMuc3RhcnQoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2NhbGVGYWN0b3IgPSBzY2FsZUZhY3RvcjtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ2xvY2sucHJvdG90eXBlLl9vbkxvb3BlckNhbGwgPSBmdW5jdGlvbiAoZGVsdGFUaW1lKSB7XG4gICAgICAgIHZhciByYXdEZWx0YVRpbWUgPSBkZWx0YVRpbWU7XG4gICAgICAgIGlmIChkZWx0YVRpbWUgPD0gMCkge1xuICAgICAgICAgICAgLy8g5pmC6ZaT44GM5q2i44G+44Gj44Gm44GE44KL44GL5be744GN5oi744Gj44Gm44GE44KL44CC5Yid5Zue5ZG844Gz5Ye644GX44GL44CB44GC44KL44GE44Gv5L2V44GL44GM44GK44GL44GX44GE44CC5pmC6ZaT57WM6YGOMOOBqOimi+OBquOBmeOAglxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dhaXRUaW1lIC0gdGhpcy5fdG90YWxEZWx0YVRpbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRlbHRhVGltZSA+IHRoaXMuX2RlbHRhVGltZUJyb2tlblRocmVzaG9sZCkge1xuICAgICAgICAgICAgLy8g6ZaT6ZqU44GM6ZW344GZ44GO44KL44CC5L2V44GL44GM44GK44GL44GX44GE44CC5pmC6ZaT57WM6YGO44KSMeODleODrOODvOODoOWIhuOBqOOBv+OBquOBmeOAglxuICAgICAgICAgICAgZGVsdGFUaW1lID0gdGhpcy5fd2FpdFRpbWU7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRvdGFsRGVsdGFUaW1lID0gdGhpcy5fdG90YWxEZWx0YVRpbWU7XG4gICAgICAgIHRvdGFsRGVsdGFUaW1lICs9IGRlbHRhVGltZTtcbiAgICAgICAgaWYgKHRvdGFsRGVsdGFUaW1lIDw9IHRoaXMuX3NraXBGcmFtZVdhaXRUaW1lKSB7XG4gICAgICAgICAgICAvLyAx44OV44Os44O844Og5YiG5raI5YyW44GZ44KL44G744Gp44Gu5pmC6ZaT44GM57WM44Gj44Gm44GE44Gq44GE44CCXG4gICAgICAgICAgICB0aGlzLl90b3RhbERlbHRhVGltZSA9IHRvdGFsRGVsdGFUaW1lO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dhaXRUaW1lIC0gdG90YWxEZWx0YVRpbWU7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGZyYW1lQ291bnQgPSAodG90YWxEZWx0YVRpbWUgPCB0aGlzLl93YWl0VGltZURvdWJsZWQpID8gMVxuICAgICAgICAgICAgOiAodG90YWxEZWx0YVRpbWUgPiB0aGlzLl93YWl0VGltZU1heCkgPyB0aGlzLl9yZWFsTWF4RnJhbWVQZXJPbmNlXG4gICAgICAgICAgICAgICAgOiAodG90YWxEZWx0YVRpbWUgLyB0aGlzLl93YWl0VGltZSkgfCAwO1xuICAgICAgICB2YXIgZmMgPSBmcmFtZUNvdW50O1xuICAgICAgICB2YXIgYXJnID0ge1xuICAgICAgICAgICAgZGVsdGFUaW1lOiByYXdEZWx0YVRpbWUsXG4gICAgICAgICAgICBpbnRlcnJ1cHQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHdoaWxlIChmYyA+IDAgJiYgdGhpcy5ydW5uaW5nICYmICFhcmcuaW50ZXJydXB0KSB7XG4gICAgICAgICAgICAtLWZjO1xuICAgICAgICAgICAgdGhpcy5mcmFtZVRyaWdnZXIuZmlyZShhcmcpO1xuICAgICAgICAgICAgYXJnLmRlbHRhVGltZSA9IDA7IC8vIOWQjOODq+ODvOODl+OBq+OCiOOCizLluqbnm67ku6XpmY3jga7lkbzjgbPlh7rjgZfjga/lt67liIbjgpIw44Go44G/44Gq44GZ44CCXG4gICAgICAgIH1cbiAgICAgICAgdG90YWxEZWx0YVRpbWUgLT0gKChmcmFtZUNvdW50IC0gZmMpICogdGhpcy5fd2FpdFRpbWUpO1xuICAgICAgICB0aGlzLnJhd0ZyYW1lVHJpZ2dlci5maXJlKCk7XG4gICAgICAgIHRoaXMuX3RvdGFsRGVsdGFUaW1lID0gdG90YWxEZWx0YVRpbWU7XG4gICAgICAgIHJldHVybiB0aGlzLl93YWl0VGltZSAtIHRvdGFsRGVsdGFUaW1lO1xuICAgIH07XG4gICAgQ2xvY2sucHJvdG90eXBlLl91cGRhdGVXYWl0VGltZXMgPSBmdW5jdGlvbiAoZnBzLCBzY2FsZUZhY3Rvcikge1xuICAgICAgICB2YXIgcmVhbEZwcyA9IGZwcyAqIHNjYWxlRmFjdG9yO1xuICAgICAgICB0aGlzLl93YWl0VGltZSA9IDEwMDAgLyByZWFsRnBzO1xuICAgICAgICB0aGlzLl93YWl0VGltZURvdWJsZWQgPSBNYXRoLm1heCgoMjAwMCAvIHJlYWxGcHMpIHwgMCwgMSk7XG4gICAgICAgIHRoaXMuX3dhaXRUaW1lTWF4ID0gTWF0aC5tYXgoc2NhbGVGYWN0b3IgKiAoMTAwMCAqIHRoaXMuX21heEZyYW1lUGVyT25jZSAvIHJlYWxGcHMpIHwgMCwgMSk7XG4gICAgICAgIHRoaXMuX3NraXBGcmFtZVdhaXRUaW1lID0gKHRoaXMuX3dhaXRUaW1lICogQ2xvY2suQU5USUNJUEFURV9SQVRFKSB8IDA7XG4gICAgICAgIHRoaXMuX3JlYWxNYXhGcmFtZVBlck9uY2UgPSB0aGlzLl9tYXhGcmFtZVBlck9uY2UgKiBzY2FsZUZhY3RvcjtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOe1jOmBjuaZgumWk+WFiOWPluOCiuOBruavlOeOh+OAglxuICAgICAqXG4gICAgICogRlBT44GL44KJ5a6a44G+44KL44CMMeODleODrOODvOODoOOAjeOBrue1jOmBjuaZgumWk+OBjOe1jOOBo+OBpuOBhOOBquOBj+OBpuOCguOAgeOBk+OBruWJsuWQiOOBruaZgumWk+OBjOe1jOmBjuOBl+OBpuOBhOOCjOOBsDHjg5Xjg6zjg7zjg6DliIbjga7oqIjnrpfjgpLpgLLjgoHjgabjgZfjgb7jgYbjgIJcbiAgICAgKiDjgZ3jga7ku6Pjgo/jgorjgavmrKHjg5Xjg6zjg7zjg6Djgb7jgafjga7miYDopoHmmYLplpPjgpLplbfjgY/jgZnjgovjgIJcbiAgICAgKiDkvovjgYjjgbAyMEZQU+OBp+OBguOCjOOBsDUwbXPjgacx44OV44Os44O844Og44Gg44GM44CBNTAqMC44ID0gNDBtcyDmmYLngrnjgacx44OV44Os44O844Og6YCy44KB44Gm44GX44G+44GE44CB5qyh44OV44Os44O844Og44G+44Gn44Gu5pmC6ZaT44KSNjBtc+OBq+OBmeOCi+OAglxuICAgICAqL1xuICAgIENsb2NrLkFOVElDSVBBVEVfUkFURSA9IDAuODtcbiAgICAvKipcbiAgICAgKiDnlbDluLjlgKTjgajjgb/jgarjgZfjgabnhKHoppbjgZnjgosgYExvb3BlcmAg44Gu5ZG844Gz5Ye644GX6ZaT6ZqUW21zXeOBruODh+ODleOCqeODq+ODiOWApOOAglxuICAgICAqL1xuICAgIENsb2NrLkRFRkFVTFRfREVMVEFfVElNRV9CUk9LRU5fVEhSRVNIT0xEID0gMTUwO1xuICAgIHJldHVybiBDbG9jaztcbn0oKSk7XG5leHBvcnRzLkNsb2NrID0gQ2xvY2s7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRXZlbnRCdWZmZXIgPSB2b2lkIDA7XG52YXIgcGRpID0gcmVxdWlyZShcIkBha2FzaGljL2FrYXNoaWMtcGRpXCIpO1xudmFyIGcgPSByZXF1aXJlKFwiQGFrYXNoaWMvYWthc2hpYy1lbmdpbmVcIik7XG52YXIgUG9pbnRFdmVudFJlc29sdmVyXzEgPSByZXF1aXJlKFwiLi9Qb2ludEV2ZW50UmVzb2x2ZXJcIik7XG4vKipcbiAqIEFNRmxvd+OBqFBESeOBi+OCiea1geOCjOi+vOOCgOOCpOODmeODs+ODiOOCkuiThOepjeOBmeOCi+ODkOODg+ODleOCoeOAglxuICpcbiAqIEFNRkxvd+OBi+OCieWPl+S/oeOBmeOCi+OBi+OBqeOBhuOBi+OAgUFNRmxvd+OBq+mAgeOCi+OBi+OBqeOBhuOBi+OBr+WklumDqOOBi+OCieWIh+OCiuabv+OBiOOCi+OBk+OBqOOBjOOBp+OBjeOCi+OAglxuICog54q25oWL44Gr44KI44Gj44Gm44Gv44CBYF9hbWZsb3dgIOOBruiqjeiovOOBpyBgc3Vic2NyaWJlRXZlbnRgIOOBqCBgc2VuZEV2ZW50YCDjga7jgYTjgZrjgozjgYvjgb7jgZ/jga/kuKHmlrnjga7mqKnpmZDjgpLlj5blvpfjgZfjgabjgYTjgovlv4XopoHjgYzjgYLjgovjgIJcbiAqIOips+e0sOOBryBgc2V0TW9kZSgpYCDjga7jgrPjg6Hjg7Pjg4jjgpLlj4LnhafjgIJcbiAqL1xudmFyIEV2ZW50QnVmZmVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEV2ZW50QnVmZmVyKHBhcmFtKSB7XG4gICAgICAgIHRoaXMuX2FtZmxvdyA9IHBhcmFtLmFtZmxvdztcbiAgICAgICAgdGhpcy5faXNMb2NhbFJlY2VpdmVyID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5faXNSZWNlaXZlciA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9pc1NlbmRlciA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9pc0Rpc2NhcmRlciA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9kZWZhdWx0RXZlbnRQcmlvcml0eSA9IDA7XG4gICAgICAgIHRoaXMuX2J1ZmZlciA9IFtdO1xuICAgICAgICB0aGlzLl9qb2luTGVhdmVCdWZmZXIgPSBbXTtcbiAgICAgICAgdGhpcy5fbG9jYWxCdWZmZXIgPSBbXTtcbiAgICAgICAgdGhpcy5fZmlsdGVycyA9IG51bGw7XG4gICAgICAgIHRoaXMuX3VuZmlsdGVyZWRMb2NhbEV2ZW50cyA9IFtdO1xuICAgICAgICB0aGlzLl91bmZpbHRlcmVkRXZlbnRzID0gW107XG4gICAgICAgIHRoaXMuX3BvaW50RXZlbnRSZXNvbHZlciA9IG5ldyBQb2ludEV2ZW50UmVzb2x2ZXJfMS5Qb2ludEV2ZW50UmVzb2x2ZXIoeyBnYW1lOiBwYXJhbS5nYW1lIH0pO1xuICAgICAgICB0aGlzLl9vbkV2ZW50X2JvdW5kID0gdGhpcy5vbkV2ZW50LmJpbmQodGhpcyk7XG4gICAgfVxuICAgIEV2ZW50QnVmZmVyLmlzRXZlbnRMb2NhbCA9IGZ1bmN0aW9uIChwZXYpIHtcbiAgICAgICAgc3dpdGNoIChwZXZbMCAvKiBDb2RlICovXSkge1xuICAgICAgICAgICAgY2FzZSAwIC8qIEpvaW4gKi86XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBldls1IC8qIExvY2FsICovXTtcbiAgICAgICAgICAgIGNhc2UgMSAvKiBMZWF2ZSAqLzpcbiAgICAgICAgICAgICAgICByZXR1cm4gcGV2WzMgLyogTG9jYWwgKi9dO1xuICAgICAgICAgICAgY2FzZSAyIC8qIFRpbWVzdGFtcCAqLzpcbiAgICAgICAgICAgICAgICByZXR1cm4gcGV2WzQgLyogTG9jYWwgKi9dO1xuICAgICAgICAgICAgY2FzZSAzMiAvKiBNZXNzYWdlICovOlxuICAgICAgICAgICAgICAgIHJldHVybiBwZXZbNCAvKiBMb2NhbCAqL107XG4gICAgICAgICAgICBjYXNlIDMzIC8qIFBvaW50RG93biAqLzpcbiAgICAgICAgICAgICAgICByZXR1cm4gcGV2WzcgLyogTG9jYWwgKi9dO1xuICAgICAgICAgICAgY2FzZSAzNCAvKiBQb2ludE1vdmUgKi86XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBldlsxMSAvKiBMb2NhbCAqL107XG4gICAgICAgICAgICBjYXNlIDM1IC8qIFBvaW50VXAgKi86XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBldlsxMSAvKiBMb2NhbCAqL107XG4gICAgICAgICAgICBjYXNlIDY0IC8qIE9wZXJhdGlvbiAqLzpcbiAgICAgICAgICAgICAgICByZXR1cm4gcGV2WzUgLyogTG9jYWwgKi9dO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJFdmVudEJ1ZmZlci5pc0V2ZW50TG9jYWxcIik7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOODouODvOODieOCkuWIh+OCiuabv+OBiOOCi+OAglxuICAgICAqXG4gICAgICog44GT44Gu6Zai5pWw44Gu5ZG844Gz5Ye644GZ5aC05ZCI44CB5pyA5b6M44Gr5ZG844Gz5Ye644GV44KM44GfIF9hbWZsb3cjYXV0aGVudGljYXRlKCkg44GL44KJ5b6X44GfIFBlcm1pc3Npb24g44Gv5qyh44Gu5p2h5Lu244KS5rqA44Gf44GV44Gt44Gw44Gq44KJ44Gq44GEOlxuICAgICAqICog5byV5pWwIGBwYXJhbS5pc1JlY2VpdmVyYCDjgavnnJ/jgpLmuKHjgZnloLTlkIjjgIHmrKHjgavlgb3jgpLmuKHjgZnjgb7jgafjga7plpPjgIEgYHN1YnNjcmliZUV2ZW50YCDjgYznnJ/jgafjgYLjgovjgZPjgajjgIJcbiAgICAgKiAqIOW8leaVsCBgcGFyYW0uaXNTZW5kZXJgIOOBq+ecn+OCkua4oeOBmeWgtOWQiOOAgeasoeOBq+WBveOCkua4oeOBmeOBvuOBp+OBrumWk+OAgSBgc2VuZEV2ZW50YCDjgYznnJ/jgafjgYLjgovjgZPjgajjgIJcbiAgICAgKi9cbiAgICBFdmVudEJ1ZmZlci5wcm90b3R5cGUuc2V0TW9kZSA9IGZ1bmN0aW9uIChwYXJhbSkge1xuICAgICAgICBpZiAocGFyYW0uaXNMb2NhbFJlY2VpdmVyICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuX2lzTG9jYWxSZWNlaXZlciA9IHBhcmFtLmlzTG9jYWxSZWNlaXZlcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFyYW0uaXNSZWNlaXZlciAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5faXNSZWNlaXZlciAhPT0gcGFyYW0uaXNSZWNlaXZlcikge1xuICAgICAgICAgICAgICAgIHRoaXMuX2lzUmVjZWl2ZXIgPSBwYXJhbS5pc1JlY2VpdmVyO1xuICAgICAgICAgICAgICAgIGlmIChwYXJhbS5pc1JlY2VpdmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2FtZmxvdy5vbkV2ZW50KHRoaXMuX29uRXZlbnRfYm91bmQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYW1mbG93Lm9mZkV2ZW50KHRoaXMuX29uRXZlbnRfYm91bmQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocGFyYW0uaXNTZW5kZXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5faXNTZW5kZXIgPSBwYXJhbS5pc1NlbmRlcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFyYW0uaXNEaXNjYXJkZXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5faXNEaXNjYXJkZXIgPSBwYXJhbS5pc0Rpc2NhcmRlcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFyYW0uZGVmYXVsdEV2ZW50UHJpb3JpdHkgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5fZGVmYXVsdEV2ZW50UHJpb3JpdHkgPSAzIC8qIFByaW9yaXR5ICovICYgcGFyYW0uZGVmYXVsdEV2ZW50UHJpb3JpdHk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEV2ZW50QnVmZmVyLnByb3RvdHlwZS5nZXRNb2RlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaXNMb2NhbFJlY2VpdmVyOiB0aGlzLl9pc0xvY2FsUmVjZWl2ZXIsXG4gICAgICAgICAgICBpc1JlY2VpdmVyOiB0aGlzLl9pc1JlY2VpdmVyLFxuICAgICAgICAgICAgaXNTZW5kZXI6IHRoaXMuX2lzU2VuZGVyLFxuICAgICAgICAgICAgaXNEaXNjYXJkZXI6IHRoaXMuX2lzRGlzY2FyZGVyLFxuICAgICAgICAgICAgZGVmYXVsdEV2ZW50UHJpb3JpdHk6IHRoaXMuX2RlZmF1bHRFdmVudFByaW9yaXR5XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBFdmVudEJ1ZmZlci5wcm90b3R5cGUub25FdmVudCA9IGZ1bmN0aW9uIChwZXYpIHtcbiAgICAgICAgaWYgKEV2ZW50QnVmZmVyLmlzRXZlbnRMb2NhbChwZXYpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5faXNMb2NhbFJlY2VpdmVyICYmICF0aGlzLl9pc0Rpc2NhcmRlcikge1xuICAgICAgICAgICAgICAgIHRoaXMuX3VuZmlsdGVyZWRMb2NhbEV2ZW50cy5wdXNoKHBldik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX2lzUmVjZWl2ZXIgJiYgIXRoaXMuX2lzRGlzY2FyZGVyKSB7XG4gICAgICAgICAgICB0aGlzLl91bmZpbHRlcmVkRXZlbnRzLnB1c2gocGV2KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5faXNTZW5kZXIpIHtcbiAgICAgICAgICAgIGlmIChwZXZbMSAvKiBFdmVudEZsYWdzICovXSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcGV2WzEgLyogRXZlbnRGbGFncyAqL10gPSB0aGlzLl9kZWZhdWx0RXZlbnRQcmlvcml0eTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2FtZmxvdy5zZW5kRXZlbnQocGV2KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgRXZlbnRCdWZmZXIucHJvdG90eXBlLm9uUG9pbnRFdmVudCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciBwZXY7XG4gICAgICAgIHN3aXRjaCAoZS50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIDAgLyogRG93biAqLzpcbiAgICAgICAgICAgICAgICBwZXYgPSB0aGlzLl9wb2ludEV2ZW50UmVzb2x2ZXIucG9pbnREb3duKGUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAxIC8qIE1vdmUgKi86XG4gICAgICAgICAgICAgICAgcGV2ID0gdGhpcy5fcG9pbnRFdmVudFJlc29sdmVyLnBvaW50TW92ZShlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMiAvKiBVcCAqLzpcbiAgICAgICAgICAgICAgICBwZXYgPSB0aGlzLl9wb2ludEV2ZW50UmVzb2x2ZXIucG9pbnRVcChlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXBldilcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy5vbkV2ZW50KHBldik7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBmaWx0ZXLjgpLnhKHoppbjgZfjgabjgqTjg5njg7Pjg4jjgpLov73liqDjgZnjgovjgIJcbiAgICAgKi9cbiAgICBFdmVudEJ1ZmZlci5wcm90b3R5cGUuYWRkRXZlbnREaXJlY3QgPSBmdW5jdGlvbiAocGV2KSB7XG4gICAgICAgIGlmIChFdmVudEJ1ZmZlci5pc0V2ZW50TG9jYWwocGV2KSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0xvY2FsUmVjZWl2ZXIgfHwgdGhpcy5faXNEaXNjYXJkZXIpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5fbG9jYWxCdWZmZXIucHVzaChwZXYpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9pc1JlY2VpdmVyICYmICF0aGlzLl9pc0Rpc2NhcmRlcikge1xuICAgICAgICAgICAgaWYgKHBldlswIC8qIENvZGUgKi9dID09PSAwIC8qIEpvaW4gKi8gfHwgcGV2WzAgLyogQ29kZSAqL10gPT09IDEgLyogTGVhdmUgKi8pIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9qb2luTGVhdmVCdWZmZXIucHVzaChwZXYpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYnVmZmVyLnB1c2gocGV2KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5faXNTZW5kZXIpIHtcbiAgICAgICAgICAgIGlmIChwZXZbMSAvKiBFdmVudEZsYWdzICovXSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcGV2WzEgLyogRXZlbnRGbGFncyAqL10gPSB0aGlzLl9kZWZhdWx0RXZlbnRQcmlvcml0eTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2FtZmxvdy5zZW5kRXZlbnQocGV2KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgRXZlbnRCdWZmZXIucHJvdG90eXBlLnJlYWRFdmVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByZXQgPSB0aGlzLl9idWZmZXI7XG4gICAgICAgIGlmIChyZXQubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIHRoaXMuX2J1ZmZlciA9IFtdO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH07XG4gICAgRXZlbnRCdWZmZXIucHJvdG90eXBlLnJlYWRKb2luTGVhdmVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcmV0ID0gdGhpcy5fam9pbkxlYXZlQnVmZmVyO1xuICAgICAgICBpZiAocmV0Lmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB0aGlzLl9qb2luTGVhdmVCdWZmZXIgPSBbXTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9O1xuICAgIEV2ZW50QnVmZmVyLnByb3RvdHlwZS5yZWFkTG9jYWxFdmVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByZXQgPSB0aGlzLl9sb2NhbEJ1ZmZlcjtcbiAgICAgICAgaWYgKHJldC5sZW5ndGggPT09IDApXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgdGhpcy5fbG9jYWxCdWZmZXIgPSBbXTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9O1xuICAgIEV2ZW50QnVmZmVyLnByb3RvdHlwZS5hZGRGaWx0ZXIgPSBmdW5jdGlvbiAoZmlsdGVyLCBoYW5kbGVFbXB0eSkge1xuICAgICAgICBpZiAoIXRoaXMuX2ZpbHRlcnMpXG4gICAgICAgICAgICB0aGlzLl9maWx0ZXJzID0gW107XG4gICAgICAgIHRoaXMuX2ZpbHRlcnMucHVzaCh7IGZ1bmM6IGZpbHRlciwgaGFuZGxlRW1wdHk6ICEhaGFuZGxlRW1wdHkgfSk7XG4gICAgfTtcbiAgICBFdmVudEJ1ZmZlci5wcm90b3R5cGUucmVtb3ZlRmlsdGVyID0gZnVuY3Rpb24gKGZpbHRlcikge1xuICAgICAgICBpZiAoIXRoaXMuX2ZpbHRlcnMpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICghZmlsdGVyKSB7XG4gICAgICAgICAgICB0aGlzLl9maWx0ZXJzID0gbnVsbDtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5fZmlsdGVycy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2ZpbHRlcnNbaV0uZnVuYyA9PT0gZmlsdGVyKVxuICAgICAgICAgICAgICAgIHRoaXMuX2ZpbHRlcnMuc3BsaWNlKGksIDEpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBFdmVudEJ1ZmZlci5wcm90b3R5cGUucHJvY2Vzc0V2ZW50cyA9IGZ1bmN0aW9uIChpc0xvY2FsKSB7XG4gICAgICAgIHZhciB1bHBldnMgPSB0aGlzLl91bmZpbHRlcmVkTG9jYWxFdmVudHM7XG4gICAgICAgIHZhciB1cGV2cyA9IHRoaXMuX3VuZmlsdGVyZWRFdmVudHM7XG4gICAgICAgIHRoaXMuX3VuZmlsdGVyZWRMb2NhbEV2ZW50cyA9IFtdO1xuICAgICAgICB2YXIgcGV2cyA9IHVscGV2cztcbiAgICAgICAgaWYgKCFpc0xvY2FsICYmIHVwZXZzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHBldnMgPSAocGV2cy5sZW5ndGggPiAwKSA/IHBldnMuY29uY2F0KHVwZXZzKSA6IHVwZXZzO1xuICAgICAgICAgICAgdGhpcy5fdW5maWx0ZXJlZEV2ZW50cyA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9maWx0ZXJzKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX2ZpbHRlcnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyID0gdGhpcy5fZmlsdGVyc1tpXTtcbiAgICAgICAgICAgICAgICBpZiAocGV2cy5sZW5ndGggPiAwIHx8IGZpbHRlci5oYW5kbGVFbXB0eSlcbiAgICAgICAgICAgICAgICAgICAgcGV2cyA9IHRoaXMuX2ZpbHRlcnNbaV0uZnVuYyhwZXZzKSB8fCBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBldnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBwZXYgPSBwZXZzW2ldO1xuICAgICAgICAgICAgaWYgKEV2ZW50QnVmZmVyLmlzRXZlbnRMb2NhbChwZXYpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbG9jYWxCdWZmZXIucHVzaChwZXYpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocGV2WzAgLyogQ29kZSAqL10gPT09IDAgLyogSm9pbiAqLyB8fCBwZXZbMCAvKiBDb2RlICovXSA9PT0gMSAvKiBMZWF2ZSAqLykge1xuICAgICAgICAgICAgICAgIHRoaXMuX2pvaW5MZWF2ZUJ1ZmZlci5wdXNoKHBldik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9idWZmZXIucHVzaChwZXYpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gRXZlbnRCdWZmZXI7XG59KCkpO1xuZXhwb3J0cy5FdmVudEJ1ZmZlciA9IEV2ZW50QnVmZmVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkV2ZW50Q29udmVydGVyID0gdm9pZCAwO1xudmFyIGcgPSByZXF1aXJlKFwiQGFrYXNoaWMvYWthc2hpYy1lbmdpbmVcIik7XG52YXIgRXZlbnRDb252ZXJ0ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRXZlbnRDb252ZXJ0ZXIocGFyYW0pIHtcbiAgICAgICAgdGhpcy5fZ2FtZSA9IHBhcmFtLmdhbWU7XG4gICAgICAgIHRoaXMuX3BsYXllclRhYmxlID0ge307XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHBsYXlsb2cuRXZlbnTjgYvjgolnLkV2ZW5044G45aSJ5o+b44GZ44KL44CCXG4gICAgICovXG4gICAgRXZlbnRDb252ZXJ0ZXIucHJvdG90eXBlLnRvR2FtZUV2ZW50ID0gZnVuY3Rpb24gKHBldikge1xuICAgICAgICB2YXIgcG9pbnRlcklkO1xuICAgICAgICB2YXIgZW50aXR5SWQ7XG4gICAgICAgIHZhciB0YXJnZXQ7XG4gICAgICAgIHZhciBwb2ludDtcbiAgICAgICAgdmFyIHN0YXJ0RGVsdGE7XG4gICAgICAgIHZhciBwcmV2RGVsdGE7XG4gICAgICAgIHZhciBsb2NhbDtcbiAgICAgICAgdmFyIHRpbWVzdGFtcDtcbiAgICAgICAgdmFyIGV2ZW50Q29kZSA9IHBldlswIC8qIENvZGUgKi9dO1xuICAgICAgICAvLyBUT0RPOiB0cmFuc2llbnQgZXZlbnQg5a++5b+cXG4gICAgICAgIHZhciBwcmlvID0gcGV2WzEgLyogRXZlbnRGbGFncyAqL107XG4gICAgICAgIHZhciBwbGF5ZXJJZCA9IHBldlsyIC8qIFBsYXllcklkICovXTtcbiAgICAgICAgdmFyIHBsYXllciA9IHRoaXMuX3BsYXllclRhYmxlW3BsYXllcklkXSB8fCB7IGlkOiBwbGF5ZXJJZCB9O1xuICAgICAgICBzd2l0Y2ggKGV2ZW50Q29kZSkge1xuICAgICAgICAgICAgY2FzZSAwIC8qIEpvaW4gKi86XG4gICAgICAgICAgICAgICAgcGxheWVyID0ge1xuICAgICAgICAgICAgICAgICAgICBpZDogcGxheWVySWQsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHBldlszIC8qIFBsYXllck5hbWUgKi9dXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wbGF5ZXJUYWJsZVtwbGF5ZXJJZF0gPSBwbGF5ZXI7XG4gICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGlmIChwZXZbNCAvKiBTdG9yYWdlRGF0YSAqL10pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBwZXZbNCAvKiBTdG9yYWdlRGF0YSAqL10ubWFwKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlzLnB1c2goZGF0YS5yZWFkS2V5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKGRhdGEudmFsdWVzKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHN0b3JlID0gbmV3IGcuU3RvcmFnZVZhbHVlU3RvcmUoa2V5cywgdmFsdWVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBnLkpvaW5FdmVudChwbGF5ZXIsIHN0b3JlLCBwcmlvKTtcbiAgICAgICAgICAgIGNhc2UgMSAvKiBMZWF2ZSAqLzpcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fcGxheWVyVGFibGVbcGxheWVyLmlkXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGcuTGVhdmVFdmVudChwbGF5ZXIsIHByaW8pO1xuICAgICAgICAgICAgY2FzZSAyIC8qIFRpbWVzdGFtcCAqLzpcbiAgICAgICAgICAgICAgICB0aW1lc3RhbXAgPSBwZXZbMyAvKiBUaW1lc3RhbXAgKi9dO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgZy5UaW1lc3RhbXBFdmVudCh0aW1lc3RhbXAsIHBsYXllciwgcHJpbyk7XG4gICAgICAgICAgICBjYXNlIDMyIC8qIE1lc3NhZ2UgKi86XG4gICAgICAgICAgICAgICAgbG9jYWwgPSBwZXZbNCAvKiBMb2NhbCAqL107XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBnLk1lc3NhZ2VFdmVudChwZXZbMyAvKiBNZXNzYWdlICovXSwgcGxheWVyLCBsb2NhbCwgcHJpbyk7XG4gICAgICAgICAgICBjYXNlIDMzIC8qIFBvaW50RG93biAqLzpcbiAgICAgICAgICAgICAgICBsb2NhbCA9IHBldls3IC8qIExvY2FsICovXTtcbiAgICAgICAgICAgICAgICBwb2ludGVySWQgPSBwZXZbMyAvKiBQb2ludGVySWQgKi9dO1xuICAgICAgICAgICAgICAgIGVudGl0eUlkID0gcGV2WzYgLyogRW50aXR5SWQgKi9dO1xuICAgICAgICAgICAgICAgIHRhcmdldCA9IChlbnRpdHlJZCA9PSBudWxsKSA/IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICA6IChlbnRpdHlJZCA+PSAwKSA/IHRoaXMuX2dhbWUuZGJbZW50aXR5SWRdXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHRoaXMuX2dhbWUuX2xvY2FsRGJbZW50aXR5SWRdO1xuICAgICAgICAgICAgICAgIHBvaW50ID0ge1xuICAgICAgICAgICAgICAgICAgICB4OiBwZXZbNCAvKiBYICovXSxcbiAgICAgICAgICAgICAgICAgICAgeTogcGV2WzUgLyogWSAqL11cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgZy5Qb2ludERvd25FdmVudChwb2ludGVySWQsIHRhcmdldCwgcG9pbnQsIHBsYXllciwgbG9jYWwsIHByaW8pO1xuICAgICAgICAgICAgY2FzZSAzNCAvKiBQb2ludE1vdmUgKi86XG4gICAgICAgICAgICAgICAgbG9jYWwgPSBwZXZbMTEgLyogTG9jYWwgKi9dO1xuICAgICAgICAgICAgICAgIHBvaW50ZXJJZCA9IHBldlszIC8qIFBvaW50ZXJJZCAqL107XG4gICAgICAgICAgICAgICAgZW50aXR5SWQgPSBwZXZbMTAgLyogRW50aXR5SWQgKi9dO1xuICAgICAgICAgICAgICAgIHRhcmdldCA9IChlbnRpdHlJZCA9PSBudWxsKSA/IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICA6IChlbnRpdHlJZCA+PSAwKSA/IHRoaXMuX2dhbWUuZGJbZW50aXR5SWRdXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHRoaXMuX2dhbWUuX2xvY2FsRGJbZW50aXR5SWRdO1xuICAgICAgICAgICAgICAgIHBvaW50ID0ge1xuICAgICAgICAgICAgICAgICAgICB4OiBwZXZbNCAvKiBYICovXSxcbiAgICAgICAgICAgICAgICAgICAgeTogcGV2WzUgLyogWSAqL11cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHN0YXJ0RGVsdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgIHg6IHBldls2IC8qIFN0YXJ0RGVsdGFYICovXSxcbiAgICAgICAgICAgICAgICAgICAgeTogcGV2WzcgLyogU3RhcnREZWx0YVkgKi9dXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBwcmV2RGVsdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgIHg6IHBldls4IC8qIFByZXZEZWx0YVggKi9dLFxuICAgICAgICAgICAgICAgICAgICB5OiBwZXZbOSAvKiBQcmV2RGVsdGFZICovXVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBnLlBvaW50TW92ZUV2ZW50KHBvaW50ZXJJZCwgdGFyZ2V0LCBwb2ludCwgcHJldkRlbHRhLCBzdGFydERlbHRhLCBwbGF5ZXIsIGxvY2FsLCBwcmlvKTtcbiAgICAgICAgICAgIGNhc2UgMzUgLyogUG9pbnRVcCAqLzpcbiAgICAgICAgICAgICAgICBsb2NhbCA9IHBldlsxMSAvKiBMb2NhbCAqL107XG4gICAgICAgICAgICAgICAgcG9pbnRlcklkID0gcGV2WzMgLyogUG9pbnRlcklkICovXTtcbiAgICAgICAgICAgICAgICBlbnRpdHlJZCA9IHBldlsxMCAvKiBFbnRpdHlJZCAqL107XG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gKGVudGl0eUlkID09IG51bGwpID8gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgIDogKGVudGl0eUlkID49IDApID8gdGhpcy5fZ2FtZS5kYltlbnRpdHlJZF1cbiAgICAgICAgICAgICAgICAgICAgICAgIDogdGhpcy5fZ2FtZS5fbG9jYWxEYltlbnRpdHlJZF07XG4gICAgICAgICAgICAgICAgcG9pbnQgPSB7XG4gICAgICAgICAgICAgICAgICAgIHg6IHBldls0IC8qIFggKi9dLFxuICAgICAgICAgICAgICAgICAgICB5OiBwZXZbNSAvKiBZICovXVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgc3RhcnREZWx0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgeDogcGV2WzYgLyogU3RhcnREZWx0YVggKi9dLFxuICAgICAgICAgICAgICAgICAgICB5OiBwZXZbNyAvKiBTdGFydERlbHRhWSAqL11cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHByZXZEZWx0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgeDogcGV2WzggLyogUHJldkRlbHRhWCAqL10sXG4gICAgICAgICAgICAgICAgICAgIHk6IHBldls5IC8qIFByZXZEZWx0YVkgKi9dXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGcuUG9pbnRVcEV2ZW50KHBvaW50ZXJJZCwgdGFyZ2V0LCBwb2ludCwgcHJldkRlbHRhLCBzdGFydERlbHRhLCBwbGF5ZXIsIGxvY2FsLCBwcmlvKTtcbiAgICAgICAgICAgIGNhc2UgNjQgLyogT3BlcmF0aW9uICovOlxuICAgICAgICAgICAgICAgIGxvY2FsID0gcGV2WzUgLyogTG9jYWwgKi9dO1xuICAgICAgICAgICAgICAgIHZhciBvcGVyYXRpb25Db2RlID0gcGV2WzMgLyogT3BlcmF0aW9uQ29kZSAqL107XG4gICAgICAgICAgICAgICAgdmFyIG9wZXJhdGlvbkRhdGEgPSBwZXZbNCAvKiBPcGVyYXRpb25EYXRhICovXTtcbiAgICAgICAgICAgICAgICB2YXIgZGVjb2RlZERhdGEgPSB0aGlzLl9nYW1lLl9kZWNvZGVPcGVyYXRpb25QbHVnaW5PcGVyYXRpb24ob3BlcmF0aW9uQ29kZSwgb3BlcmF0aW9uRGF0YSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBnLk9wZXJhdGlvbkV2ZW50KG9wZXJhdGlvbkNvZGUsIGRlY29kZWREYXRhLCBwbGF5ZXIsIGxvY2FsLCBwcmlvKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgLy8gVE9ETyBoYW5kbGUgZXJyb3JcbiAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJFdmVudENvbnZlcnRlciN0b0dhbWVFdmVudFwiKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICogZy5FdmVudOOBi+OCiXBsYXlsb2cuRXZlbnTjgavlpInmj5vjgZnjgovjgIJcbiAgICAgKi9cbiAgICBFdmVudENvbnZlcnRlci5wcm90b3R5cGUudG9QbGF5bG9nRXZlbnQgPSBmdW5jdGlvbiAoZSwgcHJlc2VydmVQbGF5ZXIpIHtcbiAgICAgICAgdmFyIHRhcmdldElkO1xuICAgICAgICB2YXIgcGxheWVySWQ7XG4gICAgICAgIHZhciBwcmlvcml0eSA9IGUucHJpb3JpdHk7IC8vIE5PVEU6IOOBk+OBruODrOOCpOODpOODvOOBp+OBryBwcmlvcml0eSAoZXZlbnRGbGFncykg44Gu5Lit6Lqr44KS57K+5p+744GX44Gq44GE44GT44Go44Go44GZ44KLXG4gICAgICAgIHN3aXRjaCAoZS50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIGcuRXZlbnRUeXBlLkpvaW46XG4gICAgICAgICAgICBjYXNlIGcuRXZlbnRUeXBlLkxlYXZlOlxuICAgICAgICAgICAgICAgIC8vIGdhbWUtZHJpdmVyIOOBr+axuuOBl+OBpiBKb2luIOOBqCBMZWF2ZSDjgpLnlJ/miJDjgZfjgarjgYRcbiAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJFdmVudENvbnZlcnRlciN0b1BsYXlsb2dFdmVudDogSW52YWxpZCB0eXBlOiBcIiArIGcuRXZlbnRUeXBlW2UudHlwZV0pO1xuICAgICAgICAgICAgY2FzZSBnLkV2ZW50VHlwZS5UaW1lc3RhbXA6XG4gICAgICAgICAgICAgICAgdmFyIHRzID0gZTtcbiAgICAgICAgICAgICAgICBwbGF5ZXJJZCA9IHByZXNlcnZlUGxheWVyID8gdHMucGxheWVyLmlkIDogdGhpcy5fZ2FtZS5wbGF5ZXIuaWQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICAgICAgMiAvKiBUaW1lc3RhbXAgKi8sXG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICBwbGF5ZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgdHMudGltZXN0YW1wIC8vIDM6IOOCv+OCpOODoOOCueOCv+ODs+ODl1xuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICBjYXNlIGcuRXZlbnRUeXBlLlBvaW50RG93bjpcbiAgICAgICAgICAgICAgICB2YXIgcG9pbnREb3duID0gZTtcbiAgICAgICAgICAgICAgICB0YXJnZXRJZCA9IHBvaW50RG93bi50YXJnZXQgPyBwb2ludERvd24udGFyZ2V0LmlkIDogbnVsbDtcbiAgICAgICAgICAgICAgICBwbGF5ZXJJZCA9IHByZXNlcnZlUGxheWVyID8gcG9pbnREb3duLnBsYXllci5pZCA6IHRoaXMuX2dhbWUucGxheWVyLmlkO1xuICAgICAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgICAgIDMzIC8qIFBvaW50RG93biAqLyxcbiAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHksXG4gICAgICAgICAgICAgICAgICAgIHBsYXllcklkLFxuICAgICAgICAgICAgICAgICAgICBwb2ludERvd24ucG9pbnRlcklkLFxuICAgICAgICAgICAgICAgICAgICBwb2ludERvd24ucG9pbnQueCxcbiAgICAgICAgICAgICAgICAgICAgcG9pbnREb3duLnBvaW50LnksXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldElkLFxuICAgICAgICAgICAgICAgICAgICAhIXBvaW50RG93bi5sb2NhbCAvLyA3Pzog55u05YmN44Gu44Od44Kk44Oz44OI44Og44O844OW44Kk44OZ44Oz44OI44GL44KJ44GuWeW6p+aomeOBruW3rlxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICBjYXNlIGcuRXZlbnRUeXBlLlBvaW50TW92ZTpcbiAgICAgICAgICAgICAgICB2YXIgcG9pbnRNb3ZlID0gZTtcbiAgICAgICAgICAgICAgICB0YXJnZXRJZCA9IHBvaW50TW92ZS50YXJnZXQgPyBwb2ludE1vdmUudGFyZ2V0LmlkIDogbnVsbDtcbiAgICAgICAgICAgICAgICBwbGF5ZXJJZCA9IHByZXNlcnZlUGxheWVyID8gcG9pbnRNb3ZlLnBsYXllci5pZCA6IHRoaXMuX2dhbWUucGxheWVyLmlkO1xuICAgICAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgICAgIDM0IC8qIFBvaW50TW92ZSAqLyxcbiAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHksXG4gICAgICAgICAgICAgICAgICAgIHBsYXllcklkLFxuICAgICAgICAgICAgICAgICAgICBwb2ludE1vdmUucG9pbnRlcklkLFxuICAgICAgICAgICAgICAgICAgICBwb2ludE1vdmUucG9pbnQueCxcbiAgICAgICAgICAgICAgICAgICAgcG9pbnRNb3ZlLnBvaW50LnksXG4gICAgICAgICAgICAgICAgICAgIHBvaW50TW92ZS5zdGFydERlbHRhLngsXG4gICAgICAgICAgICAgICAgICAgIHBvaW50TW92ZS5zdGFydERlbHRhLnksXG4gICAgICAgICAgICAgICAgICAgIHBvaW50TW92ZS5wcmV2RGVsdGEueCxcbiAgICAgICAgICAgICAgICAgICAgcG9pbnRNb3ZlLnByZXZEZWx0YS55LFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRJZCxcbiAgICAgICAgICAgICAgICAgICAgISFwb2ludE1vdmUubG9jYWwgLy8gMTE/OiDnm7TliY3jga7jg53jgqTjg7Pjg4jjg6Djg7zjg5bjgqTjg5njg7Pjg4jjgYvjgonjga5Z5bqn5qiZ44Gu5beuXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGNhc2UgZy5FdmVudFR5cGUuUG9pbnRVcDpcbiAgICAgICAgICAgICAgICB2YXIgcG9pbnRVcCA9IGU7XG4gICAgICAgICAgICAgICAgdGFyZ2V0SWQgPSBwb2ludFVwLnRhcmdldCA/IHBvaW50VXAudGFyZ2V0LmlkIDogbnVsbDtcbiAgICAgICAgICAgICAgICBwbGF5ZXJJZCA9IHByZXNlcnZlUGxheWVyID8gcG9pbnRVcC5wbGF5ZXIuaWQgOiB0aGlzLl9nYW1lLnBsYXllci5pZDtcbiAgICAgICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgICAgICAzNSAvKiBQb2ludFVwICovLFxuICAgICAgICAgICAgICAgICAgICBwcmlvcml0eSxcbiAgICAgICAgICAgICAgICAgICAgcGxheWVySWQsXG4gICAgICAgICAgICAgICAgICAgIHBvaW50VXAucG9pbnRlcklkLFxuICAgICAgICAgICAgICAgICAgICBwb2ludFVwLnBvaW50LngsXG4gICAgICAgICAgICAgICAgICAgIHBvaW50VXAucG9pbnQueSxcbiAgICAgICAgICAgICAgICAgICAgcG9pbnRVcC5zdGFydERlbHRhLngsXG4gICAgICAgICAgICAgICAgICAgIHBvaW50VXAuc3RhcnREZWx0YS55LFxuICAgICAgICAgICAgICAgICAgICBwb2ludFVwLnByZXZEZWx0YS54LFxuICAgICAgICAgICAgICAgICAgICBwb2ludFVwLnByZXZEZWx0YS55LFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRJZCxcbiAgICAgICAgICAgICAgICAgICAgISFwb2ludFVwLmxvY2FsIC8vIDExPzog55u05YmN44Gu44Od44Kk44Oz44OI44Og44O844OW44Kk44OZ44Oz44OI44GL44KJ44GuWeW6p+aomeOBruW3rlxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICBjYXNlIGcuRXZlbnRUeXBlLk1lc3NhZ2U6XG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBlO1xuICAgICAgICAgICAgICAgIHBsYXllcklkID0gcHJlc2VydmVQbGF5ZXIgPyBtZXNzYWdlLnBsYXllci5pZCA6IHRoaXMuX2dhbWUucGxheWVyLmlkO1xuICAgICAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgICAgIDMyIC8qIE1lc3NhZ2UgKi8sXG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICBwbGF5ZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5kYXRhLFxuICAgICAgICAgICAgICAgICAgICAhIW1lc3NhZ2UubG9jYWwgLy8gND86IOODreODvOOCq+ODq1xuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICBjYXNlIGcuRXZlbnRUeXBlLk9wZXJhdGlvbjpcbiAgICAgICAgICAgICAgICB2YXIgb3AgPSBlO1xuICAgICAgICAgICAgICAgIHBsYXllcklkID0gcHJlc2VydmVQbGF5ZXIgPyBvcC5wbGF5ZXIuaWQgOiB0aGlzLl9nYW1lLnBsYXllci5pZDtcbiAgICAgICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgICAgICA2NCAvKiBPcGVyYXRpb24gKi8sXG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICBwbGF5ZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgb3AuY29kZSxcbiAgICAgICAgICAgICAgICAgICAgb3AuZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgISFvcC5sb2NhbCAvLyA1Pzog44Ot44O844Kr44OrXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiVW5rbm93biB0eXBlOiBcIiArIGUudHlwZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEV2ZW50Q29udmVydGVyLnByb3RvdHlwZS5tYWtlUGxheWxvZ09wZXJhdGlvbkV2ZW50ID0gZnVuY3Rpb24gKG9wKSB7XG4gICAgICAgIHZhciBwbGF5ZXJJZCA9IHRoaXMuX2dhbWUucGxheWVyLmlkO1xuICAgICAgICB2YXIgcHJpb3JpdHkgPSAob3AucHJpb3JpdHkgIT0gbnVsbCkgPyAzIC8qIFByaW9yaXR5ICovICYgb3AucHJpb3JpdHkgOiAwO1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgNjQgLyogT3BlcmF0aW9uICovLFxuICAgICAgICAgICAgcHJpb3JpdHksXG4gICAgICAgICAgICBwbGF5ZXJJZCxcbiAgICAgICAgICAgIG9wLl9jb2RlLFxuICAgICAgICAgICAgb3AuZGF0YSxcbiAgICAgICAgICAgICEhb3AubG9jYWwgLy8gNTog44Ot44O844Kr44OrXG4gICAgICAgIF07XG4gICAgfTtcbiAgICByZXR1cm4gRXZlbnRDb252ZXJ0ZXI7XG59KCkpO1xuZXhwb3J0cy5FdmVudENvbnZlcnRlciA9IEV2ZW50Q29udmVydGVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4vKipcbiAqIGBHYW1lTG9vcGAg44Gu5a6f6KGM44Oi44O844OJ44CCXG4gKi9cbnZhciBFeGVjdXRpb25Nb2RlO1xuKGZ1bmN0aW9uIChFeGVjdXRpb25Nb2RlKSB7XG4gICAgLyoqXG4gICAgICogYEdhbWVMb29wYCDjgYxhY3RpdmXjgafjgYLjgovjgIJcbiAgICAgKlxuICAgICAqIGBHYW1lTG9vcCNfZXhlY3V0aW9uTW9kZWAg44GM44GT44Gu5YCk44Gn44GC44KL5aC05ZCI44CB44Gd44Gu44Kk44Oz44K544K/44Oz44K544GvOlxuICAgICAqICAtIHBsYXlsb2cuRXZlbnTjgpLlpJbpg6jjgYvjgonlj5fjgZHku5jjgZHjgotcbiAgICAgKiAgLSBwbGF5bG9nLlRpY2vjgpLnlJ/miJDjgZflpJbpg6jjgbjpgIHkv6HjgZnjgotcbiAgICAgKi9cbiAgICBFeGVjdXRpb25Nb2RlW0V4ZWN1dGlvbk1vZGVbXCJBY3RpdmVcIl0gPSAwXSA9IFwiQWN0aXZlXCI7XG4gICAgLyoqXG4gICAgICogYEdhbWVMb29wYCDjgYxwYXNzaXZl44Gn44GC44KL44CCXG4gICAgICpcbiAgICAgKiBgR2FtZUxvb3AjX2V4ZWN1dGlvbk1vZGVgIOOBjOOBk+OBruWApOOBp+OBguOCi+WgtOWQiOOAgeOBneOBruOCpOODs+OCueOCv+ODs+OCueOBrzpcbiAgICAgKiAgLSBwbGF5bG9nLkV2ZW5044KS5aSW6YOo44Gr6YCB5L+h44GZ44KLXG4gICAgICogIC0gcGxheWxvZy5UaWNr44KS5Y+X5L+h44GX44CB44Gd44KM44Gr5Z+644Gl44GE44GmIGBnLkdhbWUjdGljaygpYCDjgpLlkbzjgbPlh7rjgZlcbiAgICAgKi9cbiAgICBFeGVjdXRpb25Nb2RlW0V4ZWN1dGlvbk1vZGVbXCJQYXNzaXZlXCJdID0gMV0gPSBcIlBhc3NpdmVcIjtcbn0pKEV4ZWN1dGlvbk1vZGUgfHwgKEV4ZWN1dGlvbk1vZGUgPSB7fSkpO1xuZXhwb3J0cy5kZWZhdWx0ID0gRXhlY3V0aW9uTW9kZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkdhbWUgPSB2b2lkIDA7XG52YXIgZyA9IHJlcXVpcmUoXCJAYWthc2hpYy9ha2FzaGljLWVuZ2luZVwiKTtcbi8qKlxuICogR2FtZeOCr+ODqeOCueOAglxuICpcbiAqIOOBk+OBruOCr+ODqeOCueOBr2FrYXNoaWMtZW5naW5l44Gr55Sx5p2l44GZ44KL44Kv44Op44K544Gn44GC44KK44CBXG4gKiDjgqLjg7Pjg4Djg7zjgrnjgrPjgqLjgaflp4vjgb7jgovjg5fjg63jg5Hjg4bjgqMgKGUuZy4gX2Zvbykg44KS5aSW6YOo44GL44KJ5Y+C54Wn44GZ44KL5aC05ZCI44GM44GC44KL54K544Gr5rOo5oSP44CCXG4gKiAoYWthc2hpYy1lbmdpbmUg44Gr44GK44GE44Gm44Gv44CBX2ZvbyDjga/jgIzjgrLjg7zjg6DplovnmbrogIXlkJHjgZHjgafjgarjgYTjgI3jgZPjgajjgZfjgYvmhI/lkbPjgZfjgarjgYTjgIIpXG4gKi9cbnZhciBHYW1lID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhHYW1lLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIEdhbWUocGFyYW0pIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcGFyYW0uY29uZmlndXJhdGlvbiwgcGFyYW0ucmVzb3VyY2VGYWN0b3J5LCBwYXJhbS5hc3NldEJhc2UsIHBhcmFtLnBsYXllci5pZCwgcGFyYW0ub3BlcmF0aW9uUGx1Z2luVmlld0luZm8pIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLmFnZVBhc3NlZFRyaWdnZXIgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgIF90aGlzLnRhcmdldFRpbWVSZWFjaGVkVHJpZ2dlciA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgX3RoaXMuc2tpcHBpbmdDaGFuZ2VkVHJpZ2dlciA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgX3RoaXMuYWJvcnRUcmlnZ2VyID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICBfdGhpcy5wbGF5ZXIgPSBwYXJhbS5wbGF5ZXI7XG4gICAgICAgIF90aGlzLnJhaXNlRXZlbnRUcmlnZ2VyID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICBfdGhpcy5yYWlzZVRpY2tUcmlnZ2VyID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICBfdGhpcy5zbmFwc2hvdFRyaWdnZXIgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgIF90aGlzLmlzU25hcHNob3RTYXZlciA9ICEhcGFyYW0uaXNTbmFwc2hvdFNhdmVyO1xuICAgICAgICBfdGhpcy5fZ2V0Q3VycmVudFRpbWVGdW5jID0gbnVsbDtcbiAgICAgICAgX3RoaXMuX2V2ZW50RmlsdGVyRnVuY3MgPSBudWxsO1xuICAgICAgICBfdGhpcy5fbm90aWZ5UGFzc2VkQWdlVGFibGUgPSB7fTtcbiAgICAgICAgX3RoaXMuX25vdGlmaWVzVGFyZ2V0VGltZVJlYWNoZWQgPSBmYWxzZTtcbiAgICAgICAgX3RoaXMuX2lzU2tpcEF3YXJlID0gZmFsc2U7XG4gICAgICAgIF90aGlzLl9nYW1lQXJncyA9IHBhcmFtLmdhbWVBcmdzO1xuICAgICAgICBfdGhpcy5fZ2xvYmFsR2FtZUFyZ3MgPSBwYXJhbS5nbG9iYWxHYW1lQXJncztcbiAgICAgICAgX3RoaXMuc2tpcHBpbmdDaGFuZ2VkVHJpZ2dlci5hZGQoX3RoaXMuX29uU2tpcHBpbmdDaGFuZ2VkLCBfdGhpcyk7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICog54m55a6aYWdl5Yiw6YGU5pmC44Gu6YCa55+l44KS6KaB5rGC44GZ44KL44CCXG4gICAgICogQHBhcmFtIGFnZSDpgJrnn6XjgpLopoHmsYLjgZnjgothZ2VcbiAgICAgKi9cbiAgICBHYW1lLnByb3RvdHlwZS5yZXF1ZXN0Tm90aWZ5QWdlUGFzc2VkID0gZnVuY3Rpb24gKGFnZSkge1xuICAgICAgICB0aGlzLl9ub3RpZnlQYXNzZWRBZ2VUYWJsZVthZ2VdID0gdHJ1ZTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOeJueWummFnZeWIsOmBlOaZguOBrumAmuefpeimgeaxguOCkuino+mZpOOBmeOCi+OAglxuICAgICAqIEBwYXJhbSBhZ2Ug6YCa55+l6KaB5rGC44KS6Kej6Zmk44GZ44KLYWdlXG4gICAgICovXG4gICAgR2FtZS5wcm90b3R5cGUuY2FuY2VsTm90aWZ5QWdlUGFzc2VkID0gZnVuY3Rpb24gKGFnZSkge1xuICAgICAgICBkZWxldGUgdGhpcy5fbm90aWZ5UGFzc2VkQWdlVGFibGVbYWdlXTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOasoeOBq+ebruaomeaZguWIu+OCkuWIsOmBlOOBl+OBn+aZgueCueOCkumAmuefpeOBmeOCi+OCiOOBhuimgeaxguOBmeOCi+OAglxuICAgICAqIOmHjeikh+WRvOOBs+WHuuOBl+OBr+OCteODneODvOODiOOBl+OBpuOBhOOBquOBhOOAguOBmeOBquOCj+OBoeOAgeWRvOOBs+WHuuOBl+W+jCBgdGFyZ2V0VGltZVJlYWNoZWRUcmlnZ2VyYCDjgYxmaXJl44GV44KM44KL44G+44Gn44Gu5ZG844Gz5Ye644GX44Gv54Sh6KaW44GV44KM44KL44CCXG4gICAgICovXG4gICAgR2FtZS5wcm90b3R5cGUucmVxdWVzdE5vdGlmeVRhcmdldFRpbWVSZWFjaGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9ub3RpZmllc1RhcmdldFRpbWVSZWFjaGVkID0gdHJ1ZTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOebruaomeaZguWIu+OCkuWIsOmBlOOBl+OBn+aZgueCueOCkumAmuefpeimgeaxguOCkuino+mZpOOBmeOCi+OAglxuICAgICAqL1xuICAgIEdhbWUucHJvdG90eXBlLmNhbmNlbE5vZml0eVRhcmdldFRpbWVSZWFjaGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9ub3RpZmllc1RhcmdldFRpbWVSZWFjaGVkID0gZmFsc2U7XG4gICAgfTtcbiAgICBHYW1lLnByb3RvdHlwZS5maXJlQWdlUGFzc2VkSWZOZWVkZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhZ2UgPSB0aGlzLmFnZSAtIDE7IC8vIOmAmumBjua4iOOBv+OBrmFnZeOCkueiuuiqjeOBmeOCi+OBn+OCgSAtMSDjgZnjgovjgIJcbiAgICAgICAgaWYgKHRoaXMuX25vdGlmeVBhc3NlZEFnZVRhYmxlW2FnZV0pIHtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9ub3RpZnlQYXNzZWRBZ2VUYWJsZVthZ2VdO1xuICAgICAgICAgICAgdGhpcy5hZ2VQYXNzZWRUcmlnZ2VyLmZpcmUoYWdlKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGBHYW1lYCDjgYzliKnnlKjjgZnjgovmmYLliLvlj5blvpfplqLmlbDjgpLjgrvjg4Pjg4jjgZnjgovjgIJcbiAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga8gYEdhbWUjX2xvYWQoKWAg5ZG844Gz5Ye644GX44Gr5YWI6KGM44GX44Gm5ZG844Gz5Ye644GV44KM44Gm44GE44Gq44GR44KM44Gw44Gq44KJ44Gq44GE44CCXG4gICAgICovXG4gICAgR2FtZS5wcm90b3R5cGUuc2V0Q3VycmVudFRpbWVGdW5jID0gZnVuY3Rpb24gKGZ1bikge1xuICAgICAgICB0aGlzLl9nZXRDdXJyZW50VGltZUZ1bmMgPSBmdW47XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBgR2FtZWAg44Gu44Kk44OZ44Oz44OI44OV44Kj44Or44K/6Zai6YCj5a6f6KOF44KS44K744OD44OI44GZ44KL44CCXG4gICAgICog44GT44Gu44Oh44K944OD44OJ44GvIGBHYW1lI19sb2FkKClgIOWRvOOBs+WHuuOBl+OBq+WFiOihjOOBl+OBpuWRvOOBs+WHuuOBleOCjOOBpuOBhOOBquOBkeOCjOOBsOOBquOCieOBquOBhOOAglxuICAgICAqL1xuICAgIEdhbWUucHJvdG90eXBlLnNldEV2ZW50RmlsdGVyRnVuY3MgPSBmdW5jdGlvbiAoZnVuY3MpIHtcbiAgICAgICAgdGhpcy5fZXZlbnRGaWx0ZXJGdW5jcyA9IGZ1bmNzO1xuICAgIH07XG4gICAgR2FtZS5wcm90b3R5cGUuc2V0U3RvcmFnZUZ1bmMgPSBmdW5jdGlvbiAoZnVuY3MpIHtcbiAgICAgICAgdGhpcy5zdG9yYWdlLl9yZWdpc3RlckxvYWQoZnVuY3Muc3RvcmFnZUdldEZ1bmMpO1xuICAgICAgICB0aGlzLnN0b3JhZ2UuX3JlZ2lzdGVyV3JpdGUoZnVuY3Muc3RvcmFnZVB1dEZ1bmMpO1xuICAgICAgICAvLyBUT0RPOiBha2FzaGljLWVuZ2luZSDlgbTjgafmm7jjgY3mj5vjgYjjgonjgozjgovjgojjgYbjgavjgZnjgotcbiAgICAgICAgdGhpcy5zdG9yYWdlLnJlcXVlc3RWYWx1ZXNGb3JKb2luUGxheWVyID0gZnVuY3MucmVxdWVzdFZhbHVlc0ZvckpvaW5GdW5jO1xuICAgIH07XG4gICAgR2FtZS5wcm90b3R5cGUuZ2V0SXNTa2lwQXdhcmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pc1NraXBBd2FyZTtcbiAgICB9O1xuICAgIEdhbWUucHJvdG90eXBlLnNldElzU2tpcEF3YXJlID0gZnVuY3Rpb24gKGF3YXJlKSB7XG4gICAgICAgIHRoaXMuX2lzU2tpcEF3YXJlID0gYXdhcmU7XG4gICAgfTtcbiAgICBHYW1lLnByb3RvdHlwZS5nZXRDdXJyZW50VGltZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gR2FtZUxvb3Djga7lkIzlkI3jg6Hjgr3jg4Pjg4njgajjga/miLvjgorlgKTjgYznlbDjgarjgovjgYzjgIEgYEdhbWUuZ2V0Q3VycmVudFRpbWUoKWAg44GvIGBEYXRlLm5vdygpYCDjga7ku6Pmm7/jgajjgZfjgabkvb/nlKjjgZXjgozjgovjgZ/jgoHjgIHmlbTmlbDlgKTjgpLov5TjgZnjgIJcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IodGhpcy5fZ2V0Q3VycmVudFRpbWVGdW5jKCkpO1xuICAgIH07XG4gICAgR2FtZS5wcm90b3R5cGUucmFpc2VFdmVudCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB0aGlzLnJhaXNlRXZlbnRUcmlnZ2VyLmZpcmUoZXZlbnQpO1xuICAgIH07XG4gICAgLy8gVE9ETzogKFdJUCkgcGxheWxvZy5FdmVudFtdIOOCkuOBqOOCi+OBueOBjeOBi+aknOiojuOBl+WvvuW/nOOBmeOCi+OAglxuICAgIEdhbWUucHJvdG90eXBlLnJhaXNlVGljayA9IGZ1bmN0aW9uIChldmVudHMpIHtcbiAgICAgICAgaWYgKCF0aGlzLnNjZW5lKCkgfHwgdGhpcy5zY2VuZSgpLnRpY2tHZW5lcmF0aW9uTW9kZSAhPT0gZy5UaWNrR2VuZXJhdGlvbk1vZGUuTWFudWFsKVxuICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiR2FtZSNyYWlzZVRpY2soKTogdGlja0dlbmVyYXRpb25Nb2RlIGZvciB0aGUgY3VycmVudCBzY2VuZSBpcyBub3QgTWFudWFsLlwiKTtcbiAgICAgICAgdGhpcy5yYWlzZVRpY2tUcmlnZ2VyLmZpcmUoZXZlbnRzKTtcbiAgICB9O1xuICAgIEdhbWUucHJvdG90eXBlLmFkZEV2ZW50RmlsdGVyID0gZnVuY3Rpb24gKGZpbHRlciwgaGFuZGxlRW1wdHkpIHtcbiAgICAgICAgdGhpcy5fZXZlbnRGaWx0ZXJGdW5jcy5hZGRGaWx0ZXIoZmlsdGVyLCBoYW5kbGVFbXB0eSk7XG4gICAgfTtcbiAgICBHYW1lLnByb3RvdHlwZS5yZW1vdmVFdmVudEZpbHRlciA9IGZ1bmN0aW9uIChmaWx0ZXIpIHtcbiAgICAgICAgdGhpcy5fZXZlbnRGaWx0ZXJGdW5jcy5yZW1vdmVGaWx0ZXIoZmlsdGVyKTtcbiAgICB9O1xuICAgIEdhbWUucHJvdG90eXBlLnNob3VsZFNhdmVTbmFwc2hvdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNTbmFwc2hvdFNhdmVyO1xuICAgIH07XG4gICAgLy8gTk9URTog54++54q25a6f6KOF44GMIGBzaG91bGRTYXZlU25hcHNob3QoKWAg44Go562J5L6h44Gq44Gu44Gn44CB57Ch5piT5a++5b+c44Go44GX44Gm44GT44Gu5a6f6KOF44KS55So44GE44KL44CCXG4gICAgR2FtZS5wcm90b3R5cGUuaXNBY3RpdmVJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2hvdWxkU2F2ZVNuYXBzaG90KCk7XG4gICAgfTtcbiAgICBHYW1lLnByb3RvdHlwZS5zYXZlU25hcHNob3QgPSBmdW5jdGlvbiAoZ2FtZVNuYXBzaG90LCB0aW1lc3RhbXApIHtcbiAgICAgICAgaWYgKHRpbWVzdGFtcCA9PT0gdm9pZCAwKSB7IHRpbWVzdGFtcCA9IHRoaXMuX2dldEN1cnJlbnRUaW1lRnVuYygpOyB9XG4gICAgICAgIGlmICghdGhpcy5zaG91bGRTYXZlU25hcHNob3QoKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy5zbmFwc2hvdFRyaWdnZXIuZmlyZSh7XG4gICAgICAgICAgICBmcmFtZTogdGhpcy5hZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcCxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICByYW5kR2VuU2VyOiB0aGlzLnJhbmRvbVswXS5zZXJpYWxpemUoKSxcbiAgICAgICAgICAgICAgICBnYW1lU25hcHNob3Q6IGdhbWVTbmFwc2hvdFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEdhbWUucHJvdG90eXBlLl9kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmFnZVBhc3NlZFRyaWdnZXIuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLmFnZVBhc3NlZFRyaWdnZXIgPSBudWxsO1xuICAgICAgICB0aGlzLnRhcmdldFRpbWVSZWFjaGVkVHJpZ2dlci5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMudGFyZ2V0VGltZVJlYWNoZWRUcmlnZ2VyID0gbnVsbDtcbiAgICAgICAgdGhpcy5za2lwcGluZ0NoYW5nZWRUcmlnZ2VyLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5za2lwcGluZ0NoYW5nZWRUcmlnZ2VyID0gbnVsbDtcbiAgICAgICAgdGhpcy5hYm9ydFRyaWdnZXIuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLmFib3J0VHJpZ2dlciA9IG51bGw7XG4gICAgICAgIHRoaXMucGxheWVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5yYWlzZUV2ZW50VHJpZ2dlci5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMucmFpc2VFdmVudFRyaWdnZXIgPSBudWxsO1xuICAgICAgICB0aGlzLnJhaXNlVGlja1RyaWdnZXIuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLnJhaXNlVGlja1RyaWdnZXIgPSBudWxsO1xuICAgICAgICB0aGlzLnNuYXBzaG90VHJpZ2dlci5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMuc25hcHNob3RUcmlnZ2VyID0gbnVsbDtcbiAgICAgICAgdGhpcy5pc1NuYXBzaG90U2F2ZXIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fZ2V0Q3VycmVudFRpbWVGdW5jID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZXZlbnRGaWx0ZXJGdW5jcyA9IG51bGw7XG4gICAgICAgIHRoaXMuX25vdGlmeVBhc3NlZEFnZVRhYmxlID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZ2FtZUFyZ3MgPSBudWxsO1xuICAgICAgICB0aGlzLl9nbG9iYWxHYW1lQXJncyA9IG51bGw7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuX2Rlc3Ryb3kuY2FsbCh0aGlzKTtcbiAgICB9O1xuICAgIEdhbWUucHJvdG90eXBlLl9yZXN0YXJ0V2l0aFNuYXBzaG90ID0gZnVuY3Rpb24gKHNuYXBzaG90KSB7XG4gICAgICAgIHZhciBkYXRhID0gc25hcHNob3QuZGF0YTtcbiAgICAgICAgdGhpcy5fZXZlbnRGaWx0ZXJGdW5jcy5yZW1vdmVGaWx0ZXIoKTtcbiAgICAgICAgaWYgKGRhdGEuc2VlZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAvLyDkvovlpJbjgrHjg7zjgrk6IOesrDDjgrnjgr/jg7zjg4jjg53jgqTjg7Pjg4jjgafjgrnjg4rjg4Pjg5fjgrfjg6fjg4Pjg4jjga/mjIHjgaPjgabjgYTjgarjgYTjga7jgafnibnliKXlr77lv5xcbiAgICAgICAgICAgIHZhciByYW5kR2VuID0gbmV3IGcuWG9yc2hpZnRSYW5kb21HZW5lcmF0b3IoZGF0YS5zZWVkKTtcbiAgICAgICAgICAgIHRoaXMuX3Jlc2V0KHsgYWdlOiBzbmFwc2hvdC5mcmFtZSwgcmFuZEdlbjogcmFuZEdlbiB9KTtcbiAgICAgICAgICAgIHRoaXMuX2xvYWRBbmRTdGFydCh7IGFyZ3M6IHRoaXMuX2dhbWVBcmdzLCBnbG9iYWxBcmdzOiB0aGlzLl9nbG9iYWxHYW1lQXJncyB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciByYW5kR2VuID0gbmV3IGcuWG9yc2hpZnRSYW5kb21HZW5lcmF0b3IoMCwgZGF0YS5yYW5kR2VuU2VyKTtcbiAgICAgICAgICAgIHRoaXMuX3Jlc2V0KHsgYWdlOiBzbmFwc2hvdC5mcmFtZSwgcmFuZEdlbjogcmFuZEdlbiB9KTtcbiAgICAgICAgICAgIHRoaXMuX2xvYWRBbmRTdGFydCh7IHNuYXBzaG90OiBkYXRhLmdhbWVTbmFwc2hvdCB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgR2FtZS5wcm90b3R5cGUuX2xlYXZlR2FtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gZG8gbm90aGluZy5cbiAgICB9O1xuICAgIEdhbWUucHJvdG90eXBlLl9hYm9ydEdhbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuYWJvcnRUcmlnZ2VyLmZpcmUoKTtcbiAgICB9O1xuICAgIEdhbWUucHJvdG90eXBlLl9vblJhd1RhcmdldFRpbWVSZWFjaGVkID0gZnVuY3Rpb24gKHRhcmdldFRpbWUpIHtcbiAgICAgICAgaWYgKHRoaXMuX25vdGlmaWVzVGFyZ2V0VGltZVJlYWNoZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX25vdGlmaWVzVGFyZ2V0VGltZVJlYWNoZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0VGltZVJlYWNoZWRUcmlnZ2VyLmZpcmUodGFyZ2V0VGltZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEdhbWUucHJvdG90eXBlLl9vblNraXBwaW5nQ2hhbmdlZCA9IGZ1bmN0aW9uIChza2lwcGluZykge1xuICAgICAgICBpZiAodGhpcy5faXNTa2lwQXdhcmUpIHtcbiAgICAgICAgICAgIHRoaXMuc2tpcHBpbmdDaGFuZ2VkLmZpcmUoc2tpcHBpbmcpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gR2FtZTtcbn0oZy5HYW1lKSk7XG5leHBvcnRzLkdhbWUgPSBHYW1lO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkdhbWVEcml2ZXIgPSB2b2lkIDA7XG52YXIgZXM2X3Byb21pc2VfMSA9IHJlcXVpcmUoXCJlczYtcHJvbWlzZVwiKTtcbnZhciBnID0gcmVxdWlyZShcIkBha2FzaGljL2FrYXNoaWMtZW5naW5lXCIpO1xudmFyIEV4ZWN1dGlvbk1vZGVfMSA9IHJlcXVpcmUoXCIuL0V4ZWN1dGlvbk1vZGVcIik7XG52YXIgR2FtZV8xID0gcmVxdWlyZShcIi4vR2FtZVwiKTtcbnZhciBFdmVudEJ1ZmZlcl8xID0gcmVxdWlyZShcIi4vRXZlbnRCdWZmZXJcIik7XG52YXIgR2FtZUxvb3BfMSA9IHJlcXVpcmUoXCIuL0dhbWVMb29wXCIpO1xudmFyIFBkaVV0aWxfMSA9IHJlcXVpcmUoXCIuL1BkaVV0aWxcIik7XG52YXIgR0FNRV9ERVNUUk9ZRURfTUVTU0FHRSA9IFwiR0FNRV9ERVNUUk9ZRURcIjtcbnZhciBHYW1lRHJpdmVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEdhbWVEcml2ZXIocGFyYW0pIHtcbiAgICAgICAgdGhpcy5lcnJvclRyaWdnZXIgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgIGlmIChwYXJhbS5lcnJvckhhbmRsZXIpXG4gICAgICAgICAgICB0aGlzLmVycm9yVHJpZ2dlci5hZGQocGFyYW0uZXJyb3JIYW5kbGVyLCBwYXJhbS5lcnJvckhhbmRsZXJPd25lcik7XG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbkxvYWRlZFRyaWdnZXIgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgIHRoaXMuZ2FtZUNyZWF0ZWRUcmlnZ2VyID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICB0aGlzLl9wbGF0Zm9ybSA9IHBhcmFtLnBsYXRmb3JtO1xuICAgICAgICB0aGlzLl9sb2FkQ29uZmlndXJhdGlvbkZ1bmMgPSBQZGlVdGlsXzEuUGRpVXRpbC5tYWtlTG9hZENvbmZpZ3VyYXRpb25GdW5jKHBhcmFtLnBsYXRmb3JtKTtcbiAgICAgICAgdGhpcy5fcGxheWVyID0gcGFyYW0ucGxheWVyO1xuICAgICAgICB0aGlzLl9yZW5kZXJlclJlcXVpcmVtZW50ID0gbnVsbDtcbiAgICAgICAgdGhpcy5fcGxheUlkID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZ2FtZSA9IG51bGw7XG4gICAgICAgIHRoaXMuX2dhbWVMb29wID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZXZlbnRCdWZmZXIgPSBudWxsO1xuICAgICAgICB0aGlzLl9vcGVuZWRBbWZsb3cgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fcGxheVRva2VuID0gbnVsbDtcbiAgICAgICAgdGhpcy5fcGVybWlzc2lvbiA9IG51bGw7XG4gICAgICAgIHRoaXMuX2hpZGRlbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9kZXN0cm95ZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogYEdhbWVEcml2ZXJgIOOCkuWIneacn+WMluOBmeOCi+OAglxuICAgICAqL1xuICAgIEdhbWVEcml2ZXIucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAocGFyYW0sIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuZG9Jbml0aWFsaXplKHBhcmFtKS50aGVuKGZ1bmN0aW9uICgpIHsgY2FsbGJhY2soKTsgfSwgY2FsbGJhY2spO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogYEdhbWVEcml2ZXJgIOOBruWQhOeorueKtuaFi+OCkuWkieabtOOBmeOCi+OAglxuICAgICAqXG4gICAgICog5byV5pWwIGBwYXJhbWAg44Gu44GG44Gh44CB55yB55Wl44GV44KM44Gq44GL44Gj44Gf5YCk44GM5paw44Gf44Gr6Kit5a6a44GV44KM44KL44CCXG4gICAgICogYHN0YXJ0R2FtZSgpYCDjgavjgojjgorjgrLjg7zjg6DjgYzplovlp4vjgZXjgozjgabjgYTjgZ/loLTlkIjjgIHmmpfpu5njgasgYHN0b3BHYW1lKClgIOOBjOihjOOCj+OCjOOAgeWujOS6huW+jCBgc3RhcnRHYW1lKClgIOOBleOCjOOCi+OAglxuICAgICAqL1xuICAgIEdhbWVEcml2ZXIucHJvdG90eXBlLmNoYW5nZVN0YXRlID0gZnVuY3Rpb24gKHBhcmFtLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgcGF1c2luZyA9IHRoaXMuX2dhbWVMb29wICYmIHRoaXMuX2dhbWVMb29wLnJ1bm5pbmc7XG4gICAgICAgIGlmIChwYXVzaW5nKVxuICAgICAgICAgICAgdGhpcy5fZ2FtZUxvb3Auc3RvcCgpO1xuICAgICAgICB0aGlzLmluaXRpYWxpemUocGFyYW0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwYXVzaW5nKVxuICAgICAgICAgICAgICAgIF90aGlzLl9nYW1lTG9vcC5zdGFydCgpO1xuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiDjgrLjg7zjg6DjgpLplovlp4vjgZnjgovjgIJcbiAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga7lkbzjgbPlh7rjgZfjga/jgIEgYGluaXRpYWxpemUoKWAg44Gu5a6M5LqG5b6M44Gn44Gq44GR44KM44Gw44Gq44KJ44Gq44GE44CCXG4gICAgICovXG4gICAgR2FtZURyaXZlci5wcm90b3R5cGUuc3RhcnRHYW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2dhbWVMb29wKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yVHJpZ2dlci5maXJlKG5ldyBFcnJvcihcIk5vdCBpbml0aWFsaXplZFwiKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fZ2FtZUxvb3Auc3RhcnQoKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOOCsuODvOODoOOCkijkuIDmmYLnmoTjgasp5q2i44KB44KL44CCXG4gICAgICpcbiAgICAgKiDjgZPjga7jg6Hjgr3jg4Pjg4njga7lkbzjgbPlh7rjgZflvozjgIEgYHN0YXJ0R2FtZSgpYCDjgYzlkbzjgbPlh7rjgZXjgozjgovjgb7jgafjgIEgYEdhbWUjdGljaygpYCDjga/lkbzjgbPlh7rjgZXjgozjgarjgYTjgIJcbiAgICAgKiBBY3RpdmUg44Gn44GC44KM44Gw44OG44Kj44OD44Kv44Gu55Sf5oiQ44GM6KGM44KP44KM44Ga44CBIFBhc3NpdmUg44Gn44GC44KM44Gw5Y+X5L+h44GX44Gf44OG44Kj44OD44Kv44Gv6JOE56mN44GV44KM44KL44CCXG4gICAgICovXG4gICAgR2FtZURyaXZlci5wcm90b3R5cGUuc3RvcEdhbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9nYW1lTG9vcCkge1xuICAgICAgICAgICAgdGhpcy5fZ2FtZUxvb3Auc3RvcCgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiDjgZPjga7jg4njg6njgqTjg5DjgYzmrKHjgavjg4bjgqPjg4Pjgq/jgpLnlJ/miJDjgZnjgovloLTlkIjjga7jgIFhZ2Xjga7lgKTjgpLoqK3lrprjgZnjgovjgIJcbiAgICAgKiBgRXhlY3V0aW9uTW9kZS5BY3RpdmVgIOOBp+OBquOBhOWgtOWQiOOAgeWLleS9nOOBq+W9semfv+OCkuS4juOBiOOBquOBhOOAglxuICAgICAqIOOBk+OBruODoeOCveODg+ODieOBruWRvOOBs+WHuuOBl+OBr+OAgSBgaW5pdGlhbGl6ZSgpYCDjga7lrozkuoblvozjgafjgarjgZHjgozjgbDjgarjgonjgarjgYTjgIJcbiAgICAgKlxuICAgICAqIEBwYXJhbSBhZ2Ug5qyh44Gr55Sf5oiQ44GV44KM44KL44OG44Kj44OD44Kv44GuYWdlXG4gICAgICovXG4gICAgR2FtZURyaXZlci5wcm90b3R5cGUuc2V0TmV4dEFnZSA9IGZ1bmN0aW9uIChhZ2UpIHtcbiAgICAgICAgdGhpcy5fZ2FtZUxvb3Auc2V0TmV4dEFnZShhZ2UpO1xuICAgIH07XG4gICAgR2FtZURyaXZlci5wcm90b3R5cGUuZ2V0UGVybWlzc2lvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Blcm1pc3Npb247XG4gICAgfTtcbiAgICBHYW1lRHJpdmVyLnByb3RvdHlwZS5nZXREcml2ZXJDb25maWd1cmF0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGxheUlkOiB0aGlzLl9wbGF5SWQsXG4gICAgICAgICAgICBwbGF5VG9rZW46IHRoaXMuX3BsYXlUb2tlbixcbiAgICAgICAgICAgIGV4ZWN1dGlvbk1vZGU6IHRoaXMuX2dhbWVMb29wID8gdGhpcy5fZ2FtZUxvb3AuZ2V0RXhlY3V0aW9uTW9kZSgpIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZXZlbnRCdWZmZXJNb2RlOiB0aGlzLl9ldmVudEJ1ZmZlciA/IHRoaXMuX2V2ZW50QnVmZmVyLmdldE1vZGUoKSA6IHVuZGVmaW5lZFxuICAgICAgICB9O1xuICAgIH07XG4gICAgR2FtZURyaXZlci5wcm90b3R5cGUuZ2V0TG9vcENvbmZpZ3VyYXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9nYW1lTG9vcCA/IHRoaXMuX2dhbWVMb29wLmdldExvb3BDb25maWd1cmF0aW9uKCkgOiBudWxsO1xuICAgIH07XG4gICAgR2FtZURyaXZlci5wcm90b3R5cGUuZ2V0SGlkZGVuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faGlkZGVuO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogUERJ44Gr5a++44GX44Gm44OX44Op44Kk44Oe44Oq44K144O844OV44Kn44K544Gu44Oq44K744OD44OI44KS6KaB5rGC44GZ44KL44CCXG4gICAgICpcbiAgICAgKiBAcGFyYW0gd2lkdGgg44OX44Op44Kk44Oe44Oq44K144O844OV44Kn44K544Gu5bmF44CCXG4gICAgICogQHBhcmFtIGhlaWdodCDjg5fjg6njgqTjg57jg6rjgrXjg7zjg5Xjgqfjgrnjga7pq5jjgZXjgIJcbiAgICAgKiBAcGFyYW0gcmVuZGVyZXJDYW5kaWRhdGVzIFJlbmRlcmVy44Gu44K/44Kk44OX44CCXG4gICAgICovXG4gICAgR2FtZURyaXZlci5wcm90b3R5cGUucmVzZXRQcmltYXJ5U3VyZmFjZSA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0LCByZW5kZXJlckNhbmRpZGF0ZXMpIHtcbiAgICAgICAgcmVuZGVyZXJDYW5kaWRhdGVzID0gcmVuZGVyZXJDYW5kaWRhdGVzID8gcmVuZGVyZXJDYW5kaWRhdGVzXG4gICAgICAgICAgICA6IHRoaXMuX3JlbmRlcmVyUmVxdWlyZW1lbnQgPyB0aGlzLl9yZW5kZXJlclJlcXVpcmVtZW50LnJlbmRlcmVyQ2FuZGlkYXRlc1xuICAgICAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgdmFyIGdhbWUgPSB0aGlzLl9nYW1lO1xuICAgICAgICB2YXIgcGYgPSB0aGlzLl9wbGF0Zm9ybTtcbiAgICAgICAgdmFyIHByaW1hcnlTdXJmYWNlID0gcGYuZ2V0UHJpbWFyeVN1cmZhY2UoKTtcbiAgICAgICAgZ2FtZS5yZW5kZXJlcnMgPSBnYW1lLnJlbmRlcmVycy5maWx0ZXIoZnVuY3Rpb24gKHJlbmRlcmVyKSB7IHJldHVybiByZW5kZXJlciAhPT0gcHJpbWFyeVN1cmZhY2UucmVuZGVyZXIoKTsgfSk7XG4gICAgICAgIHBmLnNldFJlbmRlcmVyUmVxdWlyZW1lbnQoe1xuICAgICAgICAgICAgcHJpbWFyeVN1cmZhY2VXaWR0aDogd2lkdGgsXG4gICAgICAgICAgICBwcmltYXJ5U3VyZmFjZUhlaWdodDogaGVpZ2h0LFxuICAgICAgICAgICAgcmVuZGVyZXJDYW5kaWRhdGVzOiByZW5kZXJlckNhbmRpZGF0ZXNcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX3JlbmRlcmVyUmVxdWlyZW1lbnQgPSB7XG4gICAgICAgICAgICBwcmltYXJ5U3VyZmFjZVdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgIHByaW1hcnlTdXJmYWNlSGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgICAgICByZW5kZXJlckNhbmRpZGF0ZXM6IHJlbmRlcmVyQ2FuZGlkYXRlc1xuICAgICAgICB9O1xuICAgICAgICBnYW1lLnJlbmRlcmVycy5wdXNoKHBmLmdldFByaW1hcnlTdXJmYWNlKCkucmVuZGVyZXIoKSk7XG4gICAgICAgIGdhbWUud2lkdGggPSB3aWR0aDtcbiAgICAgICAgZ2FtZS5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIGdhbWUucmVzaXplZC5maXJlKHsgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCB9KTtcbiAgICAgICAgZ2FtZS5tb2RpZmllZCA9IHRydWU7XG4gICAgfTtcbiAgICBHYW1lRHJpdmVyLnByb3RvdHlwZS5kb0luaXRpYWxpemUgPSBmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIHAgPSBuZXcgZXM2X3Byb21pc2VfMS5Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgIGlmIChfdGhpcy5fZ2FtZUxvb3AgJiYgX3RoaXMuX2dhbWVMb29wLnJ1bm5pbmcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KG5ldyBFcnJvcihcIkdhbWUgaXMgcnVubmluZy4gTXVzdCBiZSBzdG9wcGVkLlwiKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoX3RoaXMuX2dhbWVMb29wICYmIHBhcmFtLmxvb3BDb25maWd1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX2dhbWVMb29wLnNldExvb3BDb25maWd1cmF0aW9uKHBhcmFtLmxvb3BDb25maWd1cmF0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwYXJhbS5oaWRkZW4gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIF90aGlzLl9oaWRkZW4gPSBwYXJhbS5oaWRkZW47XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLl9nYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl9nYW1lLl9zZXRNdXRlZChwYXJhbS5oaWRkZW4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5fYXNzZXJ0TGl2ZSgpO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLl9kb1NldERyaXZlckNvbmZpZ3VyYXRpb24ocGFyYW0uZHJpdmVyQ29uZmlndXJhdGlvbik7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIXBhcmFtLmNvbmZpZ3VyYXRpb25VcmwpXG4gICAgICAgICAgICByZXR1cm4gcDtcbiAgICAgICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5fYXNzZXJ0TGl2ZSgpO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLl9sb2FkQ29uZmlndXJhdGlvbihwYXJhbS5jb25maWd1cmF0aW9uVXJsLCBwYXJhbS5hc3NldEJhc2UsIHBhcmFtLmNvbmZpZ3VyYXRpb25CYXNlKTtcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoY29uZikge1xuICAgICAgICAgICAgX3RoaXMuX2Fzc2VydExpdmUoKTtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5fY3JlYXRlR2FtZShjb25mLCBfdGhpcy5fcGxheWVyLCBwYXJhbSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgR2FtZURyaXZlci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgLy8gTk9URTog44GT44GT44Gn56C05qOE44GV44KM44KLVHJpZ2dlcuOBrmZpcmXkuK3jgavlkbzjgbDjgozjgovjgajjgq/jg6njg4Pjgrfjg6XjgZnjgovjga7jgafjgIHlkIzmnJ/nmoTlh6bnkIbjgaDjgYzlv7Xjga7jgZ/jgoFQcm9taXNl44Gr5YyF44KT44Gn6Z2e5ZCM5pyf44Gn5a6f6KGM44GZ44KLXG4gICAgICAgIHJldHVybiBuZXcgZXM2X3Byb21pc2VfMS5Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgIF90aGlzLnN0b3BHYW1lKCk7XG4gICAgICAgICAgICBpZiAoX3RoaXMuX2dhbWUpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5fZ2FtZS5fZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIF90aGlzLl9nYW1lID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLmVycm9yVHJpZ2dlci5kZXN0cm95KCk7XG4gICAgICAgICAgICBfdGhpcy5lcnJvclRyaWdnZXIgPSBudWxsO1xuICAgICAgICAgICAgX3RoaXMuY29uZmlndXJhdGlvbkxvYWRlZFRyaWdnZXIuZGVzdHJveSgpO1xuICAgICAgICAgICAgX3RoaXMuY29uZmlndXJhdGlvbkxvYWRlZFRyaWdnZXIgPSBudWxsO1xuICAgICAgICAgICAgX3RoaXMuZ2FtZUNyZWF0ZWRUcmlnZ2VyLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIF90aGlzLmdhbWVDcmVhdGVkVHJpZ2dlciA9IG51bGw7XG4gICAgICAgICAgICBpZiAoX3RoaXMuX3BsYXRmb3JtLmRlc3Ryb3kpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5fcGxhdGZvcm0uZGVzdHJveSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX3BsYXRmb3JtLnNldFJlbmRlcmVyUmVxdWlyZW1lbnQodW5kZWZpbmVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLl9wbGF0Zm9ybSA9IG51bGw7XG4gICAgICAgICAgICBfdGhpcy5fbG9hZENvbmZpZ3VyYXRpb25GdW5jID0gbnVsbDtcbiAgICAgICAgICAgIF90aGlzLl9wbGF5ZXIgPSBudWxsO1xuICAgICAgICAgICAgX3RoaXMuX3JlbmRlcmVyUmVxdWlyZW1lbnQgPSBudWxsO1xuICAgICAgICAgICAgX3RoaXMuX3BsYXlJZCA9IG51bGw7XG4gICAgICAgICAgICBfdGhpcy5fZ2FtZUxvb3AgPSBudWxsO1xuICAgICAgICAgICAgX3RoaXMuX2V2ZW50QnVmZmVyID0gbnVsbDtcbiAgICAgICAgICAgIF90aGlzLl9vcGVuZWRBbWZsb3cgPSBmYWxzZTtcbiAgICAgICAgICAgIF90aGlzLl9wbGF5VG9rZW4gPSBudWxsO1xuICAgICAgICAgICAgX3RoaXMuX3Blcm1pc3Npb24gPSBudWxsO1xuICAgICAgICAgICAgX3RoaXMuX2hpZGRlbiA9IGZhbHNlO1xuICAgICAgICAgICAgX3RoaXMuX2Rlc3Ryb3llZCA9IHRydWU7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgR2FtZURyaXZlci5wcm90b3R5cGUuX2RvU2V0RHJpdmVyQ29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uIChkY29uZikge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAoZGNvbmYgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGVzNl9wcm9taXNlXzEuUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8g44OH44OV44Kp44Or44OI5YCk44Gu6KOc5a6MXG4gICAgICAgIGlmIChkY29uZi5wbGF5SWQgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgIGRjb25mLnBsYXlJZCA9IHRoaXMuX3BsYXlJZDtcbiAgICAgICAgaWYgKGRjb25mLnBsYXlUb2tlbiA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgZGNvbmYucGxheVRva2VuID0gdGhpcy5fcGxheVRva2VuO1xuICAgICAgICBpZiAoZGNvbmYuZXZlbnRCdWZmZXJNb2RlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmIChkY29uZi5leGVjdXRpb25Nb2RlID09PSBFeGVjdXRpb25Nb2RlXzEuZGVmYXVsdC5BY3RpdmUpIHtcbiAgICAgICAgICAgICAgICBkY29uZi5ldmVudEJ1ZmZlck1vZGUgPSB7IGlzUmVjZWl2ZXI6IHRydWUsIGlzU2VuZGVyOiBmYWxzZSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZGNvbmYuZXhlY3V0aW9uTW9kZSA9PT0gRXhlY3V0aW9uTW9kZV8xLmRlZmF1bHQuUGFzc2l2ZSkge1xuICAgICAgICAgICAgICAgIGRjb25mLmV2ZW50QnVmZmVyTW9kZSA9IHsgaXNSZWNlaXZlcjogZmFsc2UsIGlzU2VuZGVyOiB0cnVlIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHAgPSBlczZfcHJvbWlzZV8xLlByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICBpZiAodGhpcy5fcGxheUlkICE9PSBkY29uZi5wbGF5SWQpIHtcbiAgICAgICAgICAgIHAgPSBwLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF90aGlzLl9hc3NlcnRMaXZlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLl9kb09wZW5BbWZsb3coZGNvbmYucGxheUlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9wbGF5VG9rZW4gIT09IGRjb25mLnBsYXlUb2tlbikge1xuICAgICAgICAgICAgcCA9IHAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX2Fzc2VydExpdmUoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuX2RvQXV0aGVudGljYXRlKGRjb25mLnBsYXlUb2tlbik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLl9hc3NlcnRMaXZlKCk7XG4gICAgICAgICAgICBpZiAoZGNvbmYuZXZlbnRCdWZmZXJNb2RlICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGNvbmYuZXZlbnRCdWZmZXJNb2RlLmRlZmF1bHRFdmVudFByaW9yaXR5ID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgZGNvbmYuZXZlbnRCdWZmZXJNb2RlLmRlZmF1bHRFdmVudFByaW9yaXR5ID0gMyAvKiBQcmlvcml0eSAqLyAmIF90aGlzLl9wZXJtaXNzaW9uLm1heEV2ZW50UHJpb3JpdHk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5fZXZlbnRCdWZmZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2V2ZW50QnVmZmVyLnNldE1vZGUoZGNvbmYuZXZlbnRCdWZmZXJNb2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGNvbmYuZXhlY3V0aW9uTW9kZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLl9nYW1lTG9vcCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fZ2FtZUxvb3Auc2V0RXhlY3V0aW9uTW9kZShkY29uZi5leGVjdXRpb25Nb2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgR2FtZURyaXZlci5wcm90b3R5cGUuX2RvQ2xvc2VBbWZsb3cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgZXM2X3Byb21pc2VfMS5Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgIGlmICghX3RoaXMuX29wZW5lZEFtZmxvdylcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSgpO1xuICAgICAgICAgICAgX3RoaXMuX3BsYXRmb3JtLmFtZmxvdy5jbG9zZShmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX29wZW5lZEFtZmxvdyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IF90aGlzLl9nZXRDYWxsYmFja0Vycm9yKGVycik7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBHYW1lRHJpdmVyLnByb3RvdHlwZS5fZG9PcGVuQW1mbG93ID0gZnVuY3Rpb24gKHBsYXlJZCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAocGxheUlkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBlczZfcHJvbWlzZV8xLlByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBwID0gdGhpcy5fZG9DbG9zZUFtZmxvdygpO1xuICAgICAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLl9hc3NlcnRMaXZlKCk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IGVzNl9wcm9taXNlXzEuUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHBsYXlJZCA9PT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICBfdGhpcy5fcGxhdGZvcm0uYW1mbG93Lm9wZW4ocGxheUlkLCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IF90aGlzLl9nZXRDYWxsYmFja0Vycm9yKGVycik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX29wZW5lZEFtZmxvdyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl9wbGF5SWQgPSBwbGF5SWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5fZ2FtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLl91cGRhdGVHYW1lUGxheUlkKF90aGlzLl9nYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgR2FtZURyaXZlci5wcm90b3R5cGUuX2RvQXV0aGVudGljYXRlID0gZnVuY3Rpb24gKHBsYXlUb2tlbikge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAocGxheVRva2VuID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gZXM2X3Byb21pc2VfMS5Qcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgcmV0dXJuIG5ldyBlczZfcHJvbWlzZV8xLlByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgX3RoaXMuX3BsYXRmb3JtLmFtZmxvdy5hdXRoZW50aWNhdGUocGxheVRva2VuLCBmdW5jdGlvbiAoZXJyLCBwZXJtaXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yID0gX3RoaXMuX2dldENhbGxiYWNrRXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF90aGlzLl9wbGF5VG9rZW4gPSBwbGF5VG9rZW47XG4gICAgICAgICAgICAgICAgX3RoaXMuX3Blcm1pc3Npb24gPSBwZXJtaXNzaW9uO1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5fZ2FtZSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fZ2FtZS5pc1NuYXBzaG90U2F2ZXIgPSBfdGhpcy5fcGVybWlzc2lvbi53cml0ZVRpY2s7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEdhbWVEcml2ZXIucHJvdG90eXBlLl9sb2FkQ29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uIChjb25maWd1cmF0aW9uVXJsLCBhc3NldEJhc2UsIGNvbmZpZ3VyYXRpb25CYXNlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgZXM2X3Byb21pc2VfMS5Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgIF90aGlzLl9sb2FkQ29uZmlndXJhdGlvbkZ1bmMoY29uZmlndXJhdGlvblVybCwgYXNzZXRCYXNlLCBjb25maWd1cmF0aW9uQmFzZSwgZnVuY3Rpb24gKGVyciwgY29uZikge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IF90aGlzLl9nZXRDYWxsYmFja0Vycm9yKGVycik7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfdGhpcy5jb25maWd1cmF0aW9uTG9hZGVkVHJpZ2dlci5maXJlKGNvbmYpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoY29uZik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBHYW1lRHJpdmVyLnByb3RvdHlwZS5fcHV0WmVyb3RoU3RhcnRQb2ludCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgZXM2X3Byb21pc2VfMS5Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgIC8vIEFNRmxvd+OBr+esrDDjgrnjgr/jg7zjg4jjg53jgqTjg7Pjg4jjgavplqLjgZfjgabjgIzmm7jjgYvjgozjgovjgb7jgaflvoXjgaTjgI3jgajjgYTjgYbli5XkvZzjgpLjgZnjgovjgZ/jgoHjgIHjgIzjgarjgZHjgozjgbDmm7jjgY3ovrzjgoDjgI3jgZPjgajjga/jgafjgY3jgarjgYTjgIJcbiAgICAgICAgICAgIHZhciB6ZXJvdGhTdGFydFBvaW50ID0geyBmcmFtZTogMCwgdGltZXN0YW1wOiBkYXRhLnN0YXJ0ZWRBdCwgZGF0YTogZGF0YSB9O1xuICAgICAgICAgICAgX3RoaXMuX3BsYXRmb3JtLmFtZmxvdy5wdXRTdGFydFBvaW50KHplcm90aFN0YXJ0UG9pbnQsIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSBfdGhpcy5fZ2V0Q2FsbGJhY2tFcnJvcihlcnIpO1xuICAgICAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgR2FtZURyaXZlci5wcm90b3R5cGUuX2dldFplcm90aFN0YXJ0UG9pbnREYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IGVzNl9wcm9taXNlXzEuUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICBfdGhpcy5fcGxhdGZvcm0uYW1mbG93LmdldFN0YXJ0UG9pbnQoeyBmcmFtZTogMCB9LCBmdW5jdGlvbiAoZXJyLCBzdGFydFBvaW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yID0gX3RoaXMuX2dldENhbGxiYWNrRXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gc3RhcnRQb2ludC5kYXRhO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YS5zZWVkICE9PSBcIm51bWJlclwiKSAvLyDlnovjgYzjgarjgYTjga7jgafkuIDlv5znorroqo1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChuZXcgRXJyb3IoXCJHYW1lRHJpdmVyI19nZXRSYW5kb21TZWVkOiBObyBzZWVkIGZvdW5kLlwiKSk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEdhbWVEcml2ZXIucHJvdG90eXBlLl9jcmVhdGVHYW1lID0gZnVuY3Rpb24gKGNvbmYsIHBsYXllciwgcGFyYW0pIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIHB1dFNlZWQgPSAocGFyYW0uZHJpdmVyQ29uZmlndXJhdGlvbi5leGVjdXRpb25Nb2RlID09PSBFeGVjdXRpb25Nb2RlXzEuZGVmYXVsdC5BY3RpdmUpICYmIHRoaXMuX3Blcm1pc3Npb24ud3JpdGVUaWNrO1xuICAgICAgICB2YXIgcDtcbiAgICAgICAgaWYgKHB1dFNlZWQpIHtcbiAgICAgICAgICAgIHAgPSB0aGlzLl9wdXRaZXJvdGhTdGFydFBvaW50KHtcbiAgICAgICAgICAgICAgICBzZWVkOiBEYXRlLm5vdygpLFxuICAgICAgICAgICAgICAgIGdsb2JhbEFyZ3M6IHBhcmFtLmdsb2JhbEdhbWVBcmdzLFxuICAgICAgICAgICAgICAgIGZwczogY29uZi5mcHMsXG4gICAgICAgICAgICAgICAgc3RhcnRlZEF0OiBEYXRlLm5vdygpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHAgPSBlczZfcHJvbWlzZV8xLlByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB9XG4gICAgICAgIHAgPSBwLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMuX2Fzc2VydExpdmUoKTtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5fZ2V0WmVyb3RoU3RhcnRQb2ludERhdGEoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24gKHplcm90aERhdGEpIHtcbiAgICAgICAgICAgIF90aGlzLl9hc3NlcnRMaXZlKCk7XG4gICAgICAgICAgICB2YXIgcGYgPSBfdGhpcy5fcGxhdGZvcm07XG4gICAgICAgICAgICB2YXIgZHJpdmVyQ29uZiA9IHBhcmFtLmRyaXZlckNvbmZpZ3VyYXRpb24gfHwge1xuICAgICAgICAgICAgICAgIGV2ZW50QnVmZmVyTW9kZTogeyBpc1JlY2VpdmVyOiB0cnVlLCBpc1NlbmRlcjogZmFsc2UgfSxcbiAgICAgICAgICAgICAgICBleGVjdXRpb25Nb2RlOiBFeGVjdXRpb25Nb2RlXzEuZGVmYXVsdC5BY3RpdmVcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgc2VlZCA9IHplcm90aERhdGEuc2VlZDtcbiAgICAgICAgICAgIHZhciBhcmdzID0gcGFyYW0uZ2FtZUFyZ3M7XG4gICAgICAgICAgICB2YXIgZ2xvYmFsQXJncyA9IHplcm90aERhdGEuZ2xvYmFsQXJncztcbiAgICAgICAgICAgIHZhciBzdGFydGVkQXQgPSB6ZXJvdGhEYXRhLnN0YXJ0ZWRBdDtcbiAgICAgICAgICAgIHZhciByZW5kZXJlclJlcXVpcmVtZW50ID0ge1xuICAgICAgICAgICAgICAgIHByaW1hcnlTdXJmYWNlV2lkdGg6IGNvbmYud2lkdGgsXG4gICAgICAgICAgICAgICAgcHJpbWFyeVN1cmZhY2VIZWlnaHQ6IGNvbmYuaGVpZ2h0LFxuICAgICAgICAgICAgICAgIHJlbmRlcmVyQ2FuZGlkYXRlczogY29uZi5yZW5kZXJlcnMgLy8gVE9ETzogYWthc2hpYy1lbmdpbmXjga5HYW1lQ29uZmlndXJhdGlvbuOBq3JlbmRlcmVyc+OBruWumue+qeOCkuWKoOOBiOOCi1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHBmLnNldFJlbmRlcmVyUmVxdWlyZW1lbnQocmVuZGVyZXJSZXF1aXJlbWVudCk7XG4gICAgICAgICAgICB2YXIgZ2FtZSA9IG5ldyBHYW1lXzEuR2FtZSh7XG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbjogY29uZixcbiAgICAgICAgICAgICAgICBwbGF5ZXI6IHBsYXllcixcbiAgICAgICAgICAgICAgICByZXNvdXJjZUZhY3Rvcnk6IHBmLmdldFJlc291cmNlRmFjdG9yeSgpLFxuICAgICAgICAgICAgICAgIGFzc2V0QmFzZTogcGFyYW0uYXNzZXRCYXNlLFxuICAgICAgICAgICAgICAgIGlzU25hcHNob3RTYXZlcjogX3RoaXMuX3Blcm1pc3Npb24ud3JpdGVUaWNrLFxuICAgICAgICAgICAgICAgIG9wZXJhdGlvblBsdWdpblZpZXdJbmZvOiAocGYuZ2V0T3BlcmF0aW9uUGx1Z2luVmlld0luZm8gPyBwZi5nZXRPcGVyYXRpb25QbHVnaW5WaWV3SW5mbygpIDogbnVsbCksXG4gICAgICAgICAgICAgICAgZ2FtZUFyZ3M6IGFyZ3MsXG4gICAgICAgICAgICAgICAgZ2xvYmFsR2FtZUFyZ3M6IGdsb2JhbEFyZ3NcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIGV2ZW50QnVmZmVyID0gbmV3IEV2ZW50QnVmZmVyXzEuRXZlbnRCdWZmZXIoeyBnYW1lOiBnYW1lLCBhbWZsb3c6IHBmLmFtZmxvdyB9KTtcbiAgICAgICAgICAgIGV2ZW50QnVmZmVyLnNldE1vZGUoZHJpdmVyQ29uZi5ldmVudEJ1ZmZlck1vZGUpO1xuICAgICAgICAgICAgcGYuc2V0UGxhdGZvcm1FdmVudEhhbmRsZXIoZXZlbnRCdWZmZXIpO1xuICAgICAgICAgICAgZ2FtZS5zZXRFdmVudEZpbHRlckZ1bmNzKHtcbiAgICAgICAgICAgICAgICBhZGRGaWx0ZXI6IGV2ZW50QnVmZmVyLmFkZEZpbHRlci5iaW5kKGV2ZW50QnVmZmVyKSxcbiAgICAgICAgICAgICAgICByZW1vdmVGaWx0ZXI6IGV2ZW50QnVmZmVyLnJlbW92ZUZpbHRlci5iaW5kKGV2ZW50QnVmZmVyKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBnYW1lLnJlbmRlcmVycy5wdXNoKHBmLmdldFByaW1hcnlTdXJmYWNlKCkucmVuZGVyZXIoKSk7XG4gICAgICAgICAgICB2YXIgZ2FtZUxvb3AgPSBuZXcgR2FtZUxvb3BfMS5HYW1lTG9vcCh7XG4gICAgICAgICAgICAgICAgZ2FtZTogZ2FtZSxcbiAgICAgICAgICAgICAgICBhbWZsb3c6IHBmLmFtZmxvdyxcbiAgICAgICAgICAgICAgICBwbGF0Zm9ybTogcGYsXG4gICAgICAgICAgICAgICAgZXhlY3V0aW9uTW9kZTogZHJpdmVyQ29uZi5leGVjdXRpb25Nb2RlLFxuICAgICAgICAgICAgICAgIGV2ZW50QnVmZmVyOiBldmVudEJ1ZmZlcixcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uOiBwYXJhbS5sb29wQ29uZmlndXJhdGlvbixcbiAgICAgICAgICAgICAgICBzdGFydGVkQXQ6IHN0YXJ0ZWRBdCxcbiAgICAgICAgICAgICAgICBwcm9maWxlcjogcGFyYW0ucHJvZmlsZXJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZ2FtZUxvb3AucmF3VGFyZ2V0VGltZVJlYWNoZWRUcmlnZ2VyLmFkZChnYW1lLl9vblJhd1RhcmdldFRpbWVSZWFjaGVkLCBnYW1lKTtcbiAgICAgICAgICAgIGdhbWUuc2V0Q3VycmVudFRpbWVGdW5jKGdhbWVMb29wLmdldEN1cnJlbnRUaW1lLmJpbmQoZ2FtZUxvb3ApKTtcbiAgICAgICAgICAgIGdhbWUuX3Jlc2V0KHsgYWdlOiAwLCByYW5kR2VuOiBuZXcgZy5Yb3JzaGlmdFJhbmRvbUdlbmVyYXRvcihzZWVkKSB9KTtcbiAgICAgICAgICAgIF90aGlzLl91cGRhdGVHYW1lUGxheUlkKGdhbWUpO1xuICAgICAgICAgICAgaWYgKF90aGlzLl9oaWRkZW4pXG4gICAgICAgICAgICAgICAgZ2FtZS5fc2V0TXV0ZWQodHJ1ZSk7XG4gICAgICAgICAgICBnYW1lLnNuYXBzaG90VHJpZ2dlci5hZGQoZnVuY3Rpb24gKHN0YXJ0UG9pbnQpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5fcGxhdGZvcm0uYW1mbG93LnB1dFN0YXJ0UG9pbnQoc3RhcnRQb2ludCwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSBfdGhpcy5fZ2V0Q2FsbGJhY2tFcnJvcihlcnIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmVycm9yVHJpZ2dlci5maXJlKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBfdGhpcy5fZ2FtZSA9IGdhbWU7XG4gICAgICAgICAgICBfdGhpcy5fZXZlbnRCdWZmZXIgPSBldmVudEJ1ZmZlcjtcbiAgICAgICAgICAgIF90aGlzLl9nYW1lTG9vcCA9IGdhbWVMb29wO1xuICAgICAgICAgICAgX3RoaXMuX3JlbmRlcmVyUmVxdWlyZW1lbnQgPSByZW5kZXJlclJlcXVpcmVtZW50O1xuICAgICAgICAgICAgX3RoaXMuZ2FtZUNyZWF0ZWRUcmlnZ2VyLmZpcmUoZ2FtZSk7XG4gICAgICAgICAgICBfdGhpcy5fZ2FtZS5fbG9hZEFuZFN0YXJ0KHsgYXJnczogcGFyYW0uZ2FtZUFyZ3MgfHwgdW5kZWZpbmVkIH0pOyAvLyBUT0RPOiBHYW1lI19yZXN0YXJ0V2l0aFNuYXBzaG90KCnjgajntbHlkIjjgZnjgbnjgY1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBHYW1lRHJpdmVyLnByb3RvdHlwZS5fdXBkYXRlR2FtZVBsYXlJZCA9IGZ1bmN0aW9uIChnYW1lKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGdhbWUucGxheUlkID0gdGhpcy5fcGxheUlkO1xuICAgICAgICBnYW1lLmV4dGVybmFsLnNlbmQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgX3RoaXMuX3BsYXRmb3JtLnNlbmRUb0V4dGVybmFsKF90aGlzLl9wbGF5SWQsIGRhdGEpO1xuICAgICAgICB9O1xuICAgIH07XG4gICAgLy8g6Z2e5ZCM5pyf5Yem55CG5Lit44Gr44Ky44O844Og44GMZGVzdHJveea4iOOBv+OBi+OBqeOBhuOBi+WIpOWumuOBmeOCi+OBn+OCgeOBruODoeOCveODg+ODiVxuICAgIEdhbWVEcml2ZXIucHJvdG90eXBlLl9hc3NlcnRMaXZlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fZGVzdHJveWVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoR0FNRV9ERVNUUk9ZRURfTUVTU0FHRSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8vIOOCs+ODvOODq+ODkOODg+OCr+aZguOBq+OCqOODqeODvOOBjOeZuueUn+OCguOBl+OBj+OBr+OCsuODvOODoOOBjGRlc3Ryb3nmuIjjgb/jga7loLTlkIjjga9FcnJvcuOCkui/lOOBmVxuICAgIEdhbWVEcml2ZXIucHJvdG90eXBlLl9nZXRDYWxsYmFja0Vycm9yID0gZnVuY3Rpb24gKGVycikge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gZXJyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuX2Rlc3Ryb3llZCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBFcnJvcihHQU1FX0RFU1RST1lFRF9NRVNTQUdFKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuICAgIHJldHVybiBHYW1lRHJpdmVyO1xufSgpKTtcbmV4cG9ydHMuR2FtZURyaXZlciA9IEdhbWVEcml2ZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuR2FtZUxvb3AgPSB2b2lkIDA7XG52YXIgZyA9IHJlcXVpcmUoXCJAYWthc2hpYy9ha2FzaGljLWVuZ2luZVwiKTtcbnZhciBjb25zdGFudHMgPSByZXF1aXJlKFwiLi9jb25zdGFudHNcIik7XG52YXIgTG9vcE1vZGVfMSA9IHJlcXVpcmUoXCIuL0xvb3BNb2RlXCIpO1xudmFyIExvb3BSZW5kZXJNb2RlXzEgPSByZXF1aXJlKFwiLi9Mb29wUmVuZGVyTW9kZVwiKTtcbnZhciBFeGVjdXRpb25Nb2RlXzEgPSByZXF1aXJlKFwiLi9FeGVjdXRpb25Nb2RlXCIpO1xudmFyIENsb2NrXzEgPSByZXF1aXJlKFwiLi9DbG9ja1wiKTtcbnZhciBQcm9maWxlckNsb2NrXzEgPSByZXF1aXJlKFwiLi9Qcm9maWxlckNsb2NrXCIpO1xudmFyIEV2ZW50Q29udmVydGVyXzEgPSByZXF1aXJlKFwiLi9FdmVudENvbnZlcnRlclwiKTtcbnZhciBUaWNrQ29udHJvbGxlcl8xID0gcmVxdWlyZShcIi4vVGlja0NvbnRyb2xsZXJcIik7XG4vKipcbiAqIOOCsuODvOODoOOBruODoeOCpOODs+ODq+ODvOODl+euoeeQhuOCr+ODqeOCueOAglxuICogY2xvY2sgZnJhbWXjga7luqbjgatUaWNrQnVmZmVy44Gr6JOE56mN44GV44KM44GfVGlja+OCkuWFg+OBq+OCsuODvOODoOOCkuWLleOBi+OBmeOAglxuICpcbiAqIHN0YXJ0KCkg44GL44KJIHN0b3AoKSDjgb7jgafjga7plpPjgIHmnIDlvozjgavlkbzjgbPlh7rjgZXjgozjgZ8gX2FtZmxvdy5hdXRoZW50aWNhdGUoKSDjga8gUGVybWlzc2lvbiNyZWFkVGljayDjgpLov5TjgZfjgabjgYTjgarjgZHjgozjgbDjgarjgonjgarjgYTjgIJcbiAqL1xudmFyIEdhbWVMb29wID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEdhbWVMb29wKHBhcmFtKSB7XG4gICAgICAgIHRoaXMuZXJyb3JUcmlnZ2VyID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICB0aGlzLnJhd1RhcmdldFRpbWVSZWFjaGVkVHJpZ2dlciA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRUaW1lID0gcGFyYW0uc3RhcnRlZEF0O1xuICAgICAgICB0aGlzLl9mcmFtZVRpbWUgPSAxMDAwIC8gcGFyYW0uZ2FtZS5mcHM7XG4gICAgICAgIHRoaXMuX29taXR0ZWRUaWNrRHVyYXRpb24gPSAwO1xuICAgICAgICBpZiAocGFyYW0uZXJyb3JIYW5kbGVyKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yVHJpZ2dlci5hZGQocGFyYW0uZXJyb3JIYW5kbGVyLCBwYXJhbS5lcnJvckhhbmRsZXJPd25lcik7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNvbmYgPSBwYXJhbS5jb25maWd1cmF0aW9uO1xuICAgICAgICB0aGlzLl9zdGFydGVkQXQgPSBwYXJhbS5zdGFydGVkQXQ7XG4gICAgICAgIHRoaXMuX3RhcmdldFRpbWVGdW5jID0gY29uZi50YXJnZXRUaW1lRnVuYyB8fCBudWxsO1xuICAgICAgICB0aGlzLl90YXJnZXRUaW1lT2Zmc2V0ID0gY29uZi50YXJnZXRUaW1lT2Zmc2V0IHx8IG51bGw7XG4gICAgICAgIHRoaXMuX29yaWdpbkRhdGUgPSBjb25mLm9yaWdpbkRhdGUgfHwgbnVsbDtcbiAgICAgICAgdGhpcy5fcmVhbFRhcmdldFRpbWVPZmZzZXQgPSAodGhpcy5fb3JpZ2luRGF0ZSAhPSBudWxsKSA/IHRoaXMuX29yaWdpbkRhdGUgOiAodGhpcy5fdGFyZ2V0VGltZU9mZnNldCB8fCAwKSArIHRoaXMuX3N0YXJ0ZWRBdDtcbiAgICAgICAgdGhpcy5fZGVsYXlJZ25vcmVUaHJlc2hvbGQgPSBjb25mLmRlbGF5SWdub3JlVGhyZXNob2xkIHx8IGNvbnN0YW50cy5ERUZBVUxUX0RFTEFZX0lHTk9SRV9USFJFU0hPTEQ7XG4gICAgICAgIHRoaXMuX3NraXBUaWNrc0F0T25jZSA9IGNvbmYuc2tpcFRpY2tzQXRPbmNlIHx8IGNvbnN0YW50cy5ERUZBVUxUX1NLSVBfVElDS1NfQVRfT05DRTtcbiAgICAgICAgdGhpcy5fc2tpcFRocmVzaG9sZCA9IGNvbmYuc2tpcFRocmVzaG9sZCB8fCBjb25zdGFudHMuREVGQVVMVF9TS0lQX1RIUkVTSE9MRDtcbiAgICAgICAgdGhpcy5fc2tpcFRocmVzaG9sZFRpbWUgPSB0aGlzLl9za2lwVGhyZXNob2xkICogdGhpcy5fZnJhbWVUaW1lO1xuICAgICAgICAvLyB0aGlzLl9za2lwQXdhcmVHYW1lIOOBr+OBquOBhOOBk+OBqOOBq+azqOaEjyAoR2FtZSNnZXRJc1NraXBBd2FyZSgpKSDjgpLkvb/jgYZcbiAgICAgICAgdGhpcy5fanVtcFRyeVRocmVzaG9sZCA9IGNvbmYuanVtcFRyeVRocmVzaG9sZCB8fCBjb25zdGFudHMuREVGQVVMVF9KVU1QX1RSWV9USFJFU0hPTEQ7XG4gICAgICAgIHRoaXMuX2p1bXBJZ25vcmVUaHJlc2hvbGQgPSBjb25mLmp1bXBJZ25vcmVUaHJlc2hvbGQgfHwgY29uc3RhbnRzLkRFRkFVTFRfSlVNUF9JR05PUkVfVEhSRVNIT0xEO1xuICAgICAgICB0aGlzLl9wb2xsaW5nVGlja1RocmVzaG9sZCA9IGNvbmYuX3BvbGxpbmdUaWNrVGhyZXNob2xkIHx8IGNvbnN0YW50cy5ERUZBVUxUX1BPTExJTkdfVElDS19USFJFU0hPTEQ7XG4gICAgICAgIHRoaXMuX3BsYXliYWNrUmF0ZSA9IGNvbmYucGxheWJhY2tSYXRlIHx8IDE7XG4gICAgICAgIHZhciBsb29wUmVuZGVyTW9kZSA9IChjb25mLmxvb3BSZW5kZXJNb2RlICE9IG51bGwpID8gY29uZi5sb29wUmVuZGVyTW9kZSA6IExvb3BSZW5kZXJNb2RlXzEuZGVmYXVsdC5BZnRlclJhd0ZyYW1lO1xuICAgICAgICB0aGlzLl9sb29wUmVuZGVyTW9kZSA9IG51bGw7IC8vIOW+jOOBrl9zZXRMb29wUmVuZGVyTW9kZSgp44Gn5Yid5pyf5YyWXG4gICAgICAgIHRoaXMuX29taXRJbnRlcnBvbGF0ZWRUaWNrT25SZXBsYXkgPSAoY29uZi5vbWl0SW50ZXJwb2xhdGVkVGlja09uUmVwbGF5ICE9IG51bGwpID8gY29uZi5vbWl0SW50ZXJwb2xhdGVkVGlja09uUmVwbGF5IDogdHJ1ZTtcbiAgICAgICAgdGhpcy5fbG9vcE1vZGUgPSBjb25mLmxvb3BNb2RlO1xuICAgICAgICB0aGlzLl9hbWZsb3cgPSBwYXJhbS5hbWZsb3c7XG4gICAgICAgIHRoaXMuX2dhbWUgPSBwYXJhbS5nYW1lO1xuICAgICAgICB0aGlzLl9ldmVudEJ1ZmZlciA9IHBhcmFtLmV2ZW50QnVmZmVyO1xuICAgICAgICB0aGlzLl9leGVjdXRpb25Nb2RlID0gcGFyYW0uZXhlY3V0aW9uTW9kZTtcbiAgICAgICAgdGhpcy5fc2NlbmVUaWNrTW9kZSA9IG51bGw7XG4gICAgICAgIHRoaXMuX3NjZW5lTG9jYWxNb2RlID0gbnVsbDtcbiAgICAgICAgdGhpcy5fdGFyZ2V0QWdlID0gKGNvbmYudGFyZ2V0QWdlICE9IG51bGwpID8gY29uZi50YXJnZXRBZ2UgOiBudWxsO1xuICAgICAgICB0aGlzLl93YWl0aW5nU3RhcnRQb2ludCA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9sYXN0UmVxdWVzdGVkU3RhcnRQb2ludEFnZSA9IC0xO1xuICAgICAgICB0aGlzLl9sYXN0UmVxdWVzdGVkU3RhcnRQb2ludFRpbWUgPSAtMTtcbiAgICAgICAgdGhpcy5fd2FpdGluZ05leHRUaWNrID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2NvbnN1bWVkTGF0ZXN0VGljayA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9za2lwcGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9sYXN0UG9sbGluZ1RpY2tUaW1lID0gMDtcbiAgICAgICAgLy8gdG9kbzog5pys5p2l44Gv44CB44OR44OV44Kp44O844Oe44Oz44K55ris5a6a5qmf5qeL44KS5ZCr44G+44Gq44GE44Oq44Oq44O844K544Oi44O844OJ44Gr44KI44KL44OT44Or44OJ5pa55byP44KC5o+Q5L6b44GZ44G544GN44CCXG4gICAgICAgIGlmICghcGFyYW0ucHJvZmlsZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX2Nsb2NrID0gbmV3IENsb2NrXzEuQ2xvY2soe1xuICAgICAgICAgICAgICAgIGZwczogcGFyYW0uZ2FtZS5mcHMsXG4gICAgICAgICAgICAgICAgc2NhbGVGYWN0b3I6IHRoaXMuX3BsYXliYWNrUmF0ZSxcbiAgICAgICAgICAgICAgICBwbGF0Zm9ybTogcGFyYW0ucGxhdGZvcm0sXG4gICAgICAgICAgICAgICAgbWF4RnJhbWVQZXJPbmNlOiA1XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2Nsb2NrID0gbmV3IFByb2ZpbGVyQ2xvY2tfMS5Qcm9maWxlckNsb2NrKHtcbiAgICAgICAgICAgICAgICBmcHM6IHBhcmFtLmdhbWUuZnBzLFxuICAgICAgICAgICAgICAgIHNjYWxlRmFjdG9yOiB0aGlzLl9wbGF5YmFja1JhdGUsXG4gICAgICAgICAgICAgICAgcGxhdGZvcm06IHBhcmFtLnBsYXRmb3JtLFxuICAgICAgICAgICAgICAgIG1heEZyYW1lUGVyT25jZTogNSxcbiAgICAgICAgICAgICAgICBwcm9maWxlcjogcGFyYW0ucHJvZmlsZXJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3RpY2tDb250cm9sbGVyID0gbmV3IFRpY2tDb250cm9sbGVyXzEuVGlja0NvbnRyb2xsZXIoe1xuICAgICAgICAgICAgYW1mbG93OiBwYXJhbS5hbWZsb3csXG4gICAgICAgICAgICBjbG9jazogdGhpcy5fY2xvY2ssXG4gICAgICAgICAgICBnYW1lOiBwYXJhbS5nYW1lLFxuICAgICAgICAgICAgZXZlbnRCdWZmZXI6IHBhcmFtLmV2ZW50QnVmZmVyLFxuICAgICAgICAgICAgZXhlY3V0aW9uTW9kZTogcGFyYW0uZXhlY3V0aW9uTW9kZSxcbiAgICAgICAgICAgIHN0YXJ0ZWRBdDogcGFyYW0uc3RhcnRlZEF0LFxuICAgICAgICAgICAgZXJyb3JIYW5kbGVyOiB0aGlzLmVycm9yVHJpZ2dlci5maXJlLFxuICAgICAgICAgICAgZXJyb3JIYW5kbGVyT3duZXI6IHRoaXMuZXJyb3JUcmlnZ2VyXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9ldmVudENvbnZlcnRlciA9IG5ldyBFdmVudENvbnZlcnRlcl8xLkV2ZW50Q29udmVydGVyKHsgZ2FtZTogcGFyYW0uZ2FtZSB9KTtcbiAgICAgICAgdGhpcy5fdGlja0J1ZmZlciA9IHRoaXMuX3RpY2tDb250cm9sbGVyLmdldEJ1ZmZlcigpO1xuICAgICAgICB0aGlzLl9vbkdvdFN0YXJ0UG9pbnRfYm91bmQgPSB0aGlzLl9vbkdvdFN0YXJ0UG9pbnQuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5fc2V0TG9vcFJlbmRlck1vZGUobG9vcFJlbmRlck1vZGUpO1xuICAgICAgICB0aGlzLl9nYW1lLnNldElzU2tpcEF3YXJlKGNvbmYuc2tpcEF3YXJlR2FtZSAhPSBudWxsID8gY29uZi5za2lwQXdhcmVHYW1lIDogdHJ1ZSk7XG4gICAgICAgIHRoaXMuX2dhbWUuc2V0U3RvcmFnZUZ1bmModGhpcy5fdGlja0NvbnRyb2xsZXIuc3RvcmFnZUZ1bmMoKSk7XG4gICAgICAgIHRoaXMuX2dhbWUucmFpc2VFdmVudFRyaWdnZXIuYWRkKHRoaXMuX29uR2FtZVJhaXNlRXZlbnQsIHRoaXMpO1xuICAgICAgICB0aGlzLl9nYW1lLnJhaXNlVGlja1RyaWdnZXIuYWRkKHRoaXMuX29uR2FtZVJhaXNlVGljaywgdGhpcyk7XG4gICAgICAgIHRoaXMuX2dhbWUuX3N0YXJ0ZWQuYWRkKHRoaXMuX29uR2FtZVN0YXJ0ZWQsIHRoaXMpO1xuICAgICAgICB0aGlzLl9nYW1lLl9vcGVyYXRpb25QbHVnaW5PcGVyYXRlZC5hZGQodGhpcy5fb25HYW1lT3BlcmF0aW9uUGx1Z2luT3BlcmF0ZWQsIHRoaXMpO1xuICAgICAgICB0aGlzLl90aWNrQnVmZmVyLmdvdE5leHRUaWNrVHJpZ2dlci5hZGQodGhpcy5fb25Hb3ROZXh0RnJhbWVUaWNrLCB0aGlzKTtcbiAgICAgICAgdGhpcy5fdGlja0J1ZmZlci5nb3ROb1RpY2tUcmlnZ2VyLmFkZCh0aGlzLl9vbkdvdE5vVGljaywgdGhpcyk7XG4gICAgICAgIHRoaXMuX3RpY2tCdWZmZXIuc3RhcnQoKTtcbiAgICAgICAgdGhpcy5fdXBkYXRlR2FtZVBsYXliYWNrUmF0ZSgpO1xuICAgICAgICB0aGlzLl9oYW5kbGVTY2VuZUNoYW5nZSgpO1xuICAgIH1cbiAgICBHYW1lTG9vcC5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucnVubmluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuX2Nsb2NrLnN0YXJ0KCk7XG4gICAgfTtcbiAgICBHYW1lTG9vcC5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fY2xvY2suc3RvcCgpO1xuICAgICAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTtcbiAgICB9O1xuICAgIEdhbWVMb29wLnByb3RvdHlwZS5zZXROZXh0QWdlID0gZnVuY3Rpb24gKGFnZSkge1xuICAgICAgICB0aGlzLl90aWNrQ29udHJvbGxlci5zZXROZXh0QWdlKGFnZSk7XG4gICAgfTtcbiAgICBHYW1lTG9vcC5wcm90b3R5cGUuZ2V0RXhlY3V0aW9uTW9kZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2V4ZWN1dGlvbk1vZGU7XG4gICAgfTtcbiAgICBHYW1lTG9vcC5wcm90b3R5cGUuc2V0RXhlY3V0aW9uTW9kZSA9IGZ1bmN0aW9uIChleGVjTW9kZSkge1xuICAgICAgICB0aGlzLl9leGVjdXRpb25Nb2RlID0gZXhlY01vZGU7XG4gICAgICAgIHRoaXMuX3RpY2tDb250cm9sbGVyLnNldEV4ZWN1dGlvbk1vZGUoZXhlY01vZGUpO1xuICAgIH07XG4gICAgR2FtZUxvb3AucHJvdG90eXBlLmdldExvb3BDb25maWd1cmF0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbG9vcE1vZGU6IHRoaXMuX2xvb3BNb2RlLFxuICAgICAgICAgICAgZGVsYXlJZ25vcmVUaHJlc2hvbGQ6IHRoaXMuX2RlbGF5SWdub3JlVGhyZXNob2xkLFxuICAgICAgICAgICAgc2tpcFRpY2tzQXRPbmNlOiB0aGlzLl9za2lwVGlja3NBdE9uY2UsXG4gICAgICAgICAgICBza2lwVGhyZXNob2xkOiB0aGlzLl9za2lwVGhyZXNob2xkLFxuICAgICAgICAgICAgc2tpcEF3YXJlR2FtZTogdGhpcy5fZ2FtZS5nZXRJc1NraXBBd2FyZSgpLFxuICAgICAgICAgICAganVtcFRyeVRocmVzaG9sZDogdGhpcy5fanVtcFRyeVRocmVzaG9sZCxcbiAgICAgICAgICAgIGp1bXBJZ25vcmVUaHJlc2hvbGQ6IHRoaXMuX2p1bXBJZ25vcmVUaHJlc2hvbGQsXG4gICAgICAgICAgICBwbGF5YmFja1JhdGU6IHRoaXMuX3BsYXliYWNrUmF0ZSxcbiAgICAgICAgICAgIGxvb3BSZW5kZXJNb2RlOiB0aGlzLl9sb29wUmVuZGVyTW9kZSxcbiAgICAgICAgICAgIHRhcmdldFRpbWVGdW5jOiB0aGlzLl90YXJnZXRUaW1lRnVuYyxcbiAgICAgICAgICAgIHRhcmdldFRpbWVPZmZzZXQ6IHRoaXMuX3RhcmdldFRpbWVPZmZzZXQsXG4gICAgICAgICAgICBvcmlnaW5EYXRlOiB0aGlzLl9vcmlnaW5EYXRlLFxuICAgICAgICAgICAgb21pdEludGVycG9sYXRlZFRpY2tPblJlcGxheTogdGhpcy5fb21pdEludGVycG9sYXRlZFRpY2tPblJlcGxheSxcbiAgICAgICAgICAgIHRhcmdldEFnZTogdGhpcy5fdGFyZ2V0QWdlXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBHYW1lTG9vcC5wcm90b3R5cGUuc2V0TG9vcENvbmZpZ3VyYXRpb24gPSBmdW5jdGlvbiAoY29uZikge1xuICAgICAgICBpZiAoY29uZi5sb29wTW9kZSAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy5fbG9vcE1vZGUgPSBjb25mLmxvb3BNb2RlO1xuICAgICAgICBpZiAoY29uZi5kZWxheUlnbm9yZVRocmVzaG9sZCAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy5fZGVsYXlJZ25vcmVUaHJlc2hvbGQgPSBjb25mLmRlbGF5SWdub3JlVGhyZXNob2xkO1xuICAgICAgICBpZiAoY29uZi5za2lwVGlja3NBdE9uY2UgIT0gbnVsbClcbiAgICAgICAgICAgIHRoaXMuX3NraXBUaWNrc0F0T25jZSA9IGNvbmYuc2tpcFRpY2tzQXRPbmNlO1xuICAgICAgICBpZiAoY29uZi5za2lwVGhyZXNob2xkICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuX3NraXBUaHJlc2hvbGQgPSBjb25mLnNraXBUaHJlc2hvbGQ7XG4gICAgICAgICAgICB0aGlzLl9za2lwVGhyZXNob2xkVGltZSA9IHRoaXMuX3NraXBUaHJlc2hvbGQgKiB0aGlzLl9mcmFtZVRpbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmYuc2tpcEF3YXJlR2FtZSAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy5fZ2FtZS5zZXRJc1NraXBBd2FyZShjb25mLnNraXBBd2FyZUdhbWUpO1xuICAgICAgICBpZiAoY29uZi5qdW1wVHJ5VGhyZXNob2xkICE9IG51bGwpXG4gICAgICAgICAgICB0aGlzLl9qdW1wVHJ5VGhyZXNob2xkID0gY29uZi5qdW1wVHJ5VGhyZXNob2xkO1xuICAgICAgICBpZiAoY29uZi5qdW1wSWdub3JlVGhyZXNob2xkICE9IG51bGwpXG4gICAgICAgICAgICB0aGlzLl9qdW1wSWdub3JlVGhyZXNob2xkID0gY29uZi5qdW1wSWdub3JlVGhyZXNob2xkO1xuICAgICAgICBpZiAoY29uZi5wbGF5YmFja1JhdGUgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5fcGxheWJhY2tSYXRlID0gY29uZi5wbGF5YmFja1JhdGU7XG4gICAgICAgICAgICB0aGlzLl9jbG9jay5jaGFuZ2VTY2FsZUZhY3Rvcih0aGlzLl9wbGF5YmFja1JhdGUpO1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlR2FtZVBsYXliYWNrUmF0ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25mLmxvb3BSZW5kZXJNb2RlICE9IG51bGwpXG4gICAgICAgICAgICB0aGlzLl9zZXRMb29wUmVuZGVyTW9kZShjb25mLmxvb3BSZW5kZXJNb2RlKTtcbiAgICAgICAgaWYgKGNvbmYudGFyZ2V0VGltZUZ1bmMgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5fdGFyZ2V0VGltZUZ1bmMgPSBjb25mLnRhcmdldFRpbWVGdW5jO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25mLnRhcmdldFRpbWVPZmZzZXQgIT0gbnVsbClcbiAgICAgICAgICAgIHRoaXMuX3RhcmdldFRpbWVPZmZzZXQgPSBjb25mLnRhcmdldFRpbWVPZmZzZXQ7XG4gICAgICAgIGlmIChjb25mLm9yaWdpbkRhdGUgIT0gbnVsbClcbiAgICAgICAgICAgIHRoaXMuX29yaWdpbkRhdGUgPSBjb25mLm9yaWdpbkRhdGU7XG4gICAgICAgIHRoaXMuX3JlYWxUYXJnZXRUaW1lT2Zmc2V0ID0gKHRoaXMuX29yaWdpbkRhdGUgIT0gbnVsbCkgPyB0aGlzLl9vcmlnaW5EYXRlIDogKHRoaXMuX3RhcmdldFRpbWVPZmZzZXQgfHwgMCkgKyB0aGlzLl9zdGFydGVkQXQ7XG4gICAgICAgIGlmIChjb25mLm9taXRJbnRlcnBvbGF0ZWRUaWNrT25SZXBsYXkgIT0gbnVsbClcbiAgICAgICAgICAgIHRoaXMuX29taXRJbnRlcnBvbGF0ZWRUaWNrT25SZXBsYXkgPSBjb25mLm9taXRJbnRlcnBvbGF0ZWRUaWNrT25SZXBsYXk7XG4gICAgICAgIGlmIChjb25mLnRhcmdldEFnZSAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fdGFyZ2V0QWdlICE9PSBjb25mLnRhcmdldEFnZSkge1xuICAgICAgICAgICAgICAgIC8vIHRhcmdldEFnZeOBruWkieWMluOBq+OCiOOBo+OBpuW/heimgeOBquODhuOCo+ODg+OCr+OBjOWkieWMluOBl+OBn+WPr+iDveaAp+OBjOOBguOCi+OAglxuICAgICAgICAgICAgICAgIC8vIOS4gOW6puODquOCu+ODg+ODiOOBl+OBpiBfb25GcmFtZSgpIOOBp+aUueOCgeOBpiBfd2FpdGluZ05leHRUaWNrIOOCkuaxguOCgeebtOOBmeOAglxuICAgICAgICAgICAgICAgIHRoaXMuX3dhaXRpbmdOZXh0VGljayA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fdGFyZ2V0QWdlID0gY29uZi50YXJnZXRBZ2U7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEdhbWVMb29wLnByb3RvdHlwZS5hZGRUaWNrTGlzdCA9IGZ1bmN0aW9uICh0aWNrTGlzdCkge1xuICAgICAgICB0aGlzLl90aWNrQnVmZmVyLmFkZFRpY2tMaXN0KHRpY2tMaXN0KTtcbiAgICB9O1xuICAgIEdhbWVMb29wLnByb3RvdHlwZS5nZXRDdXJyZW50VGltZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRUaW1lO1xuICAgIH07XG4gICAgLyoqXG4gICAgICog5pep6YCB44KK54q25oWL44Gr5YWl44KL44CCXG4gICAgICpcbiAgICAgKiDjgZnjgbnjgabjga7ml6nlm57jgZcoMeODleODrOODvOODoOOBp+OBruikh+aVsOODhuOCo+ODg+OCr+a2iOiyuynjgafml6npgIHjgornirbmhYvjgavlhaXjgovjgo/jgZHjgafjga/jgarjgYTjgZPjgajjgavms6jmhI/jgIJcbiAgICAgKiDlsJHjgIXjga7pgYXjgozjga/jgZPjga7jgq/jg6njgrnjgYzmmpfpu5njgavml6nlm57jgZfjgZfjgablkLjlj47jgZnjgovjgIJcbiAgICAgKiDml6npgIHjgornirbmhYvjga/jgIHmmpfpu5njga7ml6nlm57jgZfjgafjga/lkLjlj47jgZfjgY3jgozjgarjgYTopo/mqKHjga7ml6nlm57jgZfjga7plovlp4vmmYLjgavpgJrnn6XjgZXjgozjgovjgIJcbiAgICAgKiDlhbfkvZPnmoTjgarlgKTjgajjga7plqLpgKPjga8gYHNraXBUaHJlc2hvbGRgIOOBquOBqSBgTG9vcENvbmZpZ3VyYXRpb25gIOOBruODoeODs+ODkOOCkuWPgueFp+OBruOBk+OBqOOAglxuICAgICAqL1xuICAgIEdhbWVMb29wLnByb3RvdHlwZS5fc3RhcnRTa2lwcGluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc2tpcHBpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLl91cGRhdGVHYW1lUGxheWJhY2tSYXRlKCk7XG4gICAgICAgIHRoaXMuX2dhbWUuc2tpcHBpbmdDaGFuZ2VkVHJpZ2dlci5maXJlKHRydWUpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICog5pep6YCB44KK54q25oWL44KS57WC44GI44KL44CCXG4gICAgICovXG4gICAgR2FtZUxvb3AucHJvdG90eXBlLl9zdG9wU2tpcHBpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3NraXBwaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX3VwZGF0ZUdhbWVQbGF5YmFja1JhdGUoKTtcbiAgICAgICAgdGhpcy5fZ2FtZS5za2lwcGluZ0NoYW5nZWRUcmlnZ2VyLmZpcmUoZmFsc2UpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogR2FtZeOBruWGjeeUn+mAn+W6puioreWumuOCkuWkieOBiOOCi+OAglxuICAgICAqIOWun+mam+OBq+WGjeeUn+mAn+W6pijjg4bjgqPjg4Pjgq/jga7mtojosrvpgJ/luqYp44KS5rG644KB44Gm44GE44KL44Gu44Gv44GT44Gu44Kv44Op44K544Gn44GC44KL54K544Gr5rOo5oSP44CCXG4gICAgICovXG4gICAgR2FtZUxvb3AucHJvdG90eXBlLl91cGRhdGVHYW1lUGxheWJhY2tSYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcmVhbFBsYXliYWNrUmF0ZSA9IHRoaXMuX3NraXBwaW5nID8gKHRoaXMuX3BsYXliYWNrUmF0ZSAqIHRoaXMuX3NraXBUaWNrc0F0T25jZSkgOiB0aGlzLl9wbGF5YmFja1JhdGU7XG4gICAgICAgIHRoaXMuX2dhbWUuX3NldEF1ZGlvUGxheWJhY2tSYXRlKHJlYWxQbGF5YmFja1JhdGUpO1xuICAgIH07XG4gICAgR2FtZUxvb3AucHJvdG90eXBlLl9oYW5kbGVTY2VuZUNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNjZW5lID0gdGhpcy5fZ2FtZS5zY2VuZSgpO1xuICAgICAgICB2YXIgbG9jYWxNb2RlID0gc2NlbmUgPyBzY2VuZS5sb2NhbCA6IGcuTG9jYWxUaWNrTW9kZS5GdWxsTG9jYWw7IC8vIOOCt+ODvOODs+OBjOOBquOBhOWgtOWQiOOBr+ODreODvOOCq+ODq+OCt+ODvOODs+WQjOanmOOBq+aMr+OCi+iInuOBhijjg4bjgqPjg4Pjgq/jga/mtojljJbjgZfjgarjgYQpXG4gICAgICAgIHZhciB0aWNrTW9kZSA9IHNjZW5lID8gc2NlbmUudGlja0dlbmVyYXRpb25Nb2RlIDogZy5UaWNrR2VuZXJhdGlvbk1vZGUuQnlDbG9jaztcbiAgICAgICAgaWYgKHRoaXMuX3NjZW5lTG9jYWxNb2RlICE9PSBsb2NhbE1vZGUgfHwgdGhpcy5fc2NlbmVUaWNrTW9kZSAhPT0gdGlja01vZGUpIHtcbiAgICAgICAgICAgIHRoaXMuX3NjZW5lTG9jYWxNb2RlID0gbG9jYWxNb2RlO1xuICAgICAgICAgICAgdGhpcy5fc2NlbmVUaWNrTW9kZSA9IHRpY2tNb2RlO1xuICAgICAgICAgICAgdGhpcy5fY2xvY2suZnJhbWVUcmlnZ2VyLnJlbW92ZSh0aGlzLl9vbkZyYW1lLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuX2Nsb2NrLmZyYW1lVHJpZ2dlci5yZW1vdmUodGhpcy5fb25Mb2NhbEZyYW1lLCB0aGlzKTtcbiAgICAgICAgICAgIHN3aXRjaCAobG9jYWxNb2RlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBnLkxvY2FsVGlja01vZGUuRnVsbExvY2FsOlxuICAgICAgICAgICAgICAgICAgICAvLyDjg63jg7zjgqvjg6vjgrfjg7zjg7M6IFRpY2tHZW5lcmF0aW9uTW9kZSDjgavplqLkv4LjgarjgY/jg63jg7zjgqvjg6vjg4bjgqPjg4Pjgq/jga7jgb9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGlja0NvbnRyb2xsZXIuc3RvcFRpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2xvY2suZnJhbWVUcmlnZ2VyLmFkZCh0aGlzLl9vbkxvY2FsRnJhbWUsIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIGcuTG9jYWxUaWNrTW9kZS5Ob25Mb2NhbDpcbiAgICAgICAgICAgICAgICBjYXNlIGcuTG9jYWxUaWNrTW9kZS5JbnRlcnBvbGF0ZUxvY2FsOlxuICAgICAgICAgICAgICAgICAgICBpZiAodGlja01vZGUgPT09IGcuVGlja0dlbmVyYXRpb25Nb2RlLkJ5Q2xvY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3RpY2tDb250cm9sbGVyLnN0YXJ0VGljaygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWFudWFsIOOBruWgtOWQiDogc3RvcmFnZURhdGHjgYzkuZfjgovlj6/og73mgKfjgYzjgYLjgovmnIDliJ3jga5UaWNr44Gg44GR55Sf5oiQ44GV44Gb44CB44GC44Go44Gv55Sf5oiQ44KS5q2i44KB44KL44CCKE1hbnVhbOOBruS7leanmOOBqeOBiuOCiuOBruaMmeWLlSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0b3JhZ2VEYXRh44GM44GC44KL5aC05ZCI44Gv6YCB44KJ44Gq44GE44GoUGFzc2l2ZeOBruOCpOODs+OCueOCv+ODs+OCueOBjOODreODvOODh+OCo+ODs+OCsOOCt+ODvOODs+OCkue1guOBiOOCieOCjOOBquOBhOOAglxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGlja0NvbnRyb2xsZXIuc3RhcnRUaWNrT25jZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2Nsb2NrLmZyYW1lVHJpZ2dlci5hZGQodGhpcy5fb25GcmFtZSwgdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JUcmlnZ2VyLmZpcmUobmV3IEVycm9yKFwiVW5rbm93biBMb2NhbFRpY2tNb2RlOiBcIiArIGxvY2FsTW9kZSkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOODreODvOOCq+ODq+OCt+ODvOODs+OBruODleODrOODvOODoOWHpueQhuOAglxuICAgICAqXG4gICAgICogYHRoaXMuX2Nsb2NrYCDjga7nrqHnkIbjgZnjgovmmYLplpPntYzpgY7jgavlvpPjgYTjgIHjg63jg7zjgqvjg6vjgrfjg7zjg7PjgavjgYrjgYTjgaYx44OV44Os44O844Og5pmC6ZaT44Gr44Gk44GNMeWbnuWRvOOBs+WHuuOBleOCjOOCi+OAglxuICAgICAqL1xuICAgIEdhbWVMb29wLnByb3RvdHlwZS5fb25Mb2NhbEZyYW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9kb0xvY2FsVGljaygpO1xuICAgIH07XG4gICAgR2FtZUxvb3AucHJvdG90eXBlLl9kb0xvY2FsVGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGdhbWUgPSB0aGlzLl9nYW1lO1xuICAgICAgICB2YXIgcGV2cyA9IHRoaXMuX2V2ZW50QnVmZmVyLnJlYWRMb2NhbEV2ZW50cygpO1xuICAgICAgICB0aGlzLl9jdXJyZW50VGltZSArPSB0aGlzLl9mcmFtZVRpbWU7XG4gICAgICAgIGlmIChwZXZzKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcGV2cy5sZW5ndGg7IGkgPCBsZW47ICsraSlcbiAgICAgICAgICAgICAgICBnYW1lLmV2ZW50cy5wdXNoKHRoaXMuX2V2ZW50Q29udmVydGVyLnRvR2FtZUV2ZW50KHBldnNbaV0pKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgc2NlbmVDaGFuZ2VkID0gZ2FtZS50aWNrKGZhbHNlLCBNYXRoLmZsb29yKHRoaXMuX29taXR0ZWRUaWNrRHVyYXRpb24gLyB0aGlzLl9mcmFtZVRpbWUpKTtcbiAgICAgICAgdGhpcy5fb21pdHRlZFRpY2tEdXJhdGlvbiA9IDA7XG4gICAgICAgIGlmIChzY2VuZUNoYW5nZWQpXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVTY2VuZUNoYW5nZSgpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICog6Z2e44Ot44O844Kr44Or44K344O844Oz44Gu44OV44Os44O844Og5Yem55CG44CCXG4gICAgICpcbiAgICAgKiBgdGhpcy5fY2xvY2tgIOOBrueuoeeQhuOBmeOCi+aZgumWk+e1jOmBjuOBq+W+k+OBhOOAgemdnuODreODvOOCq+ODq+OCt+ODvOODs+OBq+OBiuOBhOOBpjHjg5Xjg6zjg7zjg6DmmYLplpPjgavjgaTjgY0x5Zue5ZG844Gz5Ye644GV44KM44KL44CCXG4gICAgICovXG4gICAgR2FtZUxvb3AucHJvdG90eXBlLl9vbkZyYW1lID0gZnVuY3Rpb24gKGZyYW1lQXJnKSB7XG4gICAgICAgIGlmICh0aGlzLl9sb29wTW9kZSAhPT0gTG9vcE1vZGVfMS5kZWZhdWx0LlJlcGxheSB8fCAhdGhpcy5fdGFyZ2V0VGltZUZ1bmMpIHtcbiAgICAgICAgICAgIHRoaXMuX29uRnJhbWVOb3JtYWwoZnJhbWVBcmcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIGdpdmVuVGFyZ2V0VGltZSA9IHRoaXMuX3RhcmdldFRpbWVGdW5jKCk7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0VGltZSA9IGdpdmVuVGFyZ2V0VGltZSArIHRoaXMuX3JlYWxUYXJnZXRUaW1lT2Zmc2V0O1xuICAgICAgICAgICAgdmFyIHByZXZUaW1lID0gdGhpcy5fY3VycmVudFRpbWU7XG4gICAgICAgICAgICB0aGlzLl9vbkZyYW1lRm9yVGltZWRSZXBsYXkodGFyZ2V0VGltZSwgZnJhbWVBcmcpO1xuICAgICAgICAgICAgLy8g55uu5qiZ5pmC5Yi75Yiw6YGU5Yik5a6aOiDpgLLjgoHjgarjgY/jgarjgorjgIHjgYLjgagx44OV44Os44O844Og44Gn55uu5qiZ5pmC5Yi744KS6YGO44GO44KL44K/44Kk44Of44Oz44Kw44KS5Yiw6YGU44Go44GX44Gm6YCa55+l44GZ44KL44CCXG4gICAgICAgICAgICAvLyDmmYLplpPpgLLooYzjgpLpgLLjgoHjgabjgYTjgaPjgabjgoLnm67mqJnmmYLliLsgXCLku6XkuIpcIiDjgavpgLLjgoDjgZPjgajjga/jgarjgYTjga7jgafjgIzpgY7jgY7jgZ/jgI3jgr/jgqTjg5/jg7PjgrDjga/kvb/jgYjjgarjgYTngrnjgavms6jmhI/jgIJcbiAgICAgICAgICAgIC8vICjjgb7jgZ/jgIHjgZ3jgozjgafjgoLjgarjgYogKHByZXZUaW1lIDw9IHRhcmdldFRpbWUpIOOBruadoeS7tuOBr+OBquOBj+OBm+OBquOBhOeCueOBq+OCguazqOaEj+OAguW3u+OBjeaIu+OBmeaZguOBryAocHJldlRpbWUgPiB0YXJnZXRUaW1lKSDjgavjgarjgospXG4gICAgICAgICAgICBpZiAoKHByZXZUaW1lID09PSB0aGlzLl9jdXJyZW50VGltZSkgJiYgKHByZXZUaW1lIDw9IHRhcmdldFRpbWUpICYmICh0YXJnZXRUaW1lIDw9IHByZXZUaW1lICsgdGhpcy5fZnJhbWVUaW1lKSlcbiAgICAgICAgICAgICAgICB0aGlzLnJhd1RhcmdldFRpbWVSZWFjaGVkVHJpZ2dlci5maXJlKGdpdmVuVGFyZ2V0VGltZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOaZguWIu+mWouaVsOOBjOS4juOBiOOCieOCjOOBpuOBhOOCi+WgtOWQiOOBruODleODrOODvOODoOWHpueQhuOAglxuICAgICAqXG4gICAgICog6YCa5bi444Kx44O844K5IChgX29uRnJhbWVOb3JtYWwoKWApIOOBqOOBr+S4u+OBq+asoeOBrueCueOBp+eVsOOBquOCizpcbiAgICAgKiAgMS4gYFJlcGxheWAg5pmC44Gu5a6f6KOF44GX44GL5oyB44Gf44Gq44GEIChgUmVhbHRpbWVgIOOBr+aZguWIu+mWouaVsOOCkuS9v+OCj+OBmuOBqOOBq+OBi+OBj+acgOaWsOODhuOCo+ODg+OCr+OCkuebruaMh+OBmeOBruOBp+S4jeimgSlcbiAgICAgKiAgMi4g44Ot44O844Kr44Or44OG44Kj44OD44Kv6KOc6ZaT44KS44K/44Kk44Og44K544K/44Oz44OX44Gr5b6T44Gj44Gm44GX44GL6KGM44KP44Gq44GEXG4gICAgICog5b6M6ICF44Gv44CB44OG44Kj44OD44Kv5Y+X5L+h5b6F44Gh44Gq44Gp44Gu54q25rOB44Gn6LW344GN44KL44Ot44O844Kr44Or44OG44Kj44OD44Kv6KOc6ZaT44GM44Gq44GP44Gq44KL44GT44Go44KS5oSP5ZGz44GZ44KL44CCXG4gICAgICovXG4gICAgR2FtZUxvb3AucHJvdG90eXBlLl9vbkZyYW1lRm9yVGltZWRSZXBsYXkgPSBmdW5jdGlvbiAodGFyZ2V0VGltZSwgZnJhbWVBcmcpIHtcbiAgICAgICAgdmFyIHNjZW5lQ2hhbmdlZCA9IGZhbHNlO1xuICAgICAgICB2YXIgZ2FtZSA9IHRoaXMuX2dhbWU7XG4gICAgICAgIHZhciB0aW1lR2FwID0gdGFyZ2V0VGltZSAtIHRoaXMuX2N1cnJlbnRUaW1lO1xuICAgICAgICB2YXIgZnJhbWVHYXAgPSAodGltZUdhcCAvIHRoaXMuX2ZyYW1lVGltZSk7XG4gICAgICAgIGlmICgoZnJhbWVHYXAgPiB0aGlzLl9qdW1wVHJ5VGhyZXNob2xkIHx8IGZyYW1lR2FwIDwgMCkgJiZcbiAgICAgICAgICAgICghdGhpcy5fd2FpdGluZ1N0YXJ0UG9pbnQpICYmXG4gICAgICAgICAgICAodGhpcy5fbGFzdFJlcXVlc3RlZFN0YXJ0UG9pbnRUaW1lIDwgdGhpcy5fY3VycmVudFRpbWUpKSB7XG4gICAgICAgICAgICAvLyDjgrnjg4rjg4Pjg5fjgrfjg6fjg4Pjg4jjgpLopoHmsYLjgaDjgZHjgZfjgabntprooYzjgZnjgoso44K544OK44OD44OX44K344On44OD44OI44GM5p2l44KL44G+44Gn6YCy44KB44KL6ZmQ44KK44Gv6YCy44KAKeOAglxuICAgICAgICAgICAgdGhpcy5fd2FpdGluZ1N0YXJ0UG9pbnQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fbGFzdFJlcXVlc3RlZFN0YXJ0UG9pbnRUaW1lID0gdGFyZ2V0VGltZTtcbiAgICAgICAgICAgIHRoaXMuX2FtZmxvdy5nZXRTdGFydFBvaW50KHsgdGltZXN0YW1wOiB0YXJnZXRUaW1lIH0sIHRoaXMuX29uR290U3RhcnRQb2ludF9ib3VuZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZyYW1lR2FwIDw9IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9za2lwcGluZylcbiAgICAgICAgICAgICAgICB0aGlzLl9zdG9wU2tpcHBpbmcoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuX3NraXBwaW5nKSB7XG4gICAgICAgICAgICBpZiAoKGZyYW1lR2FwID4gdGhpcy5fc2tpcFRocmVzaG9sZCB8fCB0aGlzLl90aWNrQnVmZmVyLmN1cnJlbnRBZ2UgPT09IDApICYmXG4gICAgICAgICAgICAgICAgKHRoaXMuX3RpY2tCdWZmZXIuaGFzTmV4dFRpY2soKSB8fCAodGhpcy5fb21pdEludGVycG9sYXRlZFRpY2tPblJlcGxheSAmJiB0aGlzLl9jb25zdW1lZExhdGVzdFRpY2spKSkge1xuICAgICAgICAgICAgICAgIC8vIOOBk+OBk+OBp+OBr+W4uOOBqyBgZnJhbWVHYXAgPiAwYCDjgafjgYLjgovjgZPjgajjgavms6jmhI/jgIIw44Gu5pmC44Grc2tpcOOBq+WFpeOBo+OBpuOCguOBmeOBkOaIu+OBo+OBpuOBl+OBvuOBhlxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXJ0U2tpcHBpbmcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgY29uc3VtZWRGcmFtZSA9IDA7XG4gICAgICAgIGZvciAoOyBjb25zdW1lZEZyYW1lIDwgdGhpcy5fc2tpcFRpY2tzQXRPbmNlOyArK2NvbnN1bWVkRnJhbWUpIHtcbiAgICAgICAgICAgIHZhciBuZXh0RnJhbWVUaW1lID0gdGhpcy5fY3VycmVudFRpbWUgKyB0aGlzLl9mcmFtZVRpbWU7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX3RpY2tCdWZmZXIuaGFzTmV4dFRpY2soKSkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fd2FpdGluZ05leHRUaWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXJ0V2FpdGluZ05leHRUaWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fY29uc3VtZWRMYXRlc3RUaWNrKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGlja0J1ZmZlci5yZXF1ZXN0VGlja3MoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX29taXRJbnRlcnBvbGF0ZWRUaWNrT25SZXBsYXkgJiYgdGhpcy5fc2NlbmVMb2NhbE1vZGUgPT09IGcuTG9jYWxUaWNrTW9kZS5JbnRlcnBvbGF0ZUxvY2FsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jb25zdW1lZExhdGVzdFRpY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOacgOaWsOOBruODhuOCo+ODg+OCr+OBjOWtmOWcqOOBl+OBquOBhOWgtOWQiOOBr+ePvuWcqOaZguWIu+OCkuebruaomeaZguWIu+OBq+WQiOOCj+OBm+OCi+OAglxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gKF9kb0xvY2FsVGljaygpIOOBq+OCiOOCiuePvuWcqOaZguWIu+OBjCB0aGlzLl9mcmFtZVRpbWUg6YCy44KA44Gu44Gn44Gd44Gu55u05YmN44G+44Gn6YCy44KB44KLKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFRpbWUgPSB0YXJnZXRUaW1lIC0gdGhpcy5fZnJhbWVUaW1lO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIOODhuOCo+ODg+OCr+OBjOOBquOBj+OAgeebruaomeaZguWIu+OBq+WIsOmBlOOBl+OBpuOBhOOBquOBhOWgtOWQiOOAgeijnOmWk+ODhuOCo+ODg+OCr+OCkuaMv+WFpeOBmeOCi+OAglxuICAgICAgICAgICAgICAgICAgICAvLyAo57WM57ev5LiK44GT44GT44Gg44GR44OV44Op44Kw5ZCN44Go6YCG44Gj44G944GE5oyZ5YuV44Gr44Gq44Gj44Gm44GX44G+44Gj44Gm44GE44KL54K544Gr5rOo5oSP44CCVE9ETyDjg5Xjg6njgrDjgpLmlLnlkI3jgZnjgospXG4gICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRUaW1lID4gbmV4dEZyYW1lVGltZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2RvTG9jYWxUaWNrKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIG5leHRUaWNrVGltZSA9IHRoaXMuX3RpY2tCdWZmZXIucmVhZE5leHRUaWNrVGltZSgpO1xuICAgICAgICAgICAgaWYgKG5leHRUaWNrVGltZSA9PSBudWxsKVxuICAgICAgICAgICAgICAgIG5leHRUaWNrVGltZSA9IG5leHRGcmFtZVRpbWU7XG4gICAgICAgICAgICBpZiAodGFyZ2V0VGltZSA8IG5leHRGcmFtZVRpbWUpIHtcbiAgICAgICAgICAgICAgICAvLyDmrKHjg5Xjg6zjg7zjg6DjgavpgLLjgoDjgajnm67mqJnmmYLliLvjgpLotoXpgY7jgZnjgovvvJ3mrKHjg5Xjg6zjg7zjg6DmmYLliLvjgb7jgafjga/pgLLjgoHjgarjgYTvvJ3oo5zplpPjg4bjgqPjg4Pjgq/jga/lv4XopoHjgarjgYTjgIJcbiAgICAgICAgICAgICAgICBpZiAobmV4dFRpY2tUaW1lIDw9IHRhcmdldFRpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8g54m55q6K44Kx44O844K5OiDnm67mqJnmmYLliLvjgojjgormiYvliY3jgavmrKHjg4bjgqPjg4Pjgq/jgYzjgYLjgovjga7jgafjgIHnm67mqJnmmYLliLvjgb7jgafjga/pgLLjgpPjgafmrKHjg4bjgqPjg4Pjgq/jga/mtojljJbjgZfjgabjgZfjgb7jgYbjgIJcbiAgICAgICAgICAgICAgICAgICAgLy8gKOOBk+OBruWHpueQhuOBjOOBquOBhOOBqOOAgeeJueOBq+ODquODl+ODrOOCpOOBp+OAjOacgOW+jOOBruODhuOCo+ODg+OCr+OBrjAuMeODleODrOODvOODoOaZgumWk+WJjeOAjeOBquOBqeOBq+adpeOBn+OBqOOBjeOBq+mAsuOCgeOBquOBj+OBquOBo+OBpuOBl+OBvuOBhuOAgilcbiAgICAgICAgICAgICAgICAgICAgbmV4dEZyYW1lVGltZSA9IHRhcmdldFRpbWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAobmV4dEZyYW1lVGltZSA8IG5leHRUaWNrVGltZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fb21pdEludGVycG9sYXRlZFRpY2tPblJlcGxheSAmJiB0aGlzLl9za2lwcGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8g44K544Kt44OD44OX5Lit44CB44OG44Kj44OD44Kv6KOc6ZaT5LiN6KaB44Gq44KJ5Y2z5bqn44Gr5qyh44OG44Kj44OD44Kv5pmC5Yi7KOOBi+OBneOBruaJi+WJjeOBruebruaomeaZguWIuynjgb7jgafpgLLjgoHjgovjgIJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIChfb25GcmFtZU5vcm1hbCgp44Gu5a++5b+c566H5omA44Go55Ww44Gq44KK44CB44GT44GT44Gn44Gv44CM5qyh44OG44Kj44OD44Kv5pmC5Yi744GuIFwi5qyh44OV44Os44O844Og5pmC5Yi7XCLjgI3jgavliIfjgorkuIrjgZLjgarjgYTjgZPjgajjgavms6jmhI/jgIJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICDmmYLplpPjg5njg7zjgrnjg6rjg5fjg6zjgqTjgafjga/nm67mqJnmmYLliLsgXCLku6XlvoxcIiDjgavjga/pgLLjgoHjgarjgYTjgajjgYTjgYbliLbntITjgYzjgYLjgovjgILjgZPjgozjgpLljZjntJTjgarlrp/oo4XjgaflrojjgovjgbnjgY/liIfjgorkuIrjgZLjgpLmlq3lv7XjgZfjgabjgYTjgospXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0VGltZSA8PSBuZXh0VGlja1RpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDmrKHjg4bjgqPjg4Pjgq/mmYLliLvjgb7jgafpgLLjgoHjgovjgajnm67mqJnmmYLliLvjgpLotoXjgYjjgabjgZfjgb7jgYY6IOebruaomeaZguWIu+ebtOWJjeOBvuOBp+WLleOBhOOBpuaKnOOBkeOCiyjnm67mqJnmmYLliLvnm7TliY3jgb7jgafjga/mnaXjgarjgYTjgajnm67mqJnmmYLliLvliLDpgZTpgJrnn6XjgYzmsLjkuYXjgavjgafjgY3jgarjgYQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fb21pdHRlZFRpY2tEdXJhdGlvbiArPSB0YXJnZXRUaW1lIC0gdGhpcy5fY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFRpbWUgPSBNYXRoLmZsb29yKHRhcmdldFRpbWUgLyB0aGlzLl9mcmFtZVRpbWUpICogdGhpcy5fZnJhbWVUaW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dEZyYW1lVGltZSA9IG5leHRUaWNrVGltZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29taXR0ZWRUaWNrRHVyYXRpb24gKz0gbmV4dFRpY2tUaW1lIC0gdGhpcy5fY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fc2NlbmVMb2NhbE1vZGUgPT09IGcuTG9jYWxUaWNrTW9kZS5JbnRlcnBvbGF0ZUxvY2FsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZG9Mb2NhbFRpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fY3VycmVudFRpbWUgPSBuZXh0RnJhbWVUaW1lO1xuICAgICAgICAgICAgdmFyIHRpY2sgPSB0aGlzLl90aWNrQnVmZmVyLmNvbnN1bWUoKTtcbiAgICAgICAgICAgIHZhciBjb25zdW1lZEFnZSA9IC0xO1xuICAgICAgICAgICAgdmFyIHBsRXZlbnRzID0gdGhpcy5fZXZlbnRCdWZmZXIucmVhZExvY2FsRXZlbnRzKCk7XG4gICAgICAgICAgICBpZiAocGxFdmVudHMpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMCwgbGVuID0gcGxFdmVudHMubGVuZ3RoOyBqIDwgbGVuOyArK2opIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5ldmVudHMucHVzaCh0aGlzLl9ldmVudENvbnZlcnRlci50b0dhbWVFdmVudChwbEV2ZW50c1tqXSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGljayA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICAgICAgICAgIGNvbnN1bWVkQWdlID0gdGljaztcbiAgICAgICAgICAgICAgICBzY2VuZUNoYW5nZWQgPSBnYW1lLnRpY2sodHJ1ZSwgTWF0aC5mbG9vcih0aGlzLl9vbWl0dGVkVGlja0R1cmF0aW9uIC8gdGhpcy5fZnJhbWVUaW1lKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdW1lZEFnZSA9IHRpY2tbMCAvKiBBZ2UgKi9dO1xuICAgICAgICAgICAgICAgIHZhciBwZXZzID0gdGlja1sxIC8qIEV2ZW50cyAqL107XG4gICAgICAgICAgICAgICAgaWYgKHBldnMpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGxlbiA9IHBldnMubGVuZ3RoOyBqIDwgbGVuOyArK2opIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuZXZlbnRzLnB1c2godGhpcy5fZXZlbnRDb252ZXJ0ZXIudG9HYW1lRXZlbnQocGV2c1tqXSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNjZW5lQ2hhbmdlZCA9IGdhbWUudGljayh0cnVlLCBNYXRoLmZsb29yKHRoaXMuX29taXR0ZWRUaWNrRHVyYXRpb24gLyB0aGlzLl9mcmFtZVRpbWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX29taXR0ZWRUaWNrRHVyYXRpb24gPSAwO1xuICAgICAgICAgICAgaWYgKGdhbWUuX25vdGlmeVBhc3NlZEFnZVRhYmxlW2NvbnN1bWVkQWdlXSkge1xuICAgICAgICAgICAgICAgIC8vIOKGkSDnhKHpp4TjgarplqLmlbDjgrPjg7zjg6vjgpLpgb/jgZHjgovjgZ/jgoHmsZrjgYTjgYzlpJbpg6jjgYvjgonkuovliY3jg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5maXJlQWdlUGFzc2VkSWZOZWVkZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBhZ2XliLDpgZTpgJrnn6XjgZfjgZ/jgonjg4njg6njgqTjg5Djg6bjg7zjgrbjgYzkvZXjgYvjgZfjgabjgYTjgovlj6/og73mgKfjgYzjgYLjgovjga7jgafmipzjgZHjgotcbiAgICAgICAgICAgICAgICAgICAgZnJhbWVBcmcuaW50ZXJydXB0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNjZW5lQ2hhbmdlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZVNjZW5lQ2hhbmdlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7IC8vIOOCt+ODvOODs+OBjOWkieOCj+OBo+OBn+OCieODreODvOOCq+ODq+OCt+ODvOODs+OBq+WFpeOBo+OBpuOBhOOCi+OBi+OCguOBl+OCjOOBquOBhOOBruOBp+S4gOW6puaKnOOBkeOCi1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9za2lwcGluZyAmJiAodGFyZ2V0VGltZSAtIHRoaXMuX2N1cnJlbnRUaW1lIDwgdGhpcy5fZnJhbWVUaW1lKSlcbiAgICAgICAgICAgIHRoaXMuX3N0b3BTa2lwcGluZygpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICog6Z2e44Ot44O844Kr44Or44K344O844Oz44Gu6YCa5bi444Kx44O844K544Gu44OV44Os44O844Og5Yem55CG44CCXG4gICAgICog5pmC5Yi76Zai5pWw44GM5LiO44GI44KJ44KM44Gm44GE44Gq44GE44CB44G+44Gf44Gv44Oq44OX44Os44Kk44Gn44Gq44GE5aC05ZCI44Gr55So44GE44KJ44KM44KL44CCXG4gICAgICovXG4gICAgR2FtZUxvb3AucHJvdG90eXBlLl9vbkZyYW1lTm9ybWFsID0gZnVuY3Rpb24gKGZyYW1lQXJnKSB7XG4gICAgICAgIHZhciBzY2VuZUNoYW5nZWQgPSBmYWxzZTtcbiAgICAgICAgdmFyIGdhbWUgPSB0aGlzLl9nYW1lO1xuICAgICAgICAvLyBOT1RFOiDjg5bjg6njgqbjgrbjgYzplbfmmYLplpPpnZ7jgqLjgq/jg4bjgqPjg5bnirbmhYsgKOijj+OCv+ODluOBq+mBt+enu+OBl+OBpuOBhOOBn+OBquOBqSkg44Gn44GC44Gj44Gf44Go44GN44CB6ZW35pmC6ZaT44Ky44O844Og44Or44O844OX44GM5ZG844Gw44KM44Gq44GE44Kx44O844K544GM44GC44KL44CCXG4gICAgICAgIC8vIOOCguOBl+OBneOBruacn+mWk+OBjOOCueOCreODg+ODl+OBrumWvuWApOOCkui2heOBiOOBpuOBhOOBn+OCieOAgeWNs+W6p+OBq+OCueOCreODg+ODl+OBq+WFpeOCi+OAglxuICAgICAgICBpZiAoIXRoaXMuX3NraXBwaW5nICYmIGZyYW1lQXJnLmRlbHRhVGltZSA+IHRoaXMuX3NraXBUaHJlc2hvbGRUaW1lKSB7XG4gICAgICAgICAgICB0aGlzLl9zdGFydFNraXBwaW5nKCk7XG4gICAgICAgICAgICAvLyDjgZ/jgaDjgZfjg4bjgqPjg4Pjgq/lvoXjgaHjgYznhKHjgZHjgozjgbDjgZnjgZDjgavjgrnjgq3jg4Pjg5fjgpLmipzjgZHjgovjgIJcbiAgICAgICAgICAgIGlmICh0aGlzLl93YWl0aW5nTmV4dFRpY2spXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RvcFNraXBwaW5nKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX3dhaXRpbmdOZXh0VGljaykge1xuICAgICAgICAgICAgaWYgKHRoaXMuX3NjZW5lTG9jYWxNb2RlID09PSBnLkxvY2FsVGlja01vZGUuSW50ZXJwb2xhdGVMb2NhbClcbiAgICAgICAgICAgICAgICB0aGlzLl9kb0xvY2FsVGljaygpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0YXJnZXRBZ2U7XG4gICAgICAgIHZhciBhZ2VHYXA7XG4gICAgICAgIHZhciBjdXJyZW50QWdlID0gdGhpcy5fdGlja0J1ZmZlci5jdXJyZW50QWdlO1xuICAgICAgICBpZiAodGhpcy5fbG9vcE1vZGUgPT09IExvb3BNb2RlXzEuZGVmYXVsdC5SZWFsdGltZSkge1xuICAgICAgICAgICAgdGFyZ2V0QWdlID0gdGhpcy5fdGlja0J1ZmZlci5rbm93bkxhdGVzdEFnZSArIDE7XG4gICAgICAgICAgICBhZ2VHYXAgPSB0YXJnZXRBZ2UgLSBjdXJyZW50QWdlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuX3RhcmdldEFnZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIC8vIHRhcmdldEFnZeOBjOOBquOBhDog44Gf44Gg44Oq44OX44Os44Kk44GX44Gm6KaL44Gm44GE44KL44Gg44GR44Gu54q25oWL44CCMeODleODrOODvOODoOaZgumWk+e1jOmBjiA9PSAxYWdl5raI5YyW44CCXG4gICAgICAgICAgICAgICAgdGFyZ2V0QWdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBhZ2VHYXAgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5fdGFyZ2V0QWdlID09PSBjdXJyZW50QWdlKSB7XG4gICAgICAgICAgICAgICAgLy8gdGFyZ2V0QWdl44Gr5Yiw6YGU44GX44GfOiB0YXJnZXRBZ2XjgarjgZfnirbmhYvjgavjgarjgovjgIJcbiAgICAgICAgICAgICAgICB0YXJnZXRBZ2UgPSB0aGlzLl90YXJnZXRBZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIGFnZUdhcCA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyB0YXJnZXRBZ2XjgYzjgYLjgorjgIHjgb7jgaDliLDpgZTjgZfjgabjgYTjgarjgYTjgIJcbiAgICAgICAgICAgICAgICB0YXJnZXRBZ2UgPSB0aGlzLl90YXJnZXRBZ2U7XG4gICAgICAgICAgICAgICAgYWdlR2FwID0gdGFyZ2V0QWdlIC0gY3VycmVudEFnZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoKGFnZUdhcCA+IHRoaXMuX2p1bXBUcnlUaHJlc2hvbGQgfHwgYWdlR2FwIDwgMCkgJiZcbiAgICAgICAgICAgICghdGhpcy5fd2FpdGluZ1N0YXJ0UG9pbnQpICYmXG4gICAgICAgICAgICAodGhpcy5fbGFzdFJlcXVlc3RlZFN0YXJ0UG9pbnRBZ2UgPCBjdXJyZW50QWdlKSkge1xuICAgICAgICAgICAgLy8g44K544OK44OD44OX44K344On44OD44OI44KS6KaB5rGC44Gg44GR44GX44Gm57aa6KGM44GZ44KLKOOCueODiuODg+ODl+OCt+ODp+ODg+ODiOOBjOadpeOCi+OBvuOBp+mAsuOCgeOCi+mZkOOCiuOBr+mAsuOCgCnjgIJcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyDkuIrjga7mnaHku7bjgYwgX2xhc3RSZXF1ZXN0ZWRTdGFydFBvaW50QWdlIOOCkuWPgueFp+OBl+OBpuOBhOOCi+OBruOBr+OAgeOCueODiuODg+ODl+OCt+ODp+ODg+ODiOOBp+mjm+OCk+OBoOW+jOOCguOBquOBilxuICAgICAgICAgICAgLy8gYGFnZUdhcGAg44GM5aSn44GN44GE5aC05ZCI44Gr44CB5bu244CF44K544OK44OD44OX44K344On44OD44OI44KS44Oq44Kv44Ko44K544OI44GX57aa44GR44KL44Gu44KS6YG/44GR44KL44Gf44KB44Gn44GC44KL44CCXG4gICAgICAgICAgICAvLyDlrp/pmpvjgavjga9hZ2XjgYzpgLLjgoHjgbDmlrDjgZ/jgarjgrnjg4rjg4Pjg5fjgrfjg6fjg4Pjg4jjgYzkv53lrZjjgZXjgozjgabjgYTjgovlj6/og73mgKfjgoLjgYLjgovjga7jgafjgIFcbiAgICAgICAgICAgIC8vIGB0YXJnZXRBZ2VgIOOBjOWkieOCj+OCjOOBsOODquOCr+OCqOOCueODiOOBl+e2muOBkeOCi+OBruOBjOWFqOOBj+OBrueEoemnhOOBqOOBhOOBhuOCj+OBkeOBp+OBr+OBquOBhOOAglxuICAgICAgICAgICAgLy8g44GM44CBYFJlYWx0aW1lYCDjgaflrp/ooYzjgZfjgabjgYTjgovloLTlkIggYHRhcmdldEFnZWAg44Gv5q+O44OV44Os44O844Og5aSJ5YyW44GX44Gm44GX44G+44GG44GX44CBXG4gICAgICAgICAgICAvLyDjgrnjg4rjg4Pjg5fjgrfjg6fjg4Pjg4jjgYzjgZ3jgozjgbvjganpoLvnuYHjgavkv53lrZjjgZXjgozjgovjgajjga/mgJ3jgYjjgarjgYQo44GZ44G544GN44Gn44KC44Gq44GEKeOAguOBk+OBk+OBp+OBr+WJsuOCiuWIh+OBo+OBpuaKkeWItuOBl+OBpuOBiuOBj+OAglxuICAgICAgICAgICAgdGhpcy5fd2FpdGluZ1N0YXJ0UG9pbnQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fbGFzdFJlcXVlc3RlZFN0YXJ0UG9pbnRBZ2UgPSB0YXJnZXRBZ2U7XG4gICAgICAgICAgICB0aGlzLl9hbWZsb3cuZ2V0U3RhcnRQb2ludCh7IGZyYW1lOiB0YXJnZXRBZ2UgfSwgdGhpcy5fb25Hb3RTdGFydFBvaW50X2JvdW5kKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWdlR2FwIDw9IDApIHtcbiAgICAgICAgICAgIGlmIChhZ2VHYXAgPT09IDApIHtcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudEFnZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBOT1RFOiBNYW51YWzjga7jgrfjg7zjg7Pjgafjga8gYWdlPTEg44Gu44OG44Kj44OD44Kv44GM6ZW35pmC6ZaT5Y+X5L+h44Gn44GN44Gq44GE5aC05ZCI44GM44GC44KL44CCKFRpY2tCdWZmZXIjYWRkVGljaygp44GM5ZG844Gw44KM44Gq44GEKVxuICAgICAgICAgICAgICAgICAgICAvLyDjgZ3jga7jgrHjg7zjgrnjgafjga/mnIDliJ3jga7jg4bjgqPjg4Pjgq/jga7lj5fkv6Hjgavjg53jg7zjg6rjg7PjgrDmmYLplpMo5Yid5pyf5YCkOiAxMOenkinjgYvjgYvjgaPjgabjgZfjgb7jgYbjgZ/jgoHjgIHjgZPjgZPjgafmnIDmlrDjg4bjgqPjg4Pjgq/jgpLopoHmsYLjgZnjgovjgIJcbiAgICAgICAgICAgICAgICAgICAgLy8gKOWIneacn+OCt+ODvOODs+OBjE5vbkxvY2Fs44Gn44GC44Gj44Gm44KC44OG44Kj44OD44Kv44Gu6YCy6KGM44Gr44KI44KKTWFudWFs44Gu44K344O844Oz44Gr56e76KGM44GX44Gm44GX44G+44GG5Y+v6IO95oCn44GM44GC44KL44Gf44KB44CB5bi444Gr5pyA5paw44Gu44OG44Kj44OD44Kv44KS6KaB5rGC44GX44Gm44GE44KL44CCKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90aWNrQnVmZmVyLnJlcXVlc3RUaWNrcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyDml6Lnn6XmnIDmlrDjg4bjgqPjg4Pjgq/jgavov73jgYTjgaTjgYTjgZ/jga7jgafjgIHjg53jg7zjg6rjg7PjgrDlh6bnkIbjgavjgojjgorlvozntprjg4bjgqPjg4Pjgq/jgpLopoHmsYLjgZnjgovjgIJcbiAgICAgICAgICAgICAgICAvLyBOT1RFOiBNYW51YWzjga7jgrfjg7zjg7Pjgafjga/mnIDmlrDjg4bjgqPjg4Pjgq/jga7nlJ/miJDjgZ3jga7jgoLjga7jgYzplbfmmYLplpPotbfjgY3jgarjgYTlj6/og73mgKfjgYzjgYLjgovjgIJcbiAgICAgICAgICAgICAgICAvLyAoTWFudWFs44Gn44Gq44GP44Gm44KC44CB5pyA5paw44OG44Kj44OD44Kv44Gu5Y+X5L+h44GM6ZW35pmC6ZaT6LW344GN44Gq44GE44GT44Go44Gv44GC44KK44GG44KLKOmVt+OBhOODreODvOODh+OCo+ODs+OCsOOCt+ODvOODs+OBquOBqSkpXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhcnRXYWl0aW5nTmV4dFRpY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLl9zY2VuZUxvY2FsTW9kZSA9PT0gZy5Mb2NhbFRpY2tNb2RlLkludGVycG9sYXRlTG9jYWwpIHtcbiAgICAgICAgICAgICAgICAvLyDjg4bjgqPjg4Pjgq/lvoXjgaHjga7plpPjgIHjg63jg7zjgqvjg6vjg4bjgqPjg4Pjgq/jgpIo6KOc6ZaT44GX44GmKea2iOiyuzog5LiK44Gu5pqr5a6a5a++5Yem44GucmVxdWVzdFRpY2tzKCnjgojjgorlvozjgavooYzjgYbjgbnjgY3jgafjgYLjgovngrnjgavms6jmhI/jgIJcbiAgICAgICAgICAgICAgICAvLyDjg63jg7zjgqvjg6vjg4bjgqPjg4Pjgq/jgpLmtojosrvjgZnjgovjgajjgIHjgrLjg7zjg6Djgrnjgq/jg6rjg5fjg4jjgYxyYWlzZVRpY2soKeOBmeOCiyhfd2FpdGluZ05leHRUaWNr44GM56uL44Gk44Gu44Gv44GK44GL44GX44GEKeWPr+iDveaAp+OBjOOBguOCi+OAglxuICAgICAgICAgICAgICAgIHRoaXMuX2RvTG9jYWxUaWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5fc2tpcHBpbmcpXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RvcFNraXBwaW5nKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl9za2lwcGluZyAmJiAoYWdlR2FwID4gdGhpcy5fc2tpcFRocmVzaG9sZCB8fCBjdXJyZW50QWdlID09PSAwKSAmJiB0aGlzLl90aWNrQnVmZmVyLmhhc05leHRUaWNrKCkpIHtcbiAgICAgICAgICAgIC8vIOOBk+OBk+OBp+OBr+W4uOOBqyAoYWdlR2FwID4gMCkg44Gn44GC44KL44GT44Go44Gr5rOo5oSP44CCKDDjga7mmYLjgatza2lw44Gr5YWl44Gj44Gm44KC44GZ44GQ5oi744Gj44Gm44GX44G+44GGKVxuICAgICAgICAgICAgdGhpcy5fc3RhcnRTa2lwcGluZygpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBsb29wQ291bnQgPSAoIXRoaXMuX3NraXBwaW5nICYmIGFnZUdhcCA8PSB0aGlzLl9kZWxheUlnbm9yZVRocmVzaG9sZCkgPyAxIDogTWF0aC5taW4oYWdlR2FwLCB0aGlzLl9za2lwVGlja3NBdE9uY2UpO1xuICAgICAgICB2YXIgY29uc3VtZWRGcmFtZSA9IDA7XG4gICAgICAgIGZvciAoOyBjb25zdW1lZEZyYW1lIDwgbG9vcENvdW50OyArK2NvbnN1bWVkRnJhbWUpIHtcbiAgICAgICAgICAgIC8vIOODhuOCo+ODg+OCr+aZguWIu+eiuuiqjVxuICAgICAgICAgICAgdmFyIG5leHRGcmFtZVRpbWUgPSB0aGlzLl9jdXJyZW50VGltZSArIHRoaXMuX2ZyYW1lVGltZTtcbiAgICAgICAgICAgIHZhciBuZXh0VGlja1RpbWUgPSB0aGlzLl90aWNrQnVmZmVyLnJlYWROZXh0VGlja1RpbWUoKTtcbiAgICAgICAgICAgIGlmIChuZXh0VGlja1RpbWUgIT0gbnVsbCAmJiBuZXh0RnJhbWVUaW1lIDwgbmV4dFRpY2tUaW1lKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2xvb3BNb2RlID09PSBMb29wTW9kZV8xLmRlZmF1bHQuUmVhbHRpbWUgfHwgKHRoaXMuX29taXRJbnRlcnBvbGF0ZWRUaWNrT25SZXBsYXkgJiYgdGhpcy5fc2tpcHBpbmcpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIOODquOCouODq+OCv+OCpOODoOODouODvOODiSjjgajml6npgIHjgorkuK3jga7jg6rjg5fjg6zjgqTjgafjg4bjgqPjg4Pjgq/oo5zplpPjgZfjgarjgYTloLTlkIgp44Gn44Gv44OG44Kj44OD44Kv5pmC5Yi744KS5rCX44Gr44Gb44Ga57aa6KGM44GZ44KL44GM44CBXG4gICAgICAgICAgICAgICAgICAgIC8vIOODquODl+ODrOOCpOODouODvOODieOBq+WIh+OCiuabv+OBiOOBn+aZguOBq+efm+ebvuOBl+OBquOBhOOCiOOBhuaZguWIu+OCkuijnOato+OBmeOCiyjlvZPoqbLjg4bjgqPjg4Pjgq/mmYLliLvjgb7jgaflvoXjgaPjgZ/mibHjgYTjgavjgZnjgosp44CCXG4gICAgICAgICAgICAgICAgICAgIG5leHRGcmFtZVRpbWUgPSBNYXRoLmNlaWwobmV4dFRpY2tUaW1lIC8gdGhpcy5fZnJhbWVUaW1lKSAqIHRoaXMuX2ZyYW1lVGltZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb21pdHRlZFRpY2tEdXJhdGlvbiArPSBuZXh0RnJhbWVUaW1lIC0gdGhpcy5fY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fc2NlbmVMb2NhbE1vZGUgPT09IGcuTG9jYWxUaWNrTW9kZS5JbnRlcnBvbGF0ZUxvY2FsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9kb0xvY2FsVGljaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fY3VycmVudFRpbWUgPSBuZXh0RnJhbWVUaW1lO1xuICAgICAgICAgICAgdmFyIHRpY2sgPSB0aGlzLl90aWNrQnVmZmVyLmNvbnN1bWUoKTtcbiAgICAgICAgICAgIHZhciBjb25zdW1lZEFnZSA9IC0xO1xuICAgICAgICAgICAgaWYgKHRpY2sgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBwbEV2ZW50cyA9IHRoaXMuX2V2ZW50QnVmZmVyLnJlYWRMb2NhbEV2ZW50cygpO1xuICAgICAgICAgICAgICAgIGlmIChwbEV2ZW50cykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcGxFdmVudHMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuZXZlbnRzLnB1c2godGhpcy5fZXZlbnRDb252ZXJ0ZXIudG9HYW1lRXZlbnQocGxFdmVudHNbaV0pKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRpY2sgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3VtZWRBZ2UgPSB0aWNrO1xuICAgICAgICAgICAgICAgICAgICBzY2VuZUNoYW5nZWQgPSBnYW1lLnRpY2sodHJ1ZSwgTWF0aC5mbG9vcih0aGlzLl9vbWl0dGVkVGlja0R1cmF0aW9uIC8gdGhpcy5fZnJhbWVUaW1lKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdW1lZEFnZSA9IHRpY2tbMCAvKiBBZ2UgKi9dO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcGV2cyA9IHRpY2tbMSAvKiBFdmVudHMgKi9dO1xuICAgICAgICAgICAgICAgICAgICBpZiAocGV2cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGxlbiA9IHBldnMubGVuZ3RoOyBqIDwgbGVuOyArK2opIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLmV2ZW50cy5wdXNoKHRoaXMuX2V2ZW50Q29udmVydGVyLnRvR2FtZUV2ZW50KHBldnNbal0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzY2VuZUNoYW5nZWQgPSBnYW1lLnRpY2sodHJ1ZSwgTWF0aC5mbG9vcih0aGlzLl9vbWl0dGVkVGlja0R1cmF0aW9uIC8gdGhpcy5fZnJhbWVUaW1lKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX29taXR0ZWRUaWNrRHVyYXRpb24gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8g5pmC6ZaT44Gv57WM6YGO44GX44Gm44GE44KL44GM5raI6LK744GZ44G544GN44OG44Kj44OD44Kv44GM5bGK44GE44Gm44GE44Gq44GEXG4gICAgICAgICAgICAgICAgdGhpcy5fdGlja0J1ZmZlci5yZXF1ZXN0VGlja3MoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGFydFdhaXRpbmdOZXh0VGljaygpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdhbWUuX25vdGlmeVBhc3NlZEFnZVRhYmxlW2NvbnN1bWVkQWdlXSkge1xuICAgICAgICAgICAgICAgIC8vIOKGkSDnhKHpp4TjgarplqLmlbDjgrPjg7zjg6vjgpLpgb/jgZHjgovjgZ/jgoHmsZrjgYTjgYzlpJbpg6jjgYvjgonkuovliY3jg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5maXJlQWdlUGFzc2VkSWZOZWVkZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBhZ2XliLDpgZTpgJrnn6XjgZfjgZ/jgonjg4njg6njgqTjg5Djg6bjg7zjgrbjgYzkvZXjgYvjgZfjgabjgYTjgovlj6/og73mgKfjgYzjgYLjgovjga7jgafmipzjgZHjgotcbiAgICAgICAgICAgICAgICAgICAgZnJhbWVBcmcuaW50ZXJydXB0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNjZW5lQ2hhbmdlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZVNjZW5lQ2hhbmdlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7IC8vIOOCt+ODvOODs+OBjOWkieOCj+OBo+OBn+OCieODreODvOOCq+ODq+OCt+ODvOODs+OBq+WFpeOBo+OBpuOBhOOCi+OBi+OCguOBl+OCjOOBquOBhOOBruOBp+S4gOW6puaKnOOBkeOCi1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9za2lwcGluZyAmJiAodGFyZ2V0QWdlIC0gdGhpcy5fdGlja0J1ZmZlci5jdXJyZW50QWdlIDwgMSkpXG4gICAgICAgICAgICB0aGlzLl9zdG9wU2tpcHBpbmcoKTtcbiAgICB9O1xuICAgIEdhbWVMb29wLnByb3RvdHlwZS5fb25Hb3ROZXh0RnJhbWVUaWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9jb25zdW1lZExhdGVzdFRpY2sgPSBmYWxzZTtcbiAgICAgICAgaWYgKCF0aGlzLl93YWl0aW5nTmV4dFRpY2spXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICh0aGlzLl9sb29wTW9kZSA9PT0gTG9vcE1vZGVfMS5kZWZhdWx0LkZyYW1lQnlGcmFtZSkge1xuICAgICAgICAgICAgLy8g44Kz44Oe6YCB44KK5a6f6KGM5pmC44CBVGlja+OBruWPl+S/oeOBr+Wun+ihjOOBq+W9semfv+OBl+OBquOBhOOAglxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3N0b3BXYWl0aW5nTmV4dFRpY2soKTtcbiAgICB9O1xuICAgIEdhbWVMb29wLnByb3RvdHlwZS5fb25Hb3ROb1RpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl93YWl0aW5nTmV4dFRpY2spXG4gICAgICAgICAgICB0aGlzLl9jb25zdW1lZExhdGVzdFRpY2sgPSB0cnVlO1xuICAgIH07XG4gICAgR2FtZUxvb3AucHJvdG90eXBlLl9vbkdvdFN0YXJ0UG9pbnQgPSBmdW5jdGlvbiAoZXJyLCBzdGFydFBvaW50KSB7XG4gICAgICAgIHRoaXMuX3dhaXRpbmdTdGFydFBvaW50ID0gZmFsc2U7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JUcmlnZ2VyLmZpcmUoZXJyKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuX3RhcmdldFRpbWVGdW5jIHx8IHRoaXMuX2xvb3BNb2RlID09PSBMb29wTW9kZV8xLmRlZmF1bHQuUmVhbHRpbWUpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXRBZ2UgPSAodGhpcy5fbG9vcE1vZGUgPT09IExvb3BNb2RlXzEuZGVmYXVsdC5SZWFsdGltZSkgPyB0aGlzLl90aWNrQnVmZmVyLmtub3duTGF0ZXN0QWdlICsgMSA6IHRoaXMuX3RhcmdldEFnZTtcbiAgICAgICAgICAgIGlmICh0YXJnZXRBZ2UgPT09IG51bGwgfHwgdGFyZ2V0QWdlIDwgc3RhcnRQb2ludC5mcmFtZSkge1xuICAgICAgICAgICAgICAgIC8vIOimgeaxguOBl+OBn+aZgueCueOBqOS7iuOBp+ebruaomWFnZSh0YXJnZXRBZ2Up44GM5aSJ44KP44Gj44Gm44GE44KL44CCXG4gICAgICAgICAgICAgICAgLy8g54++5Zyo44Gu54q25rOB44Gn44Gv6aOb44G25b+F6KaB44GM44Gq44GE44GL44CB5b6X44KJ44KM44GfU3RhcnRQb2ludOOBp+OBr+ebruaomWFnZeOCiOOCiuacquadpeOBq+mjm+OCk+OBp+OBl+OBvuOBhuOAglxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjdXJyZW50QWdlID0gdGhpcy5fdGlja0J1ZmZlci5jdXJyZW50QWdlO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRBZ2UgPD0gdGFyZ2V0QWdlICYmIHN0YXJ0UG9pbnQuZnJhbWUgPCBjdXJyZW50QWdlICsgdGhpcy5fanVtcElnbm9yZVRocmVzaG9sZCkge1xuICAgICAgICAgICAgICAgIC8vIOS7iuOBruebruaomWFnZSh0YXJnZXRBZ2Up44Gv6YGO5Y6744Gn44Gq44GE5LiA5pa544CB5b6X44KJ44KM44GfU3RhcnRQb2ludOOBr+iHs+i/keacquadpeOBvuOBn+OBr+mBjuWOu+OBruOCguOBriDihpIg6aOb44G25L6h5YCk44Gq44GX44CCXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIHRhcmdldFRpbWUgPSB0aGlzLl90YXJnZXRUaW1lRnVuYygpICsgdGhpcy5fcmVhbFRhcmdldFRpbWVPZmZzZXQ7XG4gICAgICAgICAgICBpZiAodGFyZ2V0VGltZSA8IHN0YXJ0UG9pbnQudGltZXN0YW1wKSB7XG4gICAgICAgICAgICAgICAgLy8g6KaB5rGC44GX44Gf5pmC54K544Go5LuK44Gn55uu5qiZ5pmC5Yi7KHRhcmdldFRpbWUp44GM5aSJ44KP44Gj44Gm44GE44KL44CC5b6X44KJ44KM44GfU3RhcnRQb2ludOOBp+OBr+ebruaomeaZguWIu+OCiOOCiuacquadpeOBq+mjm+OCk+OBp+OBl+OBvuOBhuOAglxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjdXJyZW50VGltZSA9IHRoaXMuX2N1cnJlbnRUaW1lO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRUaW1lIDw9IHRhcmdldFRpbWUgJiYgc3RhcnRQb2ludC50aW1lc3RhbXAgPCBjdXJyZW50VGltZSArICh0aGlzLl9qdW1wSWdub3JlVGhyZXNob2xkICogdGhpcy5fZnJhbWVUaW1lKSkge1xuICAgICAgICAgICAgICAgIC8vIOS7iuOBruebruaomeaZguWIuyh0YXJnZXRUaW1lKeOBr+mBjuWOu+OBp+OBquOBhOS4gOaWueOAgeW+l+OCieOCjOOBn1N0YXJ0UG9pbnTjga/oh7Pov5HmnKrmnaXjgb7jgZ/jga/pgY7ljrvjga7jgoLjga4g4oaSIOmjm+OBtuS+oeWApOOBquOBl+OAglxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyDjg6rjgrvjg4Pjg4jjgYvjgokgYGcuR2FtZSNfc3RhcnQoKWAg44G+44GnKOOCqOODs+ODiOODquODneOCpOODs+ODiOWun+ihjOOBvuOBpynjga7plpPjgIFwcm9jZXNzRXZlbnRzKCkg44Gv6LW344GT44KJ44Gq44GE44KI44GG44Gr44GZ44KL44CCXG4gICAgICAgIC8vIOOBmeOBquOCj+OBoeOBk+OCjOS7pemZjSBgX29uR2FtZVN0YXJ0ZWQoKWAg44G+44Gn44Gu6ZaTIEV2ZW50QnVmZmVyIOOBi+OCieOCpOODmeODs+ODiOOBr+WPluW+l+OBp+OBjeOBquOBhOOAguOBl+OBi+OBl+OBneOCguOBneOCguOBk+OBrueKtuaFi+OBp+OBr1xuICAgICAgICAvLyDjgqTjg5njg7Pjg4jjgpLlh6bnkIbjgZnjgovjgrfjg7zjg7PjgYzjgYTjgarjgYQgPSDpnZ7jg63jg7zjgqvjg6vjg4bjgqPjg4Pjgq/jga/nlJ/miJDjgZXjgozjgarjgYQgPSDpnZ7jg63jg7zjgqvjg6vjg4bjgqPjg4Pjgq/nlJ/miJDmmYLjgavjga7jgb/ooYzjgo/jgozjgovjgqTjg5njg7Pjg4jjga7lj5blvpfjgoLjgarjgYTjgIJcbiAgICAgICAgdGhpcy5fY2xvY2suZnJhbWVUcmlnZ2VyLnJlbW92ZSh0aGlzLl9vbkV2ZW50c1Byb2Nlc3NlZCwgdGhpcyk7XG4gICAgICAgIGlmICh0aGlzLl9za2lwcGluZylcbiAgICAgICAgICAgIHRoaXMuX3N0b3BTa2lwcGluZygpO1xuICAgICAgICB0aGlzLl90aWNrQnVmZmVyLnNldEN1cnJlbnRBZ2Uoc3RhcnRQb2ludC5mcmFtZSk7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRUaW1lID0gc3RhcnRQb2ludC50aW1lc3RhbXAgfHwgc3RhcnRQb2ludC5kYXRhLnRpbWVzdGFtcCB8fCAwOyAvLyBkYXRhLnRpbWVzdGFtcCDjga/lvozmlrnkupLmj5vmgKfjga7jgZ/jgoHjgavlrZjlnKjjgILnj77lnKjjga/kvb/jgaPjgabjgYTjgarjgYTjgIJcbiAgICAgICAgdGhpcy5fd2FpdGluZ05leHRUaWNrID0gZmFsc2U7IC8vIOePvuWcqGFnZeOCkuWkieOBiOOBn+W+jOOAgeOBleOCieOBq+W+jOe2muOBrlRpY2vjgYzotrPjgorjgarjgYTjgYvjganjgYbjgYvjga9fb25GcmFtZeOBp+WIpOaWreOBmeOCi+OAglxuICAgICAgICB0aGlzLl9jb25zdW1lZExhdGVzdFRpY2sgPSBmYWxzZTsgLy8g5ZCM5LiK44CCXG4gICAgICAgIHRoaXMuX2xhc3RSZXF1ZXN0ZWRTdGFydFBvaW50QWdlID0gLTE7IC8vIOePvuWcqGFnZeOCkuWkieOBiOOBn+aZguOBr+ODquOCu+ODg+ODiOOBl+OBpuOBiuOBjyjloLTlkIjjgavjgojjgaPjgabjga/kuI3opoHjgaDjgYzjgIHlronlhajjga7jgZ/jgoEp44CCXG4gICAgICAgIHRoaXMuX2xhc3RSZXF1ZXN0ZWRTdGFydFBvaW50VGltZSA9IC0xOyAvLyDlkIzkuIrjgIJcbiAgICAgICAgdGhpcy5fb21pdHRlZFRpY2tEdXJhdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuX2dhbWUuX3Jlc3RhcnRXaXRoU25hcHNob3Qoc3RhcnRQb2ludCk7XG4gICAgICAgIHRoaXMuX2hhbmRsZVNjZW5lQ2hhbmdlKCk7XG4gICAgfTtcbiAgICBHYW1lTG9vcC5wcm90b3R5cGUuX29uR2FtZVN0YXJ0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIOW/heOBmuWFiOmgreOBq+aMv+WFpeOBmeOCi+OBk+OBqOOBp+OAgeWQjOOBmENsb2Nr44KS5Y+C54Wn44GZ44KLIGBUaWNrR2VuZXJhdG9yYCDjga7jg4bjgqPjg4Pjgq/nlJ/miJDjgarjganjgavmr47jg5Xjg6zjg7zjg6DlhYjooYzjgZfjgabjgqTjg5njg7Pjg4jjg5XjgqPjg6vjgr/jgpLpgannlKjjgZnjgovjgIJcbiAgICAgICAgLy8g5YWo5L2T55qE44GrIGB0aGlzLl9jbG9ja2Ag44GuaGFuZGxl6aCG44Gv5YuV5L2c6aCG44Gr55u057WQ44GZ44KL44Gu44Gn5rOo5oSP44GM5b+F6KaB44CCXG4gICAgICAgIHRoaXMuX2Nsb2NrLmZyYW1lVHJpZ2dlci5hZGQoeyBpbmRleDogMCwgb3duZXI6IHRoaXMsIGZ1bmM6IHRoaXMuX29uRXZlbnRzUHJvY2Vzc2VkIH0pO1xuICAgIH07XG4gICAgR2FtZUxvb3AucHJvdG90eXBlLl9vbkV2ZW50c1Byb2Nlc3NlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fZXZlbnRCdWZmZXIucHJvY2Vzc0V2ZW50cyh0aGlzLl9zY2VuZUxvY2FsTW9kZSA9PT0gZy5Mb2NhbFRpY2tNb2RlLkZ1bGxMb2NhbCk7XG4gICAgfTtcbiAgICBHYW1lTG9vcC5wcm90b3R5cGUuX3NldExvb3BSZW5kZXJNb2RlID0gZnVuY3Rpb24gKG1vZGUpIHtcbiAgICAgICAgaWYgKG1vZGUgPT09IHRoaXMuX2xvb3BSZW5kZXJNb2RlKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLl9sb29wUmVuZGVyTW9kZSA9IG1vZGU7XG4gICAgICAgIHN3aXRjaCAobW9kZSkge1xuICAgICAgICAgICAgY2FzZSBMb29wUmVuZGVyTW9kZV8xLmRlZmF1bHQuQWZ0ZXJSYXdGcmFtZTpcbiAgICAgICAgICAgICAgICB0aGlzLl9jbG9jay5yYXdGcmFtZVRyaWdnZXIuYWRkKHRoaXMuX3JlbmRlck9uUmF3RnJhbWUsIHRoaXMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBMb29wUmVuZGVyTW9kZV8xLmRlZmF1bHQuTm9uZTpcbiAgICAgICAgICAgICAgICB0aGlzLl9jbG9jay5yYXdGcmFtZVRyaWdnZXIucmVtb3ZlKHRoaXMuX3JlbmRlck9uUmF3RnJhbWUsIHRoaXMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yVHJpZ2dlci5maXJlKG5ldyBFcnJvcihcIkdhbWVMb29wI19zZXRMb29wUmVuZGVyTW9kZTogdW5rbm93biBtb2RlOiBcIiArIG1vZGUpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH07XG4gICAgR2FtZUxvb3AucHJvdG90eXBlLl9yZW5kZXJPblJhd0ZyYW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZ2FtZSA9IHRoaXMuX2dhbWU7XG4gICAgICAgIGlmIChnYW1lLm1vZGlmaWVkICYmIGdhbWUuc2NlbmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGdhbWUucmVuZGVyKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEdhbWVMb29wLnByb3RvdHlwZS5fb25HYW1lUmFpc2VFdmVudCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciBwZXYgPSB0aGlzLl9ldmVudENvbnZlcnRlci50b1BsYXlsb2dFdmVudChlKTtcbiAgICAgICAgdGhpcy5fZXZlbnRCdWZmZXIub25FdmVudChwZXYpO1xuICAgIH07XG4gICAgR2FtZUxvb3AucHJvdG90eXBlLl9vbkdhbWVSYWlzZVRpY2sgPSBmdW5jdGlvbiAoZXMpIHtcbiAgICAgICAgaWYgKHRoaXMuX2V4ZWN1dGlvbk1vZGUgIT09IEV4ZWN1dGlvbk1vZGVfMS5kZWZhdWx0LkFjdGl2ZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgLy8gVE9ETzog44Kk44OZ44Oz44OI44OV44Kj44Or44K/44Gu5Lit44Gn5ZG844Gw44KM44KL44Go44GK44GL44GX44GP44Gq44KLKOODleOCo+ODq+OCv+S4reOBruOCpOODmeODs+ODiOOBjHRpY2vjgavkuZfjgonjgarjgYQp44CCXG4gICAgICAgIGlmIChlcykge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlcy5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICB0aGlzLl9ldmVudEJ1ZmZlci5hZGRFdmVudERpcmVjdCh0aGlzLl9ldmVudENvbnZlcnRlci50b1BsYXlsb2dFdmVudChlc1tpXSkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3RpY2tDb250cm9sbGVyLmZvcmNlR2VuZXJhdGVUaWNrKCk7XG4gICAgfTtcbiAgICBHYW1lTG9vcC5wcm90b3R5cGUuX29uR2FtZU9wZXJhdGlvblBsdWdpbk9wZXJhdGVkID0gZnVuY3Rpb24gKG9wKSB7XG4gICAgICAgIHZhciBwZXYgPSB0aGlzLl9ldmVudENvbnZlcnRlci5tYWtlUGxheWxvZ09wZXJhdGlvbkV2ZW50KG9wKTtcbiAgICAgICAgdGhpcy5fZXZlbnRCdWZmZXIub25FdmVudChwZXYpO1xuICAgIH07XG4gICAgR2FtZUxvb3AucHJvdG90eXBlLl9vblBvbGxpbmdUaWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyDjgZPjga7plqLmlbDjgYzlkbzjgbDjgozjgovmmYLjgIEgYHRoaXMuX3dhaXRpbmdOZXh0VGlja2Ag44Gv5b+F44Ga55yf44Gn44GC44KL44CCXG4gICAgICAgIC8vIFRPRE86IHJhd0ZyYW1lVHJpZ2dlcuOBrmZpcmXmmYLjgavliY3lm57lkbzjgbPlh7rjgZfmmYLjgYvjgonjga7ntYzpgY7mmYLplpPjgpLmuKHjgZvjgbBuZXcgRGF0ZeOBmeOCi+W/heimgeOBr+OBquOBj+OBquOCi+OAglxuICAgICAgICB2YXIgdGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIGlmICh0aW1lIC0gdGhpcy5fbGFzdFBvbGxpbmdUaWNrVGltZSA+IHRoaXMuX3BvbGxpbmdUaWNrVGhyZXNob2xkKSB7XG4gICAgICAgICAgICB0aGlzLl9sYXN0UG9sbGluZ1RpY2tUaW1lID0gdGltZTtcbiAgICAgICAgICAgIHRoaXMuX3RpY2tCdWZmZXIucmVxdWVzdFRpY2tzKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEdhbWVMb29wLnByb3RvdHlwZS5fc3RhcnRXYWl0aW5nTmV4dFRpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3dhaXRpbmdOZXh0VGljayA9IHRydWU7XG4gICAgICAgIC8vIFRPRE86IEFjdGl2ZeaZguOBr+ODneODvOODquODs+OCsOOBl+OBquOBhCAo6KaBIEFjdGl2ZS9QYXNzaXZlIOWIh+OCiuabv+OBiOOBruWvvuW/nClcbiAgICAgICAgdGhpcy5fY2xvY2sucmF3RnJhbWVUcmlnZ2VyLmFkZCh0aGlzLl9vblBvbGxpbmdUaWNrLCB0aGlzKTtcbiAgICAgICAgdGhpcy5fbGFzdFBvbGxpbmdUaWNrVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIGlmICh0aGlzLl9za2lwcGluZylcbiAgICAgICAgICAgIHRoaXMuX3N0b3BTa2lwcGluZygpO1xuICAgIH07XG4gICAgR2FtZUxvb3AucHJvdG90eXBlLl9zdG9wV2FpdGluZ05leHRUaWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl93YWl0aW5nTmV4dFRpY2sgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fY2xvY2sucmF3RnJhbWVUcmlnZ2VyLnJlbW92ZSh0aGlzLl9vblBvbGxpbmdUaWNrLCB0aGlzKTtcbiAgICB9O1xuICAgIHJldHVybiBHYW1lTG9vcDtcbn0oKSk7XG5leHBvcnRzLkdhbWVMb29wID0gR2FtZUxvb3A7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuSm9pblJlc29sdmVyID0gZXhwb3J0cy5Kb2luTGVhdmVSZXF1ZXN0ID0gdm9pZCAwO1xudmFyIGcgPSByZXF1aXJlKFwiQGFrYXNoaWMvYWthc2hpYy1lbmdpbmVcIik7XG52YXIgSm9pbkxlYXZlUmVxdWVzdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBKb2luTGVhdmVSZXF1ZXN0KHBldiwgam9pblJlc29sdmVyLCBhbWZsb3csIGtleXMpIHtcbiAgICAgICAgdGhpcy5qb2luUmVzb2x2ZXIgPSBqb2luUmVzb2x2ZXI7XG4gICAgICAgIHRoaXMucGV2ID0gcGV2O1xuICAgICAgICBpZiAocGV2WzAgLyogQ29kZSAqL10gPT09IDAgLyogSm9pbiAqLyAmJiBrZXlzKSB7XG4gICAgICAgICAgICB0aGlzLnJlc29sdmVkID0gZmFsc2U7XG4gICAgICAgICAgICBhbWZsb3cuZ2V0U3RvcmFnZURhdGEoa2V5cywgdGhpcy5fb25Hb3RTdG9yYWdlRGF0YS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmVzb2x2ZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIEpvaW5MZWF2ZVJlcXVlc3QucHJvdG90eXBlLl9vbkdvdFN0b3JhZ2VEYXRhID0gZnVuY3Rpb24gKGVyciwgc2RzKSB7XG4gICAgICAgIHRoaXMucmVzb2x2ZWQgPSB0cnVlO1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICB0aGlzLmpvaW5SZXNvbHZlci5lcnJvclRyaWdnZXIuZmlyZShlcnIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGV2WzQgLyogU3RvcmFnZURhdGEgKi9dID0gc2RzO1xuICAgIH07XG4gICAgcmV0dXJuIEpvaW5MZWF2ZVJlcXVlc3Q7XG59KCkpO1xuZXhwb3J0cy5Kb2luTGVhdmVSZXF1ZXN0ID0gSm9pbkxlYXZlUmVxdWVzdDtcbnZhciBKb2luUmVzb2x2ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gSm9pblJlc29sdmVyKHBhcmFtKSB7XG4gICAgICAgIHRoaXMuZXJyb3JUcmlnZ2VyID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICBpZiAocGFyYW0uZXJyb3JIYW5kbGVyKVxuICAgICAgICAgICAgdGhpcy5lcnJvclRyaWdnZXIuYWRkKHBhcmFtLmVycm9ySGFuZGxlciwgcGFyYW0uZXJyb3JIYW5kbGVyT3duZXIpO1xuICAgICAgICB0aGlzLl9hbWZsb3cgPSBwYXJhbS5hbWZsb3c7XG4gICAgICAgIHRoaXMuX2tleXNGb3JKb2luID0gbnVsbDtcbiAgICAgICAgdGhpcy5fcmVxdWVzdGVkID0gW107XG4gICAgfVxuICAgIEpvaW5SZXNvbHZlci5wcm90b3R5cGUucmVxdWVzdCA9IGZ1bmN0aW9uIChwZXYpIHtcbiAgICAgICAgdGhpcy5fcmVxdWVzdGVkLnB1c2gobmV3IEpvaW5MZWF2ZVJlcXVlc3QocGV2LCB0aGlzLCB0aGlzLl9hbWZsb3csIHRoaXMuX2tleXNGb3JKb2luKSk7XG4gICAgfTtcbiAgICBKb2luUmVzb2x2ZXIucHJvdG90eXBlLnJlYWRSZXNvbHZlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGxlbiA9IHRoaXMuX3JlcXVlc3RlZC5sZW5ndGg7XG4gICAgICAgIGlmIChsZW4gPT09IDAgfHwgIXRoaXMuX3JlcXVlc3RlZFswXS5yZXNvbHZlZClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB2YXIgcmV0ID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpIHtcbiAgICAgICAgICAgIHZhciByZXEgPSB0aGlzLl9yZXF1ZXN0ZWRbaV07XG4gICAgICAgICAgICBpZiAoIXJlcS5yZXNvbHZlZClcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIHJldC5wdXNoKHJlcS5wZXYpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3JlcXVlc3RlZC5zcGxpY2UoMCwgaSk7XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfTtcbiAgICBKb2luUmVzb2x2ZXIucHJvdG90eXBlLnNldFJlcXVlc3RWYWx1ZXNGb3JKb2luID0gZnVuY3Rpb24gKGtleXMpIHtcbiAgICAgICAgdGhpcy5fa2V5c0ZvckpvaW4gPSBrZXlzO1xuICAgIH07XG4gICAgcmV0dXJuIEpvaW5SZXNvbHZlcjtcbn0oKSk7XG5leHBvcnRzLkpvaW5SZXNvbHZlciA9IEpvaW5SZXNvbHZlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuLyoqXG4gKiBgR2FtZUxvb3BgIOOBruODq+ODvOODl+WItuW+oeOBruODouODvOODieOAglxuICogYEdhbWVMb29wYCDjga/jgIHjgZPjga7lgKTjgavlv5zjgZjjgaYgYGcuR2FtZSN0aWNrKClgIOOBruWRvOOBs+WHuuOBl+aWueazleOCkuWkieOBiOOCi+OAglxuICovXG52YXIgTG9vcE1vZGU7XG4oZnVuY3Rpb24gKExvb3BNb2RlKSB7XG4gICAgLyoqXG4gICAgICog5pyA5paw44OV44Os44O844Og44Gr5pyA5aSn6ZmQ6L+944GE44Gk44GP44Oi44O844OJ44CCXG4gICAgICpcbiAgICAgKiBQYXNzaXZl44Gn44GC44KL5aC05ZCI44CB6Ieq5YiG44Gu54++5Zyo44OV44Os44O844Og44GM5Y+W5b6X5riI44G/44Gu5pyA5paw44OV44Os44O844Og44GL44KJ5aSn44GN44GP6YGF44KM44Gm44GE44KL44Gq44KJ44CBXG4gICAgICog5pep6YCB44KK44KE44K544OK44OD44OX44K344On44OD44OI44Gr44KI44KL44K444Oj44Oz44OX44KS6KGM44GG44CCXG4gICAgICpcbiAgICAgKiDjg63jg7zjgqvjg6vjg4bjgqPjg4Pjgq/oo5zplpPjgrfjg7zjg7PjgavjgYrjgYTjgabjga/jgIHjg4bjgqPjg4Pjgq/jga7lj5fkv6HjgpLlvoXjgaPjgabjgYTjgovplpPjg4bjgqPjg4Pjgq/oo5zplpPjgpLooYzjgYbjgILjgZnjgarjgo/jgaE6XG4gICAgICogICog5qyh44OG44Kj44OD44Kv44GM44GC44KL5aC05ZCIOiDjg63jg7zjgqvjg6vjg4bjgqPjg4Pjgq/jgpLnlJ/miJDjgZvjgZrjgIHjgZ/jgaDjgaHjgavmrKHjg4bjgqPjg4Pjgq/jgpLmtojljJbjgZnjgoso6KOc6ZaT44GX44Gq44GEKVxuICAgICAqICAqIOasoeODhuOCo+ODg+OCr+OBjOOBquOBhOWgtOWQiDog44Ot44O844Kr44Or44OG44Kj44OD44Kv44KS55Sf5oiQ44GX44Gm5raI5YyW44GZ44KLKOijnOmWk+OBmeOCiylcbiAgICAgKi9cbiAgICBMb29wTW9kZVtMb29wTW9kZVtcIlJlYWx0aW1lXCJdID0gMF0gPSBcIlJlYWx0aW1lXCI7XG4gICAgLyoqXG4gICAgICog6L+944GE44Gk44GT44GG44Go44GZ44KL44OV44Os44O844Og44KS6Ieq5YiG44Gn5Yi25b6h44GZ44KL44Oi44O844OJ44CCXG4gICAgICpcbiAgICAgKiBgUmVhbHRpbWVgIOOBqOWQjOanmOaXqemAgeOCiuOChOOCueODiuODg+ODl+OCt+ODp+ODg+ODiOOBq+OCiOOCi+OCuOODo+ODs+ODl+OCkuihjOOBhuOBjOOAgVxuICAgICAqIOOBneOBruWfuua6luODleODrOODvOODoOOBqOOBl+OBpiBgTG9vcENvbmZpZ3VyYXRpb24jdGFyZ2V0QWdlYCAo44KS5L+d5oyB44GZ44KLIGBHYW1lTG9vcCNfdGFyZ2V0QWdlYCkg44KS5L2/44GG44CCXG4gICAgICog5pep6YCB44KK44KE44K544OK44OD44OX44K344On44OD44OI44Gr44KI44KL44K444Oj44Oz44OX44KS6KGM44GG44CCXG4gICAgICpcbiAgICAgKiDjg63jg7zjgqvjg6vjg4bjgqPjg4Pjgq/oo5zplpPjgrfjg7zjg7PjgavjgYrjgYTjgabjga/jgIHjg4bjgqPjg4Pjgq/jga7jgr/jgqTjg6Djgrnjgr/jg7Pjg5fmg4XloLHjgavjgafjgY3jgovjgaDjgZHlv6Dlrp/jgavjg4bjgqPjg4Pjgq/oo5zplpPjgpLooYzjgYbjgILjgZnjgarjgo/jgaE6XG4gICAgICogICog5qyh44OG44Kj44OD44Kv44GM44GC44KL5aC05ZCIOiDnj77lnKjmmYLliLvjgYzmrKHjg4bjgqPjg4Pjgq/jga7jgr/jgqTjg6Djgrnjgr/jg7Pjg5fjgYvnm67mqJnmmYLliLvjgavoh7Pjgovjgb7jgafjgIHjg63jg7zjgqvjg6vjg4bjgqPjg4Pjgq/jgpLnlJ/miJDjgZfjgabmtojljJbjgZnjgoso6KOc6ZaT44GZ44KLKeOAglxuICAgICAqICAqIOasoeODhuOCo+ODg+OCr+OBjOOBquOBhOWgtOWQiDog5L2V44KC44GX44Gq44GEKOijnOmWk+OBl+OBquOBhCnjgIJcbiAgICAgKiDjgZ/jgaDjgZcgTG9vcENvbmZpZ3VyYXRpb24jb21pdEludGVycG9sYXRlZFRpY2tPblJlcGxheSDjgYznnJ/jga7loLTlkIjjga/jgIHmrKHjga7opo/liYfjgYzov73liqDjgafpgannlKjjgZXjgozjgovjgIJcbiAgICAgKiAgKiDmrKHjg4bjgqPjg4Pjgq/jgYzjgYLjgovloLTlkIjjgIHjgrnjgq3jg4Pjg5fkuK3jgarjgonjgbA6IOODreODvOOCq+ODq+ODhuOCo+ODg+OCr+OCkueUn+aIkOOBm+OBmuOAgeOBn+OBoOOBoeOBq+asoeODhuOCo+ODg+OCr+OCkua2iOWMluOBmeOCiyjoo5zplpPjgZfjgarjgYQ7IFJlYWx0aW1l44Go5ZCM44GY44Gr44Gq44KLKVxuICAgICAqICAqIOasoeODhuOCo+ODg+OCr+OBjOOBquOBhOWgtOWQiOOAgeebruaomeaZguWIu+OBq+WIsOmBlOOBl+OBpuOBhOOBquOBkeOCjOOBsDog44Ot44O844Kr44Or44OG44Kj44OD44Kv44KS55Sf5oiQ44GX44Gm5raI5YyW44GZ44KLKOijnOmWk+OBmeOCizsgUmVhbHRpbWXjgajlkIzjgZjjgavjgarjgospXG4gICAgICovXG4gICAgTG9vcE1vZGVbTG9vcE1vZGVbXCJSZXBsYXlcIl0gPSAxXSA9IFwiUmVwbGF5XCI7XG4gICAgLyoqXG4gICAgICog5q2j44GX44GP5L2/44Gj44Gm44GE44Gq44GE44CC5YmK6Zmk44GZ44KL5LqI5a6a44CCXG4gICAgICpcbiAgICAgKiDjgrPjg57pgIHjgorjg6Ljg7zjg4njgIJcbiAgICAgKiBgR2FtZUxvb3Ajc3RlcCgpYCDlkbzjgbPlh7rjgZfmmYLjgasx44OV44Os44O844Og6YCy44KA44CC44Gd44KM5Lul5aSW44Gu5pa55rOV44Gn44Gv6YCy44G+44Gq44GE44CCXG4gICAgICog5pep6YCB44KK44KE44K544OK44OD44OX44K344On44OD44OI44Gr44KI44KL44K444Oj44Oz44OX44Gv6KGM44KP44Gq44GE44CCXG4gICAgICovXG4gICAgTG9vcE1vZGVbTG9vcE1vZGVbXCJGcmFtZUJ5RnJhbWVcIl0gPSAyXSA9IFwiRnJhbWVCeUZyYW1lXCI7XG59KShMb29wTW9kZSB8fCAoTG9vcE1vZGUgPSB7fSkpO1xuZXhwb3J0cy5kZWZhdWx0ID0gTG9vcE1vZGU7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbi8qKlxuICogYEdhbWVMb29wYCDjgYzmj4/nlLvjgpLooYzjgYbln7rmupbjgIJcbiAqL1xudmFyIExvb3BSZW5kZXJNb2RlO1xuKGZ1bmN0aW9uIChMb29wUmVuZGVyTW9kZSkge1xuICAgIC8qKlxuICAgICAqIOavjnJhdyBmcmFtZeW+jOOBq+aPj+eUu+OBmeOCi+OAglxuICAgICAqIHJhdyBmcmFtZeOBruips+e0sOOBq+OBpOOBhOOBpuOBr0Nsb2NrLnRz44Gu44Kz44Oh44Oz44OI44KS5Y+C54Wn44CCXG4gICAgICovXG4gICAgTG9vcFJlbmRlck1vZGVbTG9vcFJlbmRlck1vZGVbXCJBZnRlclJhd0ZyYW1lXCJdID0gMF0gPSBcIkFmdGVyUmF3RnJhbWVcIjtcbiAgICAvKipcbiAgICAgKiDmj4/nlLvjgpLjgb7jgaPjgZ/jgY/ooYzjgo/jgarjgYTjgIJcbiAgICAgKi9cbiAgICBMb29wUmVuZGVyTW9kZVtMb29wUmVuZGVyTW9kZVtcIk5vbmVcIl0gPSAxXSA9IFwiTm9uZVwiO1xufSkoTG9vcFJlbmRlck1vZGUgfHwgKExvb3BSZW5kZXJNb2RlID0ge30pKTtcbmV4cG9ydHMuZGVmYXVsdCA9IExvb3BSZW5kZXJNb2RlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlBkaVV0aWwgPSB2b2lkIDA7XG52YXIgZXM2X3Byb21pc2VfMSA9IHJlcXVpcmUoXCJlczYtcHJvbWlzZVwiKTtcbnZhciBnID0gcmVxdWlyZShcIkBha2FzaGljL2FrYXNoaWMtZW5naW5lXCIpO1xudmFyIFBkaVV0aWw7XG4oZnVuY3Rpb24gKFBkaVV0aWwpIHtcbiAgICAvKipcbiAgICAgKiDkuI7jgYjjgonjgozjgZ8gYFBsYXRmb3JtYCDjga4gYGxvYWRHYW1lQ29uZmlndXJhdGlvbigpYCDjgpLjg6njg4Pjg5fjgZfjgZ/jgIFgR2FtZUNvbmZpZ3VyYXRpb25gIOiqreOBv+i+vOOBv+mWouaVsOOCkuS9nOaIkOOBl+OBpui/lOOBmeOAglxuICAgICAqXG4gICAgICog5oi744KK5YCk44Gu6Zai5pWw44Gv44CB5qyh44Gu54K544GnIGBQbGF0Zm9ybSNsb2FkR2FtZUNvbmZpZ3VyYXRpb24oKWAg44Go55Ww44Gq44KL44CCXG4gICAgICogKiBcImRlZmluaXRpb25zXCIg44OV44Kj44O844Or44OJ44KS6Kej5rG644GZ44KLICjlho3luLDnmoTjgavoqq3jgb/ovrzjgb/jgpLooYzjgYTjgIFfbWVyZ2VHYW1lQ29uZmlndXJhdGlvbigpIOOBp+OCq+OCueOCseODvOODieino+axuuOBmeOCiylcbiAgICAgKiAqIFwiYXNzZXRCYXNlXCIg44KS5L2/44Gj44GmIGBHYW1lQ29uZmlndXJhdGlvbmAg5YaF44Gu44Ki44K744OD44OI44Gu44OR44K544KS57W25a++44OR44K544Gr5aSJ5o+b44GZ44KLXG4gICAgICogKiBcImNvbmZpZ3VyYXRpb25CYXNlXCIg44KS5L2/44Gj44GmIFwiZGVmaW5pdGlvbnNcIiDjg5XjgqPjg7zjg6vjg4nlhoXjga7jg5HjgrnjgpLntbblr77jg5HjgrnjgavlpInmj5vjgZnjgotcbiAgICAgKlxuICAgICAqIEBwYXJhbSBwZiDjg6njg4Pjg5fjgZnjgosgYGxvYWRHYW1lQ29uZmlndXJhdGlvbigpYCDjgpLmjIHjgaQgYFBsYXRmb3JtYFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG1ha2VMb2FkQ29uZmlndXJhdGlvbkZ1bmMocGYpIHtcbiAgICAgICAgZnVuY3Rpb24gbG9hZFJlc29sdmVkQ29uZmlndXJhdGlvbih1cmwsIGFzc2V0QmFzZSwgY29uZmlndXJhdGlvbkJhc2UsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBwZi5sb2FkR2FtZUNvbmZpZ3VyYXRpb24odXJsLCBmdW5jdGlvbiAoZXJyLCBjb25mKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIsIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmYgPSBQZGlVdGlsLl9yZXNvbHZlQ29uZmlndXJhdGlvbkJhc2VQYXRoKGNvbmYsICgoYXNzZXRCYXNlICE9IG51bGwpID8gYXNzZXRCYXNlIDogZy5QYXRoVXRpbC5yZXNvbHZlRGlybmFtZSh1cmwpKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGUsIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghY29uZi5kZWZpbml0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBjb25mKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgZGVmcyA9IGNvbmYuZGVmaW5pdGlvbnMubWFwKGZ1bmN0aW9uIChkZWYpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkZWYgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNvbHZlZFVybCA9IGNvbmZpZ3VyYXRpb25CYXNlICE9IG51bGwgPyBnLlBhdGhVdGlsLnJlc29sdmVQYXRoKGNvbmZpZ3VyYXRpb25CYXNlLCBkZWYpIDogZGVmO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2lmaWVkTG9hZChyZXNvbHZlZFVybCwgdW5kZWZpbmVkLCBjb25maWd1cmF0aW9uQmFzZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzb2x2ZWRVcmwgPSBjb25maWd1cmF0aW9uQmFzZSAhPSBudWxsID8gZy5QYXRoVXRpbC5yZXNvbHZlUGF0aChjb25maWd1cmF0aW9uQmFzZSwgZGVmLnVybCkgOiBkZWYudXJsO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2lmaWVkTG9hZChyZXNvbHZlZFVybCwgZGVmLmJhc2VQYXRoLCBjb25maWd1cmF0aW9uQmFzZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBlczZfcHJvbWlzZV8xLlByb21pc2UuYWxsKGRlZnMpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChjb25mcykgeyByZXR1cm4gY2FsbGJhY2sobnVsbCwgY29uZnMucmVkdWNlKFBkaVV0aWwuX21lcmdlR2FtZUNvbmZpZ3VyYXRpb24pKTsgfSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBjYWxsYmFjayhlLCBudWxsKTsgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBwcm9taXNpZmllZExvYWQodXJsLCBhc3NldEJhc2UsIGNvbmZpZ3VyYXRpb25CYXNlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IGVzNl9wcm9taXNlXzEuUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgbG9hZFJlc29sdmVkQ29uZmlndXJhdGlvbih1cmwsIGFzc2V0QmFzZSwgY29uZmlndXJhdGlvbkJhc2UsIGZ1bmN0aW9uIChlcnIsIGNvbmYpIHtcbiAgICAgICAgICAgICAgICAgICAgZXJyID8gcmVqZWN0KGVycikgOiByZXNvbHZlKGNvbmYpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGxvYWRSZXNvbHZlZENvbmZpZ3VyYXRpb247XG4gICAgfVxuICAgIFBkaVV0aWwubWFrZUxvYWRDb25maWd1cmF0aW9uRnVuYyA9IG1ha2VMb2FkQ29uZmlndXJhdGlvbkZ1bmM7XG4gICAgLyoqXG4gICAgICog5LiO44GI44KJ44KM44GfIGBHYW1lQ29uZmlndXJhdGlvbmAg44Gu44OR44K5KOebuOWvvuODkeOCueOBq+OBquOBo+OBpuOBhOOCiynjgpLntbblr77jg5HjgrnjgavlpInjgYjjgovjgIJcbiAgICAgKiBAcGFyYW0gY29uZmlndXJhdGlvbiDlr77osaHjga4gYEdhbWVDb25maWd1cmF0aW9uYFxuICAgICAqIEBwYXJhbSBhc3NldEJhc2Ug44Ki44K744OD44OI44Gu55u45a++44OR44K544Gu5Z+65rqW44Go44Gq44KL44OR44K5XG4gICAgICovXG4gICAgZnVuY3Rpb24gX3Jlc29sdmVDb25maWd1cmF0aW9uQmFzZVBhdGgoY29uZmlndXJhdGlvbiwgYXNzZXRCYXNlKSB7XG4gICAgICAgIGZ1bmN0aW9uIHJlc29sdmVQYXRoKGJhc2UsIHBhdGgpIHtcbiAgICAgICAgICAgIHZhciByZXQgPSBnLlBhdGhVdGlsLnJlc29sdmVQYXRoKGJhc2UsIHBhdGgpO1xuICAgICAgICAgICAgaWYgKHJldC5pbmRleE9mKGJhc2UpICE9PSAwKVxuICAgICAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIlBkaVV0aWwuX3Jlc29sdmVDb25maWd1cmF0aW9uQmFzZVBhdGg6IGludmFsaWQgcGF0aDogXCIgKyBwYXRoKTtcbiAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGFzc2V0cyA9IGNvbmZpZ3VyYXRpb24uYXNzZXRzO1xuICAgICAgICBpZiAoYXNzZXRzIGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIGFzc2V0cykge1xuICAgICAgICAgICAgICAgIGlmICghYXNzZXRzLmhhc093blByb3BlcnR5KHApKVxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBpZiAoXCJwYXRoXCIgaW4gYXNzZXRzW3BdKSB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0c1twXS52aXJ0dWFsUGF0aCA9IGFzc2V0c1twXS52aXJ0dWFsUGF0aCB8fCBhc3NldHNbcF0ucGF0aDtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXRzW3BdLnBhdGggPSByZXNvbHZlUGF0aChhc3NldEJhc2UsIGFzc2V0c1twXS5wYXRoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb24uZ2xvYmFsU2NyaXB0cykge1xuICAgICAgICAgICAgY29uZmlndXJhdGlvbi5nbG9iYWxTY3JpcHRzLmZvckVhY2goZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXNzZXRzLmhhc093blByb3BlcnR5KHBhdGgpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJQZGlVdGlsLl9yZXNvbHZlQ29uZmlndXJhdGlvbkJhc2VQYXRoOiBhc3NldCBJRCBhbHJlYWR5IGV4aXN0czogXCIgKyBwYXRoKTtcbiAgICAgICAgICAgICAgICBhc3NldHNbcGF0aF0gPSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IC9cXC5qc29uJC9pLnRlc3QocGF0aCkgPyBcInRleHRcIiA6IFwic2NyaXB0XCIsXG4gICAgICAgICAgICAgICAgICAgIHZpcnR1YWxQYXRoOiBwYXRoLFxuICAgICAgICAgICAgICAgICAgICBwYXRoOiByZXNvbHZlUGF0aChhc3NldEJhc2UsIHBhdGgpLFxuICAgICAgICAgICAgICAgICAgICBnbG9iYWw6IHRydWVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkZWxldGUgY29uZmlndXJhdGlvbi5nbG9iYWxTY3JpcHRzO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb25maWd1cmF0aW9uO1xuICAgIH1cbiAgICBQZGlVdGlsLl9yZXNvbHZlQ29uZmlndXJhdGlvbkJhc2VQYXRoID0gX3Jlc29sdmVDb25maWd1cmF0aW9uQmFzZVBhdGg7XG4gICAgLyoqXG4gICAgICog5LiO44GI44KJ44KM44Gf44Kq44OW44K444Kn44Kv44OI5LqM44Gk44KS44CM44Oe44O844K444CN44GZ44KL44CCXG4gICAgICog44GT44GT44Gn44Oe44O844K444Go44Gv44CB44Kq44OW44K444Kn44Kv44OI44Gu44OV44Kj44O844Or44OJ44KS44Kk44OG44Os44O844OI44GX44CBXG4gICAgICog44OX44Oq44Of44OG44Kj44OW5YCk44Gn44GC44KM44Gw5LiK5pu444GN44CB6YWN5YiX44Gn44GC44KM44GwY29uY2F044CB44Kq44OW44K444Kn44Kv44OI44Gn44GC44KM44Gw5YaN5biw55qE44Gr44Oe44O844K444GZ44KL5Yem55CG44Gn44GC44KL44CCXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGFyZ2V0IOODnuODvOOCuOOBleOCjOOCi+OCquODluOCuOOCp+OCr+ODiOOAguOBk+OBruWApOOBr+egtOWjiuOBleOCjOOCi1xuICAgICAqIEBwYXJhbSBzb3VyY2Ug44Oe44O844K444GZ44KL44Kq44OW44K444Kn44Kv44OIXG4gICAgICovXG4gICAgZnVuY3Rpb24gX21lcmdlT2JqZWN0KHRhcmdldCwgc291cmNlKSB7XG4gICAgICAgIHZhciBrcyA9IE9iamVjdC5rZXlzKHNvdXJjZSk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBrcy5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgICAgICAgICAgdmFyIGsgPSBrc1tpXTtcbiAgICAgICAgICAgIHZhciBzb3VyY2VWYWwgPSBzb3VyY2Vba107XG4gICAgICAgICAgICB2YXIgc291cmNlVmFsVHlwZSA9IHR5cGVvZiBzb3VyY2VWYWw7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0VmFsVHlwZSA9IHR5cGVvZiB0YXJnZXRba107XG4gICAgICAgICAgICBpZiAoc291cmNlVmFsVHlwZSAhPT0gdGFyZ2V0VmFsVHlwZSkge1xuICAgICAgICAgICAgICAgIHRhcmdldFtrXSA9IHNvdXJjZVZhbDtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIHNvdXJjZVZhbCkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzdHJpbmdcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2tdID0gc291cmNlVmFsO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwib2JqZWN0XCI6XG4gICAgICAgICAgICAgICAgICAgIGlmIChzb3VyY2VWYWwgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2tdID0gc291cmNlVmFsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoc291cmNlVmFsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2tdID0gdGFyZ2V0W2tdLmNvbmNhdChzb3VyY2VWYWwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgUGRpVXRpbC5fbWVyZ2VPYmplY3QodGFyZ2V0W2tdLCBzb3VyY2VWYWwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlBkaVV0aWwuX21lcmdlT2JqZWN0KCk6IHVua25vd24gdHlwZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgIH1cbiAgICBQZGlVdGlsLl9tZXJnZU9iamVjdCA9IF9tZXJnZU9iamVjdDtcbiAgICBmdW5jdGlvbiBfbWVyZ2VHYW1lQ29uZmlndXJhdGlvbih0YXJnZXQsIHNvdXJjZSkge1xuICAgICAgICByZXR1cm4gUGRpVXRpbC5fbWVyZ2VPYmplY3QodGFyZ2V0LCBzb3VyY2UpO1xuICAgIH1cbiAgICBQZGlVdGlsLl9tZXJnZUdhbWVDb25maWd1cmF0aW9uID0gX21lcmdlR2FtZUNvbmZpZ3VyYXRpb247XG59KShQZGlVdGlsID0gZXhwb3J0cy5QZGlVdGlsIHx8IChleHBvcnRzLlBkaVV0aWwgPSB7fSkpO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlBvaW50RXZlbnRSZXNvbHZlciA9IHZvaWQgMDtcbi8qKlxuICogcGRpLlBvaW50RXZlbnTjgYvjgolnLkV2ZW5044G444Gu5aSJ5o+b5qmf5qeL44CCXG4gKlxuICog44G744G85bqn5qiZ44GX44GL5oyB44Gf44Gq44GEcGRpLlBvaW50RXZlbnTjgavlr77jgZfjgabjgIFnLlBvaW50KERvd258TW92ZXxVcClFdmVudOOBr+OBneOBruW6p+aomeOBq+OBguOCi+OCqOODs+ODhuOCo+ODhuOCo+OChOOAgVxuICogKGcuUG9pbnQoTW92ZXxVcClFdmVudOOBruWgtOWQiClnLlBvaW50RG93bkV2ZW5044GL44KJ44Gu5bqn5qiZ44Gu5beu5YiG44KS5oyB44Gj44Gm44GE44KL44CCXG4gKiDjgZ3jgozjgonjga7otrPjgorjgarjgYTmg4XloLHjgpLnrqHnkIbjg7vov73liqDjgZfjgabjgIFwZGkuUG9pbnRFdmVudOOCkmcuRXZlbnTjgavlpInmj5vjgZnjgovjgq/jg6njgrnjgIJcbiAqIFBESeWun+ijheOBr3BvaW50RG93bigp44Gq44GX44GncG9pbnRNb3ZlKCnjgpLlkbzjgbPlh7rjgZfjgabjgY/jgovjgZPjgajjgoLogIPjgYjjgonjgozjgovjgZ/jgoHjgIFcbiAqIERvd24gLT4gTW92ZSAtPiBVcCDjga7mtYHjgozjgpLkv53oqLzjgZnjgovmqZ/og73jgoLmjIHjgaTjgIJcbiAqL1xudmFyIFBvaW50RXZlbnRSZXNvbHZlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBQb2ludEV2ZW50UmVzb2x2ZXIocGFyYW0pIHtcbiAgICAgICAgdGhpcy5fZ2FtZSA9IHBhcmFtLmdhbWU7XG4gICAgICAgIHRoaXMuX3BvaW50RXZlbnRNYXAgPSB7fTtcbiAgICB9XG4gICAgUG9pbnRFdmVudFJlc29sdmVyLnByb3RvdHlwZS5wb2ludERvd24gPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5fZ2FtZS5wbGF5ZXI7XG4gICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLl9nYW1lLmZpbmRQb2ludFNvdXJjZShlLm9mZnNldCk7XG4gICAgICAgIHZhciBwb2ludCA9IHNvdXJjZS5wb2ludCA/IHNvdXJjZS5wb2ludCA6IGUub2Zmc2V0O1xuICAgICAgICB2YXIgdGFyZ2V0SWQgPSBzb3VyY2UudGFyZ2V0ID8gc291cmNlLnRhcmdldC5pZCA6IG51bGw7XG4gICAgICAgIHRoaXMuX3BvaW50RXZlbnRNYXBbZS5pZGVudGlmaWVyXSA9IHtcbiAgICAgICAgICAgIHRhcmdldElkOiB0YXJnZXRJZCxcbiAgICAgICAgICAgIGxvY2FsOiBzb3VyY2UubG9jYWwsXG4gICAgICAgICAgICBwb2ludDogcG9pbnQsXG4gICAgICAgICAgICBzdGFydDogeyB4OiBlLm9mZnNldC54LCB5OiBlLm9mZnNldC55IH0sXG4gICAgICAgICAgICBwcmV2OiB7IHg6IGUub2Zmc2V0LngsIHk6IGUub2Zmc2V0LnkgfVxuICAgICAgICB9O1xuICAgICAgICAvLyBOT1RFOiDlhKrlhYjluqbjga/mqZ/morDnmoTjgatKb2luZWTjgpLjgaTjgZHjgabjgYrjgY/jgIJKb2lu44GX44Gm44GE44Gq44GE6ZmQ44KKUG9pbnREb3duRXZlbnTjgarjganjga/jg6rjgrjjgqfjgq/jg4jjgZXjgozjgovjgIJcbiAgICAgICAgdmFyIHJldCA9IFtcbiAgICAgICAgICAgIDMzIC8qIFBvaW50RG93biAqLyxcbiAgICAgICAgICAgIDIgLyogSm9pbmVkICovLFxuICAgICAgICAgICAgcGxheWVyLmlkLFxuICAgICAgICAgICAgZS5pZGVudGlmaWVyLFxuICAgICAgICAgICAgcG9pbnQueCxcbiAgICAgICAgICAgIHBvaW50LnksXG4gICAgICAgICAgICB0YXJnZXRJZCAvLyA2Pzog44Ko44Oz44OG44Kj44OG44KjSURcbiAgICAgICAgXTtcbiAgICAgICAgaWYgKHNvdXJjZS5sb2NhbClcbiAgICAgICAgICAgIHJldC5wdXNoKHNvdXJjZS5sb2NhbCk7IC8vIDc/OiDjg63jg7zjgqvjg6tcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9O1xuICAgIFBvaW50RXZlbnRSZXNvbHZlci5wcm90b3R5cGUucG9pbnRNb3ZlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIHBsYXllciA9IHRoaXMuX2dhbWUucGxheWVyO1xuICAgICAgICB2YXIgaG9sZGVyID0gdGhpcy5fcG9pbnRFdmVudE1hcFtlLmlkZW50aWZpZXJdO1xuICAgICAgICBpZiAoIWhvbGRlcilcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB2YXIgcHJldiA9IHsgeDogMCwgeTogMCB9O1xuICAgICAgICB2YXIgc3RhcnQgPSB7IHg6IDAsIHk6IDAgfTtcbiAgICAgICAgdGhpcy5fcG9pbnRNb3ZlQW5kVXAoaG9sZGVyLCBlLm9mZnNldCwgcHJldiwgc3RhcnQpO1xuICAgICAgICB2YXIgcmV0ID0gW1xuICAgICAgICAgICAgMzQgLyogUG9pbnRNb3ZlICovLFxuICAgICAgICAgICAgMiAvKiBKb2luZWQgKi8sXG4gICAgICAgICAgICBwbGF5ZXIuaWQsXG4gICAgICAgICAgICBlLmlkZW50aWZpZXIsXG4gICAgICAgICAgICBob2xkZXIucG9pbnQueCxcbiAgICAgICAgICAgIGhvbGRlci5wb2ludC55LFxuICAgICAgICAgICAgc3RhcnQueCxcbiAgICAgICAgICAgIHN0YXJ0LnksXG4gICAgICAgICAgICBwcmV2LngsXG4gICAgICAgICAgICBwcmV2LnksXG4gICAgICAgICAgICBob2xkZXIudGFyZ2V0SWQgLy8gMTA/OiDjgqjjg7Pjg4bjgqPjg4bjgqNJRFxuICAgICAgICBdO1xuICAgICAgICBpZiAoaG9sZGVyLmxvY2FsKVxuICAgICAgICAgICAgcmV0LnB1c2goaG9sZGVyLmxvY2FsKTsgLy8gMTE/OiDjg63jg7zjgqvjg6tcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9O1xuICAgIFBvaW50RXZlbnRSZXNvbHZlci5wcm90b3R5cGUucG9pbnRVcCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLl9nYW1lLnBsYXllcjtcbiAgICAgICAgdmFyIGhvbGRlciA9IHRoaXMuX3BvaW50RXZlbnRNYXBbZS5pZGVudGlmaWVyXTtcbiAgICAgICAgaWYgKCFob2xkZXIpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgdmFyIHByZXYgPSB7IHg6IDAsIHk6IDAgfTtcbiAgICAgICAgdmFyIHN0YXJ0ID0geyB4OiAwLCB5OiAwIH07XG4gICAgICAgIHRoaXMuX3BvaW50TW92ZUFuZFVwKGhvbGRlciwgZS5vZmZzZXQsIHByZXYsIHN0YXJ0KTtcbiAgICAgICAgZGVsZXRlIHRoaXMuX3BvaW50RXZlbnRNYXBbZS5pZGVudGlmaWVyXTtcbiAgICAgICAgdmFyIHJldCA9IFtcbiAgICAgICAgICAgIDM1IC8qIFBvaW50VXAgKi8sXG4gICAgICAgICAgICAyIC8qIEpvaW5lZCAqLyxcbiAgICAgICAgICAgIHBsYXllci5pZCxcbiAgICAgICAgICAgIGUuaWRlbnRpZmllcixcbiAgICAgICAgICAgIGhvbGRlci5wb2ludC54LFxuICAgICAgICAgICAgaG9sZGVyLnBvaW50LnksXG4gICAgICAgICAgICBzdGFydC54LFxuICAgICAgICAgICAgc3RhcnQueSxcbiAgICAgICAgICAgIHByZXYueCxcbiAgICAgICAgICAgIHByZXYueSxcbiAgICAgICAgICAgIGhvbGRlci50YXJnZXRJZCAvLyAxMD86IOOCqOODs+ODhuOCo+ODhuOCo0lEXG4gICAgICAgIF07XG4gICAgICAgIGlmIChob2xkZXIubG9jYWwpXG4gICAgICAgICAgICByZXQucHVzaChob2xkZXIubG9jYWwpOyAvLyAxMT86IOODreODvOOCq+ODq1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH07XG4gICAgUG9pbnRFdmVudFJlc29sdmVyLnByb3RvdHlwZS5fcG9pbnRNb3ZlQW5kVXAgPSBmdW5jdGlvbiAoaG9sZGVyLCBvZmZzZXQsIHByZXZEZWx0YSwgc3RhcnREZWx0YSkge1xuICAgICAgICBzdGFydERlbHRhLnggPSBvZmZzZXQueCAtIGhvbGRlci5zdGFydC54O1xuICAgICAgICBzdGFydERlbHRhLnkgPSBvZmZzZXQueSAtIGhvbGRlci5zdGFydC55O1xuICAgICAgICBwcmV2RGVsdGEueCA9IG9mZnNldC54IC0gaG9sZGVyLnByZXYueDtcbiAgICAgICAgcHJldkRlbHRhLnkgPSBvZmZzZXQueSAtIGhvbGRlci5wcmV2Lnk7XG4gICAgICAgIGhvbGRlci5wcmV2LnggPSBvZmZzZXQueDtcbiAgICAgICAgaG9sZGVyLnByZXYueSA9IG9mZnNldC55O1xuICAgIH07XG4gICAgcmV0dXJuIFBvaW50RXZlbnRSZXNvbHZlcjtcbn0oKSk7XG5leHBvcnRzLlBvaW50RXZlbnRSZXNvbHZlciA9IFBvaW50RXZlbnRSZXNvbHZlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlByb2ZpbGVyQ2xvY2sgPSB2b2lkIDA7XG52YXIgQ2xvY2tfMSA9IHJlcXVpcmUoXCIuL0Nsb2NrXCIpO1xuLyoqXG4gKiDjg5fjg63jg5XjgqHjgqTjg6njg7zjgpLmnInjgZnjgovjgq/jg63jg4Pjgq/jgIJcbiAqXG4gKiBub3RlOiBfb25Mb29wZXJDYWxsKCnjga7jgb/jgpLjgqrjg7zjg5Djg7zjg6njgqTjg4njgZfjgIEgYHRoaXMuX3Byb2ZpbGVyLn5+YCDjgpLov73liqDjgZfjgZ/jgaDjgZHjgajjgarjgaPjgabjgYTjgb7jgZnjgIJcbiAqL1xudmFyIFByb2ZpbGVyQ2xvY2sgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFByb2ZpbGVyQ2xvY2ssIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gUHJvZmlsZXJDbG9jayhwYXJhbSkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwYXJhbSkgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX3Byb2ZpbGVyID0gcGFyYW0ucHJvZmlsZXI7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgUHJvZmlsZXJDbG9jay5wcm90b3R5cGUuX29uTG9vcGVyQ2FsbCA9IGZ1bmN0aW9uIChkZWx0YVRpbWUpIHtcbiAgICAgICAgdmFyIHJhd0RlbHRhVGltZSA9IGRlbHRhVGltZTtcbiAgICAgICAgaWYgKGRlbHRhVGltZSA8PSAwKSB7XG4gICAgICAgICAgICAvLyDmmYLplpPjgYzmraLjgb7jgaPjgabjgYTjgovjgYvlt7vjgY3miLvjgaPjgabjgYTjgovjgILliJ3lm57lkbzjgbPlh7rjgZfjgYvjgIHjgYLjgovjgYTjga/kvZXjgYvjgYzjgYrjgYvjgZfjgYTjgILmmYLplpPntYzpgY4w44Go6KaL44Gq44GZ44CCXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fd2FpdFRpbWUgLSB0aGlzLl90b3RhbERlbHRhVGltZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGVsdGFUaW1lID4gdGhpcy5fZGVsdGFUaW1lQnJva2VuVGhyZXNob2xkKSB7XG4gICAgICAgICAgICAvLyDplpPpmpTjgYzplbfjgZnjgY7jgovjgILkvZXjgYvjgYzjgYrjgYvjgZfjgYTjgILmmYLplpPntYzpgY7jgpIx44OV44Os44O844Og5YiG44Go44G/44Gq44GZ44CCXG4gICAgICAgICAgICBkZWx0YVRpbWUgPSB0aGlzLl93YWl0VGltZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdG90YWxEZWx0YVRpbWUgPSB0aGlzLl90b3RhbERlbHRhVGltZTtcbiAgICAgICAgdG90YWxEZWx0YVRpbWUgKz0gZGVsdGFUaW1lO1xuICAgICAgICBpZiAodG90YWxEZWx0YVRpbWUgPD0gdGhpcy5fc2tpcEZyYW1lV2FpdFRpbWUpIHtcbiAgICAgICAgICAgIC8vIDHjg5Xjg6zjg7zjg6DliIbmtojljJbjgZnjgovjgbvjganjga7mmYLplpPjgYzntYzjgaPjgabjgYTjgarjgYTjgIJcbiAgICAgICAgICAgIHRoaXMuX3RvdGFsRGVsdGFUaW1lID0gdG90YWxEZWx0YVRpbWU7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fd2FpdFRpbWUgLSB0b3RhbERlbHRhVGltZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9wcm9maWxlci50aW1lRW5kKDEgLyogUmF3RnJhbWVJbnRlcnZhbCAqLyk7XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVyLnRpbWUoMSAvKiBSYXdGcmFtZUludGVydmFsICovKTtcbiAgICAgICAgdmFyIGZyYW1lQ291bnQgPSAodG90YWxEZWx0YVRpbWUgPCB0aGlzLl93YWl0VGltZURvdWJsZWQpID8gMVxuICAgICAgICAgICAgOiAodG90YWxEZWx0YVRpbWUgPiB0aGlzLl93YWl0VGltZU1heCkgPyB0aGlzLl9yZWFsTWF4RnJhbWVQZXJPbmNlXG4gICAgICAgICAgICAgICAgOiAodG90YWxEZWx0YVRpbWUgLyB0aGlzLl93YWl0VGltZSkgfCAwO1xuICAgICAgICB2YXIgZmMgPSBmcmFtZUNvdW50O1xuICAgICAgICB2YXIgYXJnID0ge1xuICAgICAgICAgICAgZGVsdGFUaW1lOiByYXdEZWx0YVRpbWUsXG4gICAgICAgICAgICBpbnRlcnJ1cHQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVyLnNldFZhbHVlKDAgLyogU2tpcHBlZEZyYW1lQ291bnQgKi8sIGZjIC0gMSk7XG4gICAgICAgIHdoaWxlIChmYyA+IDAgJiYgdGhpcy5ydW5uaW5nICYmICFhcmcuaW50ZXJydXB0KSB7XG4gICAgICAgICAgICAtLWZjO1xuICAgICAgICAgICAgdGhpcy5fcHJvZmlsZXIudGltZSgyIC8qIEZyYW1lVGltZSAqLyk7XG4gICAgICAgICAgICB0aGlzLmZyYW1lVHJpZ2dlci5maXJlKGFyZyk7XG4gICAgICAgICAgICB0aGlzLl9wcm9maWxlci50aW1lRW5kKDIgLyogRnJhbWVUaW1lICovKTtcbiAgICAgICAgICAgIGFyZy5kZWx0YVRpbWUgPSAwOyAvLyDlkIzjg6vjg7zjg5fjgavjgojjgosy5bqm55uu5Lul6ZmN44Gu5ZG844Gz5Ye644GX44Gv5beu5YiG44KSMOOBqOOBv+OBquOBmeOAglxuICAgICAgICB9XG4gICAgICAgIHRvdGFsRGVsdGFUaW1lIC09ICgoZnJhbWVDb3VudCAtIGZjKSAqIHRoaXMuX3dhaXRUaW1lKTtcbiAgICAgICAgdGhpcy5fcHJvZmlsZXIudGltZSgzIC8qIFJlbmRlcmluZ1RpbWUgKi8pO1xuICAgICAgICB0aGlzLnJhd0ZyYW1lVHJpZ2dlci5maXJlKCk7XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVyLnRpbWVFbmQoMyAvKiBSZW5kZXJpbmdUaW1lICovKTtcbiAgICAgICAgdGhpcy5fdG90YWxEZWx0YVRpbWUgPSB0b3RhbERlbHRhVGltZTtcbiAgICAgICAgdGhpcy5fcHJvZmlsZXIuZmx1c2goKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3dhaXRUaW1lIC0gdG90YWxEZWx0YVRpbWU7XG4gICAgfTtcbiAgICByZXR1cm4gUHJvZmlsZXJDbG9jaztcbn0oQ2xvY2tfMS5DbG9jaykpO1xuZXhwb3J0cy5Qcm9maWxlckNsb2NrID0gUHJvZmlsZXJDbG9jaztcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5TdG9yYWdlUmVzb2x2ZXIgPSB2b2lkIDA7XG52YXIgZyA9IHJlcXVpcmUoXCJAYWthc2hpYy9ha2FzaGljLWVuZ2luZVwiKTtcbnZhciBFeGVjdXRpb25Nb2RlXzEgPSByZXF1aXJlKFwiLi9FeGVjdXRpb25Nb2RlXCIpO1xuLyoqXG4gKiDjgrnjg4jjg6zjg7zjgrjjga7oqq3jgb/mm7jjgY3jgpLmi4XjgYbjgq/jg6njgrnjgIJcbiAqIEdhbWXjga7jgrnjg4jjg6zjg7zjgrjjgqLjgq/jgrvjgrnjga/jgZnjgbnjgabjgZPjga7jgq/jg6njgrnjgYzkuIDmrKHlj5fjgZHjgZnjgoso5LiA5qyh5Y+X44GR44GZ44KL6Zai5pWw44KS5o+Q5L6b44GZ44KLKeOAglxuICpcbiAqIOOBn+OBoOOBl+iqreOBv+i+vOOBv+OBq+mWouOBl+OBpuOBr+OAgeWun+mam+OBq+OBr+OBk+OBruOCr+ODqeOCueOBp+OBr+ihjOOCj+OBquOBhOOAglxuICogQWN0aXZl44Oi44O844OJ44Gu5aC05ZCI44CB44K544OI44Os44O844K444GL44KJ6Kqt44G/6L6844KT44Gg44OH44O844K/44GvVGlja+OBq+S5l+OBm+OCi+W/heimgeOBjOOBguOCi+OAglxuICog44GT44Gu44Kv44Op44K544GvVGlja0dlbmVyYXRvcuOBq+ODquOCr+OCqOOCueODiOOCkumAmuefpeOBl+OAgeiqreOBv+i+vOOBv+OBr1RpY2tHZW5lcmF0b3LjgYzop6PmsbrjgZnjgovjgIJcbiAqIFBhc3NpdmXjg6Ljg7zjg4njgoTjgrnjg4rjg4Pjg5fjgrfjg6fjg4Pjg4jjgYvjgonjga7lvqnlhYPjga7loLTlkIjjgIHjgrnjg4jjg6zjg7zjgrjjga7jg4fjg7zjgr/jga8gYFRpY2tCdWZmZXJgIOOBp+WPl+S/oeOBl+OBn1RpY2vjgYvjgonlvpfjgonjgozjgovjgIJcbiAqIOOBk+OBruOCr+ODqeOCueOBr+OAgeiqreOBv+i+vOOBv+ODquOCr+OCqOOCueODiOOCkuW+l+OCieOCjOOBn+OCueODiOODrOODvOOCuOODh+ODvOOCv+OBqOS7mOOBjeWQiOOCj+OBm+OBpuWujOS6huOCkumAmuefpeOBmeOCi+W9ueWJsuOCkuaMgeOBpOOAglxuICovXG52YXIgU3RvcmFnZVJlc29sdmVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFN0b3JhZ2VSZXNvbHZlcihwYXJhbSkge1xuICAgICAgICB0aGlzLmVycm9yVHJpZ2dlciA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgaWYgKHBhcmFtLmVycm9ySGFuZGxlcilcbiAgICAgICAgICAgIHRoaXMuZXJyb3JUcmlnZ2VyLmFkZChwYXJhbS5lcnJvckhhbmRsZXIsIHBhcmFtLmVycm9ySGFuZGxlck93bmVyKTtcbiAgICAgICAgdGhpcy5nZXRTdG9yYWdlRnVuYyA9IHRoaXMuX2dldFN0b3JhZ2UuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5wdXRTdG9yYWdlRnVuYyA9IHRoaXMuX3B1dFN0b3JhZ2UuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5yZXF1ZXN0VmFsdWVzRm9ySm9pbkZ1bmMgPSB0aGlzLl9yZXF1ZXN0VmFsdWVzRm9ySm9pbi5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLl9nYW1lID0gcGFyYW0uZ2FtZTtcbiAgICAgICAgdGhpcy5fYW1mbG93ID0gcGFyYW0uYW1mbG93O1xuICAgICAgICB0aGlzLl90aWNrR2VuZXJhdG9yID0gcGFyYW0udGlja0dlbmVyYXRvcjtcbiAgICAgICAgdGhpcy5fdGlja0J1ZmZlciA9IHBhcmFtLnRpY2tCdWZmZXI7XG4gICAgICAgIHRoaXMuX2V4ZWN1dGlvbk1vZGUgPSBudWxsOyAvLyDlvozntprjga5zZXRFeGVjdXRpb25Nb2RlKCnjgafoqK3lrprjgZnjgovjgIJcbiAgICAgICAgdGhpcy5zZXRFeGVjdXRpb25Nb2RlKHBhcmFtLmV4ZWN1dGlvbk1vZGUpO1xuICAgICAgICB0aGlzLl91bnJlc29sdmVkTG9hZGVycyA9IHt9O1xuICAgICAgICB0aGlzLl91bnJlc29sdmVkU3RvcmFnZXMgPSB7fTtcbiAgICAgICAgdGhpcy5fb25TdG9yYWdlUHV0X2JvdW5kID0gdGhpcy5fb25TdG9yYWdlUHV0LmJpbmQodGhpcyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEV4ZWN1dGlvbk1vZGXjgpLlpInmm7TjgZnjgovjgIJcbiAgICAgKi9cbiAgICBTdG9yYWdlUmVzb2x2ZXIucHJvdG90eXBlLnNldEV4ZWN1dGlvbk1vZGUgPSBmdW5jdGlvbiAoZXhlY3V0aW9uTW9kZSkge1xuICAgICAgICBpZiAodGhpcy5fZXhlY3V0aW9uTW9kZSA9PT0gZXhlY3V0aW9uTW9kZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy5fZXhlY3V0aW9uTW9kZSA9IGV4ZWN1dGlvbk1vZGU7XG4gICAgICAgIHZhciB0aWNrQnVmID0gdGhpcy5fdGlja0J1ZmZlcjtcbiAgICAgICAgdmFyIHRpY2tHZW4gPSB0aGlzLl90aWNrR2VuZXJhdG9yO1xuICAgICAgICBpZiAoZXhlY3V0aW9uTW9kZSA9PT0gRXhlY3V0aW9uTW9kZV8xLmRlZmF1bHQuQWN0aXZlKSB7XG4gICAgICAgICAgICB0aWNrQnVmLmdvdFN0b3JhZ2VUcmlnZ2VyLnJlbW92ZSh0aGlzLl9vbkdvdFN0b3JhZ2VPblRpY2ssIHRoaXMpO1xuICAgICAgICAgICAgdGlja0dlbi5nb3RTdG9yYWdlVHJpZ2dlci5hZGQodGhpcy5fb25Hb3RTdG9yYWdlT25UaWNrLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRpY2tHZW4uZ290U3RvcmFnZVRyaWdnZXIucmVtb3ZlKHRoaXMuX29uR290U3RvcmFnZU9uVGljaywgdGhpcyk7XG4gICAgICAgICAgICB0aWNrQnVmLmdvdFN0b3JhZ2VUcmlnZ2VyLmFkZCh0aGlzLl9vbkdvdFN0b3JhZ2VPblRpY2ssIHRoaXMpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTdG9yYWdlUmVzb2x2ZXIucHJvdG90eXBlLl9vbkdvdFN0b3JhZ2VPblRpY2sgPSBmdW5jdGlvbiAoc3RvcmFnZU9uVGljaykge1xuICAgICAgICB2YXIgcmVzb2x2aW5nQWdlID0gc3RvcmFnZU9uVGljay5hZ2U7XG4gICAgICAgIHZhciBzdG9yYWdlRGF0YSA9IHN0b3JhZ2VPblRpY2suc3RvcmFnZURhdGE7XG4gICAgICAgIHZhciBsb2FkZXIgPSB0aGlzLl91bnJlc29sdmVkTG9hZGVyc1tyZXNvbHZpbmdBZ2VdO1xuICAgICAgICBpZiAoIWxvYWRlcikge1xuICAgICAgICAgICAgdGhpcy5fdW5yZXNvbHZlZFN0b3JhZ2VzW3Jlc29sdmluZ0FnZV0gPSBzdG9yYWdlRGF0YTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBkZWxldGUgdGhpcy5fdW5yZXNvbHZlZExvYWRlcnNbcmVzb2x2aW5nQWdlXTtcbiAgICAgICAgdmFyIHNlcmlhbGl6YXRpb24gPSByZXNvbHZpbmdBZ2U7XG4gICAgICAgIHZhciB2YWx1ZXMgPSBzdG9yYWdlRGF0YS5tYXAoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudmFsdWVzOyB9KTtcbiAgICAgICAgbG9hZGVyLl9vbkxvYWRlZCh2YWx1ZXMsIHNlcmlhbGl6YXRpb24pO1xuICAgIH07XG4gICAgU3RvcmFnZVJlc29sdmVyLnByb3RvdHlwZS5fZ2V0U3RvcmFnZSA9IGZ1bmN0aW9uIChrZXlzLCBsb2FkZXIsIHNlcikge1xuICAgICAgICB2YXIgcmVzb2x2aW5nQWdlO1xuICAgICAgICBpZiAoc2VyICE9IG51bGwpIHtcbiAgICAgICAgICAgIC8vIGFrYXNoaWMtZW5naW5l44Gr44Go44Gj44GmIGBzZXInIOOBruWei+OBr+WNmOOBq2FueeOBp+OBguOCi+OAguWun+aFi+OBr+Wun+ijhShnYW1lLWRyaXZlcinjgavlp5Tjga3jgonjgozjgabjgYTjgovjgIJcbiAgICAgICAgICAgIC8vIGdhbWUtZHJpdmVy44Gv44K344Oq44Ki44Oq44K844O844K344On44Oz44Go44GX44Gm44CM44K544OI44Os44O844K444GM5ZCr44KB44KJ44KM44Gm44GE44GfVGlja+OBrmFnZeOAjeOCkuaOoeeUqOOBmeOCi+OAglxuICAgICAgICAgICAgcmVzb2x2aW5nQWdlID0gc2VyO1xuICAgICAgICAgICAgdGhpcy5fdGlja0J1ZmZlci5yZXF1ZXN0VGlja3MocmVzb2x2aW5nQWdlLCAxKTsgLy8gcmVxdWVzdCDjgZfjgabjgYrjgZHjgbDlvozjga8gX29uR290U3RvcmFnZU9uVGljaygpIOOBq+a4oeOBo+OBpuOBj+OCi1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2V4ZWN1dGlvbk1vZGUgPT09IEV4ZWN1dGlvbk1vZGVfMS5kZWZhdWx0LkFjdGl2ZSkge1xuICAgICAgICAgICAgICAgIHJlc29sdmluZ0FnZSA9IHRoaXMuX3RpY2tHZW5lcmF0b3IucmVxdWVzdFN0b3JhZ2VUaWNrKGtleXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2aW5nQWdlID0gdGhpcy5fZ2FtZS5hZ2U7IC8vIFRPRE86IGdhbWXjgpLlj4LnhafjgZvjgZrjgajjgoJhZ2XjgYzjgajjgozjgovjgojjgYbjgavjgZnjgbnjgY3jgIJcbiAgICAgICAgICAgICAgICB0aGlzLl90aWNrQnVmZmVyLnJlcXVlc3RUaWNrcyhyZXNvbHZpbmdBZ2UsIDEpOyAvLyByZXF1ZXN0IOOBl+OBpuOBiuOBkeOBsOW+jOOBryBfb25Hb3RTdG9yYWdlT25UaWNrKCkg44Gr5rih44Gj44Gm44GP44KLXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHNkID0gdGhpcy5fdW5yZXNvbHZlZFN0b3JhZ2VzW3Jlc29sdmluZ0FnZV07XG4gICAgICAgIGlmICghc2QpIHtcbiAgICAgICAgICAgIHRoaXMuX3VucmVzb2x2ZWRMb2FkZXJzW3Jlc29sdmluZ0FnZV0gPSBsb2FkZXI7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZGVsZXRlIHRoaXMuX3VucmVzb2x2ZWRTdG9yYWdlc1tyZXNvbHZpbmdBZ2VdO1xuICAgICAgICB2YXIgc2VyaWFsaXphdGlvbiA9IHJlc29sdmluZ0FnZTtcbiAgICAgICAgdmFyIHZhbHVlcyA9IHNkLm1hcChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC52YWx1ZXM7IH0pO1xuICAgICAgICBsb2FkZXIuX29uTG9hZGVkKHZhbHVlcywgc2VyaWFsaXphdGlvbik7XG4gICAgfTtcbiAgICBTdG9yYWdlUmVzb2x2ZXIucHJvdG90eXBlLl9wdXRTdG9yYWdlID0gZnVuY3Rpb24gKGtleSwgdmFsdWUsIG9wdGlvbikge1xuICAgICAgICBpZiAodGhpcy5fZXhlY3V0aW9uTW9kZSA9PT0gRXhlY3V0aW9uTW9kZV8xLmRlZmF1bHQuQWN0aXZlKSB7XG4gICAgICAgICAgICB0aGlzLl9hbWZsb3cucHV0U3RvcmFnZURhdGEoa2V5LCB2YWx1ZSwgb3B0aW9uLCB0aGlzLl9vblN0b3JhZ2VQdXRfYm91bmQpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTdG9yYWdlUmVzb2x2ZXIucHJvdG90eXBlLl9yZXF1ZXN0VmFsdWVzRm9ySm9pbiA9IGZ1bmN0aW9uIChrZXlzKSB7XG4gICAgICAgIHRoaXMuX3RpY2tHZW5lcmF0b3Iuc2V0UmVxdWVzdFZhbHVlc0ZvckpvaW4oa2V5cyk7XG4gICAgfTtcbiAgICBTdG9yYWdlUmVzb2x2ZXIucHJvdG90eXBlLl9vblN0b3JhZ2VQdXQgPSBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIGlmIChlcnIpXG4gICAgICAgICAgICB0aGlzLmVycm9yVHJpZ2dlci5maXJlKGVycik7XG4gICAgfTtcbiAgICByZXR1cm4gU3RvcmFnZVJlc29sdmVyO1xufSgpKTtcbmV4cG9ydHMuU3RvcmFnZVJlc29sdmVyID0gU3RvcmFnZVJlc29sdmVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlRpY2tCdWZmZXIgPSB2b2lkIDA7XG52YXIgZyA9IHJlcXVpcmUoXCJAYWthc2hpYy9ha2FzaGljLWVuZ2luZVwiKTtcbnZhciBFeGVjdXRpb25Nb2RlXzEgPSByZXF1aXJlKFwiLi9FeGVjdXRpb25Nb2RlXCIpO1xuLyoqXG4gKiBBTUZsb3fjgYvjgonmtYHjgozovrzjgoBUaWNr44KS6JOE56mN44GZ44KL44OQ44OD44OV44Kh44CCXG4gKlxuICog5Li744Gr5Lul5LiL44KS6KGM44GG44CCXG4gKiAqIOWPl+S/oea4iOOBv+OBrlRpY2vjga7nrqHnkIZcbiAqICog54++5ZyoYWdl44O75pei55+l44Gu5pyA5pawYWdl44O755u06L+R44Gu5qyg44GR44Gm44GE44KLVGlja+OBrueuoeeQhlxuICogKiDotrPjgorjgarjgZ3jgYbjgapUaWNr44Gu5YWI6KGM44Oq44Kv44Ko44K544OIXG4gKiAqIOWHpueQhua4iOOBv1RpY2vjga7noLTmo4RcbiAqL1xudmFyIFRpY2tCdWZmZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVGlja0J1ZmZlcihwYXJhbSkge1xuICAgICAgICB0aGlzLmN1cnJlbnRBZ2UgPSAwO1xuICAgICAgICB0aGlzLmtub3duTGF0ZXN0QWdlID0gLTE7XG4gICAgICAgIHRoaXMuZ290TmV4dFRpY2tUcmlnZ2VyID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICB0aGlzLmdvdE5vVGlja1RyaWdnZXIgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgIHRoaXMuZ290U3RvcmFnZVRyaWdnZXIgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgIHRoaXMuX2FtZmxvdyA9IHBhcmFtLmFtZmxvdztcbiAgICAgICAgdGhpcy5fcHJlZmV0Y2hUaHJlc2hvbGQgPSBwYXJhbS5wcmVmZXRjaFRocmVzaG9sZCB8fCBUaWNrQnVmZmVyLkRFRkFVTFRfUFJFRkVUQ0hfVEhSRVNIT0xEO1xuICAgICAgICB0aGlzLl9zaXplUmVxdWVzdE9uY2UgPSBwYXJhbS5zaXplUmVxdWVzdE9uY2UgfHwgVGlja0J1ZmZlci5ERUZBVUxUX1NJWkVfUkVRVUVTVF9PTkNFO1xuICAgICAgICB0aGlzLl9leGVjdXRpb25Nb2RlID0gcGFyYW0uZXhlY3V0aW9uTW9kZTtcbiAgICAgICAgdGhpcy5fc3RhcnRlZEF0ID0gcGFyYW0uc3RhcnRlZEF0IHx8IDA7XG4gICAgICAgIHRoaXMuX29sZFRpbWVzdGFtcFRocmVzaG9sZCA9IChwYXJhbS5zdGFydGVkQXQgIT0gbnVsbCkgPyAocGFyYW0uc3RhcnRlZEF0IC0gKDg2NDAwICogMTAwMCAqIDEwKSkgOiAwOyAvLyDmlbDlrZfjga/pganlvZPjgarlgKQoMTDml6XliIYp44CCXG4gICAgICAgIHRoaXMuX3JlY2VpdmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLl90aWNrUmFuZ2VzID0gW107XG4gICAgICAgIHRoaXMuX25lYXJlc3RBYnNlbnRBZ2UgPSB0aGlzLmN1cnJlbnRBZ2U7XG4gICAgICAgIHRoaXMuX25leHRUaWNrVGltZUNhY2hlID0gbnVsbDtcbiAgICAgICAgdGhpcy5fYWRkVGlja19ib3VuZCA9IHRoaXMuYWRkVGljay5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLl9vblRpY2tzX2JvdW5kID0gdGhpcy5fb25UaWNrcy5iaW5kKHRoaXMpO1xuICAgIH1cbiAgICBUaWNrQnVmZmVyLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fcmVjZWl2aW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fdXBkYXRlQW1mbG93UmVjZWl2ZVN0YXRlKCk7XG4gICAgfTtcbiAgICBUaWNrQnVmZmVyLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9yZWNlaXZpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fdXBkYXRlQW1mbG93UmVjZWl2ZVN0YXRlKCk7XG4gICAgfTtcbiAgICBUaWNrQnVmZmVyLnByb3RvdHlwZS5zZXRFeGVjdXRpb25Nb2RlID0gZnVuY3Rpb24gKGV4ZWNNb2RlKSB7XG4gICAgICAgIC8vIFRPRE86IGdldFRpY2tMaXN0KCnkuK3jgathdXRoZW50aWNhdGUoKeOBl+OBquOBiuOBl+OBn+WgtOWQiOOBruaMmeWLleeiuuiqjVxuICAgICAgICBpZiAodGhpcy5fZXhlY3V0aW9uTW9kZSA9PT0gZXhlY01vZGUpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuX2Ryb3BVbnRpbCh0aGlzLmtub3duTGF0ZXN0QWdlICsgMSk7IC8vIOaXouWtmOODh+ODvOOCv+OBr+aNqOOBpuOCiyjnibnjgatQYXNzaXZlLT5BY3RpdmXjgafml6LlrZhUaWNr44KS5LiK5pu444GN44GZ44KL5b+F6KaB44GM44GC44KK44GG44KLKVxuICAgICAgICB0aGlzLmtub3duTGF0ZXN0QWdlID0gdGhpcy5jdXJyZW50QWdlO1xuICAgICAgICB0aGlzLl9uZXh0VGlja1RpbWVDYWNoZSA9IG51bGw7XG4gICAgICAgIHRoaXMuX25lYXJlc3RBYnNlbnRBZ2UgPSB0aGlzLmN1cnJlbnRBZ2U7XG4gICAgICAgIHRoaXMuX2V4ZWN1dGlvbk1vZGUgPSBleGVjTW9kZTtcbiAgICAgICAgdGhpcy5fdXBkYXRlQW1mbG93UmVjZWl2ZVN0YXRlKCk7XG4gICAgfTtcbiAgICBUaWNrQnVmZmVyLnByb3RvdHlwZS5zZXRDdXJyZW50QWdlID0gZnVuY3Rpb24gKGFnZSkge1xuICAgICAgICB0aGlzLl9kcm9wVW50aWwoYWdlKTtcbiAgICAgICAgdGhpcy5fbmV4dFRpY2tUaW1lQ2FjaGUgPSBudWxsO1xuICAgICAgICB0aGlzLmN1cnJlbnRBZ2UgPSBhZ2U7XG4gICAgICAgIHRoaXMuX25lYXJlc3RBYnNlbnRBZ2UgPSB0aGlzLl9maW5kTmVhcmVzdEFic2NlbnRBZ2UoYWdlKTtcbiAgICB9O1xuICAgIFRpY2tCdWZmZXIucHJvdG90eXBlLmhhc05leHRUaWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWdlICE9PSB0aGlzLl9uZWFyZXN0QWJzZW50QWdlO1xuICAgIH07XG4gICAgVGlja0J1ZmZlci5wcm90b3R5cGUuY29uc3VtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEFnZSA9PT0gdGhpcy5fbmVhcmVzdEFic2VudEFnZSlcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB2YXIgYWdlID0gdGhpcy5jdXJyZW50QWdlO1xuICAgICAgICB2YXIgcmFuZ2UgPSB0aGlzLl90aWNrUmFuZ2VzWzBdO1xuICAgICAgICBpZiAoYWdlID09PSByYW5nZS5zdGFydCkge1xuICAgICAgICAgICAgdGhpcy5fbmV4dFRpY2tUaW1lQ2FjaGUgPSBudWxsO1xuICAgICAgICAgICAgKyt0aGlzLmN1cnJlbnRBZ2U7XG4gICAgICAgICAgICArK3JhbmdlLnN0YXJ0O1xuICAgICAgICAgICAgaWYgKGFnZSArIHRoaXMuX3ByZWZldGNoVGhyZXNob2xkID09PSB0aGlzLl9uZWFyZXN0QWJzZW50QWdlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0VGlja3ModGhpcy5fbmVhcmVzdEFic2VudEFnZSwgdGhpcy5fc2l6ZVJlcXVlc3RPbmNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyYW5nZS5zdGFydCA9PT0gcmFuZ2UuZW5kKVxuICAgICAgICAgICAgICAgIHRoaXMuX3RpY2tSYW5nZXMuc2hpZnQoKTtcbiAgICAgICAgICAgIHJldHVybiAocmFuZ2UudGlja3MubGVuZ3RoID4gMCAmJiByYW5nZS50aWNrc1swXVswIC8qIEFnZSAqL10gPT09IGFnZSkgPyByYW5nZS50aWNrcy5zaGlmdCgpIDogYWdlO1xuICAgICAgICB9XG4gICAgICAgIC8vIHJhbmdlLnN0YXJ0IDwgYWdl44CC5aSW6YOo44GL44KJ5YmN44Gr6L+95Yqg44GV44KM44Gf5aC05ZCI44CC56C05qOE44GX44Gm44Oq44OI44Op44Kk44GZ44KL44CCXG4gICAgICAgIHRoaXMuX2Ryb3BVbnRpbCh0aGlzLmN1cnJlbnRBZ2UpO1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdW1lKCk7XG4gICAgfTtcbiAgICBUaWNrQnVmZmVyLnByb3RvdHlwZS5yZWFkTmV4dFRpY2tUaW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fbmV4dFRpY2tUaW1lQ2FjaGUgIT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9uZXh0VGlja1RpbWVDYWNoZTtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEFnZSA9PT0gdGhpcy5fbmVhcmVzdEFic2VudEFnZSlcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB2YXIgYWdlID0gdGhpcy5jdXJyZW50QWdlO1xuICAgICAgICB2YXIgcmFuZ2UgPSB0aGlzLl90aWNrUmFuZ2VzWzBdO1xuICAgICAgICBpZiAoYWdlID09PSByYW5nZS5zdGFydCkge1xuICAgICAgICAgICAgaWYgKHJhbmdlLnRpY2tzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIHZhciB0aWNrID0gcmFuZ2UudGlja3NbMF07XG4gICAgICAgICAgICBpZiAodGlja1swIC8qIEFnZSAqL10gIT09IGFnZSlcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIHZhciBwZXZzID0gdGlja1sxIC8qIEV2ZW50cyAqL107XG4gICAgICAgICAgICBpZiAoIXBldnMpXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBldnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICBpZiAocGV2c1tpXVswIC8qIENvZGUgKi9dID09PSAyIC8qIFRpbWVzdGFtcCAqLykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dFRpY2tUaW1lID0gcGV2c1tpXVszIC8qIFRpbWVzdGFtcCAqL107XG4gICAgICAgICAgICAgICAgICAgIC8vIOaaq+WumuWHpueQhjog5pen5LuV5qeYKOebuOWvvuaZguWIuynnlKjjg6/jg7zjgq/jgqLjg6njgqbjg7Pjg4njgILlsI/jgZXjgZnjgY7jgovmmYLliLvjga/nm7jlr77jgajjgb/jgarjgZlcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRUaWNrVGltZSA8IHRoaXMuX29sZFRpbWVzdGFtcFRocmVzaG9sZClcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRUaWNrVGltZSArPSB0aGlzLl9zdGFydGVkQXQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX25leHRUaWNrVGltZUNhY2hlID0gbmV4dFRpY2tUaW1lO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV4dFRpY2tUaW1lO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIC8vIHJhbmdlLnN0YXJ0IDwgYWdl44CC5aSW6YOo44GL44KJ5YmN44Gr6L+95Yqg44GV44KM44Gf5aC05ZCI44CC56C05qOE44GX44Gm44Oq44OI44Op44Kk44GZ44KL44CCXG4gICAgICAgIHRoaXMuX2Ryb3BVbnRpbCh0aGlzLmN1cnJlbnRBZ2UpO1xuICAgICAgICByZXR1cm4gdGhpcy5yZWFkTmV4dFRpY2tUaW1lKCk7XG4gICAgfTtcbiAgICBUaWNrQnVmZmVyLnByb3RvdHlwZS5yZXF1ZXN0VGlja3MgPSBmdW5jdGlvbiAoZnJvbSwgbGVuKSB7XG4gICAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsgZnJvbSA9IHRoaXMuY3VycmVudEFnZTsgfVxuICAgICAgICBpZiAobGVuID09PSB2b2lkIDApIHsgbGVuID0gdGhpcy5fc2l6ZVJlcXVlc3RPbmNlOyB9XG4gICAgICAgIGlmICh0aGlzLl9leGVjdXRpb25Nb2RlICE9PSBFeGVjdXRpb25Nb2RlXzEuZGVmYXVsdC5QYXNzaXZlKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLl9hbWZsb3cuZ2V0VGlja0xpc3QoZnJvbSwgZnJvbSArIGxlbiwgdGhpcy5fb25UaWNrc19ib3VuZCk7XG4gICAgfTtcbiAgICBUaWNrQnVmZmVyLnByb3RvdHlwZS5hZGRUaWNrID0gZnVuY3Rpb24gKHRpY2spIHtcbiAgICAgICAgdmFyIGFnZSA9IHRpY2tbMCAvKiBBZ2UgKi9dO1xuICAgICAgICB2YXIgZ290TmV4dCA9ICh0aGlzLmN1cnJlbnRBZ2UgPT09IGFnZSkgJiYgKHRoaXMuX25lYXJlc3RBYnNlbnRBZ2UgPT09IGFnZSk7XG4gICAgICAgIGlmICh0aGlzLmtub3duTGF0ZXN0QWdlIDwgYWdlKSB7XG4gICAgICAgICAgICB0aGlzLmtub3duTGF0ZXN0QWdlID0gYWdlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aWNrWzIgLyogU3RvcmFnZURhdGEgKi9dKSB7XG4gICAgICAgICAgICB0aGlzLmdvdFN0b3JhZ2VUcmlnZ2VyLmZpcmUoeyBhZ2U6IHRpY2tbMCAvKiBBZ2UgKi9dLCBzdG9yYWdlRGF0YTogdGlja1syIC8qIFN0b3JhZ2VEYXRhICovXSB9KTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaSA9IHRoaXMuX3RpY2tSYW5nZXMubGVuZ3RoIC0gMTtcbiAgICAgICAgZm9yICg7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgICAgICB2YXIgcmFuZ2UgPSB0aGlzLl90aWNrUmFuZ2VzW2ldO1xuICAgICAgICAgICAgaWYgKGFnZSA+PSByYW5nZS5zdGFydClcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICB2YXIgbmV4dFJhbmdlID0gdGhpcy5fdGlja1Jhbmdlc1tpICsgMV07XG4gICAgICAgIGlmIChpIDwgMCkge1xuICAgICAgICAgICAgLy8g5pei55+l44Gu44Gp44GuIHRpY2sg44KI44KK44KC6YGO5Y6744CB44G+44Gf44Gv5Y2Y44Gr5pei55+l44GuIHRpY2sg44GM44Gq44GE44CCXG4gICAgICAgICAgICAvLyBOT1RFOiBfdGlja1Jhbmdlc1swXeOCkumBjuWOu+aWueWQkeOBq+aLoeW8teOBp+OBjeOCi+OBi+OCguOBl+OCjOOBquOBhOOBjOOAgVxuICAgICAgICAgICAgLy8gICAgICAgYWRkVGlja+OBr+OBu+OBvOacgOaWsOODleODrOODvOODoOOBl+OBi+WPl+S/oeOBl+OBquOBhOOBruOBp+awl+OBq+OBm+OBmuaWsOOBn+OBq1RpY2tSYW5nZeOCkuS9nOOCi+OAglxuICAgICAgICAgICAgdGhpcy5fdGlja1Jhbmdlcy51bnNoaWZ0KHRoaXMuX2NyZWF0ZVRpY2tSYW5nZUZyb21UaWNrKHRpY2spKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciByYW5nZSA9IHRoaXMuX3RpY2tSYW5nZXNbaV07XG4gICAgICAgICAgICBpZiAoYWdlID09PSByYW5nZS5lbmQpIHtcbiAgICAgICAgICAgICAgICAvLyDnm7Tov5Hjga4gVGlja1JhbmdlIOOBruOBmeOBkOW+jOOBq+e2muOBjyB0aWNrIOOBoOOBo+OBn+OAglxuICAgICAgICAgICAgICAgICsrcmFuZ2UuZW5kO1xuICAgICAgICAgICAgICAgIGlmICh0aWNrWzEgLyogRXZlbnRzICovXSkge1xuICAgICAgICAgICAgICAgICAgICByYW5nZS50aWNrcy5wdXNoKHRpY2spO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGFnZSA+IHJhbmdlLmVuZCkge1xuICAgICAgICAgICAgICAgIC8vIOaXouWtmCBUaWNrTGlzdCDjgavntprjgYvjgarjgYQgdGljayDjgaDjgaPjgZ/jgILmlrDopo/jgasgVGlja0xpc3Qg44KS5L2c44Gj44Gm5oy/5YWlXG4gICAgICAgICAgICAgICAgdGhpcy5fdGlja1Jhbmdlcy5zcGxpY2UoaSArIDEsIDAsIHRoaXMuX2NyZWF0ZVRpY2tSYW5nZUZyb21UaWNrKHRpY2spKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIChzdGFydCA8PSBhZ2UgPCBlbmQpIOaXouWtmCB0aWNrIOOBqOmHjeikh+OBl+OBpuOBhOOCi+OAguS9leOCguOBl+OBquOBhOOAglxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9uZWFyZXN0QWJzZW50QWdlID09PSBhZ2UpIHtcbiAgICAgICAgICAgICsrdGhpcy5fbmVhcmVzdEFic2VudEFnZTtcbiAgICAgICAgICAgIGlmIChuZXh0UmFuZ2UgJiYgdGhpcy5fbmVhcmVzdEFic2VudEFnZSA9PT0gbmV4dFJhbmdlLnN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgLy8g55u06L+R44Gu5qyg44GR44Gm44GE44KLYWdl44KS6L+95Yqg44GX44Gf44KJ5YmN5b6M44GucmFuZ2XjgYznuYvjgYzjgaPjgabjgZfjgb7jgaPjgZ/jgILoq6bjgoHjgaZfbmVhcmVzdEFic2VudEFnZeOCkuaxguOCgeebtOOBmeOAglxuICAgICAgICAgICAgICAgIHRoaXMuX25lYXJlc3RBYnNlbnRBZ2UgPSB0aGlzLl9maW5kTmVhcmVzdEFic2NlbnRBZ2UodGhpcy5fbmVhcmVzdEFic2VudEFnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGdvdE5leHQpXG4gICAgICAgICAgICB0aGlzLmdvdE5leHRUaWNrVHJpZ2dlci5maXJlKCk7XG4gICAgfTtcbiAgICBUaWNrQnVmZmVyLnByb3RvdHlwZS5hZGRUaWNrTGlzdCA9IGZ1bmN0aW9uICh0aWNrTGlzdCkge1xuICAgICAgICB2YXIgc3RhcnQgPSB0aWNrTGlzdFswIC8qIEZyb20gKi9dO1xuICAgICAgICB2YXIgZW5kID0gdGlja0xpc3RbMSAvKiBUbyAqL10gKyAxO1xuICAgICAgICB2YXIgdGlja3MgPSB0aWNrTGlzdFsyIC8qIFRpY2tzV2l0aEV2ZW50cyAqL107XG4gICAgICAgIHZhciBvcmlnU3RhcnQgPSBzdGFydDtcbiAgICAgICAgdmFyIG9yaWdFbmQgPSBlbmQ7XG4gICAgICAgIGlmICh0aGlzLmtub3duTGF0ZXN0QWdlIDwgZW5kIC0gMSkge1xuICAgICAgICAgICAgdGhpcy5rbm93bkxhdGVzdEFnZSA9IGVuZCAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgLy8g5LuK5Zue5oy/5YWl5YiG44Gu6ZaL5aeLYWdl44KI44KK44KC44CM5b6M44CN44Gr6ZaL5aeL44GV44KM44KL5pyA5Yid44GucmFuZ2XjgpLmjqLjgZlcbiAgICAgICAgdmFyIGkgPSAwO1xuICAgICAgICB2YXIgbGVuID0gdGhpcy5fdGlja1Jhbmdlcy5sZW5ndGg7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47ICsraSkge1xuICAgICAgICAgICAgdmFyIHJhbmdlID0gdGhpcy5fdGlja1Jhbmdlc1tpXTtcbiAgICAgICAgICAgIGlmIChzdGFydCA8IHJhbmdlLnN0YXJ0KVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHZhciBpbnNlcnRQb2ludCA9IGk7XG4gICAgICAgIC8vIOW3puWBtOOBjOmHjeikh+OBl+OBhuOCi3Jhbmdl44KS5o6i44GX44Gm6YeN6KSH44KS6Zmk44GPXG4gICAgICAgIGlmIChpID4gMCkge1xuICAgICAgICAgICAgLy8g5bem5YG044GM6YeN6KSH44GX44GG44KLcmFuZ2Xjga/jgIHku4rlm57mjL/lhaXliIbjga7plovlp4thZ2Xjga7nm7TliY3jgavlp4vjgb7jgovjgoLjga5cbiAgICAgICAgICAgIC0taTtcbiAgICAgICAgICAgIHZhciBsZWZ0RW5kQWdlID0gdGhpcy5fdGlja1Jhbmdlc1tpXS5lbmQ7XG4gICAgICAgICAgICBpZiAoc3RhcnQgPCBsZWZ0RW5kQWdlKVxuICAgICAgICAgICAgICAgIHN0YXJ0ID0gbGVmdEVuZEFnZTtcbiAgICAgICAgfVxuICAgICAgICAvLyDlj7PlgbTjgafph43opIfjgZfjgYbjgotyYW5nZeOCkuaOouOBl+OBpumHjeikh+OCkumZpOOBj1xuICAgICAgICBmb3IgKDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgICAgICB2YXIgcmFuZ2UgPSB0aGlzLl90aWNrUmFuZ2VzW2ldO1xuICAgICAgICAgICAgaWYgKGVuZCA8PSByYW5nZS5lbmQpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGkgPCBsZW4pIHtcbiAgICAgICAgICAgIHZhciByaWdodFN0YXJ0QWdlID0gdGhpcy5fdGlja1Jhbmdlc1tpXS5zdGFydDtcbiAgICAgICAgICAgIGlmIChlbmQgPiByaWdodFN0YXJ0QWdlKVxuICAgICAgICAgICAgICAgIGVuZCA9IHJpZ2h0U3RhcnRBZ2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0YXJ0ID49IGVuZCkge1xuICAgICAgICAgICAgLy8g5LuK5Zue5oy/5YWl5YiG44Gv44GZ44G544Gm6YeN6KSH44Gg44Gj44Gf44CC5L2V44KC44Gb44GacmV0dXJuXG4gICAgICAgICAgICByZXR1cm4geyBzdGFydDogc3RhcnQsIGVuZDogc3RhcnQsIHRpY2tzOiBbXSB9O1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGlja3MpXG4gICAgICAgICAgICB0aWNrcyA9IFtdO1xuICAgICAgICBpZiAob3JpZ1N0YXJ0ICE9PSBzdGFydCB8fCBvcmlnRW5kICE9PSBlbmQpIHtcbiAgICAgICAgICAgIHRpY2tzID0gdGlja3MuZmlsdGVyKGZ1bmN0aW9uICh0aWNrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFnZSA9IHRpY2tbMCAvKiBBZ2UgKi9dO1xuICAgICAgICAgICAgICAgIHJldHVybiBzdGFydCA8PSBhZ2UgJiYgYWdlIDwgZW5kO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aWNrcy5sZW5ndGg7ICsraikge1xuICAgICAgICAgICAgdmFyIHRpY2sgPSB0aWNrc1tqXTtcbiAgICAgICAgICAgIGlmICh0aWNrWzIgLyogU3RvcmFnZURhdGEgKi9dKVxuICAgICAgICAgICAgICAgIHRoaXMuZ290U3RvcmFnZVRyaWdnZXIuZmlyZSh7IGFnZTogdGlja1swIC8qIEFnZSAqL10sIHN0b3JhZ2VEYXRhOiB0aWNrWzIgLyogU3RvcmFnZURhdGEgKi9dIH0pO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0aWNrUmFuZ2UgPSB7IHN0YXJ0OiBzdGFydCwgZW5kOiBlbmQsIHRpY2tzOiB0aWNrcyB9O1xuICAgICAgICB2YXIgZGVsTGVuID0gTWF0aC5tYXgoMCwgaSAtIGluc2VydFBvaW50KTtcbiAgICAgICAgdGhpcy5fdGlja1Jhbmdlcy5zcGxpY2UoaW5zZXJ0UG9pbnQsIGRlbExlbiwgdGlja1JhbmdlKTtcbiAgICAgICAgaWYgKHN0YXJ0IDw9IHRoaXMuX25lYXJlc3RBYnNlbnRBZ2UgJiYgdGhpcy5fbmVhcmVzdEFic2VudEFnZSA8IGVuZCkge1xuICAgICAgICAgICAgdGhpcy5fbmVhcmVzdEFic2VudEFnZSA9IHRoaXMuX2ZpbmROZWFyZXN0QWJzY2VudEFnZSh0aGlzLl9uZWFyZXN0QWJzZW50QWdlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGlja1JhbmdlO1xuICAgIH07XG4gICAgVGlja0J1ZmZlci5wcm90b3R5cGUuX3VwZGF0ZUFtZmxvd1JlY2VpdmVTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3JlY2VpdmluZyAmJiB0aGlzLl9leGVjdXRpb25Nb2RlID09PSBFeGVjdXRpb25Nb2RlXzEuZGVmYXVsdC5QYXNzaXZlKSB7XG4gICAgICAgICAgICB0aGlzLl9hbWZsb3cub25UaWNrKHRoaXMuX2FkZFRpY2tfYm91bmQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fYW1mbG93Lm9mZlRpY2sodGhpcy5fYWRkVGlja19ib3VuZCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRpY2tCdWZmZXIucHJvdG90eXBlLl9vblRpY2tzID0gZnVuY3Rpb24gKGVyciwgdGlja3MpIHtcbiAgICAgICAgaWYgKGVycilcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigpO1xuICAgICAgICBpZiAoIXRpY2tzKSB7XG4gICAgICAgICAgICB0aGlzLmdvdE5vVGlja1RyaWdnZXIuZmlyZSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBtYXlHb3ROZXh0ID0gKHRoaXMuY3VycmVudEFnZSA9PT0gdGhpcy5fbmVhcmVzdEFic2VudEFnZSk7XG4gICAgICAgIHZhciBpbnNlcnRlZCA9IHRoaXMuYWRkVGlja0xpc3QodGlja3MpO1xuICAgICAgICBpZiAobWF5R290TmV4dCAmJiAoaW5zZXJ0ZWQuc3RhcnQgPD0gdGhpcy5jdXJyZW50QWdlICYmIHRoaXMuY3VycmVudEFnZSA8IGluc2VydGVkLmVuZCkpIHtcbiAgICAgICAgICAgIHRoaXMuZ290TmV4dFRpY2tUcmlnZ2VyLmZpcmUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWluc2VydGVkLnRpY2tzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5nb3ROb1RpY2tUcmlnZ2VyLmZpcmUoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGlja0J1ZmZlci5wcm90b3R5cGUuX2ZpbmROZWFyZXN0QWJzY2VudEFnZSA9IGZ1bmN0aW9uIChhZ2UpIHtcbiAgICAgICAgdmFyIGkgPSAwLCBsZW4gPSB0aGlzLl90aWNrUmFuZ2VzLmxlbmd0aDtcbiAgICAgICAgZm9yICg7IGkgPCBsZW47ICsraSkge1xuICAgICAgICAgICAgaWYgKGFnZSA8PSB0aGlzLl90aWNrUmFuZ2VzW2ldLmVuZClcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBmb3IgKDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgICAgICB2YXIgcmFuZ2UgPSB0aGlzLl90aWNrUmFuZ2VzW2ldO1xuICAgICAgICAgICAgaWYgKGFnZSA8IHJhbmdlLnN0YXJ0KVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgYWdlID0gcmFuZ2UuZW5kO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhZ2U7XG4gICAgfTtcbiAgICBUaWNrQnVmZmVyLnByb3RvdHlwZS5fZHJvcFVudGlsID0gZnVuY3Rpb24gKGFnZSkge1xuICAgICAgICAvLyBbc3RhcnQsZW5kKSDjgYzlhajpg6ggYWdlIOS7peWJjeOBruOCguOBruOCkuWJiumZpFxuICAgICAgICB2YXIgaTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuX3RpY2tSYW5nZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGlmIChhZ2UgPCB0aGlzLl90aWNrUmFuZ2VzW2ldLmVuZClcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90aWNrUmFuZ2VzID0gdGhpcy5fdGlja1Jhbmdlcy5zbGljZShpKTtcbiAgICAgICAgaWYgKHRoaXMuX3RpY2tSYW5nZXMubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAvLyBzdGFydCDjgpLmm7jjgY3mj5vjgYjjgovjgZPjgajjgafjgIFbc3RhcnQsIGFnZSkg44Gu56+E5Zuy44KS5YmK6ZmkXG4gICAgICAgIHZhciByYW5nZSA9IHRoaXMuX3RpY2tSYW5nZXNbMF07XG4gICAgICAgIGlmIChhZ2UgPCByYW5nZS5zdGFydClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgcmFuZ2Uuc3RhcnQgPSBhZ2U7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCByYW5nZS50aWNrcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKGFnZSA8PSByYW5nZS50aWNrc1tpXVswIC8qIEFnZSAqL10pXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmFuZ2UudGlja3MgPSByYW5nZS50aWNrcy5zbGljZShpKTtcbiAgICB9O1xuICAgIFRpY2tCdWZmZXIucHJvdG90eXBlLl9jcmVhdGVUaWNrUmFuZ2VGcm9tVGljayA9IGZ1bmN0aW9uICh0aWNrKSB7XG4gICAgICAgIHZhciBhZ2UgPSB0aWNrWzAgLyogQWdlICovXTtcbiAgICAgICAgdmFyIHJhbmdlID0ge1xuICAgICAgICAgICAgc3RhcnQ6IGFnZSxcbiAgICAgICAgICAgIGVuZDogYWdlICsgMSxcbiAgICAgICAgICAgIHRpY2tzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBpZiAodGlja1sxIC8qIEV2ZW50cyAqL10pIHtcbiAgICAgICAgICAgIHJhbmdlLnRpY2tzLnB1c2godGljayk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJhbmdlO1xuICAgIH07XG4gICAgVGlja0J1ZmZlci5ERUZBVUxUX1BSRUZFVENIX1RIUkVTSE9MRCA9IDMwICogNjA7IC8vIOaVsOWtl+OBr+mBqeW9k+OBqzMwRlBT44GnMeWIhumWk+WIhuOAgjMwRlBTICogNjDnp5LjgIJcbiAgICBUaWNrQnVmZmVyLkRFRkFVTFRfU0laRV9SRVFVRVNUX09OQ0UgPSAzMCAqIDYwICogNTsgLy8g5pWw5a2X44Gv6YGp5b2T44GrMzBGUFPjgac15YiG6ZaT5YiG44CCXG4gICAgcmV0dXJuIFRpY2tCdWZmZXI7XG59KCkpO1xuZXhwb3J0cy5UaWNrQnVmZmVyID0gVGlja0J1ZmZlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5UaWNrQ29udHJvbGxlciA9IHZvaWQgMDtcbnZhciBnID0gcmVxdWlyZShcIkBha2FzaGljL2FrYXNoaWMtZW5naW5lXCIpO1xudmFyIEV4ZWN1dGlvbk1vZGVfMSA9IHJlcXVpcmUoXCIuL0V4ZWN1dGlvbk1vZGVcIik7XG52YXIgVGlja0J1ZmZlcl8xID0gcmVxdWlyZShcIi4vVGlja0J1ZmZlclwiKTtcbnZhciBUaWNrR2VuZXJhdG9yXzEgPSByZXF1aXJlKFwiLi9UaWNrR2VuZXJhdG9yXCIpO1xudmFyIHNyID0gcmVxdWlyZShcIi4vU3RvcmFnZVJlc29sdmVyXCIpO1xuLyoqXG4gKiBgR2FtZUxvb3BgIOOBq+a1geOCjOOCi1RpY2vjgpLnrqHnkIbjgZnjgovjgq/jg6njgrnjgIJcbiAqXG4gKiBgR2FtZUxvb3BgIOOBq+WvvuOBl+OBpiBgVGlja0dlbmVyYXRvcmAg44GoIGBBTUZsb3dgIOOCkumaoOiUveOBl+OAgVxuICogQWN0aXZlL1Bhc3NpdmXjgaso44G744G8KemWouS/guOBquOBj1RpY2vjgpLmibHjgYjjgovjgojjgYbjgavjgZnjgovjgIJcbiAqL1xudmFyIFRpY2tDb250cm9sbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFRpY2tDb250cm9sbGVyKHBhcmFtKSB7XG4gICAgICAgIHRoaXMuZXJyb3JUcmlnZ2VyID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICBpZiAocGFyYW0uZXJyb3JIYW5kbGVyKVxuICAgICAgICAgICAgdGhpcy5lcnJvclRyaWdnZXIuYWRkKHBhcmFtLmVycm9ySGFuZGxlciwgcGFyYW0uZXJyb3JIYW5kbGVyT3duZXIpO1xuICAgICAgICB0aGlzLl9hbWZsb3cgPSBwYXJhbS5hbWZsb3c7XG4gICAgICAgIHRoaXMuX2Nsb2NrID0gcGFyYW0uY2xvY2s7XG4gICAgICAgIHRoaXMuX3N0YXJ0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fZXhlY3V0aW9uTW9kZSA9IHBhcmFtLmV4ZWN1dGlvbk1vZGU7XG4gICAgICAgIHRoaXMuX2dlbmVyYXRvciA9IG5ldyBUaWNrR2VuZXJhdG9yXzEuVGlja0dlbmVyYXRvcih7XG4gICAgICAgICAgICBhbWZsb3c6IHBhcmFtLmFtZmxvdyxcbiAgICAgICAgICAgIGV2ZW50QnVmZmVyOiBwYXJhbS5ldmVudEJ1ZmZlcixcbiAgICAgICAgICAgIGVycm9ySGFuZGxlcjogdGhpcy5lcnJvclRyaWdnZXIuZmlyZSxcbiAgICAgICAgICAgIGVycm9ySGFuZGxlck93bmVyOiB0aGlzLmVycm9yVHJpZ2dlclxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5fYnVmZmVyID0gbmV3IFRpY2tCdWZmZXJfMS5UaWNrQnVmZmVyKHtcbiAgICAgICAgICAgIGFtZmxvdzogcGFyYW0uYW1mbG93LFxuICAgICAgICAgICAgZXhlY3V0aW9uTW9kZTogcGFyYW0uZXhlY3V0aW9uTW9kZSxcbiAgICAgICAgICAgIHN0YXJ0ZWRBdDogcGFyYW0uc3RhcnRlZEF0XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9zdG9yYWdlUmVzb2x2ZXIgPSBuZXcgc3IuU3RvcmFnZVJlc29sdmVyKHtcbiAgICAgICAgICAgIGdhbWU6IHBhcmFtLmdhbWUsXG4gICAgICAgICAgICBhbWZsb3c6IHBhcmFtLmFtZmxvdyxcbiAgICAgICAgICAgIHRpY2tHZW5lcmF0b3I6IHRoaXMuX2dlbmVyYXRvcixcbiAgICAgICAgICAgIHRpY2tCdWZmZXI6IHRoaXMuX2J1ZmZlcixcbiAgICAgICAgICAgIGV4ZWN1dGlvbk1vZGU6IHBhcmFtLmV4ZWN1dGlvbk1vZGUsXG4gICAgICAgICAgICBlcnJvckhhbmRsZXI6IHRoaXMuZXJyb3JUcmlnZ2VyLmZpcmUsXG4gICAgICAgICAgICBlcnJvckhhbmRsZXJPd25lcjogdGhpcy5lcnJvclRyaWdnZXJcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX2dlbmVyYXRvci50aWNrVHJpZ2dlci5hZGQodGhpcy5fb25UaWNrR2VuZXJhdGVkLCB0aGlzKTtcbiAgICAgICAgdGhpcy5fY2xvY2suZnJhbWVUcmlnZ2VyLmFkZCh0aGlzLl9nZW5lcmF0b3IubmV4dCwgdGhpcy5fZ2VuZXJhdG9yKTtcbiAgICB9XG4gICAgVGlja0NvbnRyb2xsZXIucHJvdG90eXBlLnN0YXJ0VGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3RhcnRlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuX3VwZGF0ZUdlbmVyYXRvclN0YXRlKCk7XG4gICAgfTtcbiAgICBUaWNrQ29udHJvbGxlci5wcm90b3R5cGUuc3RvcFRpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N0YXJ0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fdXBkYXRlR2VuZXJhdG9yU3RhdGUoKTtcbiAgICB9O1xuICAgIFRpY2tDb250cm9sbGVyLnByb3RvdHlwZS5zdGFydFRpY2tPbmNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdGFydGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZ2VuZXJhdG9yLnRpY2tUcmlnZ2VyLmFkZE9uY2UodGhpcy5fc3RvcFRyaWdnZXJPblRpY2ssIHRoaXMpO1xuICAgICAgICB0aGlzLl91cGRhdGVHZW5lcmF0b3JTdGF0ZSgpO1xuICAgIH07XG4gICAgVGlja0NvbnRyb2xsZXIucHJvdG90eXBlLnNldE5leHRBZ2UgPSBmdW5jdGlvbiAoYWdlKSB7XG4gICAgICAgIHRoaXMuX2dlbmVyYXRvci5zZXROZXh0QWdlKGFnZSk7XG4gICAgfTtcbiAgICBUaWNrQ29udHJvbGxlci5wcm90b3R5cGUuZm9yY2VHZW5lcmF0ZVRpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2dlbmVyYXRvci5mb3JjZU5leHQoKTtcbiAgICB9O1xuICAgIFRpY2tDb250cm9sbGVyLnByb3RvdHlwZS5nZXRCdWZmZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9idWZmZXI7XG4gICAgfTtcbiAgICBUaWNrQ29udHJvbGxlci5wcm90b3R5cGUuc3RvcmFnZUZ1bmMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdG9yYWdlR2V0RnVuYzogdGhpcy5fc3RvcmFnZVJlc29sdmVyLmdldFN0b3JhZ2VGdW5jLFxuICAgICAgICAgICAgc3RvcmFnZVB1dEZ1bmM6IHRoaXMuX3N0b3JhZ2VSZXNvbHZlci5wdXRTdG9yYWdlRnVuYyxcbiAgICAgICAgICAgIHJlcXVlc3RWYWx1ZXNGb3JKb2luRnVuYzogdGhpcy5fc3RvcmFnZVJlc29sdmVyLnJlcXVlc3RWYWx1ZXNGb3JKb2luRnVuY1xuICAgICAgICB9O1xuICAgIH07XG4gICAgVGlja0NvbnRyb2xsZXIucHJvdG90eXBlLnNldEV4ZWN1dGlvbk1vZGUgPSBmdW5jdGlvbiAoZXhlY01vZGUpIHtcbiAgICAgICAgaWYgKHRoaXMuX2V4ZWN1dGlvbk1vZGUgPT09IGV4ZWNNb2RlKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLl9leGVjdXRpb25Nb2RlID0gZXhlY01vZGU7XG4gICAgICAgIHRoaXMuX3VwZGF0ZUdlbmVyYXRvclN0YXRlKCk7XG4gICAgICAgIHRoaXMuX2J1ZmZlci5zZXRFeGVjdXRpb25Nb2RlKGV4ZWNNb2RlKTtcbiAgICAgICAgdGhpcy5fc3RvcmFnZVJlc29sdmVyLnNldEV4ZWN1dGlvbk1vZGUoZXhlY01vZGUpO1xuICAgIH07XG4gICAgVGlja0NvbnRyb2xsZXIucHJvdG90eXBlLl9zdG9wVHJpZ2dlck9uVGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zdG9wVGljaygpO1xuICAgIH07XG4gICAgVGlja0NvbnRyb2xsZXIucHJvdG90eXBlLl91cGRhdGVHZW5lcmF0b3JTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRvR2VuZXJhdGUgPSAodGhpcy5fc3RhcnRlZCAmJiB0aGlzLl9leGVjdXRpb25Nb2RlID09PSBFeGVjdXRpb25Nb2RlXzEuZGVmYXVsdC5BY3RpdmUpO1xuICAgICAgICB0aGlzLl9nZW5lcmF0b3Iuc3RhcnRTdG9wR2VuZXJhdGUodG9HZW5lcmF0ZSk7XG4gICAgfTtcbiAgICBUaWNrQ29udHJvbGxlci5wcm90b3R5cGUuX29uVGlja0dlbmVyYXRlZCA9IGZ1bmN0aW9uICh0aWNrKSB7XG4gICAgICAgIHRoaXMuX2FtZmxvdy5zZW5kVGljayh0aWNrKTtcbiAgICAgICAgdGhpcy5fYnVmZmVyLmFkZFRpY2sodGljayk7XG4gICAgfTtcbiAgICByZXR1cm4gVGlja0NvbnRyb2xsZXI7XG59KCkpO1xuZXhwb3J0cy5UaWNrQ29udHJvbGxlciA9IFRpY2tDb250cm9sbGVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlRpY2tHZW5lcmF0b3IgPSB2b2lkIDA7XG52YXIgZyA9IHJlcXVpcmUoXCJAYWthc2hpYy9ha2FzaGljLWVuZ2luZVwiKTtcbnZhciBKb2luUmVzb2x2ZXJfMSA9IHJlcXVpcmUoXCIuL0pvaW5SZXNvbHZlclwiKTtcbi8qKlxuICogYHBsYXlsb2cuVGlja2Ag44Gu55Sf5oiQ5Zmo44CCXG4gKiBgbmV4dCgpYCDjgYzlkbzjgbDjgozjgovluqbjgavjgIFFdmVudEJ1ZmZlciDjgavok4TnqY3jgZXjgozjgZ/jgqTjg5njg7Pjg4jjgpLpm4bjgoHjgaZ0aWNr44KS55Sf5oiQ44CBYHRpY2tUcmlnZ2VyYCDjgafpgJrnn6XjgZnjgovjgIJcbiAqL1xudmFyIFRpY2tHZW5lcmF0b3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVGlja0dlbmVyYXRvcihwYXJhbSkge1xuICAgICAgICB0aGlzLnRpY2tUcmlnZ2VyID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICB0aGlzLmdvdFN0b3JhZ2VUcmlnZ2VyID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICB0aGlzLmVycm9yVHJpZ2dlciA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgaWYgKHBhcmFtLmVycm9ySGFuZGxlcilcbiAgICAgICAgICAgIHRoaXMuZXJyb3JUcmlnZ2VyLmFkZChwYXJhbS5lcnJvckhhbmRsZXIsIHBhcmFtLmVycm9ySGFuZGxlck93bmVyKTtcbiAgICAgICAgdGhpcy5fYW1mbG93ID0gcGFyYW0uYW1mbG93O1xuICAgICAgICB0aGlzLl9ldmVudEJ1ZmZlciA9IHBhcmFtLmV2ZW50QnVmZmVyO1xuICAgICAgICB0aGlzLl9qb2luUmVzb2x2ZXIgPSBuZXcgSm9pblJlc29sdmVyXzEuSm9pblJlc29sdmVyKHtcbiAgICAgICAgICAgIGFtZmxvdzogcGFyYW0uYW1mbG93LFxuICAgICAgICAgICAgZXJyb3JIYW5kbGVyOiB0aGlzLmVycm9yVHJpZ2dlci5maXJlLFxuICAgICAgICAgICAgZXJyb3JIYW5kbGVyT3duZXI6IHRoaXMuZXJyb3JUcmlnZ2VyXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9uZXh0QWdlID0gMDtcbiAgICAgICAgdGhpcy5fc3RvcmFnZURhdGFGb3JOZXh0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZ2VuZXJhdGluZ1RpY2sgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fd2FpdGluZ1N0b3JhZ2UgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fb25Hb3RTdG9yYWdlRGF0YV9ib3VuZCA9IHRoaXMuX29uR290U3RvcmFnZURhdGEuYmluZCh0aGlzKTtcbiAgICB9XG4gICAgVGlja0dlbmVyYXRvci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9nZW5lcmF0aW5nVGljayB8fCB0aGlzLl93YWl0aW5nU3RvcmFnZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdmFyIGpvaW5MZWF2ZXMgPSB0aGlzLl9ldmVudEJ1ZmZlci5yZWFkSm9pbkxlYXZlcygpO1xuICAgICAgICBpZiAoam9pbkxlYXZlcykge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBqb2luTGVhdmVzLmxlbmd0aDsgKytpKVxuICAgICAgICAgICAgICAgIHRoaXMuX2pvaW5SZXNvbHZlci5yZXF1ZXN0KGpvaW5MZWF2ZXNbaV0pO1xuICAgICAgICB9XG4gICAgICAgIHZhciBldnMgPSB0aGlzLl9ldmVudEJ1ZmZlci5yZWFkRXZlbnRzKCk7XG4gICAgICAgIHZhciByZXNvbHZlZEpvaW5MZWF2ZXMgPSB0aGlzLl9qb2luUmVzb2x2ZXIucmVhZFJlc29sdmVkKCk7XG4gICAgICAgIGlmIChyZXNvbHZlZEpvaW5MZWF2ZXMpIHtcbiAgICAgICAgICAgIGlmIChldnMpIHtcbiAgICAgICAgICAgICAgICBldnMucHVzaC5hcHBseShldnMsIHJlc29sdmVkSm9pbkxlYXZlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBldnMgPSByZXNvbHZlZEpvaW5MZWF2ZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHNkcyA9IHRoaXMuX3N0b3JhZ2VEYXRhRm9yTmV4dDtcbiAgICAgICAgdGhpcy5fc3RvcmFnZURhdGFGb3JOZXh0ID0gbnVsbDtcbiAgICAgICAgdGhpcy50aWNrVHJpZ2dlci5maXJlKFtcbiAgICAgICAgICAgIHRoaXMuX25leHRBZ2UrKyxcbiAgICAgICAgICAgIGV2cyxcbiAgICAgICAgICAgIHNkcyAvLyAyPzog44K544OI44Os44O844K444OH44O844K/XG4gICAgICAgIF0pO1xuICAgIH07XG4gICAgVGlja0dlbmVyYXRvci5wcm90b3R5cGUuZm9yY2VOZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fd2FpdGluZ1N0b3JhZ2UpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JUcmlnZ2VyLmZpcmUobmV3IEVycm9yKFwiVGlja0dlbmVyYXRvciNmb3JjZU5leHQoKTogY2Fubm90IGdlbmVyYXRlIHRpY2sgd2hpbGUgd2FpdGluZyBzdG9yYWdlLlwiKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG9yaWdWYWx1ZSA9IHRoaXMuX2dlbmVyYXRpbmdUaWNrO1xuICAgICAgICB0aGlzLl9nZW5lcmF0aW5nVGljayA9IHRydWU7XG4gICAgICAgIHRoaXMubmV4dCgpO1xuICAgICAgICB0aGlzLl9nZW5lcmF0aW5nVGljayA9IG9yaWdWYWx1ZTtcbiAgICB9O1xuICAgIFRpY2tHZW5lcmF0b3IucHJvdG90eXBlLnN0YXJ0U3RvcEdlbmVyYXRlID0gZnVuY3Rpb24gKHRvR2VuZXJhdGUpIHtcbiAgICAgICAgdGhpcy5fZ2VuZXJhdGluZ1RpY2sgPSB0b0dlbmVyYXRlO1xuICAgIH07XG4gICAgVGlja0dlbmVyYXRvci5wcm90b3R5cGUuc3RhcnRUaWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9nZW5lcmF0aW5nVGljayA9IHRydWU7XG4gICAgfTtcbiAgICBUaWNrR2VuZXJhdG9yLnByb3RvdHlwZS5zdG9wVGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fZ2VuZXJhdGluZ1RpY2sgPSBmYWxzZTtcbiAgICB9O1xuICAgIFRpY2tHZW5lcmF0b3IucHJvdG90eXBlLnNldE5leHRBZ2UgPSBmdW5jdGlvbiAoYWdlKSB7XG4gICAgICAgIGlmICh0aGlzLl93YWl0aW5nU3RvcmFnZSkge1xuICAgICAgICAgICAgLy8g44Ko44OD44K444Kx44O844K5OiDmrKHjga50aWNr44Gr44K544OI44Os44O844K444KS5LmX44Gb44KL44Gv44Ga44Gg44Gj44Gf44GM44CBYWdl44GM5aSJ44KP44Gj44Gm44GX44G+44GG44Gu44Gn44Gn44GN44Gq44GE44CCXG4gICAgICAgICAgICAvLyBBY3RpdmXjgafjgrnjg4jjg6zjg7zjgrjopoHmsYIo44K344O844Oz5YiH44KK5pu/44GIKeOBl+OBpuW+heOBo+OBpuOBhOOCi+mWk+OBq+OBk+OBk+OBq+adpeOCi+OBqOOBk+OBruODkeOCueOBq+OBi+OBi+OCi+OAglxuICAgICAgICAgICAgLy8g54++5a6f44Gr44GvQWN0aXZl44Gn5a6f6KGM6ZaL5aeL44GX44Gf5b6M44GrYWdl44KS5aSJ44GI44KL44Kx44O844K544Gv5oOz5YOP44GX44Gr44GP44GEKHRpY2vjgYzpo5vjgbPpo5vjgbPjgavjgarjgaPjgZ/jgorph43opIfjgZfjgZ/jgorjgZnjgosp44CCXG4gICAgICAgICAgICB0aGlzLmVycm9yVHJpZ2dlci5maXJlKG5ldyBFcnJvcihcIlRpY2tHZW5lcmF0b3Ijc2V0TmV4dEFnZSgpOiBjYW5ub3QgY2hhbmdlIHRoZSBuZXh0IGFnZSB3aGlsZSB3YWl0aW5nIHN0b3JhZ2UuXCIpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9uZXh0QWdlID0gYWdlO1xuICAgIH07XG4gICAgLyoqXG4gICAgICog5qyh44Gr55Sf5oiQ44GZ44KLdGlja+OBq3N0b3JhZ2VEYXRh44KS5oyB44Gf44Gb44KL44CCXG4gICAgICog5Y+W5b6X44GM5a6M5LqG44GZ44KL44G+44Gn44CB5qyh44GudGlja+OBr+eUn+aIkOOBleOCjOOBquOBhOOAglxuICAgICAqL1xuICAgIFRpY2tHZW5lcmF0b3IucHJvdG90eXBlLnJlcXVlc3RTdG9yYWdlVGljayA9IGZ1bmN0aW9uIChrZXlzKSB7XG4gICAgICAgIGlmICh0aGlzLl93YWl0aW5nU3RvcmFnZSkge1xuICAgICAgICAgICAgdmFyIGVyciA9IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIlRpY2tHZW5lcmF0b3IjcmVxdWVzdFN0b3JhZ2VUaWNrKCk6IFVuc3VwcG9ydGVkOiBtdWx0aXBsZSBzdG9yYWdlIHJlcXVlc3RcIik7XG4gICAgICAgICAgICB0aGlzLmVycm9yVHJpZ2dlci5maXJlKGVycik7XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fd2FpdGluZ1N0b3JhZ2UgPSB0cnVlO1xuICAgICAgICB0aGlzLl9hbWZsb3cuZ2V0U3RvcmFnZURhdGEoa2V5cywgdGhpcy5fb25Hb3RTdG9yYWdlRGF0YV9ib3VuZCk7XG4gICAgICAgIHJldHVybiB0aGlzLl9uZXh0QWdlO1xuICAgIH07XG4gICAgVGlja0dlbmVyYXRvci5wcm90b3R5cGUuc2V0UmVxdWVzdFZhbHVlc0ZvckpvaW4gPSBmdW5jdGlvbiAoa2V5cykge1xuICAgICAgICB0aGlzLl9qb2luUmVzb2x2ZXIuc2V0UmVxdWVzdFZhbHVlc0ZvckpvaW4oa2V5cyk7XG4gICAgfTtcbiAgICBUaWNrR2VuZXJhdG9yLnByb3RvdHlwZS5fb25Hb3RTdG9yYWdlRGF0YSA9IGZ1bmN0aW9uIChlcnIsIHNkcykge1xuICAgICAgICB0aGlzLl93YWl0aW5nU3RvcmFnZSA9IGZhbHNlO1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yVHJpZ2dlci5maXJlKGVycik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fc3RvcmFnZURhdGFGb3JOZXh0ID0gc2RzO1xuICAgICAgICB0aGlzLmdvdFN0b3JhZ2VUcmlnZ2VyLmZpcmUoeyBhZ2U6IHRoaXMuX25leHRBZ2UsIHN0b3JhZ2VEYXRhOiBzZHMgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gVGlja0dlbmVyYXRvcjtcbn0oKSk7XG5leHBvcnRzLlRpY2tHZW5lcmF0b3IgPSBUaWNrR2VuZXJhdG9yO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLl9jbG9uZURlZXAgPSBleHBvcnRzLk1lbW9yeUFtZmxvd0NsaWVudCA9IHZvaWQgMDtcbnZhciBNZW1vcnlBbWZsb3dDbGllbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWVtb3J5QW1mbG93Q2xpZW50KHBhcmFtKSB7XG4gICAgICAgIHRoaXMuX3BsYXlJZCA9IHBhcmFtLnBsYXlJZDtcbiAgICAgICAgdGhpcy5fcHV0U3RvcmFnZURhdGFTeW5jRnVuYyA9IHBhcmFtLnB1dFN0b3JhZ2VEYXRhU3luY0Z1bmMgfHwgKGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IEVycm9yKFwiSW1wbGVtZW50YXRpb24gbm90IGdpdmVuXCIpOyB9KTtcbiAgICAgICAgdGhpcy5fZ2V0U3RvcmFnZURhdGFTeW5jRnVuYyA9IHBhcmFtLmdldFN0b3JhZ2VEYXRhU3luY0Z1bmMgfHwgKGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IEVycm9yKFwiSW1wbGVtZW50YXRpb24gbm90IGdpdmVuXCIpOyB9KTtcbiAgICAgICAgdGhpcy5fdGlja0hhbmRsZXJzID0gW107XG4gICAgICAgIHRoaXMuX2V2ZW50SGFuZGxlcnMgPSBbXTtcbiAgICAgICAgdGhpcy5fZXZlbnRzID0gW107XG4gICAgICAgIHRoaXMuX3RpY2tMaXN0ID0gbnVsbDtcbiAgICAgICAgaWYgKHBhcmFtLnN0YXJ0UG9pbnRzKSB7XG4gICAgICAgICAgICB0aGlzLl90aWNrTGlzdCA9IHBhcmFtLnRpY2tMaXN0O1xuICAgICAgICAgICAgdGhpcy5fc3RhcnRQb2ludHMgPSBwYXJhbS5zdGFydFBvaW50cztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3N0YXJ0UG9pbnRzID0gW107XG4gICAgICAgIH1cbiAgICB9XG4gICAgTWVtb3J5QW1mbG93Q2xpZW50LnByb3RvdHlwZS5kdW1wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGlja0xpc3Q6IHRoaXMuX3RpY2tMaXN0LFxuICAgICAgICAgICAgc3RhcnRQb2ludHM6IHRoaXMuX3N0YXJ0UG9pbnRzXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBNZW1vcnlBbWZsb3dDbGllbnQucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiAocGxheUlkLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChwbGF5SWQgIT09IF90aGlzLl9wbGF5SWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgY2FsbGJhY2sobmV3IEVycm9yKFwiTWVtb3J5QW1mbG93Q2xpZW50I29wZW46IHVua25vd24gcGxheUlkXCIpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwpO1xuICAgICAgICB9LCAwKTtcbiAgICB9O1xuICAgIE1lbW9yeUFtZmxvd0NsaWVudC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IGNhbGxiYWNrKG51bGwpOyB9LCAwKTtcbiAgICB9O1xuICAgIE1lbW9yeUFtZmxvd0NsaWVudC5wcm90b3R5cGUuYXV0aGVudGljYXRlID0gZnVuY3Rpb24gKHRva2VuLCBjYWxsYmFjaykge1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodG9rZW4pIHtcbiAgICAgICAgICAgICAgICBjYXNlIE1lbW9yeUFtZmxvd0NsaWVudC5UT0tFTl9BQ1RJVkU6XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlVGljazogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRUaWNrOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlVGljazogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBzZW5kRXZlbnQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlRXZlbnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhFdmVudFByaW9yaXR5OiAyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIE1lbW9yeUFtZmxvd0NsaWVudC5UT0tFTl9QQVNTSVZFOlxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZVRpY2s6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhZFRpY2s6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpYmVUaWNrOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2VuZEV2ZW50OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlRXZlbnQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4RXZlbnRQcmlvcml0eTogMlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVUaWNrOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhZFRpY2s6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpYmVUaWNrOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2VuZEV2ZW50OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlRXZlbnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhFdmVudFByaW9yaXR5OiAyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgMCk7XG4gICAgfTtcbiAgICBNZW1vcnlBbWZsb3dDbGllbnQucHJvdG90eXBlLnNlbmRUaWNrID0gZnVuY3Rpb24gKHRpY2spIHtcbiAgICAgICAgdGljayA9IF9jbG9uZURlZXAodGljayk7IC8vIOWFg+OBruWApOOBjOW+jOOBi+OCieWkieabtOOBleOCjOOBpuOCguOBhOOBhOOCiOOBhuOBq+OCs+ODlOODvOOBl+OBpuOBiuOBj1xuICAgICAgICBpZiAoIXRoaXMuX3RpY2tMaXN0KSB7XG4gICAgICAgICAgICB0aGlzLl90aWNrTGlzdCA9IFt0aWNrWzAgLyogQWdlICovXSwgdGlja1swIC8qIEFnZSAqL10sIFtdXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIOaXouOBq+WtmOWcqOOBmeOCi1RpY2tMaXN044GuZnJvbX50b+mWk+OBq3RpY2vjgYzmjL/lhaXjgZXjgozjgovjgZPjgajjga/nhKHjgYRcbiAgICAgICAgICAgIGlmICh0aGlzLl90aWNrTGlzdFswIC8qIEZyb20gKi9dIDw9IHRpY2tbMCAvKiBBZ2UgKi9dICYmXG4gICAgICAgICAgICAgICAgdGlja1swIC8qIEFnZSAqL10gPD0gdGhpcy5fdGlja0xpc3RbMSAvKiBUbyAqL10pXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaWxsZWdhbCBhZ2UgdGlja1wiKTtcbiAgICAgICAgICAgIHRoaXMuX3RpY2tMaXN0WzEgLyogVG8gKi9dID0gdGlja1swIC8qIEFnZSAqL107XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCEhdGlja1sxIC8qIEV2ZW50cyAqL10gfHwgISF0aWNrWzIgLyogU3RvcmFnZURhdGEgKi9dKSB7XG4gICAgICAgICAgICBpZiAoISF0aWNrWzEgLyogRXZlbnRzICovXSkge1xuICAgICAgICAgICAgICAgIHRpY2tbMSAvKiBFdmVudHMgKi9dID0gdGlja1sxIC8qIEV2ZW50cyAqL11cbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoZXZlbnQpIHsgcmV0dXJuICEoZXZlbnRbMSAvKiBFdmVudEZsYWdzICovXSAmIDggLyogVHJhbnNpZW50ICovKTsgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl90aWNrTGlzdFsyIC8qIFRpY2tzV2l0aEV2ZW50cyAqL10ucHVzaCh0aWNrKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90aWNrSGFuZGxlcnMuZm9yRWFjaChmdW5jdGlvbiAoaCkgeyByZXR1cm4gaCh0aWNrKTsgfSk7XG4gICAgfTtcbiAgICBNZW1vcnlBbWZsb3dDbGllbnQucHJvdG90eXBlLm9uVGljayA9IGZ1bmN0aW9uIChoYW5kbGVyKSB7XG4gICAgICAgIHRoaXMuX3RpY2tIYW5kbGVycy5wdXNoKGhhbmRsZXIpO1xuICAgIH07XG4gICAgTWVtb3J5QW1mbG93Q2xpZW50LnByb3RvdHlwZS5vZmZUaWNrID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcbiAgICAgICAgdGhpcy5fdGlja0hhbmRsZXJzID0gdGhpcy5fdGlja0hhbmRsZXJzLmZpbHRlcihmdW5jdGlvbiAoaCkgeyByZXR1cm4gKGggIT09IGhhbmRsZXIpOyB9KTtcbiAgICB9O1xuICAgIE1lbW9yeUFtZmxvd0NsaWVudC5wcm90b3R5cGUuc2VuZEV2ZW50ID0gZnVuY3Rpb24gKHBldikge1xuICAgICAgICBwZXYgPSBfY2xvbmVEZWVwKHBldik7IC8vIOWFg+OBruWApOOBjOW+jOOBi+OCieWkieabtOOBleOCjOOBpuOCguOBhOOBhOOCiOOBhuOBq+OCs+ODlOODvOOBl+OBpuOBiuOBj1xuICAgICAgICBpZiAodGhpcy5fZXZlbnRIYW5kbGVycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuX2V2ZW50cy5wdXNoKHBldik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVycy5mb3JFYWNoKGZ1bmN0aW9uIChoKSB7IHJldHVybiBoKHBldik7IH0pO1xuICAgIH07XG4gICAgTWVtb3J5QW1mbG93Q2xpZW50LnByb3RvdHlwZS5vbkV2ZW50ID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVycy5wdXNoKGhhbmRsZXIpO1xuICAgICAgICBpZiAodGhpcy5fZXZlbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuX2V2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChwZXYpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5fZXZlbnRIYW5kbGVycy5mb3JFYWNoKGZ1bmN0aW9uIChoKSB7IHJldHVybiBoKHBldik7IH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLl9ldmVudHMgPSBbXTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgTWVtb3J5QW1mbG93Q2xpZW50LnByb3RvdHlwZS5vZmZFdmVudCA9IGZ1bmN0aW9uIChoYW5kbGVyKSB7XG4gICAgICAgIHRoaXMuX2V2ZW50SGFuZGxlcnMgPSB0aGlzLl9ldmVudEhhbmRsZXJzLmZpbHRlcihmdW5jdGlvbiAoaCkgeyByZXR1cm4gKGggIT09IGhhbmRsZXIpOyB9KTtcbiAgICB9O1xuICAgIE1lbW9yeUFtZmxvd0NsaWVudC5wcm90b3R5cGUuZ2V0VGlja0xpc3QgPSBmdW5jdGlvbiAob3B0c09yQmVnaW4sIGVuZE9yQ2FsbGJhY2ssIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICghdGhpcy5fdGlja0xpc3QpXG4gICAgICAgICAgICByZXR1cm4gdm9pZCBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNhbGxiYWNrKG51bGwsIG51bGwpOyB9LCAwKTtcbiAgICAgICAgLy8gVE9ETzogQGFrYXNoaWMvYW1mbG93QDMuMC4wIOi/veW+k1xuICAgICAgICBpZiAodHlwZW9mIG9wdHNPckJlZ2luICE9PSBcIm51bWJlclwiIHx8XG4gICAgICAgICAgICB0eXBlb2YgZW5kT3JDYWxsYmFjayAhPT0gXCJudW1iZXJcIiB8fFxuICAgICAgICAgICAgdHlwZW9mIGNhbGxiYWNrICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZW5kT3JDYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgZW5kT3JDYWxsYmFjayhuZXcgRXJyb3IoXCJub3QgaW1wbGVtZW50ZWRcIikpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIm5vdCBpbXBsZW1lbnRlZFwiKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZnJvbSA9IE1hdGgubWF4KG9wdHNPckJlZ2luLCB0aGlzLl90aWNrTGlzdFswIC8qIEZyb20gKi9dKTtcbiAgICAgICAgdmFyIHRvID0gTWF0aC5taW4oZW5kT3JDYWxsYmFjaywgdGhpcy5fdGlja0xpc3RbMSAvKiBUbyAqL10pO1xuICAgICAgICB2YXIgdGlja3MgPSB0aGlzLl90aWNrTGlzdFsyIC8qIFRpY2tzV2l0aEV2ZW50cyAqL10uZmlsdGVyKGZ1bmN0aW9uICh0aWNrKSB7XG4gICAgICAgICAgICB2YXIgYWdlID0gdGlja1swIC8qIEFnZSAqL107XG4gICAgICAgICAgICByZXR1cm4gZnJvbSA8PSBhZ2UgJiYgYWdlIDw9IHRvO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIHRpY2tMaXN0ID0gW2Zyb20sIHRvLCB0aWNrc107XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gY2FsbGJhY2sobnVsbCwgdGlja0xpc3QpOyB9LCAwKTtcbiAgICB9O1xuICAgIE1lbW9yeUFtZmxvd0NsaWVudC5wcm90b3R5cGUucHV0U3RhcnRQb2ludCA9IGZ1bmN0aW9uIChzdGFydFBvaW50LCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLl9zdGFydFBvaW50cy5wdXNoKHN0YXJ0UG9pbnQpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgICAgIH0sIDApO1xuICAgIH07XG4gICAgTWVtb3J5QW1mbG93Q2xpZW50LnByb3RvdHlwZS5nZXRTdGFydFBvaW50ID0gZnVuY3Rpb24gKG9wdHMsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCFfdGhpcy5fc3RhcnRQb2ludHMgfHwgX3RoaXMuX3N0YXJ0UG9pbnRzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCBjYWxsYmFjayhuZXcgRXJyb3IoXCJubyBzdGFydHBvaW50XCIpKTtcbiAgICAgICAgICAgIHZhciBpbmRleCA9IDA7XG4gICAgICAgICAgICBpZiAob3B0cy5mcmFtZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5lYXJlc3RGcmFtZSA9IF90aGlzLl9zdGFydFBvaW50c1swXS5mcmFtZTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IF90aGlzLl9zdGFydFBvaW50cy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZnJhbWUgPSBfdGhpcy5fc3RhcnRQb2ludHNbaV0uZnJhbWU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmcmFtZSA8PSBvcHRzLmZyYW1lICYmIG5lYXJlc3RGcmFtZSA8IGZyYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZWFyZXN0RnJhbWUgPSBmcmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ID0gaTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBuZWFyZXN0VGltZXN0YW1wID0gX3RoaXMuX3N0YXJ0UG9pbnRzWzBdLnRpbWVzdGFtcDtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IF90aGlzLl9zdGFydFBvaW50cy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGltZXN0YW1wID0gX3RoaXMuX3N0YXJ0UG9pbnRzW2ldLnRpbWVzdGFtcDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVzdGFtcCA8PSBvcHRzLnRpbWVzdGFtcCAmJiBuZWFyZXN0VGltZXN0YW1wIDwgdGltZXN0YW1wKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZWFyZXN0VGltZXN0YW1wID0gdGltZXN0YW1wO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgX3RoaXMuX3N0YXJ0UG9pbnRzW2luZGV4XSk7XG4gICAgICAgIH0sIDApO1xuICAgIH07XG4gICAgTWVtb3J5QW1mbG93Q2xpZW50LnByb3RvdHlwZS5wdXRTdG9yYWdlRGF0YSA9IGZ1bmN0aW9uIChrZXksIHZhbHVlLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX3B1dFN0b3JhZ2VEYXRhU3luY0Z1bmMoa2V5LCB2YWx1ZSwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAwKTtcbiAgICB9O1xuICAgIE1lbW9yeUFtZmxvd0NsaWVudC5wcm90b3R5cGUuZ2V0U3RvcmFnZURhdGEgPSBmdW5jdGlvbiAoa2V5cywgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gX3RoaXMuX2dldFN0b3JhZ2VEYXRhU3luY0Z1bmMoa2V5cyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAwKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOS4juOBiOOCieOCjOOBpuOBhOOBn+ODhuOCo+ODg+OCr+ODquOCueODiOOCkumDqOWIhueahOOBq+egtOajhOOBmeOCi+OAglxuICAgICAqIEBwYXJhbSBhZ2Ug44OG44Kj44OD44Kv44KS56C05qOE44GZ44KL5Z+65rqW44GuYWdlKOOBk+OBrmFnZeOBruODhuOCo+ODg+OCr+OCguegtOajhOOBleOCjOOCiylcbiAgICAgKi9cbiAgICBNZW1vcnlBbWZsb3dDbGllbnQucHJvdG90eXBlLmRyb3BBZnRlciA9IGZ1bmN0aW9uIChhZ2UpIHtcbiAgICAgICAgaWYgKCF0aGlzLl90aWNrTGlzdClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdmFyIGZyb20gPSB0aGlzLl90aWNrTGlzdFswIC8qIEZyb20gKi9dO1xuICAgICAgICB2YXIgdG8gPSB0aGlzLl90aWNrTGlzdFsxIC8qIFRvICovXTtcbiAgICAgICAgaWYgKGFnZSA8PSBmcm9tKSB7XG4gICAgICAgICAgICB0aGlzLl90aWNrTGlzdCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLl9zdGFydFBvaW50cyA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGFnZSA8PSB0bykge1xuICAgICAgICAgICAgdGhpcy5fdGlja0xpc3RbMSAvKiBUbyAqL10gPSBhZ2UgLSAxO1xuICAgICAgICAgICAgdGhpcy5fdGlja0xpc3RbMiAvKiBUaWNrc1dpdGhFdmVudHMgKi9dID0gdGhpcy5fdGlja0xpc3RbMiAvKiBUaWNrc1dpdGhFdmVudHMgKi9dLmZpbHRlcihmdW5jdGlvbiAodGljaykge1xuICAgICAgICAgICAgICAgIHZhciB0YSA9IHRpY2tbMCAvKiBBZ2UgKi9dO1xuICAgICAgICAgICAgICAgIHJldHVybiBmcm9tIDw9IHRhICYmIHRhIDw9IChhZ2UgLSAxKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5fc3RhcnRQb2ludHMgPSB0aGlzLl9zdGFydFBvaW50cy5maWx0ZXIoZnVuY3Rpb24gKHNwKSB7IHJldHVybiBzcC5mcmFtZSA8IGFnZTsgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGB3cml0ZVRpY2tgIOaoqemZkOOCkuaMgeOBpOODiOODvOOCr+ODs+OAglxuICAgICAqIOOBk+OBruWApOOBryBhdXRoZW50aWNhdGUoKSDjga7mjJnli5Xku6XlpJbjga/lpInmm7TjgZfjgarjgYTjgIJcbiAgICAgKiDku5bjg6Hjgr3jg4Pjg4koc2VuZEV2ZW50KCnjgarjgakp44Gu5ZG844Gz5Ye644GX44GvKOaoqemZkOOBq+WPjeOBl+OBpuOBhOOBpuOCginjgqjjg6njg7zjgpLotbfjgZPjgZnjgajjga/pmZDjgonjgarjgYTjgIJcbiAgICAgKi9cbiAgICBNZW1vcnlBbWZsb3dDbGllbnQuVE9LRU5fQUNUSVZFID0gXCJtYW1mYy10b2tlbjphY3RpdmVcIjtcbiAgICAvKipcbiAgICAgKiBgc3Vic2NyaWJlVGlja2Ag5qip6ZmQ44KS5oyB44Gk44OI44O844Kv44Oz44CCXG4gICAgICog44GT44Gu5YCk44GvIGF1dGhlbnRpY2F0ZSgpIOOBruaMmeWLleS7peWkluOBr+WkieabtOOBl+OBquOBhOOAglxuICAgICAqIOS7luODoeOCveODg+ODiShzZW5kVGljaygp44Gq44GpKeOBruWRvOOBs+WHuuOBl+OBryjmqKnpmZDjgavlj43jgZfjgabjgYTjgabjgoIp44Ko44Op44O844KS6LW344GT44GZ44Go44Gv6ZmQ44KJ44Gq44GE44CCXG4gICAgICovXG4gICAgTWVtb3J5QW1mbG93Q2xpZW50LlRPS0VOX1BBU1NJVkUgPSBcIm1hbWZjLXRva2VuOnBhc3NpdmVcIjtcbiAgICByZXR1cm4gTWVtb3J5QW1mbG93Q2xpZW50O1xufSgpKTtcbmV4cG9ydHMuTWVtb3J5QW1mbG93Q2xpZW50ID0gTWVtb3J5QW1mbG93Q2xpZW50O1xuZnVuY3Rpb24gX2Nsb25lRGVlcCh2KSB7XG4gICAgaWYgKHYgJiYgdHlwZW9mIHYgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodikpIHtcbiAgICAgICAgICAgIHJldHVybiB2Lm1hcChfY2xvbmVEZWVwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh2KS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgaykgeyByZXR1cm4gKGFjY1trXSA9IF9jbG9uZURlZXAodltrXSksIGFjYyk7IH0sIHt9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdjtcbn1cbmV4cG9ydHMuX2Nsb25lRGVlcCA9IF9jbG9uZURlZXA7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuUmVwbGF5QW1mbG93UHJveHkgPSB2b2lkIDA7XG52YXIgUmVwbGF5QW1mbG93UHJveHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUmVwbGF5QW1mbG93UHJveHkocGFyYW0pIHtcbiAgICAgICAgdGhpcy5fYW1mbG93ID0gcGFyYW0uYW1mbG93O1xuICAgICAgICB0aGlzLl90aWNrTGlzdCA9IHBhcmFtLnRpY2tMaXN0O1xuICAgICAgICB0aGlzLl9zdGFydFBvaW50cyA9IHBhcmFtLnN0YXJ0UG9pbnRzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiDkuI7jgYjjgonjgozjgabjgYTjgZ/jg4bjgqPjg4Pjgq/jg6rjgrnjg4jjgpLpg6jliIbnmoTjgavnoLTmo4TjgZnjgovjgIJcbiAgICAgKiBSZXBsYXlBbWZsb3dQcm94eSDjga7ni6zoh6rjg6Hjgr3jg4Pjg4njgIJcbiAgICAgKiBAcGFyYW0gYWdlIOODhuOCo+ODg+OCr+OCkuegtOajhOOBmeOCi+Wfuua6luOBrmFnZSjjgZPjga5hZ2Xjga7jg4bjgqPjg4Pjgq/jgoLnoLTmo4TjgZXjgozjgospXG4gICAgICovXG4gICAgUmVwbGF5QW1mbG93UHJveHkucHJvdG90eXBlLmRyb3BBZnRlciA9IGZ1bmN0aW9uIChhZ2UpIHtcbiAgICAgICAgaWYgKCF0aGlzLl90aWNrTGlzdClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdmFyIGdpdmVuRnJvbSA9IHRoaXMuX3RpY2tMaXN0WzAgLyogRnJvbSAqL107XG4gICAgICAgIHZhciBnaXZlblRvID0gdGhpcy5fdGlja0xpc3RbMSAvKiBUbyAqL107XG4gICAgICAgIHZhciBnaXZlblRpY2tzV2l0aEV2ZW50cyA9IHRoaXMuX3RpY2tMaXN0WzIgLyogVGlja3NXaXRoRXZlbnRzICovXTtcbiAgICAgICAgaWYgKGFnZSA8PSBnaXZlbkZyb20pIHtcbiAgICAgICAgICAgIHRoaXMuX3RpY2tMaXN0ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuX3N0YXJ0UG9pbnRzID0gW107XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYWdlIDw9IGdpdmVuVG8pIHtcbiAgICAgICAgICAgIHRoaXMuX3RpY2tMaXN0WzEgLyogVG8gKi9dID0gYWdlIC0gMTtcbiAgICAgICAgICAgIHRoaXMuX3RpY2tMaXN0WzIgLyogVGlja3NXaXRoRXZlbnRzICovXSA9IHRoaXMuX3NsaWNlVGlja3MoZ2l2ZW5UaWNrc1dpdGhFdmVudHMsIGdpdmVuVG8sIGFnZSAtIDEpO1xuICAgICAgICAgICAgdGhpcy5fc3RhcnRQb2ludHMgPSB0aGlzLl9zdGFydFBvaW50cy5maWx0ZXIoZnVuY3Rpb24gKHNwKSB7IHJldHVybiBzcC5mcmFtZSA8IGFnZTsgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFJlcGxheUFtZmxvd1Byb3h5LnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gKHBsYXlJZCwgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fYW1mbG93Lm9wZW4ocGxheUlkLCBjYWxsYmFjayk7XG4gICAgfTtcbiAgICBSZXBsYXlBbWZsb3dQcm94eS5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fYW1mbG93LmNsb3NlKGNhbGxiYWNrKTtcbiAgICB9O1xuICAgIFJlcGxheUFtZmxvd1Byb3h5LnByb3RvdHlwZS5hdXRoZW50aWNhdGUgPSBmdW5jdGlvbiAodG9rZW4sIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2FtZmxvdy5hdXRoZW50aWNhdGUodG9rZW4sIGNhbGxiYWNrKTtcbiAgICB9O1xuICAgIFJlcGxheUFtZmxvd1Byb3h5LnByb3RvdHlwZS5zZW5kVGljayA9IGZ1bmN0aW9uICh0aWNrKSB7XG4gICAgICAgIHRoaXMuX2FtZmxvdy5zZW5kVGljayh0aWNrKTtcbiAgICB9O1xuICAgIFJlcGxheUFtZmxvd1Byb3h5LnByb3RvdHlwZS5vblRpY2sgPSBmdW5jdGlvbiAoaGFuZGxlcikge1xuICAgICAgICB0aGlzLl9hbWZsb3cub25UaWNrKGhhbmRsZXIpO1xuICAgIH07XG4gICAgUmVwbGF5QW1mbG93UHJveHkucHJvdG90eXBlLm9mZlRpY2sgPSBmdW5jdGlvbiAoaGFuZGxlcikge1xuICAgICAgICB0aGlzLl9hbWZsb3cub2ZmVGljayhoYW5kbGVyKTtcbiAgICB9O1xuICAgIFJlcGxheUFtZmxvd1Byb3h5LnByb3RvdHlwZS5zZW5kRXZlbnQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdGhpcy5fYW1mbG93LnNlbmRFdmVudChldmVudCk7XG4gICAgfTtcbiAgICBSZXBsYXlBbWZsb3dQcm94eS5wcm90b3R5cGUub25FdmVudCA9IGZ1bmN0aW9uIChoYW5kbGVyKSB7XG4gICAgICAgIHRoaXMuX2FtZmxvdy5vbkV2ZW50KGhhbmRsZXIpO1xuICAgIH07XG4gICAgUmVwbGF5QW1mbG93UHJveHkucHJvdG90eXBlLm9mZkV2ZW50ID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcbiAgICAgICAgdGhpcy5fYW1mbG93Lm9mZkV2ZW50KGhhbmRsZXIpO1xuICAgIH07XG4gICAgUmVwbGF5QW1mbG93UHJveHkucHJvdG90eXBlLmdldFRpY2tMaXN0ID0gZnVuY3Rpb24gKG9wdHNPckJlZ2luLCBlbmRPckNhbGxiYWNrLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAvLyBUT0RPOiBAYWthc2hpYy9hbWZsb3dAMy4wLjAg6L+95b6TXG4gICAgICAgIGlmICh0eXBlb2Ygb3B0c09yQmVnaW4gIT09IFwibnVtYmVyXCIgfHxcbiAgICAgICAgICAgIHR5cGVvZiBlbmRPckNhbGxiYWNrICE9PSBcIm51bWJlclwiIHx8XG4gICAgICAgICAgICB0eXBlb2YgY2FsbGJhY2sgIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBlbmRPckNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICBlbmRPckNhbGxiYWNrKG5ldyBFcnJvcihcIm5vdCBpbXBsZW1lbnRlZFwiKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwibm90IGltcGxlbWVudGVkXCIpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBmcm9tID0gb3B0c09yQmVnaW47XG4gICAgICAgIHZhciB0byA9IGVuZE9yQ2FsbGJhY2s7XG4gICAgICAgIGlmICghdGhpcy5fdGlja0xpc3QpIHtcbiAgICAgICAgICAgIC8vIFRPRE86IOW+jOaWueS6kuaPm+aAp+OBruOBn+OCgeaXp+OCpOODs+OCv+ODleOCp+ODvOOCueOCkuS4gOaZgueahOOBq+WIqeeUqOOBmeOCi1xuICAgICAgICAgICAgdGhpcy5fYW1mbG93LmdldFRpY2tMaXN0KGZyb20sIHRvLCBjYWxsYmFjayk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGdpdmVuRnJvbSA9IHRoaXMuX3RpY2tMaXN0WzAgLyogRnJvbSAqL107XG4gICAgICAgIHZhciBnaXZlblRvID0gdGhpcy5fdGlja0xpc3RbMSAvKiBUbyAqL107XG4gICAgICAgIHZhciBnaXZlblRpY2tzV2l0aEV2ZW50cyA9IHRoaXMuX3RpY2tMaXN0WzIgLyogVGlja3NXaXRoRXZlbnRzICovXTtcbiAgICAgICAgdmFyIGZyb21JbkdpdmVuID0gZ2l2ZW5Gcm9tIDw9IGZyb20gJiYgZnJvbSA8PSBnaXZlblRvO1xuICAgICAgICB2YXIgdG9JbkdpdmVuID0gZ2l2ZW5Gcm9tIDw9IHRvICYmIHRvIDw9IGdpdmVuVG87XG4gICAgICAgIGlmIChmcm9tSW5HaXZlbiAmJiB0b0luR2l2ZW4pIHsgLy8g5omL5oyB44Gh44GM6KaB5rGC56+E5Zuy44KS5YyF5ZCrXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBbZnJvbSwgdG8sIF90aGlzLl9zbGljZVRpY2tzKGdpdmVuVGlja3NXaXRoRXZlbnRzLCBmcm9tLCB0byldKTtcbiAgICAgICAgICAgIH0sIDApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fYW1mbG93LmdldFRpY2tMaXN0KGZyb20sIHRvLCBmdW5jdGlvbiAoZXJyLCB0aWNrTGlzdCkge1xuICAgICAgICAgICAgICAgIGlmIChlcnIpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAgICAgaWYgKCF0aWNrTGlzdCkge1xuICAgICAgICAgICAgICAgICAgICAvLyDkvZXjgoLlvpfjgonjgozjgarjgYvjgaPjgZ/jgILmiYvmjIHjgaHjga7ph43opIfnr4Tlm7LjgpLov5TjgZnjgaDjgZHjgIJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmcm9tSW5HaXZlbiAmJiAhdG9JbkdpdmVuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG8gPCBnaXZlbkZyb20gfHwgZ2l2ZW5UbyA8IGZyb20pIHsgLy8g6YeN6KSH44Gq44GXXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdGlja0xpc3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7IC8vIOimgeaxguevhOWbsuOBjOaJi+aMgeOBoeOCkuWMheWQq1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIFtnaXZlbkZyb20sIGdpdmVuVG8sIF90aGlzLl9zbGljZVRpY2tzKGdpdmVuVGlja3NXaXRoRXZlbnRzLCBmcm9tLCB0byldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChmcm9tSW5HaXZlbikgeyAvLyDliY3ljYrph43opIdcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIFtmcm9tLCBnaXZlblRvLCBfdGhpcy5fc2xpY2VUaWNrcyhnaXZlblRpY2tzV2l0aEV2ZW50cywgZnJvbSwgdG8pXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7IC8vIOW+jOWNiumHjeikh1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgW2dpdmVuRnJvbSwgdG8sIF90aGlzLl9zbGljZVRpY2tzKGdpdmVuVGlja3NXaXRoRXZlbnRzLCBmcm9tLCB0byldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8g5L2V44GL44Gv5b6X44KJ44KM44Gf44CC5omL5oyB44Gh44Go44Oe44O844K444GZ44KL44CCXG4gICAgICAgICAgICAgICAgICAgIGlmICghZnJvbUluR2l2ZW4gJiYgIXRvSW5HaXZlbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvIDwgZ2l2ZW5Gcm9tIHx8IGdpdmVuVG8gPCBmcm9tKSB7IC8vIOmHjeikh+OBquOBl1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHRpY2tMaXN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyDopoHmsYLnr4Tlm7LjgYzmiYvmjIHjgaHjgpLljIXlkKtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGlja3NXaXRoRXZlbnRzID0gdGlja0xpc3RbMiAvKiBUaWNrc1dpdGhFdmVudHMgKi9dO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aWNrc1dpdGhFdmVudHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJlZm9yZUdpdmVuID0gX3RoaXMuX3NsaWNlVGlja3ModGlja3NXaXRoRXZlbnRzLCBmcm9tLCBnaXZlbkZyb20gLSAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFmdGVyR2l2ZW4gPSBfdGhpcy5fc2xpY2VUaWNrcyh0aWNrc1dpdGhFdmVudHMsIGdpdmVuVG8gKyAxLCB0byk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tzV2l0aEV2ZW50cyA9IGJlZm9yZUdpdmVuLmNvbmNhdChnaXZlblRpY2tzV2l0aEV2ZW50cywgYWZ0ZXJHaXZlbik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWNrc1dpdGhFdmVudHMgPSBnaXZlblRpY2tzV2l0aEV2ZW50cztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgW2Zyb20sIHRvLCB0aWNrc1dpdGhFdmVudHNdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChmcm9tSW5HaXZlbikgeyAvLyDliY3ljYrph43opIdcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aWNrc1dpdGhFdmVudHMgPSBfdGhpcy5fc2xpY2VUaWNrcyhnaXZlblRpY2tzV2l0aEV2ZW50cywgZnJvbSwgdG8pLmNvbmNhdCh0aWNrTGlzdFsyIC8qIFRpY2tzV2l0aEV2ZW50cyAqL10gfHwgW10pO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgW2Zyb20sIHRpY2tMaXN0WzEgLyogVG8gKi9dLCB0aWNrc1dpdGhFdmVudHNdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHsgLy8g5b6M5Y2K6YeN6KSHXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGlja3NXaXRoRXZlbnRzID0gKHRpY2tMaXN0WzIgLyogVGlja3NXaXRoRXZlbnRzICovXSB8fCBbXSkuY29uY2F0KF90aGlzLl9zbGljZVRpY2tzKGdpdmVuVGlja3NXaXRoRXZlbnRzLCBmcm9tLCB0bykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgW3RpY2tMaXN0WzAgLyogRnJvbSAqL10sIHRvLCB0aWNrc1dpdGhFdmVudHNdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBSZXBsYXlBbWZsb3dQcm94eS5wcm90b3R5cGUucHV0U3RhcnRQb2ludCA9IGZ1bmN0aW9uIChzdGFydFBvaW50LCBjYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9hbWZsb3cucHV0U3RhcnRQb2ludChzdGFydFBvaW50LCBjYWxsYmFjayk7XG4gICAgfTtcbiAgICBSZXBsYXlBbWZsb3dQcm94eS5wcm90b3R5cGUuZ2V0U3RhcnRQb2ludCA9IGZ1bmN0aW9uIChvcHRzLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgaW5kZXggPSAwO1xuICAgICAgICBpZiAodGhpcy5fc3RhcnRQb2ludHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgaWYgKG9wdHMuZnJhbWUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBuZWFyZXN0RnJhbWUgPSB0aGlzLl9zdGFydFBvaW50c1swXS5mcmFtZTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHRoaXMuX3N0YXJ0UG9pbnRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmcmFtZSA9IHRoaXMuX3N0YXJ0UG9pbnRzW2ldLmZyYW1lO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZnJhbWUgPD0gb3B0cy5mcmFtZSAmJiBuZWFyZXN0RnJhbWUgPCBmcmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmVhcmVzdEZyYW1lID0gZnJhbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgbmVhcmVzdFRpbWVzdGFtcCA9IHRoaXMuX3N0YXJ0UG9pbnRzWzBdLnRpbWVzdGFtcDtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHRoaXMuX3N0YXJ0UG9pbnRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0aW1lc3RhbXAgPSB0aGlzLl9zdGFydFBvaW50c1tpXS50aW1lc3RhbXA7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aW1lc3RhbXAgPD0gb3B0cy50aW1lc3RhbXAgJiYgbmVhcmVzdFRpbWVzdGFtcCA8IHRpbWVzdGFtcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmVhcmVzdFRpbWVzdGFtcCA9IHRpbWVzdGFtcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ID0gaTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgZ2l2ZW5UbyA9IHRoaXMuX3RpY2tMaXN0ID8gdGhpcy5fdGlja0xpc3RbMSAvKiBUbyAqL10gOiAtMTtcbiAgICAgICAgaWYgKG9wdHMuZnJhbWUgPiBnaXZlblRvKSB7XG4gICAgICAgICAgICB0aGlzLl9hbWZsb3cuZ2V0U3RhcnRQb2ludChvcHRzLCBmdW5jdGlvbiAoZXJyLCBzdGFydFBvaW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChnaXZlblRvIDwgc3RhcnRQb2ludC5mcmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBzdGFydFBvaW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIOS4juOBiOOCieOCjOOBn+ODhuOCo+ODg+OCr+ODquOCueODiOOBruevhOWbsuWGheOBruOCueOCv+ODvOODiOODneOCpOODs+ODiOOBjOimi+OBpOOBi+OBo+OBn+OBqOOBl+OBpuOCguOBquOBi+OBo+OBn+OBi+OBruOCiOOBhuOBq+aMr+OCi+iInuOBhlxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBfdGhpcy5fc3RhcnRQb2ludHNbaW5kZXhdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIF90aGlzLl9zdGFydFBvaW50c1tpbmRleF0pO1xuICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFJlcGxheUFtZmxvd1Byb3h5LnByb3RvdHlwZS5wdXRTdG9yYWdlRGF0YSA9IGZ1bmN0aW9uIChrZXksIHZhbHVlLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9hbWZsb3cucHV0U3RvcmFnZURhdGEoa2V5LCB2YWx1ZSwgb3B0aW9ucywgY2FsbGJhY2spO1xuICAgIH07XG4gICAgUmVwbGF5QW1mbG93UHJveHkucHJvdG90eXBlLmdldFN0b3JhZ2VEYXRhID0gZnVuY3Rpb24gKGtleXMsIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2FtZmxvdy5nZXRTdG9yYWdlRGF0YShrZXlzLCBjYWxsYmFjayk7XG4gICAgfTtcbiAgICBSZXBsYXlBbWZsb3dQcm94eS5wcm90b3R5cGUuX3NsaWNlVGlja3MgPSBmdW5jdGlvbiAodGlja3MsIGZyb20sIHRvKSB7XG4gICAgICAgIHJldHVybiB0aWNrcy5maWx0ZXIoZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHZhciBhZ2UgPSB0WzAgLyogQWdlICovXTtcbiAgICAgICAgICAgIHJldHVybiBmcm9tIDw9IGFnZSAmJiBhZ2UgPD0gdG87XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcmV0dXJuIFJlcGxheUFtZmxvd1Byb3h5O1xufSgpKTtcbmV4cG9ydHMuUmVwbGF5QW1mbG93UHJveHkgPSBSZXBsYXlBbWZsb3dQcm94eTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5TaW1wbGVQcm9maWxlciA9IHZvaWQgMDtcbnZhciBnID0gcmVxdWlyZShcIkBha2FzaGljL2FrYXNoaWMtZW5naW5lXCIpO1xudmFyIFNpbXBsZVByb2ZpbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFNpbXBsZVByb2ZpbGVyKHBhcmFtKSB7XG4gICAgICAgIHRoaXMuX2ludGVydmFsID0gcGFyYW0uaW50ZXJ2YWwgIT0gbnVsbCA/IHBhcmFtLmludGVydmFsIDogU2ltcGxlUHJvZmlsZXIuREVGQVVMVF9JTlRFUlZBTDtcbiAgICAgICAgaWYgKHBhcmFtLmxpbWl0ICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuX2xpbWl0ID0gcGFyYW0ubGltaXQgPj0gU2ltcGxlUHJvZmlsZXIuREVGQVVMVF9MSU1JVCA/IHBhcmFtLmxpbWl0IDogU2ltcGxlUHJvZmlsZXIuREVGQVVMVF9MSU1JVDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2xpbWl0ID0gU2ltcGxlUHJvZmlsZXIuREVGQVVMVF9MSU1JVDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jYWxjdWxhdGVQcm9maWxlclZhbHVlVHJpZ2dlciA9IG5ldyBnLlRyaWdnZXIoKTtcbiAgICAgICAgaWYgKHBhcmFtLmdldFZhbHVlSGFuZGxlcikge1xuICAgICAgICAgICAgdGhpcy5fY2FsY3VsYXRlUHJvZmlsZXJWYWx1ZVRyaWdnZXIuYWRkKHBhcmFtLmdldFZhbHVlSGFuZGxlciwgcGFyYW0uZ2V0VmFsdWVIYW5kbGVyT3duZXIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Jlc2V0KCk7XG4gICAgfVxuICAgIFNpbXBsZVByb2ZpbGVyLnByb3RvdHlwZS50aW1lID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgdGhpcy5fYmVmb3JlVGltZXNbdHlwZV0gPSB0aGlzLl9nZXRDdXJyZW50VGltZSgpO1xuICAgIH07XG4gICAgU2ltcGxlUHJvZmlsZXIucHJvdG90eXBlLnRpbWVFbmQgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICB2YXIgbm93ID0gdGhpcy5fZ2V0Q3VycmVudFRpbWUoKTtcbiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5fYmVmb3JlVGltZXNbdHlwZV0gIT0gbnVsbCA/IG5vdyAtIHRoaXMuX2JlZm9yZVRpbWVzW3R5cGVdIDogMDtcbiAgICAgICAgdGhpcy5fdmFsdWVzW3R5cGVdLnB1c2goe1xuICAgICAgICAgICAgdGltZTogbm93LFxuICAgICAgICAgICAgdmFsdWU6IHZhbHVlXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU2ltcGxlUHJvZmlsZXIucHJvdG90eXBlLmZsdXNoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbm93ID0gdGhpcy5fZ2V0Q3VycmVudFRpbWUoKTtcbiAgICAgICAgaWYgKHRoaXMuX2JlZm9yZUZsdXNoVGltZSA9PT0gMClcbiAgICAgICAgICAgIHRoaXMuX2JlZm9yZUZsdXNoVGltZSA9IG5vdztcbiAgICAgICAgaWYgKHRoaXMuX2JlZm9yZUZsdXNoVGltZSArIHRoaXMuX2ludGVydmFsIDwgbm93KSB7XG4gICAgICAgICAgICB0aGlzLl9jYWxjdWxhdGVQcm9maWxlclZhbHVlVHJpZ2dlci5maXJlKHRoaXMuZ2V0UHJvZmlsZXJWYWx1ZSh0aGlzLl9pbnRlcnZhbCkpO1xuICAgICAgICAgICAgdGhpcy5fYmVmb3JlRmx1c2hUaW1lID0gbm93O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl92YWx1ZXNbMSAvKiBSYXdGcmFtZUludGVydmFsICovXS5sZW5ndGggPiB0aGlzLl9saW1pdCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLl92YWx1ZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fdmFsdWVzLmhhc093blByb3BlcnR5KGkpKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl92YWx1ZXNbaV0gPSB0aGlzLl92YWx1ZXNbaV0uc2xpY2UoLVNpbXBsZVByb2ZpbGVyLkJBQ0tVUF9NQVJHSU4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBTaW1wbGVQcm9maWxlci5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiAodHlwZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5fdmFsdWVzW3R5cGVdLnB1c2goe1xuICAgICAgICAgICAgdGltZTogdGhpcy5fZ2V0Q3VycmVudFRpbWUoKSxcbiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOePvuWcqOaZguWIu+OBi+OCieOAgeaMh+WumuOBl+OBn+aZgumWk+OBvuOBp+OCkumBoeOBo+OBn+acn+mWk+OBriBgU2ltcGxlUHJvZmlsZXJWYWx1ZWAg44KS5Y+W5b6X44GZ44KL44CCXG4gICAgICovXG4gICAgU2ltcGxlUHJvZmlsZXIucHJvdG90eXBlLmdldFByb2ZpbGVyVmFsdWUgPSBmdW5jdGlvbiAodGltZSkge1xuICAgICAgICB2YXIgcmF3RnJhbWVJbnRlcnZhbCA9IHRoaXMuX2NhbGN1bGF0ZVByb2ZpbGVyVmFsdWUoMSAvKiBSYXdGcmFtZUludGVydmFsICovLCB0aW1lKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNraXBwZWRGcmFtZUNvdW50OiB0aGlzLl9jYWxjdWxhdGVQcm9maWxlclZhbHVlKDAgLyogU2tpcHBlZEZyYW1lQ291bnQgKi8sIHRpbWUpLFxuICAgICAgICAgICAgcmF3RnJhbWVJbnRlcnZhbDogcmF3RnJhbWVJbnRlcnZhbCxcbiAgICAgICAgICAgIGZyYW1lUGVyU2Vjb25kOiB7XG4gICAgICAgICAgICAgICAgYXZlOiAxMDAwIC8gcmF3RnJhbWVJbnRlcnZhbC5hdmUsXG4gICAgICAgICAgICAgICAgbWF4OiAxMDAwIC8gcmF3RnJhbWVJbnRlcnZhbC5taW4sXG4gICAgICAgICAgICAgICAgbWluOiAxMDAwIC8gcmF3RnJhbWVJbnRlcnZhbC5tYXhcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmcmFtZVRpbWU6IHRoaXMuX2NhbGN1bGF0ZVByb2ZpbGVyVmFsdWUoMiAvKiBGcmFtZVRpbWUgKi8sIHRpbWUpLFxuICAgICAgICAgICAgcmVuZGVyaW5nVGltZTogdGhpcy5fY2FsY3VsYXRlUHJvZmlsZXJWYWx1ZSgzIC8qIFJlbmRlcmluZ1RpbWUgKi8sIHRpbWUpXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBTaW1wbGVQcm9maWxlci5wcm90b3R5cGUuX3Jlc2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdGFydFRpbWUgPSB0aGlzLl9nZXRDdXJyZW50VGltZSgpO1xuICAgICAgICB0aGlzLl9iZWZvcmVGbHVzaFRpbWUgPSAwO1xuICAgICAgICB0aGlzLl9iZWZvcmVUaW1lcyA9IFtdO1xuICAgICAgICB0aGlzLl9iZWZvcmVUaW1lc1sxIC8qIFJhd0ZyYW1lSW50ZXJ2YWwgKi9dID0gMDtcbiAgICAgICAgdGhpcy5fYmVmb3JlVGltZXNbMiAvKiBGcmFtZVRpbWUgKi9dID0gMDtcbiAgICAgICAgdGhpcy5fYmVmb3JlVGltZXNbMyAvKiBSZW5kZXJpbmdUaW1lICovXSA9IDA7XG4gICAgICAgIHRoaXMuX2JlZm9yZVRpbWVzWzAgLyogU2tpcHBlZEZyYW1lQ291bnQgKi9dID0gMDtcbiAgICAgICAgdGhpcy5fdmFsdWVzID0gW107XG4gICAgICAgIHRoaXMuX3ZhbHVlc1sxIC8qIFJhd0ZyYW1lSW50ZXJ2YWwgKi9dID0gW107XG4gICAgICAgIHRoaXMuX3ZhbHVlc1syIC8qIEZyYW1lVGltZSAqL10gPSBbXTtcbiAgICAgICAgdGhpcy5fdmFsdWVzWzMgLyogUmVuZGVyaW5nVGltZSAqL10gPSBbXTtcbiAgICAgICAgdGhpcy5fdmFsdWVzWzAgLyogU2tpcHBlZEZyYW1lQ291bnQgKi9dID0gW107XG4gICAgfTtcbiAgICBTaW1wbGVQcm9maWxlci5wcm90b3R5cGUuX2NhbGN1bGF0ZVByb2ZpbGVyVmFsdWUgPSBmdW5jdGlvbiAodHlwZSwgdGltZSkge1xuICAgICAgICB2YXIgbGltaXQgPSB0aGlzLl9nZXRDdXJyZW50VGltZSgpIC0gdGltZTtcbiAgICAgICAgdmFyIHN1bSA9IDA7XG4gICAgICAgIHZhciBudW0gPSAwO1xuICAgICAgICB2YXIgbWF4ID0gMDtcbiAgICAgICAgdmFyIG1pbiA9IE51bWJlci5NQVhfVkFMVUU7XG4gICAgICAgIGZvciAodmFyIGkgPSB0aGlzLl92YWx1ZXNbdHlwZV0ubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgICAgIGlmICgwIDwgbnVtICYmIHRoaXMuX3ZhbHVlc1t0eXBlXVtpXS50aW1lIDwgbGltaXQpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLl92YWx1ZXNbdHlwZV1baV0udmFsdWU7XG4gICAgICAgICAgICBpZiAobWF4IDwgdmFsdWUpXG4gICAgICAgICAgICAgICAgbWF4ID0gdmFsdWU7XG4gICAgICAgICAgICBpZiAodmFsdWUgPCBtaW4pXG4gICAgICAgICAgICAgICAgbWluID0gdmFsdWU7XG4gICAgICAgICAgICBzdW0gKz0gdmFsdWU7XG4gICAgICAgICAgICArK251bTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYXZlOiBzdW0gLyBudW0sXG4gICAgICAgICAgICBtYXg6IG1heCxcbiAgICAgICAgICAgIG1pbjogbWluXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBTaW1wbGVQcm9maWxlci5wcm90b3R5cGUuX2dldEN1cnJlbnRUaW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gK25ldyBEYXRlKCk7XG4gICAgfTtcbiAgICBTaW1wbGVQcm9maWxlci5ERUZBVUxUX0lOVEVSVkFMID0gMTAwMDtcbiAgICBTaW1wbGVQcm9maWxlci5ERUZBVUxUX0xJTUlUID0gMTAwMDtcbiAgICBTaW1wbGVQcm9maWxlci5CQUNLVVBfTUFSR0lOID0gMTAwO1xuICAgIHJldHVybiBTaW1wbGVQcm9maWxlcjtcbn0oKSk7XG5leHBvcnRzLlNpbXBsZVByb2ZpbGVyID0gU2ltcGxlUHJvZmlsZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuREVGQVVMVF9QT0xMSU5HX1RJQ0tfVEhSRVNIT0xEID0gZXhwb3J0cy5ERUZBVUxUX0pVTVBfSUdOT1JFX1RIUkVTSE9MRCA9IGV4cG9ydHMuREVGQVVMVF9KVU1QX1RSWV9USFJFU0hPTEQgPSBleHBvcnRzLkRFRkFVTFRfU0tJUF9USFJFU0hPTEQgPSBleHBvcnRzLkRFRkFVTFRfU0tJUF9USUNLU19BVF9PTkNFID0gZXhwb3J0cy5ERUZBVUxUX0RFTEFZX0lHTk9SRV9USFJFU0hPTEQgPSB2b2lkIDA7XG4vKipcbiAqIOmBheW7tuOCkueEoeimluOBmeOCi+Wfn+WApOOBruODh+ODleOCqeODq+ODiOOAglxuICogYExvb3BDb25maWd1cmF0aW9uI2RlbGF5SWdub3JlVGhyZXNob2xkYCDjga7jg4fjg5Xjgqnjg6vjg4jlgKTjgIJcbiAqIOOBk+OBruODleODrOODvOODoOS7peS4i+OBrumBheW7tuOBr+mBheOCjOOBpuOBquOBhOOCguOBruOBqOOBv+OBquOBmSjluLjmmYLjgrPjg57jgYzpo5vjgbbjga7jgpLpgb/jgZHjgovjgZ/jgoEp44CCXG4gKi9cbmV4cG9ydHMuREVGQVVMVF9ERUxBWV9JR05PUkVfVEhSRVNIT0xEID0gNjtcbi8qKlxuICog44CM5pep6YCB44KK44CN5pmC5YCN546H44Gu44OH44OV44Kp44Or44OI5YCk44CCXG4gKiBgTG9vcENvbmZpZ3VyYXRpb24jc2tpcFRpY2tzQXRPbmNlYCDjga7jg4fjg5Xjgqnjg6vjg4jlgKTjgIJcbiAqL1xuZXhwb3J0cy5ERUZBVUxUX1NLSVBfVElDS1NfQVRfT05DRSA9IDEwMDtcbi8qKlxuICog44CM5pep6YCB44KK44CN54q25oWL44Gr56e744KL5Z+f5YCk44Gu44OH44OV44Kp44Or44OI44CCXG4gKiBgTG9vcENvbmZpZ3VyYXRpb24jc2tpcFRocmVzaG9sZGAg44Gu44OH44OV44Kp44Or44OI5YCk44CCXG4gKi9cbmV4cG9ydHMuREVGQVVMVF9TS0lQX1RIUkVTSE9MRCA9IDEwMDtcbi8qKlxuICog44K544OK44OD44OX44K344On44OD44OI44K444Oj44Oz44OX44KS6Kmm44G/44KL5Z+f5YCk44Gu44OH44OV44Kp44Or44OI44CCXG4gKiBgTG9vcENvbmZpZ3VyYXRpb24janVtcFRyeVRocmVzaG9sZGAg44Gu44OH44OV44Kp44Or44OI5YCk44CCXG4gKi9cbmV4cG9ydHMuREVGQVVMVF9KVU1QX1RSWV9USFJFU0hPTEQgPSAzMDAwMDsgLy8gMzBGUFPjga4xMDDlgI3ml6npgIHjgorjgafmj5vnrpczMDAwRlBT44Gn6YCy44KB44Gm44KCMTDnp5LjgYvjgYvjgovplr7lgKRcbi8qKlxuICog5Y+W5b6X44GX44Gf44K544OK44OD44OX44K344On44OD44OI44KS54Sh6KaW44GZ44KL5Z+f5YCk44Gu44OH44OV44Kp44Or44OI44CCXG4gKiBgTG9vcENvbmZpZ3VyYXRpb24janVtcElnbm9yZVRocmVzaG9sZGAg44Gu44OH44OV44Kp44Or44OI5YCk44CCXG4gKi9cbmV4cG9ydHMuREVGQVVMVF9KVU1QX0lHTk9SRV9USFJFU0hPTEQgPSAxNTAwMDsgLy8gMzBGUFPjga4xMDDlgI3ml6npgIHjgorjgafmj5vnrpczMDAwRlBT44Gn6YCy44KB44GmNeenkuOBp+a4iOOCgOmWvuWApFxuLyoqXG4gKiDmnIDmlrDjg4bjgqPjg4Pjgq/jgpLjg53jg7zjg6rjg7PjgrDjgZnjgovplpPpmpQobXMp44Gu44OH44OV44Kp44Or44OI44CCXG4gKi9cbmV4cG9ydHMuREVGQVVMVF9QT0xMSU5HX1RJQ0tfVEhSRVNIT0xEID0gMTAwMDA7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19leHBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2V4cG9ydFN0YXIpIHx8IGZ1bmN0aW9uKG0sIGV4cG9ydHMpIHtcbiAgICBmb3IgKHZhciBwIGluIG0pIGlmIChwICE9PSBcImRlZmF1bHRcIiAmJiAhZXhwb3J0cy5oYXNPd25Qcm9wZXJ0eShwKSkgX19jcmVhdGVCaW5kaW5nKGV4cG9ydHMsIG0sIHApO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuU2ltcGxlUHJvZmlsZXIgPSBleHBvcnRzLk1lbW9yeUFtZmxvd0NsaWVudCA9IGV4cG9ydHMuUmVwbGF5QW1mbG93UHJveHkgPSBleHBvcnRzLkdhbWUgPSBleHBvcnRzLkdhbWVEcml2ZXIgPSBleHBvcnRzLkV4ZWN1dGlvbk1vZGUgPSBleHBvcnRzLkxvb3BSZW5kZXJNb2RlID0gZXhwb3J0cy5Mb29wTW9kZSA9IGV4cG9ydHMuRXZlbnRJbmRleCA9IHZvaWQgMDtcbl9fZXhwb3J0U3RhcihyZXF1aXJlKFwiLi9jb25zdGFudHNcIiksIGV4cG9ydHMpO1xudmFyIEV2ZW50SW5kZXggPSByZXF1aXJlKFwiLi9FdmVudEluZGV4XCIpO1xuZXhwb3J0cy5FdmVudEluZGV4ID0gRXZlbnRJbmRleDtcbnZhciBMb29wTW9kZV8xID0gcmVxdWlyZShcIi4vTG9vcE1vZGVcIik7XG5leHBvcnRzLkxvb3BNb2RlID0gTG9vcE1vZGVfMS5kZWZhdWx0O1xudmFyIExvb3BSZW5kZXJNb2RlXzEgPSByZXF1aXJlKFwiLi9Mb29wUmVuZGVyTW9kZVwiKTtcbmV4cG9ydHMuTG9vcFJlbmRlck1vZGUgPSBMb29wUmVuZGVyTW9kZV8xLmRlZmF1bHQ7XG52YXIgRXhlY3V0aW9uTW9kZV8xID0gcmVxdWlyZShcIi4vRXhlY3V0aW9uTW9kZVwiKTtcbmV4cG9ydHMuRXhlY3V0aW9uTW9kZSA9IEV4ZWN1dGlvbk1vZGVfMS5kZWZhdWx0O1xudmFyIEdhbWVEcml2ZXJfMSA9IHJlcXVpcmUoXCIuL0dhbWVEcml2ZXJcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJHYW1lRHJpdmVyXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBHYW1lRHJpdmVyXzEuR2FtZURyaXZlcjsgfSB9KTtcbnZhciBHYW1lXzEgPSByZXF1aXJlKFwiLi9HYW1lXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiR2FtZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gR2FtZV8xLkdhbWU7IH0gfSk7XG52YXIgUmVwbGF5QW1mbG93UHJveHlfMSA9IHJlcXVpcmUoXCIuL2F1eGlsaWFyeS9SZXBsYXlBbWZsb3dQcm94eVwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlJlcGxheUFtZmxvd1Byb3h5XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBSZXBsYXlBbWZsb3dQcm94eV8xLlJlcGxheUFtZmxvd1Byb3h5OyB9IH0pO1xudmFyIE1lbW9yeUFtZmxvd0NsaWVudF8xID0gcmVxdWlyZShcIi4vYXV4aWxpYXJ5L01lbW9yeUFtZmxvd0NsaWVudFwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIk1lbW9yeUFtZmxvd0NsaWVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gTWVtb3J5QW1mbG93Q2xpZW50XzEuTWVtb3J5QW1mbG93Q2xpZW50OyB9IH0pO1xudmFyIFNpbXBsZVByb2ZpbGVyXzEgPSByZXF1aXJlKFwiLi9hdXhpbGlhcnkvU2ltcGxlUHJvZmlsZXJcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJTaW1wbGVQcm9maWxlclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gU2ltcGxlUHJvZmlsZXJfMS5TaW1wbGVQcm9maWxlcjsgfSB9KTtcbiIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcIi4vbGliL2Z1bGwvaW5kZXhcIik7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQXVkaW9NYW5hZ2VyID0gdm9pZCAwO1xudmFyIEF1ZGlvTWFuYWdlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBBdWRpb01hbmFnZXIoKSB7XG4gICAgICAgIHRoaXMuYXVkaW9Bc3NldHMgPSBbXTtcbiAgICAgICAgdGhpcy5fbWFzdGVyVm9sdW1lID0gMS4wO1xuICAgIH1cbiAgICBBdWRpb01hbmFnZXIucHJvdG90eXBlLnJlZ2lzdGVyQXVkaW9Bc3NldCA9IGZ1bmN0aW9uIChhc3NldCkge1xuICAgICAgICBpZiAodGhpcy5hdWRpb0Fzc2V0cy5pbmRleE9mKGFzc2V0KSA9PT0gLTEpXG4gICAgICAgICAgICB0aGlzLmF1ZGlvQXNzZXRzLnB1c2goYXNzZXQpO1xuICAgIH07XG4gICAgQXVkaW9NYW5hZ2VyLnByb3RvdHlwZS5yZW1vdmVBdWRpb0Fzc2V0ID0gZnVuY3Rpb24gKGFzc2V0KSB7XG4gICAgICAgIHZhciBpbmRleCA9IHRoaXMuYXVkaW9Bc3NldHMuaW5kZXhPZihhc3NldCk7XG4gICAgICAgIGlmIChpbmRleCA9PT0gLTEpXG4gICAgICAgICAgICB0aGlzLmF1ZGlvQXNzZXRzLnNwbGljZShpbmRleCwgMSk7XG4gICAgfTtcbiAgICBBdWRpb01hbmFnZXIucHJvdG90eXBlLnNldE1hc3RlclZvbHVtZSA9IGZ1bmN0aW9uICh2b2x1bWUpIHtcbiAgICAgICAgdGhpcy5fbWFzdGVyVm9sdW1lID0gdm9sdW1lO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYXVkaW9Bc3NldHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmF1ZGlvQXNzZXRzW2ldLl9sYXN0UGxheWVkUGxheWVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdWRpb0Fzc2V0c1tpXS5fbGFzdFBsYXllZFBsYXllci5ub3RpZnlNYXN0ZXJWb2x1bWVDaGFuZ2VkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEF1ZGlvTWFuYWdlci5wcm90b3R5cGUuZ2V0TWFzdGVyVm9sdW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbWFzdGVyVm9sdW1lO1xuICAgIH07XG4gICAgcmV0dXJuIEF1ZGlvTWFuYWdlcjtcbn0oKSk7XG5leHBvcnRzLkF1ZGlvTWFuYWdlciA9IEF1ZGlvTWFuYWdlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Db250YWluZXJDb250cm9sbGVyID0gdm9pZCAwO1xudmFyIGcgPSByZXF1aXJlKFwiQGFrYXNoaWMvYWthc2hpYy1lbmdpbmVcIik7XG52YXIgSW5wdXRIYW5kbGVyTGF5ZXJfMSA9IHJlcXVpcmUoXCIuL0lucHV0SGFuZGxlckxheWVyXCIpO1xuLypcbiBIVE1M6KaB57Sg44GuQ29udGFpbmVy44KS566h55CG44GZ44KL44Kv44Op44K544CCXG4gQ2FudmFz44KESW5wdXRIYW5kbGVy44Gu5a6f5oWL44Go44Gq44KL6KaB57Sg44Gu6aCG55Wq44KE6L+95Yqg5riI44G/44Gq44Gu44GL44KS566h55CG44GZ44KL44CCXG4gQ29udGFpbmVy44GvSW5wdXTjgIFDYW52YXPjgpIx44Gk44Gu44K744OD44OI44Go44GX44Gm5omx44GG44CCXG5cbiDku6XkuIvjga7jgojjgYbjgapET03mp4vpgKDjgpLmjIHjgaRcblxuIENvbnRhaW5lckNvbnRyb2xsZXIucm9vdFZpZXdcbiDilJTilIDilIAgSW5wdXRIYW5kbGVyTGF5ZXJcbiAgICAg4pSU4pSA4pSAIENhbnZhc1N1cmZhY2VcbiAqL1xudmFyIENvbnRhaW5lckNvbnRyb2xsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQ29udGFpbmVyQ29udHJvbGxlcihyZXNvdXJjZUZhY3RvcnkpIHtcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBudWxsO1xuICAgICAgICB0aGlzLnN1cmZhY2UgPSBudWxsO1xuICAgICAgICB0aGlzLmlucHV0SGFuZGxlckxheWVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5yb290VmlldyA9IG51bGw7XG4gICAgICAgIHRoaXMudXNlUmVzaXplRm9yU2NhbGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBvaW50RXZlbnRUcmlnZ2VyID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICB0aGlzLl9yZW5kZXJlclJlcSA9IG51bGw7XG4gICAgICAgIHRoaXMuX2Rpc2FibGVQcmV2ZW50RGVmYXVsdCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlc291cmNlRmFjdG9yeSA9IHJlc291cmNlRmFjdG9yeTtcbiAgICB9XG4gICAgQ29udGFpbmVyQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChwYXJhbSkge1xuICAgICAgICB0aGlzLl9yZW5kZXJlclJlcSA9IHBhcmFtLnJlbmRlcmVyUmVxdWlyZW1lbnQ7XG4gICAgICAgIHRoaXMuX2Rpc2FibGVQcmV2ZW50RGVmYXVsdCA9ICEhcGFyYW0uZGlzYWJsZVByZXZlbnREZWZhdWx0O1xuICAgICAgICB0aGlzLl9sb2FkVmlldygpO1xuICAgIH07XG4gICAgQ29udGFpbmVyQ29udHJvbGxlci5wcm90b3R5cGUuc2V0Um9vdFZpZXcgPSBmdW5jdGlvbiAocm9vdFZpZXcpIHtcbiAgICAgICAgaWYgKHJvb3RWaWV3ID09PSB0aGlzLnJvb3RWaWV3KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8g5LiA44Gk44GuQ29udGFpbmVy44Gv5LiA44Gk44Gucm9vdOOBl+OBi+aMgeOBn+OBquOBhOOBruOBp2xvYWTjgZfnm7TjgZlcbiAgICAgICAgaWYgKHRoaXMucm9vdFZpZXcpIHtcbiAgICAgICAgICAgIHRoaXMudW5sb2FkVmlldygpO1xuICAgICAgICAgICAgdGhpcy5fbG9hZFZpZXcoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJvb3RWaWV3ID0gcm9vdFZpZXc7XG4gICAgICAgIHRoaXMuX2FwcGVuZFRvUm9vdFZpZXcocm9vdFZpZXcpO1xuICAgIH07XG4gICAgQ29udGFpbmVyQ29udHJvbGxlci5wcm90b3R5cGUucmVzZXRWaWV3ID0gZnVuY3Rpb24gKHJlbmRlcmVyUmVxKSB7XG4gICAgICAgIHRoaXMudW5sb2FkVmlldygpO1xuICAgICAgICB0aGlzLl9yZW5kZXJlclJlcSA9IHJlbmRlcmVyUmVxO1xuICAgICAgICB0aGlzLl9sb2FkVmlldygpO1xuICAgICAgICB0aGlzLl9hcHBlbmRUb1Jvb3RWaWV3KHRoaXMucm9vdFZpZXcpO1xuICAgIH07XG4gICAgQ29udGFpbmVyQ29udHJvbGxlci5wcm90b3R5cGUuZ2V0UmVuZGVyZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5zdXJmYWNlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ0aGlzIGNvbnRhaW5lciBoYXMgbm8gc3VyZmFjZVwiKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBUT0RPOiBzaG91bGQgYmUgY2FjaGVkP1xuICAgICAgICByZXR1cm4gdGhpcy5zdXJmYWNlLnJlbmRlcmVyKCk7XG4gICAgfTtcbiAgICBDb250YWluZXJDb250cm9sbGVyLnByb3RvdHlwZS5jaGFuZ2VTY2FsZSA9IGZ1bmN0aW9uICh4U2NhbGUsIHlTY2FsZSkge1xuICAgICAgICBpZiAodGhpcy51c2VSZXNpemVGb3JTY2FsaW5nKSB7XG4gICAgICAgICAgICB0aGlzLnN1cmZhY2UuY2hhbmdlUGh5c2ljYWxTY2FsZSh4U2NhbGUsIHlTY2FsZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnN1cmZhY2UuY2hhbmdlVmlzdWFsU2NhbGUoeFNjYWxlLCB5U2NhbGUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5wdXRIYW5kbGVyTGF5ZXIuX2lucHV0SGFuZGxlci5zZXRTY2FsZSh4U2NhbGUsIHlTY2FsZSk7XG4gICAgfTtcbiAgICBDb250YWluZXJDb250cm9sbGVyLnByb3RvdHlwZS51bmxvYWRWaWV3ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyDjgqTjg5njg7Pjg4jjgpLniYfku5jjgZHjgabjgYvjgonjgIFyb290Vmlld+OBq+aJgOWxnuOBmeOCi0VsZW1lbnTjgpLplovmlL7jgZnjgotcbiAgICAgICAgdGhpcy5pbnB1dEhhbmRsZXJMYXllci5kaXNhYmxlUG9pbnRlckV2ZW50KCk7XG4gICAgICAgIGlmICh0aGlzLnJvb3RWaWV3KSB7XG4gICAgICAgICAgICB3aGlsZSAodGhpcy5yb290Vmlldy5maXJzdENoaWxkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yb290Vmlldy5yZW1vdmVDaGlsZCh0aGlzLnJvb3RWaWV3LmZpcnN0Q2hpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBDb250YWluZXJDb250cm9sbGVyLnByb3RvdHlwZS5fbG9hZFZpZXcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfYSA9IHRoaXMuX3JlbmRlcmVyUmVxLCB3aWR0aCA9IF9hLnByaW1hcnlTdXJmYWNlV2lkdGgsIGhlaWdodCA9IF9hLnByaW1hcnlTdXJmYWNlSGVpZ2h0O1xuICAgICAgICB2YXIgZGlzYWJsZVByZXZlbnREZWZhdWx0ID0gdGhpcy5fZGlzYWJsZVByZXZlbnREZWZhdWx0O1xuICAgICAgICAvLyBEb2N1bWVudEZyYWdtZW5044GvaW5zZXJ044GX44Gf5pmC54K544Gn6ZaL5pS+44GV44KM44Gm44GE44KL44Gf44KB5q+O5Zue5L2c44KLXG4gICAgICAgIC8vIGh0dHBzOi8vZG9tLnNwZWMud2hhdHdnLm9yZy8jY29uY2VwdC1ub2RlLWluc2VydFxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgLy8g5YWl5Yqb5Y+X44GR5LuY44GR44Os44Kk44Ok44O8IC0gRE9NIEV2ZW5044Gu566h55CGXG4gICAgICAgIGlmICghdGhpcy5pbnB1dEhhbmRsZXJMYXllcikge1xuICAgICAgICAgICAgdGhpcy5pbnB1dEhhbmRsZXJMYXllciA9IG5ldyBJbnB1dEhhbmRsZXJMYXllcl8xLklucHV0SGFuZGxlckxheWVyKHsgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCwgZGlzYWJsZVByZXZlbnREZWZhdWx0OiBkaXNhYmxlUHJldmVudERlZmF1bHQgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBOb3RlOiDmk43kvZzjg5fjg6njgrDjgqTjg7PjgavkuI7jgYjjgZ8gdmlldyDmg4XloLHjgpLliYrpmaTjgZfjgarjgYTjgZ/jgoHjgIEgaW5wdXRIYW5kbGVyTGF5ZXIg44KS5L2/44GE44G+44KP44GX44Gm44GE44KLXG4gICAgICAgICAgICB0aGlzLmlucHV0SGFuZGxlckxheWVyLnNldFZpZXdTaXplKHsgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCB9KTtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRIYW5kbGVyTGF5ZXIucG9pbnRFdmVudFRyaWdnZXIucmVtb3ZlQWxsKCk7XG4gICAgICAgICAgICBpZiAodGhpcy5zdXJmYWNlICYmICF0aGlzLnN1cmZhY2UuZGVzdHJveWVkKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0SGFuZGxlckxheWVyLnZpZXcucmVtb3ZlQ2hpbGQodGhpcy5zdXJmYWNlLmNhbnZhcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdXJmYWNlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyDlhaXlipvlj5fjgZHku5jjgZHjg6zjgqTjg6Tjg7wgPiDmj4/nlLvjg6zjgqTjg6Tjg7xcbiAgICAgICAgdGhpcy5zdXJmYWNlID0gdGhpcy5yZXNvdXJjZUZhY3RvcnkuY3JlYXRlUHJpbWFyeVN1cmZhY2Uod2lkdGgsIGhlaWdodCk7XG4gICAgICAgIHRoaXMuaW5wdXRIYW5kbGVyTGF5ZXIudmlldy5hcHBlbmRDaGlsZCh0aGlzLnN1cmZhY2UuZ2V0SFRNTEVsZW1lbnQoKSk7XG4gICAgICAgIC8vIGNvbnRhaW5lckNvbnRyb2xsZXIgLT4gaW5wdXQgLT4gY2FudmFzXG4gICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuaW5wdXRIYW5kbGVyTGF5ZXIudmlldyk7XG4gICAgfTtcbiAgICBDb250YWluZXJDb250cm9sbGVyLnByb3RvdHlwZS5fYXBwZW5kVG9Sb290VmlldyA9IGZ1bmN0aW9uIChyb290Vmlldykge1xuICAgICAgICByb290Vmlldy5hcHBlbmRDaGlsZCh0aGlzLmNvbnRhaW5lcik7XG4gICAgICAgIHRoaXMuaW5wdXRIYW5kbGVyTGF5ZXIuZW5hYmxlUG9pbnRlckV2ZW50KCk7IC8vIFZpZXfjgYzov73liqDjgZXjgozjgabjgYvjgonoqK3lrprjgZnjgotcbiAgICAgICAgdGhpcy5pbnB1dEhhbmRsZXJMYXllci5wb2ludEV2ZW50VHJpZ2dlci5hZGQodGhpcy5wb2ludEV2ZW50VHJpZ2dlci5maXJlLCB0aGlzLnBvaW50RXZlbnRUcmlnZ2VyKTtcbiAgICB9O1xuICAgIHJldHVybiBDb250YWluZXJDb250cm9sbGVyO1xufSgpKTtcbmV4cG9ydHMuQ29udGFpbmVyQ29udHJvbGxlciA9IENvbnRhaW5lckNvbnRyb2xsZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuSW5wdXRIYW5kbGVyTGF5ZXIgPSB2b2lkIDA7XG52YXIgZyA9IHJlcXVpcmUoXCJAYWthc2hpYy9ha2FzaGljLWVuZ2luZVwiKTtcbnZhciBUb3VjaEhhbmRsZXJfMSA9IHJlcXVpcmUoXCIuL2hhbmRsZXIvVG91Y2hIYW5kbGVyXCIpO1xuLyoqXG4gKiDjg6bjg7zjgrbjga7lhaXlipvjgpLlj5fjgZHku5jjgZHjgotWaWV344Gu44Os44Kk44Ok44O844CCXG4gKlxuICog5a6f6KGM55Kw5aKD44Gr6YGp5YiH44GqRE9N44Kk44OZ44Oz44OI44KS6Kit5a6a44GX44CBRE9N44Kk44OZ44Oz44OI44GL44KJ5bqn5qiZ44OH44O844K/44G45aSJ5o+b44GX44Gf57WQ5p6c44KSR2FtZeOBq+S8neOBiOOCi+OAglxuICogSW5wdXRIYW5kbGVyTGF5ZXLjga/jgYLjgY/jgb7jgafkuIDjgaTjga7jg6zjgqTjg6Tjg7zjgafjgYLjgorjgIFDb250YWluZXLjgafjga/jgarjgYTjgIJcbiAqIOW+k+OBo+OBpuOBk+OBrlZpZXfjga7opqrlrZDopoHntKDjgYzjganjgYbjgarjgaPjgabjgYTjgovjgYvjgpLnn6Xjgovlv4XopoHjga/jgarjgYTjgIJcbiAqL1xudmFyIElucHV0SGFuZGxlckxheWVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIC8qKlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiB2YXIgaW5wdXRIYW5kbGVyTGF5ZXIgPSBuZXcgSW5wdXRIYW5kbGVyTGF5ZXIoKTtcbiAgICAgKiBpbnB1dEhhbmRsZXJMYXllci5wb2ludEV2ZW50VHJpZ2dlci5hZGQoZnVuY3Rpb24ocG9pbnRFdmVudCl7XG4gICAgICogICBjb25zb2xlLmxvZyhwb2ludEV2ZW50KTtcbiAgICAgKiB9KTtcbiAgICAgKiBjb250YWluZXJDb250cm9sbGVyLmFwcGVuZENoaWxkKGlucHV0SGFuZGxlckxheWVyLnZpZXcpO1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIElucHV0SGFuZGxlckxheWVyKHBhcmFtKSB7XG4gICAgICAgIHRoaXMudmlldyA9IHRoaXMuX2NyZWF0ZUlucHV0VmlldyhwYXJhbS53aWR0aCwgcGFyYW0uaGVpZ2h0KTtcbiAgICAgICAgdGhpcy5faW5wdXRIYW5kbGVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBvaW50RXZlbnRUcmlnZ2VyID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgICAgICB0aGlzLl9kaXNhYmxlUHJldmVudERlZmF1bHQgPSAhIXBhcmFtLmRpc2FibGVQcmV2ZW50RGVmYXVsdDtcbiAgICB9XG4gICAgLy8g5a6f6KGM55Kw5aKD44Gn44K144Od44O844OI44GX44Gm44KLRE9NIEV2ZW5044KS5L2/44GE44CB44Gd44KM44Ge44KMb25Qb2ludCpUcmlnZ2Vy44KS6Zai6YCj5LuY44GR44KLXG4gICAgSW5wdXRIYW5kbGVyTGF5ZXIucHJvdG90eXBlLmVuYWJsZVBvaW50ZXJFdmVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5faW5wdXRIYW5kbGVyID0gbmV3IFRvdWNoSGFuZGxlcl8xLlRvdWNoSGFuZGxlcih0aGlzLnZpZXcsIHRoaXMuX2Rpc2FibGVQcmV2ZW50RGVmYXVsdCk7XG4gICAgICAgIC8vIOWQhOeoruOCpOODmeODs+ODiOOBrlRyaWdnZXJcbiAgICAgICAgdGhpcy5faW5wdXRIYW5kbGVyLnBvaW50VHJpZ2dlci5hZGQoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIF90aGlzLnBvaW50RXZlbnRUcmlnZ2VyLmZpcmUoZSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9pbnB1dEhhbmRsZXIuc3RhcnQoKTtcbiAgICB9O1xuICAgIC8vIERPTeOCpOODmeODs+ODiOODj+ODs+ODieODqeOCkumWi+aUvuOBmeOCi1xuICAgIElucHV0SGFuZGxlckxheWVyLnByb3RvdHlwZS5kaXNhYmxlUG9pbnRlckV2ZW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5faW5wdXRIYW5kbGVyKVxuICAgICAgICAgICAgdGhpcy5faW5wdXRIYW5kbGVyLnN0b3AoKTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlckxheWVyLnByb3RvdHlwZS5zZXRPZmZzZXQgPSBmdW5jdGlvbiAob2Zmc2V0KSB7XG4gICAgICAgIHZhciBpbnB1dFZpZXdTdHlsZSA9IFwicG9zaXRpb246cmVsYXRpdmU7IGxlZnQ6XCIgKyBvZmZzZXQueCArIFwicHg7IHRvcDpcIiArIG9mZnNldC55ICsgXCJweFwiO1xuICAgICAgICB0aGlzLl9pbnB1dEhhbmRsZXIuaW5wdXRWaWV3LnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIGlucHV0Vmlld1N0eWxlKTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlckxheWVyLnByb3RvdHlwZS5zZXRWaWV3U2l6ZSA9IGZ1bmN0aW9uIChzaXplKSB7XG4gICAgICAgIHZhciB2aWV3ID0gdGhpcy52aWV3O1xuICAgICAgICB2aWV3LnN0eWxlLndpZHRoID0gc2l6ZS53aWR0aCArIFwicHhcIjtcbiAgICAgICAgdmlldy5zdHlsZS5oZWlnaHQgPSBzaXplLmhlaWdodCArIFwicHhcIjtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlckxheWVyLnByb3RvdHlwZS5fY3JlYXRlSW5wdXRWaWV3ID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgdmFyIHZpZXcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICB2aWV3LnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsIFwiMVwiKTtcbiAgICAgICAgdmlldy5jbGFzc05hbWUgPSBcImlucHV0LWhhbmRsZXJcIjtcbiAgICAgICAgdmlldy5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImRpc3BsYXk6aW5saW5lLWJsb2NrOyBvdXRsaW5lOm5vbmU7XCIpO1xuICAgICAgICB2aWV3LnN0eWxlLndpZHRoID0gd2lkdGggKyBcInB4XCI7XG4gICAgICAgIHZpZXcuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgXCJweFwiO1xuICAgICAgICByZXR1cm4gdmlldztcbiAgICB9O1xuICAgIHJldHVybiBJbnB1dEhhbmRsZXJMYXllcjtcbn0oKSk7XG5leHBvcnRzLklucHV0SGFuZGxlckxheWVyID0gSW5wdXRIYW5kbGVyTGF5ZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuUGxhdGZvcm0gPSB2b2lkIDA7XG52YXIgUmFmTG9vcGVyXzEgPSByZXF1aXJlKFwiLi9SYWZMb29wZXJcIik7XG52YXIgUmVzb3VyY2VGYWN0b3J5XzEgPSByZXF1aXJlKFwiLi9SZXNvdXJjZUZhY3RvcnlcIik7XG52YXIgQ29udGFpbmVyQ29udHJvbGxlcl8xID0gcmVxdWlyZShcIi4vQ29udGFpbmVyQ29udHJvbGxlclwiKTtcbnZhciBBdWRpb1BsdWdpbk1hbmFnZXJfMSA9IHJlcXVpcmUoXCIuL3BsdWdpbi9BdWRpb1BsdWdpbk1hbmFnZXJcIik7XG52YXIgQXVkaW9NYW5hZ2VyXzEgPSByZXF1aXJlKFwiLi9BdWRpb01hbmFnZXJcIik7XG52YXIgQXVkaW9QbHVnaW5SZWdpc3RyeV8xID0gcmVxdWlyZShcIi4vcGx1Z2luL0F1ZGlvUGx1Z2luUmVnaXN0cnlcIik7XG52YXIgWEhSVGV4dEFzc2V0XzEgPSByZXF1aXJlKFwiLi9hc3NldC9YSFJUZXh0QXNzZXRcIik7XG52YXIgUGxhdGZvcm0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUGxhdGZvcm0ocGFyYW0pIHtcbiAgICAgICAgdGhpcy5jb250YWluZXJWaWV3ID0gcGFyYW0uY29udGFpbmVyVmlldztcbiAgICAgICAgdGhpcy5hdWRpb1BsdWdpbk1hbmFnZXIgPSBuZXcgQXVkaW9QbHVnaW5NYW5hZ2VyXzEuQXVkaW9QbHVnaW5NYW5hZ2VyKCk7XG4gICAgICAgIGlmIChwYXJhbS5hdWRpb1BsdWdpbnMpIHtcbiAgICAgICAgICAgIHRoaXMuYXVkaW9QbHVnaW5NYW5hZ2VyLnRyeUluc3RhbGxQbHVnaW4ocGFyYW0uYXVkaW9QbHVnaW5zKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBUT0RPOiBtYWtlIGl0IGRlcHJlY2F0ZWRcbiAgICAgICAgdGhpcy5hdWRpb1BsdWdpbk1hbmFnZXIudHJ5SW5zdGFsbFBsdWdpbihBdWRpb1BsdWdpblJlZ2lzdHJ5XzEuQXVkaW9QbHVnaW5SZWdpc3RyeS5nZXRSZWdpc3RlcmVkQXVkaW9QbHVnaW5zKCkpO1xuICAgICAgICB0aGlzLl9hdWRpb01hbmFnZXIgPSBuZXcgQXVkaW9NYW5hZ2VyXzEuQXVkaW9NYW5hZ2VyKCk7XG4gICAgICAgIHRoaXMuYW1mbG93ID0gcGFyYW0uYW1mbG93O1xuICAgICAgICB0aGlzLl9wbGF0Zm9ybUV2ZW50SGFuZGxlciA9IG51bGw7XG4gICAgICAgIHRoaXMuX3Jlc291cmNlRmFjdG9yeSA9IHBhcmFtLnJlc291cmNlRmFjdG9yeSB8fCBuZXcgUmVzb3VyY2VGYWN0b3J5XzEuUmVzb3VyY2VGYWN0b3J5KHtcbiAgICAgICAgICAgIGF1ZGlvUGx1Z2luTWFuYWdlcjogdGhpcy5hdWRpb1BsdWdpbk1hbmFnZXIsXG4gICAgICAgICAgICBwbGF0Zm9ybTogdGhpcyxcbiAgICAgICAgICAgIGF1ZGlvTWFuYWdlcjogdGhpcy5fYXVkaW9NYW5hZ2VyXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNvbnRhaW5lckNvbnRyb2xsZXIgPSBuZXcgQ29udGFpbmVyQ29udHJvbGxlcl8xLkNvbnRhaW5lckNvbnRyb2xsZXIodGhpcy5fcmVzb3VyY2VGYWN0b3J5KTtcbiAgICAgICAgdGhpcy5fcmVuZGVyZXJSZXEgPSBudWxsO1xuICAgICAgICB0aGlzLl9kaXNhYmxlUHJldmVudERlZmF1bHQgPSAhIXBhcmFtLmRpc2FibGVQcmV2ZW50RGVmYXVsdDtcbiAgICB9XG4gICAgUGxhdGZvcm0ucHJvdG90eXBlLnNldFBsYXRmb3JtRXZlbnRIYW5kbGVyID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcbiAgICAgICAgaWYgKHRoaXMuY29udGFpbmVyQ29udHJvbGxlcikge1xuICAgICAgICAgICAgdGhpcy5jb250YWluZXJDb250cm9sbGVyLnBvaW50RXZlbnRUcmlnZ2VyLnJlbW92ZUFsbCh7IG93bmVyOiB0aGlzLl9wbGF0Zm9ybUV2ZW50SGFuZGxlciB9KTtcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyQ29udHJvbGxlci5wb2ludEV2ZW50VHJpZ2dlci5hZGQoaGFuZGxlci5vblBvaW50RXZlbnQsIGhhbmRsZXIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3BsYXRmb3JtRXZlbnRIYW5kbGVyID0gaGFuZGxlcjtcbiAgICB9O1xuICAgIFBsYXRmb3JtLnByb3RvdHlwZS5sb2FkR2FtZUNvbmZpZ3VyYXRpb24gPSBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgYSA9IG5ldyBYSFJUZXh0QXNzZXRfMS5YSFJUZXh0QXNzZXQoXCIoZ2FtZS5qc29uKVwiLCB1cmwpO1xuICAgICAgICBhLl9sb2FkKHtcbiAgICAgICAgICAgIF9vbkFzc2V0TG9hZDogZnVuY3Rpb24gKGFzc2V0KSB7IGNhbGxiYWNrKG51bGwsIEpTT04ucGFyc2UoYS5kYXRhKSk7IH0sXG4gICAgICAgICAgICBfb25Bc3NldEVycm9yOiBmdW5jdGlvbiAoYXNzZXQsIGVycm9yKSB7IGNhbGxiYWNrKGVycm9yLCBudWxsKTsgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFBsYXRmb3JtLnByb3RvdHlwZS5nZXRSZXNvdXJjZUZhY3RvcnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZXNvdXJjZUZhY3Rvcnk7XG4gICAgfTtcbiAgICBQbGF0Zm9ybS5wcm90b3R5cGUuc2V0UmVuZGVyZXJSZXF1aXJlbWVudCA9IGZ1bmN0aW9uIChyZXF1aXJlbWVudCkge1xuICAgICAgICBpZiAoIXJlcXVpcmVtZW50KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jb250YWluZXJDb250cm9sbGVyKVxuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyQ29udHJvbGxlci51bmxvYWRWaWV3KCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcmVuZGVyZXJSZXEgPSByZXF1aXJlbWVudDtcbiAgICAgICAgdGhpcy5fcmVzb3VyY2VGYWN0b3J5Ll9yZW5kZXJlckNhbmRpZGF0ZXMgPSB0aGlzLl9yZW5kZXJlclJlcS5yZW5kZXJlckNhbmRpZGF0ZXM7XG4gICAgICAgIC8vIE5vdGU6IHRoaXMuY29udGFpbmVyQ29udHJvbGxlci5pbnB1dEhhbmRsZXJMYXllciDjga7lrZjlnKjjgavjgojjgoogdGhpcy5jb250YWluZXJDb250cm9sbGVyIOOBjOWIneacn+WMluOBleOCjOOBpuOBhOOCi+OBi+OCkuWIpOWumlxuICAgICAgICBpZiAodGhpcy5jb250YWluZXJDb250cm9sbGVyICYmICF0aGlzLmNvbnRhaW5lckNvbnRyb2xsZXIuaW5wdXRIYW5kbGVyTGF5ZXIpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyQ29udHJvbGxlci5pbml0aWFsaXplKHtcbiAgICAgICAgICAgICAgICByZW5kZXJlclJlcXVpcmVtZW50OiByZXF1aXJlbWVudCxcbiAgICAgICAgICAgICAgICBkaXNhYmxlUHJldmVudERlZmF1bHQ6IHRoaXMuX2Rpc2FibGVQcmV2ZW50RGVmYXVsdFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lckNvbnRyb2xsZXIuc2V0Um9vdFZpZXcodGhpcy5jb250YWluZXJWaWV3KTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9wbGF0Zm9ybUV2ZW50SGFuZGxlcikge1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyQ29udHJvbGxlci5wb2ludEV2ZW50VHJpZ2dlci5hZGQodGhpcy5fcGxhdGZvcm1FdmVudEhhbmRsZXIub25Qb2ludEV2ZW50LCB0aGlzLl9wbGF0Zm9ybUV2ZW50SGFuZGxlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lckNvbnRyb2xsZXIucmVzZXRWaWV3KHJlcXVpcmVtZW50KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgUGxhdGZvcm0ucHJvdG90eXBlLmdldFByaW1hcnlTdXJmYWNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb250YWluZXJDb250cm9sbGVyLnN1cmZhY2U7XG4gICAgfTtcbiAgICBQbGF0Zm9ybS5wcm90b3R5cGUuZ2V0T3BlcmF0aW9uUGx1Z2luVmlld0luZm8gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiBcInBkaS1icm93c2VyXCIsXG4gICAgICAgICAgICB2aWV3OiB0aGlzLmNvbnRhaW5lckNvbnRyb2xsZXIuaW5wdXRIYW5kbGVyTGF5ZXIudmlldyxcbiAgICAgICAgICAgIGdldFNjYWxlOiBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5jb250YWluZXJDb250cm9sbGVyLmlucHV0SGFuZGxlckxheWVyLl9pbnB1dEhhbmRsZXIuZ2V0U2NhbGUoKTsgfVxuICAgICAgICB9O1xuICAgIH07XG4gICAgUGxhdGZvcm0ucHJvdG90eXBlLmNyZWF0ZUxvb3BlciA9IGZ1bmN0aW9uIChmdW4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSYWZMb29wZXJfMS5SYWZMb29wZXIoZnVuKTtcbiAgICB9O1xuICAgIFBsYXRmb3JtLnByb3RvdHlwZS5zZW5kVG9FeHRlcm5hbCA9IGZ1bmN0aW9uIChwbGF5SWQsIGRhdGEpIHtcbiAgICAgICAgLy8gTm90aGluZyB0byBkby5cbiAgICB9O1xuICAgIFBsYXRmb3JtLnByb3RvdHlwZS5yZWdpc3RlckF1ZGlvUGx1Z2lucyA9IGZ1bmN0aW9uIChwbHVnaW5zKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmF1ZGlvUGx1Z2luTWFuYWdlci50cnlJbnN0YWxsUGx1Z2luKHBsdWdpbnMpO1xuICAgIH07XG4gICAgUGxhdGZvcm0ucHJvdG90eXBlLnNldFNjYWxlID0gZnVuY3Rpb24gKHhTY2FsZSwgeVNjYWxlKSB7XG4gICAgICAgIHRoaXMuY29udGFpbmVyQ29udHJvbGxlci5jaGFuZ2VTY2FsZSh4U2NhbGUsIHlTY2FsZSk7XG4gICAgfTtcbiAgICBQbGF0Zm9ybS5wcm90b3R5cGUubm90aWZ5Vmlld01vdmVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyDml6LjgavlvbnlibLjga7jgarjgYTjg6Hjgr3jg4Pjg4ko5ZG844Gz5Ye644GV44Gq44GP44Gm44KC5q2j44GX44GP5YuV5L2c44GZ44KLKeOAguWFrOmWi0FQSeOBruOBn+OCgeW+jOaWueS6kuaPm+aAp+OBruOBn+OCgeOBq+aui+OBl+OBpuOBhOOCi+OAglxuICAgIH07XG4gICAgLyoqXG4gICAgICog5pyA57WC55qE44Gr5Ye65Yqb44GV44KM44KL44Oe44K544K/44O86Z+z6YeP44KS5aSJ5pu044GZ44KLXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdm9sdW1lIOODnuOCueOCv+ODvOmfs+mHj1xuICAgICAqL1xuICAgIFBsYXRmb3JtLnByb3RvdHlwZS5zZXRNYXN0ZXJWb2x1bWUgPSBmdW5jdGlvbiAodm9sdW1lKSB7XG4gICAgICAgIGlmICh0aGlzLl9hdWRpb01hbmFnZXIpXG4gICAgICAgICAgICB0aGlzLl9hdWRpb01hbmFnZXIuc2V0TWFzdGVyVm9sdW1lKHZvbHVtZSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiDmnIDntYLnmoTjgavlh7rlipvjgZXjgozjgovjg57jgrnjgr/jg7zpn7Pph4/jgpLlj5blvpfjgZnjgotcbiAgICAgKi9cbiAgICBQbGF0Zm9ybS5wcm90b3R5cGUuZ2V0TWFzdGVyVm9sdW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fYXVkaW9NYW5hZ2VyKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2F1ZGlvTWFuYWdlci5nZXRNYXN0ZXJWb2x1bWUoKTtcbiAgICB9O1xuICAgIFBsYXRmb3JtLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnNldFJlbmRlcmVyUmVxdWlyZW1lbnQodW5kZWZpbmVkKTtcbiAgICAgICAgdGhpcy5zZXRNYXN0ZXJWb2x1bWUoMCk7XG4gICAgfTtcbiAgICByZXR1cm4gUGxhdGZvcm07XG59KCkpO1xuZXhwb3J0cy5QbGF0Zm9ybSA9IFBsYXRmb3JtO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlJhZkxvb3BlciA9IHZvaWQgMDtcbnZhciBSYWZMb29wZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUmFmTG9vcGVyKGZ1bikge1xuICAgICAgICB0aGlzLl9mdW4gPSBmdW47XG4gICAgICAgIHRoaXMuX3RpbWVySWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuX3ByZXYgPSAwO1xuICAgIH1cbiAgICBSYWZMb29wZXIucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgb25BbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uIChkZWx0YVRpbWUpIHtcbiAgICAgICAgICAgIGlmIChfdGhpcy5fdGltZXJJZCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgLy8gTk9URTogRmlyZWZveCBRdWFudHVtIDU3LjAuMuOBruS4jeWFt+WQiCjvvJ8pKGNhbmNlbEFuaW1hdGlvbkZyYW1lKCnjgYzmqZ/og73jgZfjgarjgYTjgZPjgajjgYzjgYLjgosp5pqr5a6a5a++562WXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMuX3RpbWVySWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUob25BbmltYXRpb25GcmFtZSk7XG4gICAgICAgICAgICBfdGhpcy5fZnVuKGRlbHRhVGltZSAtIF90aGlzLl9wcmV2KTtcbiAgICAgICAgICAgIF90aGlzLl9wcmV2ID0gZGVsdGFUaW1lO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgb25GaXJzdEZyYW1lID0gZnVuY3Rpb24gKGRlbHRhVGltZSkge1xuICAgICAgICAgICAgX3RoaXMuX3RpbWVySWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUob25BbmltYXRpb25GcmFtZSk7XG4gICAgICAgICAgICBfdGhpcy5fZnVuKDApO1xuICAgICAgICAgICAgX3RoaXMuX3ByZXYgPSBkZWx0YVRpbWU7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX3RpbWVySWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUob25GaXJzdEZyYW1lKTtcbiAgICB9O1xuICAgIFJhZkxvb3Blci5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5fdGltZXJJZCk7XG4gICAgICAgIHRoaXMuX3RpbWVySWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuX3ByZXYgPSAwO1xuICAgIH07XG4gICAgcmV0dXJuIFJhZkxvb3Blcjtcbn0oKSk7XG5leHBvcnRzLlJhZkxvb3BlciA9IFJhZkxvb3BlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlJlc291cmNlRmFjdG9yeSA9IHZvaWQgMDtcbnZhciBnID0gcmVxdWlyZShcIkBha2FzaGljL2FrYXNoaWMtZW5naW5lXCIpO1xudmFyIEhUTUxJbWFnZUFzc2V0XzEgPSByZXF1aXJlKFwiLi9hc3NldC9IVE1MSW1hZ2VBc3NldFwiKTtcbnZhciBIVE1MVmlkZW9Bc3NldF8xID0gcmVxdWlyZShcIi4vYXNzZXQvSFRNTFZpZGVvQXNzZXRcIik7XG52YXIgWEhSVGV4dEFzc2V0XzEgPSByZXF1aXJlKFwiLi9hc3NldC9YSFJUZXh0QXNzZXRcIik7XG52YXIgWEhSU2NyaXB0QXNzZXRfMSA9IHJlcXVpcmUoXCIuL2Fzc2V0L1hIUlNjcmlwdEFzc2V0XCIpO1xudmFyIEdseXBoRmFjdG9yeV8xID0gcmVxdWlyZShcIi4vY2FudmFzL0dseXBoRmFjdG9yeVwiKTtcbnZhciBTdXJmYWNlRmFjdG9yeV8xID0gcmVxdWlyZShcIi4vY2FudmFzL3NoaW1zL1N1cmZhY2VGYWN0b3J5XCIpO1xudmFyIFJlc291cmNlRmFjdG9yeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoUmVzb3VyY2VGYWN0b3J5LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFJlc291cmNlRmFjdG9yeShwYXJhbSkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5fYXVkaW9QbHVnaW5NYW5hZ2VyID0gcGFyYW0uYXVkaW9QbHVnaW5NYW5hZ2VyO1xuICAgICAgICBfdGhpcy5fYXVkaW9NYW5hZ2VyID0gcGFyYW0uYXVkaW9NYW5hZ2VyO1xuICAgICAgICBfdGhpcy5fcGxhdGZvcm0gPSBwYXJhbS5wbGF0Zm9ybTtcbiAgICAgICAgX3RoaXMuX3N1cmZhY2VGYWN0b3J5ID0gbmV3IFN1cmZhY2VGYWN0b3J5XzEuU3VyZmFjZUZhY3RvcnkoKTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBSZXNvdXJjZUZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZUF1ZGlvQXNzZXQgPSBmdW5jdGlvbiAoaWQsIGFzc2V0UGF0aCwgZHVyYXRpb24sIHN5c3RlbSwgbG9vcCwgaGludCkge1xuICAgICAgICB2YXIgYWN0aXZlUGx1Z2luID0gdGhpcy5fYXVkaW9QbHVnaW5NYW5hZ2VyLmdldEFjdGl2ZVBsdWdpbigpO1xuICAgICAgICB2YXIgYXVkaW9Bc3NldCA9IGFjdGl2ZVBsdWdpbi5jcmVhdGVBc3NldChpZCwgYXNzZXRQYXRoLCBkdXJhdGlvbiwgc3lzdGVtLCBsb29wLCBoaW50KTtcbiAgICAgICAgaWYgKGF1ZGlvQXNzZXQub25EZXN0cm95ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX2F1ZGlvTWFuYWdlci5yZWdpc3RlckF1ZGlvQXNzZXQoYXVkaW9Bc3NldCk7XG4gICAgICAgICAgICBhdWRpb0Fzc2V0Lm9uRGVzdHJveWVkLmFkZCh0aGlzLl9vbkF1ZGlvQXNzZXREZXN0cm95ZWQsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhdWRpb0Fzc2V0O1xuICAgIH07XG4gICAgUmVzb3VyY2VGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGVBdWRpb1BsYXllciA9IGZ1bmN0aW9uIChzeXN0ZW0pIHtcbiAgICAgICAgdmFyIGFjdGl2ZVBsdWdpbiA9IHRoaXMuX2F1ZGlvUGx1Z2luTWFuYWdlci5nZXRBY3RpdmVQbHVnaW4oKTtcbiAgICAgICAgcmV0dXJuIGFjdGl2ZVBsdWdpbi5jcmVhdGVQbGF5ZXIoc3lzdGVtLCB0aGlzLl9hdWRpb01hbmFnZXIpO1xuICAgIH07XG4gICAgUmVzb3VyY2VGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGVJbWFnZUFzc2V0ID0gZnVuY3Rpb24gKGlkLCBhc3NldFBhdGgsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBIVE1MSW1hZ2VBc3NldF8xLkhUTUxJbWFnZUFzc2V0KGlkLCBhc3NldFBhdGgsIHdpZHRoLCBoZWlnaHQpO1xuICAgIH07XG4gICAgUmVzb3VyY2VGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGVWaWRlb0Fzc2V0ID0gZnVuY3Rpb24gKGlkLCBhc3NldFBhdGgsIHdpZHRoLCBoZWlnaHQsIHN5c3RlbSwgbG9vcCwgdXNlUmVhbFNpemUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBIVE1MVmlkZW9Bc3NldF8xLkhUTUxWaWRlb0Fzc2V0KGlkLCBhc3NldFBhdGgsIHdpZHRoLCBoZWlnaHQsIHN5c3RlbSwgbG9vcCwgdXNlUmVhbFNpemUpO1xuICAgIH07XG4gICAgUmVzb3VyY2VGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGVUZXh0QXNzZXQgPSBmdW5jdGlvbiAoaWQsIGFzc2V0UGF0aCkge1xuICAgICAgICByZXR1cm4gbmV3IFhIUlRleHRBc3NldF8xLlhIUlRleHRBc3NldChpZCwgYXNzZXRQYXRoKTtcbiAgICB9O1xuICAgIFJlc291cmNlRmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlU2NyaXB0QXNzZXQgPSBmdW5jdGlvbiAoaWQsIGFzc2V0UGF0aCkge1xuICAgICAgICByZXR1cm4gbmV3IFhIUlNjcmlwdEFzc2V0XzEuWEhSU2NyaXB0QXNzZXQoaWQsIGFzc2V0UGF0aCk7XG4gICAgfTtcbiAgICBSZXNvdXJjZUZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZVByaW1hcnlTdXJmYWNlID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N1cmZhY2VGYWN0b3J5LmNyZWF0ZVByaW1hcnlTdXJmYWNlKHdpZHRoLCBoZWlnaHQsIHRoaXMuX3JlbmRlcmVyQ2FuZGlkYXRlcyk7XG4gICAgfTtcbiAgICBSZXNvdXJjZUZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZVN1cmZhY2UgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3VyZmFjZUZhY3RvcnkuY3JlYXRlQmFja1N1cmZhY2Uod2lkdGgsIGhlaWdodCwgdGhpcy5fcmVuZGVyZXJDYW5kaWRhdGVzKTtcbiAgICB9O1xuICAgIFJlc291cmNlRmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlR2x5cGhGYWN0b3J5ID0gZnVuY3Rpb24gKGZvbnRGYW1pbHksIGZvbnRTaXplLCBiYXNlbGluZSwgZm9udENvbG9yLCBzdHJva2VXaWR0aCwgc3Ryb2tlQ29sb3IsIHN0cm9rZU9ubHksIGZvbnRXZWlnaHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBHbHlwaEZhY3RvcnlfMS5HbHlwaEZhY3RvcnkoZm9udEZhbWlseSwgZm9udFNpemUsIGJhc2VsaW5lLCBmb250Q29sb3IsIHN0cm9rZVdpZHRoLCBzdHJva2VDb2xvciwgc3Ryb2tlT25seSwgZm9udFdlaWdodCk7XG4gICAgfTtcbiAgICBSZXNvdXJjZUZhY3RvcnkucHJvdG90eXBlLl9vbkF1ZGlvQXNzZXREZXN0cm95ZWQgPSBmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgICAgdGhpcy5fYXVkaW9NYW5hZ2VyLnJlbW92ZUF1ZGlvQXNzZXQoYXNzZXQpO1xuICAgIH07XG4gICAgcmV0dXJuIFJlc291cmNlRmFjdG9yeTtcbn0oZy5SZXNvdXJjZUZhY3RvcnkpKTtcbmV4cG9ydHMuUmVzb3VyY2VGYWN0b3J5ID0gUmVzb3VyY2VGYWN0b3J5O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuSFRNTEltYWdlQXNzZXQgPSBleHBvcnRzLkltYWdlQXNzZXRTdXJmYWNlID0gdm9pZCAwO1xudmFyIGcgPSByZXF1aXJlKFwiQGFrYXNoaWMvYWthc2hpYy1lbmdpbmVcIik7XG52YXIgSW1hZ2VBc3NldFN1cmZhY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEltYWdlQXNzZXRTdXJmYWNlLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIEltYWdlQXNzZXRTdXJmYWNlKHdpZHRoLCBoZWlnaHQsIGRyYXdhYmxlKSB7XG4gICAgICAgIHJldHVybiBfc3VwZXIuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0LCBkcmF3YWJsZSkgfHwgdGhpcztcbiAgICB9XG4gICAgSW1hZ2VBc3NldFN1cmZhY2UucHJvdG90eXBlLnJlbmRlcmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJJbWFnZUFzc2V0U3VyZmFjZSBjYW5ub3QgYmUgcmVuZGVyZWQuXCIpO1xuICAgIH07XG4gICAgSW1hZ2VBc3NldFN1cmZhY2UucHJvdG90eXBlLmlzUGxheWluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgcmV0dXJuIEltYWdlQXNzZXRTdXJmYWNlO1xufShnLlN1cmZhY2UpKTtcbmV4cG9ydHMuSW1hZ2VBc3NldFN1cmZhY2UgPSBJbWFnZUFzc2V0U3VyZmFjZTtcbnZhciBIVE1MSW1hZ2VBc3NldCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoSFRNTEltYWdlQXNzZXQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gSFRNTEltYWdlQXNzZXQoaWQsIHBhdGgsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgaWQsIHBhdGgsIHdpZHRoLCBoZWlnaHQpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLmRhdGEgPSB1bmRlZmluZWQ7XG4gICAgICAgIF90aGlzLl9zdXJmYWNlID0gdW5kZWZpbmVkO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIEhUTUxJbWFnZUFzc2V0LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fc3VyZmFjZSAmJiAhdGhpcy5fc3VyZmFjZS5kZXN0cm95ZWQoKSkge1xuICAgICAgICAgICAgdGhpcy5fc3VyZmFjZS5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kYXRhID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLl9zdXJmYWNlID0gdW5kZWZpbmVkO1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKTtcbiAgICB9O1xuICAgIEhUTUxJbWFnZUFzc2V0LnByb3RvdHlwZS5fbG9hZCA9IGZ1bmN0aW9uIChsb2FkZXIpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIGltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgICAgIGlmICh0aGlzLmhpbnQgJiYgdGhpcy5oaW50LnVudGFpbnRlZCkge1xuICAgICAgICAgICAgaW1hZ2UuY3Jvc3NPcmlnaW4gPSBcImFub255bW91c1wiO1xuICAgICAgICB9XG4gICAgICAgIGltYWdlLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBsb2FkZXIuX29uQXNzZXRFcnJvcihfdGhpcywgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2V0TG9hZEVycm9yKFwiSFRNTEltYWdlQXNzZXQgdW5rbm93biBsb2FkaW5nIGVycm9yXCIpKTtcbiAgICAgICAgfTtcbiAgICAgICAgaW1hZ2Uub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMuZGF0YSA9IGltYWdlO1xuICAgICAgICAgICAgbG9hZGVyLl9vbkFzc2V0TG9hZChfdGhpcyk7XG4gICAgICAgIH07XG4gICAgICAgIGltYWdlLnNyYyA9IHRoaXMucGF0aDtcbiAgICB9O1xuICAgIEhUTUxJbWFnZUFzc2V0LnByb3RvdHlwZS5hc1N1cmZhY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5kYXRhKSB7XG4gICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJJbWFnZUFzc2V0SW1wbCNhc1N1cmZhY2U6IG5vdCB5ZXQgbG9hZGVkLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fc3VyZmFjZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N1cmZhY2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fc3VyZmFjZSA9IG5ldyBJbWFnZUFzc2V0U3VyZmFjZSh0aGlzLndpZHRoLCB0aGlzLmhlaWdodCwgdGhpcy5kYXRhKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N1cmZhY2U7XG4gICAgfTtcbiAgICByZXR1cm4gSFRNTEltYWdlQXNzZXQ7XG59KGcuSW1hZ2VBc3NldCkpO1xuZXhwb3J0cy5IVE1MSW1hZ2VBc3NldCA9IEhUTUxJbWFnZUFzc2V0O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuSFRNTFZpZGVvQXNzZXQgPSB2b2lkIDA7XG52YXIgZyA9IHJlcXVpcmUoXCJAYWthc2hpYy9ha2FzaGljLWVuZ2luZVwiKTtcbnZhciBIVE1MVmlkZW9QbGF5ZXJfMSA9IHJlcXVpcmUoXCIuL0hUTUxWaWRlb1BsYXllclwiKTtcbnZhciBWaWRlb0Fzc2V0U3VyZmFjZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVmlkZW9Bc3NldFN1cmZhY2UsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gVmlkZW9Bc3NldFN1cmZhY2Uod2lkdGgsIGhlaWdodCwgZHJhd2FibGUpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlci5jYWxsKHRoaXMsIHdpZHRoLCBoZWlnaHQsIGRyYXdhYmxlLCB0cnVlKSB8fCB0aGlzO1xuICAgIH1cbiAgICBWaWRlb0Fzc2V0U3VyZmFjZS5wcm90b3R5cGUucmVuZGVyZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIlZpZGVvQXNzZXRTdXJmYWNlIGNhbm5vdCBiZSByZW5kZXJlZC5cIik7XG4gICAgfTtcbiAgICBWaWRlb0Fzc2V0U3VyZmFjZS5wcm90b3R5cGUuaXNQbGF5aW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICByZXR1cm4gVmlkZW9Bc3NldFN1cmZhY2U7XG59KGcuU3VyZmFjZSkpO1xudmFyIEhUTUxWaWRlb0Fzc2V0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhIVE1MVmlkZW9Bc3NldCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBIVE1MVmlkZW9Bc3NldChpZCwgYXNzZXRQYXRoLCB3aWR0aCwgaGVpZ2h0LCBzeXN0ZW0sIGxvb3AsIHVzZVJlYWxTaXplKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIGlkLCBhc3NldFBhdGgsIHdpZHRoLCBoZWlnaHQsIHN5c3RlbSwgbG9vcCwgdXNlUmVhbFNpemUpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLl9wbGF5ZXIgPSBuZXcgSFRNTFZpZGVvUGxheWVyXzEuSFRNTFZpZGVvUGxheWVyKCk7XG4gICAgICAgIF90aGlzLl9zdXJmYWNlID0gbmV3IFZpZGVvQXNzZXRTdXJmYWNlKHdpZHRoLCBoZWlnaHQsIG51bGwpO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIEhUTUxWaWRlb0Fzc2V0LnByb3RvdHlwZS5pblVzZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgSFRNTFZpZGVvQXNzZXQucHJvdG90eXBlLl9sb2FkID0gZnVuY3Rpb24gKGxvYWRlcikge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGxvYWRlci5fb25Bc3NldExvYWQoX3RoaXMpO1xuICAgICAgICB9LCAwKTtcbiAgICB9O1xuICAgIEhUTUxWaWRlb0Fzc2V0LnByb3RvdHlwZS5nZXRQbGF5ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wbGF5ZXI7XG4gICAgfTtcbiAgICBIVE1MVmlkZW9Bc3NldC5wcm90b3R5cGUuYXNTdXJmYWNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3VyZmFjZTtcbiAgICB9O1xuICAgIHJldHVybiBIVE1MVmlkZW9Bc3NldDtcbn0oZy5WaWRlb0Fzc2V0KSk7XG5leHBvcnRzLkhUTUxWaWRlb0Fzc2V0ID0gSFRNTFZpZGVvQXNzZXQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5IVE1MVmlkZW9QbGF5ZXIgPSB2b2lkIDA7XG52YXIgZyA9IHJlcXVpcmUoXCJAYWthc2hpYy9ha2FzaGljLWVuZ2luZVwiKTtcbnZhciBIVE1MVmlkZW9QbGF5ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEhUTUxWaWRlb1BsYXllciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBIVE1MVmlkZW9QbGF5ZXIobG9vcCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBsb29wKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5pc0R1bW15ID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBIVE1MVmlkZW9QbGF5ZXIucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbiAodmlkZW9Bc3NldCkge1xuICAgICAgICAvLyBub3QgeWV0IHN1cHBvcnRlZFxuICAgIH07XG4gICAgSFRNTFZpZGVvUGxheWVyLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBub3QgeWV0IHN1cHBvcnRlZFxuICAgIH07XG4gICAgSFRNTFZpZGVvUGxheWVyLnByb3RvdHlwZS5jaGFuZ2VWb2x1bWUgPSBmdW5jdGlvbiAodm9sdW1lKSB7XG4gICAgICAgIC8vIG5vdCB5ZXQgc3VwcG9ydGVkXG4gICAgfTtcbiAgICByZXR1cm4gSFRNTFZpZGVvUGxheWVyO1xufShnLlZpZGVvUGxheWVyKSk7XG5leHBvcnRzLkhUTUxWaWRlb1BsYXllciA9IEhUTUxWaWRlb1BsYXllcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlhIUlNjcmlwdEFzc2V0ID0gdm9pZCAwO1xudmFyIGcgPSByZXF1aXJlKFwiQGFrYXNoaWMvYWthc2hpYy1lbmdpbmVcIik7XG52YXIgWEhSTG9hZGVyXzEgPSByZXF1aXJlKFwiLi4vdXRpbHMvWEhSTG9hZGVyXCIpO1xudmFyIFhIUlNjcmlwdEFzc2V0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhYSFJTY3JpcHRBc3NldCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBYSFJTY3JpcHRBc3NldChpZCwgcGF0aCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBpZCwgcGF0aCkgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuc2NyaXB0ID0gdW5kZWZpbmVkO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIFhIUlNjcmlwdEFzc2V0LnByb3RvdHlwZS5fbG9hZCA9IGZ1bmN0aW9uIChoYW5kbGVyKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBsb2FkZXIgPSBuZXcgWEhSTG9hZGVyXzEuWEhSTG9hZGVyKCk7XG4gICAgICAgIGxvYWRlci5nZXQodGhpcy5wYXRoLCBmdW5jdGlvbiAoZXJyb3IsIHJlc3BvbnNlVGV4dCkge1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5fb25Bc3NldEVycm9yKF90aGlzLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMuc2NyaXB0ID0gcmVzcG9uc2VUZXh0ICsgXCJcXG5cIjtcbiAgICAgICAgICAgIGhhbmRsZXIuX29uQXNzZXRMb2FkKF90aGlzKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBYSFJTY3JpcHRBc3NldC5wcm90b3R5cGUuZXhlY3V0ZSA9IGZ1bmN0aW9uIChleGVjRW52KSB7XG4gICAgICAgIC8vIFRPRE86IOOBk+OBruaWueW8j+OBp+OBr+iqreOBv+i+vOOCk+OBoOOCueOCr+ODquODl+ODiOOBjGNvb2tpZeWPgueFp+OBp+OBjeOCi+etieacrOizqueahOOBquWNsemZuuaAp+OBjOOBguOCi1xuICAgICAgICAvLyDkv6HpoLzjgafjgY3jgarjgYTjgrnjgq/jg6rjg5fjg4jjgpLoqq3jgb/ovrzjgoDjgojjgYbjgarjgrHjg7zjgrnjgafjga/jgIFpZnJhbWXjgavplonjgZjovrzjgoHjgablrp/ooYzjgarjganjga7mlrnlvI/jgpLmpJzoqI7jgZnjgovkuovjgIJcbiAgICAgICAgdmFyIGZ1bmMgPSB0aGlzLl93cmFwKCk7XG4gICAgICAgIGZ1bmMoZXhlY0Vudik7XG4gICAgICAgIHJldHVybiBleGVjRW52Lm1vZHVsZS5leHBvcnRzO1xuICAgIH07XG4gICAgWEhSU2NyaXB0QXNzZXQucHJvdG90eXBlLl93cmFwID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZnVuYyA9IG5ldyBGdW5jdGlvbihcImdcIiwgWEhSU2NyaXB0QXNzZXQuUFJFX1NDUklQVCArIHRoaXMuc2NyaXB0ICsgWEhSU2NyaXB0QXNzZXQuUE9TVF9TQ1JJUFQpO1xuICAgICAgICByZXR1cm4gZnVuYztcbiAgICB9O1xuICAgIFhIUlNjcmlwdEFzc2V0LlBSRV9TQ1JJUFQgPSBcIihmdW5jdGlvbihleHBvcnRzLCByZXF1aXJlLCBtb2R1bGUsIF9fZmlsZW5hbWUsIF9fZGlybmFtZSkge1wiO1xuICAgIFhIUlNjcmlwdEFzc2V0LlBPU1RfU0NSSVBUID0gXCJcXG59KShnLm1vZHVsZS5leHBvcnRzLCBnLm1vZHVsZS5yZXF1aXJlLCBnLm1vZHVsZSwgZy5maWxlbmFtZSwgZy5kaXJuYW1lKTtcIjtcbiAgICByZXR1cm4gWEhSU2NyaXB0QXNzZXQ7XG59KGcuU2NyaXB0QXNzZXQpKTtcbmV4cG9ydHMuWEhSU2NyaXB0QXNzZXQgPSBYSFJTY3JpcHRBc3NldDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlhIUlRleHRBc3NldCA9IHZvaWQgMDtcbnZhciBnID0gcmVxdWlyZShcIkBha2FzaGljL2FrYXNoaWMtZW5naW5lXCIpO1xudmFyIFhIUkxvYWRlcl8xID0gcmVxdWlyZShcIi4uL3V0aWxzL1hIUkxvYWRlclwiKTtcbnZhciBYSFJUZXh0QXNzZXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFhIUlRleHRBc3NldCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBYSFJUZXh0QXNzZXQoaWQsIHBhdGgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgaWQsIHBhdGgpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLmRhdGEgPSB1bmRlZmluZWQ7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgWEhSVGV4dEFzc2V0LnByb3RvdHlwZS5fbG9hZCA9IGZ1bmN0aW9uIChoYW5kbGVyKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBsb2FkZXIgPSBuZXcgWEhSTG9hZGVyXzEuWEhSTG9hZGVyKCk7XG4gICAgICAgIGxvYWRlci5nZXQodGhpcy5wYXRoLCBmdW5jdGlvbiAoZXJyb3IsIHJlc3BvbnNlVGV4dCkge1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5fb25Bc3NldEVycm9yKF90aGlzLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMuZGF0YSA9IHJlc3BvbnNlVGV4dDtcbiAgICAgICAgICAgIGhhbmRsZXIuX29uQXNzZXRMb2FkKF90aGlzKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gWEhSVGV4dEFzc2V0O1xufShnLlRleHRBc3NldCkpO1xuZXhwb3J0cy5YSFJUZXh0QXNzZXQgPSBYSFJUZXh0QXNzZXQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQWZmaW5lVHJhbnNmb3JtZXIgPSB2b2lkIDA7XG52YXIgQWZmaW5lVHJhbnNmb3JtZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQWZmaW5lVHJhbnNmb3JtZXIocmhzKSB7XG4gICAgICAgIGlmIChyaHMpIHtcbiAgICAgICAgICAgIHRoaXMubWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheShyaHMubWF0cml4KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheShbMSwgMCwgMCwgMSwgMCwgMF0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIEFmZmluZVRyYW5zZm9ybWVyLnByb3RvdHlwZS5zY2FsZSA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgIHZhciBtID0gdGhpcy5tYXRyaXg7XG4gICAgICAgIG1bMF0gKj0geDtcbiAgICAgICAgbVsxXSAqPSB4O1xuICAgICAgICBtWzJdICo9IHk7XG4gICAgICAgIG1bM10gKj0geTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBBZmZpbmVUcmFuc2Zvcm1lci5wcm90b3R5cGUudHJhbnNsYXRlID0gZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAgICAgdmFyIG0gPSB0aGlzLm1hdHJpeDtcbiAgICAgICAgbVs0XSArPSBtWzBdICogeCArIG1bMl0gKiB5O1xuICAgICAgICBtWzVdICs9IG1bMV0gKiB4ICsgbVszXSAqIHk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgQWZmaW5lVHJhbnNmb3JtZXIucHJvdG90eXBlLnRyYW5zZm9ybSA9IGZ1bmN0aW9uIChtYXRyaXgpIHtcbiAgICAgICAgdmFyIG0gPSB0aGlzLm1hdHJpeDtcbiAgICAgICAgdmFyIGEgPSBtYXRyaXhbMF0gKiBtWzBdICsgbWF0cml4WzFdICogbVsyXTtcbiAgICAgICAgdmFyIGIgPSBtYXRyaXhbMF0gKiBtWzFdICsgbWF0cml4WzFdICogbVszXTtcbiAgICAgICAgdmFyIGMgPSBtYXRyaXhbMl0gKiBtWzBdICsgbWF0cml4WzNdICogbVsyXTtcbiAgICAgICAgdmFyIGQgPSBtYXRyaXhbMl0gKiBtWzFdICsgbWF0cml4WzNdICogbVszXTtcbiAgICAgICAgdmFyIGUgPSBtYXRyaXhbNF0gKiBtWzBdICsgbWF0cml4WzVdICogbVsyXSArIG1bNF07XG4gICAgICAgIHZhciBmID0gbWF0cml4WzRdICogbVsxXSArIG1hdHJpeFs1XSAqIG1bM10gKyBtWzVdO1xuICAgICAgICBtWzBdID0gYTtcbiAgICAgICAgbVsxXSA9IGI7XG4gICAgICAgIG1bMl0gPSBjO1xuICAgICAgICBtWzNdID0gZDtcbiAgICAgICAgbVs0XSA9IGU7XG4gICAgICAgIG1bNV0gPSBmO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIEFmZmluZVRyYW5zZm9ybWVyLnByb3RvdHlwZS5zZXRUcmFuc2Zvcm0gPSBmdW5jdGlvbiAobWF0cml4KSB7XG4gICAgICAgIHZhciBtID0gdGhpcy5tYXRyaXg7XG4gICAgICAgIG1bMF0gPSBtYXRyaXhbMF07XG4gICAgICAgIG1bMV0gPSBtYXRyaXhbMV07XG4gICAgICAgIG1bMl0gPSBtYXRyaXhbMl07XG4gICAgICAgIG1bM10gPSBtYXRyaXhbM107XG4gICAgICAgIG1bNF0gPSBtYXRyaXhbNF07XG4gICAgICAgIG1bNV0gPSBtYXRyaXhbNV07XG4gICAgfTtcbiAgICBBZmZpbmVUcmFuc2Zvcm1lci5wcm90b3R5cGUuY29weUZyb20gPSBmdW5jdGlvbiAocmhzKSB7XG4gICAgICAgIHRoaXMubWF0cml4LnNldChyaHMubWF0cml4KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICByZXR1cm4gQWZmaW5lVHJhbnNmb3JtZXI7XG59KCkpO1xuZXhwb3J0cy5BZmZpbmVUcmFuc2Zvcm1lciA9IEFmZmluZVRyYW5zZm9ybWVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ2FudmFzU3VyZmFjZSA9IHZvaWQgMDtcbnZhciBnID0gcmVxdWlyZShcIkBha2FzaGljL2FrYXNoaWMtZW5naW5lXCIpO1xudmFyIENhbnZhc1N1cmZhY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKENhbnZhc1N1cmZhY2UsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQ2FudmFzU3VyZmFjZSh3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgICAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHdpZHRoLCBoZWlnaHQsIGNhbnZhcykgfHwgdGhpcztcbiAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIF90aGlzLmNhbnZhcyA9IGNhbnZhcztcbiAgICAgICAgX3RoaXMuX3JlbmRlcmVyID0gdW5kZWZpbmVkO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIENhbnZhc1N1cmZhY2UucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gMTtcbiAgICAgICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gMTtcbiAgICAgICAgdGhpcy5jYW52YXMgPSBudWxsO1xuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IG51bGw7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpO1xuICAgIH07XG4gICAgQ2FudmFzU3VyZmFjZS5wcm90b3R5cGUuZ2V0SFRNTEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhbnZhcztcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOihqOekuuS4iuOBruaLoeWkp+eOh+OCkuWkieabtOOBmeOCi+OAglxuICAgICAqIGBjaGFuZ2VSYXdTaXplKClgIOOBqOOBruW3rueVsOOBq+azqOaEj+OAglxuICAgICAqL1xuICAgIENhbnZhc1N1cmZhY2UucHJvdG90eXBlLmNoYW5nZVZpc3VhbFNjYWxlID0gZnVuY3Rpb24gKHhTY2FsZSwgeVNjYWxlKSB7XG4gICAgICAgIC8qXG4gICAgICAgICBDYW52YXPopoHntKDjga7jg6rjgrXjgqTjgrrjgpJDU1MgdHJhbnNmb3Jt44Gn6KGM44GG44CCXG4gICAgICAgICBDU1Pjga53aWR0aC9oZWlnaHQgc3R5bGXjgavjgojjgovjg6rjgrXjgqTjgrrjga/jgYrjgYvjgZfjgY/jgarjgovjgrHjg7zjgrnjgYzlrZjlnKjjgZnjgovjga7jgafjgIHlj6/og73jgarpmZDjgop0cmFuc2Zvcm3jgpLkvb/jgYbjgIJcbiAgICAgICAgIC0gaHR0cHM6Ly90d2l0dGVyLmNvbS91dXBhYS9zdGF0dXMvNjM5MDAyMzE3NTc2OTk4OTEyXG4gICAgICAgICAtIGh0dHA6Ly9oYXZlbG9nLmF5dW11c2F0by5jb20vZGV2ZWxvcC9wZXJmb3JtYW5jZS9lNTU0LXBhaW50X2dwdV9hY2NlbGVyYXRpb25fcHJvYmxlbXMuaHRtbFxuICAgICAgICAgLSBodHRwOi8vYnVjY2NoaS5qcC9ibG9nLzIwMTMvMDMvYW5kcm9pZF9jYW52YXNfZGVhdGhwb2ludC9cbiAgICAgICAgICovXG4gICAgICAgIHZhciBjYW52YXNTdHlsZSA9IHRoaXMuY2FudmFzLnN0eWxlO1xuICAgICAgICBpZiAoXCJ0cmFuc2Zvcm1cIiBpbiBjYW52YXNTdHlsZSkge1xuICAgICAgICAgICAgY2FudmFzU3R5bGUudHJhbnNmb3JtT3JpZ2luID0gXCIwIDBcIjtcbiAgICAgICAgICAgIGNhbnZhc1N0eWxlLnRyYW5zZm9ybSA9IFwic2NhbGUoXCIgKyB4U2NhbGUgKyBcIixcIiArIHlTY2FsZSArIFwiKVwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKFwid2Via2l0VHJhbnNmb3JtXCIgaW4gY2FudmFzU3R5bGUpIHtcbiAgICAgICAgICAgIGNhbnZhc1N0eWxlLndlYmtpdFRyYW5zZm9ybU9yaWdpbiA9IFwiMCAwXCI7XG4gICAgICAgICAgICBjYW52YXNTdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSBcInNjYWxlKFwiICsgeFNjYWxlICsgXCIsXCIgKyB5U2NhbGUgKyBcIilcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNhbnZhc1N0eWxlLndpZHRoID0gTWF0aC5mbG9vcih4U2NhbGUgKiB0aGlzLndpZHRoKSArIFwicHhcIjtcbiAgICAgICAgICAgIGNhbnZhc1N0eWxlLmhlaWdodCA9IE1hdGguZmxvb3IoeVNjYWxlICogdGhpcy53aWR0aCkgKyBcInB4XCI7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBDYW52YXNTdXJmYWNlO1xufShnLlN1cmZhY2UpKTtcbmV4cG9ydHMuQ2FudmFzU3VyZmFjZSA9IENhbnZhc1N1cmZhY2U7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5HbHlwaEZhY3RvcnkgPSB2b2lkIDA7XG52YXIgZyA9IHJlcXVpcmUoXCJAYWthc2hpYy9ha2FzaGljLWVuZ2luZVwiKTtcbnZhciBDb250ZXh0MkRTdXJmYWNlXzEgPSByZXF1aXJlKFwiLi9jb250ZXh0MmQvQ29udGV4dDJEU3VyZmFjZVwiKTtcbmZ1bmN0aW9uIGNyZWF0ZUdseXBoUmVuZGVyZWRTdXJmYWNlKGNvZGUsIGZvbnRTaXplLCBjc3NGb250RmFtaWx5LCBiYXNlbGluZUhlaWdodCwgbWFyZ2luVywgbWFyZ2luSCwgbmVlZEltYWdlRGF0YSwgZm9udENvbG9yLCBzdHJva2VXaWR0aCwgc3Ryb2tlQ29sb3IsIHN0cm9rZU9ubHksIGZvbnRXZWlnaHQpIHtcbiAgICAvLyDopoHmsYLjgZXjgozjgZ/jg5Xjgqnjg7Pjg4jjgrXjgqTjgrrjgYzmj4/nlLvlj6/og73jgarmnIDlsI/jg5Xjgqnjg7Pjg4jjgrXjgqTjgrrku6XkuIvjgaDjgaPjgZ/loLTlkIjjgIHlv4XopoHjgarjgrnjgrHjg7zjg6rjg7PjgrDkv4LmlbBcbiAgICB2YXIgc2NhbGUgPSBmb250U2l6ZSA8IEdseXBoRmFjdG9yeS5fZW52aXJvbm1lbnRNaW5pbXVtRm9udFNpemUgPyBmb250U2l6ZSAvIEdseXBoRmFjdG9yeS5fZW52aXJvbm1lbnRNaW5pbXVtRm9udFNpemUgOiAxO1xuICAgIHZhciBzdXJmYWNlV2lkdGggPSBNYXRoLmNlaWwoKGZvbnRTaXplICsgbWFyZ2luVyAqIDIpICogc2NhbGUpO1xuICAgIHZhciBzdXJmYWNlSGVpZ2h0ID0gTWF0aC5jZWlsKChmb250U2l6ZSArIG1hcmdpbkggKiAyKSAqIHNjYWxlKTtcbiAgICB2YXIgc3VyZmFjZSA9IG5ldyBDb250ZXh0MkRTdXJmYWNlXzEuQ29udGV4dDJEU3VyZmFjZShzdXJmYWNlV2lkdGgsIHN1cmZhY2VIZWlnaHQpO1xuICAgIC8vIE5PVEU6IGNhbnZhc+OCkuebtOaOpeaTjeS9nOOBmeOCi1xuICAgIC8vIOeQhueUsTpcbiAgICAvLyAqIFJlbmRlcmVyI2RyYXdTeXN0ZW1UZXh0KCnjgpLlu4PmraLjgb7jgZ/jga/pnZ7mjqjlpajjgavjgZfjgZ/jgYTjga7jgafjgZ3jgozjgpLnlKjjgYTjgZrmloflrZfliJfjgpLmj4/nlLvjgZnjgotcbiAgICAvLyAqIFJlbmRlcmluZ0hlbHBlcuOBjGNvbnRleHTjga7nirbmhYvjgpLlvqnluLDjgZnjgovjgZ/jgoFUZXh0TWV0cmljc+OCkuWPluOCjOOBquOBhFxuICAgIHZhciBjYW52YXMgPSBzdXJmYWNlLmNhbnZhcztcbiAgICB2YXIgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgdmFyIHN0ciA9IChjb2RlICYgMHhGRkZGMDAwMCkgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKChjb2RlICYgMHhGRkZGMDAwMCkgPj4+IDE2LCBjb2RlICYgMHhGRkZGKSA6IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSk7XG4gICAgdmFyIGZvbnRXZWlnaHRWYWx1ZSA9IGZvbnRXZWlnaHQgPT09IGcuRm9udFdlaWdodC5Cb2xkID8gXCJib2xkIFwiIDogXCJcIjtcbiAgICBjb250ZXh0LnNhdmUoKTtcbiAgICAvLyBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQuZm9udFxuICAgIC8vIHNlZTogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC9mb250XG4gICAgLy8gPiBUaGlzIHN0cmluZyB1c2VzIHRoZSBzYW1lIHN5bnRheCBhcyB0aGUgQ1NTIGZvbnQgc3BlY2lmaWVyLiBUaGUgZGVmYXVsdCBmb250IGlzIDEwcHggc2Fucy1zZXJpZi5cbiAgICBjb250ZXh0LmZvbnQgPSBmb250V2VpZ2h0VmFsdWUgKyBmb250U2l6ZSArIFwicHggXCIgKyBjc3NGb250RmFtaWx5O1xuICAgIGNvbnRleHQudGV4dEFsaWduID0gXCJsZWZ0XCI7XG4gICAgY29udGV4dC50ZXh0QmFzZWxpbmUgPSBcImFscGhhYmV0aWNcIjtcbiAgICBjb250ZXh0LmxpbmVKb2luID0gXCJiZXZlbFwiO1xuICAgIC8vIOaPj+eUu+WPr+iDveOBquacgOWwj+ODleOCqeODs+ODiOOCteOCpOOCuuS7peS4i+OBruODleOCqeODs+ODiOOCteOCpOOCuuOBr+OCueOCseODvOODquODs+OCsOOBp+Wun+ePvuOBmeOCi1xuICAgIGlmIChzY2FsZSAhPT0gMSlcbiAgICAgICAgY29udGV4dC5zY2FsZShzY2FsZSwgc2NhbGUpO1xuICAgIGlmIChzdHJva2VXaWR0aCA+IDApIHtcbiAgICAgICAgY29udGV4dC5saW5lV2lkdGggPSBzdHJva2VXaWR0aDtcbiAgICAgICAgY29udGV4dC5zdHJva2VTdHlsZSA9IHN0cm9rZUNvbG9yO1xuICAgICAgICBjb250ZXh0LnN0cm9rZVRleHQoc3RyLCBtYXJnaW5XLCBtYXJnaW5IICsgYmFzZWxpbmVIZWlnaHQpO1xuICAgIH1cbiAgICBpZiAoIXN0cm9rZU9ubHkpIHtcbiAgICAgICAgY29udGV4dC5maWxsU3R5bGUgPSBmb250Q29sb3I7XG4gICAgICAgIGNvbnRleHQuZmlsbFRleHQoc3RyLCBtYXJnaW5XLCBtYXJnaW5IICsgYmFzZWxpbmVIZWlnaHQpO1xuICAgIH1cbiAgICB2YXIgYWR2YW5jZVdpZHRoID0gY29udGV4dC5tZWFzdXJlVGV4dChzdHIpLndpZHRoO1xuICAgIGNvbnRleHQucmVzdG9yZSgpO1xuICAgIHZhciByZXN1bHQgPSB7XG4gICAgICAgIHN1cmZhY2U6IHN1cmZhY2UsXG4gICAgICAgIGFkdmFuY2VXaWR0aDogYWR2YW5jZVdpZHRoLFxuICAgICAgICBpbWFnZURhdGE6IG5lZWRJbWFnZURhdGEgPyBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpIDogdW5kZWZpbmVkXG4gICAgfTtcbiAgICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gY2FsY0dseXBoQXJlYShpbWFnZURhdGEpIHtcbiAgICB2YXIgc3ggPSBpbWFnZURhdGEud2lkdGg7XG4gICAgdmFyIHN5ID0gaW1hZ2VEYXRhLmhlaWdodDtcbiAgICB2YXIgZXggPSAwO1xuICAgIHZhciBleSA9IDA7XG4gICAgdmFyIGN1cnJlbnRQb3MgPSAwO1xuICAgIGZvciAodmFyIHkgPSAwLCBoZWlnaHQgPSBpbWFnZURhdGEuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5ID0gKHkgKyAxKSB8IDApIHtcbiAgICAgICAgZm9yICh2YXIgeCA9IDAsIHdpZHRoID0gaW1hZ2VEYXRhLndpZHRoOyB4IDwgd2lkdGg7IHggPSAoeCArIDEpIHwgMCkge1xuICAgICAgICAgICAgdmFyIGEgPSBpbWFnZURhdGEuZGF0YVtjdXJyZW50UG9zICsgM107IC8vIGdldCBhbHBoYSB2YWx1ZVxuICAgICAgICAgICAgaWYgKGEgIT09IDApIHtcbiAgICAgICAgICAgICAgICBpZiAoeCA8IHN4KSB7XG4gICAgICAgICAgICAgICAgICAgIHN4ID0geDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHggPiBleCkge1xuICAgICAgICAgICAgICAgICAgICBleCA9IHg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh5IDwgc3kpIHtcbiAgICAgICAgICAgICAgICAgICAgc3kgPSB5O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoeSA+IGV5KSB7XG4gICAgICAgICAgICAgICAgICAgIGV5ID0geTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdXJyZW50UG9zICs9IDQ7IC8vIGdvIHRvIG5leHQgcGl4ZWxcbiAgICAgICAgfVxuICAgIH1cbiAgICB2YXIgZ2x5cGhBcmVhID0gdW5kZWZpbmVkO1xuICAgIGlmIChzeCA9PT0gaW1hZ2VEYXRhLndpZHRoKSB7IC8vIOepuueZveaWh+Wtl1xuICAgICAgICBnbHlwaEFyZWEgPSB7IHg6IDAsIHk6IDAsIHdpZHRoOiAwLCBoZWlnaHQ6IDAgfTsgLy8g56m644Gu6aCY5Z+f44Gr6Kit5a6aXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBzeCwgc3ksIGV4LCBleeOBr+W6p+aomeOBp+OBr+OBquOBj+eUu+e0oOOBruODoeODouODquS4iuOBruS9jee9ruOCkuaMh+OBmea3u+Wtl+OAglxuICAgICAgICAvLyDmlYXjgat3aWR0aCwgaGVpZ2h044KS566X5Ye644GZ44KL5pmCIDEg5Yqg566X44GZ44KL44CCXG4gICAgICAgIGdseXBoQXJlYSA9IHsgeDogc3gsIHk6IHN5LCB3aWR0aDogZXggLSBzeCArIDEsIGhlaWdodDogZXkgLSBzeSArIDEgfTtcbiAgICB9XG4gICAgcmV0dXJuIGdseXBoQXJlYTtcbn1cbmZ1bmN0aW9uIGlzR2x5cGhBcmVhRW1wdHkoZ2x5cGhBcmVhKSB7XG4gICAgcmV0dXJuIGdseXBoQXJlYS53aWR0aCA9PT0gMCB8fCBnbHlwaEFyZWEuaGVpZ2h0ID09PSAwO1xufVxuZnVuY3Rpb24gZm9udEZhbWlseTJGb250RmFtaWx5TmFtZShmb250RmFtaWx5KSB7XG4gICAgc3dpdGNoIChmb250RmFtaWx5KSB7XG4gICAgICAgIGNhc2UgZy5Gb250RmFtaWx5Lk1vbm9zcGFjZTpcbiAgICAgICAgICAgIHJldHVybiBcIm1vbm9zcGFjZVwiO1xuICAgICAgICBjYXNlIGcuRm9udEZhbWlseS5TZXJpZjpcbiAgICAgICAgICAgIHJldHVybiBcInNlcmlmXCI7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gXCJzYW5zLXNlcmlmXCI7XG4gICAgfVxufVxuLy8g44K444Kn44ON44Oq44OD44Kv44OV44Kp44Oz44OI44OV44Kh44Of44Oq44Go44GX44Gm5a6a576p44GV44KM44Gm44GE44KL44Kt44O844Ov44O844OJ44Gu44Oq44K544OIXG4vLyBzZWU6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0NTUy9mb250LWZhbWlseVxudmFyIGdlbmVyaWNGb250RmFtaWx5TmFtZXMgPSBbXG4gICAgXCJzZXJpZlwiLCBcInNhbnMtc2VyaWZcIiwgXCJtb25vc3BhY2VcIiwgXCJjdXJzaXZlXCIsIFwiZmFudGFzeVwiLCBcInN5c3RlbS11aVwiXG5dO1xuLy8g44K444Kn44ON44Oq44OD44Kv44OV44Kp44Oz44OI44OV44Kh44Of44Oq44Gn44Gq44GE5pmC44Kv44Kp44O844OI44GZ44KL44CCXG4vLyA+IEZvbnQgZmFtaWx5IG5hbWVzIG11c3QgZWl0aGVyIGJlIGdpdmVuIHF1b3RlZCBhcyBzdHJpbmdzLCBvciB1bnF1b3RlZCBhcyBhIHNlcXVlbmNlIG9mIG9uZSBvciBtb3JlIGlkZW50aWZpZXJzLlxuLy8gPiBHZW5lcmljIGZhbWlseSBuYW1lcyBhcmUga2V5d29yZHMgYW5kIG11c3Qgbm90IGJlIHF1b3RlZC5cbi8vIHNlZTogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL2ZvbnQtZmFtaWx5XG5mdW5jdGlvbiBxdW90ZUlmTm90R2VuZXJpYyhuYW1lKSB7XG4gICAgaWYgKGdlbmVyaWNGb250RmFtaWx5TmFtZXMuaW5kZXhPZihuYW1lKSAhPT0gLTEpIHtcbiAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gXCJcXFwiXCIgKyBuYW1lICsgXCJcXFwiXCI7XG4gICAgfVxufVxuZnVuY3Rpb24gZm9udEZhbWlseTJDU1NGb250RmFtaWx5KGZvbnRGYW1pbHkpIHtcbiAgICBpZiAodHlwZW9mIGZvbnRGYW1pbHkgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgcmV0dXJuIGZvbnRGYW1pbHkyRm9udEZhbWlseU5hbWUoZm9udEZhbWlseSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiBmb250RmFtaWx5ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHJldHVybiBxdW90ZUlmTm90R2VuZXJpYyhmb250RmFtaWx5KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBmb250RmFtaWx5Lm1hcChmdW5jdGlvbiAoZm9udCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBmb250ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHF1b3RlSWZOb3RHZW5lcmljKGZvbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZvbnRGYW1pbHkyRm9udEZhbWlseU5hbWUoZm9udCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLmpvaW4oXCIsXCIpO1xuICAgIH1cbn1cbnZhciBHbHlwaEZhY3RvcnkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEdseXBoRmFjdG9yeSwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBHbHlwaEZhY3RvcnkoZm9udEZhbWlseSwgZm9udFNpemUsIGJhc2VsaW5lSGVpZ2h0LCBmb250Q29sb3IsIHN0cm9rZVdpZHRoLCBzdHJva2VDb2xvciwgc3Ryb2tlT25seSwgZm9udFdlaWdodCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBmb250RmFtaWx5LCBmb250U2l6ZSwgYmFzZWxpbmVIZWlnaHQsIGZvbnRDb2xvciwgc3Ryb2tlV2lkdGgsIHN0cm9rZUNvbG9yLCBzdHJva2VPbmx5LCBmb250V2VpZ2h0KSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5fZ2x5cGhBcmVhcyA9IHt9O1xuICAgICAgICBfdGhpcy5fY3NzRm9udEZhbWlseSA9IGZvbnRGYW1pbHkyQ1NTRm9udEZhbWlseShmb250RmFtaWx5KTtcbiAgICAgICAgLy8gQWthc2hpY+OCqOODs+OCuOODs+OBr+aMh+WumuOBleOCjOOBn+ODleOCqeODs+ODiOOBq+WIqeeUqOWPr+iDveOBquOCguOBruOBjOimi+OBpOOBi+OCieOBquOBhOaZglxuICAgICAgICAvLyBgZy5Gb250RmFtaWx5LlNhbnNTZXJpZmAg44KS5Yip55So44GZ44KL44CB44Go5LuV5qeY44GX44Gm5a6a44KB44KJ44KM44Gm44GE44KL44CCXG4gICAgICAgIHZhciBmYWxsYmFja0ZvbnRGYW1pbHlOYW1lID0gZm9udEZhbWlseTJGb250RmFtaWx5TmFtZShnLkZvbnRGYW1pbHkuU2Fuc1NlcmlmKTtcbiAgICAgICAgaWYgKF90aGlzLl9jc3NGb250RmFtaWx5LmluZGV4T2YoZmFsbGJhY2tGb250RmFtaWx5TmFtZSkgPT09IC0xKSB7XG4gICAgICAgICAgICBfdGhpcy5fY3NzRm9udEZhbWlseSArPSBcIixcIiArIGZhbGxiYWNrRm9udEZhbWlseU5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gYHRoaXMuZm9udFNpemVg44Gu5aSn44GN44GV44Gu5paH5a2X44KS5o+P55S744GZ44KL44Gf44KB44Gu44K144O844OV44Kn44K544KS55Sf5oiQ44GZ44KL44CCXG4gICAgICAgIC8vIOS4gOmDqOOBruaWh+Wtl+OBr+e4puaoquOBjGB0aGlzLmZvbnRTaXplYOW5heOBruefqeW9ouOBq+WPjuOBvuOCieOBquOBhOOAglxuICAgICAgICAvLyDjgZ3jgZPjgafkuIrkuIvlt6blj7Pjgavjg57jg7zjgrjjg7PjgpLoqK3jgZHjgovjgILjg57jg7zjgrjjg7PluYXjga9gdGhpcy5mb250U2l6ZWDjgatcbiAgICAgICAgLy8gMC4zIOOCkuS5l+OBmOOBn+OCguOBruOBq+OBmeOCi+OAgjAuM+OBq+eiuuOBn+OCi+agueaLoOOBr+OBquOBhOOBjOOAgeaknOiovOOBl+OBn+evhOWbsuOBp+OBr1xuICAgICAgICAvLyDjgZPjgozjgafljYHliIbjgafjgYLjgovjgZPjgajjgpLnorroqo3jgZfjgabjgYTjgovjgIJcbiAgICAgICAgLy9cbiAgICAgICAgLy8gc3Ryb2tlV2lkdGjjgrXjg53jg7zjg4jjgavkvLTjgYTjgIHovKrpg63nt5rjga7ljprjgb/jgpLliqDlkbPjgZfjgabjgYTjgovjgIJcbiAgICAgICAgX3RoaXMuX21hcmdpblcgPSBNYXRoLmNlaWwoX3RoaXMuZm9udFNpemUgKiAwLjMgKyBfdGhpcy5zdHJva2VXaWR0aCAvIDIpO1xuICAgICAgICBfdGhpcy5fbWFyZ2luSCA9IE1hdGguY2VpbChfdGhpcy5mb250U2l6ZSAqIDAuMyArIF90aGlzLnN0cm9rZVdpZHRoIC8gMik7XG4gICAgICAgIGlmIChHbHlwaEZhY3RvcnkuX2Vudmlyb25tZW50TWluaW11bUZvbnRTaXplID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIEdseXBoRmFjdG9yeS5fZW52aXJvbm1lbnRNaW5pbXVtRm9udFNpemUgPSBfdGhpcy5tZWFzdXJlTWluaW11bUZvbnRTaXplKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBHbHlwaEZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChjb2RlKSB7XG4gICAgICAgIHZhciByZXN1bHQ7XG4gICAgICAgIHZhciBnbHlwaEFyZWEgPSB0aGlzLl9nbHlwaEFyZWFzW2NvZGVdO1xuICAgICAgICBpZiAoIWdseXBoQXJlYSkge1xuICAgICAgICAgICAgcmVzdWx0ID0gY3JlYXRlR2x5cGhSZW5kZXJlZFN1cmZhY2UoY29kZSwgdGhpcy5mb250U2l6ZSwgdGhpcy5fY3NzRm9udEZhbWlseSwgdGhpcy5iYXNlbGluZUhlaWdodCwgdGhpcy5fbWFyZ2luVywgdGhpcy5fbWFyZ2luSCwgdHJ1ZSwgdGhpcy5mb250Q29sb3IsIHRoaXMuc3Ryb2tlV2lkdGgsIHRoaXMuc3Ryb2tlQ29sb3IsIHRoaXMuc3Ryb2tlT25seSwgdGhpcy5mb250V2VpZ2h0KTtcbiAgICAgICAgICAgIGdseXBoQXJlYSA9IGNhbGNHbHlwaEFyZWEocmVzdWx0LmltYWdlRGF0YSk7XG4gICAgICAgICAgICBnbHlwaEFyZWEuYWR2YW5jZVdpZHRoID0gcmVzdWx0LmFkdmFuY2VXaWR0aDtcbiAgICAgICAgICAgIHRoaXMuX2dseXBoQXJlYXNbY29kZV0gPSBnbHlwaEFyZWE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzR2x5cGhBcmVhRW1wdHkoZ2x5cGhBcmVhKSkge1xuICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5zdXJmYWNlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgZy5HbHlwaChjb2RlLCAwLCAwLCAwLCAwLCAwLCAwLCBnbHlwaEFyZWEuYWR2YW5jZVdpZHRoLCB1bmRlZmluZWQsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gZy5HbHlwaOOBq+agvOe0jeOBmeOCi+OCteODvOODleOCp+OCueOCkueUn+aIkOOBmeOCi+OAglxuICAgICAgICAgICAgLy8gZ2x5cGhBcmVh44Gv44K144O844OV44Kn44K544KS44Kt44Oj44OD44K344Ol44GX44Gq44GE44Gf44KB44CB5o+P55S744GZ44KL5YaF5a6544KS5oyB44Gk44Kw44Oq44OV44Gr5a++44GX44Gm44GvXG4gICAgICAgICAgICAvLyDjgrXjg7zjg5XjgqfjgrnjgpLnlJ/miJDjgZnjgovjgILjgoLjgZfliY3mrrXjgadjYWxjR2x5cGhBcmVhKCnjga7jgZ/jgoHjga7jgrXjg7zjg5XjgqfjgrnjgpLnlJ/miJDjgZfjgaZcbiAgICAgICAgICAgIC8vIOOBhOOCjOOBsOOBk+OBk+OBp+OBr+eUn+aIkOOBm+OBmuOBq+OBneOCjOOCkuWIqeeUqOOBmeOCi+OAglxuICAgICAgICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBjcmVhdGVHbHlwaFJlbmRlcmVkU3VyZmFjZShjb2RlLCB0aGlzLmZvbnRTaXplLCB0aGlzLl9jc3NGb250RmFtaWx5LCB0aGlzLmJhc2VsaW5lSGVpZ2h0LCB0aGlzLl9tYXJnaW5XLCB0aGlzLl9tYXJnaW5ILCBmYWxzZSwgdGhpcy5mb250Q29sb3IsIHRoaXMuc3Ryb2tlV2lkdGgsIHRoaXMuc3Ryb2tlQ29sb3IsIHRoaXMuc3Ryb2tlT25seSwgdGhpcy5mb250V2VpZ2h0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgZy5HbHlwaChjb2RlLCBnbHlwaEFyZWEueCwgZ2x5cGhBcmVhLnksIGdseXBoQXJlYS53aWR0aCwgZ2x5cGhBcmVhLmhlaWdodCwgZ2x5cGhBcmVhLnggLSB0aGlzLl9tYXJnaW5XLCBnbHlwaEFyZWEueSAtIHRoaXMuX21hcmdpbkgsIGdseXBoQXJlYS5hZHZhbmNlV2lkdGgsIHJlc3VsdC5zdXJmYWNlLCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLy8g5a6f6KGM55Kw5aKD44Gu5o+P55S75Y+v6IO944Gq44OV44Kp44Oz44OI44K144Kk44K644Gu5pyA5bCP5YCk44KS6L+U44GZXG4gICAgR2x5cGhGYWN0b3J5LnByb3RvdHlwZS5tZWFzdXJlTWluaW11bUZvbnRTaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZm9udFNpemUgPSAxO1xuICAgICAgICB2YXIgc3RyID0gXCJNXCI7XG4gICAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgICAgICB2YXIgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgIGNvbnRleHQudGV4dEFsaWduID0gXCJsZWZ0XCI7XG4gICAgICAgIGNvbnRleHQudGV4dEJhc2VsaW5lID0gXCJhbHBoYWJldGljXCI7XG4gICAgICAgIGNvbnRleHQubGluZUpvaW4gPSBcImJldmVsXCI7XG4gICAgICAgIHZhciBwcmVXaWR0aDtcbiAgICAgICAgY29udGV4dC5mb250ID0gZm9udFNpemUgKyBcInB4IHNhbnMtc2VyaWZcIjtcbiAgICAgICAgdmFyIHdpZHRoID0gY29udGV4dC5tZWFzdXJlVGV4dChzdHIpLndpZHRoO1xuICAgICAgICBkbyB7XG4gICAgICAgICAgICBwcmVXaWR0aCA9IHdpZHRoO1xuICAgICAgICAgICAgZm9udFNpemUgKz0gMTtcbiAgICAgICAgICAgIGNvbnRleHQuZm9udCA9IGZvbnRTaXplICsgXCJweCBzYW5zLXNlcmlmXCI7XG4gICAgICAgICAgICB3aWR0aCA9IGNvbnRleHQubWVhc3VyZVRleHQoc3RyKS53aWR0aDtcbiAgICAgICAgfSB3aGlsZSAocHJlV2lkdGggPT09IHdpZHRoIHx8IGZvbnRTaXplID4gNTApOyAvLyDjg5Xjgqnjg7Pjg4jjgrXjgqTjgrrjgavlr77lv5zjgZfjgarjgYTli5XkvZznkrDlooPjga7loLTlkIjjgpLogIPmha7jgZfjgabkuIrpmZDlgKTjgpLoqK3jgZHjgotcbiAgICAgICAgcmV0dXJuIGZvbnRTaXplO1xuICAgIH07XG4gICAgcmV0dXJuIEdseXBoRmFjdG9yeTtcbn0oZy5HbHlwaEZhY3RvcnkpKTtcbmV4cG9ydHMuR2x5cGhGYWN0b3J5ID0gR2x5cGhGYWN0b3J5O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlJlbmRlcmluZ0hlbHBlciA9IHZvaWQgMDtcbnZhciBSZW5kZXJpbmdIZWxwZXI7XG4oZnVuY3Rpb24gKFJlbmRlcmluZ0hlbHBlcikge1xuICAgIGZ1bmN0aW9uIHRvUG93ZXJPZlR3byh4KSB7XG4gICAgICAgIGlmICgoeCAmICh4IC0gMSkpICE9PSAwKSB7XG4gICAgICAgICAgICB2YXIgeSA9IDE7XG4gICAgICAgICAgICB3aGlsZSAoeSA8IHgpIHtcbiAgICAgICAgICAgICAgICB5ICo9IDI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4geTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geDtcbiAgICB9XG4gICAgUmVuZGVyaW5nSGVscGVyLnRvUG93ZXJPZlR3byA9IHRvUG93ZXJPZlR3bztcbiAgICBmdW5jdGlvbiBjbGFtcCh4KSB7XG4gICAgICAgIHJldHVybiBNYXRoLm1pbihNYXRoLm1heCh4LCAwLjApLCAxLjApO1xuICAgIH1cbiAgICBSZW5kZXJpbmdIZWxwZXIuY2xhbXAgPSBjbGFtcDtcbiAgICBmdW5jdGlvbiB1c2VkV2ViR0wocmVuZGVyZXJDYW5kaWRhdGVzKSB7XG4gICAgICAgIHZhciB1c2VkID0gZmFsc2U7XG4gICAgICAgIGlmIChyZW5kZXJlckNhbmRpZGF0ZXMgJiYgKDAgPCByZW5kZXJlckNhbmRpZGF0ZXMubGVuZ3RoKSkge1xuICAgICAgICAgICAgdXNlZCA9IChyZW5kZXJlckNhbmRpZGF0ZXNbMF0gPT09IFwid2ViZ2xcIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVzZWQ7XG4gICAgfVxuICAgIFJlbmRlcmluZ0hlbHBlci51c2VkV2ViR0wgPSB1c2VkV2ViR0w7XG59KShSZW5kZXJpbmdIZWxwZXIgPSBleHBvcnRzLlJlbmRlcmluZ0hlbHBlciB8fCAoZXhwb3J0cy5SZW5kZXJpbmdIZWxwZXIgPSB7fSkpO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNhbnZhc1JlbmRlcmluZ1N0YXRlID0gdm9pZCAwO1xudmFyIEFmZmluZVRyYW5zZm9ybWVyXzEgPSByZXF1aXJlKFwiLi4vQWZmaW5lVHJhbnNmb3JtZXJcIik7XG52YXIgQ2FudmFzUmVuZGVyaW5nU3RhdGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQ2FudmFzUmVuZGVyaW5nU3RhdGUoY3JzKSB7XG4gICAgICAgIGlmIChjcnMpIHtcbiAgICAgICAgICAgIHRoaXMuZmlsbFN0eWxlID0gY3JzLmZpbGxTdHlsZTtcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsQWxwaGEgPSBjcnMuZ2xvYmFsQWxwaGE7XG4gICAgICAgICAgICB0aGlzLmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IGNycy5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb247XG4gICAgICAgICAgICB0aGlzLnRyYW5zZm9ybWVyID0gbmV3IEFmZmluZVRyYW5zZm9ybWVyXzEuQWZmaW5lVHJhbnNmb3JtZXIoY3JzLnRyYW5zZm9ybWVyKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZmlsbFN0eWxlID0gXCIjMDAwMDAwXCI7XG4gICAgICAgICAgICB0aGlzLmdsb2JhbEFscGhhID0gMS4wO1xuICAgICAgICAgICAgdGhpcy5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcInNvdXJjZS1vdmVyXCI7XG4gICAgICAgICAgICB0aGlzLnRyYW5zZm9ybWVyID0gbmV3IEFmZmluZVRyYW5zZm9ybWVyXzEuQWZmaW5lVHJhbnNmb3JtZXIoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gQ2FudmFzUmVuZGVyaW5nU3RhdGU7XG59KCkpO1xuZXhwb3J0cy5DYW52YXNSZW5kZXJpbmdTdGF0ZSA9IENhbnZhc1JlbmRlcmluZ1N0YXRlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNhbnZhc1N1cmZhY2VDb250ZXh0ID0gdm9pZCAwO1xudmFyIENhbnZhc1JlbmRlcmluZ1N0YXRlXzEgPSByZXF1aXJlKFwiLi9DYW52YXNSZW5kZXJpbmdTdGF0ZVwiKTtcbnZhciBDYW52YXNTdXJmYWNlQ29udGV4dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDYW52YXNTdXJmYWNlQ29udGV4dChjb250ZXh0KSB7XG4gICAgICAgIHRoaXMuX3N0YXRlU3RhY2sgPSBbXTtcbiAgICAgICAgdGhpcy5fbW9kaWZpZWRUcmFuc2Zvcm0gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fY29udGV4dCA9IGNvbnRleHQ7XG4gICAgICAgIHZhciBzdGF0ZSA9IG5ldyBDYW52YXNSZW5kZXJpbmdTdGF0ZV8xLkNhbnZhc1JlbmRlcmluZ1N0YXRlKCk7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRGaWxsU3R5bGUgPSBzdGF0ZS5maWxsU3R5bGU7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRHbG9iYWxBbHBoYSA9IHN0YXRlLmdsb2JhbEFscGhhO1xuICAgICAgICB0aGlzLl9jdXJyZW50R2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gc3RhdGUuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uO1xuICAgICAgICB0aGlzLnB1c2hTdGF0ZShzdGF0ZSk7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDYW52YXNTdXJmYWNlQ29udGV4dC5wcm90b3R5cGUsIFwiZmlsbFN0eWxlXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50U3RhdGUoKS5maWxsU3R5bGU7XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gKGZpbGxTdHlsZSkge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50U3RhdGUoKS5maWxsU3R5bGUgPSBmaWxsU3R5bGU7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2FudmFzU3VyZmFjZUNvbnRleHQucHJvdG90eXBlLCBcImdsb2JhbEFscGhhXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50U3RhdGUoKS5nbG9iYWxBbHBoYTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAoZ2xvYmFsQWxwaGEpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFN0YXRlKCkuZ2xvYmFsQWxwaGEgPSBnbG9iYWxBbHBoYTtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDYW52YXNTdXJmYWNlQ29udGV4dC5wcm90b3R5cGUsIFwiZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50U3RhdGUoKS5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb247XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gKG9wZXJhdGlvbikge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50U3RhdGUoKS5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBvcGVyYXRpb247XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBDYW52YXNTdXJmYWNlQ29udGV4dC5wcm90b3R5cGUuZ2V0Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY29udGV4dDtcbiAgICB9O1xuICAgIENhbnZhc1N1cmZhY2VDb250ZXh0LnByb3RvdHlwZS5jbGVhclJlY3QgPSBmdW5jdGlvbiAoeCwgeSwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICB0aGlzLnByZXJlbmRlcigpO1xuICAgICAgICB0aGlzLl9jb250ZXh0LmNsZWFyUmVjdCh4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB9O1xuICAgIENhbnZhc1N1cmZhY2VDb250ZXh0LnByb3RvdHlwZS5zYXZlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc3RhdGUgPSBuZXcgQ2FudmFzUmVuZGVyaW5nU3RhdGVfMS5DYW52YXNSZW5kZXJpbmdTdGF0ZSh0aGlzLmN1cnJlbnRTdGF0ZSgpKTtcbiAgICAgICAgdGhpcy5wdXNoU3RhdGUoc3RhdGUpO1xuICAgIH07XG4gICAgQ2FudmFzU3VyZmFjZUNvbnRleHQucHJvdG90eXBlLnJlc3RvcmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucG9wU3RhdGUoKTtcbiAgICB9O1xuICAgIENhbnZhc1N1cmZhY2VDb250ZXh0LnByb3RvdHlwZS5zY2FsZSA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgIHRoaXMuY3VycmVudFN0YXRlKCkudHJhbnNmb3JtZXIuc2NhbGUoeCwgeSk7XG4gICAgICAgIHRoaXMuX21vZGlmaWVkVHJhbnNmb3JtID0gdHJ1ZTtcbiAgICB9O1xuICAgIENhbnZhc1N1cmZhY2VDb250ZXh0LnByb3RvdHlwZS5kcmF3SW1hZ2UgPSBmdW5jdGlvbiAoaW1hZ2UsIHNyY1gsIHNyY1ksIHNyY1csIHNyY0gsIGRzdFgsIGRzdFksIGRzdFcsIGRzdEgpIHtcbiAgICAgICAgdGhpcy5wcmVyZW5kZXIoKTtcbiAgICAgICAgdGhpcy5fY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIHNyY1gsIHNyY1ksIHNyY1csIHNyY0gsIGRzdFgsIGRzdFksIGRzdFcsIGRzdEgpO1xuICAgIH07XG4gICAgQ2FudmFzU3VyZmFjZUNvbnRleHQucHJvdG90eXBlLmZpbGxSZWN0ID0gZnVuY3Rpb24gKHgsIHksIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgdGhpcy5wcmVyZW5kZXIoKTtcbiAgICAgICAgdGhpcy5fY29udGV4dC5maWxsUmVjdCh4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB9O1xuICAgIENhbnZhc1N1cmZhY2VDb250ZXh0LnByb3RvdHlwZS5maWxsVGV4dCA9IGZ1bmN0aW9uICh0ZXh0LCB4LCB5LCBtYXhXaWR0aCkge1xuICAgICAgICB0aGlzLnByZXJlbmRlcigpO1xuICAgICAgICB0aGlzLl9jb250ZXh0LmZpbGxUZXh0KHRleHQsIHgsIHksIG1heFdpZHRoKTtcbiAgICB9O1xuICAgIENhbnZhc1N1cmZhY2VDb250ZXh0LnByb3RvdHlwZS5zdHJva2VUZXh0ID0gZnVuY3Rpb24gKHRleHQsIHgsIHksIG1heFdpZHRoKSB7XG4gICAgICAgIHRoaXMucHJlcmVuZGVyKCk7XG4gICAgICAgIHRoaXMuX2NvbnRleHQuc3Ryb2tlVGV4dCh0ZXh0LCB4LCB5LCBtYXhXaWR0aCk7XG4gICAgfTtcbiAgICBDYW52YXNTdXJmYWNlQ29udGV4dC5wcm90b3R5cGUudHJhbnNsYXRlID0gZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50U3RhdGUoKS50cmFuc2Zvcm1lci50cmFuc2xhdGUoeCwgeSk7XG4gICAgICAgIHRoaXMuX21vZGlmaWVkVHJhbnNmb3JtID0gdHJ1ZTtcbiAgICB9O1xuICAgIENhbnZhc1N1cmZhY2VDb250ZXh0LnByb3RvdHlwZS50cmFuc2Zvcm0gPSBmdW5jdGlvbiAobTExLCBtMTIsIG0yMSwgbTIyLCBkeCwgZHkpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50U3RhdGUoKS50cmFuc2Zvcm1lci50cmFuc2Zvcm0oW20xMSwgbTEyLCBtMjEsIG0yMiwgZHgsIGR5XSk7XG4gICAgICAgIHRoaXMuX21vZGlmaWVkVHJhbnNmb3JtID0gdHJ1ZTtcbiAgICB9O1xuICAgIENhbnZhc1N1cmZhY2VDb250ZXh0LnByb3RvdHlwZS5zZXRUcmFuc2Zvcm0gPSBmdW5jdGlvbiAobTExLCBtMTIsIG0yMSwgbTIyLCBkeCwgZHkpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50U3RhdGUoKS50cmFuc2Zvcm1lci5zZXRUcmFuc2Zvcm0oW20xMSwgbTEyLCBtMjEsIG0yMiwgZHgsIGR5XSk7XG4gICAgICAgIHRoaXMuX21vZGlmaWVkVHJhbnNmb3JtID0gdHJ1ZTtcbiAgICB9O1xuICAgIENhbnZhc1N1cmZhY2VDb250ZXh0LnByb3RvdHlwZS5zZXRHbG9iYWxBbHBoYSA9IGZ1bmN0aW9uIChnbG9iYWxBbHBoYSkge1xuICAgICAgICB0aGlzLmN1cnJlbnRTdGF0ZSgpLmdsb2JhbEFscGhhID0gZ2xvYmFsQWxwaGE7XG4gICAgfTtcbiAgICBDYW52YXNTdXJmYWNlQ29udGV4dC5wcm90b3R5cGUuZ2V0SW1hZ2VEYXRhID0gZnVuY3Rpb24gKHN4LCBzeSwgc3csIHNoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb250ZXh0LmdldEltYWdlRGF0YShzeCwgc3ksIHN3LCBzaCk7XG4gICAgfTtcbiAgICBDYW52YXNTdXJmYWNlQ29udGV4dC5wcm90b3R5cGUucHV0SW1hZ2VEYXRhID0gZnVuY3Rpb24gKGltYWdlZGF0YSwgZHgsIGR5LCBkaXJ0eVgsIGRpcnR5WSwgZGlydHlXaWR0aCwgZGlydHlIZWlnaHQpIHtcbiAgICAgICAgdGhpcy5fY29udGV4dC5wdXRJbWFnZURhdGEoaW1hZ2VkYXRhLCBkeCwgZHksIGRpcnR5WCwgZGlydHlZLCBkaXJ0eVdpZHRoLCBkaXJ0eUhlaWdodCk7XG4gICAgfTtcbiAgICBDYW52YXNTdXJmYWNlQ29udGV4dC5wcm90b3R5cGUucHJlcmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY3VycmVudFN0YXRlID0gdGhpcy5jdXJyZW50U3RhdGUoKTtcbiAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZS5maWxsU3R5bGUgIT09IHRoaXMuX2N1cnJlbnRGaWxsU3R5bGUpIHtcbiAgICAgICAgICAgIHRoaXMuX2NvbnRleHQuZmlsbFN0eWxlID0gY3VycmVudFN0YXRlLmZpbGxTdHlsZTtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRGaWxsU3R5bGUgPSBjdXJyZW50U3RhdGUuZmlsbFN0eWxlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdXJyZW50U3RhdGUuZ2xvYmFsQWxwaGEgIT09IHRoaXMuX2N1cnJlbnRHbG9iYWxBbHBoYSkge1xuICAgICAgICAgICAgdGhpcy5fY29udGV4dC5nbG9iYWxBbHBoYSA9IGN1cnJlbnRTdGF0ZS5nbG9iYWxBbHBoYTtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRHbG9iYWxBbHBoYSA9IGN1cnJlbnRTdGF0ZS5nbG9iYWxBbHBoYTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3VycmVudFN0YXRlLmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiAhPT0gdGhpcy5fY3VycmVudEdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbikge1xuICAgICAgICAgICAgdGhpcy5fY29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBjdXJyZW50U3RhdGUuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uO1xuICAgICAgICAgICAgdGhpcy5fY3VycmVudEdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IGN1cnJlbnRTdGF0ZS5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb247XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX21vZGlmaWVkVHJhbnNmb3JtKSB7XG4gICAgICAgICAgICB2YXIgdHJhbnNmb3JtZXIgPSBjdXJyZW50U3RhdGUudHJhbnNmb3JtZXI7XG4gICAgICAgICAgICB0aGlzLl9jb250ZXh0LnNldFRyYW5zZm9ybSh0cmFuc2Zvcm1lci5tYXRyaXhbMF0sIHRyYW5zZm9ybWVyLm1hdHJpeFsxXSwgdHJhbnNmb3JtZXIubWF0cml4WzJdLCB0cmFuc2Zvcm1lci5tYXRyaXhbM10sIHRyYW5zZm9ybWVyLm1hdHJpeFs0XSwgdHJhbnNmb3JtZXIubWF0cml4WzVdKTtcbiAgICAgICAgICAgIHRoaXMuX21vZGlmaWVkVHJhbnNmb3JtID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIENhbnZhc1N1cmZhY2VDb250ZXh0LnByb3RvdHlwZS5wdXNoU3RhdGUgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgdGhpcy5fc3RhdGVTdGFjay5wdXNoKHN0YXRlKTtcbiAgICB9O1xuICAgIENhbnZhc1N1cmZhY2VDb250ZXh0LnByb3RvdHlwZS5wb3BTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlU3RhY2subGVuZ3RoIDw9IDEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zdGF0ZVN0YWNrLnBvcCgpO1xuICAgICAgICB0aGlzLl9tb2RpZmllZFRyYW5zZm9ybSA9IHRydWU7XG4gICAgfTtcbiAgICBDYW52YXNTdXJmYWNlQ29udGV4dC5wcm90b3R5cGUuY3VycmVudFN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGVTdGFja1t0aGlzLl9zdGF0ZVN0YWNrLmxlbmd0aCAtIDFdO1xuICAgIH07XG4gICAgcmV0dXJuIENhbnZhc1N1cmZhY2VDb250ZXh0O1xufSgpKTtcbmV4cG9ydHMuQ2FudmFzU3VyZmFjZUNvbnRleHQgPSBDYW52YXNTdXJmYWNlQ29udGV4dDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNvbnRleHQyRFJlbmRlcmVyID0gdm9pZCAwO1xudmFyIGcgPSByZXF1aXJlKFwiQGFrYXNoaWMvYWthc2hpYy1lbmdpbmVcIik7XG52YXIgQ29udGV4dDJEUmVuZGVyZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKENvbnRleHQyRFJlbmRlcmVyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIENvbnRleHQyRFJlbmRlcmVyKHN1cmZhY2UpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuc3VyZmFjZSA9IHN1cmZhY2U7XG4gICAgICAgIF90aGlzLmNvbnRleHQgPSBzdXJmYWNlLmNvbnRleHQoKTtcbiAgICAgICAgX3RoaXMuY2FudmFzUmVuZGVyaW5nQ29udGV4dDJEID0gX3RoaXMuY29udGV4dC5nZXRDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQoKTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBDb250ZXh0MkRSZW5kZXJlci5wcm90b3R5cGUuYmVnaW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuYmVnaW4uY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy5jYW52YXNSZW5kZXJpbmdDb250ZXh0MkQuc2F2ZSgpO1xuICAgICAgICB0aGlzLmNvbnRleHQuc2F2ZSgpO1xuICAgIH07XG4gICAgQ29udGV4dDJEUmVuZGVyZXIucHJvdG90eXBlLmVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5jYW52YXNSZW5kZXJpbmdDb250ZXh0MkQucmVzdG9yZSgpO1xuICAgICAgICB0aGlzLmNvbnRleHQucmVzdG9yZSgpO1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmVuZC5jYWxsKHRoaXMpO1xuICAgIH07XG4gICAgQ29udGV4dDJEUmVuZGVyZXIucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMuc3VyZmFjZS53aWR0aCwgdGhpcy5zdXJmYWNlLmhlaWdodCk7XG4gICAgfTtcbiAgICBDb250ZXh0MkRSZW5kZXJlci5wcm90b3R5cGUuZHJhd0ltYWdlID0gZnVuY3Rpb24gKHN1cmZhY2UsIG9mZnNldFgsIG9mZnNldFksIHdpZHRoLCBoZWlnaHQsIGNhbnZhc09mZnNldFgsIGNhbnZhc09mZnNldFkpIHtcbiAgICAgICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZShzdXJmYWNlLl9kcmF3YWJsZSwgb2Zmc2V0WCwgb2Zmc2V0WSwgd2lkdGgsIGhlaWdodCwgY2FudmFzT2Zmc2V0WCwgY2FudmFzT2Zmc2V0WSwgd2lkdGgsIGhlaWdodCk7XG4gICAgfTtcbiAgICBDb250ZXh0MkRSZW5kZXJlci5wcm90b3R5cGUuZHJhd1Nwcml0ZXMgPSBmdW5jdGlvbiAoc3VyZmFjZSwgb2Zmc2V0WCwgb2Zmc2V0WSwgd2lkdGgsIGhlaWdodCwgY2FudmFzT2Zmc2V0WCwgY2FudmFzT2Zmc2V0WSwgY291bnQpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDsgKytpKSB7XG4gICAgICAgICAgICB0aGlzLmRyYXdJbWFnZShzdXJmYWNlLCBvZmZzZXRYW2ldLCBvZmZzZXRZW2ldLCB3aWR0aFtpXSwgaGVpZ2h0W2ldLCBjYW52YXNPZmZzZXRYW2ldLCBjYW52YXNPZmZzZXRZW2ldKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ29udGV4dDJEUmVuZGVyZXIucHJvdG90eXBlLmRyYXdTeXN0ZW1UZXh0ID0gZnVuY3Rpb24gKHRleHQsIHgsIHksIG1heFdpZHRoLCBmb250U2l6ZSwgdGV4dEFsaWduLCB0ZXh0QmFzZWxpbmUsIHRleHRDb2xvciwgZm9udEZhbWlseSwgc3Ryb2tlV2lkdGgsIHN0cm9rZUNvbG9yLCBzdHJva2VPbmx5KSB7XG4gICAgICAgIHZhciBjb250ZXh0ID0gdGhpcy5jYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XG4gICAgICAgIHZhciBmb250RmFtaWx5VmFsdWU7XG4gICAgICAgIHZhciB0ZXh0QWxpZ25WYWx1ZTtcbiAgICAgICAgdmFyIHRleHRCYXNlbGluZVZhbHVlO1xuICAgICAgICB0aGlzLmNvbnRleHQucHJlcmVuZGVyKCk7XG4gICAgICAgIGNvbnRleHQuc2F2ZSgpO1xuICAgICAgICBzd2l0Y2ggKGZvbnRGYW1pbHkpIHtcbiAgICAgICAgICAgIGNhc2UgZy5Gb250RmFtaWx5Lk1vbm9zcGFjZTpcbiAgICAgICAgICAgICAgICBmb250RmFtaWx5VmFsdWUgPSBcIm1vbm9zcGFjZVwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBnLkZvbnRGYW1pbHkuU2VyaWY6XG4gICAgICAgICAgICAgICAgZm9udEZhbWlseVZhbHVlID0gXCJzZXJpZlwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBmb250RmFtaWx5VmFsdWUgPSBcInNhbnMtc2VyaWZcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjb250ZXh0LmZvbnQgPSBmb250U2l6ZSArIFwicHggXCIgKyBmb250RmFtaWx5VmFsdWU7XG4gICAgICAgIHN3aXRjaCAodGV4dEFsaWduKSB7XG4gICAgICAgICAgICBjYXNlIGcuVGV4dEFsaWduLlJpZ2h0OlxuICAgICAgICAgICAgICAgIHRleHRBbGlnblZhbHVlID0gXCJyaWdodFwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBnLlRleHRBbGlnbi5DZW50ZXI6XG4gICAgICAgICAgICAgICAgdGV4dEFsaWduVmFsdWUgPSBcImNlbnRlclwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0ZXh0QWxpZ25WYWx1ZSA9IFwibGVmdFwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRleHQudGV4dEFsaWduID0gdGV4dEFsaWduVmFsdWU7XG4gICAgICAgIHN3aXRjaCAodGV4dEJhc2VsaW5lKSB7XG4gICAgICAgICAgICBjYXNlIGcuVGV4dEJhc2VsaW5lLlRvcDpcbiAgICAgICAgICAgICAgICB0ZXh0QmFzZWxpbmVWYWx1ZSA9IFwidG9wXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGcuVGV4dEJhc2VsaW5lLk1pZGRsZTpcbiAgICAgICAgICAgICAgICB0ZXh0QmFzZWxpbmVWYWx1ZSA9IFwibWlkZGxlXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGcuVGV4dEJhc2VsaW5lLkJvdHRvbTpcbiAgICAgICAgICAgICAgICB0ZXh0QmFzZWxpbmVWYWx1ZSA9IFwiYm90dG9tXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRleHRCYXNlbGluZVZhbHVlID0gXCJhbHBoYWJldGljXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY29udGV4dC50ZXh0QmFzZWxpbmUgPSB0ZXh0QmFzZWxpbmVWYWx1ZTtcbiAgICAgICAgY29udGV4dC5saW5lSm9pbiA9IFwiYmV2ZWxcIjtcbiAgICAgICAgaWYgKHN0cm9rZVdpZHRoID4gMCkge1xuICAgICAgICAgICAgY29udGV4dC5saW5lV2lkdGggPSBzdHJva2VXaWR0aDtcbiAgICAgICAgICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSBzdHJva2VDb2xvcjtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgbWF4V2lkdGggPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICBjb250ZXh0LnN0cm9rZVRleHQodGV4dCwgeCwgeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb250ZXh0LnN0cm9rZVRleHQodGV4dCwgeCwgeSwgbWF4V2lkdGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghc3Ryb2tlT25seSkge1xuICAgICAgICAgICAgY29udGV4dC5maWxsU3R5bGUgPSB0ZXh0Q29sb3I7XG4gICAgICAgICAgICBjb250ZXh0LmZpbGxUZXh0KHRleHQsIHgsIHksIG1heFdpZHRoKTtcbiAgICAgICAgfVxuICAgICAgICBjb250ZXh0LnJlc3RvcmUoKTtcbiAgICB9O1xuICAgIENvbnRleHQyRFJlbmRlcmVyLnByb3RvdHlwZS50cmFuc2xhdGUgPSBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICB0aGlzLmNvbnRleHQudHJhbnNsYXRlKHgsIHkpO1xuICAgIH07XG4gICAgQ29udGV4dDJEUmVuZGVyZXIucHJvdG90eXBlLnRyYW5zZm9ybSA9IGZ1bmN0aW9uIChtYXRyaXgpIHtcbiAgICAgICAgdGhpcy5jb250ZXh0LnRyYW5zZm9ybShtYXRyaXhbMF0sIG1hdHJpeFsxXSwgbWF0cml4WzJdLCBtYXRyaXhbM10sIG1hdHJpeFs0XSwgbWF0cml4WzVdKTtcbiAgICB9O1xuICAgIENvbnRleHQyRFJlbmRlcmVyLnByb3RvdHlwZS5vcGFjaXR5ID0gZnVuY3Rpb24gKG9wYWNpdHkpIHtcbiAgICAgICAgLy8gTm90ZTpnbG9iYWxBbHBoYeOBruWIneacn+WApOOBjDHjgafjgYLjgovjgZPjgajjga/ku5Xmp5jkuIrkv53oqLzjgZXjgozjgabjgYTjgovjgZ/jgoHjgIHluLjjgavmjpvjgZHlkIjjgo/jgZvjgotcbiAgICAgICAgdGhpcy5jb250ZXh0Lmdsb2JhbEFscGhhICo9IG9wYWNpdHk7XG4gICAgfTtcbiAgICBDb250ZXh0MkRSZW5kZXJlci5wcm90b3R5cGUuc2F2ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5jb250ZXh0LnNhdmUoKTtcbiAgICB9O1xuICAgIENvbnRleHQyRFJlbmRlcmVyLnByb3RvdHlwZS5yZXN0b3JlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmNvbnRleHQucmVzdG9yZSgpO1xuICAgIH07XG4gICAgQ29udGV4dDJEUmVuZGVyZXIucHJvdG90eXBlLmZpbGxSZWN0ID0gZnVuY3Rpb24gKHgsIHksIHdpZHRoLCBoZWlnaHQsIGNzc0NvbG9yKSB7XG4gICAgICAgIHRoaXMuY29udGV4dC5maWxsU3R5bGUgPSBjc3NDb2xvcjtcbiAgICAgICAgdGhpcy5jb250ZXh0LmZpbGxSZWN0KHgsIHksIHdpZHRoLCBoZWlnaHQpO1xuICAgIH07XG4gICAgQ29udGV4dDJEUmVuZGVyZXIucHJvdG90eXBlLnNldENvbXBvc2l0ZU9wZXJhdGlvbiA9IGZ1bmN0aW9uIChvcGVyYXRpb24pIHtcbiAgICAgICAgdmFyIG9wZXJhdGlvblRleHQ7XG4gICAgICAgIHN3aXRjaCAob3BlcmF0aW9uKSB7XG4gICAgICAgICAgICBjYXNlIGcuQ29tcG9zaXRlT3BlcmF0aW9uLlNvdXJjZUF0b3A6XG4gICAgICAgICAgICAgICAgb3BlcmF0aW9uVGV4dCA9IFwic291cmNlLWF0b3BcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgZy5Db21wb3NpdGVPcGVyYXRpb24uTGlnaHRlcjpcbiAgICAgICAgICAgICAgICBvcGVyYXRpb25UZXh0ID0gXCJsaWdodGVyXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGcuQ29tcG9zaXRlT3BlcmF0aW9uLkNvcHk6XG4gICAgICAgICAgICAgICAgb3BlcmF0aW9uVGV4dCA9IFwiY29weVwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBnLkNvbXBvc2l0ZU9wZXJhdGlvbi5FeHBlcmltZW50YWxTb3VyY2VJbjpcbiAgICAgICAgICAgICAgICBvcGVyYXRpb25UZXh0ID0gXCJzb3VyY2UtaW5cIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgZy5Db21wb3NpdGVPcGVyYXRpb24uRXhwZXJpbWVudGFsU291cmNlT3V0OlxuICAgICAgICAgICAgICAgIG9wZXJhdGlvblRleHQgPSBcInNvdXJjZS1vdXRcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgZy5Db21wb3NpdGVPcGVyYXRpb24uRXhwZXJpbWVudGFsRGVzdGluYXRpb25BdG9wOlxuICAgICAgICAgICAgICAgIG9wZXJhdGlvblRleHQgPSBcImRlc3RpbmF0aW9uLWF0b3BcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgZy5Db21wb3NpdGVPcGVyYXRpb24uRXhwZXJpbWVudGFsRGVzdGluYXRpb25JbjpcbiAgICAgICAgICAgICAgICBvcGVyYXRpb25UZXh0ID0gXCJkZXN0aW5hdGlvbi1pblwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBnLkNvbXBvc2l0ZU9wZXJhdGlvbi5EZXN0aW5hdGlvbk91dDpcbiAgICAgICAgICAgICAgICBvcGVyYXRpb25UZXh0ID0gXCJkZXN0aW5hdGlvbi1vdXRcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgZy5Db21wb3NpdGVPcGVyYXRpb24uRGVzdGluYXRpb25PdmVyOlxuICAgICAgICAgICAgICAgIG9wZXJhdGlvblRleHQgPSBcImRlc3RpbmF0aW9uLW92ZXJcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgZy5Db21wb3NpdGVPcGVyYXRpb24uWG9yOlxuICAgICAgICAgICAgICAgIG9wZXJhdGlvblRleHQgPSBcInhvclwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBvcGVyYXRpb25UZXh0ID0gXCJzb3VyY2Utb3ZlclwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBvcGVyYXRpb25UZXh0O1xuICAgIH07XG4gICAgQ29udGV4dDJEUmVuZGVyZXIucHJvdG90eXBlLnNldE9wYWNpdHkgPSBmdW5jdGlvbiAob3BhY2l0eSkge1xuICAgICAgICB0aGlzLmNvbnRleHQuZ2xvYmFsQWxwaGEgPSBvcGFjaXR5O1xuICAgIH07XG4gICAgQ29udGV4dDJEUmVuZGVyZXIucHJvdG90eXBlLnNldFRyYW5zZm9ybSA9IGZ1bmN0aW9uIChtYXRyaXgpIHtcbiAgICAgICAgdGhpcy5jb250ZXh0LnNldFRyYW5zZm9ybShtYXRyaXhbMF0sIG1hdHJpeFsxXSwgbWF0cml4WzJdLCBtYXRyaXhbM10sIG1hdHJpeFs0XSwgbWF0cml4WzVdKTtcbiAgICB9O1xuICAgIENvbnRleHQyRFJlbmRlcmVyLnByb3RvdHlwZS5zZXRTaGFkZXJQcm9ncmFtID0gZnVuY3Rpb24gKHNoYWRlclByb2dyYW0pIHtcbiAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiQ29udGV4dDJEUmVuZGVyZXIjc2V0U2hhZGVyUHJvZ3JhbSgpIGlzIG5vdCBpbXBsZW1lbnRlZFwiKTtcbiAgICB9O1xuICAgIENvbnRleHQyRFJlbmRlcmVyLnByb3RvdHlwZS5pc1N1cHBvcnRlZFNoYWRlclByb2dyYW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIENvbnRleHQyRFJlbmRlcmVyLnByb3RvdHlwZS5fZ2V0SW1hZ2VEYXRhID0gZnVuY3Rpb24gKHN4LCBzeSwgc3csIHNoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnRleHQuZ2V0SW1hZ2VEYXRhKHN4LCBzeSwgc3csIHNoKTtcbiAgICB9O1xuICAgIENvbnRleHQyRFJlbmRlcmVyLnByb3RvdHlwZS5fcHV0SW1hZ2VEYXRhID0gZnVuY3Rpb24gKGltYWdlRGF0YSwgZHgsIGR5LCBkaXJ0eVgsIGRpcnR5WSwgZGlydHlXaWR0aCwgZGlydHlIZWlnaHQpIHtcbiAgICAgICAgaWYgKGRpcnR5WCA9PT0gdm9pZCAwKSB7IGRpcnR5WCA9IDA7IH1cbiAgICAgICAgaWYgKGRpcnR5WSA9PT0gdm9pZCAwKSB7IGRpcnR5WSA9IDA7IH1cbiAgICAgICAgaWYgKGRpcnR5V2lkdGggPT09IHZvaWQgMCkgeyBkaXJ0eVdpZHRoID0gaW1hZ2VEYXRhLndpZHRoOyB9XG4gICAgICAgIGlmIChkaXJ0eUhlaWdodCA9PT0gdm9pZCAwKSB7IGRpcnR5SGVpZ2h0ID0gaW1hZ2VEYXRhLmhlaWdodDsgfVxuICAgICAgICB0aGlzLmNvbnRleHQucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgZHgsIGR5LCBkaXJ0eVgsIGRpcnR5WSwgZGlydHlXaWR0aCwgZGlydHlIZWlnaHQpO1xuICAgIH07XG4gICAgcmV0dXJuIENvbnRleHQyRFJlbmRlcmVyO1xufShnLlJlbmRlcmVyKSk7XG5leHBvcnRzLkNvbnRleHQyRFJlbmRlcmVyID0gQ29udGV4dDJEUmVuZGVyZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Db250ZXh0MkRTdXJmYWNlID0gdm9pZCAwO1xudmFyIENvbnRleHQyRFJlbmRlcmVyXzEgPSByZXF1aXJlKFwiLi9Db250ZXh0MkRSZW5kZXJlclwiKTtcbnZhciBDYW52YXNTdXJmYWNlQ29udGV4dF8xID0gcmVxdWlyZShcIi4vQ2FudmFzU3VyZmFjZUNvbnRleHRcIik7XG52YXIgQ2FudmFzU3VyZmFjZV8xID0gcmVxdWlyZShcIi4uL0NhbnZhc1N1cmZhY2VcIik7XG52YXIgQ29udGV4dDJEU3VyZmFjZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoQ29udGV4dDJEU3VyZmFjZSwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBDb250ZXh0MkRTdXJmYWNlKCkge1xuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgfVxuICAgIENvbnRleHQyRFN1cmZhY2UucHJvdG90eXBlLmNvbnRleHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5fY29udGV4dCkge1xuICAgICAgICAgICAgdGhpcy5fY29udGV4dCA9IG5ldyBDYW52YXNTdXJmYWNlQ29udGV4dF8xLkNhbnZhc1N1cmZhY2VDb250ZXh0KHRoaXMuY2FudmFzLmdldENvbnRleHQoXCIyZFwiKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRleHQ7XG4gICAgfTtcbiAgICBDb250ZXh0MkRTdXJmYWNlLnByb3RvdHlwZS5yZW5kZXJlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9yZW5kZXJlcikge1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSBuZXcgQ29udGV4dDJEUmVuZGVyZXJfMS5Db250ZXh0MkRSZW5kZXJlcih0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyZXI7XG4gICAgfTtcbiAgICBDb250ZXh0MkRTdXJmYWNlLnByb3RvdHlwZS5jaGFuZ2VQaHlzaWNhbFNjYWxlID0gZnVuY3Rpb24gKHhTY2FsZSwgeVNjYWxlKSB7XG4gICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gdGhpcy53aWR0aCAqIHhTY2FsZTtcbiAgICAgICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gdGhpcy5oZWlnaHQgKiB5U2NhbGU7XG4gICAgICAgIHRoaXMuX2NvbnRleHQuc2NhbGUoeFNjYWxlLCB5U2NhbGUpO1xuICAgIH07XG4gICAgQ29udGV4dDJEU3VyZmFjZS5wcm90b3R5cGUuaXNQbGF5aW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICByZXR1cm4gQ29udGV4dDJEU3VyZmFjZTtcbn0oQ2FudmFzU3VyZmFjZV8xLkNhbnZhc1N1cmZhY2UpKTtcbmV4cG9ydHMuQ29udGV4dDJEU3VyZmFjZSA9IENvbnRleHQyRFN1cmZhY2U7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuU3VyZmFjZUZhY3RvcnkgPSB2b2lkIDA7XG52YXIgUmVuZGVyaW5nSGVscGVyXzEgPSByZXF1aXJlKFwiLi4vUmVuZGVyaW5nSGVscGVyXCIpO1xudmFyIENvbnRleHQyRFN1cmZhY2VfMSA9IHJlcXVpcmUoXCIuLi9jb250ZXh0MmQvQ29udGV4dDJEU3VyZmFjZVwiKTtcbnZhciBXZWJHTFNoYXJlZE9iamVjdF8xID0gcmVxdWlyZShcIi4uL3dlYmdsL1dlYkdMU2hhcmVkT2JqZWN0XCIpO1xudmFyIFN1cmZhY2VGYWN0b3J5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFN1cmZhY2VGYWN0b3J5KCkge1xuICAgIH1cbiAgICBTdXJmYWNlRmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlUHJpbWFyeVN1cmZhY2UgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgcmVuZGVyZXJDYW5kaWRhdGVzKSB7XG4gICAgICAgIGlmIChSZW5kZXJpbmdIZWxwZXJfMS5SZW5kZXJpbmdIZWxwZXIudXNlZFdlYkdMKHJlbmRlcmVyQ2FuZGlkYXRlcykpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5fc2hhcmVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2hhcmVkID0gbmV3IFdlYkdMU2hhcmVkT2JqZWN0XzEuV2ViR0xTaGFyZWRPYmplY3Qod2lkdGgsIGhlaWdodCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc2hhcmVkLmdldFByaW1hcnlTdXJmYWNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IENvbnRleHQyRFN1cmZhY2VfMS5Db250ZXh0MkRTdXJmYWNlKHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTdXJmYWNlRmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlQmFja1N1cmZhY2UgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgcmVuZGVyZXJDYW5kaWRhdGVzKSB7XG4gICAgICAgIGlmIChSZW5kZXJpbmdIZWxwZXJfMS5SZW5kZXJpbmdIZWxwZXIudXNlZFdlYkdMKHJlbmRlcmVyQ2FuZGlkYXRlcykpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zaGFyZWQuY3JlYXRlQmFja1N1cmZhY2Uod2lkdGgsIGhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IENvbnRleHQyRFN1cmZhY2VfMS5Db250ZXh0MkRTdXJmYWNlKHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gU3VyZmFjZUZhY3Rvcnk7XG59KCkpO1xuZXhwb3J0cy5TdXJmYWNlRmFjdG9yeSA9IFN1cmZhY2VGYWN0b3J5O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuV2ViR0xCYWNrU3VyZmFjZSA9IHZvaWQgMDtcbnZhciBXZWJHTEJhY2tTdXJmYWNlUmVuZGVyZXJfMSA9IHJlcXVpcmUoXCIuL1dlYkdMQmFja1N1cmZhY2VSZW5kZXJlclwiKTtcbnZhciBXZWJHTFByaW1hcnlTdXJmYWNlXzEgPSByZXF1aXJlKFwiLi9XZWJHTFByaW1hcnlTdXJmYWNlXCIpO1xudmFyIFdlYkdMQmFja1N1cmZhY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFdlYkdMQmFja1N1cmZhY2UsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gV2ViR0xCYWNrU3VyZmFjZSgpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgIH1cbiAgICAvLyBvdmVycmlkZVxuICAgIFdlYkdMQmFja1N1cmZhY2UucHJvdG90eXBlLnJlbmRlcmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuX3JlbmRlcmVyKSB7XG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJlciA9IG5ldyBXZWJHTEJhY2tTdXJmYWNlUmVuZGVyZXJfMS5XZWJHTEJhY2tTdXJmYWNlUmVuZGVyZXIodGhpcywgdGhpcy5fc2hhcmVkKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyZXI7XG4gICAgfTtcbiAgICBXZWJHTEJhY2tTdXJmYWNlLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fcmVuZGVyZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyLmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5fZHJhd2FibGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpO1xuICAgIH07XG4gICAgcmV0dXJuIFdlYkdMQmFja1N1cmZhY2U7XG59KFdlYkdMUHJpbWFyeVN1cmZhY2VfMS5XZWJHTFByaW1hcnlTdXJmYWNlKSk7XG5leHBvcnRzLldlYkdMQmFja1N1cmZhY2UgPSBXZWJHTEJhY2tTdXJmYWNlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuV2ViR0xCYWNrU3VyZmFjZVJlbmRlcmVyID0gdm9pZCAwO1xudmFyIFdlYkdMUmVuZGVyZXJfMSA9IHJlcXVpcmUoXCIuL1dlYkdMUmVuZGVyZXJcIik7XG52YXIgV2ViR0xSZW5kZXJpbmdTdGF0ZV8xID0gcmVxdWlyZShcIi4vV2ViR0xSZW5kZXJpbmdTdGF0ZVwiKTtcbnZhciBXZWJHTEJhY2tTdXJmYWNlUmVuZGVyZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFdlYkdMQmFja1N1cmZhY2VSZW5kZXJlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBXZWJHTEJhY2tTdXJmYWNlUmVuZGVyZXIoc3VyZmFjZSwgc2hhcmVkKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHNoYXJlZCwgc2hhcmVkLmNyZWF0ZVJlbmRlclRhcmdldChzdXJmYWNlLndpZHRoLCBzdXJmYWNlLmhlaWdodCkpIHx8IHRoaXM7XG4gICAgICAgIHN1cmZhY2UuX2RyYXdhYmxlID0ge1xuICAgICAgICAgICAgdGV4dHVyZTogX3RoaXMuX3JlbmRlclRhcmdldC50ZXh0dXJlLFxuICAgICAgICAgICAgdGV4dHVyZU9mZnNldFg6IDAsXG4gICAgICAgICAgICB0ZXh0dXJlT2Zmc2V0WTogMCxcbiAgICAgICAgICAgIHRleHR1cmVXaWR0aDogc3VyZmFjZS53aWR0aCxcbiAgICAgICAgICAgIHRleHR1cmVIZWlnaHQ6IHN1cmZhY2UuaGVpZ2h0XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgV2ViR0xCYWNrU3VyZmFjZVJlbmRlcmVyLnByb3RvdHlwZS5iZWdpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5iZWdpbi5jYWxsKHRoaXMpO1xuICAgICAgICAvLyBDYW52YXPluqfmqJnns7vjgahXZWJHTOW6p+aomeezu+OBruebuOS6kuWkieaPm1xuICAgICAgICAvLyBoZWlnaHQg44Gv5o+P55S75a++6LGh44Gu6auY44GV44KS5LiO44GI44KLXG4gICAgICAgIHRoaXMuc2F2ZSgpO1xuICAgICAgICB2YXIgcnMgPSBuZXcgV2ViR0xSZW5kZXJpbmdTdGF0ZV8xLldlYkdMUmVuZGVyaW5nU3RhdGUodGhpcy5jdXJyZW50U3RhdGUoKSk7XG4gICAgICAgIHZhciBtYXRyaXggPSBycy50cmFuc2Zvcm1lci5tYXRyaXg7XG4gICAgICAgIG1hdHJpeFsxXSAqPSAtMTtcbiAgICAgICAgbWF0cml4WzNdICo9IC0xO1xuICAgICAgICBtYXRyaXhbNV0gPSAtbWF0cml4WzVdICsgdGhpcy5fcmVuZGVyVGFyZ2V0LmhlaWdodDtcbiAgICAgICAgdGhpcy5jdXJyZW50U3RhdGUoKS5jb3B5RnJvbShycyk7XG4gICAgICAgIHRoaXMuX3NoYXJlZC5wdXNoUmVuZGVyVGFyZ2V0KHRoaXMuX3JlbmRlclRhcmdldCk7XG4gICAgfTtcbiAgICBXZWJHTEJhY2tTdXJmYWNlUmVuZGVyZXIucHJvdG90eXBlLmVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5yZXN0b3JlKCk7XG4gICAgICAgIHRoaXMuX3NoYXJlZC5wb3BSZW5kZXJUYXJnZXQoKTtcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5lbmQuY2FsbCh0aGlzKTtcbiAgICB9O1xuICAgIHJldHVybiBXZWJHTEJhY2tTdXJmYWNlUmVuZGVyZXI7XG59KFdlYkdMUmVuZGVyZXJfMS5XZWJHTFJlbmRlcmVyKSk7XG5leHBvcnRzLldlYkdMQmFja1N1cmZhY2VSZW5kZXJlciA9IFdlYkdMQmFja1N1cmZhY2VSZW5kZXJlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5XZWJHTENvbG9yID0gdm9pZCAwO1xudmFyIFJlbmRlcmluZ0hlbHBlcl8xID0gcmVxdWlyZShcIi4uL1JlbmRlcmluZ0hlbHBlclwiKTtcbnZhciBXZWJHTENvbG9yO1xuKGZ1bmN0aW9uIChXZWJHTENvbG9yKSB7XG4gICAgV2ViR0xDb2xvci5jb2xvck1hcCA9IHtcbiAgICAgICAgXCJBTElDRUJMVUVcIjogWzB4RjAgLyAyNTUuMCwgMHhGOCAvIDI1NS4wLCAweEZGIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiQU5USVFVRVdISVRFXCI6IFsweEZBIC8gMjU1LjAsIDB4RUIgLyAyNTUuMCwgMHhENyAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkFRVUFcIjogWzB4MDAgLyAyNTUuMCwgMHhGRiAvIDI1NS4wLCAweEZGIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiQVFVQU1BUklORVwiOiBbMHg3RiAvIDI1NS4wLCAweEZGIC8gMjU1LjAsIDB4RDQgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJBWlVSRVwiOiBbMHhGMCAvIDI1NS4wLCAweEZGIC8gMjU1LjAsIDB4RkYgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJCRUlHRVwiOiBbMHhGNSAvIDI1NS4wLCAweEY1IC8gMjU1LjAsIDB4REMgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJCSVNRVUVcIjogWzB4RkYgLyAyNTUuMCwgMHhFNCAvIDI1NS4wLCAweEM0IC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiQkxBQ0tcIjogWzB4MDAgLyAyNTUuMCwgMHgwMCAvIDI1NS4wLCAweDAwIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiQkxBTkNIRURBTE1PTkRcIjogWzB4RkYgLyAyNTUuMCwgMHhFQiAvIDI1NS4wLCAweENEIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiQkxVRVwiOiBbMHgwMCAvIDI1NS4wLCAweDAwIC8gMjU1LjAsIDB4RkYgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJCTFVFVklPTEVUXCI6IFsweDhBIC8gMjU1LjAsIDB4MkIgLyAyNTUuMCwgMHhFMiAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkJST1dOXCI6IFsweEE1IC8gMjU1LjAsIDB4MkEgLyAyNTUuMCwgMHgyQSAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkJVUkxZV09PRFwiOiBbMHhERSAvIDI1NS4wLCAweEI4IC8gMjU1LjAsIDB4ODcgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJDQURFVEJMVUVcIjogWzB4NUYgLyAyNTUuMCwgMHg5RSAvIDI1NS4wLCAweEEwIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiQ0hBUlRSRVVTRVwiOiBbMHg3RiAvIDI1NS4wLCAweEZGIC8gMjU1LjAsIDB4MDAgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJDSE9DT0xBVEVcIjogWzB4RDIgLyAyNTUuMCwgMHg2OSAvIDI1NS4wLCAweDFFIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiQ09SQUxcIjogWzB4RkYgLyAyNTUuMCwgMHg3RiAvIDI1NS4wLCAweDUwIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiQ09STkZMT1dFUkJMVUVcIjogWzB4NjQgLyAyNTUuMCwgMHg5NSAvIDI1NS4wLCAweEVEIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiQ09STlNJTEtcIjogWzB4RkYgLyAyNTUuMCwgMHhGOCAvIDI1NS4wLCAweERDIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiQ1JJTVNPTlwiOiBbMHhEQyAvIDI1NS4wLCAweDE0IC8gMjU1LjAsIDB4M0MgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJDWUFOXCI6IFsweDAwIC8gMjU1LjAsIDB4RkYgLyAyNTUuMCwgMHhGRiAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkRBUktCTFVFXCI6IFsweDAwIC8gMjU1LjAsIDB4MDAgLyAyNTUuMCwgMHg4QiAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkRBUktDWUFOXCI6IFsweDAwIC8gMjU1LjAsIDB4OEIgLyAyNTUuMCwgMHg4QiAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkRBUktHT0xERU5ST0RcIjogWzB4QjggLyAyNTUuMCwgMHg4NiAvIDI1NS4wLCAweDBCIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiREFSS0dSQVlcIjogWzB4QTkgLyAyNTUuMCwgMHhBOSAvIDI1NS4wLCAweEE5IC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiREFSS0dSRUVOXCI6IFsweDAwIC8gMjU1LjAsIDB4NjQgLyAyNTUuMCwgMHgwMCAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkRBUktHUkVZXCI6IFsweEE5IC8gMjU1LjAsIDB4QTkgLyAyNTUuMCwgMHhBOSAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkRBUktLSEFLSVwiOiBbMHhCRCAvIDI1NS4wLCAweEI3IC8gMjU1LjAsIDB4NkIgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJEQVJLTUFHRU5UQVwiOiBbMHg4QiAvIDI1NS4wLCAweDAwIC8gMjU1LjAsIDB4OEIgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJEQVJLT0xJVkVHUkVFTlwiOiBbMHg1NSAvIDI1NS4wLCAweDZCIC8gMjU1LjAsIDB4MkYgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJEQVJLT1JBTkdFXCI6IFsweEZGIC8gMjU1LjAsIDB4OEMgLyAyNTUuMCwgMHgwMCAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkRBUktPUkNISURcIjogWzB4OTkgLyAyNTUuMCwgMHgzMiAvIDI1NS4wLCAweENDIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiREFSS1JFRFwiOiBbMHg4QiAvIDI1NS4wLCAweDAwIC8gMjU1LjAsIDB4MDAgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJEQVJLU0FMTU9OXCI6IFsweEU5IC8gMjU1LjAsIDB4OTYgLyAyNTUuMCwgMHg3QSAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkRBUktTRUFHUkVFTlwiOiBbMHg4RiAvIDI1NS4wLCAweEJDIC8gMjU1LjAsIDB4OEYgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJEQVJLU0xBVEVCTFVFXCI6IFsweDQ4IC8gMjU1LjAsIDB4M0QgLyAyNTUuMCwgMHg4QiAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkRBUktTTEFURUdSQVlcIjogWzB4MkYgLyAyNTUuMCwgMHg0RiAvIDI1NS4wLCAweDRGIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiREFSS1NMQVRFR1JFWVwiOiBbMHgyRiAvIDI1NS4wLCAweDRGIC8gMjU1LjAsIDB4NEYgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJEQVJLVFVSUVVPSVNFXCI6IFsweDAwIC8gMjU1LjAsIDB4Q0UgLyAyNTUuMCwgMHhEMSAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkRBUktWSU9MRVRcIjogWzB4OTQgLyAyNTUuMCwgMHgwMCAvIDI1NS4wLCAweEQzIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiREVFUFBJTktcIjogWzB4RkYgLyAyNTUuMCwgMHgxNCAvIDI1NS4wLCAweDkzIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiREVFUFNLWUJMVUVcIjogWzB4MDAgLyAyNTUuMCwgMHhCRiAvIDI1NS4wLCAweEZGIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiRElNR1JBWVwiOiBbMHg2OSAvIDI1NS4wLCAweDY5IC8gMjU1LjAsIDB4NjkgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJESU1HUkVZXCI6IFsweDY5IC8gMjU1LjAsIDB4NjkgLyAyNTUuMCwgMHg2OSAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkRPREdFUkJMVUVcIjogWzB4MUUgLyAyNTUuMCwgMHg5MCAvIDI1NS4wLCAweEZGIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiRklSRUJSSUNLXCI6IFsweEIyIC8gMjU1LjAsIDB4MjIgLyAyNTUuMCwgMHgyMiAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkZMT1JBTFdISVRFXCI6IFsweEZGIC8gMjU1LjAsIDB4RkEgLyAyNTUuMCwgMHhGMCAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkZPUkVTVEdSRUVOXCI6IFsweDIyIC8gMjU1LjAsIDB4OEIgLyAyNTUuMCwgMHgyMiAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkZVQ0hTSUFcIjogWzB4RkYgLyAyNTUuMCwgMHgwMCAvIDI1NS4wLCAweEZGIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiR0FJTlNCT1JPXCI6IFsweERDIC8gMjU1LjAsIDB4REMgLyAyNTUuMCwgMHhEQyAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkdIT1NUV0hJVEVcIjogWzB4RjggLyAyNTUuMCwgMHhGOCAvIDI1NS4wLCAweEZGIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiR09MRFwiOiBbMHhGRiAvIDI1NS4wLCAweEQ3IC8gMjU1LjAsIDB4MDAgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJHT0xERU5ST0RcIjogWzB4REEgLyAyNTUuMCwgMHhBNSAvIDI1NS4wLCAweDIwIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiR1JBWVwiOiBbMHg4MCAvIDI1NS4wLCAweDgwIC8gMjU1LjAsIDB4ODAgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJHUkVFTlwiOiBbMHgwMCAvIDI1NS4wLCAweDgwIC8gMjU1LjAsIDB4MDAgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJHUkVFTllFTExPV1wiOiBbMHhBRCAvIDI1NS4wLCAweEZGIC8gMjU1LjAsIDB4MkYgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJHUkVZXCI6IFsweDgwIC8gMjU1LjAsIDB4ODAgLyAyNTUuMCwgMHg4MCAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkhPTkVZREVXXCI6IFsweEYwIC8gMjU1LjAsIDB4RkYgLyAyNTUuMCwgMHhGMCAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkhPVFBJTktcIjogWzB4RkYgLyAyNTUuMCwgMHg2OSAvIDI1NS4wLCAweEI0IC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiSU5ESUFOUkVEXCI6IFsweENEIC8gMjU1LjAsIDB4NUMgLyAyNTUuMCwgMHg1QyAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIklORElHT1wiOiBbMHg0QiAvIDI1NS4wLCAweDAwIC8gMjU1LjAsIDB4ODIgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJJVk9SWVwiOiBbMHhGRiAvIDI1NS4wLCAweEZGIC8gMjU1LjAsIDB4RjAgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJLSEFLSVwiOiBbMHhGMCAvIDI1NS4wLCAweEU2IC8gMjU1LjAsIDB4OEMgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJMQVZFTkRFUlwiOiBbMHhFNiAvIDI1NS4wLCAweEU2IC8gMjU1LjAsIDB4RkEgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJMQVZFTkRFUkJMVVNIXCI6IFsweEZGIC8gMjU1LjAsIDB4RjAgLyAyNTUuMCwgMHhGNSAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkxBV05HUkVFTlwiOiBbMHg3QyAvIDI1NS4wLCAweEZDIC8gMjU1LjAsIDB4MDAgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJMRU1PTkNISUZGT05cIjogWzB4RkYgLyAyNTUuMCwgMHhGQSAvIDI1NS4wLCAweENEIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTElHSFRCTFVFXCI6IFsweEFEIC8gMjU1LjAsIDB4RDggLyAyNTUuMCwgMHhFNiAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkxJR0hUQ09SQUxcIjogWzB4RjAgLyAyNTUuMCwgMHg4MCAvIDI1NS4wLCAweDgwIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTElHSFRDWUFOXCI6IFsweEUwIC8gMjU1LjAsIDB4RkYgLyAyNTUuMCwgMHhGRiAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkxJR0hUR09MREVOUk9EWUVMTE9XXCI6IFsweEZBIC8gMjU1LjAsIDB4RkEgLyAyNTUuMCwgMHhEMiAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkxJR0hUR1JBWVwiOiBbMHhEMyAvIDI1NS4wLCAweEQzIC8gMjU1LjAsIDB4RDMgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJMSUdIVEdSRUVOXCI6IFsweDkwIC8gMjU1LjAsIDB4RUUgLyAyNTUuMCwgMHg5MCAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIkxJR0hUR1JFWVwiOiBbMHhEMyAvIDI1NS4wLCAweEQzIC8gMjU1LjAsIDB4RDMgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJMSUdIVFBJTktcIjogWzB4RkYgLyAyNTUuMCwgMHhCNiAvIDI1NS4wLCAweEMxIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTElHSFRTQUxNT05cIjogWzB4RkYgLyAyNTUuMCwgMHhBMCAvIDI1NS4wLCAweDdBIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTElHSFRTRUFHUkVFTlwiOiBbMHgyMCAvIDI1NS4wLCAweEIyIC8gMjU1LjAsIDB4QUEgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJMSUdIVFNLWUJMVUVcIjogWzB4ODcgLyAyNTUuMCwgMHhDRSAvIDI1NS4wLCAweEZBIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTElHSFRTTEFURUdSQVlcIjogWzB4NzcgLyAyNTUuMCwgMHg4OCAvIDI1NS4wLCAweDk5IC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTElHSFRTTEFURUdSRVlcIjogWzB4NzcgLyAyNTUuMCwgMHg4OCAvIDI1NS4wLCAweDk5IC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTElHSFRTVEVFTEJMVUVcIjogWzB4QjAgLyAyNTUuMCwgMHhDNCAvIDI1NS4wLCAweERFIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTElHSFRZRUxMT1dcIjogWzB4RkYgLyAyNTUuMCwgMHhGRiAvIDI1NS4wLCAweEUwIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTElNRVwiOiBbMHgwMCAvIDI1NS4wLCAweEZGIC8gMjU1LjAsIDB4MDAgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJMSU1FR1JFRU5cIjogWzB4MzIgLyAyNTUuMCwgMHhDRCAvIDI1NS4wLCAweDMyIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTElORU5cIjogWzB4RkEgLyAyNTUuMCwgMHhGMCAvIDI1NS4wLCAweEU2IC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTUFHRU5UQVwiOiBbMHhGRiAvIDI1NS4wLCAweDAwIC8gMjU1LjAsIDB4RkYgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJNQVJPT05cIjogWzB4ODAgLyAyNTUuMCwgMHgwMCAvIDI1NS4wLCAweDAwIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTUVESVVNQVFVQU1BUklORVwiOiBbMHg2NiAvIDI1NS4wLCAweENEIC8gMjU1LjAsIDB4QUEgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJNRURJVU1CTFVFXCI6IFsweDAwIC8gMjU1LjAsIDB4MDAgLyAyNTUuMCwgMHhDRCAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIk1FRElVTU9SQ0hJRFwiOiBbMHhCQSAvIDI1NS4wLCAweDU1IC8gMjU1LjAsIDB4RDMgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJNRURJVU1QVVJQTEVcIjogWzB4OTMgLyAyNTUuMCwgMHg3MCAvIDI1NS4wLCAweERCIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTUVESVVNU0VBR1JFRU5cIjogWzB4M0MgLyAyNTUuMCwgMHhCMyAvIDI1NS4wLCAweDcxIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTUVESVVNU0xBVEVCTFVFXCI6IFsweDdCIC8gMjU1LjAsIDB4NjggLyAyNTUuMCwgMHhFRSAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIk1FRElVTVNQUklOR0dSRUVOXCI6IFsweDAwIC8gMjU1LjAsIDB4RkEgLyAyNTUuMCwgMHg5QSAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIk1FRElVTVRVUlFVT0lTRVwiOiBbMHg0OCAvIDI1NS4wLCAweEQxIC8gMjU1LjAsIDB4Q0MgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJNRURJVU1WSU9MRVRSRURcIjogWzB4QzcgLyAyNTUuMCwgMHgxNSAvIDI1NS4wLCAweDg1IC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTUlETklHSFRCTFVFXCI6IFsweDE5IC8gMjU1LjAsIDB4MTkgLyAyNTUuMCwgMHg3MCAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIk1JTlRDUkVBTVwiOiBbMHhGNSAvIDI1NS4wLCAweEZGIC8gMjU1LjAsIDB4RkEgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJNSVNUWVJPU0VcIjogWzB4RkYgLyAyNTUuMCwgMHhFNCAvIDI1NS4wLCAweEUxIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTU9DQ0FTSU5cIjogWzB4RkYgLyAyNTUuMCwgMHhFNCAvIDI1NS4wLCAweEI1IC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTkFWQUpPV0hJVEVcIjogWzB4RkYgLyAyNTUuMCwgMHhERSAvIDI1NS4wLCAweEFEIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiTkFWWVwiOiBbMHgwMCAvIDI1NS4wLCAweDAwIC8gMjU1LjAsIDB4ODAgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJPTERMQUNFXCI6IFsweEZEIC8gMjU1LjAsIDB4RjUgLyAyNTUuMCwgMHhFNiAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIk9MSVZFXCI6IFsweDgwIC8gMjU1LjAsIDB4ODAgLyAyNTUuMCwgMHgwMCAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIk9MSVZFRFJBQlwiOiBbMHg2QiAvIDI1NS4wLCAweDhFIC8gMjU1LjAsIDB4MjMgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJPUkFOR0VcIjogWzB4RkYgLyAyNTUuMCwgMHhBNSAvIDI1NS4wLCAweDAwIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiT1JBTkdFUkVEXCI6IFsweEZGIC8gMjU1LjAsIDB4NDUgLyAyNTUuMCwgMHgwMCAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIk9SQ0hJRFwiOiBbMHhEQSAvIDI1NS4wLCAweDcwIC8gMjU1LjAsIDB4RDYgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJQQUxFR09MREVOUk9EXCI6IFsweEVFIC8gMjU1LjAsIDB4RTggLyAyNTUuMCwgMHhBQSAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIlBBTEVHUkVFTlwiOiBbMHg5OCAvIDI1NS4wLCAweEZCIC8gMjU1LjAsIDB4OTggLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJQQUxFVFVSUVVPSVNFXCI6IFsweEFGIC8gMjU1LjAsIDB4RUUgLyAyNTUuMCwgMHhFRSAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIlBBTEVWSU9MRVRSRURcIjogWzB4REIgLyAyNTUuMCwgMHg3MCAvIDI1NS4wLCAweDkzIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiUEFQQVlBV0hJUFwiOiBbMHhGRiAvIDI1NS4wLCAweEVGIC8gMjU1LjAsIDB4RDUgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJQRUFDSFBVRkZcIjogWzB4RkYgLyAyNTUuMCwgMHhEQSAvIDI1NS4wLCAweEI5IC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiUEVSVVwiOiBbMHhDRCAvIDI1NS4wLCAweDg1IC8gMjU1LjAsIDB4M0YgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJQSU5LXCI6IFsweEZGIC8gMjU1LjAsIDB4QzAgLyAyNTUuMCwgMHhDQiAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIlBMVU1cIjogWzB4REQgLyAyNTUuMCwgMHhBMCAvIDI1NS4wLCAweEREIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiUE9XREVSQkxVRVwiOiBbMHhCMCAvIDI1NS4wLCAweEUwIC8gMjU1LjAsIDB4RTYgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJQVVJQTEVcIjogWzB4ODAgLyAyNTUuMCwgMHgwMCAvIDI1NS4wLCAweDgwIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiUkVEXCI6IFsweEZGIC8gMjU1LjAsIDB4MDAgLyAyNTUuMCwgMHgwMCAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIlJPU1lCUk9XTlwiOiBbMHhCQyAvIDI1NS4wLCAweDhGIC8gMjU1LjAsIDB4OEYgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJST1lBTEJMVUVcIjogWzB4NDEgLyAyNTUuMCwgMHg2OSAvIDI1NS4wLCAweEUxIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiU0FERExFQlJPV05cIjogWzB4OEIgLyAyNTUuMCwgMHg0NSAvIDI1NS4wLCAweDEzIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiU0FMTU9OXCI6IFsweEZBIC8gMjU1LjAsIDB4ODAgLyAyNTUuMCwgMHg3MiAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIlNBTkRZQlJPV05cIjogWzB4RjQgLyAyNTUuMCwgMHhBNCAvIDI1NS4wLCAweDYwIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiU0VBR1JFRU5cIjogWzB4MkUgLyAyNTUuMCwgMHg4QiAvIDI1NS4wLCAweDU3IC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiU0VBU0hFTExcIjogWzB4RkYgLyAyNTUuMCwgMHhGNSAvIDI1NS4wLCAweEVFIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiU0lFTk5BXCI6IFsweEEwIC8gMjU1LjAsIDB4NTIgLyAyNTUuMCwgMHgyRCAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIlNJTFZFUlwiOiBbMHhDMCAvIDI1NS4wLCAweEMwIC8gMjU1LjAsIDB4QzAgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJTS1lCTFVFXCI6IFsweDg3IC8gMjU1LjAsIDB4Q0UgLyAyNTUuMCwgMHhFQiAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIlNMQVRFQkxVRVwiOiBbMHg2QSAvIDI1NS4wLCAweDVBIC8gMjU1LjAsIDB4Q0QgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJTTEFURUdSQVlcIjogWzB4NzAgLyAyNTUuMCwgMHg4MCAvIDI1NS4wLCAweDkwIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiU0xBVEVHUkVZXCI6IFsweDcwIC8gMjU1LjAsIDB4ODAgLyAyNTUuMCwgMHg5MCAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIlNOT1dcIjogWzB4RkYgLyAyNTUuMCwgMHhGQSAvIDI1NS4wLCAweEZBIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiU1BSSU5HR1JFRU5cIjogWzB4MDAgLyAyNTUuMCwgMHhGRiAvIDI1NS4wLCAweDdGIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiU1RFRUxCTFVFXCI6IFsweDQ2IC8gMjU1LjAsIDB4ODIgLyAyNTUuMCwgMHhCNCAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIlRBTlwiOiBbMHhEMiAvIDI1NS4wLCAweEI0IC8gMjU1LjAsIDB4OEMgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJURUFMXCI6IFsweDAwIC8gMjU1LjAsIDB4ODAgLyAyNTUuMCwgMHg4MCAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIlRISVNUTEVcIjogWzB4RDggLyAyNTUuMCwgMHhCRiAvIDI1NS4wLCAweEQ4IC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiVE9NQVRPXCI6IFsweEZGIC8gMjU1LjAsIDB4NjMgLyAyNTUuMCwgMHg0NyAvIDI1NS4wLCAxLjBdLFxuICAgICAgICBcIlRVUlFVT0lTRVwiOiBbMHg0MCAvIDI1NS4wLCAweEUwIC8gMjU1LjAsIDB4RDAgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJWSU9MRVRcIjogWzB4RUUgLyAyNTUuMCwgMHg4MiAvIDI1NS4wLCAweEVFIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiV0hFQVRcIjogWzB4RjUgLyAyNTUuMCwgMHhERSAvIDI1NS4wLCAweEIzIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiV0hJVEVcIjogWzB4RkYgLyAyNTUuMCwgMHhGRiAvIDI1NS4wLCAweEZGIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiV0hJVEVTTU9LRVwiOiBbMHhGNSAvIDI1NS4wLCAweEY1IC8gMjU1LjAsIDB4RjUgLyAyNTUuMCwgMS4wXSxcbiAgICAgICAgXCJZRUxMT1dcIjogWzB4RkYgLyAyNTUuMCwgMHhGRiAvIDI1NS4wLCAweDAwIC8gMjU1LjAsIDEuMF0sXG4gICAgICAgIFwiWUVMTE9XR1JFRU5cIjogWzB4OUEgLyAyNTUuMCwgMHhDRCAvIDI1NS4wLCAweDMyIC8gMjU1LjAsIDEuMF1cbiAgICB9O1xuICAgIGZ1bmN0aW9uIGdldChjb2xvcikge1xuICAgICAgICB2YXIgcmdiYSA9ICh0eXBlb2YgY29sb3IgPT09IFwic3RyaW5nXCIpID8gV2ViR0xDb2xvci5fdG9Db2xvcihjb2xvcikgOiBbY29sb3JbMF0sIGNvbG9yWzFdLCBjb2xvclsyXSwgY29sb3JbM11dO1xuICAgICAgICByZ2JhWzNdID0gUmVuZGVyaW5nSGVscGVyXzEuUmVuZGVyaW5nSGVscGVyLmNsYW1wKHJnYmFbM10pO1xuICAgICAgICByZ2JhWzBdID0gUmVuZGVyaW5nSGVscGVyXzEuUmVuZGVyaW5nSGVscGVyLmNsYW1wKHJnYmFbMF0pICogcmdiYVszXTtcbiAgICAgICAgcmdiYVsxXSA9IFJlbmRlcmluZ0hlbHBlcl8xLlJlbmRlcmluZ0hlbHBlci5jbGFtcChyZ2JhWzFdKSAqIHJnYmFbM107XG4gICAgICAgIHJnYmFbMl0gPSBSZW5kZXJpbmdIZWxwZXJfMS5SZW5kZXJpbmdIZWxwZXIuY2xhbXAocmdiYVsyXSkgKiByZ2JhWzNdO1xuICAgICAgICByZXR1cm4gcmdiYTtcbiAgICB9XG4gICAgV2ViR0xDb2xvci5nZXQgPSBnZXQ7XG4gICAgZnVuY3Rpb24gX2hzbDJyZ2IoaHNsKSB7XG4gICAgICAgIHZhciBoID0gaHNsWzBdICUgMzYwO1xuICAgICAgICB2YXIgcyA9IGhzbFsxXTtcbiAgICAgICAgdmFyIGwgPSAoaHNsWzJdID4gNTApID8gMTAwIC0gaHNsWzJdIDogaHNsWzJdO1xuICAgICAgICB2YXIgYSA9IGhzbFszXTtcbiAgICAgICAgdmFyIG1heCA9IGwgKyBsICogcztcbiAgICAgICAgdmFyIG1pbiA9IGwgLSBsICogcztcbiAgICAgICAgaWYgKGggPCA2MCkge1xuICAgICAgICAgICAgcmV0dXJuIFttYXgsIChoIC8gNjAuMCkgKiAobWF4IC0gbWluKSArIG1pbiwgbWluLCBhXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChoIDwgMTIwKSB7XG4gICAgICAgICAgICByZXR1cm4gWygoMTIwIC0gaCkgLyA2MC4wKSAqIChtYXggLSBtaW4pICsgbWluLCBtYXgsIG1pbiwgYV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaCA8IDE4MCkge1xuICAgICAgICAgICAgcmV0dXJuIFttaW4sIG1heCwgKChoIC0gMTIwKSAvIDYwLjApICogKG1heCAtIG1pbikgKyBtaW4sIGFdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGggPCAyNDApIHtcbiAgICAgICAgICAgIHJldHVybiBbbWluLCAoKDI0MCAtIGgpIC8gNjAuMCkgKiAobWF4IC0gbWluKSArIG1pbiwgbWF4LCBhXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChoIDwgMzAwKSB7XG4gICAgICAgICAgICByZXR1cm4gWygoaCAtIDI0MCkgLyA2MC4wKSAqIChtYXggLSBtaW4pICsgbWluLCBtaW4sIG1heCwgYV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gW21heCwgbWluLCAoKDM2MCAtIGgpIC8gNjAuMCkgKiAobWF4IC0gbWluKSArIG1pbiwgYV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgV2ViR0xDb2xvci5faHNsMnJnYiA9IF9oc2wycmdiO1xuICAgIGZ1bmN0aW9uIF90b0NvbG9yKGNzc0NvbG9yKSB7XG4gICAgICAgIC8vIOWkp+aWh+Wtl+WMluOBl+OBpuepuueZveOCkuWJiumZpCAobmNjOiBub3JtYWxpemVkIGNzcyBjb2xvcilcbiAgICAgICAgdmFyIG5jYyA9IGNzc0NvbG9yLnRvVXBwZXJDYXNlKCkucmVwbGFjZSgvXFxzKy9nLCBcIlwiKTtcbiAgICAgICAgdmFyIHJnYmEgPSBXZWJHTENvbG9yLmNvbG9yTWFwW25jY107XG4gICAgICAgIGlmIChyZ2JhKSB7XG4gICAgICAgICAgICByZXR1cm4gcmdiYTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmNjLm1hdGNoKC9eIyhbXFxkQS1GXSkoW1xcZEEtRl0pKFtcXGRBLUZdKSQvKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICBwYXJzZUludChSZWdFeHAuJDEsIDE2KSAvIDE1LjAsXG4gICAgICAgICAgICAgICAgcGFyc2VJbnQoUmVnRXhwLiQyLCAxNikgLyAxNS4wLFxuICAgICAgICAgICAgICAgIHBhcnNlSW50KFJlZ0V4cC4kMywgMTYpIC8gMTUuMCwgMS4wXG4gICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG5jYy5tYXRjaCgvXiMoW1xcZEEtRl17Mn0pKFtcXGRBLUZdezJ9KShbXFxkQS1GXXsyfSkkLykpIHtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgcGFyc2VJbnQoUmVnRXhwLiQxLCAxNikgLyAyNTUuMCxcbiAgICAgICAgICAgICAgICBwYXJzZUludChSZWdFeHAuJDIsIDE2KSAvIDI1NS4wLFxuICAgICAgICAgICAgICAgIHBhcnNlSW50KFJlZ0V4cC4kMywgMTYpIC8gMjU1LjAsIDEuMFxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChuY2MubWF0Y2goL15SR0JcXCgoXFxkezEsM30pLChcXGR7MSwzfSksKFxcZHsxLDN9KVxcKSQvKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICBwYXJzZUludChSZWdFeHAuJDEsIDEwKSAvIDI1NS4wLFxuICAgICAgICAgICAgICAgIHBhcnNlSW50KFJlZ0V4cC4kMiwgMTApIC8gMjU1LjAsXG4gICAgICAgICAgICAgICAgcGFyc2VJbnQoUmVnRXhwLiQzLCAxMCkgLyAyNTUuMCwgMS4wXG4gICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG5jYy5tYXRjaCgvXlJHQkFcXCgoXFxkezEsM30pLChcXGR7MSwzfSksKFxcZHsxLDN9KSwoXFxkKFxcLlxcZCopPylcXCkkLykpIHtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgcGFyc2VJbnQoUmVnRXhwLiQxLCAxMCkgLyAyNTUuMCxcbiAgICAgICAgICAgICAgICBwYXJzZUludChSZWdFeHAuJDIsIDEwKSAvIDI1NS4wLFxuICAgICAgICAgICAgICAgIHBhcnNlSW50KFJlZ0V4cC4kMywgMTApIC8gMjU1LjAsXG4gICAgICAgICAgICAgICAgcGFyc2VGbG9hdChSZWdFeHAuJDQpXG4gICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG5jYy5tYXRjaCgvXkhTTFxcKChcXGR7MSwzfSksKFxcZHsxLDN9KSUsKFxcZHsxLDN9KSVcXCkkLykpIHtcbiAgICAgICAgICAgIHJldHVybiBXZWJHTENvbG9yLl9oc2wycmdiKFtcbiAgICAgICAgICAgICAgICBwYXJzZUludChSZWdFeHAuJDEsIDEwKSxcbiAgICAgICAgICAgICAgICBSZW5kZXJpbmdIZWxwZXJfMS5SZW5kZXJpbmdIZWxwZXIuY2xhbXAocGFyc2VJbnQoUmVnRXhwLiQyLCAxMCkgLyAxMDAuMCksXG4gICAgICAgICAgICAgICAgUmVuZGVyaW5nSGVscGVyXzEuUmVuZGVyaW5nSGVscGVyLmNsYW1wKHBhcnNlSW50KFJlZ0V4cC4kMywgMTApIC8gMTAwLjApLCAxLjBcbiAgICAgICAgICAgIF0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG5jYy5tYXRjaCgvXkhTTEFcXCgoXFxkezEsM30pLChcXGR7MSwzfSklLChcXGR7MSwzfSklLChcXGQoXFwuXFxkKik/KVxcKSQvKSkge1xuICAgICAgICAgICAgcmV0dXJuIFdlYkdMQ29sb3IuX2hzbDJyZ2IoW1xuICAgICAgICAgICAgICAgIHBhcnNlSW50KFJlZ0V4cC4kMSwgMTApLFxuICAgICAgICAgICAgICAgIFJlbmRlcmluZ0hlbHBlcl8xLlJlbmRlcmluZ0hlbHBlci5jbGFtcChwYXJzZUludChSZWdFeHAuJDIsIDEwKSAvIDEwMC4wKSxcbiAgICAgICAgICAgICAgICBSZW5kZXJpbmdIZWxwZXJfMS5SZW5kZXJpbmdIZWxwZXIuY2xhbXAocGFyc2VJbnQoUmVnRXhwLiQzLCAxMCkgLyAxMDAuMCksXG4gICAgICAgICAgICAgICAgcGFyc2VGbG9hdChSZWdFeHAuJDQpXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwiaWxsaWdhbCBjc3NDb2xvciBmb3JtYXQ6IFwiICsgbmNjKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBXZWJHTENvbG9yLl90b0NvbG9yID0gX3RvQ29sb3I7XG59KShXZWJHTENvbG9yID0gZXhwb3J0cy5XZWJHTENvbG9yIHx8IChleHBvcnRzLldlYkdMQ29sb3IgPSB7fSkpO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuV2ViR0xQcmltYXJ5U3VyZmFjZSA9IHZvaWQgMDtcbnZhciBDYW52YXNTdXJmYWNlXzEgPSByZXF1aXJlKFwiLi4vQ2FudmFzU3VyZmFjZVwiKTtcbnZhciBXZWJHTFByaW1hcnlTdXJmYWNlUmVuZGVyZXJfMSA9IHJlcXVpcmUoXCIuL1dlYkdMUHJpbWFyeVN1cmZhY2VSZW5kZXJlclwiKTtcbnZhciBXZWJHTFByaW1hcnlTdXJmYWNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhXZWJHTFByaW1hcnlTdXJmYWNlLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFdlYkdMUHJpbWFyeVN1cmZhY2Uoc2hhcmVkLCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHdpZHRoLCBoZWlnaHQpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLmNhbnZhcy5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICAgICAgX3RoaXMuX3NoYXJlZCA9IHNoYXJlZDtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBXZWJHTFByaW1hcnlTdXJmYWNlLnByb3RvdHlwZS5yZW5kZXJlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9yZW5kZXJlcikge1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSBuZXcgV2ViR0xQcmltYXJ5U3VyZmFjZVJlbmRlcmVyXzEuV2ViR0xQcmltYXJ5U3VyZmFjZVJlbmRlcmVyKHRoaXMuX3NoYXJlZCwgdGhpcy5fc2hhcmVkLmdldFByaW1hcnlSZW5kZXJUYXJnZXQodGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyZXI7XG4gICAgfTtcbiAgICAvLyBvdmVycmlkZVxuICAgIFdlYkdMUHJpbWFyeVN1cmZhY2UucHJvdG90eXBlLmNoYW5nZVBoeXNpY2FsU2NhbGUgPSBmdW5jdGlvbiAoeFNjYWxlLCB5U2NhbGUpIHtcbiAgICAgICAgdmFyIHdpZHRoID0gTWF0aC5jZWlsKHRoaXMud2lkdGggKiB4U2NhbGUpO1xuICAgICAgICB2YXIgaGVpZ2h0ID0gTWF0aC5jZWlsKHRoaXMuaGVpZ2h0ICogeVNjYWxlKTtcbiAgICAgICAgdGhpcy5jYW52YXMud2lkdGggPSB3aWR0aDtcbiAgICAgICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICB0aGlzLnJlbmRlcmVyKCkuY2hhbmdlVmlld3BvcnRTaXplKHdpZHRoLCBoZWlnaHQpO1xuICAgIH07XG4gICAgV2ViR0xQcmltYXJ5U3VyZmFjZS5wcm90b3R5cGUuaXNQbGF5aW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICByZXR1cm4gV2ViR0xQcmltYXJ5U3VyZmFjZTtcbn0oQ2FudmFzU3VyZmFjZV8xLkNhbnZhc1N1cmZhY2UpKTtcbmV4cG9ydHMuV2ViR0xQcmltYXJ5U3VyZmFjZSA9IFdlYkdMUHJpbWFyeVN1cmZhY2U7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5XZWJHTFByaW1hcnlTdXJmYWNlUmVuZGVyZXIgPSB2b2lkIDA7XG52YXIgV2ViR0xSZW5kZXJlcl8xID0gcmVxdWlyZShcIi4vV2ViR0xSZW5kZXJlclwiKTtcbnZhciBXZWJHTFByaW1hcnlTdXJmYWNlUmVuZGVyZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFdlYkdMUHJpbWFyeVN1cmZhY2VSZW5kZXJlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBXZWJHTFByaW1hcnlTdXJmYWNlUmVuZGVyZXIoc2hhcmVkLCByZW5kZXJUYXJnZXQpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc2hhcmVkLCByZW5kZXJUYXJnZXQpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLl9zaGFyZWQucHVzaFJlbmRlclRhcmdldChfdGhpcy5fcmVuZGVyVGFyZ2V0KTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBXZWJHTFByaW1hcnlTdXJmYWNlUmVuZGVyZXIucHJvdG90eXBlLmJlZ2luID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmJlZ2luLmNhbGwodGhpcyk7XG4gICAgICAgIHRoaXMuX3NoYXJlZC5iZWdpbigpO1xuICAgIH07XG4gICAgcmV0dXJuIFdlYkdMUHJpbWFyeVN1cmZhY2VSZW5kZXJlcjtcbn0oV2ViR0xSZW5kZXJlcl8xLldlYkdMUmVuZGVyZXIpKTtcbmV4cG9ydHMuV2ViR0xQcmltYXJ5U3VyZmFjZVJlbmRlcmVyID0gV2ViR0xQcmltYXJ5U3VyZmFjZVJlbmRlcmVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuV2ViR0xSZW5kZXJlciA9IHZvaWQgMDtcbnZhciBnID0gcmVxdWlyZShcIkBha2FzaGljL2FrYXNoaWMtZW5naW5lXCIpO1xudmFyIFdlYkdMQ29sb3JfMSA9IHJlcXVpcmUoXCIuL1dlYkdMQ29sb3JcIik7XG52YXIgV2ViR0xSZW5kZXJpbmdTdGF0ZV8xID0gcmVxdWlyZShcIi4vV2ViR0xSZW5kZXJpbmdTdGF0ZVwiKTtcbnZhciBXZWJHTFJlbmRlcmVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhXZWJHTFJlbmRlcmVyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFdlYkdMUmVuZGVyZXIoc2hhcmVkLCByZW5kZXJUYXJnZXQpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX3N0YXRlU3RhY2sgPSBbXTtcbiAgICAgICAgX3RoaXMuX3N0YXRlU3RhY2tQb2ludGVyID0gMDtcbiAgICAgICAgX3RoaXMuX2NhcGFjaXR5ID0gMDtcbiAgICAgICAgX3RoaXMuX3JlYWxsb2NhdGlvbihXZWJHTFJlbmRlcmVyLkRFRkFVTFRfQ0FQQUNJVFkpO1xuICAgICAgICBfdGhpcy5fd2hpdGVDb2xvciA9IFsxLjAsIDEuMCwgMS4wLCAxLjBdO1xuICAgICAgICBfdGhpcy5fc2hhcmVkID0gc2hhcmVkO1xuICAgICAgICBfdGhpcy5fcmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zaGFyZWQuY2xlYXIoKTtcbiAgICB9O1xuICAgIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLmVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc2hhcmVkLmVuZCgpO1xuICAgIH07XG4gICAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuc2F2ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fcHVzaFN0YXRlKCk7XG4gICAgfTtcbiAgICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5yZXN0b3JlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9wb3BTdGF0ZSgpO1xuICAgIH07XG4gICAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUudHJhbnNsYXRlID0gZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50U3RhdGUoKS50cmFuc2Zvcm1lci50cmFuc2xhdGUoeCwgeSk7XG4gICAgfTtcbiAgICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS50cmFuc2Zvcm0gPSBmdW5jdGlvbiAobWF0cml4KSB7XG4gICAgICAgIHRoaXMuY3VycmVudFN0YXRlKCkudHJhbnNmb3JtZXIudHJhbnNmb3JtKG1hdHJpeCk7XG4gICAgfTtcbiAgICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5vcGFjaXR5ID0gZnVuY3Rpb24gKG9wYWNpdHkpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50U3RhdGUoKS5nbG9iYWxBbHBoYSAqPSBvcGFjaXR5O1xuICAgIH07XG4gICAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuc2V0Q29tcG9zaXRlT3BlcmF0aW9uID0gZnVuY3Rpb24gKG9wZXJhdGlvbikge1xuICAgICAgICB0aGlzLmN1cnJlbnRTdGF0ZSgpLmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IG9wZXJhdGlvbjtcbiAgICB9O1xuICAgIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLmN1cnJlbnRTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlU3RhY2tbdGhpcy5fc3RhdGVTdGFja1BvaW50ZXJdO1xuICAgIH07XG4gICAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuZmlsbFJlY3QgPSBmdW5jdGlvbiAoeCwgeSwgd2lkdGgsIGhlaWdodCwgY3NzQ29sb3IpIHtcbiAgICAgICAgdGhpcy5fc2hhcmVkLmRyYXcodGhpcy5jdXJyZW50U3RhdGUoKSwgdGhpcy5fc2hhcmVkLmdldEZpbGxSZWN0U3VyZmFjZVRleHR1cmUoKSwgMCwgMCwgd2lkdGgsIGhlaWdodCwgeCwgeSwgV2ViR0xDb2xvcl8xLldlYkdMQ29sb3IuZ2V0KGNzc0NvbG9yKSk7XG4gICAgfTtcbiAgICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5kcmF3U3ByaXRlcyA9IGZ1bmN0aW9uIChzdXJmYWNlLCBvZmZzZXRYLCBvZmZzZXRZLCB3aWR0aCwgaGVpZ2h0LCBjYW52YXNPZmZzZXRYLCBjYW52YXNPZmZzZXRZLCBjb3VudCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyArK2kpIHtcbiAgICAgICAgICAgIHRoaXMuZHJhd0ltYWdlKHN1cmZhY2UsIG9mZnNldFhbaV0sIG9mZnNldFlbaV0sIHdpZHRoW2ldLCBoZWlnaHRbaV0sIGNhbnZhc09mZnNldFhbaV0sIGNhbnZhc09mZnNldFlbaV0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5kcmF3SW1hZ2UgPSBmdW5jdGlvbiAoc3VyZmFjZSwgb2Zmc2V0WCwgb2Zmc2V0WSwgd2lkdGgsIGhlaWdodCwgY2FudmFzT2Zmc2V0WCwgY2FudmFzT2Zmc2V0WSkge1xuICAgICAgICBpZiAoIXN1cmZhY2UuX2RyYXdhYmxlKSB7XG4gICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJXZWJHTFJlbmRlcmVyI2RyYXdJbWFnZTogbm8gZHJhd2FibGUgc3VyZmFjZS5cIik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2ViR0xUZXh0dXJlIOOBp+OBquOBhOOBquOCieWkieaPm+OBmeOCiyAoSFRNTFZpZGVvRWxlbWVudCDjga/lr77lv5zjgZfjgarjgYQpXG4gICAgICAgIC8vIE5PVEU6IOWvvuixoeOBriBzdXJmYWNlIOOBjOWLleeUu+OBruWgtOWQiOOAgeeLrOeri+OBl+OBnyBmcmFtZWJ1ZmZlciDjgavmj4/nlLvjgZfjgZ/mlrnjgYzjg5Hjg5Xjgqnjg7zjg57jg7PjgrnkuIrlhKrkvY3jgavjgarjgorlvpfjgotcbiAgICAgICAgaWYgKCEoc3VyZmFjZS5fZHJhd2FibGUudGV4dHVyZSBpbnN0YW5jZW9mIFdlYkdMVGV4dHVyZSkpIHtcbiAgICAgICAgICAgIHRoaXMuX3NoYXJlZC5tYWtlVGV4dHVyZUZvclN1cmZhY2Uoc3VyZmFjZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFzdXJmYWNlLl9kcmF3YWJsZS50ZXh0dXJlKSB7XG4gICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJXZWJHTFJlbmRlcmVyI2RyYXdJbWFnZTogY291bGQgbm90IGNyZWF0ZSBhIHRleHR1cmUuXCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3NoYXJlZC5kcmF3KHRoaXMuY3VycmVudFN0YXRlKCksIHN1cmZhY2UuX2RyYXdhYmxlLCBvZmZzZXRYLCBvZmZzZXRZLCB3aWR0aCwgaGVpZ2h0LCBjYW52YXNPZmZzZXRYLCBjYW52YXNPZmZzZXRZLCB0aGlzLl93aGl0ZUNvbG9yKTtcbiAgICB9O1xuICAgIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLmRyYXdTeXN0ZW1UZXh0ID0gZnVuY3Rpb24gKHRleHQsIHgsIHksIG1heFdpZHRoLCBmb250U2l6ZSwgdGV4dEFsaWduLCB0ZXh0QmFzZWxpbmUsIHRleHRDb2xvciwgZm9udEZhbWlseSwgc3Ryb2tlV2lkdGgsIHN0cm9rZUNvbG9yLCBzdHJva2VPbmx5KSB7XG4gICAgICAgIC8vIGRvIG5vdGhpbmcuXG4gICAgfTtcbiAgICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5zZXRUcmFuc2Zvcm0gPSBmdW5jdGlvbiAobWF0cml4KSB7XG4gICAgICAgIHRoaXMuY3VycmVudFN0YXRlKCkudHJhbnNmb3JtZXIuc2V0VHJhbnNmb3JtKG1hdHJpeCk7XG4gICAgfTtcbiAgICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5zZXRPcGFjaXR5ID0gZnVuY3Rpb24gKG9wYWNpdHkpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50U3RhdGUoKS5nbG9iYWxBbHBoYSA9IG9wYWNpdHk7XG4gICAgfTtcbiAgICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5zZXRTaGFkZXJQcm9ncmFtID0gZnVuY3Rpb24gKHNoYWRlclByb2dyYW0pIHtcbiAgICAgICAgdGhpcy5jdXJyZW50U3RhdGUoKS5zaGFkZXJQcm9ncmFtID0gdGhpcy5fc2hhcmVkLmluaXRpYWxpemVTaGFkZXJQcm9ncmFtKHNoYWRlclByb2dyYW0pO1xuICAgIH07XG4gICAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuaXNTdXBwb3J0ZWRTaGFkZXJQcm9ncmFtID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLmNoYW5nZVZpZXdwb3J0U2l6ZSA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgIHZhciBvbGQgPSB0aGlzLl9yZW5kZXJUYXJnZXQ7XG4gICAgICAgIHRoaXMuX3JlbmRlclRhcmdldCA9IHtcbiAgICAgICAgICAgIHdpZHRoOiBvbGQud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IG9sZC5oZWlnaHQsXG4gICAgICAgICAgICB2aWV3cG9ydFdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgIHZpZXdwb3J0SGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgICAgICB0ZXh0dXJlOiBvbGQudGV4dHVyZSxcbiAgICAgICAgICAgIGZyYW1lYnVmZmVyOiBvbGQuZnJhbWVidWZmZXJcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3NoYXJlZC5yZXF1ZXN0RGVsZXRlUmVuZGVyVGFyZ2V0KHRoaXMuX3JlbmRlclRhcmdldCk7XG4gICAgICAgIHRoaXMuX3NoYXJlZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5fcmVuZGVyVGFyZ2V0ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLl93aGl0ZUNvbG9yID0gdW5kZWZpbmVkO1xuICAgIH07XG4gICAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuX2dldEltYWdlRGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiV2ViR0xSZW5kZXJlciNfZ2V0SW1hZ2VEYXRhKCkgaXMgbm90IGltcGxlbWVudGVkXCIpO1xuICAgIH07XG4gICAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuX3B1dEltYWdlRGF0YSA9IGZ1bmN0aW9uIChpbWFnZURhdGEsIGR4LCBkeSwgZGlydHlYLCBkaXJ0eVksIGRpcnR5V2lkdGgsIGRpcnR5SGVpZ2h0KSB7XG4gICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIldlYkdMUmVuZGVyZXIjX3B1dEltYWdlRGF0YSgpIGlzIG5vdCBpbXBsZW1lbnRlZFwiKTtcbiAgICB9O1xuICAgIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLl9wdXNoU3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBvbGQgPSB0aGlzLmN1cnJlbnRTdGF0ZSgpO1xuICAgICAgICArK3RoaXMuX3N0YXRlU3RhY2tQb2ludGVyO1xuICAgICAgICBpZiAodGhpcy5faXNPdmVyQ2FwYWNpdHkoKSkge1xuICAgICAgICAgICAgdGhpcy5fcmVhbGxvY2F0aW9uKHRoaXMuX3N0YXRlU3RhY2tQb2ludGVyICsgMSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jdXJyZW50U3RhdGUoKS5jb3B5RnJvbShvbGQpO1xuICAgIH07XG4gICAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuX3BvcFN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fc3RhdGVTdGFja1BvaW50ZXIgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTdGF0ZSgpLnNoYWRlclByb2dyYW0gPSBudWxsO1xuICAgICAgICAgICAgLS10aGlzLl9zdGF0ZVN0YWNrUG9pbnRlcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIldlYkdMUmVuZGVyZXIjcmVzdG9yZTogc3RhdGUgc3RhY2sgdW5kZXItZmxvdy5cIik7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLl9pc092ZXJDYXBhY2l0eSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NhcGFjaXR5IDw9IHRoaXMuX3N0YXRlU3RhY2tQb2ludGVyO1xuICAgIH07XG4gICAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuX3JlYWxsb2NhdGlvbiA9IGZ1bmN0aW9uIChuZXdDYXBhY2l0eSkge1xuICAgICAgICAvLyDmjIfmlbDnmoTmiJDplbfjg53jg6rjgrfjg7zjga7lho3libLlvZM6XG4gICAgICAgIHZhciBvbGRDYXBhY2l0eSA9IHRoaXMuX2NhcGFjaXR5O1xuICAgICAgICBpZiAob2xkQ2FwYWNpdHkgPCBuZXdDYXBhY2l0eSkge1xuICAgICAgICAgICAgaWYgKG5ld0NhcGFjaXR5IDwgKG9sZENhcGFjaXR5ICogMikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jYXBhY2l0eSAqPSAyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY2FwYWNpdHkgPSBuZXdDYXBhY2l0eTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBvbGRDYXBhY2l0eTsgaSA8IHRoaXMuX2NhcGFjaXR5OyArK2kpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZVN0YWNrLnB1c2gobmV3IFdlYkdMUmVuZGVyaW5nU3RhdGVfMS5XZWJHTFJlbmRlcmluZ1N0YXRlKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBXZWJHTFJlbmRlcmVyLkRFRkFVTFRfQ0FQQUNJVFkgPSAxNjtcbiAgICByZXR1cm4gV2ViR0xSZW5kZXJlcjtcbn0oZy5SZW5kZXJlcikpO1xuZXhwb3J0cy5XZWJHTFJlbmRlcmVyID0gV2ViR0xSZW5kZXJlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5XZWJHTFJlbmRlcmluZ1N0YXRlID0gdm9pZCAwO1xudmFyIGcgPSByZXF1aXJlKFwiQGFrYXNoaWMvYWthc2hpYy1lbmdpbmVcIik7XG52YXIgQWZmaW5lVHJhbnNmb3JtZXJfMSA9IHJlcXVpcmUoXCIuLi9BZmZpbmVUcmFuc2Zvcm1lclwiKTtcbnZhciBXZWJHTFJlbmRlcmluZ1N0YXRlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFdlYkdMUmVuZGVyaW5nU3RhdGUocmhzKSB7XG4gICAgICAgIGlmIChyaHMpIHtcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsQWxwaGEgPSByaHMuZ2xvYmFsQWxwaGE7XG4gICAgICAgICAgICB0aGlzLmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IHJocy5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb247XG4gICAgICAgICAgICB0aGlzLnRyYW5zZm9ybWVyID0gbmV3IEFmZmluZVRyYW5zZm9ybWVyXzEuQWZmaW5lVHJhbnNmb3JtZXIocmhzLnRyYW5zZm9ybWVyKTtcbiAgICAgICAgICAgIHRoaXMuc2hhZGVyUHJvZ3JhbSA9IHJocy5zaGFkZXJQcm9ncmFtO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5nbG9iYWxBbHBoYSA9IDEuMDtcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gZy5Db21wb3NpdGVPcGVyYXRpb24uU291cmNlT3ZlcjtcbiAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtZXIgPSBuZXcgQWZmaW5lVHJhbnNmb3JtZXJfMS5BZmZpbmVUcmFuc2Zvcm1lcigpO1xuICAgICAgICAgICAgdGhpcy5zaGFkZXJQcm9ncmFtID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBXZWJHTFJlbmRlcmluZ1N0YXRlLnByb3RvdHlwZS5jb3B5RnJvbSA9IGZ1bmN0aW9uIChyaHMpIHtcbiAgICAgICAgdGhpcy5nbG9iYWxBbHBoYSA9IHJocy5nbG9iYWxBbHBoYTtcbiAgICAgICAgdGhpcy5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSByaHMuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uO1xuICAgICAgICB0aGlzLnRyYW5zZm9ybWVyLmNvcHlGcm9tKHJocy50cmFuc2Zvcm1lcik7XG4gICAgICAgIHRoaXMuc2hhZGVyUHJvZ3JhbSA9IHJocy5zaGFkZXJQcm9ncmFtO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIHJldHVybiBXZWJHTFJlbmRlcmluZ1N0YXRlO1xufSgpKTtcbmV4cG9ydHMuV2ViR0xSZW5kZXJpbmdTdGF0ZSA9IFdlYkdMUmVuZGVyaW5nU3RhdGU7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuV2ViR0xTaGFkZXJQcm9ncmFtID0gdm9pZCAwO1xudmFyIGcgPSByZXF1aXJlKFwiQGFrYXNoaWMvYWthc2hpYy1lbmdpbmVcIik7XG52YXIgV2ViR0xTaGFkZXJQcm9ncmFtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFdlYkdMU2hhZGVyUHJvZ3JhbShjb250ZXh0LCBmU3JjLCB1bmlmb3Jtcykge1xuICAgICAgICB2YXIgdlNyYyA9IFdlYkdMU2hhZGVyUHJvZ3JhbS5fREVGQVVMVF9WRVJURVhfU0hBREVSO1xuICAgICAgICB2YXIgZlNyYyA9IGZTcmMgfHwgV2ViR0xTaGFkZXJQcm9ncmFtLl9ERUZBVUxUX0ZSQUdNRU5UX1NIQURFUjtcbiAgICAgICAgdmFyIHByb2dyYW0gPSBXZWJHTFNoYWRlclByb2dyYW0uX21ha2VTaGFkZXJQcm9ncmFtKGNvbnRleHQsIHZTcmMsIGZTcmMpO1xuICAgICAgICB0aGlzLnByb2dyYW0gPSBwcm9ncmFtO1xuICAgICAgICB0aGlzLl9jb250ZXh0ID0gY29udGV4dDtcbiAgICAgICAgdGhpcy5fYVZlcnRleCA9IGNvbnRleHQuZ2V0QXR0cmliTG9jYXRpb24odGhpcy5wcm9ncmFtLCBcImFWZXJ0ZXhcIik7XG4gICAgICAgIHRoaXMuX3VDb2xvciA9IGNvbnRleHQuZ2V0VW5pZm9ybUxvY2F0aW9uKHRoaXMucHJvZ3JhbSwgXCJ1Q29sb3JcIik7XG4gICAgICAgIHRoaXMuX3VBbHBoYSA9IGNvbnRleHQuZ2V0VW5pZm9ybUxvY2F0aW9uKHRoaXMucHJvZ3JhbSwgXCJ1QWxwaGFcIik7XG4gICAgICAgIHRoaXMuX3VTYW1wbGVyID0gY29udGV4dC5nZXRVbmlmb3JtTG9jYXRpb24odGhpcy5wcm9ncmFtLCBcInVTYW1wbGVyXCIpO1xuICAgICAgICB0aGlzLl91bmlmb3JtcyA9IHVuaWZvcm1zO1xuICAgICAgICB0aGlzLl91bmlmb3JtQ2FjaGVzID0gW107XG4gICAgICAgIHRoaXMuX3VuaWZvcm1TZXR0ZXJUYWJsZSA9IHtcbiAgICAgICAgICAgIFwiZmxvYXRcIjogdGhpcy5fdW5pZm9ybTFmLmJpbmQodGhpcyksXG4gICAgICAgICAgICBcImludFwiOiB0aGlzLl91bmlmb3JtMWkuYmluZCh0aGlzKSxcbiAgICAgICAgICAgIFwiZmxvYXRfdlwiOiB0aGlzLl91bmlmb3JtMWZ2LmJpbmQodGhpcyksXG4gICAgICAgICAgICBcImludF92XCI6IHRoaXMuX3VuaWZvcm0xaXYuYmluZCh0aGlzKSxcbiAgICAgICAgICAgIFwidmVjMlwiOiB0aGlzLl91bmlmb3JtMmZ2LmJpbmQodGhpcyksXG4gICAgICAgICAgICBcInZlYzNcIjogdGhpcy5fdW5pZm9ybTNmdi5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgXCJ2ZWM0XCI6IHRoaXMuX3VuaWZvcm00ZnYuYmluZCh0aGlzKSxcbiAgICAgICAgICAgIFwiaXZlYzJcIjogdGhpcy5fdW5pZm9ybTJpdi5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgXCJpdmVjM1wiOiB0aGlzLl91bmlmb3JtM2l2LmJpbmQodGhpcyksXG4gICAgICAgICAgICBcIml2ZWM0XCI6IHRoaXMuX3VuaWZvcm00aXYuYmluZCh0aGlzKSxcbiAgICAgICAgICAgIFwibWF0MlwiOiB0aGlzLl91bmlmb3JtTWF0cml4MmZ2LmJpbmQodGhpcyksXG4gICAgICAgICAgICBcIm1hdDNcIjogdGhpcy5fdW5pZm9ybU1hdHJpeDNmdi5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgXCJtYXQ0XCI6IHRoaXMuX3VuaWZvcm1NYXRyaXg0ZnYuYmluZCh0aGlzKVxuICAgICAgICB9O1xuICAgIH1cbiAgICBXZWJHTFNoYWRlclByb2dyYW0uX21ha2VTaGFkZXIgPSBmdW5jdGlvbiAoZ2wsIHR5cCwgc3JjKSB7XG4gICAgICAgIHZhciBzaGFkZXIgPSBnbC5jcmVhdGVTaGFkZXIodHlwKTtcbiAgICAgICAgZ2wuc2hhZGVyU291cmNlKHNoYWRlciwgc3JjKTtcbiAgICAgICAgZ2wuY29tcGlsZVNoYWRlcihzaGFkZXIpO1xuICAgICAgICBpZiAoIWdsLmdldFNoYWRlclBhcmFtZXRlcihzaGFkZXIsIGdsLkNPTVBJTEVfU1RBVFVTKSkge1xuICAgICAgICAgICAgdmFyIG1zZyA9IGdsLmdldFNoYWRlckluZm9Mb2coc2hhZGVyKTtcbiAgICAgICAgICAgIGdsLmRlbGV0ZVNoYWRlcihzaGFkZXIpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNoYWRlcjtcbiAgICB9O1xuICAgIFdlYkdMU2hhZGVyUHJvZ3JhbS5fbWFrZVNoYWRlclByb2dyYW0gPSBmdW5jdGlvbiAoZ2wsIHZTcmMsIGZTcmMpIHtcbiAgICAgICAgdmFyIHByb2dyYW0gPSBnbC5jcmVhdGVQcm9ncmFtKCk7XG4gICAgICAgIHZhciB2U2hhZGVyID0gV2ViR0xTaGFkZXJQcm9ncmFtLl9tYWtlU2hhZGVyKGdsLCBnbC5WRVJURVhfU0hBREVSLCB2U3JjKTtcbiAgICAgICAgZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIHZTaGFkZXIpO1xuICAgICAgICBnbC5kZWxldGVTaGFkZXIodlNoYWRlcik7XG4gICAgICAgIHZhciBmU2hhZGVyID0gV2ViR0xTaGFkZXJQcm9ncmFtLl9tYWtlU2hhZGVyKGdsLCBnbC5GUkFHTUVOVF9TSEFERVIsIGZTcmMpO1xuICAgICAgICBnbC5hdHRhY2hTaGFkZXIocHJvZ3JhbSwgZlNoYWRlcik7XG4gICAgICAgIGdsLmRlbGV0ZVNoYWRlcihmU2hhZGVyKTtcbiAgICAgICAgZ2wubGlua1Byb2dyYW0ocHJvZ3JhbSk7XG4gICAgICAgIGlmICghZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlcihwcm9ncmFtLCBnbC5MSU5LX1NUQVRVUykpIHtcbiAgICAgICAgICAgIHZhciBtc2cgPSBnbC5nZXRQcm9ncmFtSW5mb0xvZyhwcm9ncmFtKTtcbiAgICAgICAgICAgIGdsLmRlbGV0ZVByb2dyYW0ocHJvZ3JhbSk7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcHJvZ3JhbTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOOCt+OCp+ODvOODgOOBriBhdHRyaWJ1dGUg5aSJ5pWwIGFWZXJ0ZXgg44Gr44OQ44OD44OV44Kh44KS55m76Yyy44GZ44KL44CCXG4gICAgICogdXNlKCkvdW51c2UoKSDplpPjga7jgb/jgaflirnmnpzjgYzjgYLjgovjgIJcbiAgICAgKi9cbiAgICBXZWJHTFNoYWRlclByb2dyYW0ucHJvdG90eXBlLnNldF9hVmVydGV4ID0gZnVuY3Rpb24gKGJ1ZmZlcikge1xuICAgICAgICB0aGlzLl9jb250ZXh0LmJpbmRCdWZmZXIodGhpcy5fY29udGV4dC5BUlJBWV9CVUZGRVIsIGJ1ZmZlcik7XG4gICAgICAgIHRoaXMuX2NvbnRleHQuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkodGhpcy5fYVZlcnRleCk7XG4gICAgICAgIHRoaXMuX2NvbnRleHQudmVydGV4QXR0cmliUG9pbnRlcih0aGlzLl9hVmVydGV4LCA0LCB0aGlzLl9jb250ZXh0LkZMT0FULCBmYWxzZSwgMCwgMCk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiDjgrfjgqfjg7zjg4Djga4gdW5pZm9ybSDlpInmlbAgdUNvbG9yIOOBq+WApOOCkuioreWumuOBmeOCi+OAglxuICAgICAqIHVzZSgpL3VudXNlKCkg6ZaT44Gu44G/44Gn5Yq55p6c44GM44GC44KL44CCXG4gICAgICovXG4gICAgV2ViR0xTaGFkZXJQcm9ncmFtLnByb3RvdHlwZS5zZXRfdUNvbG9yID0gZnVuY3Rpb24gKHJnYmEpIHtcbiAgICAgICAgdGhpcy5fY29udGV4dC51bmlmb3JtNGYodGhpcy5fdUNvbG9yLCByZ2JhWzBdLCByZ2JhWzFdLCByZ2JhWzJdLCByZ2JhWzNdKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOOCt+OCp+ODvOODgOOBriB1bmlmb3JtIOWkieaVsCB1QWxwaGEg44Gr5YCk44KS6Kit5a6a44GZ44KL44CCXG4gICAgICogdXNlKCkvdW51c2UoKSDplpPjga7jgb/jgaflirnmnpzjgYzjgYLjgovjgIJcbiAgICAgKi9cbiAgICBXZWJHTFNoYWRlclByb2dyYW0ucHJvdG90eXBlLnNldF91QWxwaGEgPSBmdW5jdGlvbiAoYWxwaGEpIHtcbiAgICAgICAgdGhpcy5fY29udGV4dC51bmlmb3JtMWYodGhpcy5fdUFscGhhLCBhbHBoYSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiDjgrfjgqfjg7zjg4Djga4gdW5pZm9ybSDlpInmlbAgdVNhbXBsZXIg44Gr44OG44Kv44K544OB44Oj44K544OG44O844K455Wq5Y+344KS6Kit5a6a44GZ44KL44CCXG4gICAgICogdXNlKCkvdW51c2UoKSDplpPjga7jgb/jgaflirnmnpzjgYzjgYLjgovjgIJcbiAgICAgKi9cbiAgICBXZWJHTFNoYWRlclByb2dyYW0ucHJvdG90eXBlLnNldF91U2FtcGxlciA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9jb250ZXh0LnVuaWZvcm0xaSh0aGlzLl91U2FtcGxlciwgdmFsdWUpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICog44Om44O844K25a6a576p44GV44KM44GfIHVuaWZvcm0g5YCk44KS5pu05paw44GZ44KL44CCXG4gICAgICogdXNlKCkvdW51c2UoKSDplpPjga7jgb/jgaflirnmnpzjgYzjgYLjgovjgIJcbiAgICAgKi9cbiAgICBXZWJHTFNoYWRlclByb2dyYW0ucHJvdG90eXBlLnVwZGF0ZVVuaWZvcm1zID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3VuaWZvcm1DYWNoZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBjYWNoZSA9IHRoaXMuX3VuaWZvcm1DYWNoZXNbaV07XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLl91bmlmb3Jtc1tjYWNoZS5uYW1lXS52YWx1ZTtcbiAgICAgICAgICAgIGlmICghY2FjaGUuaXNBcnJheSAmJiB2YWx1ZSA9PT0gY2FjaGUuYmVmb3JlVmFsdWUpXG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICBjYWNoZS51cGRhdGUoY2FjaGUubG9jLCB2YWx1ZSk7XG4gICAgICAgICAgICBjYWNoZS5iZWZvcmVWYWx1ZSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiDjg6bjg7zjgrblrprnvqnjgZXjgozjgZ/jgrfjgqfjg7zjg4Djga4gdW5pZm9ybSDlpInmlbDjgpLliJ3mnJ/ljJbjgZnjgovjgIJcbiAgICAgKi9cbiAgICBXZWJHTFNoYWRlclByb2dyYW0ucHJvdG90eXBlLmluaXRpYWxpemVVbmlmb3JtcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIHVuaWZvcm1DYWNoZXMgPSBbXTtcbiAgICAgICAgdmFyIHVuaWZvcm1zID0gdGhpcy5fdW5pZm9ybXM7XG4gICAgICAgIGlmICh1bmlmb3JtcyAhPSBudWxsKSB7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyh1bmlmb3JtcykuZm9yRWFjaChmdW5jdGlvbiAoaykge1xuICAgICAgICAgICAgICAgIHZhciB0eXBlID0gdW5pZm9ybXNba10udHlwZTtcbiAgICAgICAgICAgICAgICB2YXIgaXNBcnJheSA9ICEodHlwZW9mIHVuaWZvcm1zW2tdLnZhbHVlID09PSBcIm51bWJlclwiKTtcbiAgICAgICAgICAgICAgICAvLyB0eXBl44GMZmxvYXTjgb7jgZ/jga9pbnTjgafjgIF2YWx1ZeOBjOmFjeWIl+OBp+OBguOCjOOBsOmFjeWIl+OBqOOBl+OBpnVuaWZvcm3lgKTjgpLou6LpgIHjgZnjgovjgIJcbiAgICAgICAgICAgICAgICBpZiAoaXNBcnJheSAmJiAodHlwZSA9PT0gXCJpbnRcIiB8fCB0eXBlID09PSBcImZsb2F0XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGUgKz0gXCJfdlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlID0gX3RoaXMuX3VuaWZvcm1TZXR0ZXJUYWJsZVt0eXBlXTtcbiAgICAgICAgICAgICAgICBpZiAoIXVwZGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXJ0aW9uRXJyb3IoXCJXZWJHTFNoYWRlclByb2dyYW0jaW5pdGlhbGl6ZVVuaWZvcm1zOiBVbmlmb3JtIHR5cGUgJ1wiICsgdHlwZSArIFwiJyBpcyBub3Qgc3VwcG9ydGVkLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdW5pZm9ybUNhY2hlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogayxcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGUsXG4gICAgICAgICAgICAgICAgICAgIGJlZm9yZVZhbHVlOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBpc0FycmF5OiBpc0FycmF5LFxuICAgICAgICAgICAgICAgICAgICBsb2M6IF90aGlzLl9jb250ZXh0LmdldFVuaWZvcm1Mb2NhdGlvbihfdGhpcy5wcm9ncmFtLCBrKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdW5pZm9ybUNhY2hlcyA9IHVuaWZvcm1DYWNoZXM7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiDjgrfjgqfjg7zjg4DjgpLmnInlirnljJbjgZnjgovjgIJcbiAgICAgKi9cbiAgICBXZWJHTFNoYWRlclByb2dyYW0ucHJvdG90eXBlLnVzZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fY29udGV4dC51c2VQcm9ncmFtKHRoaXMucHJvZ3JhbSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiDjgrfjgqfjg7zjg4DjgpLnhKHlirnljJbjgZnjgovjgIJcbiAgICAgKi9cbiAgICBXZWJHTFNoYWRlclByb2dyYW0ucHJvdG90eXBlLnVudXNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9jb250ZXh0LnVzZVByb2dyYW0obnVsbCk7XG4gICAgfTtcbiAgICBXZWJHTFNoYWRlclByb2dyYW0ucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2NvbnRleHQuZGVsZXRlUHJvZ3JhbSh0aGlzLnByb2dyYW0pO1xuICAgIH07XG4gICAgV2ViR0xTaGFkZXJQcm9ncmFtLnByb3RvdHlwZS5fdW5pZm9ybTFmID0gZnVuY3Rpb24gKGxvYywgdikge1xuICAgICAgICB0aGlzLl9jb250ZXh0LnVuaWZvcm0xZihsb2MsIHYpO1xuICAgIH07XG4gICAgV2ViR0xTaGFkZXJQcm9ncmFtLnByb3RvdHlwZS5fdW5pZm9ybTFpID0gZnVuY3Rpb24gKGxvYywgdikge1xuICAgICAgICB0aGlzLl9jb250ZXh0LnVuaWZvcm0xaShsb2MsIHYpO1xuICAgIH07XG4gICAgV2ViR0xTaGFkZXJQcm9ncmFtLnByb3RvdHlwZS5fdW5pZm9ybTFmdiA9IGZ1bmN0aW9uIChsb2MsIHYpIHtcbiAgICAgICAgdGhpcy5fY29udGV4dC51bmlmb3JtMWZ2KGxvYywgdik7XG4gICAgfTtcbiAgICBXZWJHTFNoYWRlclByb2dyYW0ucHJvdG90eXBlLl91bmlmb3JtMWl2ID0gZnVuY3Rpb24gKGxvYywgdikge1xuICAgICAgICB0aGlzLl9jb250ZXh0LnVuaWZvcm0xaXYobG9jLCB2KTtcbiAgICB9O1xuICAgIFdlYkdMU2hhZGVyUHJvZ3JhbS5wcm90b3R5cGUuX3VuaWZvcm0yZnYgPSBmdW5jdGlvbiAobG9jLCB2KSB7XG4gICAgICAgIHRoaXMuX2NvbnRleHQudW5pZm9ybTJmdihsb2MsIHYpO1xuICAgIH07XG4gICAgV2ViR0xTaGFkZXJQcm9ncmFtLnByb3RvdHlwZS5fdW5pZm9ybTNmdiA9IGZ1bmN0aW9uIChsb2MsIHYpIHtcbiAgICAgICAgdGhpcy5fY29udGV4dC51bmlmb3JtM2Z2KGxvYywgdik7XG4gICAgfTtcbiAgICBXZWJHTFNoYWRlclByb2dyYW0ucHJvdG90eXBlLl91bmlmb3JtNGZ2ID0gZnVuY3Rpb24gKGxvYywgdikge1xuICAgICAgICB0aGlzLl9jb250ZXh0LnVuaWZvcm00ZnYobG9jLCB2KTtcbiAgICB9O1xuICAgIFdlYkdMU2hhZGVyUHJvZ3JhbS5wcm90b3R5cGUuX3VuaWZvcm0yaXYgPSBmdW5jdGlvbiAobG9jLCB2KSB7XG4gICAgICAgIHRoaXMuX2NvbnRleHQudW5pZm9ybTJpdihsb2MsIHYpO1xuICAgIH07XG4gICAgV2ViR0xTaGFkZXJQcm9ncmFtLnByb3RvdHlwZS5fdW5pZm9ybTNpdiA9IGZ1bmN0aW9uIChsb2MsIHYpIHtcbiAgICAgICAgdGhpcy5fY29udGV4dC51bmlmb3JtM2l2KGxvYywgdik7XG4gICAgfTtcbiAgICBXZWJHTFNoYWRlclByb2dyYW0ucHJvdG90eXBlLl91bmlmb3JtNGl2ID0gZnVuY3Rpb24gKGxvYywgdikge1xuICAgICAgICB0aGlzLl9jb250ZXh0LnVuaWZvcm00aXYobG9jLCB2KTtcbiAgICB9O1xuICAgIFdlYkdMU2hhZGVyUHJvZ3JhbS5wcm90b3R5cGUuX3VuaWZvcm1NYXRyaXgyZnYgPSBmdW5jdGlvbiAobG9jLCB2KSB7XG4gICAgICAgIHRoaXMuX2NvbnRleHQudW5pZm9ybU1hdHJpeDJmdihsb2MsIGZhbHNlLCB2KTtcbiAgICB9O1xuICAgIFdlYkdMU2hhZGVyUHJvZ3JhbS5wcm90b3R5cGUuX3VuaWZvcm1NYXRyaXgzZnYgPSBmdW5jdGlvbiAobG9jLCB2KSB7XG4gICAgICAgIHRoaXMuX2NvbnRleHQudW5pZm9ybU1hdHJpeDNmdihsb2MsIGZhbHNlLCB2KTtcbiAgICB9O1xuICAgIFdlYkdMU2hhZGVyUHJvZ3JhbS5wcm90b3R5cGUuX3VuaWZvcm1NYXRyaXg0ZnYgPSBmdW5jdGlvbiAobG9jLCB2KSB7XG4gICAgICAgIHRoaXMuX2NvbnRleHQudW5pZm9ybU1hdHJpeDRmdihsb2MsIGZhbHNlLCB2KTtcbiAgICB9O1xuICAgIFdlYkdMU2hhZGVyUHJvZ3JhbS5fREVGQVVMVF9WRVJURVhfU0hBREVSID0gXCIjdmVyc2lvbiAxMDBcXG5cIiArXG4gICAgICAgIFwicHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7XFxuXCIgK1xuICAgICAgICBcImF0dHJpYnV0ZSB2ZWM0IGFWZXJ0ZXg7XFxuXCIgK1xuICAgICAgICBcInZhcnlpbmcgdmVjMiB2VGV4Q29vcmQ7XFxuXCIgK1xuICAgICAgICBcInZhcnlpbmcgdmVjNCB2Q29sb3I7XFxuXCIgK1xuICAgICAgICBcInVuaWZvcm0gdmVjNCB1Q29sb3I7XFxuXCIgK1xuICAgICAgICBcInVuaWZvcm0gZmxvYXQgdUFscGhhO1xcblwiICtcbiAgICAgICAgXCJ2b2lkIG1haW4oKSB7XCIgK1xuICAgICAgICBcIiAgICBnbF9Qb3NpdGlvbiA9IHZlYzQoYVZlcnRleC54eSwgMC4wLCAxLjApO1wiICtcbiAgICAgICAgXCIgICAgdlRleENvb3JkID0gYVZlcnRleC56dztcIiArXG4gICAgICAgIFwiICAgIHZDb2xvciA9IHVDb2xvciAqIHVBbHBoYTtcIiArXG4gICAgICAgIFwifVwiO1xuICAgIFdlYkdMU2hhZGVyUHJvZ3JhbS5fREVGQVVMVF9GUkFHTUVOVF9TSEFERVIgPSBcIiN2ZXJzaW9uIDEwMFxcblwiICtcbiAgICAgICAgXCJwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDtcXG5cIiArXG4gICAgICAgIFwidmFyeWluZyB2ZWMyIHZUZXhDb29yZDtcXG5cIiArXG4gICAgICAgIFwidmFyeWluZyB2ZWM0IHZDb2xvcjtcXG5cIiArXG4gICAgICAgIFwidW5pZm9ybSBzYW1wbGVyMkQgdVNhbXBsZXI7XFxuXCIgK1xuICAgICAgICBcInZvaWQgbWFpbigpIHtcIiArXG4gICAgICAgIFwiICAgIGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRCh1U2FtcGxlciwgdlRleENvb3JkKSAqIHZDb2xvcjtcIiArXG4gICAgICAgIFwifVwiO1xuICAgIHJldHVybiBXZWJHTFNoYWRlclByb2dyYW07XG59KCkpO1xuZXhwb3J0cy5XZWJHTFNoYWRlclByb2dyYW0gPSBXZWJHTFNoYWRlclByb2dyYW07XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuV2ViR0xTaGFyZWRPYmplY3QgPSB2b2lkIDA7XG52YXIgZyA9IHJlcXVpcmUoXCJAYWthc2hpYy9ha2FzaGljLWVuZ2luZVwiKTtcbnZhciBXZWJHTFNoYWRlclByb2dyYW1fMSA9IHJlcXVpcmUoXCIuL1dlYkdMU2hhZGVyUHJvZ3JhbVwiKTtcbnZhciBXZWJHTFRleHR1cmVBdGxhc18xID0gcmVxdWlyZShcIi4vV2ViR0xUZXh0dXJlQXRsYXNcIik7XG52YXIgV2ViR0xQcmltYXJ5U3VyZmFjZV8xID0gcmVxdWlyZShcIi4vV2ViR0xQcmltYXJ5U3VyZmFjZVwiKTtcbnZhciBXZWJHTEJhY2tTdXJmYWNlXzEgPSByZXF1aXJlKFwiLi9XZWJHTEJhY2tTdXJmYWNlXCIpO1xudmFyIFdlYkdMU2hhcmVkT2JqZWN0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFdlYkdMU2hhcmVkT2JqZWN0KHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgdmFyIHN1cmZhY2UgPSBuZXcgV2ViR0xQcmltYXJ5U3VyZmFjZV8xLldlYkdMUHJpbWFyeVN1cmZhY2UodGhpcywgd2lkdGgsIGhlaWdodCk7XG4gICAgICAgIHZhciBjb250ZXh0ID0gc3VyZmFjZS5jYW52YXMuZ2V0Q29udGV4dChcIndlYmdsXCIsIHsgZGVwdGg6IGZhbHNlLCBwcmVzZXJ2ZURyYXdpbmdCdWZmZXI6IHRydWUgfSk7XG4gICAgICAgIGlmICghY29udGV4dCkge1xuICAgICAgICAgICAgdGhyb3cgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2VydGlvbkVycm9yKFwiV2ViR0xTaGFyZWRPYmplY3QjY29uc3RydWN0b3I6IGNvdWxkIG5vdCBpbml0aWFsaXplIFdlYkdMUmVuZGVyaW5nQ29udGV4dFwiKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zdXJmYWNlID0gc3VyZmFjZTtcbiAgICAgICAgdGhpcy5fY29udGV4dCA9IGNvbnRleHQ7XG4gICAgICAgIHRoaXMuX2luaXQoKTtcbiAgICB9XG4gICAgV2ViR0xTaGFyZWRPYmplY3QucHJvdG90eXBlLmdldEZpbGxSZWN0U3VyZmFjZVRleHR1cmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9maWxsUmVjdFN1cmZhY2VUZXh0dXJlO1xuICAgIH07XG4gICAgV2ViR0xTaGFyZWRPYmplY3QucHJvdG90eXBlLmdldFByaW1hcnlTdXJmYWNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBOT1RFOiDkuIDjgaTjga4gV2ViR0xTaGFyZWRPYmplY3Qg44Gv5LiA44Gk44GuIHByaW1hcnkgc3VyZmFjZSDjga7jgb/jgpLkv53mjIHjgZnjgovjgoLjga7jgajjgZnjgovjgIJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N1cmZhY2U7XG4gICAgfTtcbiAgICBXZWJHTFNoYXJlZE9iamVjdC5wcm90b3R5cGUuY3JlYXRlQmFja1N1cmZhY2UgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCkge1xuICAgICAgICByZXR1cm4gbmV3IFdlYkdMQmFja1N1cmZhY2VfMS5XZWJHTEJhY2tTdXJmYWNlKHRoaXMsIHdpZHRoLCBoZWlnaHQpO1xuICAgIH07XG4gICAgV2ViR0xTaGFyZWRPYmplY3QucHJvdG90eXBlLnB1c2hSZW5kZXJUYXJnZXQgPSBmdW5jdGlvbiAocmVuZGVyVGFyZ2V0KSB7XG4gICAgICAgIHRoaXMuX2NvbW1pdCgpO1xuICAgICAgICB0aGlzLl9yZW5kZXJUYXJnZXRTdGFjay5wdXNoKHJlbmRlclRhcmdldCk7XG4gICAgICAgIHRoaXMuX2NvbnRleHQuYmluZEZyYW1lYnVmZmVyKHRoaXMuX2NvbnRleHQuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldC5mcmFtZWJ1ZmZlcik7XG4gICAgICAgIHRoaXMuX2NvbnRleHQudmlld3BvcnQoMCwgMCwgcmVuZGVyVGFyZ2V0LnZpZXdwb3J0V2lkdGgsIHJlbmRlclRhcmdldC52aWV3cG9ydEhlaWdodCk7XG4gICAgfTtcbiAgICBXZWJHTFNoYXJlZE9iamVjdC5wcm90b3R5cGUucG9wUmVuZGVyVGFyZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9jb21taXQoKTtcbiAgICAgICAgdGhpcy5fcmVuZGVyVGFyZ2V0U3RhY2sucG9wKCk7XG4gICAgICAgIHZhciByZW5kZXJUYXJnZXQgPSB0aGlzLmdldEN1cnJlbnRSZW5kZXJUYXJnZXQoKTtcbiAgICAgICAgdGhpcy5fY29udGV4dC5iaW5kRnJhbWVidWZmZXIodGhpcy5fY29udGV4dC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0LmZyYW1lYnVmZmVyKTtcbiAgICAgICAgdGhpcy5fY29udGV4dC52aWV3cG9ydCgwLCAwLCByZW5kZXJUYXJnZXQudmlld3BvcnRXaWR0aCwgcmVuZGVyVGFyZ2V0LnZpZXdwb3J0SGVpZ2h0KTtcbiAgICB9O1xuICAgIFdlYkdMU2hhcmVkT2JqZWN0LnByb3RvdHlwZS5nZXRDdXJyZW50UmVuZGVyVGFyZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyVGFyZ2V0U3RhY2tbdGhpcy5fcmVuZGVyVGFyZ2V0U3RhY2subGVuZ3RoIC0gMV07XG4gICAgfTtcbiAgICBXZWJHTFNoYXJlZE9iamVjdC5wcm90b3R5cGUuYmVnaW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICAgICAgdGhpcy5fY3VycmVudFNoYWRlclByb2dyYW0udXNlKCk7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRTaGFkZXJQcm9ncmFtLnNldF9hVmVydGV4KHRoaXMuX3ZlcnRpY2VzKTtcbiAgICAgICAgdGhpcy5fY3VycmVudFNoYWRlclByb2dyYW0uc2V0X3VDb2xvcih0aGlzLl9jdXJyZW50Q29sb3IpO1xuICAgICAgICB0aGlzLl9jdXJyZW50U2hhZGVyUHJvZ3JhbS5zZXRfdUFscGhhKHRoaXMuX2N1cnJlbnRBbHBoYSk7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRTaGFkZXJQcm9ncmFtLnNldF91U2FtcGxlcigwKTtcbiAgICAgICAgdGhpcy5fY3VycmVudFNoYWRlclByb2dyYW0udXBkYXRlVW5pZm9ybXMoKTtcbiAgICB9O1xuICAgIFdlYkdMU2hhcmVkT2JqZWN0LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fY29udGV4dC5jbGVhcih0aGlzLl9jb250ZXh0LkNPTE9SX0JVRkZFUl9CSVQpO1xuICAgIH07XG4gICAgV2ViR0xTaGFyZWRPYmplY3QucHJvdG90eXBlLmRyYXcgPSBmdW5jdGlvbiAoc3RhdGUsIHN1cmZhY2VUZXh0dXJlLCBvZmZzZXRYLCBvZmZzZXRZLCB3aWR0aCwgaGVpZ2h0LCBjYW52YXNPZmZzZXRYLCBjYW52YXNPZmZzZXRZLCBjb2xvcikge1xuICAgICAgICBpZiAodGhpcy5fbnVtU3ByaXRlcyA+PSB0aGlzLl9tYXhTcHJpdGVDb3VudCkge1xuICAgICAgICAgICAgdGhpcy5fY29tbWl0KCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHNoYWRlclByb2dyYW07XG4gICAgICAgIC8vIGZpbGxSZWN044Gu5aC05ZCI44Gv44OH44OV44Kp44Or44OI44Gu44K344Kn44O844OA44KS5Yip55SoXG4gICAgICAgIGlmIChzdXJmYWNlVGV4dHVyZSA9PT0gdGhpcy5fZmlsbFJlY3RTdXJmYWNlVGV4dHVyZSB8fCBzdGF0ZS5zaGFkZXJQcm9ncmFtID09IG51bGwgfHwgc3RhdGUuc2hhZGVyUHJvZ3JhbS5fcHJvZ3JhbSA9PSBudWxsKSB7XG4gICAgICAgICAgICBzaGFkZXJQcm9ncmFtID0gdGhpcy5fZGVmYXVsdFNoYWRlclByb2dyYW07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzaGFkZXJQcm9ncmFtID0gc3RhdGUuc2hhZGVyUHJvZ3JhbS5fcHJvZ3JhbTtcbiAgICAgICAgfVxuICAgICAgICAvLyDjgrfjgqfjg7zjg4Djg5fjg63jgrDjg6njg6DjgpLoqK3lrppcbiAgICAgICAgaWYgKHRoaXMuX2N1cnJlbnRTaGFkZXJQcm9ncmFtICE9PSBzaGFkZXJQcm9ncmFtKSB7XG4gICAgICAgICAgICB0aGlzLl9jb21taXQoKTtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRTaGFkZXJQcm9ncmFtID0gc2hhZGVyUHJvZ3JhbTtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRTaGFkZXJQcm9ncmFtLnVzZSgpO1xuICAgICAgICAgICAgdGhpcy5fY3VycmVudFNoYWRlclByb2dyYW0udXBkYXRlVW5pZm9ybXMoKTtcbiAgICAgICAgICAgIC8vIOOCt+OCp+ODvOODgOODl+ODreOCsOODqeODoOWkieabtOaZguOBr+WFqOOBpuOBruioreWumuOCkuOCr+ODquOColxuICAgICAgICAgICAgdGhpcy5fY3VycmVudENvbXBvc2l0ZU9wZXJhdGlvbiA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50QWxwaGEgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5fY3VycmVudENvbG9yID0gW107XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50VGV4dHVyZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgLy8g44OG44Kv44K544OB44Oj44KS6Kit5a6aXG4gICAgICAgIGlmICh0aGlzLl9jdXJyZW50VGV4dHVyZSAhPT0gc3VyZmFjZVRleHR1cmUudGV4dHVyZSkge1xuICAgICAgICAgICAgdGhpcy5fY3VycmVudFRleHR1cmUgPSBzdXJmYWNlVGV4dHVyZS50ZXh0dXJlO1xuICAgICAgICAgICAgdGhpcy5fY29tbWl0KCk7XG4gICAgICAgICAgICB0aGlzLl9jb250ZXh0LmJpbmRUZXh0dXJlKHRoaXMuX2NvbnRleHQuVEVYVFVSRV8yRCwgc3VyZmFjZVRleHR1cmUudGV4dHVyZSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8g6Imy44KS6Kit5a6aXG4gICAgICAgIGlmICh0aGlzLl9jdXJyZW50Q29sb3JbMF0gIT09IGNvbG9yWzBdIHx8XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50Q29sb3JbMV0gIT09IGNvbG9yWzFdIHx8XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50Q29sb3JbMl0gIT09IGNvbG9yWzJdIHx8XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50Q29sb3JbM10gIT09IGNvbG9yWzNdKSB7XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50Q29sb3IgPSBjb2xvcjtcbiAgICAgICAgICAgIHRoaXMuX2NvbW1pdCgpO1xuICAgICAgICAgICAgdGhpcy5fY3VycmVudFNoYWRlclByb2dyYW0uc2V0X3VDb2xvcihjb2xvcik7XG4gICAgICAgIH1cbiAgICAgICAgLy8g44Ki44Or44OV44Kh44KS5oyH5a6aXG4gICAgICAgIGlmICh0aGlzLl9jdXJyZW50QWxwaGEgIT09IHN0YXRlLmdsb2JhbEFscGhhKSB7XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50QWxwaGEgPSBzdGF0ZS5nbG9iYWxBbHBoYTtcbiAgICAgICAgICAgIHRoaXMuX2NvbW1pdCgpO1xuICAgICAgICAgICAgdGhpcy5fY3VycmVudFNoYWRlclByb2dyYW0uc2V0X3VBbHBoYShzdGF0ZS5nbG9iYWxBbHBoYSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8g5ZCI5oiQ44Oi44O844OJ44KS6Kit5a6aXG4gICAgICAgIGlmICh0aGlzLl9jdXJyZW50Q29tcG9zaXRlT3BlcmF0aW9uICE9PSBzdGF0ZS5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRDb21wb3NpdGVPcGVyYXRpb24gPSBzdGF0ZS5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb247XG4gICAgICAgICAgICB0aGlzLl9jb21taXQoKTtcbiAgICAgICAgICAgIHZhciBjb21wb3NpdGVPcGVyYXRpb24gPSB0aGlzLl9jb21wb3NpdGVPcHNbdGhpcy5fY3VycmVudENvbXBvc2l0ZU9wZXJhdGlvbl07XG4gICAgICAgICAgICB0aGlzLl9jb250ZXh0LmJsZW5kRnVuYyhjb21wb3NpdGVPcGVyYXRpb25bMF0sIGNvbXBvc2l0ZU9wZXJhdGlvblsxXSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHR3ID0gMS4wIC8gc3VyZmFjZVRleHR1cmUudGV4dHVyZVdpZHRoO1xuICAgICAgICB2YXIgdGggPSAxLjAgLyBzdXJmYWNlVGV4dHVyZS50ZXh0dXJlSGVpZ2h0O1xuICAgICAgICB2YXIgb3ggPSBzdXJmYWNlVGV4dHVyZS50ZXh0dXJlT2Zmc2V0WDtcbiAgICAgICAgdmFyIG95ID0gc3VyZmFjZVRleHR1cmUudGV4dHVyZU9mZnNldFk7XG4gICAgICAgIHZhciBzID0gdHcgKiAob3ggKyBvZmZzZXRYICsgd2lkdGgpO1xuICAgICAgICB2YXIgdCA9IHRoICogKG95ICsgb2Zmc2V0WSArIGhlaWdodCk7XG4gICAgICAgIHZhciB1ID0gdHcgKiAob3ggKyBvZmZzZXRYKTtcbiAgICAgICAgdmFyIHYgPSB0aCAqIChveSArIG9mZnNldFkpO1xuICAgICAgICAvLyDlpInmj5vooYzliJfjgpLoqK3lrppcbiAgICAgICAgdGhpcy5fcmVnaXN0ZXIodGhpcy5fdHJhbnNmb3JtVmVydGV4KGNhbnZhc09mZnNldFgsIGNhbnZhc09mZnNldFksIHdpZHRoLCBoZWlnaHQsIHN0YXRlLnRyYW5zZm9ybWVyKSwgW3UsIHYsIHMsIHYsIHMsIHQsIHUsIHYsIHMsIHQsIHUsIHRdKTtcbiAgICB9O1xuICAgIFdlYkdMU2hhcmVkT2JqZWN0LnByb3RvdHlwZS5lbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2NvbW1pdCgpO1xuICAgICAgICBpZiAodGhpcy5fZGVsZXRlUmVxdWVzdGVkVGFyZ2V0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX2RlbGV0ZVJlcXVlc3RlZFRhcmdldHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRlbGV0ZVJlbmRlclRhcmdldCh0aGlzLl9kZWxldGVSZXF1ZXN0ZWRUYXJnZXRzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2RlbGV0ZVJlcXVlc3RlZFRhcmdldHMgPSBbXTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgV2ViR0xTaGFyZWRPYmplY3QucHJvdG90eXBlLm1ha2VUZXh0dXJlRm9yU3VyZmFjZSA9IGZ1bmN0aW9uIChzdXJmYWNlKSB7XG4gICAgICAgIHRoaXMuX3RleHR1cmVBdGxhcy5tYWtlVGV4dHVyZUZvclN1cmZhY2UodGhpcywgc3VyZmFjZSk7XG4gICAgfTtcbiAgICBXZWJHTFNoYXJlZE9iamVjdC5wcm90b3R5cGUuZGlzcG9zZVRleHR1cmUgPSBmdW5jdGlvbiAodGV4dHVyZSkge1xuICAgICAgICBpZiAodGhpcy5fY3VycmVudFRleHR1cmUgPT09IHRleHR1cmUpIHtcbiAgICAgICAgICAgIHRoaXMuX2NvbW1pdCgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBpbWFnZSDjgpIgR1BVIOS4iuOBruODhuOCr+OCueODgeODo+ODoeODouODqumgmOWfn+OBq+OCs+ODlOODvOOBmeOCiy5cbiAgICAgKi9cbiAgICBXZWJHTFNoYXJlZE9iamVjdC5wcm90b3R5cGUuYXNzaWduVGV4dHVyZSA9IGZ1bmN0aW9uIChpbWFnZSwgeCwgeSwgdGV4dHVyZSkge1xuICAgICAgICB0aGlzLl9jb250ZXh0LmJpbmRUZXh0dXJlKHRoaXMuX2NvbnRleHQuVEVYVFVSRV8yRCwgdGV4dHVyZSk7XG4gICAgICAgIGlmIChpbWFnZSBpbnN0YW5jZW9mIEhUTUxWaWRlb0VsZW1lbnQpIHtcbiAgICAgICAgICAgIHRocm93IGcuRXhjZXB0aW9uRmFjdG9yeS5jcmVhdGVBc3NlcnRpb25FcnJvcihcIldlYkdMUmVuZGVyZXIjYXNzaWduVGV4dHVyZTogSFRNTFZpZGVvRWxlbWVudCBpcyBub3Qgc3VwcG9ydGVkLlwiKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jb250ZXh0LnRleFN1YkltYWdlMkQodGhpcy5fY29udGV4dC5URVhUVVJFXzJELCAwLCB4LCB5LCB0aGlzLl9jb250ZXh0LlJHQkEsIHRoaXMuX2NvbnRleHQuVU5TSUdORURfQllURSwgaW1hZ2UpO1xuICAgICAgICB0aGlzLl9jb250ZXh0LmJpbmRUZXh0dXJlKHRoaXMuX2NvbnRleHQuVEVYVFVSRV8yRCwgdGhpcy5fY3VycmVudFRleHR1cmUpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogR1BVIOS4iuOBruODhuOCr+OCueODgeODo+ODoeODouODqumgmOWfn+OCkiB0ZXh0dXJlUGl4ZWxzIOOBp+OCr+ODquOCouOBmeOCiy5cbiAgICAgKlxuICAgICAqIE5PVEU6IOacrOadpeOBr0dQVeODh+ODkOOCpOOCueS4iuOBp+mgmOWfn+OCkuOCr+ODquOCouOBmeOCi+OBk+OBqOOBjOacm+OBvuOBl+OBj+OAgeODm+OCueODiOOBi+OCiemDveW6pumgmOWfn+OCkui7oumAgeOBmeOCiyB0ZXhTdWJJbWFnZTJEKCkg44Gv6YGp5b2T44Gn44Gq44GE44CCXG4gICAgICogRkJP44KSVGV4dHVyZeOBq+ODkOOCpOODs+ODieOBleOBm+OCi+aWueW8j+OBquOBqeOCkuiAg+aFruOBmeOBueOBjeOBp+OBguOCi+OAglxuICAgICAqIOOBn+OBoOOBl+OAgeS7peS4i+OBrjLngrnjgojjgormnKzmk43kvZzjga7mnIDpganljJbjgpLopovpgIHjgaPjgabjgYTjgovjgIJcbiAgICAgKiAtIOWHpueQhumAn+W6puS4iuacgOiJr+OBruOCseODvOOCueOBr+acrOaTjeS9nOOBruWRvOOBs+WHuuOBl+OCkuihjOOCj+OBquOBhOOBk+OBqOOBp+OBguOCi1xuICAgICAqIC0g5pys5pON5L2c44Gu5ZG844Gz5Ye644GX6aC75bqm44GMV2ViR0xUZXh0dXJlQXRsYXMjVEVYVFVSRV9TSVpF44KEV2ViR0xUZXh0dXJlQXRsYXMjVEVYVFVSRV9DT1VOVOOBruWApOOBq+S+neWtmOOBmeOCi+OBn+OCgeOAgVxuICAgICAqICAg44Gd44Gh44KJ44KS44OB44Ol44O844OL44Oz44Kw44GZ44KL5pa544GM5YSq5YWI5bqm44GM6auY44GEXG4gICAgICovXG4gICAgV2ViR0xTaGFyZWRPYmplY3QucHJvdG90eXBlLmNsZWFyVGV4dHVyZSA9IGZ1bmN0aW9uICh0ZXh0dXJlUGl4ZWxzLCB3aWR0aCwgaGVpZ2h0LCB0ZXh0dXJlKSB7XG4gICAgICAgIHRoaXMuX2NvbnRleHQuYmluZFRleHR1cmUodGhpcy5fY29udGV4dC5URVhUVVJFXzJELCB0ZXh0dXJlKTtcbiAgICAgICAgdGhpcy5fY29udGV4dC50ZXhTdWJJbWFnZTJEKHRoaXMuX2NvbnRleHQuVEVYVFVSRV8yRCwgMCwgMCwgMCwgd2lkdGgsIGhlaWdodCwgdGhpcy5fY29udGV4dC5SR0JBLCB0aGlzLl9jb250ZXh0LlVOU0lHTkVEX0JZVEUsIHRleHR1cmVQaXhlbHMpO1xuICAgICAgICB0aGlzLl9jb250ZXh0LmJpbmRUZXh0dXJlKHRoaXMuX2NvbnRleHQuVEVYVFVSRV8yRCwgdGhpcy5fY3VycmVudFRleHR1cmUpO1xuICAgIH07XG4gICAgV2ViR0xTaGFyZWRPYmplY3QucHJvdG90eXBlLm1ha2VUZXh0dXJlUmF3ID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQsIHBpeGVscykge1xuICAgICAgICBpZiAocGl4ZWxzID09PSB2b2lkIDApIHsgcGl4ZWxzID0gbnVsbDsgfVxuICAgICAgICB2YXIgdGV4dHVyZSA9IHRoaXMuX2NvbnRleHQuY3JlYXRlVGV4dHVyZSgpO1xuICAgICAgICB0aGlzLl9jb250ZXh0LmJpbmRUZXh0dXJlKHRoaXMuX2NvbnRleHQuVEVYVFVSRV8yRCwgdGV4dHVyZSk7XG4gICAgICAgIHRoaXMuX2NvbnRleHQucGl4ZWxTdG9yZWkodGhpcy5fY29udGV4dC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIDEpO1xuICAgICAgICB0aGlzLl9jb250ZXh0LnRleFBhcmFtZXRlcmkodGhpcy5fY29udGV4dC5URVhUVVJFXzJELCB0aGlzLl9jb250ZXh0LlRFWFRVUkVfV1JBUF9TLCB0aGlzLl9jb250ZXh0LkNMQU1QX1RPX0VER0UpO1xuICAgICAgICB0aGlzLl9jb250ZXh0LnRleFBhcmFtZXRlcmkodGhpcy5fY29udGV4dC5URVhUVVJFXzJELCB0aGlzLl9jb250ZXh0LlRFWFRVUkVfV1JBUF9ULCB0aGlzLl9jb250ZXh0LkNMQU1QX1RPX0VER0UpO1xuICAgICAgICB0aGlzLl9jb250ZXh0LnRleFBhcmFtZXRlcmkodGhpcy5fY29udGV4dC5URVhUVVJFXzJELCB0aGlzLl9jb250ZXh0LlRFWFRVUkVfTUFHX0ZJTFRFUiwgdGhpcy5fY29udGV4dC5ORUFSRVNUKTtcbiAgICAgICAgdGhpcy5fY29udGV4dC50ZXhQYXJhbWV0ZXJpKHRoaXMuX2NvbnRleHQuVEVYVFVSRV8yRCwgdGhpcy5fY29udGV4dC5URVhUVVJFX01JTl9GSUxURVIsIHRoaXMuX2NvbnRleHQuTkVBUkVTVCk7XG4gICAgICAgIHRoaXMuX2NvbnRleHQudGV4SW1hZ2UyRCh0aGlzLl9jb250ZXh0LlRFWFRVUkVfMkQsIDAsIHRoaXMuX2NvbnRleHQuUkdCQSwgd2lkdGgsIGhlaWdodCwgMCwgdGhpcy5fY29udGV4dC5SR0JBLCB0aGlzLl9jb250ZXh0LlVOU0lHTkVEX0JZVEUsIHBpeGVscyk7XG4gICAgICAgIHRoaXMuX2NvbnRleHQuYmluZFRleHR1cmUodGhpcy5fY29udGV4dC5URVhUVVJFXzJELCB0aGlzLl9jdXJyZW50VGV4dHVyZSk7XG4gICAgICAgIHJldHVybiB0ZXh0dXJlO1xuICAgIH07XG4gICAgV2ViR0xTaGFyZWRPYmplY3QucHJvdG90eXBlLm1ha2VUZXh0dXJlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgdmFyIHRleHR1cmUgPSB0aGlzLl9jb250ZXh0LmNyZWF0ZVRleHR1cmUoKTtcbiAgICAgICAgdGhpcy5fY29udGV4dC5iaW5kVGV4dHVyZSh0aGlzLl9jb250ZXh0LlRFWFRVUkVfMkQsIHRleHR1cmUpO1xuICAgICAgICB0aGlzLl9jb250ZXh0LnBpeGVsU3RvcmVpKHRoaXMuX2NvbnRleHQuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCAxKTtcbiAgICAgICAgdGhpcy5fY29udGV4dC50ZXhQYXJhbWV0ZXJpKHRoaXMuX2NvbnRleHQuVEVYVFVSRV8yRCwgdGhpcy5fY29udGV4dC5URVhUVVJFX1dSQVBfUywgdGhpcy5fY29udGV4dC5DTEFNUF9UT19FREdFKTtcbiAgICAgICAgdGhpcy5fY29udGV4dC50ZXhQYXJhbWV0ZXJpKHRoaXMuX2NvbnRleHQuVEVYVFVSRV8yRCwgdGhpcy5fY29udGV4dC5URVhUVVJFX1dSQVBfVCwgdGhpcy5fY29udGV4dC5DTEFNUF9UT19FREdFKTtcbiAgICAgICAgdGhpcy5fY29udGV4dC50ZXhQYXJhbWV0ZXJpKHRoaXMuX2NvbnRleHQuVEVYVFVSRV8yRCwgdGhpcy5fY29udGV4dC5URVhUVVJFX01BR19GSUxURVIsIHRoaXMuX2NvbnRleHQuTkVBUkVTVCk7XG4gICAgICAgIHRoaXMuX2NvbnRleHQudGV4UGFyYW1ldGVyaSh0aGlzLl9jb250ZXh0LlRFWFRVUkVfMkQsIHRoaXMuX2NvbnRleHQuVEVYVFVSRV9NSU5fRklMVEVSLCB0aGlzLl9jb250ZXh0Lk5FQVJFU1QpO1xuICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuX2NvbnRleHQudGV4SW1hZ2UyRCh0aGlzLl9jb250ZXh0LlRFWFRVUkVfMkQsIDAsIHRoaXMuX2NvbnRleHQuUkdCQSwgdGhpcy5fY29udGV4dC5SR0JBLCB0aGlzLl9jb250ZXh0LlVOU0lHTkVEX0JZVEUsIGRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGRhdGEgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5fY29udGV4dC50ZXhJbWFnZTJEKHRoaXMuX2NvbnRleHQuVEVYVFVSRV8yRCwgMCwgdGhpcy5fY29udGV4dC5SR0JBLCB0aGlzLl9jb250ZXh0LlJHQkEsIHRoaXMuX2NvbnRleHQuVU5TSUdORURfQllURSwgZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZGF0YSBpbnN0YW5jZW9mIEltYWdlRGF0YSkge1xuICAgICAgICAgICAgdGhpcy5fY29udGV4dC50ZXhJbWFnZTJEKHRoaXMuX2NvbnRleHQuVEVYVFVSRV8yRCwgMCwgdGhpcy5fY29udGV4dC5SR0JBLCB0aGlzLl9jb250ZXh0LlJHQkEsIHRoaXMuX2NvbnRleHQuVU5TSUdORURfQllURSwgZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY29udGV4dC5iaW5kVGV4dHVyZSh0aGlzLl9jb250ZXh0LlRFWFRVUkVfMkQsIHRoaXMuX2N1cnJlbnRUZXh0dXJlKTtcbiAgICAgICAgcmV0dXJuIHRleHR1cmU7XG4gICAgfTtcbiAgICBXZWJHTFNoYXJlZE9iamVjdC5wcm90b3R5cGUuZ2V0UHJpbWFyeVJlbmRlclRhcmdldCA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJUYXJnZXQ7XG4gICAgfTtcbiAgICBXZWJHTFNoYXJlZE9iamVjdC5wcm90b3R5cGUuY3JlYXRlUmVuZGVyVGFyZ2V0ID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLl9jb250ZXh0O1xuICAgICAgICB2YXIgZnJhbWVidWZmZXIgPSBjb250ZXh0LmNyZWF0ZUZyYW1lYnVmZmVyKCk7XG4gICAgICAgIGNvbnRleHQuYmluZEZyYW1lYnVmZmVyKGNvbnRleHQuRlJBTUVCVUZGRVIsIGZyYW1lYnVmZmVyKTtcbiAgICAgICAgdmFyIHRleHR1cmUgPSBjb250ZXh0LmNyZWF0ZVRleHR1cmUoKTtcbiAgICAgICAgY29udGV4dC5iaW5kVGV4dHVyZShjb250ZXh0LlRFWFRVUkVfMkQsIHRleHR1cmUpO1xuICAgICAgICBjb250ZXh0LnRleFBhcmFtZXRlcmkoY29udGV4dC5URVhUVVJFXzJELCBjb250ZXh0LlRFWFRVUkVfTUFHX0ZJTFRFUiwgY29udGV4dC5MSU5FQVIpO1xuICAgICAgICBjb250ZXh0LnRleFBhcmFtZXRlcmkoY29udGV4dC5URVhUVVJFXzJELCBjb250ZXh0LlRFWFRVUkVfTUlOX0ZJTFRFUiwgY29udGV4dC5MSU5FQVIpO1xuICAgICAgICBjb250ZXh0LnRleFBhcmFtZXRlcmkoY29udGV4dC5URVhUVVJFXzJELCBjb250ZXh0LlRFWFRVUkVfV1JBUF9TLCBjb250ZXh0LkNMQU1QX1RPX0VER0UpO1xuICAgICAgICBjb250ZXh0LnRleFBhcmFtZXRlcmkoY29udGV4dC5URVhUVVJFXzJELCBjb250ZXh0LlRFWFRVUkVfV1JBUF9ULCBjb250ZXh0LkNMQU1QX1RPX0VER0UpO1xuICAgICAgICBjb250ZXh0LnRleEltYWdlMkQoY29udGV4dC5URVhUVVJFXzJELCAwLCBjb250ZXh0LlJHQkEsIHdpZHRoLCBoZWlnaHQsIDAsIGNvbnRleHQuUkdCQSwgY29udGV4dC5VTlNJR05FRF9CWVRFLCBudWxsKTtcbiAgICAgICAgY29udGV4dC5mcmFtZWJ1ZmZlclRleHR1cmUyRChjb250ZXh0LkZSQU1FQlVGRkVSLCBjb250ZXh0LkNPTE9SX0FUVEFDSE1FTlQwLCBjb250ZXh0LlRFWFRVUkVfMkQsIHRleHR1cmUsIDApO1xuICAgICAgICBjb250ZXh0LmJpbmRUZXh0dXJlKGNvbnRleHQuVEVYVFVSRV8yRCwgdGhpcy5fY3VycmVudFRleHR1cmUpO1xuICAgICAgICB2YXIgcmVuZGVyVGFnZXQgPSB0aGlzLmdldEN1cnJlbnRSZW5kZXJUYXJnZXQoKTtcbiAgICAgICAgY29udGV4dC5iaW5kRnJhbWVidWZmZXIoY29udGV4dC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFnZXQuZnJhbWVidWZmZXIpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgICAgICB2aWV3cG9ydFdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgIHZpZXdwb3J0SGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgICAgICBmcmFtZWJ1ZmZlcjogZnJhbWVidWZmZXIsXG4gICAgICAgICAgICB0ZXh0dXJlOiB0ZXh0dXJlXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBXZWJHTFNoYXJlZE9iamVjdC5wcm90b3R5cGUucmVxdWVzdERlbGV0ZVJlbmRlclRhcmdldCA9IGZ1bmN0aW9uIChyZW5kZXJUYWdldCkge1xuICAgICAgICB0aGlzLl9kZWxldGVSZXF1ZXN0ZWRUYXJnZXRzLnB1c2gocmVuZGVyVGFnZXQpO1xuICAgIH07XG4gICAgV2ViR0xTaGFyZWRPYmplY3QucHJvdG90eXBlLmRlbGV0ZVJlbmRlclRhcmdldCA9IGZ1bmN0aW9uIChyZW5kZXJUYWdldCkge1xuICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMuX2NvbnRleHQ7XG4gICAgICAgIGlmICh0aGlzLmdldEN1cnJlbnRSZW5kZXJUYXJnZXQoKSA9PT0gcmVuZGVyVGFnZXQpIHtcbiAgICAgICAgICAgIHRoaXMuX2NvbW1pdCgpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRleHQuZGVsZXRlRnJhbWVidWZmZXIocmVuZGVyVGFnZXQuZnJhbWVidWZmZXIpO1xuICAgICAgICBjb250ZXh0LmRlbGV0ZVRleHR1cmUocmVuZGVyVGFnZXQudGV4dHVyZSk7XG4gICAgfTtcbiAgICBXZWJHTFNoYXJlZE9iamVjdC5wcm90b3R5cGUuZ2V0Q29udGV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRleHQ7XG4gICAgfTtcbiAgICBXZWJHTFNoYXJlZE9iamVjdC5wcm90b3R5cGUuZ2V0RGVmYXVsdFNoYWRlclByb2dyYW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0U2hhZGVyUHJvZ3JhbTtcbiAgICB9O1xuICAgIFdlYkdMU2hhcmVkT2JqZWN0LnByb3RvdHlwZS5pbml0aWFsaXplU2hhZGVyUHJvZ3JhbSA9IGZ1bmN0aW9uIChzaGFkZXJQcm9ncmFtKSB7XG4gICAgICAgIGlmIChzaGFkZXJQcm9ncmFtKSB7XG4gICAgICAgICAgICBpZiAoIXNoYWRlclByb2dyYW0uX3Byb2dyYW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvZ3JhbSA9IG5ldyBXZWJHTFNoYWRlclByb2dyYW1fMS5XZWJHTFNoYWRlclByb2dyYW0odGhpcy5fY29udGV4dCwgc2hhZGVyUHJvZ3JhbS5mcmFnbWVudFNoYWRlciwgc2hhZGVyUHJvZ3JhbS51bmlmb3Jtcyk7XG4gICAgICAgICAgICAgICAgcHJvZ3JhbS5pbml0aWFsaXplVW5pZm9ybXMoKTtcbiAgICAgICAgICAgICAgICBzaGFkZXJQcm9ncmFtLl9wcm9ncmFtID0gcHJvZ3JhbTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2hhZGVyUHJvZ3JhbTtcbiAgICB9O1xuICAgIFdlYkdMU2hhcmVkT2JqZWN0LnByb3RvdHlwZS5faW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICB2YXIgcHJvZ3JhbSA9IG5ldyBXZWJHTFNoYWRlclByb2dyYW1fMS5XZWJHTFNoYWRlclByb2dyYW0odGhpcy5fY29udGV4dCk7XG4gICAgICAgIC8vIOaPj+eUu+eUqOODquOCveODvOOCuVxuICAgICAgICB0aGlzLl90ZXh0dXJlQXRsYXMgPSBuZXcgV2ViR0xUZXh0dXJlQXRsYXNfMS5XZWJHTFRleHR1cmVBdGxhcygpO1xuICAgICAgICB0aGlzLl9maWxsUmVjdFRleHR1cmUgPSB0aGlzLm1ha2VUZXh0dXJlUmF3KDEsIDEsIG5ldyBVaW50OEFycmF5KFsyNTUsIDI1NSwgMjU1LCAyNTVdKSk7XG4gICAgICAgIHRoaXMuX2ZpbGxSZWN0U3VyZmFjZVRleHR1cmUgPSB7XG4gICAgICAgICAgICB0ZXh0dXJlOiB0aGlzLl9maWxsUmVjdFRleHR1cmUsXG4gICAgICAgICAgICB0ZXh0dXJlV2lkdGg6IDEsXG4gICAgICAgICAgICB0ZXh0dXJlSGVpZ2h0OiAxLFxuICAgICAgICAgICAgdGV4dHVyZU9mZnNldFg6IDAsXG4gICAgICAgICAgICB0ZXh0dXJlT2Zmc2V0WTogMFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9yZW5kZXJUYXJnZXQgPSB7XG4gICAgICAgICAgICB3aWR0aDogdGhpcy5fc3VyZmFjZS53aWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogdGhpcy5fc3VyZmFjZS5oZWlnaHQsXG4gICAgICAgICAgICB2aWV3cG9ydFdpZHRoOiB0aGlzLl9zdXJmYWNlLndpZHRoLFxuICAgICAgICAgICAgdmlld3BvcnRIZWlnaHQ6IHRoaXMuX3N1cmZhY2UuaGVpZ2h0LFxuICAgICAgICAgICAgZnJhbWVidWZmZXI6IG51bGwsXG4gICAgICAgICAgICB0ZXh0dXJlOiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIC8vIOaPj+eUu+WRveS7pOOCkuOBn+OCgei+vOOCk+OBp+OBiuOBj+ODkOODg+ODleOCoVxuICAgICAgICB0aGlzLl9tYXhTcHJpdGVDb3VudCA9IDEwMjQ7XG4gICAgICAgIHRoaXMuX3ZlcnRpY2VzID0gdGhpcy5fbWFrZUJ1ZmZlcih0aGlzLl9tYXhTcHJpdGVDb3VudCAqIDI0ICogNCk7XG4gICAgICAgIHRoaXMuX3ZlcnRpY2VzQ2FjaGUgPSBuZXcgRmxvYXQzMkFycmF5KHRoaXMuX21heFNwcml0ZUNvdW50ICogMjQpO1xuICAgICAgICB0aGlzLl9udW1TcHJpdGVzID0gMDsgLy8gdGhlIG51bWJlciBvZiBzcHJpdGVzXG4gICAgICAgIHRoaXMuX2N1cnJlbnRUZXh0dXJlID0gbnVsbDtcbiAgICAgICAgdGhpcy5fY3VycmVudENvbG9yID0gWzEuMCwgMS4wLCAxLjAsIDEuMF07XG4gICAgICAgIHRoaXMuX2N1cnJlbnRBbHBoYSA9IDEuMDtcbiAgICAgICAgdGhpcy5fY3VycmVudENvbXBvc2l0ZU9wZXJhdGlvbiA9IGcuQ29tcG9zaXRlT3BlcmF0aW9uLlNvdXJjZU92ZXI7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRTaGFkZXJQcm9ncmFtID0gcHJvZ3JhbTtcbiAgICAgICAgdGhpcy5fZGVmYXVsdFNoYWRlclByb2dyYW0gPSBwcm9ncmFtO1xuICAgICAgICB0aGlzLl9yZW5kZXJUYXJnZXRTdGFjayA9IFtdO1xuICAgICAgICB0aGlzLl9kZWxldGVSZXF1ZXN0ZWRUYXJnZXRzID0gW107XG4gICAgICAgIC8vIOOCt+OCp+ODvOODgOOBruioreWumlxuICAgICAgICB0aGlzLl9jdXJyZW50U2hhZGVyUHJvZ3JhbS51c2UoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRTaGFkZXJQcm9ncmFtLnNldF9hVmVydGV4KHRoaXMuX3ZlcnRpY2VzKTtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRTaGFkZXJQcm9ncmFtLnNldF91Q29sb3IodGhpcy5fY3VycmVudENvbG9yKTtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRTaGFkZXJQcm9ncmFtLnNldF91QWxwaGEodGhpcy5fY3VycmVudEFscGhhKTtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRTaGFkZXJQcm9ncmFtLnNldF91U2FtcGxlcigwKTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRTaGFkZXJQcm9ncmFtLnVudXNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2ViR0wg44Gu44OR44Op44Oh44O844K/44KS6Kit5a6aXG4gICAgICAgIHRoaXMuX2NvbnRleHQuZW5hYmxlKHRoaXMuX2NvbnRleHQuQkxFTkQpO1xuICAgICAgICB0aGlzLl9jb250ZXh0LmFjdGl2ZVRleHR1cmUodGhpcy5fY29udGV4dC5URVhUVVJFMCk7XG4gICAgICAgIHRoaXMuX2NvbnRleHQuYmluZFRleHR1cmUodGhpcy5fY29udGV4dC5URVhUVVJFXzJELCB0aGlzLl9maWxsUmVjdFRleHR1cmUpO1xuICAgICAgICB0aGlzLl9jb21wb3NpdGVPcHMgPSAoX2EgPSB7fSxcbiAgICAgICAgICAgIF9hW2cuQ29tcG9zaXRlT3BlcmF0aW9uLlNvdXJjZUF0b3BdID0gW3RoaXMuX2NvbnRleHQuRFNUX0FMUEhBLCB0aGlzLl9jb250ZXh0Lk9ORV9NSU5VU19TUkNfQUxQSEFdLFxuICAgICAgICAgICAgX2FbZy5Db21wb3NpdGVPcGVyYXRpb24uRXhwZXJpbWVudGFsU291cmNlSW5dID0gW3RoaXMuX2NvbnRleHQuRFNUX0FMUEhBLCB0aGlzLl9jb250ZXh0LlpFUk9dLFxuICAgICAgICAgICAgX2FbZy5Db21wb3NpdGVPcGVyYXRpb24uRXhwZXJpbWVudGFsU291cmNlT3V0XSA9IFt0aGlzLl9jb250ZXh0Lk9ORV9NSU5VU19EU1RfQUxQSEEsIHRoaXMuX2NvbnRleHQuWkVST10sXG4gICAgICAgICAgICBfYVtnLkNvbXBvc2l0ZU9wZXJhdGlvbi5Tb3VyY2VPdmVyXSA9IFt0aGlzLl9jb250ZXh0Lk9ORSwgdGhpcy5fY29udGV4dC5PTkVfTUlOVVNfU1JDX0FMUEhBXSxcbiAgICAgICAgICAgIF9hW2cuQ29tcG9zaXRlT3BlcmF0aW9uLkV4cGVyaW1lbnRhbERlc3RpbmF0aW9uQXRvcF0gPSBbdGhpcy5fY29udGV4dC5PTkVfTUlOVVNfRFNUX0FMUEhBLCB0aGlzLl9jb250ZXh0LlNSQ19BTFBIQV0sXG4gICAgICAgICAgICBfYVtnLkNvbXBvc2l0ZU9wZXJhdGlvbi5FeHBlcmltZW50YWxEZXN0aW5hdGlvbkluXSA9IFt0aGlzLl9jb250ZXh0LlpFUk8sIHRoaXMuX2NvbnRleHQuU1JDX0FMUEhBXSxcbiAgICAgICAgICAgIF9hW2cuQ29tcG9zaXRlT3BlcmF0aW9uLkRlc3RpbmF0aW9uT3V0XSA9IFt0aGlzLl9jb250ZXh0LlpFUk8sIHRoaXMuX2NvbnRleHQuT05FX01JTlVTX1NSQ19BTFBIQV0sXG4gICAgICAgICAgICBfYVtnLkNvbXBvc2l0ZU9wZXJhdGlvbi5EZXN0aW5hdGlvbk92ZXJdID0gW3RoaXMuX2NvbnRleHQuT05FX01JTlVTX0RTVF9BTFBIQSwgdGhpcy5fY29udGV4dC5PTkVdLFxuICAgICAgICAgICAgX2FbZy5Db21wb3NpdGVPcGVyYXRpb24uTGlnaHRlcl0gPSBbdGhpcy5fY29udGV4dC5PTkUsIHRoaXMuX2NvbnRleHQuT05FXSxcbiAgICAgICAgICAgIF9hW2cuQ29tcG9zaXRlT3BlcmF0aW9uLkNvcHldID0gW3RoaXMuX2NvbnRleHQuT05FLCB0aGlzLl9jb250ZXh0LlpFUk9dLFxuICAgICAgICAgICAgX2FbZy5Db21wb3NpdGVPcGVyYXRpb24uWG9yXSA9IFt0aGlzLl9jb250ZXh0Lk9ORV9NSU5VU19EU1RfQUxQSEEsIHRoaXMuX2NvbnRleHQuT05FX01JTlVTX1NSQ19BTFBIQV0sXG4gICAgICAgICAgICBfYSk7XG4gICAgICAgIHZhciBjb21wb3NpdGVPcGVyYXRpb24gPSB0aGlzLl9jb21wb3NpdGVPcHNbdGhpcy5fY3VycmVudENvbXBvc2l0ZU9wZXJhdGlvbl07XG4gICAgICAgIHRoaXMuX2NvbnRleHQuYmxlbmRGdW5jKGNvbXBvc2l0ZU9wZXJhdGlvblswXSwgY29tcG9zaXRlT3BlcmF0aW9uWzFdKTtcbiAgICB9O1xuICAgIFdlYkdMU2hhcmVkT2JqZWN0LnByb3RvdHlwZS5fbWFrZUJ1ZmZlciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHZhciBidWZmZXIgPSB0aGlzLl9jb250ZXh0LmNyZWF0ZUJ1ZmZlcigpO1xuICAgICAgICB0aGlzLl9jb250ZXh0LmJpbmRCdWZmZXIodGhpcy5fY29udGV4dC5BUlJBWV9CVUZGRVIsIGJ1ZmZlcik7XG4gICAgICAgIHRoaXMuX2NvbnRleHQuYnVmZmVyRGF0YSh0aGlzLl9jb250ZXh0LkFSUkFZX0JVRkZFUiwgZGF0YSwgdGhpcy5fY29udGV4dC5EWU5BTUlDX0RSQVcpO1xuICAgICAgICByZXR1cm4gYnVmZmVyO1xuICAgIH07XG4gICAgV2ViR0xTaGFyZWRPYmplY3QucHJvdG90eXBlLl90cmFuc2Zvcm1WZXJ0ZXggPSBmdW5jdGlvbiAoeCwgeSwgdywgaCwgdHJhbnNmb3JtZXIpIHtcbiAgICAgICAgdmFyIHJlbmRlclRhZ2V0ID0gdGhpcy5nZXRDdXJyZW50UmVuZGVyVGFyZ2V0KCk7XG4gICAgICAgIHZhciBjdyA9IDIuMCAvIHJlbmRlclRhZ2V0LndpZHRoO1xuICAgICAgICB2YXIgY2ggPSAtMi4wIC8gcmVuZGVyVGFnZXQuaGVpZ2h0O1xuICAgICAgICB2YXIgbSA9IHRyYW5zZm9ybWVyLm1hdHJpeDtcbiAgICAgICAgdmFyIGEgPSBjdyAqIHcgKiBtWzBdO1xuICAgICAgICB2YXIgYiA9IGNoICogdyAqIG1bMV07XG4gICAgICAgIHZhciBjID0gY3cgKiBoICogbVsyXTtcbiAgICAgICAgdmFyIGQgPSBjaCAqIGggKiBtWzNdO1xuICAgICAgICB2YXIgZSA9IGN3ICogKHggKiBtWzBdICsgeSAqIG1bMl0gKyBtWzRdKSAtIDEuMDtcbiAgICAgICAgdmFyIGYgPSBjaCAqICh4ICogbVsxXSArIHkgKiBtWzNdICsgbVs1XSkgKyAxLjA7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBlLCBmLCBhICsgZSwgYiArIGYsIGEgKyBjICsgZSwgYiArIGQgKyBmLFxuICAgICAgICAgICAgZSwgZiwgYSArIGMgKyBlLCBiICsgZCArIGYsIGMgKyBlLCBkICsgZlxuICAgICAgICBdO1xuICAgIH07XG4gICAgV2ViR0xTaGFyZWRPYmplY3QucHJvdG90eXBlLl9yZWdpc3RlciA9IGZ1bmN0aW9uICh2ZXJ0ZXgsIHRleENvb3JkKSB7XG4gICAgICAgIHZhciBvZmZzZXQgPSB0aGlzLl9udW1TcHJpdGVzICogNjtcbiAgICAgICAgKyt0aGlzLl9udW1TcHJpdGVzO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY7ICsraSkge1xuICAgICAgICAgICAgdGhpcy5fdmVydGljZXNDYWNoZVs0ICogKGkgKyBvZmZzZXQpICsgMF0gPSB2ZXJ0ZXhbMiAqIGkgKyAwXTtcbiAgICAgICAgICAgIHRoaXMuX3ZlcnRpY2VzQ2FjaGVbNCAqIChpICsgb2Zmc2V0KSArIDFdID0gdmVydGV4WzIgKiBpICsgMV07XG4gICAgICAgICAgICB0aGlzLl92ZXJ0aWNlc0NhY2hlWzQgKiAoaSArIG9mZnNldCkgKyAyXSA9IHRleENvb3JkWzIgKiBpICsgMF07XG4gICAgICAgICAgICB0aGlzLl92ZXJ0aWNlc0NhY2hlWzQgKiAoaSArIG9mZnNldCkgKyAzXSA9IHRleENvb3JkWzIgKiBpICsgMV07XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFdlYkdMU2hhcmVkT2JqZWN0LnByb3RvdHlwZS5fY29tbWl0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fbnVtU3ByaXRlcyA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuX2NvbnRleHQuYmluZEJ1ZmZlcih0aGlzLl9jb250ZXh0LkFSUkFZX0JVRkZFUiwgdGhpcy5fdmVydGljZXMpO1xuICAgICAgICAgICAgdGhpcy5fY29udGV4dC5idWZmZXJTdWJEYXRhKHRoaXMuX2NvbnRleHQuQVJSQVlfQlVGRkVSLCAwLCB0aGlzLl92ZXJ0aWNlc0NhY2hlLnN1YmFycmF5KDAsIHRoaXMuX251bVNwcml0ZXMgKiAyNCkpO1xuICAgICAgICAgICAgdGhpcy5fY29udGV4dC5kcmF3QXJyYXlzKHRoaXMuX2NvbnRleHQuVFJJQU5HTEVTLCAwLCB0aGlzLl9udW1TcHJpdGVzICogNik7XG4gICAgICAgICAgICB0aGlzLl9udW1TcHJpdGVzID0gMDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIFdlYkdMU2hhcmVkT2JqZWN0O1xufSgpKTtcbmV4cG9ydHMuV2ViR0xTaGFyZWRPYmplY3QgPSBXZWJHTFNoYXJlZE9iamVjdDtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5XZWJHTFRleHR1cmVBdGxhcyA9IHZvaWQgMDtcbnZhciBXZWJHTFRleHR1cmVNYXBfMSA9IHJlcXVpcmUoXCIuL1dlYkdMVGV4dHVyZU1hcFwiKTtcbnZhciBSZW5kZXJpbmdIZWxwZXJfMSA9IHJlcXVpcmUoXCIuLi9SZW5kZXJpbmdIZWxwZXJcIik7XG52YXIgV2ViR0xUZXh0dXJlQXRsYXMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gV2ViR0xUZXh0dXJlQXRsYXMoKSB7XG4gICAgICAgIHRoaXMuX21hcHMgPSBbXTtcbiAgICAgICAgdGhpcy5faW5zZXJ0UG9zID0gMDtcbiAgICAgICAgdGhpcy5lbXB0eVRleHR1cmVQaXhlbHMgPSBuZXcgVWludDhBcnJheShXZWJHTFRleHR1cmVBdGxhcy5URVhUVVJFX1NJWkUgKiBXZWJHTFRleHR1cmVBdGxhcy5URVhUVVJFX1NJWkUgKiA0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICog5paw44GX44GE44K344O844Oz44Gr6YG356e744GX44Gf44Go44GN5ZG844G244CCXG4gICAgICovXG4gICAgV2ViR0xUZXh0dXJlQXRsYXMucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX21hcHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHRoaXMuX21hcHNbaV0uZGlzcG9zZSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiDnj77lnKjjga7jg4bjgq/jgrnjg4Hjg6PpoJjln5/kvb/nlKjlirnnjofjgpLooajnpLrjgZnjgovjgIJcbiAgICAgKi9cbiAgICBXZWJHTFRleHR1cmVBdGxhcy5wcm90b3R5cGUuc2hvd09jY3VwYW5jeSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9tYXBzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIm9jY3VwYW5jeVtcIiArIGkgKyBcIl06IFwiICsgdGhpcy5fbWFwc1tpXS5vY2N1cGFuY3koKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGcuU3VyZmFjZSDnlKjjgavjg4bjgq/jgrnjg4Hjg6PjgpLkvZzmiJDjgZnjgovjgIJcbiAgICAgKi9cbiAgICBXZWJHTFRleHR1cmVBdGxhcy5wcm90b3R5cGUubWFrZVRleHR1cmVGb3JTdXJmYWNlID0gZnVuY3Rpb24gKHNoYXJlZCwgc3VyZmFjZSkge1xuICAgICAgICB2YXIgaW1hZ2UgPSBzdXJmYWNlLl9kcmF3YWJsZTtcbiAgICAgICAgaWYgKCFpbWFnZSB8fCBpbWFnZS50ZXh0dXJlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2Uud2lkdGg7XG4gICAgICAgIHZhciBoZWlnaHQgPSBpbWFnZS5oZWlnaHQ7XG4gICAgICAgIC8vIOOCteOCpOOCuuOBjOWkp+OBjeOBhOOBruOBp+WNmOS9k+OBruODhuOCr+OCueODgeODo+OBqOOBl+OBpuaJseOBhlxuICAgICAgICBpZiAoKHdpZHRoID49IFdlYkdMVGV4dHVyZUF0bGFzLlRFWFRVUkVfU0laRSkgfHwgKGhlaWdodCA+PSBXZWJHTFRleHR1cmVBdGxhcy5URVhUVVJFX1NJWkUpKSB7XG4gICAgICAgICAgICAvLyDnlLvlg4/jgrXjgqTjgrrjgYwgMl5uIOOBp+OBquOBhOOBqOOBjeOBr+ODquOCteOCpOOCuuOBmeOCi1xuICAgICAgICAgICAgdmFyIHcgPSBSZW5kZXJpbmdIZWxwZXJfMS5SZW5kZXJpbmdIZWxwZXIudG9Qb3dlck9mVHdvKGltYWdlLndpZHRoKTtcbiAgICAgICAgICAgIHZhciBoID0gUmVuZGVyaW5nSGVscGVyXzEuUmVuZGVyaW5nSGVscGVyLnRvUG93ZXJPZlR3byhpbWFnZS5oZWlnaHQpO1xuICAgICAgICAgICAgaWYgKCh3ICE9PSBpbWFnZS53aWR0aCkgfHwgKGggIT09IGltYWdlLmhlaWdodCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSB3O1xuICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoO1xuICAgICAgICAgICAgICAgIHZhciBjYW52YXNDb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgICAgICAgICBjYW52YXNDb250ZXh0Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwiY29weVwiO1xuICAgICAgICAgICAgICAgIGNhbnZhc0NvbnRleHQuZHJhd0ltYWdlKGltYWdlLCAwLCAwKTtcbiAgICAgICAgICAgICAgICBpbWFnZSA9IGNhbnZhc0NvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIHcsIGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3VyZmFjZS5fZHJhd2FibGUudGV4dHVyZSA9IHNoYXJlZC5tYWtlVGV4dHVyZShpbWFnZSk7XG4gICAgICAgICAgICBzdXJmYWNlLl9kcmF3YWJsZS50ZXh0dXJlT2Zmc2V0WCA9IDA7XG4gICAgICAgICAgICBzdXJmYWNlLl9kcmF3YWJsZS50ZXh0dXJlT2Zmc2V0WSA9IDA7XG4gICAgICAgICAgICBzdXJmYWNlLl9kcmF3YWJsZS50ZXh0dXJlV2lkdGggPSB3O1xuICAgICAgICAgICAgc3VyZmFjZS5fZHJhd2FibGUudGV4dHVyZUhlaWdodCA9IGg7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYXNzaWduKHNoYXJlZCwgc3VyZmFjZSwgdGhpcy5fbWFwcyk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiDpganlvZPjgarjg4bjgq/jgrnjg4Hjg6PjgqLjg4jjg6njgrnjgavjgrXjg7zjg5XjgqPjgrnjgpLlibLjgorlvZPjgabjgotcbiAgICAgKi9cbiAgICBXZWJHTFRleHR1cmVBdGxhcy5wcm90b3R5cGUuX2Fzc2lnbiA9IGZ1bmN0aW9uIChzaGFyZWQsIHN1cmZhY2UsIG1hcHMpIHtcbiAgICAgICAgLy8g44OG44Kv44K544OB44Oj44Ki44OI44Op44K544Gr5Ymy44KK5b2T44Gm44KLXG4gICAgICAgIHZhciBtYXA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFwcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgbWFwID0gbWFwc1soaSArIHRoaXMuX2luc2VydFBvcykgJSBtYXBzLmxlbmd0aF0uaW5zZXJ0KHN1cmZhY2UpO1xuICAgICAgICAgICAgaWYgKG1hcCkge1xuICAgICAgICAgICAgICAgIC8vIOeZu+mMsuOBmeOCi1xuICAgICAgICAgICAgICAgIHRoaXMuX3JlZ2lzdGVyKHNoYXJlZCwgbWFwLCBzdXJmYWNlLl9kcmF3YWJsZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5faW5zZXJ0UG9zID0gaTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbWFwID0gbnVsbDtcbiAgICAgICAgLy8g44OG44Kv44K544OB44Oj5a656YeP44GM44GC44G144KM44KL44Gu44Gn5Y+k44GE44KE44Gk44KS5raI44GX44Gm5YaN5Yip55So44GZ44KLXG4gICAgICAgIGlmIChtYXBzLmxlbmd0aCA+PSBXZWJHTFRleHR1cmVBdGxhcy5URVhUVVJFX0NPVU5UKSB7XG4gICAgICAgICAgICBtYXAgPSBtYXBzLnNoaWZ0KCk7XG4gICAgICAgICAgICBzaGFyZWQuZGlzcG9zZVRleHR1cmUobWFwLnRleHR1cmUpO1xuICAgICAgICAgICAgbWFwLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgIHNoYXJlZC5jbGVhclRleHR1cmUodGhpcy5lbXB0eVRleHR1cmVQaXhlbHMsIFdlYkdMVGV4dHVyZUF0bGFzLlRFWFRVUkVfU0laRSwgV2ViR0xUZXh0dXJlQXRsYXMuVEVYVFVSRV9TSVpFLCBtYXAudGV4dHVyZSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8g5YaN5Yip55So44Gn44GN44Gq44GE5aC05ZCI44Gv44CB5paw6KaP55Sf5oiQ44GZ44KLXG4gICAgICAgIGlmICghbWFwKSB7XG4gICAgICAgICAgICBtYXAgPSBuZXcgV2ViR0xUZXh0dXJlTWFwXzEuV2ViR0xUZXh0dXJlTWFwKHNoYXJlZC5tYWtlVGV4dHVyZVJhdyhXZWJHTFRleHR1cmVBdGxhcy5URVhUVVJFX1NJWkUsIFdlYkdMVGV4dHVyZUF0bGFzLlRFWFRVUkVfU0laRSksIDAsIDAsIFdlYkdMVGV4dHVyZUF0bGFzLlRFWFRVUkVfU0laRSwgV2ViR0xUZXh0dXJlQXRsYXMuVEVYVFVSRV9TSVpFKTtcbiAgICAgICAgfVxuICAgICAgICAvLyDnmbvpjLLjgZnjgotcbiAgICAgICAgbWFwcy5wdXNoKG1hcCk7XG4gICAgICAgIG1hcCA9IG1hcC5pbnNlcnQoc3VyZmFjZSk7XG4gICAgICAgIHRoaXMuX3JlZ2lzdGVyKHNoYXJlZCwgbWFwLCBzdXJmYWNlLl9kcmF3YWJsZSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiDjg4bjgq/jgrnjg4Hjg6PjgpLnmbvpjLLjgZnjgovjgIJcbiAgICAgKi9cbiAgICBXZWJHTFRleHR1cmVBdGxhcy5wcm90b3R5cGUuX3JlZ2lzdGVyID0gZnVuY3Rpb24gKHNoYXJlZCwgbWFwLCBpbWFnZSkge1xuICAgICAgICBpbWFnZS50ZXh0dXJlID0gbWFwLnRleHR1cmU7XG4gICAgICAgIGltYWdlLnRleHR1cmVPZmZzZXRYID0gbWFwLm9mZnNldFg7XG4gICAgICAgIGltYWdlLnRleHR1cmVPZmZzZXRZID0gbWFwLm9mZnNldFk7XG4gICAgICAgIGltYWdlLnRleHR1cmVXaWR0aCA9IFdlYkdMVGV4dHVyZUF0bGFzLlRFWFRVUkVfU0laRTtcbiAgICAgICAgaW1hZ2UudGV4dHVyZUhlaWdodCA9IFdlYkdMVGV4dHVyZUF0bGFzLlRFWFRVUkVfU0laRTtcbiAgICAgICAgc2hhcmVkLmFzc2lnblRleHR1cmUoaW1hZ2UsIG1hcC5vZmZzZXRYLCBtYXAub2Zmc2V0WSwgbWFwLnRleHR1cmUpO1xuICAgIH07XG4gICAgLy8g56K65L+d44GZ44KL44OG44Kv44K544OB44Oj44Gu44K144Kk44K6ICjlrp/pmpvjga7jgrLjg7zjg6DjgavlkIjjgo/jgZvjgabjg4Hjg6Xjg7zjg4vjg7PjgrDjgZnjgovlv4XopoHjgYzjgYLjgospXG4gICAgV2ViR0xUZXh0dXJlQXRsYXMuVEVYVFVSRV9TSVpFID0gMTAyNDtcbiAgICAvLyDnorrkv53jgZnjgovjg4bjgq/jgrnjg4Hjg6Pjga7mlbAgKOWun+mam+OBruOCsuODvOODoOOBq+WQiOOCj+OBm+OBpuODgeODpeODvOODi+ODs+OCsOOBmeOCi+W/heimgeOBjOOBguOCiylcbiAgICBXZWJHTFRleHR1cmVBdGxhcy5URVhUVVJFX0NPVU5UID0gMTY7XG4gICAgcmV0dXJuIFdlYkdMVGV4dHVyZUF0bGFzO1xufSgpKTtcbmV4cG9ydHMuV2ViR0xUZXh0dXJlQXRsYXMgPSBXZWJHTFRleHR1cmVBdGxhcztcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5XZWJHTFRleHR1cmVNYXAgPSB2b2lkIDA7XG52YXIgV2ViR0xUZXh0dXJlTWFwID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFdlYkdMVGV4dHVyZU1hcCh0ZXh0dXJlLCBvZmZzZXRYLCBvZmZzZXRZLCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgIHRoaXMudGV4dHVyZSA9IHRleHR1cmU7XG4gICAgICAgIHRoaXMub2Zmc2V0WCA9IG9mZnNldFg7XG4gICAgICAgIHRoaXMub2Zmc2V0WSA9IG9mZnNldFk7XG4gICAgICAgIHRoaXMuX3dpZHRoID0gd2lkdGg7XG4gICAgICAgIHRoaXMuX2hlaWdodCA9IGhlaWdodDtcbiAgICB9XG4gICAgV2ViR0xUZXh0dXJlTWFwLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fbGVmdCkge1xuICAgICAgICAgICAgdGhpcy5fbGVmdC5kaXNwb3NlKCk7XG4gICAgICAgICAgICB0aGlzLl9sZWZ0ID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fcmlnaHQpIHtcbiAgICAgICAgICAgIHRoaXMuX3JpZ2h0LmRpc3Bvc2UoKTtcbiAgICAgICAgICAgIHRoaXMuX3JpZ2h0ID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fc3VyZmFjZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX3N1cmZhY2UuX2RyYXdhYmxlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3VyZmFjZS5fZHJhd2FibGUudGV4dHVyZSA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9zdXJmYWNlID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgV2ViR0xUZXh0dXJlTWFwLnByb3RvdHlwZS5jYXBhY2l0eSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3dpZHRoICogdGhpcy5faGVpZ2h0O1xuICAgIH07XG4gICAgV2ViR0xUZXh0dXJlTWFwLnByb3RvdHlwZS5hcmVhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuX3N1cmZhY2UpIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIHZhciBpbWFnZSA9IHRoaXMuX3N1cmZhY2UuX2RyYXdhYmxlO1xuICAgICAgICB2YXIgYSA9IGltYWdlLndpZHRoICogaW1hZ2UuaGVpZ2h0O1xuICAgICAgICBpZiAodGhpcy5fbGVmdCkge1xuICAgICAgICAgICAgYSArPSB0aGlzLl9sZWZ0LmFyZWEoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fcmlnaHQpIHtcbiAgICAgICAgICAgIGEgKz0gdGhpcy5fcmlnaHQuYXJlYSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhO1xuICAgIH07XG4gICAgV2ViR0xUZXh0dXJlTWFwLnByb3RvdHlwZS5vY2N1cGFuY3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFyZWEoKSAvIHRoaXMuY2FwYWNpdHkoKTtcbiAgICB9O1xuICAgIFdlYkdMVGV4dHVyZU1hcC5wcm90b3R5cGUuaW5zZXJ0ID0gZnVuY3Rpb24gKHN1cmZhY2UpIHtcbiAgICAgICAgdmFyIGltYWdlID0gc3VyZmFjZS5fZHJhd2FibGU7XG4gICAgICAgIC8vIOODnuODvOOCuOODs+OCkuiAg+aFruOBl+OBn+mgmOWfn+OCkueiuuS/nVxuICAgICAgICB2YXIgd2lkdGggPSBpbWFnZS53aWR0aCArIFdlYkdMVGV4dHVyZU1hcC5URVhUVVJFX01BUkdJTjtcbiAgICAgICAgdmFyIGhlaWdodCA9IGltYWdlLmhlaWdodCArIFdlYkdMVGV4dHVyZU1hcC5URVhUVVJFX01BUkdJTjtcbiAgICAgICAgLy8g5YaN5biw55qE44Gr44OR44OD44Kt44Oz44KwXG4gICAgICAgIGlmICh0aGlzLl9zdXJmYWNlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fbGVmdCkge1xuICAgICAgICAgICAgICAgIHZhciBsZWZ0ID0gdGhpcy5fbGVmdC5pbnNlcnQoc3VyZmFjZSk7XG4gICAgICAgICAgICAgICAgaWYgKGxlZnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxlZnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuX3JpZ2h0KSB7XG4gICAgICAgICAgICAgICAgdmFyIHJpZ2h0ID0gdGhpcy5fcmlnaHQuaW5zZXJ0KHN1cmZhY2UpO1xuICAgICAgICAgICAgICAgIGlmIChyaWdodCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmlnaHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgLy8g6Kmw44KB6L6844G/5LiN5Y+v6IO9XG4gICAgICAgIGlmICgodGhpcy5fd2lkdGggPCB3aWR0aCkgfHwgKHRoaXMuX2hlaWdodCA8IGhlaWdodCkpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHZhciByZW1haW5XaWR0aCA9IHRoaXMuX3dpZHRoIC0gd2lkdGg7XG4gICAgICAgIHZhciByZW1haW5IZWlnaHQgPSB0aGlzLl9oZWlnaHQgLSBoZWlnaHQ7XG4gICAgICAgIGlmIChyZW1haW5XaWR0aCA8PSByZW1haW5IZWlnaHQpIHtcbiAgICAgICAgICAgIHRoaXMuX2xlZnQgPSBuZXcgV2ViR0xUZXh0dXJlTWFwKHRoaXMudGV4dHVyZSwgdGhpcy5vZmZzZXRYICsgd2lkdGgsIHRoaXMub2Zmc2V0WSwgcmVtYWluV2lkdGgsIGhlaWdodCk7XG4gICAgICAgICAgICB0aGlzLl9yaWdodCA9IG5ldyBXZWJHTFRleHR1cmVNYXAodGhpcy50ZXh0dXJlLCB0aGlzLm9mZnNldFgsIHRoaXMub2Zmc2V0WSArIGhlaWdodCwgdGhpcy5fd2lkdGgsIHJlbWFpbkhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9sZWZ0ID0gbmV3IFdlYkdMVGV4dHVyZU1hcCh0aGlzLnRleHR1cmUsIHRoaXMub2Zmc2V0WCwgdGhpcy5vZmZzZXRZICsgaGVpZ2h0LCB3aWR0aCwgcmVtYWluSGVpZ2h0KTtcbiAgICAgICAgICAgIHRoaXMuX3JpZ2h0ID0gbmV3IFdlYkdMVGV4dHVyZU1hcCh0aGlzLnRleHR1cmUsIHRoaXMub2Zmc2V0WCArIHdpZHRoLCB0aGlzLm9mZnNldFksIHJlbWFpbldpZHRoLCB0aGlzLl9oZWlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3N1cmZhY2UgPSBzdXJmYWNlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIC8vIOWQhOODhuOCr+OCueODgeODo+OCkumFjee9ruOBmeOCi+mam+OBruODnuODvOOCuOODs+ODlOOCr+OCu+ODq+aVsFxuICAgIC8vIOODnuODvOOCuOODs+OCkuWPluOCieOBquOBhOOBqOOAgemao+aOpeOBmeOCi+ODhuOCr+OCueODgeODo+OBjOa7suOCk+OBp+aPj+eUu+OBleOCjOOCi+WPr+iDveaAp+OBjOOBguOCi+OAglxuICAgIFdlYkdMVGV4dHVyZU1hcC5URVhUVVJFX01BUkdJTiA9IDE7XG4gICAgcmV0dXJuIFdlYkdMVGV4dHVyZU1hcDtcbn0oKSk7XG5leHBvcnRzLldlYkdMVGV4dHVyZU1hcCA9IFdlYkdMVGV4dHVyZU1hcDtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5JbnB1dEFic3RyYWN0SGFuZGxlciA9IHZvaWQgMDtcbnZhciBnID0gcmVxdWlyZShcIkBha2FzaGljL2FrYXNoaWMtZW5naW5lXCIpO1xudmFyIHBkaSA9IHJlcXVpcmUoXCJAYWthc2hpYy9ha2FzaGljLXBkaVwiKTtcbi8qKlxuICog5YWl5Yqb44OP44Oz44OJ44Op44CCXG4gKlxuICog44Kz44Oz44K544OI44Op44Kv44K/44Gn5Y+X44GR5Y+W44Gj44GfVmlld+OBq+WvvuOBl+OBpkRPTeOCpOODmeODs+ODiOOBruODj+ODs+ODieODqeOCkuioreWumuOBmeOCi+OAglxuICogRE9N44Kk44OZ44Oz44OI5oOF5aCx44GL44KJIGBQb2ludEV2ZW50UmVzcG9uc2VgIOOBuOWkieaPm+OBl+OBn+ODh+ODvOOCv+OCkiBgcG9pbnR7RG93biwgTW92ZSwgVXB9VHJpZ2dlcmAg44KS6YCa44GX44Gm6YCa55+l44GZ44KL44CCXG4gKiBEb3duIC0+IE1vdmUgLT4gVXAg44Gu44OV44Ot44O844Gr44GK44GR44KL44CBTW92ZeOCpOODmeODs+ODiOOBruODreODg+OCr+OCkueuoeeQhuOBmeOCi+OAglxuICovXG52YXIgSW5wdXRBYnN0cmFjdEhhbmRsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGlucHV0VmlldyBpbnB1dFZpZXfjga9ET03jgqTjg5njg7Pjg4jjgpLoqK3lrprjgZnjgotIVE1MRWxlbWVudFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIElucHV0QWJzdHJhY3RIYW5kbGVyKGlucHV0VmlldywgZGlzYWJsZVByZXZlbnREZWZhdWx0KSB7XG4gICAgICAgIGlmIChPYmplY3QuZ2V0UHJvdG90eXBlT2YgJiYgKE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKSA9PT0gSW5wdXRBYnN0cmFjdEhhbmRsZXIucHJvdG90eXBlKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5wdXRBYnN0cmFjdEhhbmRsZXIgaXMgYWJzdHJhY3QgYW5kIHNob3VsZCBub3QgYmUgZGlyZWN0bHkgaW5zdGFudGlhdGVkXCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5wdXRWaWV3ID0gaW5wdXRWaWV3O1xuICAgICAgICB0aGlzLnBvaW50ZXJFdmVudExvY2sgPSB7fTtcbiAgICAgICAgdGhpcy5feFNjYWxlID0gMTtcbiAgICAgICAgdGhpcy5feVNjYWxlID0gMTtcbiAgICAgICAgdGhpcy5fZGlzYWJsZVByZXZlbnREZWZhdWx0ID0gISFkaXNhYmxlUHJldmVudERlZmF1bHQ7XG4gICAgICAgIHRoaXMucG9pbnRUcmlnZ2VyID0gbmV3IGcuVHJpZ2dlcigpO1xuICAgIH1cbiAgICAvLyBgc3RhcnQoKWAg44Gn6Kit5a6a44GZ44KLRE9N44Kk44OZ44Oz44OI44KS44K144Od44O844OI44GX44Gm44GE44KL44GL44KS6L+U44GZXG4gICAgSW5wdXRBYnN0cmFjdEhhbmRsZXIuaXNTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIC8vIOe2meaJv+OBl+OBn+OCr+ODqeOCueOBq+OBiuOBhOOBpuOAgemBqeWIh+OBqkRPTeOCpOODmeODs+ODiOOCkuioreWumuOBmeOCi1xuICAgIElucHV0QWJzdHJhY3RIYW5kbGVyLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhpcyBtZXRob2QgaXMgYWJzdHJhY3RcIik7XG4gICAgfTtcbiAgICAvLyBzdGFydCgpIOOBq+WvvuW/nOOBmeOCi0RPTeOCpOODmeODs+ODiOOCkumWi+aUvuOBmeOCi1xuICAgIElucHV0QWJzdHJhY3RIYW5kbGVyLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGlzIG1ldGhvZCBpcyBhYnN0cmFjdFwiKTtcbiAgICB9O1xuICAgIElucHV0QWJzdHJhY3RIYW5kbGVyLnByb3RvdHlwZS5zZXRTY2FsZSA9IGZ1bmN0aW9uICh4U2NhbGUsIHlTY2FsZSkge1xuICAgICAgICBpZiAoeVNjYWxlID09PSB2b2lkIDApIHsgeVNjYWxlID0geFNjYWxlOyB9XG4gICAgICAgIHRoaXMuX3hTY2FsZSA9IHhTY2FsZTtcbiAgICAgICAgdGhpcy5feVNjYWxlID0geVNjYWxlO1xuICAgIH07XG4gICAgSW5wdXRBYnN0cmFjdEhhbmRsZXIucHJvdG90eXBlLnBvaW50RG93biA9IGZ1bmN0aW9uIChpZGVudGlmaWVyLCBwYWdlUG9zaXRpb24pIHtcbiAgICAgICAgdGhpcy5wb2ludFRyaWdnZXIuZmlyZSh7XG4gICAgICAgICAgICB0eXBlOiAwIC8qIERvd24gKi8sXG4gICAgICAgICAgICBpZGVudGlmaWVyOiBpZGVudGlmaWVyLFxuICAgICAgICAgICAgb2Zmc2V0OiB0aGlzLmdldE9mZnNldEZyb21FdmVudChwYWdlUG9zaXRpb24pXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBkb3du44Gu44Kk44OZ44Oz44OISUTjgpLkv53lrZjjgZfjgabjgIFtb3Zl44GodXDjga7jgqTjg5njg7Pjg4jjga7mipHliLbjgpLjgZnjgoso44Ot44OD44Kv44GZ44KLKVxuICAgICAgICB0aGlzLnBvaW50ZXJFdmVudExvY2tbaWRlbnRpZmllcl0gPSB0cnVlO1xuICAgIH07XG4gICAgSW5wdXRBYnN0cmFjdEhhbmRsZXIucHJvdG90eXBlLnBvaW50TW92ZSA9IGZ1bmN0aW9uIChpZGVudGlmaWVyLCBwYWdlUG9zaXRpb24pIHtcbiAgICAgICAgaWYgKCF0aGlzLnBvaW50ZXJFdmVudExvY2suaGFzT3duUHJvcGVydHkoaWRlbnRpZmllciArIFwiXCIpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wb2ludFRyaWdnZXIuZmlyZSh7XG4gICAgICAgICAgICB0eXBlOiAxIC8qIE1vdmUgKi8sXG4gICAgICAgICAgICBpZGVudGlmaWVyOiBpZGVudGlmaWVyLFxuICAgICAgICAgICAgb2Zmc2V0OiB0aGlzLmdldE9mZnNldEZyb21FdmVudChwYWdlUG9zaXRpb24pXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgSW5wdXRBYnN0cmFjdEhhbmRsZXIucHJvdG90eXBlLnBvaW50VXAgPSBmdW5jdGlvbiAoaWRlbnRpZmllciwgcGFnZVBvc2l0aW9uKSB7XG4gICAgICAgIGlmICghdGhpcy5wb2ludGVyRXZlbnRMb2NrLmhhc093blByb3BlcnR5KGlkZW50aWZpZXIgKyBcIlwiKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucG9pbnRUcmlnZ2VyLmZpcmUoe1xuICAgICAgICAgICAgdHlwZTogMiAvKiBVcCAqLyxcbiAgICAgICAgICAgIGlkZW50aWZpZXI6IGlkZW50aWZpZXIsXG4gICAgICAgICAgICBvZmZzZXQ6IHRoaXMuZ2V0T2Zmc2V0RnJvbUV2ZW50KHBhZ2VQb3NpdGlvbilcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFVw44GM5a6M5LqG44GX44Gf44KJ44CBRG93bi0+VXDjgYzlrozkuobjgZfjgZ/jgajjgZfjgabjg63jg4Pjgq/jgpLlpJbjgZlcbiAgICAgICAgZGVsZXRlIHRoaXMucG9pbnRlckV2ZW50TG9ja1tpZGVudGlmaWVyXTtcbiAgICB9O1xuICAgIElucHV0QWJzdHJhY3RIYW5kbGVyLnByb3RvdHlwZS5nZXRPZmZzZXRGcm9tRXZlbnQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICByZXR1cm4geyB4OiBlLm9mZnNldFgsIHk6IGUub2Zmc2V0WSB9O1xuICAgIH07XG4gICAgSW5wdXRBYnN0cmFjdEhhbmRsZXIucHJvdG90eXBlLmdldFNjYWxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4geyB4OiB0aGlzLl94U2NhbGUsIHk6IHRoaXMuX3lTY2FsZSB9O1xuICAgIH07XG4gICAgSW5wdXRBYnN0cmFjdEhhbmRsZXIucHJvdG90eXBlLmdldE9mZnNldFBvc2l0aW9uRnJvbUlucHV0VmlldyA9IGZ1bmN0aW9uIChwb3NpdGlvbikge1xuICAgICAgICAvLyB3aW5kb3fjga7lt6bkuIrjgpIwLDDjgajjgZfjgZ/mmYLjga5pbnB1dFZpZXfjga5vZmZzZXTjgpLlj5blvpfjgZnjgotcbiAgICAgICAgdmFyIGJvdW5kaW5nID0gdGhpcy5pbnB1dFZpZXcuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgIHZhciBzY2FsZSA9IHRoaXMuZ2V0U2NhbGUoKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG9mZnNldFg6IChwb3NpdGlvbi5wYWdlWCAtIE1hdGgucm91bmQod2luZG93LnBhZ2VYT2Zmc2V0ICsgYm91bmRpbmcubGVmdCkpIC8gc2NhbGUueCxcbiAgICAgICAgICAgIG9mZnNldFk6IChwb3NpdGlvbi5wYWdlWSAtIE1hdGgucm91bmQod2luZG93LnBhZ2VZT2Zmc2V0ICsgYm91bmRpbmcudG9wKSkgLyBzY2FsZS55XG4gICAgICAgIH07XG4gICAgfTtcbiAgICByZXR1cm4gSW5wdXRBYnN0cmFjdEhhbmRsZXI7XG59KCkpO1xuZXhwb3J0cy5JbnB1dEFic3RyYWN0SGFuZGxlciA9IElucHV0QWJzdHJhY3RIYW5kbGVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTW91c2VIYW5kbGVyID0gdm9pZCAwO1xudmFyIElucHV0QWJzdHJhY3RIYW5kbGVyXzEgPSByZXF1aXJlKFwiLi9JbnB1dEFic3RyYWN0SGFuZGxlclwiKTtcbnZhciBNb3VzZUhhbmRsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKE1vdXNlSGFuZGxlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBNb3VzZUhhbmRsZXIoaW5wdXRWaWV3LCBkaXNhYmxlUHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgaW5wdXRWaWV3LCBkaXNhYmxlUHJldmVudERlZmF1bHQpIHx8IHRoaXM7XG4gICAgICAgIHZhciBpZGVudGlmaWVyID0gMTtcbiAgICAgICAgX3RoaXMub25Nb3VzZURvd24gPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgKGUuYnV0dG9uICE9PSAwKVxuICAgICAgICAgICAgICAgIHJldHVybjsgLy8gTk9URTog5bem44Kv44Oq44OD44Kv5Lul5aSW44KS5Y+X44GR5LuY44GR44Gq44GEXG4gICAgICAgICAgICBfdGhpcy5wb2ludERvd24oaWRlbnRpZmllciwgX3RoaXMuZ2V0T2Zmc2V0UG9zaXRpb25Gcm9tSW5wdXRWaWV3KGUpKTtcbiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIF90aGlzLm9uTW91c2VNb3ZlLCBmYWxzZSk7XG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgX3RoaXMub25Nb3VzZVVwLCBmYWxzZSk7XG4gICAgICAgICAgICBpZiAoIV90aGlzLl9kaXNhYmxlUHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgX3RoaXMub25Nb3VzZU1vdmUgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgX3RoaXMucG9pbnRNb3ZlKGlkZW50aWZpZXIsIF90aGlzLmdldE9mZnNldFBvc2l0aW9uRnJvbUlucHV0VmlldyhlKSk7XG4gICAgICAgICAgICBpZiAoIV90aGlzLl9kaXNhYmxlUHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgX3RoaXMub25Nb3VzZVVwID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIF90aGlzLnBvaW50VXAoaWRlbnRpZmllciwgX3RoaXMuZ2V0T2Zmc2V0UG9zaXRpb25Gcm9tSW5wdXRWaWV3KGUpKTtcbiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIF90aGlzLm9uTW91c2VNb3ZlLCBmYWxzZSk7XG4gICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgX3RoaXMub25Nb3VzZVVwLCBmYWxzZSk7XG4gICAgICAgICAgICBpZiAoIV90aGlzLl9kaXNhYmxlUHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBNb3VzZUhhbmRsZXIucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlucHV0Vmlldy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMub25Nb3VzZURvd24sIGZhbHNlKTtcbiAgICB9O1xuICAgIE1vdXNlSGFuZGxlci5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pbnB1dFZpZXcucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLm9uTW91c2VEb3duLCBmYWxzZSk7XG4gICAgfTtcbiAgICByZXR1cm4gTW91c2VIYW5kbGVyO1xufShJbnB1dEFic3RyYWN0SGFuZGxlcl8xLklucHV0QWJzdHJhY3RIYW5kbGVyKSk7XG5leHBvcnRzLk1vdXNlSGFuZGxlciA9IE1vdXNlSGFuZGxlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlRvdWNoSGFuZGxlciA9IHZvaWQgMDtcbnZhciBNb3VzZUhhbmRsZXJfMSA9IHJlcXVpcmUoXCIuL01vdXNlSGFuZGxlclwiKTtcbnZhciBUb3VjaEhhbmRsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFRvdWNoSGFuZGxlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBUb3VjaEhhbmRsZXIoaW5wdXRWaWV3LCBkaXNhYmxlUHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgaW5wdXRWaWV3LCBkaXNhYmxlUHJldmVudERlZmF1bHQpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLm9uVG91Y2hEb3duID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHZhciB0b3VjaGVzID0gZS5jaGFuZ2VkVG91Y2hlcztcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0b3VjaGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRvdWNoID0gdG91Y2hlc1tpXTtcbiAgICAgICAgICAgICAgICBfdGhpcy5wb2ludERvd24odG91Y2guaWRlbnRpZmllciwgX3RoaXMuZ2V0T2Zmc2V0UG9zaXRpb25Gcm9tSW5wdXRWaWV3KHRvdWNoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIV90aGlzLl9kaXNhYmxlUHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGlmIChlLmNhbmNlbGFibGUpXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgX3RoaXMub25Ub3VjaE1vdmUgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgdmFyIHRvdWNoZXMgPSBlLmNoYW5nZWRUb3VjaGVzO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRvdWNoZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgdG91Y2ggPSB0b3VjaGVzW2ldO1xuICAgICAgICAgICAgICAgIF90aGlzLnBvaW50TW92ZSh0b3VjaC5pZGVudGlmaWVyLCBfdGhpcy5nZXRPZmZzZXRQb3NpdGlvbkZyb21JbnB1dFZpZXcodG91Y2gpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghX3RoaXMuX2Rpc2FibGVQcmV2ZW50RGVmYXVsdCkge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgaWYgKGUuY2FuY2VsYWJsZSlcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBfdGhpcy5vblRvdWNoVXAgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgdmFyIHRvdWNoZXMgPSBlLmNoYW5nZWRUb3VjaGVzO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRvdWNoZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgdG91Y2ggPSB0b3VjaGVzW2ldO1xuICAgICAgICAgICAgICAgIF90aGlzLnBvaW50VXAodG91Y2guaWRlbnRpZmllciwgX3RoaXMuZ2V0T2Zmc2V0UG9zaXRpb25Gcm9tSW5wdXRWaWV3KHRvdWNoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIV90aGlzLl9kaXNhYmxlUHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGlmIChlLmNhbmNlbGFibGUpXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBUb3VjaEhhbmRsZXIucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLnN0YXJ0LmNhbGwodGhpcyk7XG4gICAgICAgIHRoaXMuaW5wdXRWaWV3LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIHRoaXMub25Ub3VjaERvd24pO1xuICAgICAgICB0aGlzLmlucHV0Vmlldy5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIHRoaXMub25Ub3VjaE1vdmUpO1xuICAgICAgICB0aGlzLmlucHV0Vmlldy5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgdGhpcy5vblRvdWNoVXApO1xuICAgIH07XG4gICAgVG91Y2hIYW5kbGVyLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLnN0b3AuY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy5pbnB1dFZpZXcucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgdGhpcy5vblRvdWNoRG93bik7XG4gICAgICAgIHRoaXMuaW5wdXRWaWV3LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0b3VjaG1vdmVcIiwgdGhpcy5vblRvdWNoTW92ZSk7XG4gICAgICAgIHRoaXMuaW5wdXRWaWV3LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCB0aGlzLm9uVG91Y2hVcCk7XG4gICAgfTtcbiAgICByZXR1cm4gVG91Y2hIYW5kbGVyO1xufShNb3VzZUhhbmRsZXJfMS5Nb3VzZUhhbmRsZXIpKTtcbmV4cG9ydHMuVG91Y2hIYW5kbGVyID0gVG91Y2hIYW5kbGVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlByb3h5QXVkaW9QbHVnaW4gPSBleHBvcnRzLlBvc3RNZXNzYWdlQXVkaW9QbHVnaW4gPSBleHBvcnRzLldlYkF1ZGlvUGx1Z2luID0gZXhwb3J0cy5IVE1MQXVkaW9QbHVnaW4gPSBleHBvcnRzLkF1ZGlvUGx1Z2luUmVnaXN0cnkgPSBleHBvcnRzLmcgPSBleHBvcnRzLlJlc291cmNlRmFjdG9yeSA9IGV4cG9ydHMuUGxhdGZvcm0gPSB2b2lkIDA7XG52YXIgUGxhdGZvcm1fMSA9IHJlcXVpcmUoXCIuL1BsYXRmb3JtXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiUGxhdGZvcm1cIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFBsYXRmb3JtXzEuUGxhdGZvcm07IH0gfSk7XG52YXIgUmVzb3VyY2VGYWN0b3J5XzEgPSByZXF1aXJlKFwiLi9SZXNvdXJjZUZhY3RvcnlcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJSZXNvdXJjZUZhY3RvcnlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFJlc291cmNlRmFjdG9yeV8xLlJlc291cmNlRmFjdG9yeTsgfSB9KTtcbi8vIGFrYXNoaWMtZW5naW5l5YaF6YOo44GncmVzb3VyY2XjgpLkvb/jgYjjgovjgojjgYbjgavliJ3mnJ/oqK3lrppcbnZhciBnID0gcmVxdWlyZShcIkBha2FzaGljL2FrYXNoaWMtZW5naW5lXCIpO1xuZXhwb3J0cy5nID0gZztcbnZhciBBdWRpb1BsdWdpblJlZ2lzdHJ5XzEgPSByZXF1aXJlKFwiLi9wbHVnaW4vQXVkaW9QbHVnaW5SZWdpc3RyeVwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkF1ZGlvUGx1Z2luUmVnaXN0cnlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIEF1ZGlvUGx1Z2luUmVnaXN0cnlfMS5BdWRpb1BsdWdpblJlZ2lzdHJ5OyB9IH0pO1xudmFyIEF1ZGlvUGx1Z2luTWFuYWdlcl8xID0gcmVxdWlyZShcIi4vcGx1Z2luL0F1ZGlvUGx1Z2luTWFuYWdlclwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkF1ZGlvUGx1Z2luTWFuYWdlclwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gQXVkaW9QbHVnaW5NYW5hZ2VyXzEuQXVkaW9QbHVnaW5NYW5hZ2VyOyB9IH0pO1xuLy8gVE9ETzogQXVkaW8gUGx1Z2lu44Gu5a6f5oWL44Gv5Yil44Oq44Od44K444OI44Oq44Gr5YiH44KK5Ye644GZ5LqL44KS5qSc6KiO44GZ44KLXG52YXIgSFRNTEF1ZGlvUGx1Z2luXzEgPSByZXF1aXJlKFwiLi9wbHVnaW4vSFRNTEF1ZGlvUGx1Z2luL0hUTUxBdWRpb1BsdWdpblwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkhUTUxBdWRpb1BsdWdpblwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gSFRNTEF1ZGlvUGx1Z2luXzEuSFRNTEF1ZGlvUGx1Z2luOyB9IH0pO1xudmFyIFdlYkF1ZGlvUGx1Z2luXzEgPSByZXF1aXJlKFwiLi9wbHVnaW4vV2ViQXVkaW9QbHVnaW4vV2ViQXVkaW9QbHVnaW5cIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJXZWJBdWRpb1BsdWdpblwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gV2ViQXVkaW9QbHVnaW5fMS5XZWJBdWRpb1BsdWdpbjsgfSB9KTtcbi8vIFRPRE8g5YmK6Zmk44CC6Kqw44KC5L2/44Gj44Gm44GE44Gq44GEXG52YXIgUG9zdE1lc3NhZ2VBdWRpb1BsdWdpbl8xID0gcmVxdWlyZShcIi4vcGx1Z2luL1Bvc3RNZXNzYWdlQXVkaW9QbHVnaW4vUG9zdE1lc3NhZ2VBdWRpb1BsdWdpblwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlBvc3RNZXNzYWdlQXVkaW9QbHVnaW5cIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFBvc3RNZXNzYWdlQXVkaW9QbHVnaW5fMS5Qb3N0TWVzc2FnZUF1ZGlvUGx1Z2luOyB9IH0pO1xudmFyIFByb3h5QXVkaW9QbHVnaW5fMSA9IHJlcXVpcmUoXCIuL3BsdWdpbi9Qcm94eUF1ZGlvUGx1Z2luL1Byb3h5QXVkaW9QbHVnaW5cIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJQcm94eUF1ZGlvUGx1Z2luXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBQcm94eUF1ZGlvUGx1Z2luXzEuUHJveHlBdWRpb1BsdWdpbjsgfSB9KTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5BdWRpb1BsdWdpbk1hbmFnZXIgPSB2b2lkIDA7XG4vKlxuIEF1ZGlv44OX44Op44Kw44Kk44Oz44KS55m76Yyy44GX44CB54++5Zyo55m76Yyy44GX44Gm44GE44KL44OX44Op44Kw44Kk44Oz44KS566h55CG44GZ44KL44Kv44Op44K5XG5cbiBUT0RPOiDlkIRHYW1l44Kk44Oz44K544K/44Oz44K544GM5LiA44Gk44GuQXVkaW/jg5fjg6njgrDjgqTjg7PjgZfjgYvmjIHjgZ/jgarjgYTjga7jgafjgIFcbiBQbHVnaW5NYW5hZ2Vy44GM54q25oWL44KS44KC44Gf44Ga44GrR2FtZeiHquS9k+OBq3BsdWdpbuOCkueZu+mMsuOBmeOCi+aWueW8j+OCguOBguOCilxuICovXG52YXIgQXVkaW9QbHVnaW5NYW5hZ2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEF1ZGlvUGx1Z2luTWFuYWdlcigpIHtcbiAgICAgICAgdGhpcy5fYWN0aXZlUGx1Z2luID0gbnVsbDtcbiAgICB9XG4gICAgQXVkaW9QbHVnaW5NYW5hZ2VyLnByb3RvdHlwZS5nZXRBY3RpdmVQbHVnaW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmVQbHVnaW47XG4gICAgfTtcbiAgICAvLyBBdWRpb+ODl+ODqeOCsOOCpOODs+OBq+eZu+mMsuOCkuihjOOBhOOAgeOBqeOCjOOBi+S4gOOBpOOBp+OCguaIkOWKn+OBquOCiXRydWXjgIHjgZ3jgozku6XlpJbjga9mYWxzZeOCkui/lOOBmVxuICAgIEF1ZGlvUGx1Z2luTWFuYWdlci5wcm90b3R5cGUudHJ5SW5zdGFsbFBsdWdpbiA9IGZ1bmN0aW9uIChwbHVnaW5zKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwbHVnaW5zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgcCA9IHBsdWdpbnNbaV07XG4gICAgICAgICAgICBpZiAocC5pc1N1cHBvcnRlZCkge1xuICAgICAgICAgICAgICAgIHZhciBQbHVnaW5Db25zdHJ1Y3RvciA9IHA7XG4gICAgICAgICAgICAgICAgaWYgKFBsdWdpbkNvbnN0cnVjdG9yLmlzU3VwcG9ydGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlUGx1Z2luID0gbmV3IFBsdWdpbkNvbnN0cnVjdG9yKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZVBsdWdpbiA9IHA7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgcmV0dXJuIEF1ZGlvUGx1Z2luTWFuYWdlcjtcbn0oKSk7XG5leHBvcnRzLkF1ZGlvUGx1Z2luTWFuYWdlciA9IEF1ZGlvUGx1Z2luTWFuYWdlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5BdWRpb1BsdWdpblJlZ2lzdHJ5ID0gdm9pZCAwO1xudmFyIGF1ZGlvUGx1Z2lucyA9IFtdO1xuZXhwb3J0cy5BdWRpb1BsdWdpblJlZ2lzdHJ5ID0ge1xuICAgIGFkZFBsdWdpbjogZnVuY3Rpb24gKHBsdWdpbikge1xuICAgICAgICBpZiAoYXVkaW9QbHVnaW5zLmluZGV4T2YocGx1Z2luKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIGF1ZGlvUGx1Z2lucy5wdXNoKHBsdWdpbik7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGdldFJlZ2lzdGVyZWRBdWRpb1BsdWdpbnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGF1ZGlvUGx1Z2lucztcbiAgICB9LFxuICAgIGNsZWFyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGF1ZGlvUGx1Z2lucyA9IFtdO1xuICAgIH1cbn07XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5IVE1MQXVkaW9Bc3NldCA9IHZvaWQgMDtcbnZhciBnID0gcmVxdWlyZShcIkBha2FzaGljL2FrYXNoaWMtZW5naW5lXCIpO1xudmFyIEhUTUxBdWRpb0Fzc2V0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhIVE1MQXVkaW9Bc3NldCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBIVE1MQXVkaW9Bc3NldCgpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgIH1cbiAgICBIVE1MQXVkaW9Bc3NldC5wcm90b3R5cGUuX2xvYWQgPSBmdW5jdGlvbiAobG9hZGVyKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICh0aGlzLnBhdGggPT0gbnVsbCkge1xuICAgICAgICAgICAgLy8g5YaN55Sf5Y+v6IO944Gq5b2i5byP44GM44Gq44GE44CC5a6f6Zqb44Gr44Gv6bO044KJ44Gq44GE6Z+z5aOw44Go44GX44Gm44Ot44O844OJ5oiQ5Yqf44GX44Gm44GK44GPXG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBudWxsO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBsb2FkZXIuX29uQXNzZXRMb2FkKF90aGlzKTsgfSwgMCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGF1ZGlvID0gbmV3IEF1ZGlvKCk7XG4gICAgICAgIHZhciBzdGFydExvYWRpbmdBdWRpbyA9IGZ1bmN0aW9uIChwYXRoLCBoYW5kbGVycykge1xuICAgICAgICAgICAgLy8gYXV0b3BsYXkg44GvIHByZWxvYWQg44KI44KK44KC5YSq5YWI44GV44KM44KL44Gf44KB5piO56S655qE44GrZmFsc2XjgajjgZnjgotcbiAgICAgICAgICAgIGF1ZGlvLmF1dG9wbGF5ID0gZmFsc2U7XG4gICAgICAgICAgICBhdWRpby5wcmVsb2FkID0gXCJub25lXCI7XG4gICAgICAgICAgICBhdWRpby5zcmMgPSBwYXRoO1xuICAgICAgICAgICAgX3RoaXMuX2F0dGFjaEFsbChhdWRpbywgaGFuZGxlcnMpO1xuICAgICAgICAgICAgLyogdHNsaW50OmRpc2FibGUgKi9cbiAgICAgICAgICAgIC8vIEZpcmVmb3jjga9wcmVsb2FkPVwiYXV0b1wi44Gn44Gq44GE44Go6Kqt44G/6L6844G/44GV44KM44Gq44GEXG4gICAgICAgICAgICAvLyBwcmVsb2Fk44Gv44OW44Op44Km44K244Gr5a++44GZ44KLSGludOWxnuaAp+OBquOBruOBp+OAgeOBqeOBhuaJseOBhuOBi+OBr+ODluODqeOCpuOCtuOBruWun+ijheasoeesrOOBqOOBquOCi1xuICAgICAgICAgICAgLy8gaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvZW1iZWRkZWQtY29udGVudC5odG1sI2F0dHItbWVkaWEtcHJlbG9hZFxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvamEvZG9jcy9XZWIvSFRNTC9FbGVtZW50L2F1ZGlvI2F0dHItcHJlbG9hZFxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL0NyZWF0ZUpTL1NvdW5kSlMvYmxvYi9lMmQ0ODQyYTg0ZmY0MjVhZGE4NjFlZGI5ZjZlOWI1N2Y2M2Q3Y2FmL3NyYy9zb3VuZGpzL2h0bWxhdWRpby9IVE1MQXVkaW9Tb3VuZEluc3RhbmNlLmpzI0wxNDctMTQ3XG4gICAgICAgICAgICAvKiB0c2xpbnQ6ZW5hYmxlOm1heC1saW5lLWxlbmd0aCAqL1xuICAgICAgICAgICAgYXVkaW8ucHJlbG9hZCA9IFwiYXV0b1wiO1xuICAgICAgICAgICAgc2V0QXVkaW9Mb2FkSW50ZXJ2YWwoYXVkaW8sIGhhbmRsZXJzKTtcbiAgICAgICAgICAgIGF1ZGlvLmxvYWQoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGhhbmRsZXJzID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF90aGlzLl9kZXRhY2hBbGwoYXVkaW8sIGhhbmRsZXJzKTtcbiAgICAgICAgICAgICAgICBfdGhpcy5kYXRhID0gYXVkaW87XG4gICAgICAgICAgICAgICAgbG9hZGVyLl9vbkFzc2V0TG9hZChfdGhpcyk7XG4gICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoX3RoaXMuX2ludGVydmFsSWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX2RldGFjaEFsbChhdWRpbywgaGFuZGxlcnMpO1xuICAgICAgICAgICAgICAgIF90aGlzLmRhdGEgPSBhdWRpbztcbiAgICAgICAgICAgICAgICBsb2FkZXIuX29uQXNzZXRFcnJvcihfdGhpcywgZy5FeGNlcHRpb25GYWN0b3J5LmNyZWF0ZUFzc2V0TG9hZEVycm9yKFwiSFRNTEF1ZGlvQXNzZXQgbG9hZGluZyBlcnJvclwiKSk7XG4gICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoX3RoaXMuX2ludGVydmFsSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB2YXIgc2V0QXVkaW9Mb2FkSW50ZXJ2YWwgPSBmdW5jdGlvbiAoYXVkaW8sIGhhbmRsZXJzKSB7XG4gICAgICAgICAgICAvLyBJRTEx44Gr44GK44GE44Gm44CBY2FucGxheXRocm91Z2jjgqTjg5njg7Pjg4jjgYzmraPluLjjgavnmbrngavjgZfjgarjgYTllY/poYzjgYznorroqo3jgZXjgozjgZ/jgZ/jgoHjgIHjgZ3jga7lr77lh6bjgajjgZfjgabku6XkuIvjga7lh6bnkIbjgpLooYzjgaPjgabjgYTjgovjgIJcbiAgICAgICAgICAgIC8vIOOBquOBiuOAgWNhbnBsYXl0aHJvdWdo44GvcmVhZHlTdGF0ZeOBruWApOOBjDTjgavjgarjgaPjgZ/mmYLngrnjgaflkbzjgbPlh7rjgZXjgozjgovjgqTjg5njg7Pjg4jjgafjgYLjgovjgIJcbiAgICAgICAgICAgIC8vIOOCpOODs+OCv+ODvOODkOODq+OBqOOBl+OBpuaMh+WumuOBl+OBpuOBhOOCizEwMG1z44Gr5qC55oug44Gv54Sh44GE44CCXG4gICAgICAgICAgICBfdGhpcy5faW50ZXJ2YWxDb3VudCA9IDA7XG4gICAgICAgICAgICBfdGhpcy5faW50ZXJ2YWxJZCA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKGF1ZGlvLnJlYWR5U3RhdGUgPT09IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlcnMuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgKytfdGhpcy5faW50ZXJ2YWxDb3VudDtcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVhZHlTdGF0ZeOBruWApOOBjDTjgavjgarjgonjgarjgYTnirbmhYvjgYwx5YiG77yIMTAwbXPDlzYwMO+8iee2muOBhOOBn+WgtOWQiOOAgVxuICAgICAgICAgICAgICAgICAgICAvLyDoqq3jgb/ovrzjgb/jgavlpLHmlZfjgZfjgZ/jgajjgZnjgovjgIIx5YiG44Go44GE44GG5pmC6ZaT44Gr5qC55oug44Gv54Sh44GE44CCXG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5faW50ZXJ2YWxDb3VudCA9PT0gNjAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVycy5lcnJvcigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgfTtcbiAgICAgICAgLy8g5pqr5a6a5a++5b+c77ya5b6M5pa55LqS5o+b5oCn44Gu44Gf44KB44CBYWFj44OV44Kh44Kk44Or44GM54Sh44GE5aC05ZCI44GvbXA044G444Gu44OV44Kp44O844Or44OQ44OD44Kv44KS6Kmm44G/44KL44CCXG4gICAgICAgIC8vIOOBk+OBruWvvuW/nOOCkuatouOCgeOCi+mam+OBq+OBr+OAgUhUTUxBdWRpb1BsdWdpbuOBrnN1cHBvcnRlZEV4dGVuc2lvbnPjgYvjgolhYWPjgpLpmaTlpJbjgZnjgovlv4XopoHjgYzjgYLjgovjgIJcbiAgICAgICAgdmFyIGRlbEluZGV4ID0gdGhpcy5wYXRoLmluZGV4T2YoXCI/XCIpO1xuICAgICAgICB2YXIgYmFzZVBhdGggPSBkZWxJbmRleCA+PSAwID8gdGhpcy5wYXRoLnN1YnN0cmluZygwLCBkZWxJbmRleCkgOiB0aGlzLnBhdGg7XG4gICAgICAgIGlmIChiYXNlUGF0aC5zbGljZSgtNCkgPT09IFwiLmFhY1wiICYmIEhUTUxBdWRpb0Fzc2V0LnN1cHBvcnRlZEZvcm1hdHMuaW5kZXhPZihcIm1wNFwiKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIHZhciBhbHRIYW5kbGVycyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBoYW5kbGVycy5zdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl9kZXRhY2hBbGwoYXVkaW8sIGFsdEhhbmRsZXJzKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoX3RoaXMuX2ludGVydmFsSWQpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5wYXRoID0gZy5QYXRoVXRpbC5hZGRFeHRuYW1lKF90aGlzLm9yaWdpbmFsUGF0aCwgXCJtcDRcIik7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0TG9hZGluZ0F1ZGlvKF90aGlzLnBhdGgsIGhhbmRsZXJzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgc3RhcnRMb2FkaW5nQXVkaW8odGhpcy5wYXRoLCBhbHRIYW5kbGVycyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc3RhcnRMb2FkaW5nQXVkaW8odGhpcy5wYXRoLCBoYW5kbGVycyk7XG4gICAgfTtcbiAgICBIVE1MQXVkaW9Bc3NldC5wcm90b3R5cGUuY2xvbmVFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhID8gbmV3IEF1ZGlvKHRoaXMuZGF0YS5zcmMpIDogbnVsbDtcbiAgICB9O1xuICAgIEhUTUxBdWRpb0Fzc2V0LnByb3RvdHlwZS5fYXNzZXRQYXRoRmlsdGVyID0gZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgaWYgKEhUTUxBdWRpb0Fzc2V0LnN1cHBvcnRlZEZvcm1hdHMuaW5kZXhPZihcIm9nZ1wiKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBnLlBhdGhVdGlsLmFkZEV4dG5hbWUocGF0aCwgXCJvZ2dcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKEhUTUxBdWRpb0Fzc2V0LnN1cHBvcnRlZEZvcm1hdHMuaW5kZXhPZihcImFhY1wiKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBnLlBhdGhVdGlsLmFkZEV4dG5hbWUocGF0aCwgXCJhYWNcIik7XG4gICAgICAgIH1cbiAgICAgICAgLy8g44GT44GT44Gn5qSc5Ye644GV44KM44KL44Gu44Gv5pyA5Yid44Gr44Ki44Kv44K744K544KS6Kmm44G/44KL44Kq44O844OH44Kj44Kq44Ki44K744OD44OI44Gu44OV44Kh44Kk44Or44OR44K544Gq44Gu44Gn44CBXG4gICAgICAgIC8vIHN1cHBvcnRlZEZvcm1hdHPjgaso5b6M5pa55LqS5o+b5oCn5L+d5oyB44Gn5L2/44GG5Y+v6IO95oCn44GM44GC44KLKW1wNOOBjOWQq+OBvuOCjOOBpuOBhOOBpuOCguWIqeeUqOOBl+OBquOBhFxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuICAgIEhUTUxBdWRpb0Fzc2V0LnByb3RvdHlwZS5fYXR0YWNoQWxsID0gZnVuY3Rpb24gKGF1ZGlvLCBoYW5kbGVycykge1xuICAgICAgICBpZiAoaGFuZGxlcnMuc3VjY2Vzcykge1xuICAgICAgICAgICAgLyogdHNsaW50OmRpc2FibGU6bWF4LWxpbmUtbGVuZ3RoICovXG4gICAgICAgICAgICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9FdmVudHMvY2FucGxheXRocm91Z2hcbiAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9nb2xkZmlyZS9ob3dsZXIuanMvYmxvYi8xZGFkMjVjZGQ5ZDY5ODIyMzIwNTA0NTRlOGI0NTQxMTkwMmVmZTY1L2hvd2xlci5qcyNMMzcyXG4gICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vQ3JlYXRlSlMvU291bmRKUy9ibG9iL2UyZDQ4NDJhODRmZjQyNWFkYTg2MWVkYjlmNmU5YjU3ZjYzZDdjYWYvc3JjL3NvdW5kanMvaHRtbGF1ZGlvL0hUTUxBdWRpb1NvdW5kSW5zdGFuY2UuanMjTDE0NS0xNDVcbiAgICAgICAgICAgIC8qIHRzbGludDplbmFibGU6bWF4LWxpbmUtbGVuZ3RoICovXG4gICAgICAgICAgICBhdWRpby5hZGRFdmVudExpc3RlbmVyKFwiY2FucGxheXRocm91Z2hcIiwgaGFuZGxlcnMuc3VjY2VzcywgZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChoYW5kbGVycy5lcnJvcikge1xuICAgICAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvR3VpZGUvRXZlbnRzL01lZGlhX2V2ZW50c1xuICAgICAgICAgICAgLy8gc3RhbGxlZOOBr2ZldGNo44GX44Gm5Y+W44KM44Gq44GL44Gj44Gf5pmC44Gr6LW344GN44KL44Kk44OZ44Oz44OIXG4gICAgICAgICAgICBhdWRpby5hZGRFdmVudExpc3RlbmVyKFwic3RhbGxlZFwiLCBoYW5kbGVycy5lcnJvciwgZmFsc2UpO1xuICAgICAgICAgICAgYXVkaW8uYWRkRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsIGhhbmRsZXJzLmVycm9yLCBmYWxzZSk7XG4gICAgICAgICAgICBhdWRpby5hZGRFdmVudExpc3RlbmVyKFwiYWJvcnRcIiwgaGFuZGxlcnMuZXJyb3IsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSFRNTEF1ZGlvQXNzZXQucHJvdG90eXBlLl9kZXRhY2hBbGwgPSBmdW5jdGlvbiAoYXVkaW8sIGhhbmRsZXJzKSB7XG4gICAgICAgIGlmIChoYW5kbGVycy5zdWNjZXNzKSB7XG4gICAgICAgICAgICBhdWRpby5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2FucGxheXRocm91Z2hcIiwgaGFuZGxlcnMuc3VjY2VzcywgZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChoYW5kbGVycy5lcnJvcikge1xuICAgICAgICAgICAgYXVkaW8ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN0YWxsZWRcIiwgaGFuZGxlcnMuZXJyb3IsIGZhbHNlKTtcbiAgICAgICAgICAgIGF1ZGlvLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLCBoYW5kbGVycy5lcnJvciwgZmFsc2UpO1xuICAgICAgICAgICAgYXVkaW8ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImFib3J0XCIsIGhhbmRsZXJzLmVycm9yLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBIVE1MQXVkaW9Bc3NldDtcbn0oZy5BdWRpb0Fzc2V0KSk7XG5leHBvcnRzLkhUTUxBdWRpb0Fzc2V0ID0gSFRNTEF1ZGlvQXNzZXQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbi8vLyBjaHJvbWU2NuS7pemZjeOBquOBqeOBruODluODqeOCpuOCtuOBq+WwjuWFpeOBleOCjOOCi0F1dG9wbGF5IFBvbGljeeOBq+WvvuW/nOOBmeOCi1xuLy8gaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vd2ViL3VwZGF0ZXMvMjAxNy8wOS9hdXRvcGxheS1wb2xpY3ktY2hhbmdlc1xudmFyIHN0YXRlID0gMCAvKiBVbmtub3duICovO1xudmFyIHN1c3BlbmRlZEF1ZGlvRWxlbWVudHMgPSBbXTtcbnZhciBIVE1MQXVkaW9BdXRvcGxheUhlbHBlcjtcbihmdW5jdGlvbiAoSFRNTEF1ZGlvQXV0b3BsYXlIZWxwZXIpIHtcbiAgICBmdW5jdGlvbiBzZXR1cENocm9tZU1FSVdvcmthcm91bmQoYXVkaW8pIHtcbiAgICAgICAgZnVuY3Rpb24gcGxheUhhbmRsZXIoKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHN0YXRlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwIC8qIFVua25vd24gKi86XG4gICAgICAgICAgICAgICAgY2FzZSAxIC8qIFdhaXRpbmdJbnRlcmFjdGlvbiAqLzogLy8g6YCa5bi444Gu44Kx44O844K544Gn44Gv44GT44GT44Gr44Gv5Yiw6YGU44GX44Gq44GE44GM44CB5L2V44KJ44GL44Gu5aSW5Zug44Gr44KI44Gj44Gm6Z+z44KS6bO044KJ44GZ44GT44Go44GM44Gn44GN44Gf5aC05ZCIXG4gICAgICAgICAgICAgICAgICAgIHBsYXlTdXNwZW5kZWRBdWRpb0VsZW1lbnRzKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMiAvKiBSZWFkeSAqLzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAvLyBkbyBub3RoaW5nXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdGF0ZSA9IDIgLyogUmVhZHkgKi87XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHN1c3BlbmRlZEhhbmRsZXIoKSB7XG4gICAgICAgICAgICBhdWRpby5yZW1vdmVFdmVudExpc3RlbmVyKFwicGxheVwiLCBwbGF5SGFuZGxlcik7XG4gICAgICAgICAgICBzd2l0Y2ggKHN0YXRlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwIC8qIFVua25vd24gKi86XG4gICAgICAgICAgICAgICAgICAgIHN1c3BlbmRlZEF1ZGlvRWxlbWVudHMucHVzaChhdWRpbyk7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlID0gMSAvKiBXYWl0aW5nSW50ZXJhY3Rpb24gKi87XG4gICAgICAgICAgICAgICAgICAgIHNldFVzZXJJbnRlcmFjdExpc3RlbmVyKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMSAvKiBXYWl0aW5nSW50ZXJhY3Rpb24gKi86XG4gICAgICAgICAgICAgICAgICAgIHN1c3BlbmRlZEF1ZGlvRWxlbWVudHMucHVzaChhdWRpbyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMiAvKiBSZWFkeSAqLzpcbiAgICAgICAgICAgICAgICAgICAgYXVkaW8ucGxheSgpOyAvLyBzdXNwZW5kZWRIYW5kbGVyIOOBjOWRvOOBsOOCjOOCi+OBvuOBp+OBq+mfs+OBjOmztOOCieOBm+OCi+OCiOOBhuOBq+OBquOBo+OBn+WgtOWQiFxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIC8vIGRvIG5vdGhpbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoIChzdGF0ZSkge1xuICAgICAgICAgICAgY2FzZSAwIC8qIFVua25vd24gKi86XG4gICAgICAgICAgICAgICAgYXVkaW8uYWRkRXZlbnRMaXN0ZW5lcihcInBsYXlcIiwgcGxheUhhbmRsZXIsIHRydWUpO1xuICAgICAgICAgICAgICAgIHZhciB0aW1lciA9IHNldFRpbWVvdXQoc3VzcGVuZGVkSGFuZGxlciwgMTAwKTsgLy8g5piO56K644Gq5qC55oug44Gv44Gq44GE44GMMTAwbXNlY+W+heOBo+OBpuOCgnBsYXnjgZXjgozjgarjgZHjgozjgbDlho3nlJ/jgafjgY3jgarjgYTjgajliKTmlq3jgZnjgotcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMSAvKiBXYWl0aW5nSW50ZXJhY3Rpb24gKi86XG4gICAgICAgICAgICAgICAgc3VzcGVuZGVkQXVkaW9FbGVtZW50cy5wdXNoKGF1ZGlvKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMiAvKiBSZWFkeSAqLzpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAvLyBkbyBub3RoaW5nXG4gICAgICAgIH1cbiAgICB9XG4gICAgSFRNTEF1ZGlvQXV0b3BsYXlIZWxwZXIuc2V0dXBDaHJvbWVNRUlXb3JrYXJvdW5kID0gc2V0dXBDaHJvbWVNRUlXb3JrYXJvdW5kO1xufSkoSFRNTEF1ZGlvQXV0b3BsYXlIZWxwZXIgfHwgKEhUTUxBdWRpb0F1dG9wbGF5SGVscGVyID0ge30pKTtcbmZ1bmN0aW9uIHJlc3VtZUhhbmRsZXIoKSB7XG4gICAgcGxheVN1c3BlbmRlZEF1ZGlvRWxlbWVudHMoKTtcbiAgICBjbGVhclVzZXJJbnRlcmFjdExpc3RlbmVyKCk7XG59XG5mdW5jdGlvbiBzZXRVc2VySW50ZXJhY3RMaXN0ZW5lcigpIHtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCByZXN1bWVIYW5kbGVyLCB0cnVlKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHJlc3VtZUhhbmRsZXIsIHRydWUpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCByZXN1bWVIYW5kbGVyLCB0cnVlKTtcbn1cbmZ1bmN0aW9uIGNsZWFyVXNlckludGVyYWN0TGlzdGVuZXIoKSB7XG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgcmVzdW1lSGFuZGxlcik7XG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCByZXN1bWVIYW5kbGVyKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgcmVzdW1lSGFuZGxlcik7XG59XG5mdW5jdGlvbiBwbGF5U3VzcGVuZGVkQXVkaW9FbGVtZW50cygpIHtcbiAgICBzdGF0ZSA9IDIgLyogUmVhZHkgKi87XG4gICAgc3VzcGVuZGVkQXVkaW9FbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChhdWRpbykgeyByZXR1cm4gYXVkaW8ucGxheSgpOyB9KTtcbiAgICBzdXNwZW5kZWRBdWRpb0VsZW1lbnRzID0gW107XG59XG5tb2R1bGUuZXhwb3J0cyA9IEhUTUxBdWRpb0F1dG9wbGF5SGVscGVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuSFRNTEF1ZGlvUGxheWVyID0gdm9pZCAwO1xudmFyIGcgPSByZXF1aXJlKFwiQGFrYXNoaWMvYWthc2hpYy1lbmdpbmVcIik7XG52YXIgYXV0b1BsYXlIZWxwZXIgPSByZXF1aXJlKFwiLi9IVE1MQXVkaW9BdXRvcGxheUhlbHBlclwiKTtcbnZhciBIVE1MQXVkaW9QbGF5ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEhUTUxBdWRpb1BsYXllciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBIVE1MQXVkaW9QbGF5ZXIoc3lzdGVtLCBtYW5hZ2VyKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHN5c3RlbSkgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX21hbmFnZXIgPSBtYW5hZ2VyO1xuICAgICAgICBfdGhpcy5fZW5kZWRFdmVudEhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5fb25BdWRpb0VuZGVkKCk7XG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLl9vblBsYXlFdmVudEhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5fb25QbGF5RXZlbnQoKTtcbiAgICAgICAgfTtcbiAgICAgICAgX3RoaXMuX2R1bW15RHVyYXRpb25XYWl0VGltZXIgPSBudWxsO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIEhUTUxBdWRpb1BsYXllci5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uIChhc3NldCkge1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50QXVkaW8pIHtcbiAgICAgICAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBhdWRpbyA9IGFzc2V0LmNsb25lRWxlbWVudCgpO1xuICAgICAgICBpZiAoYXVkaW8pIHtcbiAgICAgICAgICAgIGF1dG9QbGF5SGVscGVyLnNldHVwQ2hyb21lTUVJV29ya2Fyb3VuZChhdWRpbyk7XG4gICAgICAgICAgICBhdWRpby52b2x1bWUgPSB0aGlzLl9jYWxjdWxhdGVWb2x1bWUoKTtcbiAgICAgICAgICAgIGF1ZGlvLnBsYXkoKS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7IH0pO1xuICAgICAgICAgICAgYXVkaW8ubG9vcCA9IGFzc2V0Lmxvb3A7XG4gICAgICAgICAgICBhdWRpby5hZGRFdmVudExpc3RlbmVyKFwiZW5kZWRcIiwgdGhpcy5fZW5kZWRFdmVudEhhbmRsZXIsIGZhbHNlKTtcbiAgICAgICAgICAgIGF1ZGlvLmFkZEV2ZW50TGlzdGVuZXIoXCJwbGF5XCIsIHRoaXMuX29uUGxheUV2ZW50SGFuZGxlciwgZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy5faXNXYWl0aW5nUGxheUV2ZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuX2F1ZGlvSW5zdGFuY2UgPSBhdWRpbztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIOWGjeeUn+OBp+OBjeOCi+OCquODvOODh+OCo+OCquOBjOOBquOBhOWgtOWQiOOAgmR1cmF0aW9u5b6M44Gr5YGc5q2i5Yem55CG44Gg44GR6KGM44GGKOWHpueQhuOBruOBv+mAsuOCgemfs+OBr+mztOOCieOBleOBquOBhClcbiAgICAgICAgICAgIHRoaXMuX2R1bW15RHVyYXRpb25XYWl0VGltZXIgPSBzZXRUaW1lb3V0KHRoaXMuX2VuZGVkRXZlbnRIYW5kbGVyLCBhc3NldC5kdXJhdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5wbGF5LmNhbGwodGhpcywgYXNzZXQpO1xuICAgIH07XG4gICAgSFRNTEF1ZGlvUGxheWVyLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuY3VycmVudEF1ZGlvKSB7XG4gICAgICAgICAgICBfc3VwZXIucHJvdG90eXBlLnN0b3AuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jbGVhckVuZGVkRXZlbnRIYW5kbGVyKCk7XG4gICAgICAgIGlmICh0aGlzLl9hdWRpb0luc3RhbmNlKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2lzV2FpdGluZ1BsYXlFdmVudCkge1xuICAgICAgICAgICAgICAgIC8vIF9hdWRpb0luc3RhbmNlIOOBjOWGjeOBsyBwbGF5IOOBleOCjOOCi+OBk+OBqOOBr+eEoeOBhOOBruOBp+OAgSByZW1vdmVFdmVudExpc3RlbmVyKFwicGxheVwiKSDjgZnjgovlv4XopoHjga/nhKHjgYRcbiAgICAgICAgICAgICAgICB0aGlzLl9hdWRpb0luc3RhbmNlLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fYXVkaW9JbnN0YW5jZSA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pc1N0b3BSZXF1ZXN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuc3RvcC5jYWxsKHRoaXMpO1xuICAgIH07XG4gICAgSFRNTEF1ZGlvUGxheWVyLnByb3RvdHlwZS5jaGFuZ2VWb2x1bWUgPSBmdW5jdGlvbiAodm9sdW1lKSB7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuY2hhbmdlVm9sdW1lLmNhbGwodGhpcywgdm9sdW1lKTtcbiAgICAgICAgaWYgKHRoaXMuX2F1ZGlvSW5zdGFuY2UpIHtcbiAgICAgICAgICAgIHRoaXMuX2F1ZGlvSW5zdGFuY2Uudm9sdW1lID0gdGhpcy5fY2FsY3VsYXRlVm9sdW1lKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEhUTUxBdWRpb1BsYXllci5wcm90b3R5cGUuX2NoYW5nZU11dGVkID0gZnVuY3Rpb24gKG11dGVkKSB7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuX2NoYW5nZU11dGVkLmNhbGwodGhpcywgbXV0ZWQpO1xuICAgICAgICBpZiAodGhpcy5fYXVkaW9JbnN0YW5jZSkge1xuICAgICAgICAgICAgdGhpcy5fYXVkaW9JbnN0YW5jZS52b2x1bWUgPSB0aGlzLl9jYWxjdWxhdGVWb2x1bWUoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSFRNTEF1ZGlvUGxheWVyLnByb3RvdHlwZS5ub3RpZnlNYXN0ZXJWb2x1bWVDaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fYXVkaW9JbnN0YW5jZSkge1xuICAgICAgICAgICAgdGhpcy5fYXVkaW9JbnN0YW5jZS52b2x1bWUgPSB0aGlzLl9jYWxjdWxhdGVWb2x1bWUoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSFRNTEF1ZGlvUGxheWVyLnByb3RvdHlwZS5fb25BdWRpb0VuZGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9jbGVhckVuZGVkRXZlbnRIYW5kbGVyKCk7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuc3RvcC5jYWxsKHRoaXMpO1xuICAgIH07XG4gICAgSFRNTEF1ZGlvUGxheWVyLnByb3RvdHlwZS5fY2xlYXJFbmRlZEV2ZW50SGFuZGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2F1ZGlvSW5zdGFuY2UpXG4gICAgICAgICAgICB0aGlzLl9hdWRpb0luc3RhbmNlLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJlbmRlZFwiLCB0aGlzLl9lbmRlZEV2ZW50SGFuZGxlciwgZmFsc2UpO1xuICAgICAgICBpZiAodGhpcy5fZHVtbXlEdXJhdGlvbldhaXRUaW1lciAhPSBudWxsKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fZHVtbXlEdXJhdGlvbldhaXRUaW1lcik7XG4gICAgICAgICAgICB0aGlzLl9kdW1teUR1cmF0aW9uV2FpdFRpbWVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLy8gYXVkaW8ucGxheSgpIOOBr+mdnuWQjOacn+OBquOBruOBp+OAgSBwbGF5IOOBjOmWi+Wni+OBleOCjOOCi+WJjeOBqyBzdG9wIOOCkuWRvOOBsOOCjOOBn+WgtOWQiOOBr+OBk+OBruODj+ODs+ODieODqeWIsOmBlOaZguOBq+WBnOatouOBmeOCi1xuICAgIEhUTUxBdWRpb1BsYXllci5wcm90b3R5cGUuX29uUGxheUV2ZW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2lzV2FpdGluZ1BsYXlFdmVudClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy5faXNXYWl0aW5nUGxheUV2ZW50ID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLl9pc1N0b3BSZXF1ZXN0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX2lzU3RvcFJlcXVlc3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgLy8gX2F1ZGlvSW5zdGFuY2Ug44GM5YaN44GzIHBsYXkg44GV44KM44KL44GT44Go44Gv54Sh44GE44Gu44Gn44CBIHJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwbGF5XCIpIOOBmeOCi+W/heimgeOBr+eEoeOBhFxuICAgICAgICAgICAgdGhpcy5fYXVkaW9JbnN0YW5jZS5wYXVzZSgpO1xuICAgICAgICAgICAgdGhpcy5fYXVkaW9JbnN0YW5jZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEhUTUxBdWRpb1BsYXllci5wcm90b3R5cGUuX2NhbGN1bGF0ZVZvbHVtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX211dGVkID8gMCA6IHRoaXMudm9sdW1lICogdGhpcy5fc3lzdGVtLnZvbHVtZSAqIHRoaXMuX21hbmFnZXIuZ2V0TWFzdGVyVm9sdW1lKCk7XG4gICAgfTtcbiAgICByZXR1cm4gSFRNTEF1ZGlvUGxheWVyO1xufShnLkF1ZGlvUGxheWVyKSk7XG5leHBvcnRzLkhUTUxBdWRpb1BsYXllciA9IEhUTUxBdWRpb1BsYXllcjtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5IVE1MQXVkaW9QbHVnaW4gPSB2b2lkIDA7XG52YXIgSFRNTEF1ZGlvQXNzZXRfMSA9IHJlcXVpcmUoXCIuL0hUTUxBdWRpb0Fzc2V0XCIpO1xudmFyIEhUTUxBdWRpb1BsYXllcl8xID0gcmVxdWlyZShcIi4vSFRNTEF1ZGlvUGxheWVyXCIpO1xudmFyIEhUTUxBdWRpb1BsdWdpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBIVE1MQXVkaW9QbHVnaW4oKSB7XG4gICAgICAgIHRoaXMuX3N1cHBvcnRlZEZvcm1hdHMgPSB0aGlzLl9kZXRlY3RTdXBwb3J0ZWRGb3JtYXRzKCk7XG4gICAgICAgIEhUTUxBdWRpb0Fzc2V0XzEuSFRNTEF1ZGlvQXNzZXQuc3VwcG9ydGVkRm9ybWF0cyA9IHRoaXMuc3VwcG9ydGVkRm9ybWF0cztcbiAgICB9XG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL01vZGVybml6ci9Nb2Rlcm5penIvYmxvYi9tYXN0ZXIvZmVhdHVyZS1kZXRlY3RzL2F1ZGlvLmpzXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL0NyZWF0ZUpTL1NvdW5kSlMvYmxvYi9tYXN0ZXIvc3JjL3NvdW5kanMvaHRtbGF1ZGlvL0hUTUxBdWRpb1BsdWdpbi5qc1xuICAgIEhUTUxBdWRpb1BsdWdpbi5pc1N1cHBvcnRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gQXVkaW/opoHntKDjgpLlrp/pmpvjgavkvZzjgaPjgabjgIFjYW5QbGF5VHlwZeOBjOWtmOWcqOOBmeOCi+OBi+OBp+eiuuiqjeOBmeOCi1xuICAgICAgICB2YXIgYXVkaW9FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImF1ZGlvXCIpO1xuICAgICAgICB2YXIgcmVzdWx0ID0gZmFsc2U7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXN1bHQgPSAoYXVkaW9FbGVtZW50LmNhblBsYXlUeXBlICE9PSB1bmRlZmluZWQpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBpZ25vcmUgRXJyb3JcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEhUTUxBdWRpb1BsdWdpbi5wcm90b3R5cGUsIFwic3VwcG9ydGVkRm9ybWF0c1wiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N1cHBvcnRlZEZvcm1hdHM7XG4gICAgICAgIH0sXG4gICAgICAgIC8vIFRTTGludOOBruODkOOCsCAtIHNldHRlcuOBr3JldHVybiB0eXBl44KS5pu444GP44Go44Kz44Oz44OR44Kk44Or44Ko44Op44O8XG4gICAgICAgIC8qIHRzbGludDpkaXNhYmxlOnR5cGVkZWYgKi9cbiAgICAgICAgLy8gSFRNTEF1ZGlvQXNzZXTjgbjlj43mmKDjgZXjgZvjgovjgZ/jgoFzZXR0ZXLjgajjgZnjgotcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAoc3VwcG9ydGVkRm9ybWF0cykge1xuICAgICAgICAgICAgdGhpcy5fc3VwcG9ydGVkRm9ybWF0cyA9IHN1cHBvcnRlZEZvcm1hdHM7XG4gICAgICAgICAgICBIVE1MQXVkaW9Bc3NldF8xLkhUTUxBdWRpb0Fzc2V0LnN1cHBvcnRlZEZvcm1hdHMgPSBzdXBwb3J0ZWRGb3JtYXRzO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgLyogdHNsaW50OmVuYWJsZTp0eXBlZGVmICovXG4gICAgSFRNTEF1ZGlvUGx1Z2luLnByb3RvdHlwZS5jcmVhdGVBc3NldCA9IGZ1bmN0aW9uIChpZCwgYXNzZXRQYXRoLCBkdXJhdGlvbiwgc3lzdGVtLCBsb29wLCBoaW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgSFRNTEF1ZGlvQXNzZXRfMS5IVE1MQXVkaW9Bc3NldChpZCwgYXNzZXRQYXRoLCBkdXJhdGlvbiwgc3lzdGVtLCBsb29wLCBoaW50KTtcbiAgICB9O1xuICAgIEhUTUxBdWRpb1BsdWdpbi5wcm90b3R5cGUuY3JlYXRlUGxheWVyID0gZnVuY3Rpb24gKHN5c3RlbSwgbWFuYWdlcikge1xuICAgICAgICByZXR1cm4gbmV3IEhUTUxBdWRpb1BsYXllcl8xLkhUTUxBdWRpb1BsYXllcihzeXN0ZW0sIG1hbmFnZXIpO1xuICAgIH07XG4gICAgSFRNTEF1ZGlvUGx1Z2luLnByb3RvdHlwZS5fZGV0ZWN0U3VwcG9ydGVkRm9ybWF0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gRWRnZeOBr+WGjeeUn+OBp+OBjeOCi+ODleOCoeOCpOODq+W9ouW8j+OBqGNhblBsYXlUeXBl44Gu57WQ5p6c44GM5LiA6Ie044GX44Gq44GE44Gf44KB44CB5Zu65a6a44GnQUFD44KS5Yip55So44GZ44KLXG4gICAgICAgIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJFZGdlL1wiKSAhPT0gLTEpXG4gICAgICAgICAgICByZXR1cm4gW1wiYWFjXCJdO1xuICAgICAgICAvLyBBdWRpb+imgee0oOOCkuWun+mam+OBq+S9nOOBo+OBpuOAgWNhblBsYXlUeXBl44Gn5YaN55Sf44Gn44GN44KL44GL44KS5Yik5a6a44GZ44KLXG4gICAgICAgIHZhciBhdWRpb0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXVkaW9cIik7XG4gICAgICAgIHZhciBzdXBwb3J0ZWRGb3JtYXRzID0gW107XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgc3VwcG9ydGVkRXh0ZW5zaW9ucyA9IFtcIm9nZ1wiLCBcImFhY1wiLCBcIm1wNFwiXTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzdXBwb3J0ZWRFeHRlbnNpb25zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV4dCA9IHN1cHBvcnRlZEV4dGVuc2lvbnNbaV07XG4gICAgICAgICAgICAgICAgdmFyIGNhblBsYXkgPSBhdWRpb0VsZW1lbnQuY2FuUGxheVR5cGUoXCJhdWRpby9cIiArIGV4dCk7XG4gICAgICAgICAgICAgICAgdmFyIHN1cHBvcnRlZCA9IChjYW5QbGF5ICE9PSBcIm5vXCIgJiYgY2FuUGxheSAhPT0gXCJcIik7XG4gICAgICAgICAgICAgICAgaWYgKHN1cHBvcnRlZCkge1xuICAgICAgICAgICAgICAgICAgICBzdXBwb3J0ZWRGb3JtYXRzLnB1c2goZXh0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIC8vIGlnbm9yZSBFcnJvclxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdXBwb3J0ZWRGb3JtYXRzO1xuICAgIH07XG4gICAgcmV0dXJuIEhUTUxBdWRpb1BsdWdpbjtcbn0oKSk7XG5leHBvcnRzLkhUTUxBdWRpb1BsdWdpbiA9IEhUTUxBdWRpb1BsdWdpbjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlBvc3RNZXNzYWdlQXVkaW9Bc3NldCA9IHZvaWQgMDtcbnZhciBnID0gcmVxdWlyZShcIkBha2FzaGljL2FrYXNoaWMtZW5naW5lXCIpO1xudmFyIFBvc3RNZXNzYWdlQXVkaW9QbHVnaW5fMSA9IHJlcXVpcmUoXCIuL1Bvc3RNZXNzYWdlQXVkaW9QbHVnaW5cIik7XG52YXIgUG9zdE1lc3NhZ2VBdWRpb0Fzc2V0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhQb3N0TWVzc2FnZUF1ZGlvQXNzZXQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gUG9zdE1lc3NhZ2VBdWRpb0Fzc2V0KCkge1xuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgfVxuICAgIFBvc3RNZXNzYWdlQXVkaW9Bc3NldC5wcm90b3R5cGUuX2xvYWQgPSBmdW5jdGlvbiAobG9hZGVyKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIGlkOiB0aGlzLmlkLFxuICAgICAgICAgICAgYXNzZXRQYXRoOiB0aGlzLnBhdGgsXG4gICAgICAgICAgICBkdXJhdGlvbjogdGhpcy5kdXJhdGlvbixcbiAgICAgICAgICAgIGxvb3A6IHRoaXMubG9vcCxcbiAgICAgICAgICAgIGhpbnQ6IHRoaXMuaGludFxuICAgICAgICB9O1xuICAgICAgICBQb3N0TWVzc2FnZUF1ZGlvUGx1Z2luXzEuUG9zdE1lc3NhZ2VBdWRpb1BsdWdpbi5zZW5kKFwiYWthc2hpYzpBdWRpb0Fzc2V0I19sb2FkXCIsIHBhcmFtKTtcbiAgICAgICAgLy8gVE9ETzog5pqr5a6a5a++5b+c44CC5pys5p2l44GvUERJKGlmcmFtZeOBruimqinlgbTjgYvjgonjga4gYGFrYXNoaWM6QXVkaW9Bc3NldCNfbG9hZCNzdWNjZXNzYCDjgb7jgZ/jga8gYGFrYXNoaWM6QXVkaW9Bc3NldCNfbG9hZCNmYWlsdXJlYCDjgpLlvoXjgaTlv4XopoHjgYzjgYLjgovjgIJcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBsb2FkZXIuX29uQXNzZXRMb2FkKF90aGlzKTsgfSk7XG4gICAgfTtcbiAgICBQb3N0TWVzc2FnZUF1ZGlvQXNzZXQucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIFBvc3RNZXNzYWdlQXVkaW9QbHVnaW5fMS5Qb3N0TWVzc2FnZUF1ZGlvUGx1Z2luLnNlbmQoXCJha2FzaGljOkF1ZGlvQXNzZXQjZGVzdHJveVwiLCB7IGlkOiB0aGlzLmlkIH0pO1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKTtcbiAgICB9O1xuICAgIHJldHVybiBQb3N0TWVzc2FnZUF1ZGlvQXNzZXQ7XG59KGcuQXVkaW9Bc3NldCkpO1xuZXhwb3J0cy5Qb3N0TWVzc2FnZUF1ZGlvQXNzZXQgPSBQb3N0TWVzc2FnZUF1ZGlvQXNzZXQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Qb3N0TWVzc2FnZUF1ZGlvUGxheWVyID0gdm9pZCAwO1xudmFyIGcgPSByZXF1aXJlKFwiQGFrYXNoaWMvYWthc2hpYy1lbmdpbmVcIik7XG52YXIgUG9zdE1lc3NhZ2VBdWRpb1BsdWdpbl8xID0gcmVxdWlyZShcIi4vUG9zdE1lc3NhZ2VBdWRpb1BsdWdpblwiKTtcbnZhciBQb3N0TWVzc2FnZUF1ZGlvUGxheWVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhQb3N0TWVzc2FnZUF1ZGlvUGxheWVyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFBvc3RNZXNzYWdlQXVkaW9QbGF5ZXIoc3lzdGVtLCBtYW5hZ2VyLCBpZCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBzeXN0ZW0pIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLl9tYW5hZ2VyID0gbWFuYWdlcjtcbiAgICAgICAgX3RoaXMuaWQgPSBpZDtcbiAgICAgICAgUG9zdE1lc3NhZ2VBdWRpb1BsdWdpbl8xLlBvc3RNZXNzYWdlQXVkaW9QbHVnaW4uc2VuZChcImFrYXNoaWM6QXVkaW9QbGF5ZXIjbmV3XCIsIHsgaWQ6IGlkIH0pO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIFBvc3RNZXNzYWdlQXVkaW9QbGF5ZXIucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgICAgUG9zdE1lc3NhZ2VBdWRpb1BsdWdpbl8xLlBvc3RNZXNzYWdlQXVkaW9QbHVnaW4uc2VuZChcImFrYXNoaWM6QXVkaW9QbGF5ZXIjcGxheVwiLCB7IGlkOiB0aGlzLmlkLCBhc3NldElkOiBhc3NldC5pZCB9KTtcbiAgICB9O1xuICAgIFBvc3RNZXNzYWdlQXVkaW9QbGF5ZXIucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIFBvc3RNZXNzYWdlQXVkaW9QbHVnaW5fMS5Qb3N0TWVzc2FnZUF1ZGlvUGx1Z2luLnNlbmQoXCJha2FzaGljOkF1ZGlvUGxheWVyI3N0b3BcIiwgeyBpZDogdGhpcy5pZCB9KTtcbiAgICB9O1xuICAgIFBvc3RNZXNzYWdlQXVkaW9QbGF5ZXIucHJvdG90eXBlLmNoYW5nZVZvbHVtZSA9IGZ1bmN0aW9uICh2b2x1bWUpIHtcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5jaGFuZ2VWb2x1bWUuY2FsbCh0aGlzLCB2b2x1bWUpO1xuICAgICAgICBQb3N0TWVzc2FnZUF1ZGlvUGx1Z2luXzEuUG9zdE1lc3NhZ2VBdWRpb1BsdWdpbi5zZW5kKFwiYWthc2hpYzpBdWRpb1BsYXllciNjaGFuZ2VWb2x1bWVcIiwgeyBpZDogdGhpcy5pZCwgdm9sdW1lOiB0aGlzLl9jYWxjdWxhdGVWb2x1bWUoKSB9KTtcbiAgICB9O1xuICAgIFBvc3RNZXNzYWdlQXVkaW9QbGF5ZXIucHJvdG90eXBlLl9jaGFuZ2VNdXRlZCA9IGZ1bmN0aW9uIChtdXRlZCkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLl9jaGFuZ2VNdXRlZC5jYWxsKHRoaXMsIG11dGVkKTtcbiAgICAgICAgUG9zdE1lc3NhZ2VBdWRpb1BsdWdpbl8xLlBvc3RNZXNzYWdlQXVkaW9QbHVnaW4uc2VuZChcImFrYXNoaWM6QXVkaW9QbGF5ZXIjY2hhbmdlVm9sdW1lXCIsIHsgaWQ6IHRoaXMuaWQsIHZvbHVtZTogdGhpcy5fY2FsY3VsYXRlVm9sdW1lKCkgfSk7XG4gICAgfTtcbiAgICBQb3N0TWVzc2FnZUF1ZGlvUGxheWVyLnByb3RvdHlwZS5fY2hhbmdlUGxheWJhY2tSYXRlID0gZnVuY3Rpb24gKHJhdGUpIHtcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5fY2hhbmdlUGxheWJhY2tSYXRlLmNhbGwodGhpcywgcmF0ZSk7XG4gICAgICAgIFBvc3RNZXNzYWdlQXVkaW9QbHVnaW5fMS5Qb3N0TWVzc2FnZUF1ZGlvUGx1Z2luLnNlbmQoXCJha2FzaGljOkF1ZGlvUGxheWVyI2NoYW5nZVBsYXliYWNrUmF0ZVwiLCB7IGlkOiB0aGlzLmlkLCByYXRlOiByYXRlIH0pO1xuICAgIH07XG4gICAgUG9zdE1lc3NhZ2VBdWRpb1BsYXllci5wcm90b3R5cGUubm90aWZ5TWFzdGVyVm9sdW1lQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgUG9zdE1lc3NhZ2VBdWRpb1BsdWdpbl8xLlBvc3RNZXNzYWdlQXVkaW9QbHVnaW4uc2VuZChcImFrYXNoaWM6QXVkaW9QbGF5ZXIjY2hhbmdlVm9sdW1lXCIsIHsgaWQ6IHRoaXMuaWQsIHZvbHVtZTogdGhpcy5fY2FsY3VsYXRlVm9sdW1lKCkgfSk7XG4gICAgfTtcbiAgICBQb3N0TWVzc2FnZUF1ZGlvUGxheWVyLnByb3RvdHlwZS5fY2FsY3VsYXRlVm9sdW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbXV0ZWQgPyAwIDogdGhpcy52b2x1bWUgKiB0aGlzLl9zeXN0ZW0udm9sdW1lICogdGhpcy5fbWFuYWdlci5nZXRNYXN0ZXJWb2x1bWUoKTtcbiAgICB9O1xuICAgIHJldHVybiBQb3N0TWVzc2FnZUF1ZGlvUGxheWVyO1xufShnLkF1ZGlvUGxheWVyKSk7XG5leHBvcnRzLlBvc3RNZXNzYWdlQXVkaW9QbGF5ZXIgPSBQb3N0TWVzc2FnZUF1ZGlvUGxheWVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlBvc3RNZXNzYWdlQXVkaW9QbHVnaW4gPSB2b2lkIDA7XG52YXIgUG9zdE1lc3NhZ2VBdWRpb0Fzc2V0XzEgPSByZXF1aXJlKFwiLi9Qb3N0TWVzc2FnZUF1ZGlvQXNzZXRcIik7XG52YXIgUG9zdE1lc3NhZ2VBdWRpb1BsYXllcl8xID0gcmVxdWlyZShcIi4vUG9zdE1lc3NhZ2VBdWRpb1BsYXllclwiKTtcbnZhciBQb3N0TWVzc2FnZUhhbmRsZXJfMSA9IHJlcXVpcmUoXCIuL1Bvc3RNZXNzYWdlSGFuZGxlclwiKTtcbnZhciBwb3N0TWVzc2FnZUhhbmRsZXI7XG52YXIgUG9zdE1lc3NhZ2VBdWRpb1BsdWdpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBQb3N0TWVzc2FnZUF1ZGlvUGx1Z2luKCkge1xuICAgICAgICAvLyBOT1RFOiBgQXVkaW9QbHVnaW5gIOOCkue2meaJv+OBl+OBpuOBhOOCi+OBn+OCgeOAgeOBk+OBk+OBp+OBr+S7ruOBqyB1bmRlZmluZWQg44KS5oyH5a6a44GX44Gm44GK44GPXG4gICAgICAgIC8vIGBBdWRpb1BsdWdpbiNzdXBwb3J0ZWRGb3JtYXRzYCDjga7liYrpmaTjgoLmpJzoqI5cbiAgICAgICAgdGhpcy5zdXBwb3J0ZWRGb3JtYXRzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLl9wbGF5ZXJJZHggPSAwO1xuICAgIH1cbiAgICBQb3N0TWVzc2FnZUF1ZGlvUGx1Z2luLmlzU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiAmJiAhIXdpbmRvdy5wb3N0TWVzc2FnZTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOacrHBsdWdpbuOCkuWIneacn+WMluOBmeOCi+OAglxuICAgICAqIFRPRE86IOODh+ODkOODg+OCsOeUqOOBqyBgcG9zdE1lc3NhZ2VIYW5kbGVyYCDjga7jgqTjg7Pjgrnjgr/jg7PjgrnjgpLov5TjgZfjgabjgYTjgotcbiAgICAgKiBUT0RPOiDjgZPjga5JL0bjga/lsIbmnaXnmoTjgavlpInmm7TjgZXjgozjgovlj6/og73mgKfjgYzjgYLjgotcbiAgICAgKi9cbiAgICBQb3N0TWVzc2FnZUF1ZGlvUGx1Z2luLmluaXRpYWxpemUgPSBmdW5jdGlvbiAodGFyZ2V0V2luZG93LCB0YXJnZXRPcmlnaW4pIHtcbiAgICAgICAgcG9zdE1lc3NhZ2VIYW5kbGVyID0gbmV3IFBvc3RNZXNzYWdlSGFuZGxlcl8xLlBvc3RNZXNzYWdlSGFuZGxlcih0YXJnZXRXaW5kb3csIHRhcmdldE9yaWdpbik7XG4gICAgICAgIC8vIE5PVEU6IEF1ZGlvUGx1Z2lu44Gu44Op44Kk44OV44K144Kk44Kv44Or44GM5pyq5a6a44Gq44Gu44Gn44GT44GT44Gn6ZaL5aeLXG4gICAgICAgIHBvc3RNZXNzYWdlSGFuZGxlci5zdGFydCgpO1xuICAgICAgICByZXR1cm4gcG9zdE1lc3NhZ2VIYW5kbGVyO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogUG9zdE1lc3NhZ2XjgpLpgIHkv6HjgZnjgovjgIJcbiAgICAgKiBgUG9zdE1lc3NhZ2VBdWRpb1BsdWdpbiNpbml0aWFsaXplKClgIOS7pemZjeOBq+WRvOOBs+WHuuOBleOBquOBkeOCjOOBsOOBquOCieOBquOBhOOAglxuICAgICAqL1xuICAgIFBvc3RNZXNzYWdlQXVkaW9QbHVnaW4uc2VuZCA9IGZ1bmN0aW9uICh0eXBlLCBwYXJhbWV0ZXJzKSB7XG4gICAgICAgIHBvc3RNZXNzYWdlSGFuZGxlci5zZW5kKHtcbiAgICAgICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgICAgICBwYXJhbWV0ZXJzOiBwYXJhbWV0ZXJzXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgUG9zdE1lc3NhZ2VBdWRpb1BsdWdpbi5wcm90b3R5cGUuY3JlYXRlQXNzZXQgPSBmdW5jdGlvbiAoaWQsIGFzc2V0UGF0aCwgZHVyYXRpb24sIHN5c3RlbSwgbG9vcCwgaGludCkge1xuICAgICAgICByZXR1cm4gbmV3IFBvc3RNZXNzYWdlQXVkaW9Bc3NldF8xLlBvc3RNZXNzYWdlQXVkaW9Bc3NldChpZCwgYXNzZXRQYXRoLCBkdXJhdGlvbiwgc3lzdGVtLCBsb29wLCBoaW50KTtcbiAgICB9O1xuICAgIFBvc3RNZXNzYWdlQXVkaW9QbHVnaW4ucHJvdG90eXBlLmNyZWF0ZVBsYXllciA9IGZ1bmN0aW9uIChzeXN0ZW0sIG1hbmFnZXIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQb3N0TWVzc2FnZUF1ZGlvUGxheWVyXzEuUG9zdE1lc3NhZ2VBdWRpb1BsYXllcihzeXN0ZW0sIG1hbmFnZXIsIFwiXCIgKyB0aGlzLl9wbGF5ZXJJZHgrKyk7XG4gICAgfTtcbiAgICByZXR1cm4gUG9zdE1lc3NhZ2VBdWRpb1BsdWdpbjtcbn0oKSk7XG5leHBvcnRzLlBvc3RNZXNzYWdlQXVkaW9QbHVnaW4gPSBQb3N0TWVzc2FnZUF1ZGlvUGx1Z2luO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlBvc3RNZXNzYWdlSGFuZGxlciA9IHZvaWQgMDtcbnZhciBnID0gcmVxdWlyZShcIkBha2FzaGljL2FrYXNoaWMtZW5naW5lXCIpO1xuLyoqXG4gKiBQb3N0TWVzc2FnZeOCkuWIqeeUqOOBl+OBn+OCpOODmeODs+ODiOOCqOODn+ODg+OCv+OAglxuICogVE9ETzog5pqr5a6a5a++5b+c44CC44GT44Gu44Ot44K444OD44Kv44KSIGFrYXNoaWMtZ2FtZXZpZXctd2ViIOWBtOOBq+aMgeOBn+OBm+OCi1xuICovXG52YXIgUG9zdE1lc3NhZ2VIYW5kbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFBvc3RNZXNzYWdlSGFuZGxlcih0YXJnZXRXaW5kb3csIHRhcmdldE9yaWdpbikge1xuICAgICAgICB0aGlzLm1lc3NhZ2UgPSBuZXcgZy5UcmlnZ2VyKCk7XG4gICAgICAgIHRoaXMudGFyZ2V0V2luZG93ID0gdGFyZ2V0V2luZG93O1xuICAgICAgICB0aGlzLnRhcmdldE9yaWdpbiA9IHRhcmdldE9yaWdpbjtcbiAgICAgICAgdGhpcy5vbk1lc3NhZ2VfYm91bmQgPSB0aGlzLm9uTWVzc2FnZS5iaW5kKHRoaXMpO1xuICAgIH1cbiAgICBQb3N0TWVzc2FnZUhhbmRsZXIucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgdGhpcy5vbk1lc3NhZ2VfYm91bmQpO1xuICAgIH07XG4gICAgUG9zdE1lc3NhZ2VIYW5kbGVyLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgdGhpcy5vbk1lc3NhZ2VfYm91bmQpO1xuICAgIH07XG4gICAgUG9zdE1lc3NhZ2VIYW5kbGVyLnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgdGhpcy50YXJnZXRXaW5kb3cucG9zdE1lc3NhZ2UobWVzc2FnZSwgdGhpcy50YXJnZXRPcmlnaW4pO1xuICAgIH07XG4gICAgUG9zdE1lc3NhZ2VIYW5kbGVyLnByb3RvdHlwZS5vbk1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICBpZiAobWVzc2FnZS5vcmlnaW4gIT09IHRoaXMudGFyZ2V0T3JpZ2luKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tZXNzYWdlLmZpcmUobWVzc2FnZS5kYXRhKTtcbiAgICB9O1xuICAgIHJldHVybiBQb3N0TWVzc2FnZUhhbmRsZXI7XG59KCkpO1xuZXhwb3J0cy5Qb3N0TWVzc2FnZUhhbmRsZXIgPSBQb3N0TWVzc2FnZUhhbmRsZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Qcm94eUF1ZGlvQXNzZXQgPSB2b2lkIDA7XG52YXIgZyA9IHJlcXVpcmUoXCJAYWthc2hpYy9ha2FzaGljLWVuZ2luZVwiKTtcbnZhciBQcm94eUF1ZGlvQXNzZXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFByb3h5QXVkaW9Bc3NldCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBQcm94eUF1ZGlvQXNzZXQoaGFuZGxlclNldCwgaWQsIGFzc2V0UGF0aCwgZHVyYXRpb24sIHN5c3RlbSwgbG9vcCwgaGludCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBpZCwgYXNzZXRQYXRoLCBkdXJhdGlvbiwgc3lzdGVtLCBsb29wLCBoaW50KSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5faGFuZGxlclNldCA9IGhhbmRsZXJTZXQ7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgUHJveHlBdWRpb0Fzc2V0LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9oYW5kbGVyU2V0LnVubG9hZEF1ZGlvQXNzZXQodGhpcy5pZCk7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpO1xuICAgIH07XG4gICAgUHJveHlBdWRpb0Fzc2V0LnByb3RvdHlwZS5fbG9hZCA9IGZ1bmN0aW9uIChsb2FkZXIpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5faGFuZGxlclNldC5sb2FkQXVkaW9Bc3NldCh7XG4gICAgICAgICAgICBpZDogdGhpcy5pZCxcbiAgICAgICAgICAgIGFzc2V0UGF0aDogdGhpcy5wYXRoLFxuICAgICAgICAgICAgZHVyYXRpb246IHRoaXMuZHVyYXRpb24sXG4gICAgICAgICAgICBsb29wOiB0aGlzLmxvb3AsXG4gICAgICAgICAgICBoaW50OiB0aGlzLmhpbnRcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGxvYWRlci5fb25Bc3NldEVycm9yKF90aGlzLCBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXRMb2FkRXJyb3IoZXJyKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsb2FkZXIuX29uQXNzZXRMb2FkKF90aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBQcm94eUF1ZGlvQXNzZXQucHJvdG90eXBlLl9hc3NldFBhdGhGaWx0ZXIgPSBmdW5jdGlvbiAocGF0aCkge1xuICAgICAgICByZXR1cm4gcGF0aDtcbiAgICB9O1xuICAgIHJldHVybiBQcm94eUF1ZGlvQXNzZXQ7XG59KGcuQXVkaW9Bc3NldCkpO1xuZXhwb3J0cy5Qcm94eUF1ZGlvQXNzZXQgPSBQcm94eUF1ZGlvQXNzZXQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Qcm94eUF1ZGlvUGxheWVyID0gdm9pZCAwO1xudmFyIGcgPSByZXF1aXJlKFwiQGFrYXNoaWMvYWthc2hpYy1lbmdpbmVcIik7XG52YXIgUHJveHlBdWRpb1BsYXllciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoUHJveHlBdWRpb1BsYXllciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBQcm94eUF1ZGlvUGxheWVyKGhhbmRsZXJTZXQsIHN5c3RlbSwgbWFuYWdlcikge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBzeXN0ZW0pIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLl9hdWRpb1BsYXllcklkID0gbnVsbDtcbiAgICAgICAgX3RoaXMuX2hhbmRsZXJTZXQgPSBoYW5kbGVyU2V0O1xuICAgICAgICBfdGhpcy5fbWFuYWdlciA9IG1hbmFnZXI7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgUHJveHlBdWRpb1BsYXllci5wcm90b3R5cGUuY2hhbmdlVm9sdW1lID0gZnVuY3Rpb24gKHZvbHVtZSkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmNoYW5nZVZvbHVtZS5jYWxsKHRoaXMsIHZvbHVtZSk7XG4gICAgICAgIHRoaXMuX25vdGlmeVZvbHVtZVRvSGFuZGxlcigpO1xuICAgIH07XG4gICAgUHJveHlBdWRpb1BsYXllci5wcm90b3R5cGUuX2NoYW5nZU11dGVkID0gZnVuY3Rpb24gKG11dGVkKSB7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuX2NoYW5nZU11dGVkLmNhbGwodGhpcywgbXV0ZWQpO1xuICAgICAgICB0aGlzLl9ub3RpZnlWb2x1bWVUb0hhbmRsZXIoKTtcbiAgICB9O1xuICAgIFByb3h5QXVkaW9QbGF5ZXIucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgICAgaWYgKHRoaXMuX2F1ZGlvUGxheWVySWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5zdG9wKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYXVkaW9QbGF5ZXJJZCA9IFwiYXBcIiArIFByb3h5QXVkaW9QbGF5ZXIuX2F1ZGlvUGxheWVySWRDb3VudGVyKys7XG4gICAgICAgIHRoaXMuX2hhbmRsZXJTZXQuY3JlYXRlQXVkaW9QbGF5ZXIoe1xuICAgICAgICAgICAgYXNzZXRJZDogYXNzZXQuaWQsXG4gICAgICAgICAgICBhdWRpb1BsYXllcklkOiB0aGlzLl9hdWRpb1BsYXllcklkLFxuICAgICAgICAgICAgaXNQbGF5aW5nOiB0cnVlLFxuICAgICAgICAgICAgdm9sdW1lOiB0aGlzLl9jYWxjdWxhdGVWb2x1bWUoKSxcbiAgICAgICAgICAgIHBsYXliYWNrUmF0ZTogMSAvLyDmnKrkvb/nlKhcbiAgICAgICAgfSk7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUucGxheS5jYWxsKHRoaXMsIGFzc2V0KTtcbiAgICB9O1xuICAgIFByb3h5QXVkaW9QbGF5ZXIucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9hdWRpb1BsYXllcklkICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZXJTZXQuc3RvcEF1ZGlvUGxheWVyKHRoaXMuX2F1ZGlvUGxheWVySWQpO1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlclNldC5kZXN0cm95QXVkaW9QbGF5ZXIodGhpcy5fYXVkaW9QbGF5ZXJJZCk7XG4gICAgICAgICAgICB0aGlzLl9hdWRpb1BsYXllcklkID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLnN0b3AuY2FsbCh0aGlzKTtcbiAgICB9O1xuICAgIFByb3h5QXVkaW9QbGF5ZXIucHJvdG90eXBlLm5vdGlmeU1hc3RlclZvbHVtZUNoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX25vdGlmeVZvbHVtZVRvSGFuZGxlcigpO1xuICAgIH07XG4gICAgUHJveHlBdWRpb1BsYXllci5wcm90b3R5cGUuX25vdGlmeVZvbHVtZVRvSGFuZGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2F1ZGlvUGxheWVySWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlclNldC5jaGFuZ2VBdWRpb1ZvbHVtZSh0aGlzLl9hdWRpb1BsYXllcklkLCB0aGlzLl9jYWxjdWxhdGVWb2x1bWUoKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFByb3h5QXVkaW9QbGF5ZXIucHJvdG90eXBlLl9jYWxjdWxhdGVWb2x1bWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9tdXRlZCA/IDAgOiB0aGlzLnZvbHVtZSAqIHRoaXMuX3N5c3RlbS52b2x1bWUgKiB0aGlzLl9tYW5hZ2VyLmdldE1hc3RlclZvbHVtZSgpO1xuICAgIH07XG4gICAgUHJveHlBdWRpb1BsYXllci5fYXVkaW9QbGF5ZXJJZENvdW50ZXIgPSAwO1xuICAgIHJldHVybiBQcm94eUF1ZGlvUGxheWVyO1xufShnLkF1ZGlvUGxheWVyKSk7XG5leHBvcnRzLlByb3h5QXVkaW9QbGF5ZXIgPSBQcm94eUF1ZGlvUGxheWVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlByb3h5QXVkaW9QbHVnaW4gPSB2b2lkIDA7XG52YXIgUHJveHlBdWRpb0Fzc2V0XzEgPSByZXF1aXJlKFwiLi9Qcm94eUF1ZGlvQXNzZXRcIik7XG52YXIgUHJveHlBdWRpb1BsYXllcl8xID0gcmVxdWlyZShcIi4vUHJveHlBdWRpb1BsYXllclwiKTtcbnZhciBQcm94eUF1ZGlvUGx1Z2luID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFByb3h5QXVkaW9QbHVnaW4oaGFuZGxlclNldCkge1xuICAgICAgICB0aGlzLnN1cHBvcnRlZEZvcm1hdHMgPSBbXTtcbiAgICAgICAgdGhpcy5faGFuZGxlclNldCA9IGhhbmRsZXJTZXQ7XG4gICAgfVxuICAgIFByb3h5QXVkaW9QbHVnaW4uaXNTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG4gICAgUHJveHlBdWRpb1BsdWdpbi5wcm90b3R5cGUuY3JlYXRlQXNzZXQgPSBmdW5jdGlvbiAoaWQsIGFzc2V0UGF0aCwgZHVyYXRpb24sIHN5c3RlbSwgbG9vcCwgaGludCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb3h5QXVkaW9Bc3NldF8xLlByb3h5QXVkaW9Bc3NldCh0aGlzLl9oYW5kbGVyU2V0LCBpZCwgYXNzZXRQYXRoLCBkdXJhdGlvbiwgc3lzdGVtLCBsb29wLCBoaW50KTtcbiAgICB9O1xuICAgIFByb3h5QXVkaW9QbHVnaW4ucHJvdG90eXBlLmNyZWF0ZVBsYXllciA9IGZ1bmN0aW9uIChzeXN0ZW0sIG1hbmFnZXIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm94eUF1ZGlvUGxheWVyXzEuUHJveHlBdWRpb1BsYXllcih0aGlzLl9oYW5kbGVyU2V0LCBzeXN0ZW0sIG1hbmFnZXIpO1xuICAgIH07XG4gICAgcmV0dXJuIFByb3h5QXVkaW9QbHVnaW47XG59KCkpO1xuZXhwb3J0cy5Qcm94eUF1ZGlvUGx1Z2luID0gUHJveHlBdWRpb1BsdWdpbjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLldlYkF1ZGlvQXNzZXQgPSB2b2lkIDA7XG52YXIgZyA9IHJlcXVpcmUoXCJAYWthc2hpYy9ha2FzaGljLWVuZ2luZVwiKTtcbnZhciBYSFJMb2FkZXJfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlscy9YSFJMb2FkZXJcIik7XG52YXIgaGVscGVyID0gcmVxdWlyZShcIi4vV2ViQXVkaW9IZWxwZXJcIik7XG52YXIgV2ViQXVkaW9Bc3NldCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoV2ViQXVkaW9Bc3NldCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBXZWJBdWRpb0Fzc2V0KCkge1xuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgfVxuICAgIFdlYkF1ZGlvQXNzZXQucHJvdG90eXBlLl9sb2FkID0gZnVuY3Rpb24gKGxvYWRlcikge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5wYXRoID09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIOWGjeeUn+WPr+iDveOBquW9ouW8j+OBjOOBquOBhOOAguWun+mam+OBq+OBr+mztOOCieOBquOBhOmfs+WjsOOBqOOBl+OBpuODreODvOODieaIkOWKn+OBl+OBpuOBiuOBj1xuICAgICAgICAgICAgdGhpcy5kYXRhID0gbnVsbDtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gbG9hZGVyLl9vbkFzc2V0TG9hZChfdGhpcyk7IH0sIDApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBzdWNjZXNzSGFuZGxlciA9IGZ1bmN0aW9uIChkZWNvZGVkQXVkaW8pIHtcbiAgICAgICAgICAgIF90aGlzLmRhdGEgPSBkZWNvZGVkQXVkaW87XG4gICAgICAgICAgICBsb2FkZXIuX29uQXNzZXRMb2FkKF90aGlzKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGVycm9ySGFuZGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGxvYWRlci5fb25Bc3NldEVycm9yKF90aGlzLCBnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXRMb2FkRXJyb3IoXCJXZWJBdWRpb0Fzc2V0IHVua25vd24gbG9hZGluZyBlcnJvclwiKSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBvbkxvYWRBcnJheUJ1ZmZlckhhbmRsZXIgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHZhciBhdWRpb0NvbnRleHQgPSBoZWxwZXIuZ2V0QXVkaW9Db250ZXh0KCk7XG4gICAgICAgICAgICBhdWRpb0NvbnRleHQuZGVjb2RlQXVkaW9EYXRhKHJlc3BvbnNlLCBzdWNjZXNzSGFuZGxlciwgZXJyb3JIYW5kbGVyKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHhockxvYWRlciA9IG5ldyBYSFJMb2FkZXJfMS5YSFJMb2FkZXIoKTtcbiAgICAgICAgdmFyIGxvYWRBcnJheUJ1ZmZlciA9IGZ1bmN0aW9uIChwYXRoLCBvblN1Y2Nlc3MsIG9uRmFpbGVkKSB7XG4gICAgICAgICAgICB4aHJMb2FkZXIuZ2V0QXJyYXlCdWZmZXIocGF0aCwgZnVuY3Rpb24gKGVycm9yLCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGVycm9yID8gb25GYWlsZWQoZXJyb3IpIDogb25TdWNjZXNzKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgZGVsSW5kZXggPSB0aGlzLnBhdGguaW5kZXhPZihcIj9cIik7XG4gICAgICAgIHZhciBiYXNlUGF0aCA9IGRlbEluZGV4ID49IDAgPyB0aGlzLnBhdGguc3Vic3RyaW5nKDAsIGRlbEluZGV4KSA6IHRoaXMucGF0aDtcbiAgICAgICAgaWYgKGJhc2VQYXRoLnNsaWNlKC00KSA9PT0gXCIuYWFjXCIpIHtcbiAgICAgICAgICAgIC8vIOaaq+WumuWvvuW/nO+8muW+jOaWueS6kuaPm+aAp+OBruOBn+OCgeOAgWFhY+ODleOCoeOCpOODq+OBjOeEoeOBhOWgtOWQiOOBr21wNOOBuOOBruODleOCqeODvOODq+ODkOODg+OCr+OCkuippuOBv+OCi+OAglxuICAgICAgICAgICAgLy8g44GT44Gu5a++5b+c44KS5q2i44KB44KL6Zqb44Gr44Gv44CBV2ViQXVkaW9QbHVnaW7jga5zdXBwb3J0ZWRFeHRlbnNpb25z44GL44KJYWFj44KS6Zmk5aSW44GZ44KL5b+F6KaB44GM44GC44KL44CCXG4gICAgICAgICAgICBsb2FkQXJyYXlCdWZmZXIodGhpcy5wYXRoLCBvbkxvYWRBcnJheUJ1ZmZlckhhbmRsZXIsIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHZhciBhbHRQYXRoID0gZy5QYXRoVXRpbC5hZGRFeHRuYW1lKF90aGlzLm9yaWdpbmFsUGF0aCwgXCJtcDRcIik7XG4gICAgICAgICAgICAgICAgbG9hZEFycmF5QnVmZmVyKGFsdFBhdGgsIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5wYXRoID0gYWx0UGF0aDtcbiAgICAgICAgICAgICAgICAgICAgb25Mb2FkQXJyYXlCdWZmZXJIYW5kbGVyKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9LCBlcnJvckhhbmRsZXIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbG9hZEFycmF5QnVmZmVyKHRoaXMucGF0aCwgb25Mb2FkQXJyYXlCdWZmZXJIYW5kbGVyLCBlcnJvckhhbmRsZXIpO1xuICAgIH07XG4gICAgV2ViQXVkaW9Bc3NldC5wcm90b3R5cGUuX2Fzc2V0UGF0aEZpbHRlciA9IGZ1bmN0aW9uIChwYXRoKSB7XG4gICAgICAgIGlmIChXZWJBdWRpb0Fzc2V0LnN1cHBvcnRlZEZvcm1hdHMuaW5kZXhPZihcIm9nZ1wiKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBnLlBhdGhVdGlsLmFkZEV4dG5hbWUocGF0aCwgXCJvZ2dcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFdlYkF1ZGlvQXNzZXQuc3VwcG9ydGVkRm9ybWF0cy5pbmRleE9mKFwiYWFjXCIpICE9PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIGcuUGF0aFV0aWwuYWRkRXh0bmFtZShwYXRoLCBcImFhY1wiKTtcbiAgICAgICAgfVxuICAgICAgICAvLyDjgZPjgZPjgafmpJzlh7rjgZXjgozjgovjga7jga/mnIDliJ3jgavjgqLjgq/jgrvjgrnjgpLoqabjgb/jgovjgqrjg7zjg4fjgqPjgqrjgqLjgrvjg4Pjg4jjga7jg5XjgqHjgqTjg6vjg5Hjgrnjgarjga7jgafjgIFcbiAgICAgICAgLy8gc3VwcG9ydGVkRm9ybWF0c+OBqyjlvozmlrnkupLmj5vmgKfkv53mjIHjgafkvb/jgYblj6/og73mgKfjgYzjgYLjgospbXA044GM5ZCr44G+44KM44Gm44GE44Gm44KC5Yip55So44GX44Gq44GEXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG4gICAgLy8gX2Fzc2V0UGF0aEZpbHRlcuOBruWIpOWumuWHpueQhuOCkuWwj+OBleOBj+OBmeOCi+OBn+OCgeOAgeS6iOOCgeOCteODneODvOODiOOBl+OBpuOCi+aLoeW8teWtkOS4gOimp+OCkuaMgeOBpFxuICAgIFdlYkF1ZGlvQXNzZXQuc3VwcG9ydGVkRm9ybWF0cyA9IFtdO1xuICAgIHJldHVybiBXZWJBdWRpb0Fzc2V0O1xufShnLkF1ZGlvQXNzZXQpKTtcbmV4cG9ydHMuV2ViQXVkaW9Bc3NldCA9IFdlYkF1ZGlvQXNzZXQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBoZWxwZXIgPSByZXF1aXJlKFwiLi9XZWJBdWRpb0hlbHBlclwiKTtcbi8vIGNocm9tZTY25Lul6ZmN44Gq44Gp44Gu44OW44Op44Km44K244Gr5bCO5YWl44GV44KM44KLQXV0b3BsYXkgUG9saWN544Gr5a++5b+c44GZ44KLXG4vLyBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS93ZWIvdXBkYXRlcy8yMDE3LzA5L2F1dG9wbGF5LXBvbGljeS1jaGFuZ2VzXG52YXIgV2ViQXVkaW9BdXRvcGxheUhlbHBlcjtcbihmdW5jdGlvbiAoV2ViQXVkaW9BdXRvcGxheUhlbHBlcikge1xuICAgIGZ1bmN0aW9uIHNldHVwQ2hyb21lTUVJV29ya2Fyb3VuZCgpIHtcbiAgICAgICAgdmFyIGNvbnRleHQgPSBoZWxwZXIuZ2V0QXVkaW9Db250ZXh0KCk7XG4gICAgICAgIGlmIChjb250ZXh0ICYmIHR5cGVvZiBjb250ZXh0LnJlc3VtZSAhPT0gXCJmdW5jdGlvblwiKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB2YXIgZ2FpbiA9IGhlbHBlci5jcmVhdGVHYWluTm9kZShjb250ZXh0KTtcbiAgICAgICAgLy8g44OG44K544OI55So44Gu6Z+z5rqQ44KS55So5oSP44GZ44KLXG4gICAgICAgIHZhciBvc2MgPSBjb250ZXh0LmNyZWF0ZU9zY2lsbGF0b3IoKTtcbiAgICAgICAgb3NjLnR5cGUgPSBcInNhd3Rvb3RoXCI7XG4gICAgICAgIG9zYy5mcmVxdWVuY3kudmFsdWUgPSA0NDA7IC8vIOS9leOBp+OCguiJr+OBhOOBjOODieOBrumfs1xuICAgICAgICBvc2MuY29ubmVjdChnYWluKTtcbiAgICAgICAgb3NjLnN0YXJ0KDApO1xuICAgICAgICB2YXIgY29udGV4dFN0YXRlID0gY29udGV4dC5zdGF0ZTtcbiAgICAgICAgb3NjLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgaWYgKGNvbnRleHRTdGF0ZSAhPT0gXCJydW5uaW5nXCIpXG4gICAgICAgICAgICBzZXRVc2VySW50ZXJhY3RMaXN0ZW5lcigpO1xuICAgIH1cbiAgICBXZWJBdWRpb0F1dG9wbGF5SGVscGVyLnNldHVwQ2hyb21lTUVJV29ya2Fyb3VuZCA9IHNldHVwQ2hyb21lTUVJV29ya2Fyb3VuZDtcbn0pKFdlYkF1ZGlvQXV0b3BsYXlIZWxwZXIgfHwgKFdlYkF1ZGlvQXV0b3BsYXlIZWxwZXIgPSB7fSkpO1xuZnVuY3Rpb24gcmVzdW1lSGFuZGxlcigpIHtcbiAgICB2YXIgY29udGV4dCA9IGhlbHBlci5nZXRBdWRpb0NvbnRleHQoKTtcbiAgICBjb250ZXh0LnJlc3VtZSgpO1xuICAgIGNsZWFyVXNlckludGVyYWN0TGlzdGVuZXIoKTtcbn1cbmZ1bmN0aW9uIHNldFVzZXJJbnRlcmFjdExpc3RlbmVyKCkge1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHJlc3VtZUhhbmRsZXIsIHRydWUpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgcmVzdW1lSGFuZGxlciwgdHJ1ZSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIHJlc3VtZUhhbmRsZXIsIHRydWUpO1xufVxuZnVuY3Rpb24gY2xlYXJVc2VySW50ZXJhY3RMaXN0ZW5lcigpIHtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCByZXN1bWVIYW5kbGVyKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHJlc3VtZUhhbmRsZXIpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCByZXN1bWVIYW5kbGVyKTtcbn1cbm1vZHVsZS5leHBvcnRzID0gV2ViQXVkaW9BdXRvcGxheUhlbHBlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xuLy8gV2ViQXVkaW/jga7jg5bjg6njgqbjgrbplpPjga7lt67jgpLlkLjlj47jgZnjgotcbi8vIENvbXBhdGlibGUgVGFibGU6IGh0dHA6Ly9jb21wYXRpYmlsaXR5LnNod3Vwcy1jbXMuY2gvZW4vaG9tZT8mcHJvcGVydHk9QXVkaW9QYXJhbS5wcm90b3R5cGVcbi8vIGh0dHA6Ly9xaWl0YS5jb20vbW9oYXlvbmFvL2l0ZW1zL2Q3OWU5ZmM1NmI0ZTljMTU3YmUxI3BvbHlmaWxsXG4vLyBodHRwczovL2dpdGh1Yi5jb20vY3dpbHNvL3dlYmtpdEF1ZGlvQ29udGV4dC1Nb25rZXlQYXRjaFxuLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1dlYl9BdWRpb19BUEkvUG9ydGluZ193ZWJraXRBdWRpb0NvbnRleHRfY29kZV90b19zdGFuZGFyZHNfYmFzZWRfQXVkaW9Db250ZXh0XG52YXIgQXVkaW9Db250ZXh0ID0gd2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0O1xudmFyIFdlYkF1ZGlvSGVscGVyO1xuKGZ1bmN0aW9uIChXZWJBdWRpb0hlbHBlcikge1xuICAgIC8vIEF1ZGlvQ29udGV4dOOCkuOCt+ODs+OCsOODq+ODiOODs+OBqOOBl+OBpuWPluW+l+OBmeOCi1xuICAgIC8vIOS4gOOBpOOBruODmuODvOOCuOOBq+S4gOOBpOOBrkNvbnRleHTjgYzlrZjlnKjjgZnjgozjgbDoia/jgYRcbiAgICBmdW5jdGlvbiBnZXRBdWRpb0NvbnRleHQoKSB7XG4gICAgICAgIGlmICghd2luZG93Ll9fYWthc2hpY19fKSB7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCBcIl9fYWthc2hpY19fXCIsIHtcbiAgICAgICAgICAgICAgICB2YWx1ZToge30sXG4gICAgICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjdHggPSB3aW5kb3cuX19ha2FzaGljX18uYXVkaW9Db250ZXh0O1xuICAgICAgICBpZiAoIShjdHggaW5zdGFuY2VvZiBBdWRpb0NvbnRleHQpKSB7XG4gICAgICAgICAgICBjdHggPSB3aW5kb3cuX19ha2FzaGljX18uYXVkaW9Db250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpO1xuICAgICAgICAgICAgV2ViQXVkaW9IZWxwZXIuX3dvcmtBcm91bmRTYWZhcmkoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY3R4O1xuICAgIH1cbiAgICBXZWJBdWRpb0hlbHBlci5nZXRBdWRpb0NvbnRleHQgPSBnZXRBdWRpb0NvbnRleHQ7XG4gICAgZnVuY3Rpb24gY3JlYXRlR2Fpbk5vZGUoY29udGV4dCkge1xuICAgICAgICBpZiAoY29udGV4dC5jcmVhdGVHYWluKSB7XG4gICAgICAgICAgICByZXR1cm4gY29udGV4dC5jcmVhdGVHYWluKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbnRleHQuY3JlYXRlR2Fpbk5vZGUoKTtcbiAgICB9XG4gICAgV2ViQXVkaW9IZWxwZXIuY3JlYXRlR2Fpbk5vZGUgPSBjcmVhdGVHYWluTm9kZTtcbiAgICBmdW5jdGlvbiBjcmVhdGVCdWZmZXJOb2RlKGNvbnRleHQpIHtcbiAgICAgICAgdmFyIHNvdXJjZU5vZGUgPSBjb250ZXh0LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xuICAgICAgICAvLyBzdGFydOOBjOOBguOCi+OBquOCieWVj+mhjOOBquOBhOOBruOBp+OAgeaLoeW8teOBl+OBquOBhOOBp+i/lOOBmVxuICAgICAgICBpZiAoc291cmNlTm9kZS5zdGFydCkge1xuICAgICAgICAgICAgcmV0dXJuIHNvdXJjZU5vZGU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gc3RhcnQvc3RvcOOBjOOBquOBhOeSsOWig+OBuOOBruOCqOOCpOODquOCouOCueOCkuiyvOOCi1xuICAgICAgICBzb3VyY2VOb2RlLnN0YXJ0ID0gc291cmNlTm9kZS5ub3RlT247XG4gICAgICAgIHNvdXJjZU5vZGUuc3RvcCA9IHNvdXJjZU5vZGUubm90ZU9mZjtcbiAgICAgICAgcmV0dXJuIHNvdXJjZU5vZGU7XG4gICAgfVxuICAgIFdlYkF1ZGlvSGVscGVyLmNyZWF0ZUJ1ZmZlck5vZGUgPSBjcmVhdGVCdWZmZXJOb2RlO1xuICAgIC8vIFNhZmFyaeWvvuetluODr+ODvOOCr+OCouODqeOCpuODs+ODiVxuICAgIGZ1bmN0aW9uIF93b3JrQXJvdW5kU2FmYXJpKCkge1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbiB0b3VjaEluaXRpYWxpemVIYW5kbGVyKCkge1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgdG91Y2hJbml0aWFsaXplSGFuZGxlcik7XG4gICAgICAgICAgICBXZWJBdWRpb0hlbHBlci5nZXRBdWRpb0NvbnRleHQoKS5jcmVhdGVCdWZmZXJTb3VyY2UoKS5zdGFydCgwKTtcbiAgICAgICAgfSwgdHJ1ZSk7XG4gICAgfVxuICAgIFdlYkF1ZGlvSGVscGVyLl93b3JrQXJvdW5kU2FmYXJpID0gX3dvcmtBcm91bmRTYWZhcmk7XG59KShXZWJBdWRpb0hlbHBlciB8fCAoV2ViQXVkaW9IZWxwZXIgPSB7fSkpO1xubW9kdWxlLmV4cG9ydHMgPSBXZWJBdWRpb0hlbHBlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLldlYkF1ZGlvUGxheWVyID0gdm9pZCAwO1xudmFyIGcgPSByZXF1aXJlKFwiQGFrYXNoaWMvYWthc2hpYy1lbmdpbmVcIik7XG52YXIgaGVscGVyID0gcmVxdWlyZShcIi4vV2ViQXVkaW9IZWxwZXJcIik7XG52YXIgV2ViQXVkaW9QbGF5ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFdlYkF1ZGlvUGxheWVyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFdlYkF1ZGlvUGxheWVyKHN5c3RlbSwgbWFuYWdlcikge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBzeXN0ZW0pIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLl9hdWRpb0NvbnRleHQgPSBoZWxwZXIuZ2V0QXVkaW9Db250ZXh0KCk7XG4gICAgICAgIF90aGlzLl9tYW5hZ2VyID0gbWFuYWdlcjtcbiAgICAgICAgX3RoaXMuX2dhaW5Ob2RlID0gaGVscGVyLmNyZWF0ZUdhaW5Ob2RlKF90aGlzLl9hdWRpb0NvbnRleHQpO1xuICAgICAgICBfdGhpcy5fZ2Fpbk5vZGUuY29ubmVjdChfdGhpcy5fYXVkaW9Db250ZXh0LmRlc3RpbmF0aW9uKTtcbiAgICAgICAgX3RoaXMuX3NvdXJjZU5vZGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIF90aGlzLl9kdW1teUR1cmF0aW9uV2FpdFRpbWVyID0gbnVsbDtcbiAgICAgICAgX3RoaXMuX2VuZGVkRXZlbnRIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMuX29uQXVkaW9FbmRlZCgpO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIFdlYkF1ZGlvUGxheWVyLnByb3RvdHlwZS5jaGFuZ2VWb2x1bWUgPSBmdW5jdGlvbiAodm9sdW1lKSB7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuY2hhbmdlVm9sdW1lLmNhbGwodGhpcywgdm9sdW1lKTtcbiAgICAgICAgdGhpcy5fZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9IHRoaXMuX2NhbGN1bGF0ZVZvbHVtZSgpO1xuICAgIH07XG4gICAgV2ViQXVkaW9QbGF5ZXIucHJvdG90eXBlLl9jaGFuZ2VNdXRlZCA9IGZ1bmN0aW9uIChtdXRlZCkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLl9jaGFuZ2VNdXRlZC5jYWxsKHRoaXMsIG11dGVkKTtcbiAgICAgICAgdGhpcy5fZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9IHRoaXMuX2NhbGN1bGF0ZVZvbHVtZSgpO1xuICAgIH07XG4gICAgV2ViQXVkaW9QbGF5ZXIucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEF1ZGlvKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYXNzZXQuZGF0YSkge1xuICAgICAgICAgICAgdmFyIGJ1ZmZlck5vZGUgPSBoZWxwZXIuY3JlYXRlQnVmZmVyTm9kZSh0aGlzLl9hdWRpb0NvbnRleHQpO1xuICAgICAgICAgICAgYnVmZmVyTm9kZS5sb29wID0gYXNzZXQubG9vcDtcbiAgICAgICAgICAgIGJ1ZmZlck5vZGUuYnVmZmVyID0gYXNzZXQuZGF0YTtcbiAgICAgICAgICAgIHRoaXMuX2dhaW5Ob2RlLmdhaW4udmFsdWUgPSB0aGlzLl9jYWxjdWxhdGVWb2x1bWUoKTtcbiAgICAgICAgICAgIGJ1ZmZlck5vZGUuY29ubmVjdCh0aGlzLl9nYWluTm9kZSk7XG4gICAgICAgICAgICB0aGlzLl9zb3VyY2VOb2RlID0gYnVmZmVyTm9kZTtcbiAgICAgICAgICAgIC8vIENocm9tZeOBoOOBqGV2ZW50IGxpc3RlcuOBp+aMh+WumuOBl+OBn+WgtOWQiOOBq+WLleOBi+OBquOBhOOBk+OBqOOBjOOBguOCi1xuICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL21vemlsbGEtYXBwbWFrZXIvYXBwbWFrZXIvaXNzdWVzLzE5ODRcbiAgICAgICAgICAgIHRoaXMuX3NvdXJjZU5vZGUub25lbmRlZCA9IHRoaXMuX2VuZGVkRXZlbnRIYW5kbGVyO1xuICAgICAgICAgICAgdGhpcy5fc291cmNlTm9kZS5zdGFydCgwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIOWGjeeUn+OBp+OBjeOCi+OCquODvOODh+OCo+OCquOBjOOBquOBhOWgtOWQiOOAgmR1cmF0aW9u5b6M44Gr5YGc5q2i5Yem55CG44Gg44GR6KGM44GGKOWHpueQhuOBruOBv+mAsuOCgemfs+OBr+mztOOCieOBleOBquOBhClcbiAgICAgICAgICAgIHRoaXMuX2R1bW15RHVyYXRpb25XYWl0VGltZXIgPSBzZXRUaW1lb3V0KHRoaXMuX2VuZGVkRXZlbnRIYW5kbGVyLCBhc3NldC5kdXJhdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5wbGF5LmNhbGwodGhpcywgYXNzZXQpO1xuICAgIH07XG4gICAgV2ViQXVkaW9QbGF5ZXIucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5jdXJyZW50QXVkaW8pIHtcbiAgICAgICAgICAgIF9zdXBlci5wcm90b3R5cGUuc3RvcC5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2NsZWFyRW5kZWRFdmVudEhhbmRsZXIoKTtcbiAgICAgICAgaWYgKHRoaXMuX3NvdXJjZU5vZGUpXG4gICAgICAgICAgICB0aGlzLl9zb3VyY2VOb2RlLnN0b3AoMCk7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuc3RvcC5jYWxsKHRoaXMpO1xuICAgIH07XG4gICAgV2ViQXVkaW9QbGF5ZXIucHJvdG90eXBlLm5vdGlmeU1hc3RlclZvbHVtZUNoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2dhaW5Ob2RlLmdhaW4udmFsdWUgPSB0aGlzLl9jYWxjdWxhdGVWb2x1bWUoKTtcbiAgICB9O1xuICAgIFdlYkF1ZGlvUGxheWVyLnByb3RvdHlwZS5fb25BdWRpb0VuZGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9jbGVhckVuZGVkRXZlbnRIYW5kbGVyKCk7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuc3RvcC5jYWxsKHRoaXMpO1xuICAgIH07XG4gICAgV2ViQXVkaW9QbGF5ZXIucHJvdG90eXBlLl9jbGVhckVuZGVkRXZlbnRIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fc291cmNlTm9kZSlcbiAgICAgICAgICAgIHRoaXMuX3NvdXJjZU5vZGUub25lbmRlZCA9IG51bGw7XG4gICAgICAgIGlmICh0aGlzLl9kdW1teUR1cmF0aW9uV2FpdFRpbWVyICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9kdW1teUR1cmF0aW9uV2FpdFRpbWVyKTtcbiAgICAgICAgICAgIHRoaXMuX2R1bW15RHVyYXRpb25XYWl0VGltZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBXZWJBdWRpb1BsYXllci5wcm90b3R5cGUuX2NhbGN1bGF0ZVZvbHVtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX211dGVkID8gMCA6IHRoaXMudm9sdW1lICogdGhpcy5fc3lzdGVtLnZvbHVtZSAqIHRoaXMuX21hbmFnZXIuZ2V0TWFzdGVyVm9sdW1lKCk7XG4gICAgfTtcbiAgICByZXR1cm4gV2ViQXVkaW9QbGF5ZXI7XG59KGcuQXVkaW9QbGF5ZXIpKTtcbmV4cG9ydHMuV2ViQXVkaW9QbGF5ZXIgPSBXZWJBdWRpb1BsYXllcjtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5XZWJBdWRpb1BsdWdpbiA9IHZvaWQgMDtcbnZhciBXZWJBdWRpb0Fzc2V0XzEgPSByZXF1aXJlKFwiLi9XZWJBdWRpb0Fzc2V0XCIpO1xudmFyIFdlYkF1ZGlvUGxheWVyXzEgPSByZXF1aXJlKFwiLi9XZWJBdWRpb1BsYXllclwiKTtcbnZhciBhdXRvUGxheUhlbHBlciA9IHJlcXVpcmUoXCIuL1dlYkF1ZGlvQXV0b3BsYXlIZWxwZXJcIik7XG52YXIgV2ViQXVkaW9QbHVnaW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgLyogdHNsaW50OmVuYWJsZTp0eXBlZGVmICovXG4gICAgZnVuY3Rpb24gV2ViQXVkaW9QbHVnaW4oKSB7XG4gICAgICAgIHRoaXMuc3VwcG9ydGVkRm9ybWF0cyA9IHRoaXMuX2RldGVjdFN1cHBvcnRlZEZvcm1hdHMoKTtcbiAgICAgICAgYXV0b1BsYXlIZWxwZXIuc2V0dXBDaHJvbWVNRUlXb3JrYXJvdW5kKCk7XG4gICAgfVxuICAgIC8vIEF1ZGlvQ29udGV4dOOBjOWtmOWcqOOBmeOCi+OBi+OBqeOBhuOBi+OBp+WIpOWumuOBmeOCi1xuICAgIC8vIGh0dHA6Ly9tb2hheW9uYW8uaGF0ZW5hYmxvZy5jb20vZW50cnkvMjAxMi8xMi8xMi8xMDMwMDlcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vTW9kZXJuaXpyL01vZGVybml6ci9ibG9iL21hc3Rlci9mZWF0dXJlLWRldGVjdHMvYXVkaW8vd2ViYXVkaW8uanNcbiAgICBXZWJBdWRpb1BsdWdpbi5pc1N1cHBvcnRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKFwiQXVkaW9Db250ZXh0XCIgaW4gd2luZG93KSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChcIndlYmtpdEF1ZGlvQ29udGV4dFwiIGluIHdpbmRvdykge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYkF1ZGlvUGx1Z2luLnByb3RvdHlwZSwgXCJzdXBwb3J0ZWRGb3JtYXRzXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc3VwcG9ydGVkRm9ybWF0cztcbiAgICAgICAgfSxcbiAgICAgICAgLy8gVFNMaW5044Gu44OQ44KwIC0gc2V0dGVy44GvcmV0dXJuIHR5cGXjgpLmm7jjgY/jgajjgrPjg7Pjg5HjgqTjg6vjgqjjg6njg7zjgajjgarjgotcbiAgICAgICAgLyogdHNsaW50OmRpc2FibGU6dHlwZWRlZiAqL1xuICAgICAgICAvLyBXZWJBdWRpb0Fzc2V044G444K144Od44O844OI44GX44Gm44GE44KL44OV44Kp44O844Oe44OD44OI5LiA6Kan44KS5rih44GZXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHN1cHBvcnRlZEZvcm1hdHMpIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cHBvcnRlZEZvcm1hdHMgPSBzdXBwb3J0ZWRGb3JtYXRzO1xuICAgICAgICAgICAgV2ViQXVkaW9Bc3NldF8xLldlYkF1ZGlvQXNzZXQuc3VwcG9ydGVkRm9ybWF0cyA9IHN1cHBvcnRlZEZvcm1hdHM7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBXZWJBdWRpb1BsdWdpbi5wcm90b3R5cGUuY3JlYXRlQXNzZXQgPSBmdW5jdGlvbiAoaWQsIGFzc2V0UGF0aCwgZHVyYXRpb24sIHN5c3RlbSwgbG9vcCwgaGludCkge1xuICAgICAgICByZXR1cm4gbmV3IFdlYkF1ZGlvQXNzZXRfMS5XZWJBdWRpb0Fzc2V0KGlkLCBhc3NldFBhdGgsIGR1cmF0aW9uLCBzeXN0ZW0sIGxvb3AsIGhpbnQpO1xuICAgIH07XG4gICAgV2ViQXVkaW9QbHVnaW4ucHJvdG90eXBlLmNyZWF0ZVBsYXllciA9IGZ1bmN0aW9uIChzeXN0ZW0sIG1hbmFnZXIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBXZWJBdWRpb1BsYXllcl8xLldlYkF1ZGlvUGxheWVyKHN5c3RlbSwgbWFuYWdlcik7XG4gICAgfTtcbiAgICBXZWJBdWRpb1BsdWdpbi5wcm90b3R5cGUuX2RldGVjdFN1cHBvcnRlZEZvcm1hdHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIEVkZ2Xjga/lho3nlJ/jgafjgY3jgovjg5XjgqHjgqTjg6vlvaLlvI/jgahjYW5QbGF5VHlwZeOBrue1kOaenOOBjOS4gOiHtOOBl+OBquOBhOOBn+OCgeOAgeWbuuWumuOBp0FBQ+OCkuWIqeeUqOOBmeOCi1xuICAgICAgICBpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiRWRnZS9cIikgIT09IC0xKVxuICAgICAgICAgICAgcmV0dXJuIFtcImFhY1wiXTtcbiAgICAgICAgLy8gQXVkaW/opoHntKDjgpLlrp/pmpvjgavkvZzjgaPjgabjgIFjYW5QbGF5VHlwZeOBp+WGjeeUn+OBp+OBjeOCi+OBi+OCkuWIpOWumuOBmeOCi1xuICAgICAgICB2YXIgYXVkaW9FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImF1ZGlvXCIpO1xuICAgICAgICB2YXIgc3VwcG9ydGVkRm9ybWF0cyA9IFtdO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIHN1cHBvcnRlZEV4dGVuc2lvbnMgPSBbXCJvZ2dcIiwgXCJhYWNcIiwgXCJtcDRcIl07XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gc3VwcG9ydGVkRXh0ZW5zaW9ucy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBleHQgPSBzdXBwb3J0ZWRFeHRlbnNpb25zW2ldO1xuICAgICAgICAgICAgICAgIHZhciBjYW5QbGF5ID0gYXVkaW9FbGVtZW50LmNhblBsYXlUeXBlKFwiYXVkaW8vXCIgKyBleHQpO1xuICAgICAgICAgICAgICAgIHZhciBzdXBwb3J0ZWQgPSAoY2FuUGxheSAhPT0gXCJub1wiICYmIGNhblBsYXkgIT09IFwiXCIpO1xuICAgICAgICAgICAgICAgIGlmIChzdXBwb3J0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydGVkRm9ybWF0cy5wdXNoKGV4dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBpZ25vcmUgRXJyb3JcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3VwcG9ydGVkRm9ybWF0cztcbiAgICB9O1xuICAgIHJldHVybiBXZWJBdWRpb1BsdWdpbjtcbn0oKSk7XG5leHBvcnRzLldlYkF1ZGlvUGx1Z2luID0gV2ViQXVkaW9QbHVnaW47XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuWEhSTG9hZGVyID0gdm9pZCAwO1xudmFyIGcgPSByZXF1aXJlKFwiQGFrYXNoaWMvYWthc2hpYy1lbmdpbmVcIik7XG52YXIgWEhSTG9hZGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFhIUkxvYWRlcihvcHRpb25zKSB7XG4gICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XG4gICAgICAgIC8vIOODh+ODleOCqeODq+ODiOOBruOCv+OCpOODoOOCouOCpuODiOOBrzE156eSXG4gICAgICAgIC8vIFRPRE86IOOCv+OCpOODoOOCouOCpuODiOWApOOBr+OBk+OCjOOBjOWmpeW9k+OBp+OBguOCi+OBi+W+jOaXpeips+e0sOOCkuaknOiojuOBmeOCi1xuICAgICAgICB0aGlzLnRpbWVvdXQgPSBvcHRpb25zLnRpbWVvdXQgfHwgMTUwMDA7XG4gICAgfVxuICAgIFhIUkxvYWRlci5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKHVybCwgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fZ2V0UmVxdWVzdE9iamVjdCh7XG4gICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogXCJ0ZXh0XCJcbiAgICAgICAgfSwgY2FsbGJhY2spO1xuICAgIH07XG4gICAgWEhSTG9hZGVyLnByb3RvdHlwZS5nZXRBcnJheUJ1ZmZlciA9IGZ1bmN0aW9uICh1cmwsIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2dldFJlcXVlc3RPYmplY3Qoe1xuICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICByZXNwb25zZVR5cGU6IFwiYXJyYXlidWZmZXJcIlxuICAgICAgICB9LCBjYWxsYmFjayk7XG4gICAgfTtcbiAgICBYSFJMb2FkZXIucHJvdG90eXBlLl9nZXRSZXF1ZXN0T2JqZWN0ID0gZnVuY3Rpb24gKHJlcXVlc3RPYmplY3QsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHJlcXVlc3Qub3BlbihcIkdFVFwiLCByZXF1ZXN0T2JqZWN0LnVybCwgdHJ1ZSk7XG4gICAgICAgIHJlcXVlc3QucmVzcG9uc2VUeXBlID0gcmVxdWVzdE9iamVjdC5yZXNwb25zZVR5cGU7XG4gICAgICAgIHJlcXVlc3QudGltZW91dCA9IHRoaXMudGltZW91dDtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKFwidGltZW91dFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXRMb2FkRXJyb3IoXCJsb2FkaW5nIHRpbWVvdXRcIikpO1xuICAgICAgICB9LCBmYWxzZSk7XG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzID49IDIwMCAmJiByZXF1ZXN0LnN0YXR1cyA8IDMwMCkge1xuICAgICAgICAgICAgICAgIC8vIFwidGV4dFwiIOOBqOOBneOCjOS7peWkluOBp+WPluW+l+aWueazleOCkuWIhumhnuOBmeOCi1xuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IHJlcXVlc3RPYmplY3QucmVzcG9uc2VUeXBlID09PSBcInRleHRcIiA/IHJlcXVlc3QucmVzcG9uc2VUZXh0IDogcmVxdWVzdC5yZXNwb25zZTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXRMb2FkRXJyb3IoXCJsb2FkaW5nIGVycm9yLiBzdGF0dXM6IFwiICsgcmVxdWVzdC5zdGF0dXMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZmFsc2UpO1xuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhnLkV4Y2VwdGlvbkZhY3RvcnkuY3JlYXRlQXNzZXRMb2FkRXJyb3IoXCJsb2FkaW5nIGVycm9yLiBzdGF0dXM6IFwiICsgcmVxdWVzdC5zdGF0dXMpKTtcbiAgICAgICAgfSwgZmFsc2UpO1xuICAgICAgICByZXF1ZXN0LnNlbmQoKTtcbiAgICB9O1xuICAgIHJldHVybiBYSFJMb2FkZXI7XG59KCkpO1xuZXhwb3J0cy5YSFJMb2FkZXIgPSBYSFJMb2FkZXI7XG4iLCIvKiFcbiAqIEBvdmVydmlldyBlczYtcHJvbWlzZSAtIGEgdGlueSBpbXBsZW1lbnRhdGlvbiBvZiBQcm9taXNlcy9BKy5cbiAqIEBjb3B5cmlnaHQgQ29weXJpZ2h0IChjKSAyMDE0IFllaHVkYSBLYXR6LCBUb20gRGFsZSwgU3RlZmFuIFBlbm5lciBhbmQgY29udHJpYnV0b3JzIChDb252ZXJzaW9uIHRvIEVTNiBBUEkgYnkgSmFrZSBBcmNoaWJhbGQpXG4gKiBAbGljZW5zZSAgIExpY2Vuc2VkIHVuZGVyIE1JVCBsaWNlbnNlXG4gKiAgICAgICAgICAgIFNlZSBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vc3RlZmFucGVubmVyL2VzNi1wcm9taXNlL21hc3Rlci9MSUNFTlNFXG4gKiBAdmVyc2lvbiAgIHY0LjIuOCsxZTY4ZGNlNlxuICovXG5cbihmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7XG5cdHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyA/IG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpIDpcblx0dHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKGZhY3RvcnkpIDpcblx0KGdsb2JhbC5FUzZQcm9taXNlID0gZmFjdG9yeSgpKTtcbn0odGhpcywgKGZ1bmN0aW9uICgpIHsgJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBvYmplY3RPckZ1bmN0aW9uKHgpIHtcbiAgdmFyIHR5cGUgPSB0eXBlb2YgeDtcbiAgcmV0dXJuIHggIT09IG51bGwgJiYgKHR5cGUgPT09ICdvYmplY3QnIHx8IHR5cGUgPT09ICdmdW5jdGlvbicpO1xufVxuXG5mdW5jdGlvbiBpc0Z1bmN0aW9uKHgpIHtcbiAgcmV0dXJuIHR5cGVvZiB4ID09PSAnZnVuY3Rpb24nO1xufVxuXG5cblxudmFyIF9pc0FycmF5ID0gdm9pZCAwO1xuaWYgKEFycmF5LmlzQXJyYXkpIHtcbiAgX2lzQXJyYXkgPSBBcnJheS5pc0FycmF5O1xufSBlbHNlIHtcbiAgX2lzQXJyYXkgPSBmdW5jdGlvbiAoeCkge1xuICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoeCkgPT09ICdbb2JqZWN0IEFycmF5XSc7XG4gIH07XG59XG5cbnZhciBpc0FycmF5ID0gX2lzQXJyYXk7XG5cbnZhciBsZW4gPSAwO1xudmFyIHZlcnR4TmV4dCA9IHZvaWQgMDtcbnZhciBjdXN0b21TY2hlZHVsZXJGbiA9IHZvaWQgMDtcblxudmFyIGFzYXAgPSBmdW5jdGlvbiBhc2FwKGNhbGxiYWNrLCBhcmcpIHtcbiAgcXVldWVbbGVuXSA9IGNhbGxiYWNrO1xuICBxdWV1ZVtsZW4gKyAxXSA9IGFyZztcbiAgbGVuICs9IDI7XG4gIGlmIChsZW4gPT09IDIpIHtcbiAgICAvLyBJZiBsZW4gaXMgMiwgdGhhdCBtZWFucyB0aGF0IHdlIG5lZWQgdG8gc2NoZWR1bGUgYW4gYXN5bmMgZmx1c2guXG4gICAgLy8gSWYgYWRkaXRpb25hbCBjYWxsYmFja3MgYXJlIHF1ZXVlZCBiZWZvcmUgdGhlIHF1ZXVlIGlzIGZsdXNoZWQsIHRoZXlcbiAgICAvLyB3aWxsIGJlIHByb2Nlc3NlZCBieSB0aGlzIGZsdXNoIHRoYXQgd2UgYXJlIHNjaGVkdWxpbmcuXG4gICAgaWYgKGN1c3RvbVNjaGVkdWxlckZuKSB7XG4gICAgICBjdXN0b21TY2hlZHVsZXJGbihmbHVzaCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNjaGVkdWxlRmx1c2goKTtcbiAgICB9XG4gIH1cbn07XG5cbmZ1bmN0aW9uIHNldFNjaGVkdWxlcihzY2hlZHVsZUZuKSB7XG4gIGN1c3RvbVNjaGVkdWxlckZuID0gc2NoZWR1bGVGbjtcbn1cblxuZnVuY3Rpb24gc2V0QXNhcChhc2FwRm4pIHtcbiAgYXNhcCA9IGFzYXBGbjtcbn1cblxudmFyIGJyb3dzZXJXaW5kb3cgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHVuZGVmaW5lZDtcbnZhciBicm93c2VyR2xvYmFsID0gYnJvd3NlcldpbmRvdyB8fCB7fTtcbnZhciBCcm93c2VyTXV0YXRpb25PYnNlcnZlciA9IGJyb3dzZXJHbG9iYWwuTXV0YXRpb25PYnNlcnZlciB8fCBicm93c2VyR2xvYmFsLldlYktpdE11dGF0aW9uT2JzZXJ2ZXI7XG52YXIgaXNOb2RlID0gdHlwZW9mIHNlbGYgPT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiB7fS50b1N0cmluZy5jYWxsKHByb2Nlc3MpID09PSAnW29iamVjdCBwcm9jZXNzXSc7XG5cbi8vIHRlc3QgZm9yIHdlYiB3b3JrZXIgYnV0IG5vdCBpbiBJRTEwXG52YXIgaXNXb3JrZXIgPSB0eXBlb2YgVWludDhDbGFtcGVkQXJyYXkgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBpbXBvcnRTY3JpcHRzICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgTWVzc2FnZUNoYW5uZWwgIT09ICd1bmRlZmluZWQnO1xuXG4vLyBub2RlXG5mdW5jdGlvbiB1c2VOZXh0VGljaygpIHtcbiAgLy8gbm9kZSB2ZXJzaW9uIDAuMTAueCBkaXNwbGF5cyBhIGRlcHJlY2F0aW9uIHdhcm5pbmcgd2hlbiBuZXh0VGljayBpcyB1c2VkIHJlY3Vyc2l2ZWx5XG4gIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vY3Vqb2pzL3doZW4vaXNzdWVzLzQxMCBmb3IgZGV0YWlsc1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBwcm9jZXNzLm5leHRUaWNrKGZsdXNoKTtcbiAgfTtcbn1cblxuLy8gdmVydHhcbmZ1bmN0aW9uIHVzZVZlcnR4VGltZXIoKSB7XG4gIGlmICh0eXBlb2YgdmVydHhOZXh0ICE9PSAndW5kZWZpbmVkJykge1xuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICB2ZXJ0eE5leHQoZmx1c2gpO1xuICAgIH07XG4gIH1cblxuICByZXR1cm4gdXNlU2V0VGltZW91dCgpO1xufVxuXG5mdW5jdGlvbiB1c2VNdXRhdGlvbk9ic2VydmVyKCkge1xuICB2YXIgaXRlcmF0aW9ucyA9IDA7XG4gIHZhciBvYnNlcnZlciA9IG5ldyBCcm93c2VyTXV0YXRpb25PYnNlcnZlcihmbHVzaCk7XG4gIHZhciBub2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycpO1xuICBvYnNlcnZlci5vYnNlcnZlKG5vZGUsIHsgY2hhcmFjdGVyRGF0YTogdHJ1ZSB9KTtcblxuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIG5vZGUuZGF0YSA9IGl0ZXJhdGlvbnMgPSArK2l0ZXJhdGlvbnMgJSAyO1xuICB9O1xufVxuXG4vLyB3ZWIgd29ya2VyXG5mdW5jdGlvbiB1c2VNZXNzYWdlQ2hhbm5lbCgpIHtcbiAgdmFyIGNoYW5uZWwgPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTtcbiAgY2hhbm5lbC5wb3J0MS5vbm1lc3NhZ2UgPSBmbHVzaDtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gY2hhbm5lbC5wb3J0Mi5wb3N0TWVzc2FnZSgwKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gdXNlU2V0VGltZW91dCgpIHtcbiAgLy8gU3RvcmUgc2V0VGltZW91dCByZWZlcmVuY2Ugc28gZXM2LXByb21pc2Ugd2lsbCBiZSB1bmFmZmVjdGVkIGJ5XG4gIC8vIG90aGVyIGNvZGUgbW9kaWZ5aW5nIHNldFRpbWVvdXQgKGxpa2Ugc2lub24udXNlRmFrZVRpbWVycygpKVxuICB2YXIgZ2xvYmFsU2V0VGltZW91dCA9IHNldFRpbWVvdXQ7XG4gIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGdsb2JhbFNldFRpbWVvdXQoZmx1c2gsIDEpO1xuICB9O1xufVxuXG52YXIgcXVldWUgPSBuZXcgQXJyYXkoMTAwMCk7XG5mdW5jdGlvbiBmbHVzaCgpIHtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkgKz0gMikge1xuICAgIHZhciBjYWxsYmFjayA9IHF1ZXVlW2ldO1xuICAgIHZhciBhcmcgPSBxdWV1ZVtpICsgMV07XG5cbiAgICBjYWxsYmFjayhhcmcpO1xuXG4gICAgcXVldWVbaV0gPSB1bmRlZmluZWQ7XG4gICAgcXVldWVbaSArIDFdID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgbGVuID0gMDtcbn1cblxuZnVuY3Rpb24gYXR0ZW1wdFZlcnR4KCkge1xuICB0cnkge1xuICAgIHZhciB2ZXJ0eCA9IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCkucmVxdWlyZSgndmVydHgnKTtcbiAgICB2ZXJ0eE5leHQgPSB2ZXJ0eC5ydW5Pbkxvb3AgfHwgdmVydHgucnVuT25Db250ZXh0O1xuICAgIHJldHVybiB1c2VWZXJ0eFRpbWVyKCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4gdXNlU2V0VGltZW91dCgpO1xuICB9XG59XG5cbnZhciBzY2hlZHVsZUZsdXNoID0gdm9pZCAwO1xuLy8gRGVjaWRlIHdoYXQgYXN5bmMgbWV0aG9kIHRvIHVzZSB0byB0cmlnZ2VyaW5nIHByb2Nlc3Npbmcgb2YgcXVldWVkIGNhbGxiYWNrczpcbmlmIChpc05vZGUpIHtcbiAgc2NoZWR1bGVGbHVzaCA9IHVzZU5leHRUaWNrKCk7XG59IGVsc2UgaWYgKEJyb3dzZXJNdXRhdGlvbk9ic2VydmVyKSB7XG4gIHNjaGVkdWxlRmx1c2ggPSB1c2VNdXRhdGlvbk9ic2VydmVyKCk7XG59IGVsc2UgaWYgKGlzV29ya2VyKSB7XG4gIHNjaGVkdWxlRmx1c2ggPSB1c2VNZXNzYWdlQ2hhbm5lbCgpO1xufSBlbHNlIGlmIChicm93c2VyV2luZG93ID09PSB1bmRlZmluZWQgJiYgdHlwZW9mIHJlcXVpcmUgPT09ICdmdW5jdGlvbicpIHtcbiAgc2NoZWR1bGVGbHVzaCA9IGF0dGVtcHRWZXJ0eCgpO1xufSBlbHNlIHtcbiAgc2NoZWR1bGVGbHVzaCA9IHVzZVNldFRpbWVvdXQoKTtcbn1cblxuZnVuY3Rpb24gdGhlbihvbkZ1bGZpbGxtZW50LCBvblJlamVjdGlvbikge1xuICB2YXIgcGFyZW50ID0gdGhpcztcblxuICB2YXIgY2hpbGQgPSBuZXcgdGhpcy5jb25zdHJ1Y3Rvcihub29wKTtcblxuICBpZiAoY2hpbGRbUFJPTUlTRV9JRF0gPT09IHVuZGVmaW5lZCkge1xuICAgIG1ha2VQcm9taXNlKGNoaWxkKTtcbiAgfVxuXG4gIHZhciBfc3RhdGUgPSBwYXJlbnQuX3N0YXRlO1xuXG5cbiAgaWYgKF9zdGF0ZSkge1xuICAgIHZhciBjYWxsYmFjayA9IGFyZ3VtZW50c1tfc3RhdGUgLSAxXTtcbiAgICBhc2FwKGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBpbnZva2VDYWxsYmFjayhfc3RhdGUsIGNoaWxkLCBjYWxsYmFjaywgcGFyZW50Ll9yZXN1bHQpO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIHN1YnNjcmliZShwYXJlbnQsIGNoaWxkLCBvbkZ1bGZpbGxtZW50LCBvblJlamVjdGlvbik7XG4gIH1cblxuICByZXR1cm4gY2hpbGQ7XG59XG5cbi8qKlxuICBgUHJvbWlzZS5yZXNvbHZlYCByZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHdpbGwgYmVjb21lIHJlc29sdmVkIHdpdGggdGhlXG4gIHBhc3NlZCBgdmFsdWVgLiBJdCBpcyBzaG9ydGhhbmQgZm9yIHRoZSBmb2xsb3dpbmc6XG5cbiAgYGBgamF2YXNjcmlwdFxuICBsZXQgcHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCl7XG4gICAgcmVzb2x2ZSgxKTtcbiAgfSk7XG5cbiAgcHJvbWlzZS50aGVuKGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAvLyB2YWx1ZSA9PT0gMVxuICB9KTtcbiAgYGBgXG5cbiAgSW5zdGVhZCBvZiB3cml0aW5nIHRoZSBhYm92ZSwgeW91ciBjb2RlIG5vdyBzaW1wbHkgYmVjb21lcyB0aGUgZm9sbG93aW5nOlxuXG4gIGBgYGphdmFzY3JpcHRcbiAgbGV0IHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoMSk7XG5cbiAgcHJvbWlzZS50aGVuKGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAvLyB2YWx1ZSA9PT0gMVxuICB9KTtcbiAgYGBgXG5cbiAgQG1ldGhvZCByZXNvbHZlXG4gIEBzdGF0aWNcbiAgQHBhcmFtIHtBbnl9IHZhbHVlIHZhbHVlIHRoYXQgdGhlIHJldHVybmVkIHByb21pc2Ugd2lsbCBiZSByZXNvbHZlZCB3aXRoXG4gIFVzZWZ1bCBmb3IgdG9vbGluZy5cbiAgQHJldHVybiB7UHJvbWlzZX0gYSBwcm9taXNlIHRoYXQgd2lsbCBiZWNvbWUgZnVsZmlsbGVkIHdpdGggdGhlIGdpdmVuXG4gIGB2YWx1ZWBcbiovXG5mdW5jdGlvbiByZXNvbHZlJDEob2JqZWN0KSB7XG4gIC8qanNoaW50IHZhbGlkdGhpczp0cnVlICovXG4gIHZhciBDb25zdHJ1Y3RvciA9IHRoaXM7XG5cbiAgaWYgKG9iamVjdCAmJiB0eXBlb2Ygb2JqZWN0ID09PSAnb2JqZWN0JyAmJiBvYmplY3QuY29uc3RydWN0b3IgPT09IENvbnN0cnVjdG9yKSB7XG4gICAgcmV0dXJuIG9iamVjdDtcbiAgfVxuXG4gIHZhciBwcm9taXNlID0gbmV3IENvbnN0cnVjdG9yKG5vb3ApO1xuICByZXNvbHZlKHByb21pc2UsIG9iamVjdCk7XG4gIHJldHVybiBwcm9taXNlO1xufVxuXG52YXIgUFJPTUlTRV9JRCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyKTtcblxuZnVuY3Rpb24gbm9vcCgpIHt9XG5cbnZhciBQRU5ESU5HID0gdm9pZCAwO1xudmFyIEZVTEZJTExFRCA9IDE7XG52YXIgUkVKRUNURUQgPSAyO1xuXG5mdW5jdGlvbiBzZWxmRnVsZmlsbG1lbnQoKSB7XG4gIHJldHVybiBuZXcgVHlwZUVycm9yKFwiWW91IGNhbm5vdCByZXNvbHZlIGEgcHJvbWlzZSB3aXRoIGl0c2VsZlwiKTtcbn1cblxuZnVuY3Rpb24gY2Fubm90UmV0dXJuT3duKCkge1xuICByZXR1cm4gbmV3IFR5cGVFcnJvcignQSBwcm9taXNlcyBjYWxsYmFjayBjYW5ub3QgcmV0dXJuIHRoYXQgc2FtZSBwcm9taXNlLicpO1xufVxuXG5mdW5jdGlvbiB0cnlUaGVuKHRoZW4kJDEsIHZhbHVlLCBmdWxmaWxsbWVudEhhbmRsZXIsIHJlamVjdGlvbkhhbmRsZXIpIHtcbiAgdHJ5IHtcbiAgICB0aGVuJCQxLmNhbGwodmFsdWUsIGZ1bGZpbGxtZW50SGFuZGxlciwgcmVqZWN0aW9uSGFuZGxlcik7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4gZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBoYW5kbGVGb3JlaWduVGhlbmFibGUocHJvbWlzZSwgdGhlbmFibGUsIHRoZW4kJDEpIHtcbiAgYXNhcChmdW5jdGlvbiAocHJvbWlzZSkge1xuICAgIHZhciBzZWFsZWQgPSBmYWxzZTtcbiAgICB2YXIgZXJyb3IgPSB0cnlUaGVuKHRoZW4kJDEsIHRoZW5hYmxlLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIGlmIChzZWFsZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgc2VhbGVkID0gdHJ1ZTtcbiAgICAgIGlmICh0aGVuYWJsZSAhPT0gdmFsdWUpIHtcbiAgICAgICAgcmVzb2x2ZShwcm9taXNlLCB2YWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmdWxmaWxsKHByb21pc2UsIHZhbHVlKTtcbiAgICAgIH1cbiAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XG4gICAgICBpZiAoc2VhbGVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHNlYWxlZCA9IHRydWU7XG5cbiAgICAgIHJlamVjdChwcm9taXNlLCByZWFzb24pO1xuICAgIH0sICdTZXR0bGU6ICcgKyAocHJvbWlzZS5fbGFiZWwgfHwgJyB1bmtub3duIHByb21pc2UnKSk7XG5cbiAgICBpZiAoIXNlYWxlZCAmJiBlcnJvcikge1xuICAgICAgc2VhbGVkID0gdHJ1ZTtcbiAgICAgIHJlamVjdChwcm9taXNlLCBlcnJvcik7XG4gICAgfVxuICB9LCBwcm9taXNlKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlT3duVGhlbmFibGUocHJvbWlzZSwgdGhlbmFibGUpIHtcbiAgaWYgKHRoZW5hYmxlLl9zdGF0ZSA9PT0gRlVMRklMTEVEKSB7XG4gICAgZnVsZmlsbChwcm9taXNlLCB0aGVuYWJsZS5fcmVzdWx0KTtcbiAgfSBlbHNlIGlmICh0aGVuYWJsZS5fc3RhdGUgPT09IFJFSkVDVEVEKSB7XG4gICAgcmVqZWN0KHByb21pc2UsIHRoZW5hYmxlLl9yZXN1bHQpO1xuICB9IGVsc2Uge1xuICAgIHN1YnNjcmliZSh0aGVuYWJsZSwgdW5kZWZpbmVkLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHJldHVybiByZXNvbHZlKHByb21pc2UsIHZhbHVlKTtcbiAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XG4gICAgICByZXR1cm4gcmVqZWN0KHByb21pc2UsIHJlYXNvbik7XG4gICAgfSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaGFuZGxlTWF5YmVUaGVuYWJsZShwcm9taXNlLCBtYXliZVRoZW5hYmxlLCB0aGVuJCQxKSB7XG4gIGlmIChtYXliZVRoZW5hYmxlLmNvbnN0cnVjdG9yID09PSBwcm9taXNlLmNvbnN0cnVjdG9yICYmIHRoZW4kJDEgPT09IHRoZW4gJiYgbWF5YmVUaGVuYWJsZS5jb25zdHJ1Y3Rvci5yZXNvbHZlID09PSByZXNvbHZlJDEpIHtcbiAgICBoYW5kbGVPd25UaGVuYWJsZShwcm9taXNlLCBtYXliZVRoZW5hYmxlKTtcbiAgfSBlbHNlIHtcbiAgICBpZiAodGhlbiQkMSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBmdWxmaWxsKHByb21pc2UsIG1heWJlVGhlbmFibGUpO1xuICAgIH0gZWxzZSBpZiAoaXNGdW5jdGlvbih0aGVuJCQxKSkge1xuICAgICAgaGFuZGxlRm9yZWlnblRoZW5hYmxlKHByb21pc2UsIG1heWJlVGhlbmFibGUsIHRoZW4kJDEpO1xuICAgIH0gZWxzZSB7XG4gICAgICBmdWxmaWxsKHByb21pc2UsIG1heWJlVGhlbmFibGUpO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiByZXNvbHZlKHByb21pc2UsIHZhbHVlKSB7XG4gIGlmIChwcm9taXNlID09PSB2YWx1ZSkge1xuICAgIHJlamVjdChwcm9taXNlLCBzZWxmRnVsZmlsbG1lbnQoKSk7XG4gIH0gZWxzZSBpZiAob2JqZWN0T3JGdW5jdGlvbih2YWx1ZSkpIHtcbiAgICB2YXIgdGhlbiQkMSA9IHZvaWQgMDtcbiAgICB0cnkge1xuICAgICAgdGhlbiQkMSA9IHZhbHVlLnRoZW47XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJlamVjdChwcm9taXNlLCBlcnJvcik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGhhbmRsZU1heWJlVGhlbmFibGUocHJvbWlzZSwgdmFsdWUsIHRoZW4kJDEpO1xuICB9IGVsc2Uge1xuICAgIGZ1bGZpbGwocHJvbWlzZSwgdmFsdWUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHB1Ymxpc2hSZWplY3Rpb24ocHJvbWlzZSkge1xuICBpZiAocHJvbWlzZS5fb25lcnJvcikge1xuICAgIHByb21pc2UuX29uZXJyb3IocHJvbWlzZS5fcmVzdWx0KTtcbiAgfVxuXG4gIHB1Ymxpc2gocHJvbWlzZSk7XG59XG5cbmZ1bmN0aW9uIGZ1bGZpbGwocHJvbWlzZSwgdmFsdWUpIHtcbiAgaWYgKHByb21pc2UuX3N0YXRlICE9PSBQRU5ESU5HKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcHJvbWlzZS5fcmVzdWx0ID0gdmFsdWU7XG4gIHByb21pc2UuX3N0YXRlID0gRlVMRklMTEVEO1xuXG4gIGlmIChwcm9taXNlLl9zdWJzY3JpYmVycy5sZW5ndGggIT09IDApIHtcbiAgICBhc2FwKHB1Ymxpc2gsIHByb21pc2UpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHJlamVjdChwcm9taXNlLCByZWFzb24pIHtcbiAgaWYgKHByb21pc2UuX3N0YXRlICE9PSBQRU5ESU5HKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHByb21pc2UuX3N0YXRlID0gUkVKRUNURUQ7XG4gIHByb21pc2UuX3Jlc3VsdCA9IHJlYXNvbjtcblxuICBhc2FwKHB1Ymxpc2hSZWplY3Rpb24sIHByb21pc2UpO1xufVxuXG5mdW5jdGlvbiBzdWJzY3JpYmUocGFyZW50LCBjaGlsZCwgb25GdWxmaWxsbWVudCwgb25SZWplY3Rpb24pIHtcbiAgdmFyIF9zdWJzY3JpYmVycyA9IHBhcmVudC5fc3Vic2NyaWJlcnM7XG4gIHZhciBsZW5ndGggPSBfc3Vic2NyaWJlcnMubGVuZ3RoO1xuXG5cbiAgcGFyZW50Ll9vbmVycm9yID0gbnVsbDtcblxuICBfc3Vic2NyaWJlcnNbbGVuZ3RoXSA9IGNoaWxkO1xuICBfc3Vic2NyaWJlcnNbbGVuZ3RoICsgRlVMRklMTEVEXSA9IG9uRnVsZmlsbG1lbnQ7XG4gIF9zdWJzY3JpYmVyc1tsZW5ndGggKyBSRUpFQ1RFRF0gPSBvblJlamVjdGlvbjtcblxuICBpZiAobGVuZ3RoID09PSAwICYmIHBhcmVudC5fc3RhdGUpIHtcbiAgICBhc2FwKHB1Ymxpc2gsIHBhcmVudCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gcHVibGlzaChwcm9taXNlKSB7XG4gIHZhciBzdWJzY3JpYmVycyA9IHByb21pc2UuX3N1YnNjcmliZXJzO1xuICB2YXIgc2V0dGxlZCA9IHByb21pc2UuX3N0YXRlO1xuXG4gIGlmIChzdWJzY3JpYmVycy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgY2hpbGQgPSB2b2lkIDAsXG4gICAgICBjYWxsYmFjayA9IHZvaWQgMCxcbiAgICAgIGRldGFpbCA9IHByb21pc2UuX3Jlc3VsdDtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IHN1YnNjcmliZXJzLmxlbmd0aDsgaSArPSAzKSB7XG4gICAgY2hpbGQgPSBzdWJzY3JpYmVyc1tpXTtcbiAgICBjYWxsYmFjayA9IHN1YnNjcmliZXJzW2kgKyBzZXR0bGVkXTtcblxuICAgIGlmIChjaGlsZCkge1xuICAgICAgaW52b2tlQ2FsbGJhY2soc2V0dGxlZCwgY2hpbGQsIGNhbGxiYWNrLCBkZXRhaWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYWxsYmFjayhkZXRhaWwpO1xuICAgIH1cbiAgfVxuXG4gIHByb21pc2UuX3N1YnNjcmliZXJzLmxlbmd0aCA9IDA7XG59XG5cbmZ1bmN0aW9uIGludm9rZUNhbGxiYWNrKHNldHRsZWQsIHByb21pc2UsIGNhbGxiYWNrLCBkZXRhaWwpIHtcbiAgdmFyIGhhc0NhbGxiYWNrID0gaXNGdW5jdGlvbihjYWxsYmFjayksXG4gICAgICB2YWx1ZSA9IHZvaWQgMCxcbiAgICAgIGVycm9yID0gdm9pZCAwLFxuICAgICAgc3VjY2VlZGVkID0gdHJ1ZTtcblxuICBpZiAoaGFzQ2FsbGJhY2spIHtcbiAgICB0cnkge1xuICAgICAgdmFsdWUgPSBjYWxsYmFjayhkZXRhaWwpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHN1Y2NlZWRlZCA9IGZhbHNlO1xuICAgICAgZXJyb3IgPSBlO1xuICAgIH1cblxuICAgIGlmIChwcm9taXNlID09PSB2YWx1ZSkge1xuICAgICAgcmVqZWN0KHByb21pc2UsIGNhbm5vdFJldHVybk93bigpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdmFsdWUgPSBkZXRhaWw7XG4gIH1cblxuICBpZiAocHJvbWlzZS5fc3RhdGUgIT09IFBFTkRJTkcpIHtcbiAgICAvLyBub29wXG4gIH0gZWxzZSBpZiAoaGFzQ2FsbGJhY2sgJiYgc3VjY2VlZGVkKSB7XG4gICAgcmVzb2x2ZShwcm9taXNlLCB2YWx1ZSk7XG4gIH0gZWxzZSBpZiAoc3VjY2VlZGVkID09PSBmYWxzZSkge1xuICAgIHJlamVjdChwcm9taXNlLCBlcnJvcik7XG4gIH0gZWxzZSBpZiAoc2V0dGxlZCA9PT0gRlVMRklMTEVEKSB7XG4gICAgZnVsZmlsbChwcm9taXNlLCB2YWx1ZSk7XG4gIH0gZWxzZSBpZiAoc2V0dGxlZCA9PT0gUkVKRUNURUQpIHtcbiAgICByZWplY3QocHJvbWlzZSwgdmFsdWUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGluaXRpYWxpemVQcm9taXNlKHByb21pc2UsIHJlc29sdmVyKSB7XG4gIHRyeSB7XG4gICAgcmVzb2x2ZXIoZnVuY3Rpb24gcmVzb2x2ZVByb21pc2UodmFsdWUpIHtcbiAgICAgIHJlc29sdmUocHJvbWlzZSwgdmFsdWUpO1xuICAgIH0sIGZ1bmN0aW9uIHJlamVjdFByb21pc2UocmVhc29uKSB7XG4gICAgICByZWplY3QocHJvbWlzZSwgcmVhc29uKTtcbiAgICB9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJlamVjdChwcm9taXNlLCBlKTtcbiAgfVxufVxuXG52YXIgaWQgPSAwO1xuZnVuY3Rpb24gbmV4dElkKCkge1xuICByZXR1cm4gaWQrKztcbn1cblxuZnVuY3Rpb24gbWFrZVByb21pc2UocHJvbWlzZSkge1xuICBwcm9taXNlW1BST01JU0VfSURdID0gaWQrKztcbiAgcHJvbWlzZS5fc3RhdGUgPSB1bmRlZmluZWQ7XG4gIHByb21pc2UuX3Jlc3VsdCA9IHVuZGVmaW5lZDtcbiAgcHJvbWlzZS5fc3Vic2NyaWJlcnMgPSBbXTtcbn1cblxuZnVuY3Rpb24gdmFsaWRhdGlvbkVycm9yKCkge1xuICByZXR1cm4gbmV3IEVycm9yKCdBcnJheSBNZXRob2RzIG11c3QgYmUgcHJvdmlkZWQgYW4gQXJyYXknKTtcbn1cblxudmFyIEVudW1lcmF0b3IgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEVudW1lcmF0b3IoQ29uc3RydWN0b3IsIGlucHV0KSB7XG4gICAgdGhpcy5faW5zdGFuY2VDb25zdHJ1Y3RvciA9IENvbnN0cnVjdG9yO1xuICAgIHRoaXMucHJvbWlzZSA9IG5ldyBDb25zdHJ1Y3Rvcihub29wKTtcblxuICAgIGlmICghdGhpcy5wcm9taXNlW1BST01JU0VfSURdKSB7XG4gICAgICBtYWtlUHJvbWlzZSh0aGlzLnByb21pc2UpO1xuICAgIH1cblxuICAgIGlmIChpc0FycmF5KGlucHV0KSkge1xuICAgICAgdGhpcy5sZW5ndGggPSBpbnB1dC5sZW5ndGg7XG4gICAgICB0aGlzLl9yZW1haW5pbmcgPSBpbnB1dC5sZW5ndGg7XG5cbiAgICAgIHRoaXMuX3Jlc3VsdCA9IG5ldyBBcnJheSh0aGlzLmxlbmd0aCk7XG5cbiAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBmdWxmaWxsKHRoaXMucHJvbWlzZSwgdGhpcy5fcmVzdWx0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy5sZW5ndGggfHwgMDtcbiAgICAgICAgdGhpcy5fZW51bWVyYXRlKGlucHV0KTtcbiAgICAgICAgaWYgKHRoaXMuX3JlbWFpbmluZyA9PT0gMCkge1xuICAgICAgICAgIGZ1bGZpbGwodGhpcy5wcm9taXNlLCB0aGlzLl9yZXN1bHQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlamVjdCh0aGlzLnByb21pc2UsIHZhbGlkYXRpb25FcnJvcigpKTtcbiAgICB9XG4gIH1cblxuICBFbnVtZXJhdG9yLnByb3RvdHlwZS5fZW51bWVyYXRlID0gZnVuY3Rpb24gX2VudW1lcmF0ZShpbnB1dCkge1xuICAgIGZvciAodmFyIGkgPSAwOyB0aGlzLl9zdGF0ZSA9PT0gUEVORElORyAmJiBpIDwgaW5wdXQubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMuX2VhY2hFbnRyeShpbnB1dFtpXSwgaSk7XG4gICAgfVxuICB9O1xuXG4gIEVudW1lcmF0b3IucHJvdG90eXBlLl9lYWNoRW50cnkgPSBmdW5jdGlvbiBfZWFjaEVudHJ5KGVudHJ5LCBpKSB7XG4gICAgdmFyIGMgPSB0aGlzLl9pbnN0YW5jZUNvbnN0cnVjdG9yO1xuICAgIHZhciByZXNvbHZlJCQxID0gYy5yZXNvbHZlO1xuXG5cbiAgICBpZiAocmVzb2x2ZSQkMSA9PT0gcmVzb2x2ZSQxKSB7XG4gICAgICB2YXIgX3RoZW4gPSB2b2lkIDA7XG4gICAgICB2YXIgZXJyb3IgPSB2b2lkIDA7XG4gICAgICB2YXIgZGlkRXJyb3IgPSBmYWxzZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIF90aGVuID0gZW50cnkudGhlbjtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgZGlkRXJyb3IgPSB0cnVlO1xuICAgICAgICBlcnJvciA9IGU7XG4gICAgICB9XG5cbiAgICAgIGlmIChfdGhlbiA9PT0gdGhlbiAmJiBlbnRyeS5fc3RhdGUgIT09IFBFTkRJTkcpIHtcbiAgICAgICAgdGhpcy5fc2V0dGxlZEF0KGVudHJ5Ll9zdGF0ZSwgaSwgZW50cnkuX3Jlc3VsdCk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBfdGhlbiAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aGlzLl9yZW1haW5pbmctLTtcbiAgICAgICAgdGhpcy5fcmVzdWx0W2ldID0gZW50cnk7XG4gICAgICB9IGVsc2UgaWYgKGMgPT09IFByb21pc2UkMSkge1xuICAgICAgICB2YXIgcHJvbWlzZSA9IG5ldyBjKG5vb3ApO1xuICAgICAgICBpZiAoZGlkRXJyb3IpIHtcbiAgICAgICAgICByZWplY3QocHJvbWlzZSwgZXJyb3IpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGhhbmRsZU1heWJlVGhlbmFibGUocHJvbWlzZSwgZW50cnksIF90aGVuKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl93aWxsU2V0dGxlQXQocHJvbWlzZSwgaSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl93aWxsU2V0dGxlQXQobmV3IGMoZnVuY3Rpb24gKHJlc29sdmUkJDEpIHtcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZSQkMShlbnRyeSk7XG4gICAgICAgIH0pLCBpKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fd2lsbFNldHRsZUF0KHJlc29sdmUkJDEoZW50cnkpLCBpKTtcbiAgICB9XG4gIH07XG5cbiAgRW51bWVyYXRvci5wcm90b3R5cGUuX3NldHRsZWRBdCA9IGZ1bmN0aW9uIF9zZXR0bGVkQXQoc3RhdGUsIGksIHZhbHVlKSB7XG4gICAgdmFyIHByb21pc2UgPSB0aGlzLnByb21pc2U7XG5cblxuICAgIGlmIChwcm9taXNlLl9zdGF0ZSA9PT0gUEVORElORykge1xuICAgICAgdGhpcy5fcmVtYWluaW5nLS07XG5cbiAgICAgIGlmIChzdGF0ZSA9PT0gUkVKRUNURUQpIHtcbiAgICAgICAgcmVqZWN0KHByb21pc2UsIHZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX3Jlc3VsdFtpXSA9IHZhbHVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLl9yZW1haW5pbmcgPT09IDApIHtcbiAgICAgIGZ1bGZpbGwocHJvbWlzZSwgdGhpcy5fcmVzdWx0KTtcbiAgICB9XG4gIH07XG5cbiAgRW51bWVyYXRvci5wcm90b3R5cGUuX3dpbGxTZXR0bGVBdCA9IGZ1bmN0aW9uIF93aWxsU2V0dGxlQXQocHJvbWlzZSwgaSkge1xuICAgIHZhciBlbnVtZXJhdG9yID0gdGhpcztcblxuICAgIHN1YnNjcmliZShwcm9taXNlLCB1bmRlZmluZWQsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgcmV0dXJuIGVudW1lcmF0b3IuX3NldHRsZWRBdChGVUxGSUxMRUQsIGksIHZhbHVlKTtcbiAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XG4gICAgICByZXR1cm4gZW51bWVyYXRvci5fc2V0dGxlZEF0KFJFSkVDVEVELCBpLCByZWFzb24pO1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiBFbnVtZXJhdG9yO1xufSgpO1xuXG4vKipcbiAgYFByb21pc2UuYWxsYCBhY2NlcHRzIGFuIGFycmF5IG9mIHByb21pc2VzLCBhbmQgcmV0dXJucyBhIG5ldyBwcm9taXNlIHdoaWNoXG4gIGlzIGZ1bGZpbGxlZCB3aXRoIGFuIGFycmF5IG9mIGZ1bGZpbGxtZW50IHZhbHVlcyBmb3IgdGhlIHBhc3NlZCBwcm9taXNlcywgb3JcbiAgcmVqZWN0ZWQgd2l0aCB0aGUgcmVhc29uIG9mIHRoZSBmaXJzdCBwYXNzZWQgcHJvbWlzZSB0byBiZSByZWplY3RlZC4gSXQgY2FzdHMgYWxsXG4gIGVsZW1lbnRzIG9mIHRoZSBwYXNzZWQgaXRlcmFibGUgdG8gcHJvbWlzZXMgYXMgaXQgcnVucyB0aGlzIGFsZ29yaXRobS5cblxuICBFeGFtcGxlOlxuXG4gIGBgYGphdmFzY3JpcHRcbiAgbGV0IHByb21pc2UxID0gcmVzb2x2ZSgxKTtcbiAgbGV0IHByb21pc2UyID0gcmVzb2x2ZSgyKTtcbiAgbGV0IHByb21pc2UzID0gcmVzb2x2ZSgzKTtcbiAgbGV0IHByb21pc2VzID0gWyBwcm9taXNlMSwgcHJvbWlzZTIsIHByb21pc2UzIF07XG5cbiAgUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24oYXJyYXkpe1xuICAgIC8vIFRoZSBhcnJheSBoZXJlIHdvdWxkIGJlIFsgMSwgMiwgMyBdO1xuICB9KTtcbiAgYGBgXG5cbiAgSWYgYW55IG9mIHRoZSBgcHJvbWlzZXNgIGdpdmVuIHRvIGBhbGxgIGFyZSByZWplY3RlZCwgdGhlIGZpcnN0IHByb21pc2VcbiAgdGhhdCBpcyByZWplY3RlZCB3aWxsIGJlIGdpdmVuIGFzIGFuIGFyZ3VtZW50IHRvIHRoZSByZXR1cm5lZCBwcm9taXNlcydzXG4gIHJlamVjdGlvbiBoYW5kbGVyLiBGb3IgZXhhbXBsZTpcblxuICBFeGFtcGxlOlxuXG4gIGBgYGphdmFzY3JpcHRcbiAgbGV0IHByb21pc2UxID0gcmVzb2x2ZSgxKTtcbiAgbGV0IHByb21pc2UyID0gcmVqZWN0KG5ldyBFcnJvcihcIjJcIikpO1xuICBsZXQgcHJvbWlzZTMgPSByZWplY3QobmV3IEVycm9yKFwiM1wiKSk7XG4gIGxldCBwcm9taXNlcyA9IFsgcHJvbWlzZTEsIHByb21pc2UyLCBwcm9taXNlMyBdO1xuXG4gIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKGZ1bmN0aW9uKGFycmF5KXtcbiAgICAvLyBDb2RlIGhlcmUgbmV2ZXIgcnVucyBiZWNhdXNlIHRoZXJlIGFyZSByZWplY3RlZCBwcm9taXNlcyFcbiAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAvLyBlcnJvci5tZXNzYWdlID09PSBcIjJcIlxuICB9KTtcbiAgYGBgXG5cbiAgQG1ldGhvZCBhbGxcbiAgQHN0YXRpY1xuICBAcGFyYW0ge0FycmF5fSBlbnRyaWVzIGFycmF5IG9mIHByb21pc2VzXG4gIEBwYXJhbSB7U3RyaW5nfSBsYWJlbCBvcHRpb25hbCBzdHJpbmcgZm9yIGxhYmVsaW5nIHRoZSBwcm9taXNlLlxuICBVc2VmdWwgZm9yIHRvb2xpbmcuXG4gIEByZXR1cm4ge1Byb21pc2V9IHByb21pc2UgdGhhdCBpcyBmdWxmaWxsZWQgd2hlbiBhbGwgYHByb21pc2VzYCBoYXZlIGJlZW5cbiAgZnVsZmlsbGVkLCBvciByZWplY3RlZCBpZiBhbnkgb2YgdGhlbSBiZWNvbWUgcmVqZWN0ZWQuXG4gIEBzdGF0aWNcbiovXG5mdW5jdGlvbiBhbGwoZW50cmllcykge1xuICByZXR1cm4gbmV3IEVudW1lcmF0b3IodGhpcywgZW50cmllcykucHJvbWlzZTtcbn1cblxuLyoqXG4gIGBQcm9taXNlLnJhY2VgIHJldHVybnMgYSBuZXcgcHJvbWlzZSB3aGljaCBpcyBzZXR0bGVkIGluIHRoZSBzYW1lIHdheSBhcyB0aGVcbiAgZmlyc3QgcGFzc2VkIHByb21pc2UgdG8gc2V0dGxlLlxuXG4gIEV4YW1wbGU6XG5cbiAgYGBgamF2YXNjcmlwdFxuICBsZXQgcHJvbWlzZTEgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3Qpe1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgIHJlc29sdmUoJ3Byb21pc2UgMScpO1xuICAgIH0sIDIwMCk7XG4gIH0pO1xuXG4gIGxldCBwcm9taXNlMiA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCl7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgcmVzb2x2ZSgncHJvbWlzZSAyJyk7XG4gICAgfSwgMTAwKTtcbiAgfSk7XG5cbiAgUHJvbWlzZS5yYWNlKFtwcm9taXNlMSwgcHJvbWlzZTJdKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG4gICAgLy8gcmVzdWx0ID09PSAncHJvbWlzZSAyJyBiZWNhdXNlIGl0IHdhcyByZXNvbHZlZCBiZWZvcmUgcHJvbWlzZTFcbiAgICAvLyB3YXMgcmVzb2x2ZWQuXG4gIH0pO1xuICBgYGBcblxuICBgUHJvbWlzZS5yYWNlYCBpcyBkZXRlcm1pbmlzdGljIGluIHRoYXQgb25seSB0aGUgc3RhdGUgb2YgdGhlIGZpcnN0XG4gIHNldHRsZWQgcHJvbWlzZSBtYXR0ZXJzLiBGb3IgZXhhbXBsZSwgZXZlbiBpZiBvdGhlciBwcm9taXNlcyBnaXZlbiB0byB0aGVcbiAgYHByb21pc2VzYCBhcnJheSBhcmd1bWVudCBhcmUgcmVzb2x2ZWQsIGJ1dCB0aGUgZmlyc3Qgc2V0dGxlZCBwcm9taXNlIGhhc1xuICBiZWNvbWUgcmVqZWN0ZWQgYmVmb3JlIHRoZSBvdGhlciBwcm9taXNlcyBiZWNhbWUgZnVsZmlsbGVkLCB0aGUgcmV0dXJuZWRcbiAgcHJvbWlzZSB3aWxsIGJlY29tZSByZWplY3RlZDpcblxuICBgYGBqYXZhc2NyaXB0XG4gIGxldCBwcm9taXNlMSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCl7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgcmVzb2x2ZSgncHJvbWlzZSAxJyk7XG4gICAgfSwgMjAwKTtcbiAgfSk7XG5cbiAgbGV0IHByb21pc2UyID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KXtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICByZWplY3QobmV3IEVycm9yKCdwcm9taXNlIDInKSk7XG4gICAgfSwgMTAwKTtcbiAgfSk7XG5cbiAgUHJvbWlzZS5yYWNlKFtwcm9taXNlMSwgcHJvbWlzZTJdKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG4gICAgLy8gQ29kZSBoZXJlIG5ldmVyIHJ1bnNcbiAgfSwgZnVuY3Rpb24ocmVhc29uKXtcbiAgICAvLyByZWFzb24ubWVzc2FnZSA9PT0gJ3Byb21pc2UgMicgYmVjYXVzZSBwcm9taXNlIDIgYmVjYW1lIHJlamVjdGVkIGJlZm9yZVxuICAgIC8vIHByb21pc2UgMSBiZWNhbWUgZnVsZmlsbGVkXG4gIH0pO1xuICBgYGBcblxuICBBbiBleGFtcGxlIHJlYWwtd29ybGQgdXNlIGNhc2UgaXMgaW1wbGVtZW50aW5nIHRpbWVvdXRzOlxuXG4gIGBgYGphdmFzY3JpcHRcbiAgUHJvbWlzZS5yYWNlKFthamF4KCdmb28uanNvbicpLCB0aW1lb3V0KDUwMDApXSlcbiAgYGBgXG5cbiAgQG1ldGhvZCByYWNlXG4gIEBzdGF0aWNcbiAgQHBhcmFtIHtBcnJheX0gcHJvbWlzZXMgYXJyYXkgb2YgcHJvbWlzZXMgdG8gb2JzZXJ2ZVxuICBVc2VmdWwgZm9yIHRvb2xpbmcuXG4gIEByZXR1cm4ge1Byb21pc2V9IGEgcHJvbWlzZSB3aGljaCBzZXR0bGVzIGluIHRoZSBzYW1lIHdheSBhcyB0aGUgZmlyc3QgcGFzc2VkXG4gIHByb21pc2UgdG8gc2V0dGxlLlxuKi9cbmZ1bmN0aW9uIHJhY2UoZW50cmllcykge1xuICAvKmpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xuICB2YXIgQ29uc3RydWN0b3IgPSB0aGlzO1xuXG4gIGlmICghaXNBcnJheShlbnRyaWVzKSkge1xuICAgIHJldHVybiBuZXcgQ29uc3RydWN0b3IoZnVuY3Rpb24gKF8sIHJlamVjdCkge1xuICAgICAgcmV0dXJuIHJlamVjdChuZXcgVHlwZUVycm9yKCdZb3UgbXVzdCBwYXNzIGFuIGFycmF5IHRvIHJhY2UuJykpO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBuZXcgQ29uc3RydWN0b3IoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdmFyIGxlbmd0aCA9IGVudHJpZXMubGVuZ3RoO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICBDb25zdHJ1Y3Rvci5yZXNvbHZlKGVudHJpZXNbaV0pLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAgYFByb21pc2UucmVqZWN0YCByZXR1cm5zIGEgcHJvbWlzZSByZWplY3RlZCB3aXRoIHRoZSBwYXNzZWQgYHJlYXNvbmAuXG4gIEl0IGlzIHNob3J0aGFuZCBmb3IgdGhlIGZvbGxvd2luZzpcblxuICBgYGBqYXZhc2NyaXB0XG4gIGxldCBwcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KXtcbiAgICByZWplY3QobmV3IEVycm9yKCdXSE9PUFMnKSk7XG4gIH0pO1xuXG4gIHByb21pc2UudGhlbihmdW5jdGlvbih2YWx1ZSl7XG4gICAgLy8gQ29kZSBoZXJlIGRvZXNuJ3QgcnVuIGJlY2F1c2UgdGhlIHByb21pc2UgaXMgcmVqZWN0ZWQhXG4gIH0sIGZ1bmN0aW9uKHJlYXNvbil7XG4gICAgLy8gcmVhc29uLm1lc3NhZ2UgPT09ICdXSE9PUFMnXG4gIH0pO1xuICBgYGBcblxuICBJbnN0ZWFkIG9mIHdyaXRpbmcgdGhlIGFib3ZlLCB5b3VyIGNvZGUgbm93IHNpbXBseSBiZWNvbWVzIHRoZSBmb2xsb3dpbmc6XG5cbiAgYGBgamF2YXNjcmlwdFxuICBsZXQgcHJvbWlzZSA9IFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignV0hPT1BTJykpO1xuXG4gIHByb21pc2UudGhlbihmdW5jdGlvbih2YWx1ZSl7XG4gICAgLy8gQ29kZSBoZXJlIGRvZXNuJ3QgcnVuIGJlY2F1c2UgdGhlIHByb21pc2UgaXMgcmVqZWN0ZWQhXG4gIH0sIGZ1bmN0aW9uKHJlYXNvbil7XG4gICAgLy8gcmVhc29uLm1lc3NhZ2UgPT09ICdXSE9PUFMnXG4gIH0pO1xuICBgYGBcblxuICBAbWV0aG9kIHJlamVjdFxuICBAc3RhdGljXG4gIEBwYXJhbSB7QW55fSByZWFzb24gdmFsdWUgdGhhdCB0aGUgcmV0dXJuZWQgcHJvbWlzZSB3aWxsIGJlIHJlamVjdGVkIHdpdGguXG4gIFVzZWZ1bCBmb3IgdG9vbGluZy5cbiAgQHJldHVybiB7UHJvbWlzZX0gYSBwcm9taXNlIHJlamVjdGVkIHdpdGggdGhlIGdpdmVuIGByZWFzb25gLlxuKi9cbmZ1bmN0aW9uIHJlamVjdCQxKHJlYXNvbikge1xuICAvKmpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xuICB2YXIgQ29uc3RydWN0b3IgPSB0aGlzO1xuICB2YXIgcHJvbWlzZSA9IG5ldyBDb25zdHJ1Y3Rvcihub29wKTtcbiAgcmVqZWN0KHByb21pc2UsIHJlYXNvbik7XG4gIHJldHVybiBwcm9taXNlO1xufVxuXG5mdW5jdGlvbiBuZWVkc1Jlc29sdmVyKCkge1xuICB0aHJvdyBuZXcgVHlwZUVycm9yKCdZb3UgbXVzdCBwYXNzIGEgcmVzb2x2ZXIgZnVuY3Rpb24gYXMgdGhlIGZpcnN0IGFyZ3VtZW50IHRvIHRoZSBwcm9taXNlIGNvbnN0cnVjdG9yJyk7XG59XG5cbmZ1bmN0aW9uIG5lZWRzTmV3KCkge1xuICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRmFpbGVkIHRvIGNvbnN0cnVjdCAnUHJvbWlzZSc6IFBsZWFzZSB1c2UgdGhlICduZXcnIG9wZXJhdG9yLCB0aGlzIG9iamVjdCBjb25zdHJ1Y3RvciBjYW5ub3QgYmUgY2FsbGVkIGFzIGEgZnVuY3Rpb24uXCIpO1xufVxuXG4vKipcbiAgUHJvbWlzZSBvYmplY3RzIHJlcHJlc2VudCB0aGUgZXZlbnR1YWwgcmVzdWx0IG9mIGFuIGFzeW5jaHJvbm91cyBvcGVyYXRpb24uIFRoZVxuICBwcmltYXJ5IHdheSBvZiBpbnRlcmFjdGluZyB3aXRoIGEgcHJvbWlzZSBpcyB0aHJvdWdoIGl0cyBgdGhlbmAgbWV0aG9kLCB3aGljaFxuICByZWdpc3RlcnMgY2FsbGJhY2tzIHRvIHJlY2VpdmUgZWl0aGVyIGEgcHJvbWlzZSdzIGV2ZW50dWFsIHZhbHVlIG9yIHRoZSByZWFzb25cbiAgd2h5IHRoZSBwcm9taXNlIGNhbm5vdCBiZSBmdWxmaWxsZWQuXG5cbiAgVGVybWlub2xvZ3lcbiAgLS0tLS0tLS0tLS1cblxuICAtIGBwcm9taXNlYCBpcyBhbiBvYmplY3Qgb3IgZnVuY3Rpb24gd2l0aCBhIGB0aGVuYCBtZXRob2Qgd2hvc2UgYmVoYXZpb3IgY29uZm9ybXMgdG8gdGhpcyBzcGVjaWZpY2F0aW9uLlxuICAtIGB0aGVuYWJsZWAgaXMgYW4gb2JqZWN0IG9yIGZ1bmN0aW9uIHRoYXQgZGVmaW5lcyBhIGB0aGVuYCBtZXRob2QuXG4gIC0gYHZhbHVlYCBpcyBhbnkgbGVnYWwgSmF2YVNjcmlwdCB2YWx1ZSAoaW5jbHVkaW5nIHVuZGVmaW5lZCwgYSB0aGVuYWJsZSwgb3IgYSBwcm9taXNlKS5cbiAgLSBgZXhjZXB0aW9uYCBpcyBhIHZhbHVlIHRoYXQgaXMgdGhyb3duIHVzaW5nIHRoZSB0aHJvdyBzdGF0ZW1lbnQuXG4gIC0gYHJlYXNvbmAgaXMgYSB2YWx1ZSB0aGF0IGluZGljYXRlcyB3aHkgYSBwcm9taXNlIHdhcyByZWplY3RlZC5cbiAgLSBgc2V0dGxlZGAgdGhlIGZpbmFsIHJlc3Rpbmcgc3RhdGUgb2YgYSBwcm9taXNlLCBmdWxmaWxsZWQgb3IgcmVqZWN0ZWQuXG5cbiAgQSBwcm9taXNlIGNhbiBiZSBpbiBvbmUgb2YgdGhyZWUgc3RhdGVzOiBwZW5kaW5nLCBmdWxmaWxsZWQsIG9yIHJlamVjdGVkLlxuXG4gIFByb21pc2VzIHRoYXQgYXJlIGZ1bGZpbGxlZCBoYXZlIGEgZnVsZmlsbG1lbnQgdmFsdWUgYW5kIGFyZSBpbiB0aGUgZnVsZmlsbGVkXG4gIHN0YXRlLiAgUHJvbWlzZXMgdGhhdCBhcmUgcmVqZWN0ZWQgaGF2ZSBhIHJlamVjdGlvbiByZWFzb24gYW5kIGFyZSBpbiB0aGVcbiAgcmVqZWN0ZWQgc3RhdGUuICBBIGZ1bGZpbGxtZW50IHZhbHVlIGlzIG5ldmVyIGEgdGhlbmFibGUuXG5cbiAgUHJvbWlzZXMgY2FuIGFsc28gYmUgc2FpZCB0byAqcmVzb2x2ZSogYSB2YWx1ZS4gIElmIHRoaXMgdmFsdWUgaXMgYWxzbyBhXG4gIHByb21pc2UsIHRoZW4gdGhlIG9yaWdpbmFsIHByb21pc2UncyBzZXR0bGVkIHN0YXRlIHdpbGwgbWF0Y2ggdGhlIHZhbHVlJ3NcbiAgc2V0dGxlZCBzdGF0ZS4gIFNvIGEgcHJvbWlzZSB0aGF0ICpyZXNvbHZlcyogYSBwcm9taXNlIHRoYXQgcmVqZWN0cyB3aWxsXG4gIGl0c2VsZiByZWplY3QsIGFuZCBhIHByb21pc2UgdGhhdCAqcmVzb2x2ZXMqIGEgcHJvbWlzZSB0aGF0IGZ1bGZpbGxzIHdpbGxcbiAgaXRzZWxmIGZ1bGZpbGwuXG5cblxuICBCYXNpYyBVc2FnZTpcbiAgLS0tLS0tLS0tLS0tXG5cbiAgYGBganNcbiAgbGV0IHByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAvLyBvbiBzdWNjZXNzXG4gICAgcmVzb2x2ZSh2YWx1ZSk7XG5cbiAgICAvLyBvbiBmYWlsdXJlXG4gICAgcmVqZWN0KHJlYXNvbik7XG4gIH0pO1xuXG4gIHByb21pc2UudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgIC8vIG9uIGZ1bGZpbGxtZW50XG4gIH0sIGZ1bmN0aW9uKHJlYXNvbikge1xuICAgIC8vIG9uIHJlamVjdGlvblxuICB9KTtcbiAgYGBgXG5cbiAgQWR2YW5jZWQgVXNhZ2U6XG4gIC0tLS0tLS0tLS0tLS0tLVxuXG4gIFByb21pc2VzIHNoaW5lIHdoZW4gYWJzdHJhY3RpbmcgYXdheSBhc3luY2hyb25vdXMgaW50ZXJhY3Rpb25zIHN1Y2ggYXNcbiAgYFhNTEh0dHBSZXF1ZXN0YHMuXG5cbiAgYGBganNcbiAgZnVuY3Rpb24gZ2V0SlNPTih1cmwpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KXtcbiAgICAgIGxldCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgICAgeGhyLm9wZW4oJ0dFVCcsIHVybCk7XG4gICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gaGFuZGxlcjtcbiAgICAgIHhoci5yZXNwb25zZVR5cGUgPSAnanNvbic7XG4gICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQWNjZXB0JywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcbiAgICAgIHhoci5zZW5kKCk7XG5cbiAgICAgIGZ1bmN0aW9uIGhhbmRsZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLnJlYWR5U3RhdGUgPT09IHRoaXMuRE9ORSkge1xuICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICByZXNvbHZlKHRoaXMucmVzcG9uc2UpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdnZXRKU09OOiBgJyArIHVybCArICdgIGZhaWxlZCB3aXRoIHN0YXR1czogWycgKyB0aGlzLnN0YXR1cyArICddJykpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldEpTT04oJy9wb3N0cy5qc29uJykudGhlbihmdW5jdGlvbihqc29uKSB7XG4gICAgLy8gb24gZnVsZmlsbG1lbnRcbiAgfSwgZnVuY3Rpb24ocmVhc29uKSB7XG4gICAgLy8gb24gcmVqZWN0aW9uXG4gIH0pO1xuICBgYGBcblxuICBVbmxpa2UgY2FsbGJhY2tzLCBwcm9taXNlcyBhcmUgZ3JlYXQgY29tcG9zYWJsZSBwcmltaXRpdmVzLlxuXG4gIGBgYGpzXG4gIFByb21pc2UuYWxsKFtcbiAgICBnZXRKU09OKCcvcG9zdHMnKSxcbiAgICBnZXRKU09OKCcvY29tbWVudHMnKVxuICBdKS50aGVuKGZ1bmN0aW9uKHZhbHVlcyl7XG4gICAgdmFsdWVzWzBdIC8vID0+IHBvc3RzSlNPTlxuICAgIHZhbHVlc1sxXSAvLyA9PiBjb21tZW50c0pTT05cblxuICAgIHJldHVybiB2YWx1ZXM7XG4gIH0pO1xuICBgYGBcblxuICBAY2xhc3MgUHJvbWlzZVxuICBAcGFyYW0ge0Z1bmN0aW9ufSByZXNvbHZlclxuICBVc2VmdWwgZm9yIHRvb2xpbmcuXG4gIEBjb25zdHJ1Y3RvclxuKi9cblxudmFyIFByb21pc2UkMSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gUHJvbWlzZShyZXNvbHZlcikge1xuICAgIHRoaXNbUFJPTUlTRV9JRF0gPSBuZXh0SWQoKTtcbiAgICB0aGlzLl9yZXN1bHQgPSB0aGlzLl9zdGF0ZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLl9zdWJzY3JpYmVycyA9IFtdO1xuXG4gICAgaWYgKG5vb3AgIT09IHJlc29sdmVyKSB7XG4gICAgICB0eXBlb2YgcmVzb2x2ZXIgIT09ICdmdW5jdGlvbicgJiYgbmVlZHNSZXNvbHZlcigpO1xuICAgICAgdGhpcyBpbnN0YW5jZW9mIFByb21pc2UgPyBpbml0aWFsaXplUHJvbWlzZSh0aGlzLCByZXNvbHZlcikgOiBuZWVkc05ldygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICBUaGUgcHJpbWFyeSB3YXkgb2YgaW50ZXJhY3Rpbmcgd2l0aCBhIHByb21pc2UgaXMgdGhyb3VnaCBpdHMgYHRoZW5gIG1ldGhvZCxcbiAgd2hpY2ggcmVnaXN0ZXJzIGNhbGxiYWNrcyB0byByZWNlaXZlIGVpdGhlciBhIHByb21pc2UncyBldmVudHVhbCB2YWx1ZSBvciB0aGVcbiAgcmVhc29uIHdoeSB0aGUgcHJvbWlzZSBjYW5ub3QgYmUgZnVsZmlsbGVkLlxuICAgYGBganNcbiAgZmluZFVzZXIoKS50aGVuKGZ1bmN0aW9uKHVzZXIpe1xuICAgIC8vIHVzZXIgaXMgYXZhaWxhYmxlXG4gIH0sIGZ1bmN0aW9uKHJlYXNvbil7XG4gICAgLy8gdXNlciBpcyB1bmF2YWlsYWJsZSwgYW5kIHlvdSBhcmUgZ2l2ZW4gdGhlIHJlYXNvbiB3aHlcbiAgfSk7XG4gIGBgYFxuICAgQ2hhaW5pbmdcbiAgLS0tLS0tLS1cbiAgIFRoZSByZXR1cm4gdmFsdWUgb2YgYHRoZW5gIGlzIGl0c2VsZiBhIHByb21pc2UuICBUaGlzIHNlY29uZCwgJ2Rvd25zdHJlYW0nXG4gIHByb21pc2UgaXMgcmVzb2x2ZWQgd2l0aCB0aGUgcmV0dXJuIHZhbHVlIG9mIHRoZSBmaXJzdCBwcm9taXNlJ3MgZnVsZmlsbG1lbnRcbiAgb3IgcmVqZWN0aW9uIGhhbmRsZXIsIG9yIHJlamVjdGVkIGlmIHRoZSBoYW5kbGVyIHRocm93cyBhbiBleGNlcHRpb24uXG4gICBgYGBqc1xuICBmaW5kVXNlcigpLnRoZW4oZnVuY3Rpb24gKHVzZXIpIHtcbiAgICByZXR1cm4gdXNlci5uYW1lO1xuICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XG4gICAgcmV0dXJuICdkZWZhdWx0IG5hbWUnO1xuICB9KS50aGVuKGZ1bmN0aW9uICh1c2VyTmFtZSkge1xuICAgIC8vIElmIGBmaW5kVXNlcmAgZnVsZmlsbGVkLCBgdXNlck5hbWVgIHdpbGwgYmUgdGhlIHVzZXIncyBuYW1lLCBvdGhlcndpc2UgaXRcbiAgICAvLyB3aWxsIGJlIGAnZGVmYXVsdCBuYW1lJ2BcbiAgfSk7XG4gICBmaW5kVXNlcigpLnRoZW4oZnVuY3Rpb24gKHVzZXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZvdW5kIHVzZXIsIGJ1dCBzdGlsbCB1bmhhcHB5Jyk7XG4gIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2BmaW5kVXNlcmAgcmVqZWN0ZWQgYW5kIHdlJ3JlIHVuaGFwcHknKTtcbiAgfSkudGhlbihmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAvLyBuZXZlciByZWFjaGVkXG4gIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcbiAgICAvLyBpZiBgZmluZFVzZXJgIGZ1bGZpbGxlZCwgYHJlYXNvbmAgd2lsbCBiZSAnRm91bmQgdXNlciwgYnV0IHN0aWxsIHVuaGFwcHknLlxuICAgIC8vIElmIGBmaW5kVXNlcmAgcmVqZWN0ZWQsIGByZWFzb25gIHdpbGwgYmUgJ2BmaW5kVXNlcmAgcmVqZWN0ZWQgYW5kIHdlJ3JlIHVuaGFwcHknLlxuICB9KTtcbiAgYGBgXG4gIElmIHRoZSBkb3duc3RyZWFtIHByb21pc2UgZG9lcyBub3Qgc3BlY2lmeSBhIHJlamVjdGlvbiBoYW5kbGVyLCByZWplY3Rpb24gcmVhc29ucyB3aWxsIGJlIHByb3BhZ2F0ZWQgZnVydGhlciBkb3duc3RyZWFtLlxuICAgYGBganNcbiAgZmluZFVzZXIoKS50aGVuKGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgdGhyb3cgbmV3IFBlZGFnb2dpY2FsRXhjZXB0aW9uKCdVcHN0cmVhbSBlcnJvcicpO1xuICB9KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIC8vIG5ldmVyIHJlYWNoZWRcbiAgfSkudGhlbihmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAvLyBuZXZlciByZWFjaGVkXG4gIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcbiAgICAvLyBUaGUgYFBlZGdhZ29jaWFsRXhjZXB0aW9uYCBpcyBwcm9wYWdhdGVkIGFsbCB0aGUgd2F5IGRvd24gdG8gaGVyZVxuICB9KTtcbiAgYGBgXG4gICBBc3NpbWlsYXRpb25cbiAgLS0tLS0tLS0tLS0tXG4gICBTb21ldGltZXMgdGhlIHZhbHVlIHlvdSB3YW50IHRvIHByb3BhZ2F0ZSB0byBhIGRvd25zdHJlYW0gcHJvbWlzZSBjYW4gb25seSBiZVxuICByZXRyaWV2ZWQgYXN5bmNocm9ub3VzbHkuIFRoaXMgY2FuIGJlIGFjaGlldmVkIGJ5IHJldHVybmluZyBhIHByb21pc2UgaW4gdGhlXG4gIGZ1bGZpbGxtZW50IG9yIHJlamVjdGlvbiBoYW5kbGVyLiBUaGUgZG93bnN0cmVhbSBwcm9taXNlIHdpbGwgdGhlbiBiZSBwZW5kaW5nXG4gIHVudGlsIHRoZSByZXR1cm5lZCBwcm9taXNlIGlzIHNldHRsZWQuIFRoaXMgaXMgY2FsbGVkICphc3NpbWlsYXRpb24qLlxuICAgYGBganNcbiAgZmluZFVzZXIoKS50aGVuKGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgcmV0dXJuIGZpbmRDb21tZW50c0J5QXV0aG9yKHVzZXIpO1xuICB9KS50aGVuKGZ1bmN0aW9uIChjb21tZW50cykge1xuICAgIC8vIFRoZSB1c2VyJ3MgY29tbWVudHMgYXJlIG5vdyBhdmFpbGFibGVcbiAgfSk7XG4gIGBgYFxuICAgSWYgdGhlIGFzc2ltbGlhdGVkIHByb21pc2UgcmVqZWN0cywgdGhlbiB0aGUgZG93bnN0cmVhbSBwcm9taXNlIHdpbGwgYWxzbyByZWplY3QuXG4gICBgYGBqc1xuICBmaW5kVXNlcigpLnRoZW4oZnVuY3Rpb24gKHVzZXIpIHtcbiAgICByZXR1cm4gZmluZENvbW1lbnRzQnlBdXRob3IodXNlcik7XG4gIH0pLnRoZW4oZnVuY3Rpb24gKGNvbW1lbnRzKSB7XG4gICAgLy8gSWYgYGZpbmRDb21tZW50c0J5QXV0aG9yYCBmdWxmaWxscywgd2UnbGwgaGF2ZSB0aGUgdmFsdWUgaGVyZVxuICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XG4gICAgLy8gSWYgYGZpbmRDb21tZW50c0J5QXV0aG9yYCByZWplY3RzLCB3ZSdsbCBoYXZlIHRoZSByZWFzb24gaGVyZVxuICB9KTtcbiAgYGBgXG4gICBTaW1wbGUgRXhhbXBsZVxuICAtLS0tLS0tLS0tLS0tLVxuICAgU3luY2hyb25vdXMgRXhhbXBsZVxuICAgYGBgamF2YXNjcmlwdFxuICBsZXQgcmVzdWx0O1xuICAgdHJ5IHtcbiAgICByZXN1bHQgPSBmaW5kUmVzdWx0KCk7XG4gICAgLy8gc3VjY2Vzc1xuICB9IGNhdGNoKHJlYXNvbikge1xuICAgIC8vIGZhaWx1cmVcbiAgfVxuICBgYGBcbiAgIEVycmJhY2sgRXhhbXBsZVxuICAgYGBganNcbiAgZmluZFJlc3VsdChmdW5jdGlvbihyZXN1bHQsIGVycil7XG4gICAgaWYgKGVycikge1xuICAgICAgLy8gZmFpbHVyZVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBzdWNjZXNzXG4gICAgfVxuICB9KTtcbiAgYGBgXG4gICBQcm9taXNlIEV4YW1wbGU7XG4gICBgYGBqYXZhc2NyaXB0XG4gIGZpbmRSZXN1bHQoKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG4gICAgLy8gc3VjY2Vzc1xuICB9LCBmdW5jdGlvbihyZWFzb24pe1xuICAgIC8vIGZhaWx1cmVcbiAgfSk7XG4gIGBgYFxuICAgQWR2YW5jZWQgRXhhbXBsZVxuICAtLS0tLS0tLS0tLS0tLVxuICAgU3luY2hyb25vdXMgRXhhbXBsZVxuICAgYGBgamF2YXNjcmlwdFxuICBsZXQgYXV0aG9yLCBib29rcztcbiAgIHRyeSB7XG4gICAgYXV0aG9yID0gZmluZEF1dGhvcigpO1xuICAgIGJvb2tzICA9IGZpbmRCb29rc0J5QXV0aG9yKGF1dGhvcik7XG4gICAgLy8gc3VjY2Vzc1xuICB9IGNhdGNoKHJlYXNvbikge1xuICAgIC8vIGZhaWx1cmVcbiAgfVxuICBgYGBcbiAgIEVycmJhY2sgRXhhbXBsZVxuICAgYGBganNcbiAgIGZ1bmN0aW9uIGZvdW5kQm9va3MoYm9va3MpIHtcbiAgIH1cbiAgIGZ1bmN0aW9uIGZhaWx1cmUocmVhc29uKSB7XG4gICB9XG4gICBmaW5kQXV0aG9yKGZ1bmN0aW9uKGF1dGhvciwgZXJyKXtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBmYWlsdXJlKGVycik7XG4gICAgICAvLyBmYWlsdXJlXG4gICAgfSBlbHNlIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGZpbmRCb29va3NCeUF1dGhvcihhdXRob3IsIGZ1bmN0aW9uKGJvb2tzLCBlcnIpIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBmYWlsdXJlKGVycik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGZvdW5kQm9va3MoYm9va3MpO1xuICAgICAgICAgICAgfSBjYXRjaChyZWFzb24pIHtcbiAgICAgICAgICAgICAgZmFpbHVyZShyZWFzb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoKGVycm9yKSB7XG4gICAgICAgIGZhaWx1cmUoZXJyKTtcbiAgICAgIH1cbiAgICAgIC8vIHN1Y2Nlc3NcbiAgICB9XG4gIH0pO1xuICBgYGBcbiAgIFByb21pc2UgRXhhbXBsZTtcbiAgIGBgYGphdmFzY3JpcHRcbiAgZmluZEF1dGhvcigpLlxuICAgIHRoZW4oZmluZEJvb2tzQnlBdXRob3IpLlxuICAgIHRoZW4oZnVuY3Rpb24oYm9va3Mpe1xuICAgICAgLy8gZm91bmQgYm9va3NcbiAgfSkuY2F0Y2goZnVuY3Rpb24ocmVhc29uKXtcbiAgICAvLyBzb21ldGhpbmcgd2VudCB3cm9uZ1xuICB9KTtcbiAgYGBgXG4gICBAbWV0aG9kIHRoZW5cbiAgQHBhcmFtIHtGdW5jdGlvbn0gb25GdWxmaWxsZWRcbiAgQHBhcmFtIHtGdW5jdGlvbn0gb25SZWplY3RlZFxuICBVc2VmdWwgZm9yIHRvb2xpbmcuXG4gIEByZXR1cm4ge1Byb21pc2V9XG4gICovXG5cbiAgLyoqXG4gIGBjYXRjaGAgaXMgc2ltcGx5IHN1Z2FyIGZvciBgdGhlbih1bmRlZmluZWQsIG9uUmVqZWN0aW9uKWAgd2hpY2ggbWFrZXMgaXQgdGhlIHNhbWVcbiAgYXMgdGhlIGNhdGNoIGJsb2NrIG9mIGEgdHJ5L2NhdGNoIHN0YXRlbWVudC5cbiAgYGBganNcbiAgZnVuY3Rpb24gZmluZEF1dGhvcigpe1xuICB0aHJvdyBuZXcgRXJyb3IoJ2NvdWxkbid0IGZpbmQgdGhhdCBhdXRob3InKTtcbiAgfVxuICAvLyBzeW5jaHJvbm91c1xuICB0cnkge1xuICBmaW5kQXV0aG9yKCk7XG4gIH0gY2F0Y2gocmVhc29uKSB7XG4gIC8vIHNvbWV0aGluZyB3ZW50IHdyb25nXG4gIH1cbiAgLy8gYXN5bmMgd2l0aCBwcm9taXNlc1xuICBmaW5kQXV0aG9yKCkuY2F0Y2goZnVuY3Rpb24ocmVhc29uKXtcbiAgLy8gc29tZXRoaW5nIHdlbnQgd3JvbmdcbiAgfSk7XG4gIGBgYFxuICBAbWV0aG9kIGNhdGNoXG4gIEBwYXJhbSB7RnVuY3Rpb259IG9uUmVqZWN0aW9uXG4gIFVzZWZ1bCBmb3IgdG9vbGluZy5cbiAgQHJldHVybiB7UHJvbWlzZX1cbiAgKi9cblxuXG4gIFByb21pc2UucHJvdG90eXBlLmNhdGNoID0gZnVuY3Rpb24gX2NhdGNoKG9uUmVqZWN0aW9uKSB7XG4gICAgcmV0dXJuIHRoaXMudGhlbihudWxsLCBvblJlamVjdGlvbik7XG4gIH07XG5cbiAgLyoqXG4gICAgYGZpbmFsbHlgIHdpbGwgYmUgaW52b2tlZCByZWdhcmRsZXNzIG9mIHRoZSBwcm9taXNlJ3MgZmF0ZSBqdXN0IGFzIG5hdGl2ZVxuICAgIHRyeS9jYXRjaC9maW5hbGx5IGJlaGF2ZXNcbiAgXG4gICAgU3luY2hyb25vdXMgZXhhbXBsZTpcbiAgXG4gICAgYGBganNcbiAgICBmaW5kQXV0aG9yKCkge1xuICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPiAwLjUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmV3IEF1dGhvcigpO1xuICAgIH1cbiAgXG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBmaW5kQXV0aG9yKCk7IC8vIHN1Y2NlZWQgb3IgZmFpbFxuICAgIH0gY2F0Y2goZXJyb3IpIHtcbiAgICAgIHJldHVybiBmaW5kT3RoZXJBdXRoZXIoKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgLy8gYWx3YXlzIHJ1bnNcbiAgICAgIC8vIGRvZXNuJ3QgYWZmZWN0IHRoZSByZXR1cm4gdmFsdWVcbiAgICB9XG4gICAgYGBgXG4gIFxuICAgIEFzeW5jaHJvbm91cyBleGFtcGxlOlxuICBcbiAgICBgYGBqc1xuICAgIGZpbmRBdXRob3IoKS5jYXRjaChmdW5jdGlvbihyZWFzb24pe1xuICAgICAgcmV0dXJuIGZpbmRPdGhlckF1dGhlcigpO1xuICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24oKXtcbiAgICAgIC8vIGF1dGhvciB3YXMgZWl0aGVyIGZvdW5kLCBvciBub3RcbiAgICB9KTtcbiAgICBgYGBcbiAgXG4gICAgQG1ldGhvZCBmaW5hbGx5XG4gICAgQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2tcbiAgICBAcmV0dXJuIHtQcm9taXNlfVxuICAqL1xuXG5cbiAgUHJvbWlzZS5wcm90b3R5cGUuZmluYWxseSA9IGZ1bmN0aW9uIF9maW5hbGx5KGNhbGxiYWNrKSB7XG4gICAgdmFyIHByb21pc2UgPSB0aGlzO1xuICAgIHZhciBjb25zdHJ1Y3RvciA9IHByb21pc2UuY29uc3RydWN0b3I7XG5cbiAgICBpZiAoaXNGdW5jdGlvbihjYWxsYmFjaykpIHtcbiAgICAgIHJldHVybiBwcm9taXNlLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBjb25zdHJ1Y3Rvci5yZXNvbHZlKGNhbGxiYWNrKCkpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgfSk7XG4gICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XG4gICAgICAgIHJldHVybiBjb25zdHJ1Y3Rvci5yZXNvbHZlKGNhbGxiYWNrKCkpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHRocm93IHJlYXNvbjtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcHJvbWlzZS50aGVuKGNhbGxiYWNrLCBjYWxsYmFjayk7XG4gIH07XG5cbiAgcmV0dXJuIFByb21pc2U7XG59KCk7XG5cblByb21pc2UkMS5wcm90b3R5cGUudGhlbiA9IHRoZW47XG5Qcm9taXNlJDEuYWxsID0gYWxsO1xuUHJvbWlzZSQxLnJhY2UgPSByYWNlO1xuUHJvbWlzZSQxLnJlc29sdmUgPSByZXNvbHZlJDE7XG5Qcm9taXNlJDEucmVqZWN0ID0gcmVqZWN0JDE7XG5Qcm9taXNlJDEuX3NldFNjaGVkdWxlciA9IHNldFNjaGVkdWxlcjtcblByb21pc2UkMS5fc2V0QXNhcCA9IHNldEFzYXA7XG5Qcm9taXNlJDEuX2FzYXAgPSBhc2FwO1xuXG4vKmdsb2JhbCBzZWxmKi9cbmZ1bmN0aW9uIHBvbHlmaWxsKCkge1xuICB2YXIgbG9jYWwgPSB2b2lkIDA7XG5cbiAgaWYgKHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgbG9jYWwgPSBnbG9iYWw7XG4gIH0gZWxzZSBpZiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgbG9jYWwgPSBzZWxmO1xuICB9IGVsc2Uge1xuICAgIHRyeSB7XG4gICAgICBsb2NhbCA9IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdwb2x5ZmlsbCBmYWlsZWQgYmVjYXVzZSBnbG9iYWwgb2JqZWN0IGlzIHVuYXZhaWxhYmxlIGluIHRoaXMgZW52aXJvbm1lbnQnKTtcbiAgICB9XG4gIH1cblxuICB2YXIgUCA9IGxvY2FsLlByb21pc2U7XG5cbiAgaWYgKFApIHtcbiAgICB2YXIgcHJvbWlzZVRvU3RyaW5nID0gbnVsbDtcbiAgICB0cnkge1xuICAgICAgcHJvbWlzZVRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKFAucmVzb2x2ZSgpKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvLyBzaWxlbnRseSBpZ25vcmVkXG4gICAgfVxuXG4gICAgaWYgKHByb21pc2VUb1N0cmluZyA9PT0gJ1tvYmplY3QgUHJvbWlzZV0nICYmICFQLmNhc3QpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cblxuICBsb2NhbC5Qcm9taXNlID0gUHJvbWlzZSQxO1xufVxuXG4vLyBTdHJhbmdlIGNvbXBhdC4uXG5Qcm9taXNlJDEucG9seWZpbGwgPSBwb2x5ZmlsbDtcblByb21pc2UkMS5Qcm9taXNlID0gUHJvbWlzZSQxO1xuXG5yZXR1cm4gUHJvbWlzZSQxO1xuXG59KSkpO1xuXG5cblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZXM2LXByb21pc2UubWFwXG4iLCIvLyBzaGltIGZvciB1c2luZyBwcm9jZXNzIGluIGJyb3dzZXJcbnZhciBwcm9jZXNzID0gbW9kdWxlLmV4cG9ydHMgPSB7fTtcblxuLy8gY2FjaGVkIGZyb20gd2hhdGV2ZXIgZ2xvYmFsIGlzIHByZXNlbnQgc28gdGhhdCB0ZXN0IHJ1bm5lcnMgdGhhdCBzdHViIGl0XG4vLyBkb24ndCBicmVhayB0aGluZ3MuICBCdXQgd2UgbmVlZCB0byB3cmFwIGl0IGluIGEgdHJ5IGNhdGNoIGluIGNhc2UgaXQgaXNcbi8vIHdyYXBwZWQgaW4gc3RyaWN0IG1vZGUgY29kZSB3aGljaCBkb2Vzbid0IGRlZmluZSBhbnkgZ2xvYmFscy4gIEl0J3MgaW5zaWRlIGFcbi8vIGZ1bmN0aW9uIGJlY2F1c2UgdHJ5L2NhdGNoZXMgZGVvcHRpbWl6ZSBpbiBjZXJ0YWluIGVuZ2luZXMuXG5cbnZhciBjYWNoZWRTZXRUaW1lb3V0O1xudmFyIGNhY2hlZENsZWFyVGltZW91dDtcblxuZnVuY3Rpb24gZGVmYXVsdFNldFRpbW91dCgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3NldFRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQnKTtcbn1cbmZ1bmN0aW9uIGRlZmF1bHRDbGVhclRpbWVvdXQgKCkge1xuICAgIHRocm93IG5ldyBFcnJvcignY2xlYXJUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkJyk7XG59XG4oZnVuY3Rpb24gKCkge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICh0eXBlb2Ygc2V0VGltZW91dCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IHNldFRpbWVvdXQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gZGVmYXVsdFNldFRpbW91dDtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IGRlZmF1bHRTZXRUaW1vdXQ7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIGlmICh0eXBlb2YgY2xlYXJUaW1lb3V0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBjYWNoZWRDbGVhclRpbWVvdXQgPSBjbGVhclRpbWVvdXQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYWNoZWRDbGVhclRpbWVvdXQgPSBkZWZhdWx0Q2xlYXJUaW1lb3V0O1xuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjYWNoZWRDbGVhclRpbWVvdXQgPSBkZWZhdWx0Q2xlYXJUaW1lb3V0O1xuICAgIH1cbn0gKCkpXG5mdW5jdGlvbiBydW5UaW1lb3V0KGZ1bikge1xuICAgIGlmIChjYWNoZWRTZXRUaW1lb3V0ID09PSBzZXRUaW1lb3V0KSB7XG4gICAgICAgIC8vbm9ybWFsIGVudmlyb21lbnRzIGluIHNhbmUgc2l0dWF0aW9uc1xuICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW4sIDApO1xuICAgIH1cbiAgICAvLyBpZiBzZXRUaW1lb3V0IHdhc24ndCBhdmFpbGFibGUgYnV0IHdhcyBsYXR0ZXIgZGVmaW5lZFxuICAgIGlmICgoY2FjaGVkU2V0VGltZW91dCA9PT0gZGVmYXVsdFNldFRpbW91dCB8fCAhY2FjaGVkU2V0VGltZW91dCkgJiYgc2V0VGltZW91dCkge1xuICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gc2V0VGltZW91dDtcbiAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuLCAwKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gd2hlbiB3aGVuIHNvbWVib2R5IGhhcyBzY3Jld2VkIHdpdGggc2V0VGltZW91dCBidXQgbm8gSS5FLiBtYWRkbmVzc1xuICAgICAgICByZXR1cm4gY2FjaGVkU2V0VGltZW91dChmdW4sIDApO1xuICAgIH0gY2F0Y2goZSl7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBXaGVuIHdlIGFyZSBpbiBJLkUuIGJ1dCB0aGUgc2NyaXB0IGhhcyBiZWVuIGV2YWxlZCBzbyBJLkUuIGRvZXNuJ3QgdHJ1c3QgdGhlIGdsb2JhbCBvYmplY3Qgd2hlbiBjYWxsZWQgbm9ybWFsbHlcbiAgICAgICAgICAgIHJldHVybiBjYWNoZWRTZXRUaW1lb3V0LmNhbGwobnVsbCwgZnVuLCAwKTtcbiAgICAgICAgfSBjYXRjaChlKXtcbiAgICAgICAgICAgIC8vIHNhbWUgYXMgYWJvdmUgYnV0IHdoZW4gaXQncyBhIHZlcnNpb24gb2YgSS5FLiB0aGF0IG11c3QgaGF2ZSB0aGUgZ2xvYmFsIG9iamVjdCBmb3IgJ3RoaXMnLCBob3BmdWxseSBvdXIgY29udGV4dCBjb3JyZWN0IG90aGVyd2lzZSBpdCB3aWxsIHRocm93IGEgZ2xvYmFsIGVycm9yXG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkU2V0VGltZW91dC5jYWxsKHRoaXMsIGZ1biwgMCk7XG4gICAgICAgIH1cbiAgICB9XG5cblxufVxuZnVuY3Rpb24gcnVuQ2xlYXJUaW1lb3V0KG1hcmtlcikge1xuICAgIGlmIChjYWNoZWRDbGVhclRpbWVvdXQgPT09IGNsZWFyVGltZW91dCkge1xuICAgICAgICAvL25vcm1hbCBlbnZpcm9tZW50cyBpbiBzYW5lIHNpdHVhdGlvbnNcbiAgICAgICAgcmV0dXJuIGNsZWFyVGltZW91dChtYXJrZXIpO1xuICAgIH1cbiAgICAvLyBpZiBjbGVhclRpbWVvdXQgd2Fzbid0IGF2YWlsYWJsZSBidXQgd2FzIGxhdHRlciBkZWZpbmVkXG4gICAgaWYgKChjYWNoZWRDbGVhclRpbWVvdXQgPT09IGRlZmF1bHRDbGVhclRpbWVvdXQgfHwgIWNhY2hlZENsZWFyVGltZW91dCkgJiYgY2xlYXJUaW1lb3V0KSB7XG4gICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGNsZWFyVGltZW91dDtcbiAgICAgICAgcmV0dXJuIGNsZWFyVGltZW91dChtYXJrZXIpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICAvLyB3aGVuIHdoZW4gc29tZWJvZHkgaGFzIHNjcmV3ZWQgd2l0aCBzZXRUaW1lb3V0IGJ1dCBubyBJLkUuIG1hZGRuZXNzXG4gICAgICAgIHJldHVybiBjYWNoZWRDbGVhclRpbWVvdXQobWFya2VyKTtcbiAgICB9IGNhdGNoIChlKXtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFdoZW4gd2UgYXJlIGluIEkuRS4gYnV0IHRoZSBzY3JpcHQgaGFzIGJlZW4gZXZhbGVkIHNvIEkuRS4gZG9lc24ndCAgdHJ1c3QgdGhlIGdsb2JhbCBvYmplY3Qgd2hlbiBjYWxsZWQgbm9ybWFsbHlcbiAgICAgICAgICAgIHJldHVybiBjYWNoZWRDbGVhclRpbWVvdXQuY2FsbChudWxsLCBtYXJrZXIpO1xuICAgICAgICB9IGNhdGNoIChlKXtcbiAgICAgICAgICAgIC8vIHNhbWUgYXMgYWJvdmUgYnV0IHdoZW4gaXQncyBhIHZlcnNpb24gb2YgSS5FLiB0aGF0IG11c3QgaGF2ZSB0aGUgZ2xvYmFsIG9iamVjdCBmb3IgJ3RoaXMnLCBob3BmdWxseSBvdXIgY29udGV4dCBjb3JyZWN0IG90aGVyd2lzZSBpdCB3aWxsIHRocm93IGEgZ2xvYmFsIGVycm9yLlxuICAgICAgICAgICAgLy8gU29tZSB2ZXJzaW9ucyBvZiBJLkUuIGhhdmUgZGlmZmVyZW50IHJ1bGVzIGZvciBjbGVhclRpbWVvdXQgdnMgc2V0VGltZW91dFxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZENsZWFyVGltZW91dC5jYWxsKHRoaXMsIG1hcmtlcik7XG4gICAgICAgIH1cbiAgICB9XG5cblxuXG59XG52YXIgcXVldWUgPSBbXTtcbnZhciBkcmFpbmluZyA9IGZhbHNlO1xudmFyIGN1cnJlbnRRdWV1ZTtcbnZhciBxdWV1ZUluZGV4ID0gLTE7XG5cbmZ1bmN0aW9uIGNsZWFuVXBOZXh0VGljaygpIHtcbiAgICBpZiAoIWRyYWluaW5nIHx8ICFjdXJyZW50UXVldWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBkcmFpbmluZyA9IGZhbHNlO1xuICAgIGlmIChjdXJyZW50UXVldWUubGVuZ3RoKSB7XG4gICAgICAgIHF1ZXVlID0gY3VycmVudFF1ZXVlLmNvbmNhdChxdWV1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcXVldWVJbmRleCA9IC0xO1xuICAgIH1cbiAgICBpZiAocXVldWUubGVuZ3RoKSB7XG4gICAgICAgIGRyYWluUXVldWUoKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGRyYWluUXVldWUoKSB7XG4gICAgaWYgKGRyYWluaW5nKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIHRpbWVvdXQgPSBydW5UaW1lb3V0KGNsZWFuVXBOZXh0VGljayk7XG4gICAgZHJhaW5pbmcgPSB0cnVlO1xuXG4gICAgdmFyIGxlbiA9IHF1ZXVlLmxlbmd0aDtcbiAgICB3aGlsZShsZW4pIHtcbiAgICAgICAgY3VycmVudFF1ZXVlID0gcXVldWU7XG4gICAgICAgIHF1ZXVlID0gW107XG4gICAgICAgIHdoaWxlICgrK3F1ZXVlSW5kZXggPCBsZW4pIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50UXVldWUpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50UXVldWVbcXVldWVJbmRleF0ucnVuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcXVldWVJbmRleCA9IC0xO1xuICAgICAgICBsZW4gPSBxdWV1ZS5sZW5ndGg7XG4gICAgfVxuICAgIGN1cnJlbnRRdWV1ZSA9IG51bGw7XG4gICAgZHJhaW5pbmcgPSBmYWxzZTtcbiAgICBydW5DbGVhclRpbWVvdXQodGltZW91dCk7XG59XG5cbnByb2Nlc3MubmV4dFRpY2sgPSBmdW5jdGlvbiAoZnVuKSB7XG4gICAgdmFyIGFyZ3MgPSBuZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aCAtIDEpO1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkge1xuICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgYXJnc1tpIC0gMV0gPSBhcmd1bWVudHNbaV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcXVldWUucHVzaChuZXcgSXRlbShmdW4sIGFyZ3MpKTtcbiAgICBpZiAocXVldWUubGVuZ3RoID09PSAxICYmICFkcmFpbmluZykge1xuICAgICAgICBydW5UaW1lb3V0KGRyYWluUXVldWUpO1xuICAgIH1cbn07XG5cbi8vIHY4IGxpa2VzIHByZWRpY3RpYmxlIG9iamVjdHNcbmZ1bmN0aW9uIEl0ZW0oZnVuLCBhcnJheSkge1xuICAgIHRoaXMuZnVuID0gZnVuO1xuICAgIHRoaXMuYXJyYXkgPSBhcnJheTtcbn1cbkl0ZW0ucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmZ1bi5hcHBseShudWxsLCB0aGlzLmFycmF5KTtcbn07XG5wcm9jZXNzLnRpdGxlID0gJ2Jyb3dzZXInO1xucHJvY2Vzcy5icm93c2VyID0gdHJ1ZTtcbnByb2Nlc3MuZW52ID0ge307XG5wcm9jZXNzLmFyZ3YgPSBbXTtcbnByb2Nlc3MudmVyc2lvbiA9ICcnOyAvLyBlbXB0eSBzdHJpbmcgdG8gYXZvaWQgcmVnZXhwIGlzc3Vlc1xucHJvY2Vzcy52ZXJzaW9ucyA9IHt9O1xuXG5mdW5jdGlvbiBub29wKCkge31cblxucHJvY2Vzcy5vbiA9IG5vb3A7XG5wcm9jZXNzLmFkZExpc3RlbmVyID0gbm9vcDtcbnByb2Nlc3Mub25jZSA9IG5vb3A7XG5wcm9jZXNzLm9mZiA9IG5vb3A7XG5wcm9jZXNzLnJlbW92ZUxpc3RlbmVyID0gbm9vcDtcbnByb2Nlc3MucmVtb3ZlQWxsTGlzdGVuZXJzID0gbm9vcDtcbnByb2Nlc3MuZW1pdCA9IG5vb3A7XG5wcm9jZXNzLnByZXBlbmRMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLnByZXBlbmRPbmNlTGlzdGVuZXIgPSBub29wO1xuXG5wcm9jZXNzLmxpc3RlbmVycyA9IGZ1bmN0aW9uIChuYW1lKSB7IHJldHVybiBbXSB9XG5cbnByb2Nlc3MuYmluZGluZyA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCcpO1xufTtcblxucHJvY2Vzcy5jd2QgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAnLycgfTtcbnByb2Nlc3MuY2hkaXIgPSBmdW5jdGlvbiAoZGlyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbn07XG5wcm9jZXNzLnVtYXNrID0gZnVuY3Rpb24oKSB7IHJldHVybiAwOyB9O1xuIiwibW9kdWxlLmV4cG9ydHMgPSB7XG5cdGdhbWVEcml2ZXI6IHJlcXVpcmUoXCJAYWthc2hpYy9nYW1lLWRyaXZlclwiKSxcblx0YWthc2hpY0VuZ2luZTogcmVxdWlyZShcIkBha2FzaGljL2FrYXNoaWMtZW5naW5lXCIpLFxuXHRwZGlCcm93c2VyOiByZXF1aXJlKFwiQGFrYXNoaWMvcGRpLWJyb3dzZXJcIilcbn07XG4iXX0=
