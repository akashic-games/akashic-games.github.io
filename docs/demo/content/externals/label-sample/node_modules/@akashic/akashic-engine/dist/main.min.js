!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).g=e()}(this,function(){"use strict";var A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t,e){return t(e={exports:{}},e.exports),e.exports}var a=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype.add=function(t,e){if("function"==typeof t)this._handlers.push({func:t,owner:e,once:!1,name:void 0});else{var i=t;"number"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!1,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!1,name:i.name})}this.length=this._handlers.length},r.prototype.addOnce=function(t,e){if("function"==typeof t)this._handlers.push({func:t,owner:e,once:!0,name:void 0});else{var i=t;"number"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!0,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!0,name:i.name})}this.length=this._handlers.length},r.prototype.handle=function(t,e,i){this.add(e?{owner:t,func:e,name:i}:{func:t})},r.prototype.fire=function(t){if(this._handlers&&this._handlers.length){for(var e=this._handlers.concat(),i=0;i<e.length;i++){var r=e[i];if(r.func.call(r.owner,t)||r.once){var o=this._handlers.indexOf(r);-1!==o&&this._handlers.splice(o,1)}}null!=this._handlers&&(this.length=this._handlers.length)}},r.prototype.contains=function(t,e){for(var i="function"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++)if(this._comparePartial(i,this._handlers[r]))return!0;return!1},r.prototype.remove=function(t,e){for(var i="function"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++){var o=this._handlers[r];if(i.func===o.func&&i.owner===o.owner&&i.name===o.name)return this._handlers.splice(r,1),void--this.length}},r.prototype.removeAll=function(t){var e=[];if(t)for(var i=0;i<this._handlers.length;i++){var r=this._handlers[i];this._comparePartial(t,r)||e.push(r)}this._handlers=e,this.length=this._handlers.length},r.prototype.destroy=function(){this._handlers=null,this.length=null},r.prototype.destroyed=function(){return null===this._handlers},r.prototype._comparePartial=function(t,e){return!(void 0!==t.func&&t.func!==e.func||void 0!==t.owner&&t.owner!==e.owner||void 0!==t.name&&t.name!==e.name)},r);function r(){this._handlers=[],this.length=0}e.Trigger=i});t(a);a.Trigger;var r=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=(o=a.Trigger,i(n,o),n.prototype.add=function(t,e){o.prototype.add.call(this,t,e),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},n.prototype.addOnce=function(t,e){o.prototype.addOnce.call(this,t,e),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},n.prototype.remove=function(t,e){o.prototype.remove.call(this,t,e),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},n.prototype.removeAll=function(t){o.prototype.removeAll.call(this,t),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},n.prototype.destroy=function(){o.prototype.destroy.call(this),this.chain.remove(this._onChainTriggerFired,this),this.filter=null,this.filterOwner=null,this._isActivated=!1},n.prototype._onChainTriggerFired=function(t){this.filter&&!this.filter.call(this.filterOwner,t)||this.fire(t)},n);function n(t,e,i){var r=o.call(this)||this;return r.chain=t,r.filter=null!=e?e:null,r.filterOwner=i,r._isActivated=!1,r}e.ChainTrigger=s});t(r);r.ChainTrigger;var y=e(function(t,i){function e(t){for(var e in t)i.hasOwnProperty(e)||(i[e]=t[e])}Object.defineProperty(i,"__esModule",{value:!0}),e(a),e(r)});t(y);var o=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(o);var s=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(s);var n=e(function(t,e){var i;Object.defineProperty(e,"__esModule",{value:!0}),e.CompositeOperation=void 0,(i=e.CompositeOperation||(e.CompositeOperation={}))[i.SourceOver=0]="SourceOver",i[i.SourceAtop=1]="SourceAtop",i[i.Lighter=2]="Lighter",i[i.Copy=3]="Copy",i[i.ExperimentalSourceIn=4]="ExperimentalSourceIn",i[i.ExperimentalSourceOut=5]="ExperimentalSourceOut",i[i.ExperimentalDestinationAtop=6]="ExperimentalDestinationAtop",i[i.ExperimentalDestinationIn=7]="ExperimentalDestinationIn",i[i.DestinationOut=8]="DestinationOut",i[i.DestinationOver=9]="DestinationOver",i[i.Xor=10]="Xor"});t(n);n.CompositeOperation;var h=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(h);var c=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(c);var d=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(d);var l=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(l);var u=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(u);var p=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(p);var f=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(f);var _=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(_);var g=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(g);var v=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(v);var m=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(m);var S=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(S);var w=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(w);var x=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(x);var b=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(b);var P=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(P);var M=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(M);var O=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(O);var T=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(T);var E=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(E);var C=e(function(t,e){var i;Object.defineProperty(e,"__esModule",{value:!0}),e.AssetLoadErrorType=void 0,(i=e.AssetLoadErrorType||(e.AssetLoadErrorType={}))[i.Unspecified=0]="Unspecified",i[i.RetryLimitExceeded=1]="RetryLimitExceeded",i[i.NetworkError=2]="NetworkError",i[i.ClientError=3]="ClientError",i[i.ServerError=4]="ServerError"});t(C);C.AssetLoadErrorType;var L=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(L);var F=e(function(t,e){var i;Object.defineProperty(e,"__esModule",{value:!0}),e.FontWeight=void 0,(i=e.FontWeight||(e.FontWeight={}))[i.Normal=0]="Normal",i[i.Bold=1]="Bold"});t(F);F.FontWeight;var I=e(function(t,e){var i;Object.defineProperty(e,"__esModule",{value:!0}),e.FontFamily=void 0,(i=e.FontFamily||(e.FontFamily={}))[i.SansSerif=0]="SansSerif",i[i.Serif=1]="Serif",i[i.Monospace=2]="Monospace"});t(I);I.FontFamily;var k=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(k);var j=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(j);var R=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(R);var U=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(U);var D=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(D);var z=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(z);var B=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(B);var W=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(W);var G=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(G);var N=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(N);var X=e(function(t,e){var r=A&&A.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),i=A&&A.__exportStar||function(t,e){for(var i in t)"default"===i||e.hasOwnProperty(i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),i(o,e),i(s,e),i(n,e),i(h,e),i(c,e),i(d,e),i(l,e),i(u,e),i(p,e),i(f,e),i(_,e),i(g,e),i(v,e),i(m,e),i(S,e),i(w,e),i(x,e),i(b,e),i(P,e),i(M,e),i(O,e),i(T,e),i(E,e),i(C,e),i(L,e),i(F,e),i(I,e),i(k,e),i(j,e),i(R,e),i(U,e),i(D,e),i(z,e),i(B,e),i(W,e),i(G,e),i(N,e)});t(X);var H=e(function(t,e){var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.ExceptionFactory||(e.ExceptionFactory={})).createAssertionError=function(t,e){var i=new Error(t);return i.name="AssertionError",i.cause=e,i},i.createTypeMismatchError=function(t,e,i,r){var o="Type mismatch on "+t+", expected type is "+e;if(2<arguments.length)try{var s;o+=", actual type is "+(40<(s=i&&i.constructor&&i.constructor.name?i.constructor.name:typeof i).length?s.substr(0,40):s)}catch(t){}o+=".";var n=new Error(o);return n.name="TypeMismatchError",n.cause=r,n.expected=e,n.actual=i,n},i.createAssetLoadError=function(t,e,i,r){void 0===e&&(e=!0);var o=new Error(t);return o.name="AssetLoadError",o.cause=r,o.retriable=e,o}});t(H);H.ExceptionFactory;var q=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=(Object.defineProperty(s.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t<0||1<t||isNaN(t)||"number"!=typeof t)throw H.ExceptionFactory.createAssertionError("AudioSystem#volume: expected: 0.0-1.0, actual: "+t);this._volume=t,this._onVolumeChanged()},enumerable:!0,configurable:!0}),s.prototype.requestDestroy=function(t){this._destroyRequestedAssets[t.id]=t},s.prototype._reset=function(){this.stopAll(),this._volume=1,this._destroyRequestedAssets={},this._muted=!1,this._suppressed=!1,this._explicitMuted=!1},s.prototype._setMuted=function(t){var e=this._explicitMuted;this._explicitMuted=!!t,this._explicitMuted!==e&&(this._updateMuted(),this._onMutedChanged())},s.prototype._setPlaybackRate=function(t){if(t<0||isNaN(t)||"number"!=typeof t)throw H.ExceptionFactory.createAssertionError("AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: "+t);this._suppressed=1!==t,this._updateMuted()},s.prototype._updateMuted=function(){this._muted=this._explicitMuted||this._suppressed},s);function s(t){this.id=t.id,this._volume=t.volume||1,this._destroyRequestedAssets={},this._explicitMuted=t.muted||!1,this._suppressed=!1,this._muted=!1,this._resourceFactory=t.resourceFactory,this._updateMuted()}e.AudioSystem=o;var n,a=(i(h,n=o),Object.defineProperty(h.prototype,"player",{get:function(){return this._player||(this._player=this._resourceFactory.createAudioPlayer(this),this._player.onPlay.add(this._handlePlay,this),this._player.onStop.add(this._handleStop,this)),this._player},set:function(t){this._player=t},enumerable:!0,configurable:!0}),h.prototype.findPlayers=function(t){return this.player.currentAudio&&this.player.currentAudio.id===t.id?[this.player]:[]},h.prototype.createPlayer=function(){return this.player},h.prototype.stopAll=function(){this._player&&this._player.stop()},h.prototype._reset=function(){n.prototype._reset.call(this),this._player&&(this._player.onPlay.remove(this._handlePlay,this),this._player.onStop.remove(this._handleStop,this)),this._player=void 0},h.prototype._onVolumeChanged=function(){this.player._notifyVolumeChanged()},h.prototype._onMutedChanged=function(){this.player._changeMuted(this._muted)},h.prototype._setPlaybackRate=function(t){n.prototype._setPlaybackRate.call(this,t),this.player._changeMuted(this._muted)},h.prototype._handlePlay=function(t){if(t.player!==this._player)throw H.ExceptionFactory.createAssertionError("MusicAudioSystem#_onPlayerPlayed: unexpected audio player")},h.prototype._handleStop=function(t){this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy())},h);function h(t){var e=n.call(this,t)||this;return e._player=void 0,e}e.MusicAudioSystem=a;var c,d=(i(l,c=o),l.prototype.createPlayer=function(){var t=this._resourceFactory.createAudioPlayer(this);return t.canHandleStopped()&&this.players.push(t),t.onPlay.add(this._handlePlay,this),t.onStop.add(this._handleStop,this),t},l.prototype.findPlayers=function(t){for(var e=[],i=0;i<this.players.length;++i){var r=this.players[i].currentAudio;r&&r.id===t.id&&e.push(this.players[i])}return e},l.prototype.stopAll=function(){for(var t=this.players.concat(),e=0;e<t.length;++e)t[e].stop()},l.prototype._reset=function(){c.prototype._reset.call(this);for(var t=0;t<this.players.length;++t){var e=this.players[t];e.onPlay.remove(this._handlePlay,this),e.onStop.remove(this._handleStop,this)}this.players=[]},l.prototype._onMutedChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changeMuted(this._muted)},l.prototype._setPlaybackRate=function(t){c.prototype._setPlaybackRate.call(this,t);var e=this.players;if(this._suppressed)for(var i=0;i<e.length;++i)e[i]._changeMuted(!0)},l.prototype._handlePlay=function(t){},l.prototype._handleStop=function(t){var e=this.players.indexOf(t.player);e<0||(t.player.onStop.remove(this._handleStop,this),this.players.splice(e,1),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy()))},l.prototype._onVolumeChanged=function(){for(var t=0;t<this.players.length;++t)this.players[t]._notifyVolumeChanged()},l);function l(t){var e=c.call(this,t)||this;return e.players=[],e}e.SoundAudioSystem=d});t(q);q.AudioSystem,q.MusicAudioSystem,q.SoundAudioSystem;var V=e(function(t,e){var d;Object.defineProperty(e,"__esModule",{value:!0}),(d=e.PathUtil||(e.PathUtil={})).resolvePath=function(t,e){function i(t){var e=t.split("/");return""===e[e.length-1]&&e.pop(),e}if(""===e)return t;for(var r=d.splitPath(t),o=i(r.path).concat(i(e)),s=[],n=0;n<o.length;++n){var a=o[n];switch(a){case"..":var h=s.pop();if(void 0===h||""===h||"."===h)throw H.ExceptionFactory.createAssertionError("PathUtil.resolvePath: invalid arguments");break;case".":0===s.length&&s.push(".");break;case"":s=[""];break;default:s.push(a)}}return r.host+s.join("/")},d.resolveDirname=function(t){var e=t.lastIndexOf("/");return-1===e?t:t.substr(0,e)},d.resolveExtname=function(t){for(var e=t.length-1;0<=e;--e){var i=t.charAt(e);if("."===i)return t.substr(e);if("/"===i)return""}return""},d.makeNodeModulePaths=function(t){var e=d.splitPath(t),i=e.host;"/"===(t=e.path)[t.length-1]&&(t=t.slice(0,t.length-1));for(var r=t.split("/"),o=r.indexOf("node_modules"),s=0<o?o-1:0,n=[],a=r.length-1;s<=a;--a)if("node_modules"!==r[a]){var h=r.slice(0,a+1);h.push("node_modules");var c=h.join("/");n.push(i+c)}return n},d.splitPath=function(t){var e="",i=t.indexOf("//");if(0<=i){var r=t.indexOf("/",i+2);t=0<=r?(e=t.slice(0,r),t.slice(r)):(e=t,"/")}else e="";return{host:e,path:t}}});t(V);V.PathUtil;var Y=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});function i(t){var e=this,i=t.path,r=V.PathUtil.resolveDirname(i),o=t.virtualPath,s=o?V.PathUtil.resolveDirname(o):void 0,n=t.require;this._runtimeValue=Object.create(t.runtimeValueBase,{filename:{value:i,enumerable:!0},dirname:{value:r,enumerable:!0},module:{value:this,writable:!0,enumerable:!0,configurable:!0}}),this.id=t.id,this.filename=t.path,this.exports={},this.parent=null,this.loaded=!1,this.children=[],this.paths=s?V.PathUtil.makeNodeModulePaths(s):[],this._dirname=r,this._virtualDirname=s,this.require=function(t){return n(t,e)}}e.Module=i});t(Y);Y.Module;var J=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});function i(t){this.fragmentShader=t.fragmentShader,this.uniforms=t.uniforms}e.ShaderProgram=i});t(J);J.ShaderProgram;var K=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});function i(){}e.VideoSystem=i});t(K);K.VideoSystem;var $=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});function o(t,e,i,r,o,s){this.priority=s,this.local=!!o,this.player=r,this.pointerId=t,this.target=e,this.point=i}e.PointEventBase=o;var a,s=(i(n,a=o),n);function n(t,e,i,r,o,s){var n=a.call(this,t,e,i,r,o,s)||this;return n.type="point-down",n}e.PointDownEventBase=s;var c,h=(i(d,c=o),d);function d(t,e,i,r,o,s,n,a){var h=c.call(this,t,e,i,s,n,a)||this;return h.type="point-up",h.prevDelta=r,h.startDelta=o,h}e.PointUpEventBase=h;var l,u=(i(p,l=o),p);function p(t,e,i,r,o,s,n,a){var h=l.call(this,t,e,i,s,n,a)||this;return h.type="point-move",h.prevDelta=r,h.startDelta=o,h}e.PointMoveEventBase=u;function f(t,e,i,r){this.type="message",this.priority=r,this.local=!!i,this.player=e,this.data=t}e.MessageEvent=f;function _(t,e,i,r,o){this.type="operation",this.priority=o,this.local=!!r,this.player=i,this.code=t,this.data=e}e.OperationEvent=_;function y(t,e,i){this.type="join",this.priority=i,this.player=t,this.storageValues=e}e.JoinEvent=y;function g(t,e){this.type="leave",this.priority=e,this.player=t}e.LeaveEvent=g;function v(t,e,i){this.type="timestamp",this.priority=i,this.player=e,this.timestamp=t}e.TimestampEvent=v;function m(t,e,i,r){this.type="player-info",this.priority=r,this.playerId=t,this.playerName=e,this.userData=i}e.PlayerInfoEvent=m;function S(t,e){this.type="seed",this.priority=e,this.generator=t}e.SeedEvent=S});t($);$.PointEventBase,$.PointDownEventBase,$.PointUpEventBase,$.PointMoveEventBase,$.MessageEvent,$.OperationEvent,$.JoinEvent,$.LeaveEvent,$.TimestampEvent,$.PlayerInfoEvent,$.SeedEvent;var Z=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype.update=function(t,e,i,r,o,s,n,a,h){if(null!=a&&null!=h){var c=o*Math.PI/180,d=Math.cos(c),l=Math.sin(c),u=d*i,p=l*i,f=l*r,_=d*r,y=a*t,g=h*e;this._matrix[0]=u,this._matrix[1]=p,this._matrix[2]=-f,this._matrix[3]=_,this._matrix[4]=-u*y+f*g+s,this._matrix[5]=-p*y-_*g+n}else this._updateWithoutAnchor(t,e,i,r,o,s,n)},r.prototype._updateWithoutAnchor=function(t,e,i,r,o,s,n){var a=o*Math.PI/180,h=Math.cos(a),c=Math.sin(a),d=h*i,l=c*i,u=c*r,p=h*r,f=t/2,_=e/2;this._matrix[0]=d,this._matrix[1]=l,this._matrix[2]=-u,this._matrix[3]=p,this._matrix[4]=-d*f+u*_+f+s,this._matrix[5]=-l*f-p*_+_+n},r.prototype.updateByInverse=function(t,e,i,r,o,s,n,a,h){if(null!=a&&null!=h){var c=o*Math.PI/180,d=Math.cos(c),l=Math.sin(c),u=d/i,p=l/r,f=l/i,_=d/r,y=a*t,g=h*e;this._matrix[0]=u,this._matrix[1]=-p,this._matrix[2]=f,this._matrix[3]=_,this._matrix[4]=-u*s-f*n+y,this._matrix[5]=p*s-_*n+g}else this._updateByInverseWithoutAnchor(t,e,i,r,o,s,n)},r.prototype._updateByInverseWithoutAnchor=function(t,e,i,r,o,s,n){var a=o*Math.PI/180,h=Math.cos(a),c=Math.sin(a),d=h/i,l=c/r,u=c/i,p=h/r,f=t/2,_=e/2;this._matrix[0]=d,this._matrix[1]=-l,this._matrix[2]=u,this._matrix[3]=p,this._matrix[4]=-d*(f+s)-u*(_+n)+f,this._matrix[5]=l*(f+s)-p*(_+n)+_},r.prototype.multiply=function(t){var e=this._matrix,i=t._matrix,r=e[0],o=e[1],s=e[2],n=e[3];e[0]=r*i[0]+s*i[1],e[1]=o*i[0]+n*i[1],e[2]=r*i[2]+s*i[3],e[3]=o*i[2]+n*i[3],e[4]=r*i[4]+s*i[5]+e[4],e[5]=o*i[4]+n*i[5]+e[5]},r.prototype.multiplyLeft=function(t){var e=t._matrix,i=this._matrix,r=i[0],o=i[2],s=i[4];i[0]=e[0]*r+e[2]*i[1],i[1]=e[1]*r+e[3]*i[1],i[2]=e[0]*o+e[2]*i[3],i[3]=e[1]*o+e[3]*i[3],i[4]=e[0]*s+e[2]*i[5]+e[4],i[5]=e[1]*s+e[3]*i[5]+e[5]},r.prototype.multiplyNew=function(t){var e=this.clone();return e.multiply(t),e},r.prototype.reset=function(t,e){this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=1,this._matrix[4]=t||0,this._matrix[5]=e||0},r.prototype.clone=function(){return new r(this)},r.prototype.multiplyInverseForPoint=function(t){var e=this._matrix,i=1/(e[0]*e[3]+e[2]*-e[1]);return{x:e[3]*i*t.x+-e[2]*i*t.y+(e[5]*e[2]-e[4]*e[3])*i,y:e[0]*i*t.y+-e[1]*i*t.x+(-e[5]*e[0]+e[4]*e[1])*i}},r.prototype.scale=function(t,e){var i=this._matrix;i[0]*=t,i[1]*=e,i[2]*=t,i[3]*=e,i[4]*=t,i[5]*=e},r.prototype.multiplyPoint=function(t){var e=this._matrix;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}},r);function r(t,e,i,r,o,s,n){void 0===t?(this._modified=!1,this._matrix=[1,0,0,1,0,0]):"number"==typeof t?(this._modified=!1,this._matrix=new Array(6),this.update(t,e,i,r,o,0,0,s,n)):(this._modified=t._modified,this._matrix=[t._matrix[0],t._matrix[1],t._matrix[2],t._matrix[3],t._matrix[4],t._matrix[5]])}e.PlainMatrix=i});t(Z);Z.PlainMatrix;var Q=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype.moveTo=function(t,e){if("number"==typeof t&&"number"!=typeof e)throw H.ExceptionFactory.createAssertionError("Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number.");"number"==typeof t?(this.x=t,this.y=e):(this.x=t.x,this.y=t.y)},r.prototype.moveBy=function(t,e){this.x+=t,this.y+=e},r.prototype.resizeTo=function(t,e){if("number"==typeof t&&"number"!=typeof e)throw H.ExceptionFactory.createAssertionError("Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number.");"number"==typeof t?(this.width=t,this.height=e):(this.width=t.width,this.height=t.height)},r.prototype.resizeBy=function(t,e){this.width+=t,this.height+=e},r.prototype.scale=function(t){this.scaleX=t,this.scaleY=t},r.prototype.anchor=function(t,e){this.anchorX=t,this.anchorY=e},r.prototype.getMatrix=function(){if(this._matrix){if(!this._matrix._modified)return this._matrix}else this._matrix=new Z.PlainMatrix;return this._updateMatrix(),this._matrix._modified=!1,this._matrix},r.prototype._updateMatrix=function(){this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?this._matrix.update(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this._matrix.reset(this.x,this.y)},r);function r(t){t?(this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.opacity=null!=t.opacity?t.opacity:1,this.scaleX=null!=t.scaleX?t.scaleX:1,this.scaleY=null!=t.scaleY?t.scaleY:1,this.angle=t.angle||0,this.compositeOperation=t.compositeOperation,this.anchorX=void 0===t.anchorX?0:t.anchorX,this.anchorY=void 0===t.anchorY?0:t.anchorY):(this.x=0,this.y=0,this.width=0,this.height=0,this.opacity=1,this.scaleX=1,this.scaleY=1,this.angle=0,this.compositeOperation=void 0,this.anchorX=0,this.anchorY=0),this._matrix=void 0}e.Object2D=i});t(Q);Q.Object2D;var tt=e(function(t,e){var i,r;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.Util||(e.Util={})).distance=function(t,e,i,r){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))},i.distanceBetweenOffsets=function(t,e){return i.distance(t.x,t.y,e.x,e.y)},i.distanceBetweenAreas=function(t,e){return i.distance(t.x+t.width/2,t.y+t.height/2,e.x+e.width/2,e.y+e.height/2)},i.charCodeAt=function(t,e){var i=t.charCodeAt(e);return 55296<=i&&i<=56319?i<<16|t.charCodeAt(e+1):56320<=i&&i<=57343?null:i},i.enumToSnakeCase=function(t,e){var i=t[e];return i[0].toLowerCase()+i.slice(1).replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})},i.compositeOperationStringTable=((r={})[X.CompositeOperation.SourceOver]="source-over",r[X.CompositeOperation.SourceAtop]="source-atop",r[X.CompositeOperation.Lighter]="lighter",r[X.CompositeOperation.Copy]="copy",r[X.CompositeOperation.ExperimentalSourceIn]="experimental-source-in",r[X.CompositeOperation.ExperimentalSourceOut]="experimental-source-out",r[X.CompositeOperation.ExperimentalDestinationAtop]="experimental-destination-atop",r[X.CompositeOperation.ExperimentalDestinationIn]="experimental-destination-in",r[X.CompositeOperation.DestinationOut]="destination-out",r[X.CompositeOperation.DestinationOver]="destination-over",r[X.CompositeOperation.Xor]="xor",r)});t(tt);tt.Util;var et=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=(o=$.PointDownEventBase,i(n,o),n);function n(){return null!==o&&o.apply(this,arguments)||this}e.PointDownEvent=s;var a,h=(a=$.PointUpEventBase,i(c,a),c);function c(){return null!==a&&a.apply(this,arguments)||this}e.PointUpEvent=h;var d,l=(d=$.PointMoveEventBase,i(u,d),u);function u(){return null!==d&&d.apply(this,arguments)||this}e.PointMoveEvent=l;var p,f=(p=Q.Object2D,i(_,p),Object.defineProperty(_.prototype,"onUpdate",{get:function(){return this._onUpdate||(this._onUpdate=new y.ChainTrigger(this.scene.onUpdate)),this._onUpdate},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"onMessage",{get:function(){return this._onMessage||(this._onMessage=new y.ChainTrigger(this.scene.onMessage)),this._onMessage},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"onPointDown",{get:function(){return this._onPointDown||(this._onPointDown=new y.ChainTrigger(this.scene.onPointDownCapture,this._isTargetOperation,this)),this._onPointDown},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"onPointUp",{get:function(){return this._onPointUp||(this._onPointUp=new y.ChainTrigger(this.scene.onPointUpCapture,this._isTargetOperation,this)),this._onPointUp},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"onPointMove",{get:function(){return this._onPointMove||(this._onPointMove=new y.ChainTrigger(this.scene.onPointMoveCapture,this._isTargetOperation,this)),this._onPointMove},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"touchable",{get:function(){return this._touchable},set:function(t){this._touchable!==t&&((this._touchable=t)?this._enableTouchPropagation():this._disableTouchPropagation())},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"update",{get:function(){return this.onUpdate},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"message",{get:function(){return this.onMessage},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"pointDown",{get:function(){return this.onPointDown},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"pointUp",{get:function(){return this.onPointUp},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"pointMove",{get:function(){return this.onPointMove},enumerable:!0,configurable:!0}),_.prototype.render=function(t,e){if(this.state&=-5,!(1&this.state))if(8&this.state){if(t.translate(this.x,this.y),this.renderSelf(t,e)&&this.children)for(var i=(s=this.children).length,r=0;r<i;++r)s[r].render(t,e);t.translate(-this.x,-this.y)}else{t.save(),this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(this.x,this.y),1!==this.opacity&&t.opacity(this.opacity);var o=this.compositeOperation;if(void 0!==o&&t.setCompositeOperation("string"==typeof o?o:tt.Util.compositeOperationStringTable[o]),void 0!==this.shaderProgram&&t.isSupportedShaderProgram()&&t.setShaderProgram(this.shaderProgram),this.renderSelf(t,e)&&this.children){var s=this.children;for(r=0;r<s.length;++r)s[r].render(t,e)}t.restore()}},_.prototype.renderSelf=function(t,e){return!0},_.prototype.game=function(){return this.scene.game},_.prototype.append=function(t){this.insertBefore(t,void 0)},_.prototype.insertBefore=function(t,e){t.parent&&t.remove(),this.children||(this.children=[]),t.parent=this;var i=-1;void 0!==e&&-1<(i=this.children.indexOf(e))?this.children.splice(i,0,t):this.children.push(t),(t._touchable||t._hasTouchableChildren)&&(this._hasTouchableChildren=!0,this._enableTouchPropagation()),this.modified(!0)},_.prototype.remove=function(t){if(void 0!==t){var e=this.children?this.children.indexOf(t):-1;if(e<0)throw H.ExceptionFactory.createAssertionError("E#remove: invalid child");this.children[e].parent=void 0,this.children.splice(e,1),(t._touchable||t._hasTouchableChildren)&&(this._findTouchableChildren(this)||(this._hasTouchableChildren=!1,this._disableTouchPropagation())),this.modified(!0)}else this.parent.remove(this)},_.prototype.destroy=function(){if(this.parent&&this.remove(),this.children){for(var t=this.children.length-1;0<=t;--t)this.children[t].destroy();if(0!==this.children.length)throw H.ExceptionFactory.createAssertionError("E#destroy: can not destroy all children, "+this.children.length);this.children=void 0}this._onUpdate&&(this._onUpdate.destroy(),this._onUpdate=void 0),this._onMessage&&(this._onMessage.destroy(),this._onMessage=void 0),this._onPointDown&&(this._onPointDown.destroy(),this._onPointDown=void 0),this._onPointMove&&(this._onPointMove.destroy(),this._onPointMove=void 0),this._onPointUp&&(this._onPointUp.destroy(),this._onPointUp=void 0),this.scene.unregister(this)},_.prototype.destroyed=function(){return void 0===this.scene},_.prototype.modified=function(t){this._matrix&&(this._matrix._modified=!0),this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY||1!==this.opacity||void 0!==this.compositeOperation||void 0!==this.shaderProgram?this.state&=-9:this.state|=8,4&this.state||(this.state|=4,this.parent&&this.parent.modified(!0))},_.prototype.shouldFindChildrenByPoint=function(t){return!0},_.prototype.findPointSourceByPoint=function(t,e,i){if(!(1&this.state)){var r=(e=e?e.multiplyNew(this.getMatrix()):this.getMatrix().clone()).multiplyInverseForPoint(t);if(this._hasTouchableChildren||i&&this.children&&this.children.length){var o=this.children;if(this.shouldFindChildrenByPoint(r))for(var s=o.length-1;0<=s;--s){var n=o[s];if(i||n._touchable||n._hasTouchableChildren){var a=n.findPointSourceByPoint(t,e,i);if(a)return a}}}if(i||this._touchable)return 0<=r.x&&this.width>r.x&&0<=r.y&&this.height>r.y?{target:this,point:r}:void 0}},_.prototype.visible=function(){return 1!=(1&this.state)},_.prototype.show=function(){1&this.state&&(this.state&=-2,this.parent&&this.parent.modified(!0))},_.prototype.hide=function(){1&this.state||(this.state|=1,this.parent&&this.parent.modified(!0))},_.prototype.calculateBoundingRect=function(){return this._calculateBoundingRect(void 0)},_.prototype.localToGlobal=function(t){for(var e=t,i=this;i instanceof _;i=i.parent)e=i.getMatrix().multiplyPoint(e);return e},_.prototype.globalToLocal=function(t){for(var e=new Z.PlainMatrix,i=this;i instanceof _;i=i.parent)e.multiplyLeft(i.getMatrix());return e.multiplyInverseForPoint(t)},_.prototype._calculateBoundingRect=function(t){var e=this.getMatrix();if(t&&(e=t.multiplyNew(e)),this.visible()){for(var i={left:0,right:this.width,top:0,bottom:this.height},r=[{x:i.left,y:i.top},{x:i.left,y:i.bottom},{x:i.right,y:i.top},{x:i.right,y:i.bottom}],o=e.multiplyPoint(r[0]),s={left:o.x,right:o.x,top:o.y,bottom:o.y},n=1;n<r.length;++n)o=e.multiplyPoint(r[n]),s.left>o.x&&(s.left=o.x),s.right<o.x&&(s.right=o.x),s.top>o.y&&(s.top=o.y),s.bottom<o.y&&(s.bottom=o.y);if(void 0!==this.children)for(n=0;n<this.children.length;++n){var a=this.children[n]._calculateBoundingRect(e);a&&(s.left>a.left&&(s.left=a.left),s.right<a.right&&(s.right=a.right),s.top>a.top&&(s.top=a.top),s.bottom<a.bottom&&(s.bottom=a.bottom))}return s}},_.prototype._enableTouchPropagation=function(){for(var t=this.parent;t instanceof _&&!t._hasTouchableChildren;)t._hasTouchableChildren=!0,t=t.parent},_.prototype._disableTouchPropagation=function(){for(var t=this.parent;t instanceof _&&t._hasTouchableChildren&&!this._findTouchableChildren(t);)t._hasTouchableChildren=!1,t=t.parent},_.prototype._isTargetOperation=function(t){return!(1&this.state)&&t instanceof $.PointEventBase&&this._touchable&&t.target===this},_.prototype._findTouchableChildren=function(t){if(t.children)for(var e=0;e<t.children.length;++e){if(t.children[e].touchable)return t.children[e];var i=this._findTouchableChildren(t.children[e]);if(i)return i}},_);function _(t){var e=p.call(this,t)||this;if(e.children=void 0,e.parent=void 0,e._touchable=!1,e.state=0,e._hasTouchableChildren=!1,e._onUpdate=void 0,e._onMessage=void 0,e._onPointDown=void 0,e._onPointMove=void 0,e._onPointUp=void 0,e.tag=t.tag,e.shaderProgram=t.shaderProgram,e.local="non-local"!==t.scene.local||!!t.local,t.children)for(var i=0;i<t.children.length;++i)e.append(t.children[i]);return t.parent&&t.parent.append(e),null!=t.touchable&&(e.touchable=t.touchable),t.hidden&&e.hide(),e.id=t.id,t.scene.register(e),e}e.E=f});t(et);et.PointDownEvent,et.PointUpEvent,et.PointMoveEvent,et.E;var it=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=(o=et.E,i(a,o),a.prototype.invalidate=function(){this.state&=-3,this.modified()},a.prototype.renderSelf=function(t,e){var i=a.PADDING;if(this._renderedCamera!==e&&(this.state&=-3,this._renderedCamera=e),!(2&this.state)){this._cacheSize=this.calculateCacheSize();var r=Math.ceil(this._cacheSize.width)+2*i,o=Math.ceil(this._cacheSize.height)+2*i,s=!this._cache||this._cache.width<r||this._cache.height<o;s&&(this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=this.scene.game.resourceFactory.createSurface(r,o),this._renderer=this._cache.renderer());var n=this._renderer;n.begin(),s||n.clear(),n.save(),n.translate(i,i),this.renderCache(n,e),n.restore(),this.state|=2,n.end()}return this._cache&&0<this._cacheSize.width&&0<this._cacheSize.height&&(t.translate(-i,-i),this.renderSelfFromCache(t),t.translate(i,i)),this._shouldRenderChildren},a.prototype.renderSelfFromCache=function(t){t.drawImage(this._cache,0,0,this._cacheSize.width+a.PADDING,this._cacheSize.height+a.PADDING,0,0)},a.prototype.destroy=function(){this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=void 0,o.prototype.destroy.call(this)},a.prototype.calculateCacheSize=function(){return{width:this.width,height:this.height}},a.PADDING=1,a);function a(t){var e=o.call(this,t)||this;return e._shouldRenderChildren=!0,e._cache=void 0,e._renderer=void 0,e._renderedCamera=void 0,e}e.CacheableE=s});t(it);it.CacheableE;var rt=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=(o=et.E,i(n,o),n.prototype.renderSelf=function(t){return t.fillRect(0,0,this.width,this.height,this.cssColor),!0},n);function n(t){var e=o.call(this,t)||this;if("string"!=typeof t.cssColor)throw H.ExceptionFactory.createTypeMismatchError("ColorBox#constructor(cssColor)","string",t.cssColor);return e.cssColor=t.cssColor,e}e.FilledRect=s});t(rt);rt.FilledRect;var ot=e(function(t,e){var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.SurfaceUtil||(e.SurfaceUtil={})).asSurface=function(t){if(t){if("type"in t&&"image"===t.type)return t.asSurface();if("_drawable"in t)return t;throw H.ExceptionFactory.createTypeMismatchError("SurfaceUtil#asSurface","ImageAsset|Surface",t)}},i.setupAnimatingHandler=function(t,e){e.isPlaying()&&t._handleAnimationStart()},i.migrateAnimatingHandler=function(t,e,i){t._handleAnimationStop(),i.isPlaying()&&t._handleAnimationStart()},i.drawNinePatch=function(t,e,i){void 0===i&&(i=4);var r,o=t.renderer(),s=t.width,n=t.height;r="number"==typeof i?{top:i,bottom:i,left:i,right:i}:i,o.begin(),o.clear();for(var a=r.left,h=e.width-r.right,c=r.top,d=e.height-r.bottom,l=r.left,u=s-r.right,p=r.top,f=n-r.bottom,_=[{x:0,y:0,width:r.left,height:r.top},{x:h,y:0,width:r.right,height:r.top},{x:0,y:d,width:r.left,height:r.bottom},{x:h,y:d,width:r.right,height:r.bottom}],y=[{x:0,y:0},{x:u,y:0},{x:0,y:f},{x:u,y:f}],g=0;g<_.length;++g){var v=_[g];o.save(),o.translate(y[g].x,y[g].y),o.drawImage(e,v.x,v.y,v.width,v.height,0,0),o.restore()}var m=[{x:a,y:0,width:h-a,height:r.top},{x:0,y:c,width:r.left,height:d-c},{x:h,y:c,width:r.right,height:d-c},{x:a,y:d,width:h-a,height:r.bottom}],S=[{x:l,y:0,width:u-l,height:r.top},{x:0,y:p,width:r.left,height:f-p},{x:u,y:p,width:r.right,height:f-p},{x:l,y:f,width:u-l,height:r.bottom}];for(g=0;g<m.length;++g){var A=m[g],w=S[g];o.save(),o.translate(w.x,w.y),o.transform([w.width/A.width,0,0,w.height/A.height,0,0]),o.drawImage(e,A.x,A.y,A.width,A.height,0,0),o.restore()}var x=h-a,b=d-c,P=u-l,M=f-p;o.save(),o.translate(l,p),o.transform([P/x,0,0,M/b,0,0]),o.drawImage(e,a,c,x,b,0,0),o.restore(),o.end()}});t(ot);ot.SurfaceUtil;var st=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=(o=et.E,i(n,o),n.prototype._handleUpdate=function(){this.modified()},n.prototype._handleAnimationStart=function(){this.onUpdate.contains(this._handleUpdate,this)||this.onUpdate.add(this._handleUpdate,this)},n.prototype._handleAnimationStop=function(){this.destroyed()||this.onUpdate.remove(this._handleUpdate,this)},n.prototype.renderSelf=function(t,e){return this.srcWidth<=0||this.srcHeight<=0||(this._stretchMatrix&&(t.save(),t.transform(this._stretchMatrix._matrix)),t.drawImage(this._surface,this.srcX,this.srcY,this.srcWidth,this.srcHeight,0,0),this._stretchMatrix&&t.restore()),!0},n.prototype.invalidate=function(){this._invalidateSelf(),this.modified()},n.prototype.destroy=function(t){this._surface&&!this._surface.destroyed()&&t&&this._surface.destroy(),this.src=void 0,this._beforeSrc=void 0,this._surface=void 0,o.prototype.destroy.call(this)},n.prototype._invalidateSelf=function(){this.width===this.srcWidth&&this.height===this.srcHeight?this._stretchMatrix=void 0:(this._stretchMatrix=new Z.PlainMatrix,this._stretchMatrix.scale(this.width/this.srcWidth,this.height/this.srcHeight)),this.src!==this._beforeSrc&&(this._beforeSrc=this.src,"_drawable"in this.src?this._surface=this.src:this._surface=ot.SurfaceUtil.asSurface(this.src)),this._surface!==this._beforeSurface&&(ot.SurfaceUtil.migrateAnimatingHandler(this,this._beforeSurface,this._surface),this._beforeSurface=this._surface)},n);function n(t){var e=o.call(this,t)||this;return e.src=t.src,"_drawable"in t.src?e._surface=t.src:e._surface=ot.SurfaceUtil.asSurface(t.src),null==t.width&&(e.width=e._surface.width),null==t.height&&(e.height=e._surface.height),e.srcWidth=null!=t.srcWidth?t.srcWidth:e.width,e.srcHeight=null!=t.srcHeight?t.srcHeight:e.height,e.srcX=t.srcX||0,e.srcY=t.srcY||0,e._stretchMatrix=void 0,e._beforeSrc=e.src,e._beforeSurface=e._surface,ot.SurfaceUtil.setupAnimatingHandler(e,e._surface),e._invalidateSelf(),e}e.Sprite=s});t(st);st.Sprite;var nt=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=(o=st.Sprite,i(n,o),n.createBySprite=function(t,e,i){var r=new n({scene:t.scene,src:t.src,width:void 0===e?t.width:e,height:void 0===i?t.height:i});return r.srcHeight=void 0===i?t.srcHeight:i,r.srcWidth=void 0===e?t.srcWidth:e,r},n.prototype.start=function(){void 0===this.interval&&(this.interval=1e3/this.game().fps),this._timer&&this._free(),this._timer=this.scene.createTimer(this.interval),this._timer.onElapse.add(this._handleElapse,this)},n.prototype.destroy=function(t){this.stop(),o.prototype.destroy.call(this,t)},n.prototype.stop=function(){this._timer&&this._free()},n.prototype.modified=function(t){this._modifiedSelf(t),o.prototype.modified.call(this,t)},n.prototype._handleElapse=function(){this.frameNumber===this.frames.length-1?this.loop?this.frameNumber=0:(this.stop(),this.onFinish.fire()):this.frameNumber++,this.modified()},n.prototype._free=function(){this._timer&&(this._timer.onElapse.remove(this._handleElapse,this),this._timer.canDelete()&&this.scene.deleteTimer(this._timer),this._timer=void 0)},n.prototype._changeFrame=function(){var t=this.frames[this.frameNumber],e=Math.floor(this._surface.width/this.srcWidth);this.srcX=t%e*this.srcWidth,this.srcY=Math.floor(t/e)*this.srcHeight,this._lastUsedIndex=t},n.prototype._modifiedSelf=function(t){this._lastUsedIndex!==this.frames[this.frameNumber]&&this._changeFrame()},n);function n(t){var e=o.call(this,t)||this;return e._lastUsedIndex=0,e.frameNumber=t.frameNumber||0,e.frames=null!=t.frames?t.frames:[0],e.interval=t.interval,e._timer=void 0,e.loop=null==t.loop||t.loop,e.onFinish=new y.Trigger,e.finished=e.onFinish,e._modifiedSelf(),e}e.FrameSprite=s});t(nt);nt.FrameSprite;var at=e(function(t,e){var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.TextAlign||(e.TextAlign={}))[i.Left=0]="Left",i[i.Center=1]="Center",i[i.Right=2]="Right"});t(at);at.TextAlign;var ht=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=(o=it.CacheableE,i(n,o),n.prototype.aligning=function(t,e){this.width=t,this.widthAutoAdjust=!1,this.textAlign=e},n.prototype.invalidate=function(){this._invalidateSelf(),o.prototype.invalidate.call(this)},n.prototype.renderSelfFromCache=function(t){var e;switch(this._realTextAlign){case"center":e=this.widthAutoAdjust?this._overhangLeft:0;break;case"right":e=this.widthAutoAdjust?this._overhangLeft:this._overhangRight;break;default:e=this._overhangLeft}t.drawImage(this._cache,0,0,this._cacheSize.width+it.CacheableE.PADDING,this._cacheSize.height+it.CacheableE.PADDING,e,0)},n.prototype.renderCache=function(t){if(!(!this.fontSize||this.height<=0||this._textWidth<=0)){var e=this.maxWidth&&0<this.maxWidth&&this.maxWidth<this._textWidth?this.maxWidth/this._textWidth:1,i=0;switch(this._realTextAlign){case"center":i=this.width/2-(this._textWidth+this._overhangLeft)/2*e;break;case"right":i=this.width-(this._textWidth+this._overhangLeft)*e;break;default:i-=this._overhangLeft*e}t.translate(i,0),1!=e&&t.transform([e,0,0,1,0,0]),t.save();for(var r=this.fontSize/this.font.size,o=0;o<this.glyphs.length;++o){var s=this.glyphs[o],n=s.advanceWidth*r,a=s.code;s.isSurfaceValid||(s=this.font.glyphForCharacter(a))?(s.surface&&(t.save(),t.transform([r,0,0,r,0,0]),t.drawImage(s.surface,s.x,s.y,s.width,s.height,s.offsetX,s.offsetY),t.restore()),t.translate(n,0)):this._outputOfWarnLogWithNoGlyph(a,"renderCache()")}t.restore(),t.save(),this.textColor&&(t.setCompositeOperation("source-atop"),t.fillRect(0,0,this._textWidth,this.height,this.textColor)),t.restore()}},n.prototype.destroy=function(){o.prototype.destroy.call(this)},n.prototype._invalidateSelf=function(){this.glyphs.length=0,this._textWidth=0;var t=this.textAlign;if(this._realTextAlign="string"==typeof t?t:tt.Util.enumToSnakeCase(at.TextAlign,t),this.fontSize){for(var e=this.text.length-1,i=this.text.length-1;0<=i;--i){var r=tt.Util.charCodeAt(this.text,i);if(r&&(n=this.font.glyphForCharacter(r))&&0!==n.width&&0!==n.advanceWidth){e=i;break}}var o=0,s=0<this.font.size?this.fontSize/this.font.size:0;for(i=0;i<=e;++i){var n,a=tt.Util.charCodeAt(this.text,i);if(a)if(n=this.font.glyphForCharacter(a)){if(!(n.width<0||n.height<0||n.x<0||n.y<0)){this.glyphs.push(n);var h=0;0===i&&(this._overhangLeft=Math.min(n.offsetX,0),h=-this._overhangLeft),i===e&&(this._overhangRight=Math.max(n.width+n.offsetX-n.advanceWidth,0),h+=this._overhangRight),this._textWidth+=(n.advanceWidth+h)*s;var c=n.offsetY+n.height;o<c&&(o=c)}}else this._outputOfWarnLogWithNoGlyph(a,"_invalidateSelf()")}this.widthAutoAdjust&&(this.width=this._textWidth),this.height=o*s}else this.height=0},n.prototype._outputOfWarnLogWithNoGlyph=function(t,e){var i=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t);console.warn("Label#"+e+": failed to get a glyph for '"+i+"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).")},n);function n(t){var e=o.call(this,t)||this;return e.text=t.text,e.font=t.font,e.textAlign=null!=t.textAlign?t.textAlign:at.TextAlign.Left,e.glyphs=new Array(t.text.length),e.fontSize=t.fontSize,e.maxWidth=t.maxWidth,e.widthAutoAdjust=null==t.widthAutoAdjust||t.widthAutoAdjust,e.textColor=t.textColor,e._realTextAlign="left",e._textWidth=0,e._overhangLeft=0,e._overhangRight=0,e._invalidateSelf(),e}e.Label=s});t(ht);ht.Label;var ct=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=(o=it.CacheableE,i(n,o),Object.defineProperty(n.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this._paddingChanged=!0},enumerable:!0,configurable:!0}),n.prototype.modified=function(t){t&&(this.state&=-3),o.prototype.modified.call(this)},n.prototype.shouldFindChildrenByPoint=function(t){var e=this._normalizedPadding;return e.left<t.x&&this.width-e.right>t.x&&e.top<t.y&&this.height-e.bottom>t.y},n.prototype.renderCache=function(t,e){this.width<=0||this.height<=0||(this._renderBackground(),this._renderChildren(e),this._bgSurface?t.drawImage(this._bgSurface,0,0,this.width,this.height,0,0):this._backgroundImageSurface&&t.drawImage(this._backgroundImageSurface,0,0,this.width,this.height,0,0),this._childrenArea.width<=0||this._childrenArea.height<=0||(t.save(),0===this._childrenArea.x&&0===this._childrenArea.y||t.translate(this._childrenArea.x,this._childrenArea.y),t.drawImage(this._childrenSurface,0,0,this._childrenArea.width,this._childrenArea.height,0,0),t.restore()))},n.prototype.destroy=function(t){t&&this._backgroundImageSurface&&!this._backgroundImageSurface.destroyed()&&this._backgroundImageSurface.destroy(),this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this.backgroundImage=void 0,this._backgroundImageSurface=void 0,this._beforeBackgroundImage=void 0,this._bgSurface=void 0,this._childrenSurface=void 0,o.prototype.destroy.call(this)},n.prototype._renderBackground=function(){if(this.backgroundImage!==this._beforeBackgroundImage&&(this._backgroundImageSurface=ot.SurfaceUtil.asSurface(this.backgroundImage),this._beforeBackgroundImage=this.backgroundImage),this._backgroundImageSurface&&this.backgroundEffector){var t=this.backgroundEffector.render(this._backgroundImageSurface,this.width,this.height);this._bgSurface!==t&&(this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._bgSurface=t)}else this._bgSurface=void 0},n.prototype._renderChildren=function(t){var e=this._oldWidth!==this.width||this._oldHeight!==this.height||this._paddingChanged;if(e&&(this._initialize(),this._paddingChanged=!1,this._oldWidth=this.width,this._oldHeight=this.height),this._childrenRenderer.begin(),e||this._childrenRenderer.clear(),this.children)for(var i=this.children,r=0;r<i.length;++r)i[r].render(this._childrenRenderer,t);this._childrenRenderer.end()},n.prototype._initialize=function(){var t,e=this._padding;t="number"==typeof e?{top:e,bottom:e,left:e,right:e}:this._padding,this._childrenArea={x:t.left,y:t.top,width:this.width-t.left-t.right,height:this.height-t.top-t.bottom};var i=this.scene.game.resourceFactory;this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this._childrenSurface=i.createSurface(Math.ceil(this._childrenArea.width),Math.ceil(this._childrenArea.height)),this._childrenRenderer=this._childrenSurface.renderer(),this._normalizedPadding=t},n.prototype._calculateBoundingRect=function(t){var e=this.getMatrix();if(t&&(e=t.multiplyNew(e)),this.visible()){for(var i={left:0,right:this.width,top:0,bottom:this.height},r=[{x:i.left,y:i.top},{x:i.left,y:i.bottom},{x:i.right,y:i.top},{x:i.right,y:i.bottom}],o=e.multiplyPoint(r[0]),s={left:o.x,right:o.x,top:o.y,bottom:o.y},n=1;n<r.length;++n)o=e.multiplyPoint(r[n]),s.left>o.x&&(s.left=o.x),s.right<o.x&&(s.right=o.x),s.top>o.y&&(s.top=o.y),s.bottom<o.y&&(s.bottom=o.y);return s}},n);function n(t){var e=o.call(this,t)||this;return e._oldWidth=t.width,e._oldHeight=t.height,e.backgroundImage=t.backgroundImage,e._beforeBackgroundImage=t.backgroundImage,e._backgroundImageSurface=ot.SurfaceUtil.asSurface(t.backgroundImage),e.backgroundEffector=t.backgroundEffector,e._shouldRenderChildren=!1,e._padding=t.padding||0,e._initialize(),e._paddingChanged=!1,e}e.Pane=s});t(ct);ct.Pane;var dt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype.getImage=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"image")},r.prototype.getAudio=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"audio")},r.prototype.getScript=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"script")},r.prototype.getText=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"text")},r.prototype.getTextContent=function(t){return this.getText(t).data},r.prototype.getJSONContent=function(t){return JSON.parse(this.getTextContent(t))},r.prototype.getAllImages=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","image")},r.prototype.getAllAudios=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","audio")},r.prototype.getAllScripts=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","script")},r.prototype.getAllTexts=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","text")},r.prototype.getImageById=function(t){return this._assetManager.peekLiveAssetById(t,"image")},r.prototype.getAudioById=function(t){return this._assetManager.peekLiveAssetById(t,"audio")},r.prototype.getScriptById=function(t){return this._assetManager.peekLiveAssetById(t,"script")},r.prototype.getTextById=function(t){return this._assetManager.peekLiveAssetById(t,"text")},r.prototype.getTextContentById=function(t){return this.getTextById(t).data},r.prototype.getJSONContentById=function(t){return JSON.parse(this.getTextById(t).data)},r);function r(t){this._assetManager=t}e.AssetAccessor=i});t(dt);dt.AssetAccessor;var lt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e){this.asset=t,this.handlers=[e],this.errorCount=0,this.loading=!1};function h(t){var e=/([^\*\\\?]*)(\\\*|\\\?|\?|\*(?!\*)|\*\*\/|$)/g,i={"":"","\\*":"\\*","\\?":"\\?","*":"[^/]*","?":"[^/]","**/":"(?:^/)?(?:[^/]+/)*"},r=/[\\^$.*+?()[\]{}|]/g;for(var o="",s=e.exec(t);s&&""!==s[0];s=e.exec(t))o+=s[1].replace(r,"\\$&")+i[s[2]];var n=new RegExp("^"+o+"$");return function(t){return n.test(t)}}var i=(s.prototype.destroy=function(){for(var t=Object.keys(this._refCounts),e=0;e<t.length;++e)this._releaseAsset(t[e]);this.configuration=void 0,this._assets=void 0,this._liveAssetVirtualPathTable=void 0,this._liveAssetPathTable=void 0,this._refCounts=void 0,this._loadings=void 0},s.prototype.destroyed=function(){return void 0===this._assets},s.prototype.retryLoad=function(t){if(!this._loadings.hasOwnProperty(t.id))throw H.ExceptionFactory.createAssertionError("AssetManager#retryLoad: invalid argument.");var e=this._loadings[t.id];if(e.errorCount>s.MAX_ERROR_COUNT){if(!this.configuration[t.id])return;throw H.ExceptionFactory.createAssertionError("AssetManager#retryLoad: too many retrying.")}e.loading||(e.loading=!0,t._load(this))},s.prototype.globalAssetIds=function(){var t=[],e=this.configuration;for(var i in e)e.hasOwnProperty(i)&&e[i].global&&t.push(i);return t},s.prototype.resolvePatternsToAssetIds=function(t){if(0===t.length)return[];for(var e=Object.keys(this._virtualPathToIdTable),i=[],r=0;r<t.length;++r)for(var o=t[r],s="string"==typeof o?h(o):o,n=0;n<e.length;++n){var a=e[n];s("/"+a)&&i.push(this._virtualPathToIdTable[a])}return i},s.prototype.requestAsset=function(t,e){var i,r="string"==typeof t?t:t.id,o=!1;if(this._assets.hasOwnProperty(r))++this._refCounts[r],e._onAssetLoad(this._assets[r]);else if(this._loadings.hasOwnProperty(r))(i=this._loadings[r]).handlers.push(e),++this._refCounts[r],o=!0;else{var s=this._createAssetFor(t);i=new n(s,e),this._loadings[r]=i,this._refCounts[r]=1,o=!0,i.loading=!0,s._load(this)}return o},s.prototype.unrefAsset=function(t){var e="string"==typeof t?t:t.id;0<--this._refCounts[e]||this._releaseAsset(e)},s.prototype.requestAssets=function(t,e){for(var i=0,r=0,o=t.length;r<o;++r)this.requestAsset(t[r],e)&&++i;return i},s.prototype.unrefAssets=function(t){for(var e=0,i=t.length;e<i;++e)this.unrefAsset(t[e])},s.prototype.peekLiveAssetByAccessorPath=function(t,e){if("/"!==t[0])throw H.ExceptionFactory.createAssertionError("AssetManager#peekLiveAssetByAccessorPath(): accessorPath must start with '/'");var i=t.slice(1),r=this._liveAssetVirtualPathTable[i];if(!r||e!==r.type)throw H.ExceptionFactory.createAssertionError("AssetManager#peekLiveAssetByAccessorPath(): No "+e+" asset for "+t);return r},s.prototype.peekLiveAssetById=function(t,e){var i=this._assets[t];if(!i||e!==i.type)throw H.ExceptionFactory.createAssertionError("SceneAssetManager#_getById(): No "+e+" asset for id "+t);return i},s.prototype.peekAllLiveAssetsByPattern=function(t,e){for(var i=Object.keys(this._liveAssetVirtualPathTable),r="string"==typeof t?h(t):t,o=[],s=0;s<i.length;++s){var n=i[s],a=this._liveAssetVirtualPathTable[n];e&&a.type!==e||r("/"+n)&&o.push(a)}return o},s.prototype._normalize=function(t,e){var i={};if(!(t instanceof Object))throw H.ExceptionFactory.createAssertionError("AssetManager#_normalize: invalid arguments.");for(var r in t)if(t.hasOwnProperty(r)){var o=Object.create(t[r]);if(!o.path)throw H.ExceptionFactory.createAssertionError("AssetManager#_normalize: No path given for: "+r);if(!o.virtualPath)throw H.ExceptionFactory.createAssertionError("AssetManager#_normalize: No virtualPath given for: "+r);if(!o.type)throw H.ExceptionFactory.createAssertionError("AssetManager#_normalize: No type given for: "+r);if("image"===o.type){if("number"!=typeof o.width)throw H.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the image asset: "+r);if("number"!=typeof o.height)throw H.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the image asset: "+r)}if("audio"===o.type){void 0===o.duration&&(o.duration=0);var s=e[o.systemId];if(void 0===o.loop&&(o.loop=!!s&&!!s.loop),void 0===o.hint&&(o.hint=s?s.hint:{}),"music"!==o.systemId&&"sound"!==o.systemId)throw H.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong systemId given for the audio asset: "+r)}if("video"===o.type&&!o.useRealSize){if("number"!=typeof o.width)throw H.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the video asset: "+r);if("number"!=typeof o.height)throw H.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the video asset: "+r);o.useRealSize=!1}o.global||(o.global=!1),i[r]=o}return i},s.prototype._createAssetFor=function(t){var e,i,r;if("string"==typeof t)e=t,r=this.configuration[e],i=this.configuration[e].path;else{var o=t;e=o.id,i=(r=o).uri}var s=this._resourceFactory;if(!r)throw H.ExceptionFactory.createAssertionError("AssetManager#_createAssetFor: unknown asset ID: "+e);switch(r.type){case"image":var n=s.createImageAsset(e,i,r.width,r.height);return n.initialize(r.hint),n;case"audio":var a=r.systemId?this._audioSystemManager[r.systemId]:this._audioSystemManager[this._defaultAudioSystemId];return s.createAudioAsset(e,i,r.duration,a,!!r.loop,r.hint);case"text":return s.createTextAsset(e,i);case"script":return s.createScriptAsset(e,i);case"video":var h=new K.VideoSystem;return s.createVideoAsset(e,i,r.width,r.height,h,!!r.loop,!!r.useRealSize);default:throw H.ExceptionFactory.createAssertionError("AssertionError#_createAssetFor: unknown asset type "+r.type+" for asset ID: "+e)}},s.prototype._releaseAsset=function(t){var e=this._assets[t]||this._loadings[t]&&this._loadings[t].asset,i=null;if(e)if(i=e.path,e.inUse())if("audio"===e.type)e._system.requestDestroy(e);else{if("video"!==e.type)throw H.ExceptionFactory.createAssertionError("AssetManager#unrefAssets: Unsupported in-use "+e.id);e.destroy()}else e.destroy();if(delete this._refCounts[t],delete this._loadings[t],delete this._assets[t],this.configuration[t]){var r=this.configuration[t].virtualPath;r&&this._liveAssetVirtualPathTable.hasOwnProperty(r)&&delete this._liveAssetVirtualPathTable[r],i&&this._liveAssetPathTable.hasOwnProperty(i)&&delete this._liveAssetPathTable[i]}},s.prototype._countLoadingAsset=function(){return Object.keys(this._loadings).length},s.prototype._onAssetError=function(t,e){if(!this.destroyed()&&!t.destroyed()){var i=this._loadings[t.id],r=i.handlers;i.loading=!1,++i.errorCount,i.errorCount>s.MAX_ERROR_COUNT&&e.retriable&&(e=H.ExceptionFactory.createAssetLoadError("Retry limit exceeded",!1,null,e)),e.retriable||delete this._loadings[t.id];for(var o=0;o<r.length;++o)r[o]._onAssetError(t,e,this.retryLoad.bind(this))}},s.prototype._onAssetLoad=function(t){if(!this.destroyed()&&!t.destroyed()){var e=this._loadings[t.id];if(e.loading=!1,delete this._loadings[t.id],this._assets[t.id]=t,this.configuration[t.id]){var i=this.configuration[t.id].virtualPath;if(this._liveAssetVirtualPathTable.hasOwnProperty(i)){if(this._liveAssetVirtualPathTable[i].path!==t.path)throw H.ExceptionFactory.createAssertionError("AssetManager#_onAssetLoad(): duplicated asset path")}else this._liveAssetVirtualPathTable[i]=t;this._liveAssetPathTable.hasOwnProperty(t.path)||(this._liveAssetPathTable[t.path]=i)}for(var r=e.handlers,o=0;o<r.length;++o)r[o]._onAssetLoad(t)}},s.MAX_ERROR_COUNT=3,s);function s(t,e,i,r){this._resourceFactory=t.resourceFactory,this._audioSystemManager=t.audio,this._defaultAudioSystemId=t.defaultAudioSystemId,this.configuration=this._normalize(e||{},function(t){void 0===t&&(t={});var e={music:{loop:!0,hint:{streaming:!0}},sound:{loop:!1,hint:{streaming:!1}}};for(var i in e)i in t||(t[i]=e[i]);return t}(i)),this._assets={},this._virtualPathToIdTable={},this._liveAssetVirtualPathTable={},this._liveAssetPathTable={},this._moduleMainScripts=r||{},this._refCounts={},this._loadings={};for(var o=Object.keys(this.configuration),s=0;s<o.length;++s){var n=o[s],a=this.configuration[n];this._virtualPathToIdTable[a.virtualPath]=n}}e.AssetManager=i});t(lt);lt.AssetManager;var ut=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype._reset=function(){this._muted=!1,this.music._reset(),this.sound._reset()},r.prototype._setMuted=function(t){this._muted!==t&&(this._muted=t,this.music._setMuted(t),this.sound._setMuted(t))},r.prototype._setPlaybackRate=function(t){this.music._setPlaybackRate(t),this.sound._setPlaybackRate(t)},r.prototype._initializeAudioSystems=function(t){this.music=new q.MusicAudioSystem({id:"music",muted:this._muted,resourceFactory:t}),this.sound=new q.SoundAudioSystem({id:"sound",muted:this._muted,resourceFactory:t})},r.prototype.stopAll=function(){this.music.stopAll(),this.sound.stopAll()},r);function r(t){this._muted=!1,this._initializeAudioSystems(t)}e.AudioSystemManager=i});t(ut);ut.AudioSystemManager;var pt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype.measureText=function(t){for(var e=0,i=0,r=0,o=null,s=0;s<t.length;s++){var n=tt.Util.charCodeAt(t,s);if(n){var a=this.glyphForCharacter(n);!a||a.x<0||a.y<0||a.width<0||a.height<0||(0===s&&(i=-a.offsetX),e+=(o=a).advanceWidth)}}return o&&(r=e+o.offsetX+o.width-o.advanceWidth),{width:e,actualBoundingBoxLeft:i,actualBoundingBoxRight:r}},r);function r(){}e.Font=i});t(pt);pt.Font;var ft=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=(o=pt.Font,i(n,o),n.prototype.glyphForCharacter=function(t){var e=this.map[t]||this.missingGlyph;if(!e)return null;var i=void 0===e.width?this.defaultGlyphWidth:e.width,r=void 0===e.height?this.defaultGlyphHeight:e.height,o=e.offsetX||0,s=e.offsetY||0,n=void 0===e.advanceWidth?i:e.advanceWidth,a=0===i||0===r?void 0:this.surface;return{code:t,x:e.x,y:e.y,width:i,height:r,surface:a,offsetX:o,offsetY:s,advanceWidth:n,isSurfaceValid:!0,_atlas:null}},n.prototype.destroy=function(){this.surface&&!this.surface.destroyed()&&this.surface.destroy(),this.map=void 0},n.prototype.destroyed=function(){return!this.map},n);function n(t){var e=o.call(this)||this;return e.surface=ot.SurfaceUtil.asSurface(t.src),t.glyphInfo?(e.map=t.glyphInfo.map,e.defaultGlyphWidth=t.glyphInfo.width,e.defaultGlyphHeight=t.glyphInfo.height,e.missingGlyph=t.glyphInfo.missingGlyph,e.size=t.glyphInfo.height):(e.map=t.map||{},e.defaultGlyphWidth=t.defaultGlyphWidth||0,e.defaultGlyphHeight=t.defaultGlyphHeight||0,e.missingGlyph=t.missingGlyph,e.size=t.defaultGlyphHeight||0),e}e.BitmapFont=s});t(ft);ft.BitmapFont;var _t=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=(o=Q.Object2D,i(n,o),n.deserialize=function(t){return new n(t.param)},n.prototype.modified=function(){this._modifiedCount=(this._modifiedCount+1)%32768,this._matrix&&(this._matrix._modified=!0)},n.prototype.serialize=function(){return{param:{local:this.local,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,opacity:this.opacity,scaleX:this.scaleX,scaleY:this.scaleY,angle:this.angle,anchorX:this.anchorX,anchorY:this.anchorY,compositeOperation:this.compositeOperation}}},n.prototype._applyTransformToRenderer=function(t){this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(-this.x,-this.y),1!==this.opacity&&t.opacity(this.opacity)},n.prototype._updateMatrix=function(){this._matrix&&(this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?this._matrix.updateByInverse(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this._matrix.reset(-this.x,-this.y))},n);function n(t){var e=o.call(this,t)||this;return e.local=!!t.local,e.name=t.name,e._modifiedCount=0,e}e.Camera2D=s});t(_t);_t.Camera2D;var yt=e(function(t,e){var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.Collision||(e.Collision={})).intersect=function(t,e,i,r,o,s,n,a){return t<=o+n&&o<=t+i&&e<=s+a&&s<=e+r},i.intersectAreas=function(t,e){return i.intersect(t.x,t.y,t.width,t.height,e.x,e.y,e.width,e.height)},i.within=function(t,e,i,r,o){return void 0===o&&(o=1),o>=tt.Util.distance(t,e,i,r)},i.withinAreas=function(t,e,i){return void 0===i&&(i=1),i>=tt.Util.distanceBetweenAreas(t,e)}});t(yt);yt.Collision;var gt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype.request=function(){return 0!==this.waitingAssetsCount&&(this._requested||(this._requested=!0,this._assetManager.requestAssets(this._assetIds,this)),!0)},r.prototype.destroy=function(){this._requested&&this._assetManager.unrefAssets(this._assets),this.waitingAssetsCount=0,this.userData=void 0,this._handlerSet=void 0,this._assetIds=void 0,this._requested=!1},r.prototype.destroyed=function(){return!this._handlerSet},r.prototype._onAssetError=function(t,e){var i=this._handlerSet;if(!this.destroyed()&&!i.owner.destroyed()){var r={asset:t,error:e,cancelRetry:!1};i.handleLoadFailure.call(i.owner,r),e.retriable&&!r.cancelRetry?this._assetManager.retryLoad(t):this._assetManager.configuration[t.id]&&i.handleFinish.call(i.owner,this,!1)}},r.prototype._onAssetLoad=function(t){var e=this._handlerSet;if(!(this.destroyed()||e.owner.destroyed()||(e.handleLoad.call(e.owner,t),this._assets.push(t),--this.waitingAssetsCount,0<this.waitingAssetsCount))){if(this.waitingAssetsCount<0)throw H.ExceptionFactory.createAssertionError("AssetHolder#_onAssetLoad: broken waitingAssetsCount");e.handleFinish.call(e.owner,this,!0)}},r);function r(t){var e=t.assetManager,i=t.assetIds?t.assetIds.concat():[];i.push.apply(i,e.resolvePatternsToAssetIds(t.assetPaths||[])),this.waitingAssetsCount=i.length,this.userData=t.userData,this._assetManager=e,this._assetIds=i,this._assets=[],this._handlerSet=t.handlerSet,this._requested=!1}e.AssetHolder=i});t(gt);gt.AssetHolder;var vt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype.tick=function(){for(this._scaledElapsed+=1e3;this._scaledElapsed>=this._scaledInterval&&this.onElapse;)this.onElapse.fire(),this._scaledElapsed-=this._scaledInterval},r.prototype.canDelete=function(){return!this.onElapse||0===this.onElapse.length},r.prototype.destroy=function(){this.interval=void 0,this.onElapse.destroy(),this.onElapse=void 0,this.elapsed=void 0,this._scaledInterval=0,this._scaledElapsed=0},r.prototype.destroyed=function(){return void 0===this.onElapse},r);function r(t,e){this.interval=t,this._scaledInterval=Math.round(t*e),this.onElapse=new y.Trigger,this.elapsed=this.onElapse,this._scaledElapsed=0}e.Timer=i});t(vt);vt.Timer;var mt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var s=(i.prototype.destroy=function(){this._timer.onElapse.remove(this._handleElapse,this),this._timer=void 0,this._handler=void 0,this._handlerOwner=void 0,this._fired=void 0,this._firedOwner=void 0},i.prototype.destroyed=function(){return void 0===this._timer},i.prototype._handleElapse=function(){this.destroyed()||(this._handler.call(this._handlerOwner),this._fired&&this._fired.call(this._firedOwner,this))},i);function i(t,e,i,r,o){this._timer=t,this._handler=e,this._handlerOwner=i,this._fired=r,this._firedOwner=o,this._timer.onElapse.add(this._handleElapse,this)}e.TimerIdentifier=s;var r=(o.prototype.destroy=function(){for(var t=0;t<this._identifiers.length;++t)this._identifiers[t].destroy();for(t=0;t<this._timers.length;++t)this._timers[t].destroy();this._timers=void 0,this._trigger=void 0,this._identifiers=void 0,this._fps=void 0},o.prototype.destroyed=function(){return void 0===this._timers},o.prototype.createTimer=function(t){if(this._registered||(this._trigger.add(this._tick,this),this._registered=!0),t<0)throw H.ExceptionFactory.createAssertionError("TimerManager#createTimer: invalid interval");t<1&&(t=1);for(var e=Math.min(1e3,t*this._fps),i=0;i<this._timers.length;++i)if(this._timers[i].interval===t&&this._timers[i]._scaledElapsed<e)return this._timers[i];var r=new vt.Timer(t,this._fps);return this._timers.push(r),r},o.prototype.deleteTimer=function(t){if(t.canDelete()){var e=this._timers.indexOf(t);if(e<0)throw H.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: can not find timer");if(this._timers.splice(e,1),t.destroy(),!this._timers.length){if(!this._registered)throw H.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: handler is not handled");this._trigger.remove(this._tick,this),this._registered=!1}}},o.prototype.setTimeout=function(t,e,i){var r=this.createTimer(e),o=new s(r,t,i,this._onTimeoutFired,this);return this._identifiers.push(o),o},o.prototype.clearTimeout=function(t){this._clear(t)},o.prototype.setInterval=function(t,e,i){var r=this.createTimer(e),o=new s(r,t,i);return this._identifiers.push(o),o},o.prototype.clearInterval=function(t){this._clear(t)},o.prototype._tick=function(){for(var t=this._timers.concat(),e=0;e<t.length;++e)t[e].tick()},o.prototype._onTimeoutFired=function(t){var e=this._identifiers.indexOf(t);if(e<0)throw H.ExceptionFactory.createAssertionError("TimerManager#_onTimeoutFired: can not find identifier");this._identifiers.splice(e,1);var i=t._timer;t.destroy(),this.deleteTimer(i)},o.prototype._clear=function(t){var e=this._identifiers.indexOf(t);if(e<0)throw H.ExceptionFactory.createAssertionError("TimerManager#_clear: can not find identifier");if(t.destroyed())throw H.ExceptionFactory.createAssertionError("TimerManager#_clear: invalid identifier");this._identifiers.splice(e,1);var i=t._timer;t.destroy(),this.deleteTimer(i)},o);function o(t,e){this._timers=[],this._trigger=t,this._identifiers=[],this._fps=e,this._registered=!1}e.TimerManager=r});t(mt);mt.TimerIdentifier,mt.TimerManager;var St=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype.modified=function(t){this.game.modified()},r.prototype.destroy=function(){this.state="before-destroyed",this.onStateChange.fire(this.state);var t=this.game.db;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();for(var e in t=this.game._localDb)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();this._timer.destroy(),this.onUpdate.destroy(),this.onMessage.destroy(),this.onPointDownCapture.destroy(),this.onPointMoveCapture.destroy(),this.onPointUpCapture.destroy(),this.onOperation.destroy(),this.onLoad.destroy(),this.onAssetLoad.destroy(),this.onAssetLoadFailure.destroy(),this.onAssetLoadComplete.destroy(),this.assets={};for(var i=0;i<this._assetHolders.length;++i)this._assetHolders[i].destroy();this._sceneAssetHolder.destroy(),this._storageLoader=void 0,this.game=void 0,this.state="destroyed",this.onStateChange.fire(this.state),this.onStateChange.destroy()},r.prototype.destroyed=function(){return void 0===this.game},r.prototype.createTimer=function(t){return this._timer.createTimer(t)},r.prototype.deleteTimer=function(t){this._timer.deleteTimer(t)},r.prototype.setInterval=function(t,e,i){return this._timer.setInterval(t,e,i)},r.prototype.clearInterval=function(t){this._timer.clearInterval(t)},r.prototype.setTimeout=function(t,e,i){return this._timer.setTimeout(t,e,i)},r.prototype.clearTimeout=function(t){this._timer.clearTimeout(t)},r.prototype.isCurrentScene=function(){return this.game.scene()===this},r.prototype.gotoScene=function(t,e){if(!this.isCurrentScene())throw H.ExceptionFactory.createAssertionError("Scene#gotoScene: this scene is not the current scene");e?this.game.pushScene(t):this.game.replaceScene(t)},r.prototype.end=function(){if(!this.isCurrentScene())throw H.ExceptionFactory.createAssertionError("Scene#end: this scene is not the current scene");this.game.popScene()},r.prototype.register=function(t){this.game.register(t),t.scene=this},r.prototype.unregister=function(t){t.scene=void 0,this.game.unregister(t)},r.prototype.append=function(t){this.insertBefore(t,void 0)},r.prototype.insertBefore=function(t,e){t.parent&&t.remove(),t.parent=this;var i=-1;void 0!==e&&-1<(i=this.children.indexOf(e))?this.children.splice(i,0,t):this.children.push(t),this.modified(!0)},r.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&(this.children[e].parent=void 0,this.children.splice(e,1),this.modified(!0))},r.prototype.findPointSourceByPoint=function(t,e,i){for(var r="non-local"!==this.local,o=this.children,s=i&&i instanceof _t.Camera2D?i.getMatrix():void 0,n=o.length-1;0<=n;--n){var a=o[n].findPointSourceByPoint(t,s,e);if(a)return a.local=a.target&&a.target.local||r,a}return{target:void 0,point:void 0,local:r}},r.prototype.prefetch=function(){this._loaded||this._prefetchRequested||(this._prefetchRequested=!0,this._sceneAssetHolder.request())},r.prototype.serializeStorageValues=function(){if(this._storageLoader)return this._storageLoader._valueStoreSerialization},r.prototype.requestAssets=function(t,e){var i=this;if("ready-fired"!==this._loadingState&&"loaded-fired"!==this._loadingState)throw H.ExceptionFactory.createAssertionError("Scene#requestAsset(): can be called after loaded.");var r=new gt.AssetHolder({assetManager:this.game._assetManager,assetIds:t,handlerSet:{owner:this,handleLoad:this._handleSceneAssetLoad,handleLoadFailure:this._handleSceneAssetLoadFailure,handleFinish:this._handleSceneAssetLoadFinish},userData:function(){i.destroyed()||e()}});this._assetHolders.push(r),r.request()},r.prototype._activate=function(){this.state="active",this.onStateChange.fire(this.state)},r.prototype._deactivate=function(){this.state="deactive",this.onStateChange.fire(this.state)},r.prototype._needsLoading=function(){return 0<this._sceneAssetHolder.waitingAssetsCount||!!this._storageLoader&&!this._storageLoader._loaded},r.prototype._load=function(){if(!this._loaded){this._loaded=!0;var t=this._sceneAssetHolder.request();this._storageLoader&&(this._storageLoader._load(this),t=!0),t||this._notifySceneReady()}},r.prototype._handleSceneAssetLoad=function(t){this.assets[t.id]=t,this.onAssetLoad.fire(t),this.onAssetLoadComplete.fire(t)},r.prototype._handleSceneAssetLoadFailure=function(t){this.onAssetLoadFailure.fire(t),this.onAssetLoadComplete.fire(t.asset)},r.prototype._handleSceneAssetLoadFinish=function(t,e){e?t.userData?this.game._pushPostTickTask(t.userData,null):this._loaded&&(this._storageLoader&&!this._storageLoader._loaded||this._notifySceneReady()):this.game.terminateGame()},r.prototype._onStorageLoadError=function(t){this.game.terminateGame()},r.prototype._onStorageLoaded=function(){0===this._sceneAssetHolder.waitingAssetsCount&&this._notifySceneReady()},r.prototype._notifySceneReady=function(){this._loadingState="ready",this.game._pushPostTickTask(this._fireReady,this)},r.prototype._fireReady=function(){this.destroyed()||(this._onReady.fire(this),this._loadingState="ready-fired")},r.prototype._fireLoaded=function(){this.destroyed()||"loaded-fired"!==this._loadingState&&(this.onLoad.fire(this),this._loadingState="loaded-fired")},r);function r(t){var e=t.game,i=void 0===t.local||!1===t.local?"non-local":!0===t.local?"full-local":t.local,r=void 0!==t.tickGenerationMode?t.tickGenerationMode:"by-clock";t.storageKeys?(this._storageLoader=e.storage._createLoader(t.storageKeys,t.storageValuesSerialization),this.storageValues=this._storageLoader._valueStore):(this._storageLoader=void 0,this.storageValues=void 0),this.name=t.name,this.game=e,this.local=i,this.tickGenerationMode=r,this.onLoad=new y.Trigger,this.loaded=this.onLoad,this._onReady=new y.Trigger,this._ready=this._onReady,this.assets={},this.asset=new dt.AssetAccessor(e._assetManager),this._loaded=!1,this._prefetchRequested=!1,this._loadingState="initial",this.onUpdate=new y.Trigger,this.update=this.onUpdate,this._timer=new mt.TimerManager(this.onUpdate,this.game.fps),this.onAssetLoad=new y.Trigger,this.onAssetLoadFailure=new y.Trigger,this.onAssetLoadComplete=new y.Trigger,this.assetLoaded=this.onAssetLoad,this.assetLoadFailed=this.onAssetLoadFailure,this.assetLoadCompleted=this.onAssetLoadComplete,this.onMessage=new y.Trigger,this.onPointDownCapture=new y.Trigger,this.onPointMoveCapture=new y.Trigger,this.onPointUpCapture=new y.Trigger,this.onOperation=new y.Trigger,this.message=this.onMessage,this.pointDownCapture=this.onPointDownCapture,this.pointMoveCapture=this.onPointMoveCapture,this.pointUpCapture=this.onPointUpCapture,this.operation=this.onOperation,this.children=[],this.state="standby",this.onStateChange=new y.Trigger,this._assetHolders=[],this._sceneAssetHolder=new gt.AssetHolder({assetManager:this.game._assetManager,assetIds:t.assetIds,assetPaths:t.assetPaths,handlerSet:{owner:this,handleLoad:this._handleSceneAssetLoad,handleLoadFailure:this._handleSceneAssetLoadFailure,handleFinish:this._handleSceneAssetLoadFinish},userData:null})}e.Scene=i});t(St);St.Scene;var At=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=(o=St.Scene,i(n,o),n.prototype.destroy=function(){this._clearTargetScene(),o.prototype.destroy.call(this)},n.prototype.reset=function(t){this._clearTargetScene(),this._targetScene=t,"loaded-fired"!==this._loadingState?this.onLoad.addOnce(this._doReset,this):this._doReset()},n.prototype.getTargetWaitingAssetsCount=function(){return this._targetScene?this._targetScene._sceneAssetHolder.waitingAssetsCount:0},n.prototype.end=function(){if(!this._targetScene||"initial"===this._targetScene._loadingState){var t="LoadingScene#end(): the target scene is in invalid state: "+(this._targetScene?this._targetScene._loadingState:"(no scene)");throw H.ExceptionFactory.createAssertionError(t)}this.game.popScene(!0),this.game._pushPostTickTask(this._targetScene._fireLoaded,this._targetScene),this._clearTargetScene()},n.prototype._clearTargetScene=function(){this._targetScene&&(this._targetScene._onReady.removeAll({owner:this}),this._targetScene.onAssetLoad.removeAll({owner:this}),this._targetScene=void 0)},n.prototype._doReset=function(){this.onTargetReset.fire(this._targetScene),"initial"===this._targetScene._loadingState||"ready"===this._targetScene._loadingState?(this._targetScene._onReady.add(this._handleReady,this),this._targetScene.onAssetLoad.add(this._handleAssetLoad,this),this._targetScene._load()):this._handleReady(this._targetScene)},n.prototype._handleAssetLoad=function(t){this.onTargetAssetLoad.fire(t)},n.prototype._handleReady=function(t){this.onTargetReady.fire(t),this._explicitEnd||this.end()},n);function n(t){var e=this;return t.local=!0,(e=o.call(this,t)||this).onTargetReset=new y.Trigger,e.onTargetReady=new y.Trigger,e.onTargetAssetLoad=new y.Trigger,e.targetReset=e.onTargetReset,e.targetReady=e.onTargetReady,e.targetAssetLoaded=e.onTargetAssetLoad,e._explicitEnd=!!t.explicitEnd,e._targetScene=void 0,e}e.LoadingScene=s});t(At);At.LoadingScene;var wt=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=(o=et.E,i(n,o),n.prototype.renderSelf=function(t,e){if(!this.children)return!1;if(e){var i=e,r=this._canceller;i.x===r.x&&i.y===r.y&&i.angle===r.angle&&i.scaleX===r.scaleX&&i.scaleY===r.scaleY||(r.x=i.x,r.y=i.y,r.angle=i.angle,r.scaleX=i.scaleX,r.scaleY=i.scaleY,r._matrix&&(r._matrix._modified=!0)),t.save(),t.transform(r.getMatrix()._matrix)}for(var o=this.children,s=0;s<o.length;++s)o[s].render(t,e);return e&&t.restore(),!1},n);function n(t){var e=o.call(this,t)||this;return e._canceller=new Q.Object2D,e}var a,h=(a=At.LoadingScene,i(c,a),c.prototype._handleLoad=function(){var t,e,i,r;if("compact"===this._style){var o=.05*Math.min(this.game.width,this.game.height);t=this.game.width-o-this._barWidth,e=this.game.height-o-this._barHeight,i="transparent"}else t=(this.game.width-this._barWidth)/2,e=(this.game.height-this._barHeight)/2,i="rgba(0, 0, 0, 0.8)";return this.append(new s({scene:this,children:[new rt.FilledRect({scene:this,width:this.game.width,height:this.game.height,cssColor:i,children:[new rt.FilledRect({scene:this,x:t,y:e,width:this._barWidth,height:this._barHeight,cssColor:"gray",children:[r=new rt.FilledRect({scene:this,width:0,height:this._barHeight,cssColor:"white"})]})]})]})),r.onUpdate.add(this._handleUpdate,this),this._gauge=r,!0},c.prototype._handleUpdate=function(){++this._gaugeUpdateCount;var t=Math.round(205+50*Math.sin(this._gaugeUpdateCount/this.game.fps*(2/3)*(2*Math.PI)));this._gauge.cssColor="rgb("+t+","+t+","+t+")",this._gauge.modified()},c.prototype._handleTargetReset=function(t){this._gauge&&(this._gauge.width=0,this._gauge.modified()),this._totalWaitingAssetCount=t._sceneAssetHolder.waitingAssetsCount},c.prototype._handleTargetAssetLoad=function(t){var e=this._targetScene._sceneAssetHolder.waitingAssetsCount;this._gauge.width=Math.ceil((1-e/this._totalWaitingAssetCount)*this._barWidth),this._gauge.modified()},c);function c(t){var e=a.call(this,{game:t.game,name:"akashic:default-loading-scene"})||this;return"compact"===t.style?(e._barWidth=e.game.width/4,e._barHeight=5,e._style="compact"):(e._barWidth=Math.min(e.game.width,Math.max(100,e.game.width/2)),e._barHeight=5,e._style="default"),e._gauge=void 0,e._gaugeUpdateCount=0,e._totalWaitingAssetCount=0,e.onLoad.add(e._handleLoad,e),e.onTargetReset.add(e._handleTargetReset,e),e.onTargetAssetLoad.add(e._handleTargetAssetLoad,e),e}e.DefaultLoadingScene=h});t(wt);wt.DefaultLoadingScene;var xt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});function i(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.prev=null,this.next=null}e.SurfaceAtlasSlot=i});t(xt);xt.SurfaceAtlasSlot;var bt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype._acquireSurfaceAtlasSlot=function(t,e){t+=1,e+=1;var i=function(t,e,i){for(;t;){if(t.width>=e&&t.height>=i)return t;t=t.next}return null}(this._emptySurfaceAtlasSlotHead,t,e);if(!i)return null;var r,o,s=i.width-t,n=i.height-e;o=s<=n?(r=new xt.SurfaceAtlasSlot(i.x+t,i.y,s,e),new xt.SurfaceAtlasSlot(i.x,i.y+e,i.width,n)):(r=new xt.SurfaceAtlasSlot(i.x,i.y+e,t,n),new xt.SurfaceAtlasSlot(i.x+t,i.y,s,i.height)),r.prev=i.prev,r.next=o,null===r.prev?this._emptySurfaceAtlasSlotHead=r:r.prev.next=r,o.prev=r,o.next=i.next,o.next&&(o.next.prev=o);var a=new xt.SurfaceAtlasSlot(i.x,i.y,t,e);return this._updateUsedRectangleAreaSize(a),a},r.prototype._updateUsedRectangleAreaSize=function(t){var e=t.x+t.width,i=t.y+t.height;e>this._usedRectangleAreaSize.width&&(this._usedRectangleAreaSize.width=e),i>this._usedRectangleAreaSize.height&&(this._usedRectangleAreaSize.height=i)},r.prototype.addSurface=function(t,e,i,r,o){var s=this._acquireSurfaceAtlasSlot(r,o);if(!s)return null;var n=this._surface.renderer();return n.begin(),n.drawImage(t,e,i,r,o,s.x,s.y),n.end(),s},r.prototype.destroy=function(){this._surface.destroy()},r.prototype.destroyed=function(){return this._surface.destroyed()},r.prototype.getAtlasUsedSize=function(){return this._usedRectangleAreaSize},r.prototype.getAccessScore=function(){return this._accessScore},r);function r(t){this._surface=t,this._emptySurfaceAtlasSlotHead=new xt.SurfaceAtlasSlot(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize={width:0,height:0}}e.SurfaceAtlas=i});t(bt);bt.SurfaceAtlas;var Pt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype._deleteAtlas=function(t){for(var e=this._removeLeastFrequentlyUsedAtlas(t).surfaceAtlases,i=0;i<e.length;++i)e[i].destroy()},r.prototype._removeLeastFrequentlyUsedAtlas=function(t){for(var e=[],i=[],r=0;r<t;++r){for(var o=Number.MAX_VALUE,s=-1,n=0;n<this._surfaceAtlases.length;++n)this._surfaceAtlases[n]._accessScore<=o&&(o=this._surfaceAtlases[n]._accessScore,s=n);var a=this._surfaceAtlases.splice(s,1)[0];e.push(a),i.push(this._atlasGlyphsTable.splice(s,1)[0])}return{surfaceAtlases:e,glyphs:i}},r.prototype._moveGlyphSurface=function(t){for(var e=0;e<this._surfaceAtlases.length;++e){var i=(this._currentAtlasIndex+e)%this._surfaceAtlases.length,r=this._surfaceAtlases[i],o=r.addSurface(t.surface,t.x,t.y,t.width,t.height);if(o)return this._currentAtlasIndex=i,t.surface&&t.surface.destroy(),t.surface=r._surface,t.x=o.x,t.y=o.y,this._atlasGlyphsTable[i]||(this._atlasGlyphsTable[i]=[]),this._atlasGlyphsTable[i].push(t),r}return null},r.prototype._reallocateAtlas=function(){if(this._surfaceAtlases.length>=this._maxAtlasNum){for(var t=this._removeLeastFrequentlyUsedAtlas(1),e=t.surfaceAtlases[0],i=t.glyphs[0],r=0;r<i.length;r++){var o=i[r];o.surface=void 0,o.isSurfaceValid=!1,o._atlas=null}e.destroy()}var s=this._resourceFactory.createSurface(this._atlasSize.width,this._atlasSize.height);this._surfaceAtlases.push(new bt.SurfaceAtlas(s)),this._currentAtlasIndex=this._surfaceAtlases.length-1},r.prototype.addAtlas=function(){this._surfaceAtlases.length>=this._maxAtlasNum&&this._deleteAtlas(1);var t=this._resourceFactory.createSurface(this._atlasSize.width,this._atlasSize.height);this._surfaceAtlases.push(new bt.SurfaceAtlas(t))},r.prototype.getAtlas=function(t){return this._surfaceAtlases[t]},r.prototype.getAtlasNum=function(){return this._surfaceAtlases.length},r.prototype.getMaxAtlasNum=function(){return this._maxAtlasNum},r.prototype.changeMaxAtlasNum=function(t){if(this._maxAtlasNum=t,this._surfaceAtlases.length>this._maxAtlasNum){var e=this._surfaceAtlases.length-this._maxAtlasNum;this._deleteAtlas(e)}},r.prototype.getAtlasUsedSize=function(){return this._atlasSize},r.prototype.addGlyph=function(t){if(t.width>this._atlasSize.width||t.height>this._atlasSize.height)return null;var e=this._moveGlyphSurface(t);return e||(this._reallocateAtlas(),e=this._moveGlyphSurface(t)),e},r.prototype.destroy=function(){for(var t=0;t<this._surfaceAtlases.length;++t)this._surfaceAtlases[t].destroy();this._surfaceAtlases=void 0,this._resourceFactory=void 0,this._atlasGlyphsTable=void 0},r.prototype.destroyed=function(){return void 0===this._surfaceAtlases},r.INITIAL_MAX_SURFACEATLAS_NUM=10,r);function r(t){this._surfaceAtlases=[],this._atlasGlyphsTable=[],this._resourceFactory=t.resourceFactory,this._currentAtlasIndex=0;var e,i=t.hint?t.hint:{};this._maxAtlasNum=i.maxAtlasNum?i.maxAtlasNum:r.INITIAL_MAX_SURFACEATLAS_NUM,i.initialAtlasWidth=i.initialAtlasWidth?i.initialAtlasWidth:512,i.initialAtlasHeight=i.initialAtlasHeight?i.initialAtlasHeight:512,i.maxAtlasWidth=i.maxAtlasWidth?i.maxAtlasWidth:512,i.maxAtlasHeight=i.maxAtlasHeight?i.maxAtlasHeight:512,this._atlasSize=(e=i,{width:Math.ceil(Math.min(e.initialAtlasWidth,e.maxAtlasWidth)),height:Math.ceil(Math.min(e.initialAtlasHeight,e.maxAtlasHeight))})}e.SurfaceAtlasSet=i});t(Pt);Pt.SurfaceAtlasSet;var Mt=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var u,o=(u=pt.Font,i(s,u),s.prototype.glyphForCharacter=function(t){var e=this._glyphs[t];if(!e||!e.isSurfaceValid){if((e=this._glyphFactory.create(t)).surface){var i=this._atlasSet.addGlyph(e);if(!i)return null;e._atlas=i,e._atlas._accessScore+=1}this._glyphs[t]=e}for(var r=0;r<this._atlasSet.getAtlasNum();r++)this._atlasSet.getAtlas(r)._accessScore/=2;return e},s.prototype.asBitmapFont=function(t){var o=this;if(1!==this._atlasSet.getAtlasNum())return null;var e=null;t&&(e=tt.Util.charCodeAt(t,0),this.glyphForCharacter(e));var s={};Object.keys(this._glyphs).forEach(function(t){var e=Number(t),i=o._glyphs[e],r={x:i.x,y:i.y,width:i.width,height:i.height,offsetX:i.offsetX,offsetY:i.offsetY,advanceWidth:i.advanceWidth};s[e]=r});var i=s[e],r=this._atlasSet.getAtlas(0),n=r.getAtlasUsedSize(),a=this._resourceFactory.createSurface(n.width,n.height),h=a.renderer();return h.begin(),h.drawImage(r._surface,0,0,n.width,n.height,0,0),h.end(),new ft.BitmapFont({src:a,map:s,defaultGlyphWidth:0,defaultGlyphHeight:this.size,missingGlyph:i})},s.prototype.destroy=function(){this._isSurfaceAtlasSetOwner&&this._atlasSet.destroy(),this._glyphs=void 0,this._glyphFactory=void 0,this._destroyed=!0},s.prototype.destroyed=function(){return this._destroyed},s);function s(t){var e=u.call(this)||this;e.fontFamily=t.fontFamily,e.size=t.size,e.hint=null!=t.hint?t.hint:{},e.fontColor=null!=t.fontColor?t.fontColor:"black",e.fontWeight=null!=t.fontWeight?t.fontWeight:X.FontWeight.Normal,e.strokeWidth=null!=t.strokeWidth?t.strokeWidth:0,e.strokeColor=null!=t.strokeColor?t.strokeColor:"black",e.strokeOnly=null!=t.strokeOnly&&t.strokeOnly;var i=t.game;e._resourceFactory=i.resourceFactory;var r,o=e.fontFamily;if("string"==typeof o)r=o;else if(Array.isArray(o)){for(var s=[],n=0;n<o.length;++n){var a=o[n];s.push("string"==typeof a?a:tt.Util.enumToSnakeCase(X.FontFamily,a))}r=s}else{(s=[]).push("string"==typeof o?o:tt.Util.enumToSnakeCase(X.FontFamily,o)),r=s}var h=e.fontWeight,c="string"==typeof h?h:tt.Util.enumToSnakeCase(X.FontWeight,h);if(e._glyphFactory=e._resourceFactory.createGlyphFactory(r,e.size,e.hint.baselineHeight,e.fontColor,e.strokeWidth,e.strokeColor,e.strokeOnly,c),e._glyphs={},e._destroyed=!1,e._isSurfaceAtlasSetOwner=!1,t.surfaceAtlasSet?e._atlasSet=t.surfaceAtlasSet:t.hint?(e._isSurfaceAtlasSetOwner=!0,e._atlasSet=new Pt.SurfaceAtlasSet({resourceFactory:i.resourceFactory,hint:e.hint})):e._atlasSet=i.surfaceAtlasSet,e._atlasSet&&e._atlasSet.addAtlas(),e.hint.presetChars){n=0;for(var d=e.hint.presetChars.length;n<d;n++){var l=tt.Util.charCodeAt(e.hint.presetChars,n);l&&e.glyphForCharacter(l)}}return e}e.DynamicFont=o});t(Mt);Mt.DynamicFont;var Ot=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(Ot);var Tt=e(function(t,e){var i,r,o,s;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.StorageRegion||(e.StorageRegion={}))[i.Slots=1]="Slots",i[i.Scores=2]="Scores",i[i.Counts=3]="Counts",i[i.Values=4]="Values",(r=e.StorageOrder||(e.StorageOrder={}))[r.Asc=0]="Asc",r[r.Desc=1]="Desc",(o=e.StorageCondition||(e.StorageCondition={}))[o.Equal=1]="Equal",o[o.GreaterThan=2]="GreaterThan",o[o.LessThan=3]="LessThan",(s=e.StorageCountsOperation||(e.StorageCountsOperation={}))[s.Incr=1]="Incr",s[s.Decr=2]="Decr";var n=(a.prototype.get=function(t){if(void 0===this._values)return[];if("number"==typeof t)return this._values[t];var e=this._keys.indexOf(t);if(-1!==e)return this._values[e];for(var i=0;i<this._keys.length;++i){var r=this._keys[i];if(r.region===t.region&&r.regionKey===t.regionKey&&r.userId===t.userId&&r.gameId===t.gameId)return this._values[i]}return[]},a.prototype.getOne=function(t){var e=this.get(t);if(e)return e[0]},a);function a(t,e){this._keys=t,this._values=e}e.StorageValueStore=n;var h=(c.prototype._load=function(t){this._handler=t,this._storage._load&&this._storage._load.call(this._storage,this._valueStore._keys,this,this._valueStoreSerialization)},c.prototype._onLoaded=function(t,e){this._valueStore._values=t,this._loaded=!0,e&&(this._valueStoreSerialization=e),this._handler&&this._handler._onStorageLoaded()},c.prototype._onError=function(t){this._handler&&this._handler._onStorageLoadError(t)},c);function c(t,e,i){this._loaded=!1,this._storage=t,this._valueStore=new n(e),this._handler=void 0,this._valueStoreSerialization=i}e.StorageLoader=h;var d=(l.prototype.write=function(t,e,i){this._write&&this._write(t,e,i)},l.prototype.requestValuesForJoinPlayer=function(t){this._requestedKeysForJoinPlayer=t},l.prototype._createLoader=function(t,e){return new h(this,t,e)},l.prototype._registerWrite=function(t){this._write=t},l.prototype._registerLoad=function(t){this._load=t},l);function l(){}e.Storage=d});t(Tt);Tt.StorageRegion,Tt.StorageOrder,Tt.StorageCondition,Tt.StorageCountsOperation,Tt.StorageValueStore,Tt.StorageLoader,Tt.Storage;var Et=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype.toGameEvent=function(t){var e,i,r,o,s,n,a,h,c=t[0],d=t[1],l=t[2],u=this._playerTable[l]||{id:l};switch(c){case 0:u={id:l,name:t[3]},this._playerTable[l]&&null!=this._playerTable[l].userData&&(u.userData=this._playerTable[l].userData),this._playerTable[l]=u;var p=void 0;if(t[4]){var f=[],_=[];t[4].map(function(t){f.push(t.readKey),_.push(t.values)}),p=new Tt.StorageValueStore(f,_)}return new $.JoinEvent(u,p,d);case 1:return delete this._playerTable[u.id],new $.LeaveEvent(u,d);case 2:return h=t[3],new $.TimestampEvent(h,u,d);case 3:var y=t[3],g=t[4];return this._playerTable[l]={id:l,name:y,userData:g},new $.PlayerInfoEvent(l,y,g,d);case 32:return a=t[4],new $.MessageEvent(t[3],u,a,d);case 33:return a=t[7],e=t[3],r=null==(i=t[6])?void 0:0<=i?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},new et.PointDownEvent(e,r,o,u,a,d);case 34:return a=t[11],e=t[3],r=null==(i=t[10])?void 0:0<=i?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},s={x:t[6],y:t[7]},n={x:t[8],y:t[9]},new et.PointMoveEvent(e,r,o,n,s,u,a,d);case 35:return a=t[11],e=t[3],r=null==(i=t[10])?void 0:0<=i?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},s={x:t[6],y:t[7]},n={x:t[8],y:t[9]},new et.PointUpEvent(e,r,o,n,s,u,a,d);case 64:a=t[5];var v=t[3],m=t[4],S=this._game._decodeOperationPluginOperation(v,m);return new $.OperationEvent(v,S,u,a,d);default:throw H.ExceptionFactory.createAssertionError("EventConverter#toGameEvent")}},r.prototype.toPlaylogEvent=function(t,e){var i,r;switch(t.type){case"join":case"leave":throw H.ExceptionFactory.createAssertionError("EventConverter#toPlaylogEvent: Invalid type: "+t.type);case"timestamp":return r=e?t.player.id:this._playerId,[2,t.priority,r,t.timestamp];case"player-info":return r=e?t.playerId:this._playerId,[3,t.priority,r,t.playerName,t.userData];case"point-down":return i=t.target?t.target.id:null,r=e&&t.player?t.player.id:this._playerId,[33,t.priority,r,t.pointerId,t.point.x,t.point.y,i,!!t.local];case"point-move":return i=t.target?t.target.id:null,r=e&&t.player?t.player.id:this._playerId,[34,t.priority,r,t.pointerId,t.point.x,t.point.y,t.startDelta.x,t.startDelta.y,t.prevDelta.x,t.prevDelta.y,i,!!t.local];case"point-up":return i=t.target?t.target.id:null,r=e&&t.player?t.player.id:this._playerId,[35,t.priority,r,t.pointerId,t.point.x,t.point.y,t.startDelta.x,t.startDelta.y,t.prevDelta.x,t.prevDelta.y,i,!!t.local];case"message":return r=e&&t.player?t.player.id:this._playerId,[32,t.priority,r,t.data,!!t.local];case"operation":return r=e&&t.player?t.player.id:this._playerId,[64,t.priority,r,t.code,t.data,!!t.local];default:throw H.ExceptionFactory.createAssertionError("Unknown type: "+t.type)}},r.prototype.makePlaylogOperationEvent=function(t){var e=this._playerId;return[64,null!=t.priority?t.priority:0,e,t._code,t.data,!!t.local]},r);function r(t){this._game=t.game,this._playerId=t.playerId,this._playerTable={}}e.EventConverter=i});t(Et);Et.EventConverter;var Ct=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(Ct);var Lt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});t(Lt);var Ft=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype._cachedValue=function(){return this._value},r);function r(t){this._value=t}e.RequireCachedValue=i});t(Ft);Ft.RequireCachedValue;var It=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype._cachedValue=function(){if(!this._started)throw H.ExceptionFactory.createAssertionError("ScriptAssetContext#_cachedValue: not executed yet.");return this._module.exports},r.prototype._executeScript=function(t){return this._started||(t&&(this._module.parent=t).children.push(this._module),this._started=!0,this._asset.execute(this._module._runtimeValue),this._module.loaded=!0),this._module.exports},r);function r(t,e){this._asset=t,this._module=e,this._started=!1}e.ScriptAssetContext=i});t(It);It.ScriptAssetContext;var kt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype._require=function(t,e){var i,r,o=this,s=this._assetManager._liveAssetVirtualPathTable,n=this._assetManager._moduleMainScripts;if(-1===t.indexOf("/")&&this._assetManager._assets.hasOwnProperty(t)&&(i=this._assetManager._assets[t],r=this._assetManager._liveAssetPathTable[i.path]),/^\.\/|^\.\.\/|^\//.test(t)){if(e){if(!e._virtualDirname)throw H.ExceptionFactory.createAssertionError("g._require: require from modules without virtualPath is not supported");r=V.PathUtil.resolvePath(e._virtualDirname,t)}else{if(!/^\.\//.test(t))throw H.ExceptionFactory.createAssertionError("g._require: entry point path must start with './'");r=t.substring(2)}if(this._scriptCaches.hasOwnProperty(r))return this._scriptCaches[r]._cachedValue();if(this._scriptCaches.hasOwnProperty(r+".js"))return this._scriptCaches[r+".js"]._cachedValue();i=(i=i||this._findAssetByPathAsFile(r,s))||this._findAssetByPathAsDirectory(r,s)}else if(n[t]&&(i=s[r=n[t]]),!i){var a=e?e.paths:[];a.push("node_modules");for(var h=0;h<a.length;++h){var c=a[h];if(r=V.PathUtil.resolvePath(c,t),i=this._findAssetByPathAsFile(r,s))break;if(i=this._findAssetByPathAsDirectory(r,s))break}}if(i){if(this._scriptCaches.hasOwnProperty(r))return this._scriptCaches[r]._cachedValue();if("script"===i.type){var d=new Y.Module({runtimeValueBase:this._runtimeValueBase,id:i.id,path:i.path,virtualPath:this._assetManager._liveAssetPathTable[i.path],require:function(t,e){return o._require(t,e)}}),l=new It.ScriptAssetContext(i,d);return(this._scriptCaches[r]=l)._executeScript(e)}if("text"===i.type&&i&&".json"===V.PathUtil.resolveExtname(t))return(this._scriptCaches[r]=new Ft.RequireCachedValue(JSON.parse(i.data)))._cachedValue()}throw H.ExceptionFactory.createAssertionError("g._require: can not find module: "+t)},r.prototype._findAssetByPathAsFile=function(t,e){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t+".js")?e[t+".js"]:void 0},r.prototype._findAssetByPathAsDirectory=function(t,e){var i;if(i=t+"/package.json",e.hasOwnProperty(i)&&"text"===e[i].type){var r=JSON.parse(e[i].data);if(r&&"string"==typeof r.main){var o=this._findAssetByPathAsFile(V.PathUtil.resolvePath(t,r.main),e);if(o)return o}}if(i=t+"/index.js",e.hasOwnProperty(i))return e[i]},r);function r(t,e){this._assetManager=e,this._runtimeValueBase=t,this._scriptCaches={}}e.ModuleManager=i});t(kt);kt.ModuleManager;var jt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype.render=function(t,e,i){return this._surface&&this._surface.width===e&&this._surface.height===i&&this._beforeSrcSurface===t||(this._surface=this.game.resourceFactory.createSurface(Math.ceil(e),Math.ceil(i)),this._beforeSrcSurface=t),ot.SurfaceUtil.drawNinePatch(this._surface,t,this.borderWidth),this._surface},r);function r(t,e){void 0===e&&(e=4),this.game=t,this.borderWidth="number"==typeof e?{top:e,bottom:e,left:e,right:e}:e}e.NinePatchSurfaceEffector=i});t(jt);jt.NinePatchSurfaceEffector;var Rt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var s=(i.prototype.onOperation=function(t){var e;t instanceof Array?e={_code:this._code,data:t}:(e=t)._code=this._code,this._handler.call(this._handlerOwner,e)},i);function i(t,e,i){this._code=t,this._handler=i,this._handlerOwner=e}var r=(o.prototype.initialize=function(){this._initialized||(this._initialized=!0,this._loadOperationPlugins()),this._doAutoStart()},o.prototype.register=function(t,e,i){this._infos[e]={code:e,_plugin:this._instantiateOperationPlugin(t,e,i)}},o.prototype.start=function(t){var e=this._infos[t];e&&e._plugin&&e._plugin.start()},o.prototype.stop=function(t){var e=this._infos[t];e&&e._plugin&&e._plugin.stop()},o.prototype.destroy=function(){this.stopAll(),this.onOperate.destroy(),this.onOperate=void 0,this.operated=void 0,this.plugins=void 0,this._game=void 0,this._viewInfo=void 0,this._infos=void 0},o.prototype.stopAll=function(){if(this._initialized)for(var t=0;t<this._infos.length;++t){var e=this._infos[t];e._plugin&&e._plugin.stop()}},o.prototype._doAutoStart=function(){for(var t=0;t<this._infos.length;++t){var e=this._infos[t];!e.manualStart&&e._plugin&&e._plugin.start()}},o.prototype._loadOperationPlugins=function(){for(var t=0;t<this._infos.length;++t){var e=this._infos[t];if(e.script){var i=this._game._moduleManager._require(e.script);e._plugin=this._instantiateOperationPlugin(i,e.code,e.option)}}},o.prototype._instantiateOperationPlugin=function(t,e,i){if(t.isSupported()){if(this.plugins[e])throw new Error("Plugin#code conflicted for code: "+e);if(this._infos[e])throw new Error("this plugin (code: "+e+") is already defined in game.json");var r=new t(this._game,this._viewInfo,i);this.plugins[e]=r;var o=new s(e,this.onOperate,this.onOperate.fire);return r.operationTrigger.add(o.onOperation,o),r}},o);function o(t,e,i){this.onOperate=new y.Trigger,this.operated=this.onOperate,this.plugins={},this._game=t,this._viewInfo=e,this._infos=i,this._initialized=!1}e.OperationPluginManager=r});t(Rt);Rt.OperationPluginManager;var Ut=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.prototype.pointDown=function(t){var e=this._sourceResolver.findPointSource(t.offset),i=e.point?e.point:t.offset,r=e.target?e.target.id:void 0,o=e.local;this._pointEventMap[t.identifier]={targetId:r,local:o,point:i,start:{x:t.offset.x,y:t.offset.y},prev:{x:t.offset.x,y:t.offset.y}};var s=[33,2,this._playerId,t.identifier,i.x,i.y,r];return e&&e.local&&s.push(e.local),s},r.prototype.pointMove=function(t){var e=this._pointEventMap[t.identifier];if(!e)return null;var i={x:0,y:0},r={x:0,y:0};this._pointMoveAndUp(e,t.offset,i,r);var o=[34,2,this._playerId,t.identifier,e.point.x,e.point.y,r.x,r.y,i.x,i.y,e.targetId];return e.local&&o.push(e.local),o},r.prototype.pointUp=function(t){var e=this._pointEventMap[t.identifier];if(!e)return null;var i={x:0,y:0},r={x:0,y:0};this._pointMoveAndUp(e,t.offset,i,r),delete this._pointEventMap[t.identifier];var o=[35,2,this._playerId,t.identifier,e.point.x,e.point.y,r.x,r.y,i.x,i.y,e.targetId];return e.local&&o.push(e.local),o},r.prototype._pointMoveAndUp=function(t,e,i,r){r.x=e.x-t.start.x,r.y=e.y-t.start.y,i.x=e.x-t.prev.x,i.y=e.y-t.prev.y,t.prev.x=e.x,t.prev.y=e.y},r);function r(t){this._pointEventMap={},this._sourceResolver=t.sourceResolver,this._playerId=t.playerId}e.PointEventResolver=i});t(Ut);Ut.PointEventResolver;var Dt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});function i(t){this.seed=t}e.RandomGenerator=i});t(Dt);Dt.RandomGenerator;var zt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.createSpriteFromE=function(t,e,i){var r=e.x,o=e.y,s=0,n=0,a=e.width,h=e.height,c=e.calculateBoundingRect();if(!c)throw H.ExceptionFactory.createAssertionError("SpriteFactory.createSpriteFromE: camera must look e");a=c.right-c.left,h=c.bottom-c.top,c.left<e.x&&(s=e.x-c.left),c.top<e.y&&(n=e.y-c.top),e.moveTo(s,n),e._matrix&&(e._matrix._modified=!0);var d=t.game.resourceFactory.createSurface(Math.ceil(a),Math.ceil(h)),l=d.renderer();l.begin(),e.render(l,i),l.end();var u=new st.Sprite({scene:t,src:d,width:a,height:h});return u.moveTo(c.left,c.top),e.moveTo(r,o),e._matrix&&(e._matrix._modified=!0),u},r.createSpriteFromScene=function(t,e,i){var r=t.game.resourceFactory.createSurface(Math.ceil(e.game.width),Math.ceil(e.game.height)),o=r.renderer();o.begin();for(var s=e.children,n=0;n<s.length;++n)s[n].render(o,i);return o.end(),new st.Sprite({scene:t,src:r,width:e.game.width,height:e.game.height})},r);function r(){}e.SpriteFactory=i});t(zt);zt.SpriteFactory;var Bt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(r.deserialize=function(t){var e=new r(0);return e._state0U=t._state0U,e._state0L=t._state0L,e._state1U=t._state1U,e._state1L=t._state1L,e},r.prototype.initState=function(t){var e=1812433253;t=e*(t^t>>30)+1,t=e*((this._state0U=t)^t>>30)+2,t=e*((this._state0L=t)^t>>30)+3,t=e*((this._state1U=t)^t>>30)+4,this._state1L=t},r.prototype.randomInt=function(){var t=this._state0U,e=this._state0L,i=this._state1U,r=this._state1L,o=0,s=0;o=(t^=o=t<<23|(-512&e)>>>9)^(this._state0U=i),s=(e^=s=e<<23)^(this._state0L=r),o^=t>>>17,s^=e>>>17|(131071&t)<<15,o^=i>>>26,s^=r>>>26|(67108863&i)<<6,this._state1U=o;var n=((this._state1L=s)>>>0)+(r>>>0);return[o+i+(n/2>>>31)>>>0,n>>>0]},r.prototype.random=function(){var t=this.randomInt();return(4294967296*t[0]+t[1])/0x10000000000000000},r.prototype.nextInt=function(t,e){return Math.floor(t+this.random()*(e-t))},r.prototype.serialize=function(){return{_state0U:this._state0U,_state0L:this._state0L,_state1U:this._state1U,_state1L:this._state1L}},r);function r(t){this.initState(t)}e.Xorshift=i});t(Bt);Bt.Xorshift;var Wt=e(function(t,e){var r,i=A&&A.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=(o=Dt.RandomGenerator,i(n,o),n.deserialize=function(t){return new n(t._seed,t._xorshift)},n.prototype.get=function(t,e){return this._xorshift.nextInt(t,e+1)},n.prototype.generate=function(){return this._xorshift.random()},n.prototype.serialize=function(){return{_seed:this.seed,_xorshift:this._xorshift.serialize()}},n);function n(t,e){var i=this;if(void 0===t)throw H.ExceptionFactory.createAssertionError("XorshiftRandomGenerator#constructor: seed is undefined");return(i=o.call(this,t)||this)._xorshift=e?Bt.Xorshift.deserialize(e):new Bt.Xorshift(t),i}e.XorshiftRandomGenerator=s});t(Wt);Wt.XorshiftRandomGenerator;var Gt=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=(Object.defineProperty(r.prototype,"focusingCamera",{get:function(){return this._focusingCamera},set:function(t){t!==this._focusingCamera&&(this._modified&&this.render(),this._focusingCamera=t)},enumerable:!0,configurable:!0}),r.prototype.pushScene=function(t){this._postTickTasks.push({type:0,scene:t})},r.prototype.replaceScene=function(t,e){this._postTickTasks.push({type:1,scene:t,preserveCurrent:!!e})},r.prototype.popScene=function(t,e){void 0===e&&(e=1);for(var i=0;i<e;i++)this._postTickTasks.push({type:2,preserveCurrent:!!t})},r.prototype.scene=function(){if(this.scenes.length)return this.scenes[this.scenes.length-1]},r.prototype.tick=function(t,e,i){var r=null;if(this._isTerminated)return!1;if(this.isLastTickLocal=!t,this.lastOmittedLocalTickCount=e||0,this.scenes.length){if(r=this.scenes[this.scenes.length-1],i&&i.length)for(var o=0;o<i.length;++o){var s=this._eventConverter.toGameEvent(i[o]),n=this._eventTriggerMap[s.type];n&&n.fire(s)}r.onUpdate.fire(),t&&++this.age}return!!this._postTickTasks.length&&(this._flushPostTickTasks(),r!==this.scenes[this.scenes.length-1])},r.prototype.render=function(){if(this._modified){var t=this.scene();if(t){for(var e=this.focusingCamera,i=this.renderers,r=0;r<i.length;++r){var o=i[r];o.begin(),o.save(),o.clear(),e&&(o.save(),e._applyTransformToRenderer(o));for(var s=t.children,n=0;n<s.length;++n)s[n].render(o,e);e&&o.restore(),o.restore(),o.end()}this._modified=!1}}},r.prototype.resolvePointEvent=function(t){switch(t.type){case 0:return this._pointEventResolver.pointDown(t);case 1:return this._pointEventResolver.pointMove(t);case 2:return this._pointEventResolver.pointUp(t)}},r.prototype.findPointSource=function(t,e){e=e||this.focusingCamera;var i=this.scene();if(i)return i.findPointSourceByPoint(t,!1,e)},r.prototype.register=function(t){if(t.local){if(void 0===t.id)t.id=--this._localIdx;else{if(0<t.id)throw H.ExceptionFactory.createAssertionError("Game#register: invalid local id: "+t.id);if(this._localDb.hasOwnProperty(String(t.id)))throw H.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+t.id);this._localIdx>t.id&&(this._localIdx=t.id)}this._localDb[t.id]=t}else{if(void 0===t.id)t.id=++this._idx;else{if(t.id<0)throw H.ExceptionFactory.createAssertionError("Game#register: invalid non-local id: "+t.id);if(this.db.hasOwnProperty(String(t.id)))throw H.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+t.id);this._idx<t.id&&(this._idx=t.id)}this.db[t.id]=t}},r.prototype.unregister=function(t){t.local?delete this._localDb[t.id]:delete this.db[t.id]},r.prototype.terminateGame=function(){this._isTerminated=!0,this._terminateGame()},r.prototype.modified=function(){this._modified=!0},r.prototype.raiseEvent=function(t){this.handlerSet.raiseEvent(this._eventConverter.toPlaylogEvent(t))},r.prototype.raiseTick=function(t){if(null!=t&&t.length){for(var e=[],i=0;i<t.length;i++)e.push(this._eventConverter.toPlaylogEvent(t[i]));this.handlerSet.raiseTick(e)}else this.handlerSet.raiseTick()},r.prototype.addEventFilter=function(t,e){this.handlerSet.addEventFilter(t,e)},r.prototype.removeEventFilter=function(t){this.handlerSet.removeEventFilter(t)},r.prototype.shouldSaveSnapshot=function(){return this.handlerSet.shouldSaveSnapshot()},r.prototype.saveSnapshot=function(t,e){this.handlerSet.saveSnapshot(this.age,t,this.random.serialize(),e)},r.prototype.getCurrentTime=function(){return this.handlerSet.getCurrentTime()},r.prototype.isActiveInstance=function(){return"active"===this.handlerSet.getInstanceType()},r.prototype._pushPostTickTask=function(t,e){this._postTickTasks.push({type:3,fun:t,owner:e})},r.prototype._normalizeConfiguration=function(t){if(!t)throw H.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: invalid arguments");if(null==t.assets&&(t.assets={}),null==t.fps&&(t.fps=30),"number"!=typeof t.fps)throw H.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be given as a number");if(!(0<=t.fps&&t.fps<=60))throw H.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be a number in (0, 60].");if("number"!=typeof t.width)throw H.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: width must be given as a number");if("number"!=typeof t.height)throw H.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: height must be given as a number");return t},r.prototype._setAudioPlaybackRate=function(t){this.audio._setPlaybackRate(t)},r.prototype._setMuted=function(t){this.audio._setMuted(t)},r.prototype._decodeOperationPluginOperation=function(t,e){var i=this.operationPluginManager.plugins[t];return i&&i.decode?i.decode(e):e},r.prototype._reset=function(t){if(this.operationPluginManager.stopAll(),this.scene()){for(;this.scene()!==this._initialScene;)this.popScene(),this._flushPostTickTasks();this.isLoaded||this.scenes.pop()}switch(t&&(void 0!==t.age&&(this.age=t.age),void 0!==t.randGenSer?this.random=Wt.XorshiftRandomGenerator.deserialize(t.randGenSer):void 0!==t.randSeed&&(this.random=new Wt.XorshiftRandomGenerator(t.randSeed))),this.audio._reset(),this._onLoad.removeAll({func:this._handleLoad,owner:this}),this.onJoin.removeAll(),this.onLeave.removeAll(),this.onSeed.removeAll(),this.onResized.removeAll(),this.onSkipChange.removeAll(),this.onSceneChange.removeAll(),this.handlerSet.removeAllEventFilters(),this.isSkipping=!1,this.onSkipChange.add(this._handleSkipChange,this),this.joinedPlayerIds=[],this.onJoin.add(this._handleJoinEvent,this),this.onLeave.add(this._handleLeaveEvent,this),this._idx=0,this._localIdx=0,this._cameraIdx=0,this.db={},this._localDb={},this._modified=!0,this.loadingScene=void 0,this._focusingCamera=void 0,this.lastLocalTickMode=null,this.lastTickGenerationMode=null,this.onSnapshotRequest.removeAll(),this._postTickTasks=[],this._eventConverter=new Et.EventConverter({game:this,playerId:this.selfId}),this._pointEventResolver=new Ut.PointEventResolver({sourceResolver:this,playerId:this.selfId}),this._isTerminated=!1,this.vars={},this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=new Pt.SurfaceAtlasSet({resourceFactory:this.resourceFactory}),this._configuration.defaultLoadingScene){case"none":this._defaultLoadingScene=new At.LoadingScene({game:this});break;case"compact":this._defaultLoadingScene=new wt.DefaultLoadingScene({game:this,style:"compact"});break;default:this._defaultLoadingScene=new wt.DefaultLoadingScene({game:this})}},r.prototype._destroy=function(){if(this.operationPluginManager.destroy(),this.scene())for(;this.scene()!==this._initialScene;)this.popScene(),this._flushPostTickTasks();this._initialScene.destroy(),this.loadingScene&&!this.loadingScene.destroyed()&&this.loadingScene.destroy(),this._defaultLoadingScene.destroyed()||this._defaultLoadingScene.destroy(),this.db=void 0,this.renderers=void 0,this.scenes=void 0,this.random=void 0,this._modified=!1,this.age=0,this.assets=void 0,this.isLoaded=!1,this.loadingScene=void 0,this.assetBase="",this.selfId=void 0,this.audio.music.stopAll(),this.audio.sound.stopAll(),this.audio=void 0,this.defaultAudioSystemId=void 0,this.handlerSet=void 0,this.onJoin.destroy(),this.onJoin=void 0,this.onLeave.destroy(),this.onLeave=void 0,this.onSeed.destroy(),this.onSeed=void 0,this.onPlayerInfo.destroy(),this.onPlayerInfo=void 0,this.onResized.destroy(),this.onResized=void 0,this.onSkipChange.destroy(),this.onSkipChange=void 0,this.onSceneChange.destroy(),this.onSceneChange=void 0,this.onSnapshotRequest.destroy(),this.onSnapshotRequest=void 0,this.join=void 0,this.leave=void 0,this.seed=void 0,this.playerInfo=void 0,this.snapshotRequest=void 0,this.resized=void 0,this.skippingChanged=void 0,this._sceneChanged=void 0,this._loaded=void 0,this._started=void 0,this._operationPluginOperated=void 0,this._onSceneChange.destroy(),this._onSceneChange=void 0,this._onLoad.destroy(),this._onLoad=void 0,this._onStart.destroy(),this._onStart=void 0,this.resourceFactory=void 0,this.storage=void 0,this.playId=void 0,this.operationPlugins=void 0,this._eventTriggerMap=void 0,this._initialScene=void 0,this._defaultLoadingScene=void 0,this._main=void 0,this._mainFunc=void 0,this._mainParameter=void 0,this._assetManager.destroy(),this._assetManager=void 0,this._eventConverter=void 0,this._pointEventResolver=void 0,this.operationPluginManager=void 0,this._onOperationPluginOperated.destroy(),this._onOperationPluginOperated=void 0,this._idx=0,this._localDb={},this._localIdx=0,this._cameraIdx=0,this._isTerminated=!0,this._focusingCamera=void 0,this._configuration=void 0,this._postTickTasks=[],this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=void 0},r.prototype._loadAndStart=function(t){this._mainParameter=t||{},this.isLoaded?this._handleLoad():(this._onLoad.add(this._handleLoad,this),this.pushScene(this._initialScene),this._flushPostTickTasks())},r.prototype._startLoadingGlobalAssets=function(){if(this.isLoaded)throw H.ExceptionFactory.createAssertionError("Game#_startLoadingGlobalAssets: already loaded.");this.pushScene(this._initialScene),this._flushPostTickTasks()},r.prototype._updateEventTriggers=function(t){if(this._modified=!0,!t)return this._eventTriggerMap.message=void 0,this._eventTriggerMap["point-down"]=void 0,this._eventTriggerMap["point-move"]=void 0,this._eventTriggerMap["point-up"]=void 0,void(this._eventTriggerMap.operation=void 0);this._eventTriggerMap.message=t.onMessage,this._eventTriggerMap["point-down"]=t.onPointDownCapture,this._eventTriggerMap["point-move"]=t.onPointMoveCapture,this._eventTriggerMap["point-up"]=t.onPointUpCapture,this._eventTriggerMap.operation=t.onOperation,t._activate()},r.prototype._handleInitialSceneLoad=function(){this._initialScene.onLoad.remove(this._handleInitialSceneLoad,this),this.assets=this._initialScene.assets,this.isLoaded=!0,this._onLoad.fire(this)},r.prototype._handleOperationPluginOperated=function(t){var e=this._eventConverter.makePlaylogOperationEvent(t);this.handlerSet.raiseEvent(e)},r.prototype._handleSceneChanged=function(t){this._updateEventTriggers(t);var e=t?t.local:"full-local",i=t?t.tickGenerationMode:"by-clock";this.lastLocalTickMode===e&&this.lastTickGenerationMode===i||(this.lastLocalTickMode=e,this.lastTickGenerationMode=i,this.handlerSet.changeSceneMode({local:e,tickGenerationMode:i}))},r.prototype._terminateGame=function(){},r.prototype._flushPostTickTasks=function(){do{var t=this._postTickTasks;this._postTickTasks=[];for(var e=0;e<t.length;++e){var i=t[e];switch(i.type){case 0:var r=this.scene();r&&r._deactivate(),this._doPushScene(i.scene);break;case 1:this._doPopScene(i.preserveCurrent,!1),this._doPushScene(i.scene);break;case 2:this._doPopScene(i.preserveCurrent,!0);break;case 3:i.fun.call(i.owner);break;default:throw H.ExceptionFactory.createAssertionError("Game#_flushPostTickTasks: unknown post-tick task type.")}}}while(0<this._postTickTasks.length)},r.prototype._handleSkipChange=function(t){this.isSkipping=t},r.prototype._handleJoinEvent=function(t){-1===this.joinedPlayerIds.indexOf(t.player.id)&&this.joinedPlayerIds.push(t.player.id)},r.prototype._handleLeaveEvent=function(e){this.joinedPlayerIds=this.joinedPlayerIds.filter(function(t){return t!==e.player.id})},r.prototype._doPopScene=function(t,e){var i=this.scenes.pop();if(!i)throw H.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; scene stack underflow");if(i===this._initialScene)throw H.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; attempting to pop the initial scene");if(t||i.destroy(),e){var r=this.scene();this.onSceneChange.fire(r),this._onSceneChange.fire(r)}},r.prototype._handleLoad=function(){if(this.operationPluginManager.initialize(),this.operationPlugins=this.operationPluginManager.plugins,this._mainFunc)this._mainFunc(this._runtimeValueBase,this._mainParameter||{});else{if(!this._main)throw H.ExceptionFactory.createAssertionError("Game#_handleLoad: does not have an entry point");var t=this._moduleManager._require(this._main);if(!t||"function"!=typeof t)throw H.ExceptionFactory.createAssertionError("Game#_handleLoad: Entry point "+this._main+" not found.");t(this._mainParameter)}this._flushPostTickTasks(),this._onStart.fire()},r.prototype._doPushScene=function(t,e){if(e=e||this.loadingScene||this._defaultLoadingScene,this.scenes.push(t),t._needsLoading()&&"loaded-fired"!==t._loadingState){if(this._defaultLoadingScene._needsLoading())throw H.ExceptionFactory.createAssertionError("Game#_doPushScene: _defaultLoadingScene must not depend on any assets/storages.");this._doPushScene(e,this._defaultLoadingScene),e.reset(t)}else this.onSceneChange.fire(t),this._onSceneChange.fire(t),t._loaded||(t._load(),this._pushPostTickTask(t._fireLoaded,t));this._modified=!0},r);function r(t){var e=this._normalizeConfiguration(t.configuration);this.fps=e.fps,this.width=e.width,this.height=e.height,this.renderers=[],this.scenes=[],this.age=0,this.assetBase=t.assetBase||"",this.resourceFactory=t.resourceFactory,this.handlerSet=t.handlerSet,this.selfId=t.selfId,this.db=void 0,this.loadingScene=void 0,this.operationPlugins=void 0,this.random=void 0,this._defaultLoadingScene=void 0,this._eventConverter=void 0,this._pointEventResolver=void 0,this._idx=void 0,this._localDb=void 0,this._localIdx=void 0,this._cameraIdx=void 0,this._isTerminated=void 0,this._modified=void 0,this._postTickTasks=void 0,this.playId=void 0,this.isSkipping=!1,this.joinedPlayerIds=[],this.audio=new ut.AudioSystemManager(this.resourceFactory),this.defaultAudioSystemId="sound",this.storage=new Tt.Storage,this.assets={},this.surfaceAtlasSet=new Pt.SurfaceAtlasSet({resourceFactory:this.resourceFactory}),this.onJoin=new y.Trigger,this.onLeave=new y.Trigger,this.onPlayerInfo=new y.Trigger,this.onSeed=new y.Trigger,this.join=this.onJoin,this.leave=this.onLeave,this.playerInfo=this.onPlayerInfo,this.seed=this.onSeed,this._eventTriggerMap={unknown:void 0,timestamp:void 0,join:this.onJoin,leave:this.onLeave,"player-info":this.onPlayerInfo,seed:this.onSeed,message:void 0,"point-down":void 0,"point-move":void 0,"point-up":void 0,operation:void 0},this.onResized=new y.Trigger,this.onSkipChange=new y.Trigger,this.resized=this.onResized,this.skippingChanged=this.onSkipChange,this.isLastTickLocal=!0,this.lastOmittedLocalTickCount=0,this.lastLocalTickMode=null,this.lastTickGenerationMode=null,this._onLoad=new y.Trigger,this._onStart=new y.Trigger,this._loaded=this._onLoad,this._started=this._onStart,this.isLoaded=!1,this.onSnapshotRequest=new y.Trigger,this.snapshotRequest=this.onSnapshotRequest,this.external={},this._runtimeValueBase=Object.create(t.engineModule,{game:{value:this,enumerable:!0}}),this._main=e.main,this._mainFunc=t.mainFunc,this._mainParameter=void 0,this._configuration=e,this._assetManager=new lt.AssetManager(this,e.assets,e.audio,e.moduleMainScripts),this._moduleManager=new kt.ModuleManager(this._runtimeValueBase,this._assetManager);var i=e.operationPlugins||[];this.operationPluginManager=new Rt.OperationPluginManager(this,t.operationPluginViewInfo||null,i),this._onOperationPluginOperated=new y.Trigger,this._operationPluginOperated=this._onOperationPluginOperated,this.operationPluginManager.onOperate.add(this._onOperationPluginOperated.fire,this._onOperationPluginOperated),this.onSceneChange=new y.Trigger,this._onSceneChange=new y.Trigger,this._onSceneChange.add(this._handleSceneChanged,this),this._sceneChanged=this._onSceneChange,this._initialScene=new St.Scene({game:this,assetIds:this._assetManager.globalAssetIds(),local:!0,name:"akashic:initial-scene"}),this._initialScene.onLoad.add(this._handleInitialSceneLoad,this),this._reset({age:0})}e.Game=i});t(Gt);Gt.Game;var Nt=e(function(t,i){function e(t){for(var e in t)i.hasOwnProperty(e)||(i[e]=t[e])}Object.defineProperty(i,"__esModule",{value:!0}),e(y),e(X),i.AudioSystem=q.AudioSystem,i.Module=Y.Module,i.ShaderProgram=J.ShaderProgram,i.VideoSystem=K.VideoSystem,e(q),e(it),e(et),e(rt),e(nt),e(ht),e(ct),e(st),e(dt),e(lt),e(ut),e(ft),e(_t),e(yt),e(wt),e(Mt),e(Ot),e($),e(Et),e(Ct),e(Lt),e(H),e(pt),e(At),e(Z),e(Y),e(kt),e(jt),e(Q),e(Rt),e(V),e(Ut),e(Dt),e(Ft),e(It),e(J),e(zt),e(Tt),e(bt),e(Pt),e(xt),e(ot),e(at),e(vt),e(mt),e(tt),e(K),e(Bt),e(Wt),e(St),e(Gt)});t(Nt);Nt.AudioSystem,Nt.Module,Nt.ShaderProgram,Nt.VideoSystem;return t(e(function(t,i){Object.defineProperty(i,"__esModule",{value:!0}),function(t){for(var e in t)i.hasOwnProperty(e)||(i[e]=t[e])}(Nt)}))});
