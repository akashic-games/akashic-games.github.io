import{_ as e}from"./chunks/thiefBuster.B1Jd3U-s.js";import{_ as t,c as n,I as l,w as o,k as s,a,a3 as p,E as h,o as r}from"./chunks/framework.DaCD_bki.js";const c="/assets/sandbox_screenshot.BwrBHhjx.png",d="/assets/sandbox_niconico_tab.CpT17q4R.png",k="/assets/sandbox_session_parameter.B2lxRfTe.png",B=JSON.parse('{"title":"ランキングゲーム","description":"","frontmatter":{},"headers":[],"relativePath":"shin-ichiba/ranking/index.md","filePath":"shin-ichiba/ranking/index.md"}'),g={name:"shin-ichiba/ranking/index.md"},u=s("h1",{id:"ランキングゲーム",tabindex:"-1"},[a("ランキングゲーム "),s("a",{class:"header-anchor",href:"#ランキングゲーム","aria-label":'Permalink to "ランキングゲーム"'},"​")],-1),m=s("p",null,[s("strong",null,"ランキングゲーム"),a(" (ランキング対応ニコ生ゲーム) は、一人プレイのミニゲームを放送者・視聴者がそれぞれで遊び、その得点を競う形式のニコ生ゲームです。")],-1),E=s("img",{src:e},null,-1),b=p(`<p>ランキングゲームは、シングルプレイの通常の Akashic ゲームです。 ただしゲームは <strong>一定時間で終了され、終了時の得点が自動的に集計・結果発表されます</strong> 。</p><p>この性質から、ランキングゲームは次の条件を満たす必要があります。</p><ul><li><code>supportedModes</code> を指定し、ランキングゲームであることを宣言する</li><li>ゲーム内で「得点」にあたる数値を特別な変数に代入する</li><li>ファイルサイズなどの制限に従う</li><li>game.json で希望ゲーム時間を申告する (オプション)</li><li>ゲーム内で実際のゲーム時間を受け取る (オプション)</li></ul><p>以下、このページではこれらの詳細を説明します。</p><h2 id="ランキングゲームテンプレート" tabindex="-1">ランキングゲームテンプレート <a class="header-anchor" href="#ランキングゲームテンプレート" aria-label="Permalink to &quot;ランキングゲームテンプレート&quot;">​</a></h2><p>実際にランキングゲームを作成する場合、Akashic Engine の開発ツール <code>akashic init</code> コマンドが提供する <strong>ランキングゲームテンプレート</strong> が利用できます。</p><p>このテンプレートを使うと、上述の <code>supportedModes</code> の設定など、ランキングゲームに必要な最低限の作業が済んだ状態のゲームが生成されます。 後述するセッションパラメータの受け取りなど煩雑な作業を避けられるため、テンプレートの利用を推奨します。</p><p>詳細は <a href="./ranking-by-template.html">ランキングゲームテンプレート</a> を参照してください。</p><p>ゲーム自体は、<a href="/tutorial/v3/basic.html">Akashic Engine 入門 » シングルプレイのゲーム作成</a> を参考に作成してください。</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>ランキングゲームテンプレートを使って、実際にゲームを作成するチュートリアル <a href="./../breakout/"><strong>ランキングゲームを作ろう</strong></a> も併せて参照してください。</p></div><h2 id="requirements" tabindex="-1">要求仕様 <a class="header-anchor" href="#requirements" aria-label="Permalink to &quot;要求仕様 {#requirements}&quot;">​</a></h2><p>ランキング対応ニコ生ゲームは、以下の条件を満たす Akashic ゲームです。</p><h3 id="supported-modes" tabindex="-1">supportedModes の指定 <a class="header-anchor" href="#supported-modes" aria-label="Permalink to &quot;supportedModes の指定 {#supported-modes}&quot;">​</a></h3><p>ランキングゲームは、 game.json の <code>environment.nicolive.supportedModes</code> の値に <code>[&quot;ranking&quot;]</code> を指定している必要があります。</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;environment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;nicolive&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;supportedModes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ranking&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="score" tabindex="-1">スコアの代入 <a class="header-anchor" href="#score" aria-label="Permalink to &quot;スコアの代入 {#score}&quot;">​</a></h3><p>ランキングゲームは、ゲーム内でのスコアを <code>g.game.vars.gameState.score</code> に代入する必要があります。</p><p>ゲーム開始時に一度だけ初期化しておき、</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g.game.vars.gameState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { score: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span></code></pre></div><p>スコアが変化するたびに更新してください。</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// スコアを 100 点にする例</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g.game.vars.gameState.score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// スコアを 10 点加算する例</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g.game.vars.gameState.score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>値は 0 以上の整数である必要があります。 上限は今のところありませんが、現実的に表示が崩れてしまうので、10 万未満 (5 桁以内) を推奨します。</p><div class="danger custom-block"><p class="custom-block-title">IMPORTANT</p><p>スコアは、ゲーム中も常に <code>g.game.vars.gameState.score</code> に代入してください。</p><p>つまり「スコアを中間変数に保持しておいて、最後に <code>g.game.vars.gameState.score</code> に代入する」というような処理にはしないでください。 というのも、通信遅延などで起動が遅れた場合などでは、最悪スコアの代入が間に合わずにゲームが終了されてしまう可能性があるためです。 途中までプレイできていたのに 0 点扱いになってしまうと、プレイヤーからは不具合に見える動作になってしまいます。</p></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>g.game.vars</code> は、Akashic Engine が「ゲーム開発者が自由に使える領域」として提供している値で、初期値は空オブジェクト <code>{}</code> です。 ニコ生ゲームのランキングゲームでは、この一部をスコアを入れる変数として特別扱いしています。</p><p>ゲームの開始時に <code>gameState</code> プロパティを初期化する必要があるのはこのためです。</p></div><h3 id="resolution-and-fps" tabindex="-1">解像度・FPS・サイズの制限 <a class="header-anchor" href="#resolution-and-fps" aria-label="Permalink to &quot;解像度・FPS・サイズの制限 {#resolution-and-fps}&quot;">​</a></h3><p>次の条件を満たす必要があります。</p><ul><li><strong>画面解像度</strong>: 1280x720 以下 (16:9 を推奨)</li><li><strong>FPS</strong>: 1 以上 60 以下 (30 または 60 を推奨)</li><li><strong>zip圧縮前の合計サイズ</strong>: 30MB 以下</li><li><strong>game.jsonのサイズ</strong>: 100KB 以下</li></ul><div class="tip custom-block"><p class="custom-block-title">参考</p><ul><li><a href="/reverse-reference/v3/setting/game-size.html">逆引きリファレンス » 解像度を変更する</a></li><li><a href="/reverse-reference/v3/setting/fps.html">逆引きリファレンス » FPSを変更する</a></li></ul></div><h2 id="固有の機能と動作" tabindex="-1">固有の機能と動作 <a class="header-anchor" href="#固有の機能と動作" aria-label="Permalink to &quot;固有の機能と動作&quot;">​</a></h2><h3 id="total-time-limit" tabindex="-1">制限時間の申告 <a class="header-anchor" href="#total-time-limit" aria-label="Permalink to &quot;制限時間の申告 {#total-time-limit}&quot;">​</a></h3><p>ランキングゲームは起動後一定時間で終了されます。 ゲームからは、この時間 (ゲームの制限時間) の希望を申告することができます。 game.json の <code>environment.nicolive.preferredSessionParameters.totalTimeLimit</code> に秒数を指定してください。</p><p>次の例では、希望制限時間を 30 秒としています。</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ... その他の記述 ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;environment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;nicolive&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;supportedModes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ranking&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;preferredSessionParameters&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;totalTimeLimit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>totalTimeLimit</code> には 20 以上 200 以下の整数を指定できます。 指定されなかった場合、適当なデフォルト値が使われます (現在は 80 秒程度になります)。</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>後方互換性のため、 <code>environment.nicolive</code> がなく <code>environment.niconico</code> がある場合、そちらが参照されます。</p></div><h3 id="制限時間の参照" tabindex="-1">制限時間の参照 <a class="header-anchor" href="#制限時間の参照" aria-label="Permalink to &quot;制限時間の参照&quot;">​</a></h3><p>ランキングゲームの実際の制限時間は、起動時に決定されます。 この「実際の制限時間」はゲーム開始時に受信できる特別な <code>g.MessageEvent</code> から取得できます。詳細は <a href="./../spec.html#session-parameter">セッションパラメータ</a> を参照してください。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>akashic init</code> が提供するランキングゲームテンプレートには、セッションパラメータから制限時間を取得するコードが含まれています。 そのため <strong>ゲーム開発者がセッションパラメータを自力で取り扱う必要は通常ありません</strong> 。詳細は <a href="./ranking-by-template.html">ランキングゲームテンプレート</a> を参照してください。</p></div><h3 id="共通乱数シード" tabindex="-1">共通乱数シード <a class="header-anchor" href="#共通乱数シード" aria-label="Permalink to &quot;共通乱数シード&quot;">​</a></h3><p>ランキングゲームでは、<strong><code>g.game.random</code> の生成する乱数がプレイヤー間で一致しません</strong> 。 これはランキングゲームが、放送者・各視聴者の手元で個別に実行されるシングルプレイのゲームであるためです。 お互いのプレイが独立しているため、乱数も一致しません。</p><p>クイズの出題順や、パズルゲームの初期配置など、ゲームによってはプレイヤー間で共通の乱数が使いたい場合があります。 セッションパラメータには、この目的で利用できる「プレイヤー間で共通の乱数シード」が含まれています。 詳細は <a href="./../spec.html#session-parameter">セッションパラメータ</a> を参照してください。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>akashic init</code> が提供するランキングゲームテンプレートには、この共通乱数シードを使った「共通乱数生成器」が最初から実装されています。 そのため <strong>ゲーム開発者がセッションパラメータを自力で取り扱う必要は通常ありません</strong> 。詳細は <a href="./ranking-by-template.html">ランキングゲームテンプレート</a> を参照してください。</p></div><h2 id="debug" tabindex="-1">動作確認 <a class="header-anchor" href="#debug" aria-label="Permalink to &quot;動作確認 {#debug}&quot;">​</a></h2><p>akashic sandbox コマンドを用いることで、スコアが正しく設定されているかなどを確認することができます。</p><p>ランキング対応ゲームのディレクトリ内で akashic sandbox を起動します。</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">akashic</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sandbox</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>以下のスクリーンショットでは、ランキング対応ゲームのサンプル <a href="https://github.com/akashic-contents/block-shooter" target="_blank" rel="noreferrer">block-shooter</a> を起動しています。 このコンテンツは、 <a href="https://github.com/akashic-contents/block-shooter/archive/master.zip" target="_blank" rel="noreferrer">こちら</a> から zip ファイルをダウンロードすることができます。</p></div><p>任意の Web ブラウザから <code>http://localhost:3000/game</code> にアクセスすると、以下のスクリーンショットのようにゲーム画面が表示されます</p><p><img src="`+c+'" alt="akashic-sandbox起動時"></p><p>画面の右上の歯車アイコンをクリックするとディベロッパーツールが表示されます。 Niconico タブをクリックすると、下記のような画面(v0.13.54 時点のもの)が表示されます。</p><p><img src="'+d+'" alt="niconicoタブ"></p><p>「ランキングモードで参照される値」でゲーム中の <code>g.game.vars.gameState</code> の次のプロパティを確認できます。</p><ul><li>スコア (<code>score</code>)</li><li>プレイ閾値 (<code>playThreshold</code>)</li><li>クリア閾値 (<code>clearThreshold</code>)</li></ul><p>「セッションパラメータを送る」にチェックを入れることによって、下記の画面から mode や totalTimeLimit 等のゲームに送られるセッションパラメータの値を設定することができます。(実際にそれらの値を送るには、ページをリロードする必要があります。)</p><p><img src="'+k+'" alt="セッションパラメータ"></p><p>mode で「ランキング(ranking)」を選択することで、akashic sandbox は次のように動作します。</p><ul><li><code>totalTimeLimit</code> (制限時間) がゲーム開始時に送られます。また、この値を指定することができます。 <ul><li>ただしこの値は、あくまで akashic sandbox 上でのデバッグのためのもので、ニコニコ生放送で実際に起動された時の値は保証されません。</li></ul></li><li>制限時間までの残り時間がカウントされます。</li><li>「制限時間経過後にゲームを停止」にチェックを入れていれば、残り時間が 0 になった時にゲームの実行が停止されます。</li></ul><h2 id="submit" tabindex="-1">投稿 <a class="header-anchor" href="#submit" aria-label="Permalink to &quot;投稿 {#submit}&quot;">​</a></h2><p>作成したゲームを実際にニコニコ生放送上で遊ぶには、<a href="./../submit.html">ニコ生ゲームを投稿しよう</a> を参照してください。</p>',60);function v(y,_,F,q,C,f){const i=h("CaptionedFigure");return r(),n("div",null,[u,m,l(i,{caption:"得点と残り時間を表示している典型的なランキングゲーム『泥棒バスター』"},{default:o(()=>[E]),_:1}),b])}const T=t(g,[["render",v]]);export{B as __pageData,T as default};
